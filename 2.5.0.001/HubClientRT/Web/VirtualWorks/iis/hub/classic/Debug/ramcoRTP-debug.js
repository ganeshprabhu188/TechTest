/*
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26230
//	Date		: 20-Sep-2018
//	Description	: HorizontalView - If no rows fetched for the associated grid, existing values in horizontal view is not clearing
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26067
//	Date		: 20-Sep-2018
//	Description	: Issue 1 : Exception while showing ellipse window for display only controls
//				  Issue 2 : Textarea contol inside ellipse window is truncated for display only controls
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26028
//	Date		: 20-Sep-2018
//	Description	: Tooltip for link controls (Icon Only) not displayed even though available in initial config
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-24256
//	Date		: 20-Sep-2018
//	Description	: DataView - Exception when clicking dataview after navigating to next set
//	Fixed by	: Sampath Kumar M
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-20462
//	Date		: 20-Sep-2018
//	Description	: Columns that are hidden in model itself, should not be displayed in column chooser
//	Fixed by	: Sampath Kumar M
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-25241
//	Date		: 27-Sep-2018
//	Description	: Combo trigger not visible when in disabled state
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26498
//	Date		: 28-Sep-2018
//	Description	: Error while adding iEDK extended controls with store if the base screen does not have any combo / grid
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26718
//	Date		: 01-Oct-2018
//	Description	: Exception on click of Column Chooser
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26312
//	Date		: 27-Sep-2018
//	Description	: Screen validation failed ! Check for marked controls
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: HSI-191
//	Date		: 03-Oct-2018
//	Description	: Unable to edit and hide fields using Crysalis-Reimbursement ESS
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26703
//	Date		: 01-Oct-2018
//	Description	: Grid when dragged and dropped appears as text
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26763
//	Date		: 03-Oct-2018
//	Description	: Change in Client RT for display only control having template
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26738 / ATH-84
//	Date		: 03-Oct-2018
//	Description	: Grid search misbehaving after page navigation and wrong search data combination
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26776 / APSH-93
//	Date		: 03-Oct-2018
//	Description	: Partner Call Ref: APSH-93. Datetime format handling
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26860
//	Date		: 05-Oct-2018
//	Description	: Partner Call Ref: KFC-128 and PRES-56. Tag Cloud Control is not working
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26873
//	Date		: 05-Oct-2018
//	Description	: Partner Call Ref: AHBG-25613. Tab control is having scroll inside it
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26919 / MPTU-42
//	Date		: 08-Oct-2018
//	Description	: Partner Call: MPTU-42. File attachment not working for the first time in IE browser
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27015
//	Date		: 10-Oct-2018
//	Description	: Partner Call Ref: MPTU-40. Launch Box Notification not working (The code will be available in ezwizard callout js)
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-25688
//	Date		: 12-Oct-2018
//	Description	: Online Help not working for Help screens
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27116
//	Date		: 11-Oct-2018
//	Description	: Activity Search is not working for invalid activity entry
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27233
//	Date		: 16-Oct-2018
//	Description	: Partner Call Ref: MPTU-48. Grid Search Not Working (throwing error) After Next Set of Records Loaded from Response
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27239
//	Date		: 16-Oct-2018
//	Description	: Partner Call Ref: AHBG-25709 and AHBG-22815. Multiple Issues Listed (Non RVW Activity Launch and Workarea switching with no UI)
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27237
//	Date		: 17-Oct-2018
//	Description	: Implementation of open street maps
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-16554 / AHBG-24719 / AHBG-24044 / TECH-27017
//	Date		: 17-Oct-2018
//	Description	: Exception if the list edit data not available from response / Data view selection lost when clicking anywhere outside the box
// 				  "No rows to display" error displayed even if rows exists for tree grid / F2 popup window not closing on "Esc" key press
//	Fixed by	: Giridharan V / Sampath M
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27455
//	Date		: 25-Oct-2018
//	Description	: Partner Call Ref: IMU-194 - Star Rating is not working properly
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27457
//	Date		: 25-Oct-2018
//	Description	: Multiple Issues Listed (* When getting focus out of the mask control, error message is being thrown. * List Edit - Columns are not showing in full width * Dataview - Unnecessary default focus)
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27458
//	Date		: 25-Oct-2018
//	Description	: Aviation Call Ref: AHBG-25827 - Smart bar icon is disappeared
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	:  AHBG-25783 / AHBG-24743 / TECH-27479 
//	Date		: 25-Oct-2018
//	Description	: Breadcrumb Value not changing as per the Component Name / Handling layout misbehaviour for tabpanel/Infobubble Float button changes in css
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-25962
//	Date		: 26-Oct-2018
//	Description	: Message LookUp Tasks not working as expected
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27537
//	Date		: 26-Oct-2018
//	Description	: Issue in launching modal/help window
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-26113
//	Date		: 31-Oct-2018
//	Description	: Error message detail view state should not be retained for next view
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27651
//	Date		: 31-Oct-2018
//	Description	: To unselect radio button option- on enter of and on click of task in hub version
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27417
//	Date		: 31-Oct-2018
//	Description	: Setting Default Report Launching Path
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-26068 /AHBG-26058 /AHBG-25784 /AHBG-25789 /AHBG-26121 /TECH-27444 /TECH-27562 /TECH-27719
//	Date		: 31-Oct-2018
//	Description	: F2 key pop-up not aligned properly /Handling listedit modified value in payload/Handling Favorites menu changes on Activity launch /
//				  Conversion failed when converting date and/or time from character string in Inbox	/Horizontalview visible Rows update from json/Handling smartView To modalWindow viceVersa/
//                 Avn Upload Success Message Handling/logout page title change based on settings
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26897
//	Date		: 02-Nov-2018
//	Description	: Handling  various controls payload  for personalisation.
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27833
//	Date		: 02-Nov-2018
//	Description	: Aviation Call Ref: AHBG-25788 - Personalization icon is missing for some controls
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-25802 / AHBG-26357 / AHBG-25813 / TECH-27633
//	Date		: 02-Nov-2018
//	Description	: On Click on '+' in ML, 2 rows are shown, instead of 1 row addition / Exception on typing characters in ml listedit
//				  Traverse through slider-bar in grid zoom Window displays wrong row data
//	Fixed by	: Giridharan V / Sampath Kumar M
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27824 / TECH-27753
//	Date		: 09-Nov-2018
//	Description	: Setting blank value for radio option after repetitive cycle is not working / 
// 				  Questionare not displayed if value '0' is fetched for the associated control
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27904 / TECH-27261
//	Date		: 12-Nov-2018
//	Description	: Mask control value not displayed if blank value out on screen launch and actual value out for other task / 
// 				  Tooltip shows raw template values instead of formatted value / Grid multi-sort not working as expected
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28102
//	Date		: 13-Nov-2018
//	Description	: Handling changes in timepicker based on userpreference.
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27922
//	Date		: 12-Nov-2018
//	Description	: callout is not properly placed
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-26633
//	Date		: 12-Nov-2018
//	Description	: Comma separator not working header amount control
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27832
//	Date		: 13-Nov-2018
//	Description	: After iEDK Customization we have facing alignment issue in hub version. Extui version is working fine in Pioneer Dev Server. --> Codegen changes also required
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27432
//	Date		: 13-Nov-2018
//	Description	: Hide Set Preferences and save defaults in candidate portal when logged in through external link --> Codegen changes also required
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28131 / TECH-28121 / TECH-27966
//	Date		: 16-Nov-2018
//	Description	: Incorrect current row value passed to request for multiline link / 
// 				  Grid search not working as expected for column wise search / 
// 				  Data not binding as expected for Horizontal View after navigating to next pages
//	Fixed by	: Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28231
//	Date		: 16-Nov-2018
//	Description	: Handling "session or URL replayed" while clicking favorites icon
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-24766
//	Date		: 16-Nov-2018
//	Description	: Once the '+' icon is clicked in the tree, the '-' icon does not appear
//	Fixed by	: Prabhakaran. SS
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID 	: 	AHBG-25919, AHBG-25777, AHBG-24045, AHBG-24044
//	Date		: 	16-Nov-2018
//	Description	: 	Issue 1 : Record work estimates issues : The tree is not available in record estimates
//				  		Issue 2 : In Manage Cabin Configuration, On double click on tree, details are not fetching in the Multiline
//				  		Issue 3: After defining the cabin config. RVW tree grid is not working in the non hand coded screen
//				  		Issue 4: The task with repair scheme defined, tree grid does not appear in the multiline
//	Fixed by	: 	Prabhakaran. SS
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID 	: 	TECH-28264
//	Date		: 	16-Nov-2018
//	Description	: 	Aviation Call Ref: AHBG-26051 / AHBG-26159
// 						* Disabled Help Icon
// 						* Showing Favorite Menu as Links
// 						* Adding Delete Favorite Group option 
//	Fixed by	: 	Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID 	: 	TECH-28263
//	Date		: 	16-Nov-2018
//	Description	: 	Aviation Call Ref: AHBG-25998 / AHBG-26009 - Tab Task is triggered every time after screen init
//	Fixed by	: 	Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-16459
//	Date		: 16-Nov-2018
//	Description	: Label - Display Only Control Not middle aligned
//	Fixed by	: Sampathkumar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-16075
//	Date		: 16-Nov-2018
//	Description	: Focus on Grid Row No Field
//	Fixed by	: Sampathkumar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-25958
//	Date		: 16-Nov-2018
//	Description	: Context Menu
//	Fixed by	: Sampathkumar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28318
//	Date		: 20-Nov-2018
//	Description	: While selecting value in list edit control it doesn't works
//	Fixed by	: Siva Sankar S
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID 	: TECH-28266
//	Date		: 19-Nov-2018
//	Description	: Aviation Call Ref: AHBG-26080 - Combo - Invalid Values
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-27745
//	Date		: 19-Nov-2018
//	Description	: Aviation Call Ref: AHBG-26071 / AHBG-26123 - Extra Scroll visible in Tab Control
//	Fixed by	: Satham Hussain J
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28159 / TECH-26959 / TECH-28311 / XIP-516 / TECH-28336 / IMU-237 / TECH-28210 / TECH-28230 / TECH-28385
//	Date		: 19-Nov-2018
//	Description	: Miltiline sort - Incorrect Sort option passed in request / Multiline sort not working as expected / 
// 				  Request exception when launching UI when tab click and data list exist in the UI / 
// 				  Exception while launching iEDK activity from Activity Search / 
// 				  Exception while launching default activity if default activity is iEDK screen
//	Fixed by	: Sampathkumar M / Giridharan V
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////	
//  Defect ID	: TECH-28304
//	Date		: 21-Nov-2018
//	Description	: Handling Grouping for number control 
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28474
//	Date		: 22-Nov-2018
//	Description	: Forgot pwd link enabling for native users in ldap login 
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-25592
//	Date		: 23-Nov-2018
//	Description	: Template option not working in FHI DEV server (HUB version) 
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28355
//	Date		: 23-Nov-2018
//	Description	: In section layout in multiline when selecting the control type (scrolling the Up and down button in keyboard) its not selected .its goes next row in the multiline
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-25850
//	Date		: 23-Nov-2018
//	Description	: On Double Click of Tree, screen is going down
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28214
//	Date		: 26-Nov-2018
//	Description	: Masked value misbehaving when traversing to next page and comin back
//	Fixed by	: Giridharan V
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28315
//	Date		: 26-Nov-2018
//	Description	: Corosol Grid->movenext,next set is not working
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28641
//	Date		: 27-Nov-2018
//	Description	: Handling map TileUrl ,attribute based on settings
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28171
//	Date		: 27-Nov-2018
//	Description	: Handling layout issue  in border layout during collapse/expand
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28698 / KNB-184
//	Date		: 28-Nov-2018
//	Description	: Error message is wrong when deleting the image
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28704
//	Date		: 29-Nov-2018
//	Description	: Handling caption change for iedk control 
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28395
//	Date		: 30-Nov-2018
//	Description	: Exception while launching iEDK activity from wizard favourites 
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28119
//	Date		: 30-Nov-2018
//	Description	: Import functionality not required 
//	Fixed by	: Sampathkumar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: IMU-250 / TECH-28910
//	Date		: 04-Dec-2018
//	Description	: Handling grid navigation misbehavior when editable column was changed in unlocked grid
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28194
//	Date		: 3-Dec-2018
//	Description	: ML row values vanished on select of employment column
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28977
//	Date		: 4-Dec-2018
//	Description	: Multiple Issues Listed 
//					* ANZ-171 - PNB - remove the "Break(in Minutes)" column - Approve Timesheet
//					* ANZ-192 - PNB - Timesheet Approval and Rejection - junk data issue)
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28978
//	Date		: 5-Dec-2018
//	Description	: Session or URL replay error occurs on tab task
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29013
//	Date		: 6-Dec-2018
//	Description	: icons are showing different in extjs server
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29059 / UFS-517
//	Date		: 6-Dec-2018
//	Description	: Exception occurs when numeric data is being passed with purifytext option
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28711
//	Date		: 7-Dec-2018
//	Description	: Partner Call Ref: AHBG-24044. Tree Click Issue and Expanding Issue
//	Fixed by	: Prabhakaran. SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29121
//	Date		: 7-Dec-2018
//	Description	: Partner Call Ref: SFL-589 / KNB-186. Issue in Single User Mode while logging in with hub version
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28858 / TECH-28198 / TECH-28871 / TECH-28873 / TECH-28674 / AHBG-27183  / TECH-28636 / TECH-28276 / TECH-28364 / TECH-28365
// 				  TECH-28394 / TECH-29109 / TECH-28382
//	Date		: 07-Dec-2018
//	Description	: Move First - grid data page navigation not working after clicking insert button /  
// 				  Issue in grid pop up for individual records / 
//  			  In multiline zoom window - screen validation is not working properly / In multiline when zoom grid window is opened, 
// 				  no focus in first editable control
//				  In multiline not able to see records from first. But press the next page and prev page button able to see records from first.	
//				  Getting error 'Unable to get property 'docs' of undefined or null reference' while typing rule id / 
// 				  Data saving message should be based on response "dst" attribute / Data saving message not implemented for help and modal link Uis / 
// 				  Import excel not working in java environment / Context Switch not working in JAVA environment / 
// 				  Home page click not working in JAVA environment / Query string parameter RVWRTQS_COMPNAME should be changed to 
// 				  RVWRTQS_COMPONENT for remove personalization / Header preferences not working
//	Fixed by	: Sampath Kumar M / Giridharan V
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28696 / TECH-29031
//	Date		: 7-Dec-2018
//	Description	: Column Chooser column show/hide based on state.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29165
//	Date		: 10-Dec-2018
//	Description	: Displaying confirmation message on help transfer
//	Fixed by	: Giridharan V
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29269
//	Date		: 12-Dec-2018
//	Description	: Exeception handling for tooltip value obtained not  as template format in grid column
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29277
//	Date		: 12-Dec-2018
//	Description	: Handling tdAttributes from iedk json and appending to normal json
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: AHBG-27238 / AHBG-27164 / TECH-29232 / TECH-29211 / TECH-29204 / TECH- 29219 / TECH-29212 / TECH-29276 / TECH-29081 / TECH-29216
//	Date		: 11-Dec-2018
//	Description	: Typed value is taking for the UI task request after selecting value from the list edit / All headers in exported excel 
// 				  indicates mandatory field / Separate object variable declaration in RamcoRTC for JAVA to be combined with DNA / Data not 
// 				  binding for transfer from help screen / Event type is going for the request as "trans" instead of "link" for ML data 
// 				  hyperlink / Component value invalid for GetPageDetails call / Leaf level item in favorites menu showing as blank / 
// 				  Global Variable Declaration is moved from RTC to controller / Data value not passed for the request if "dt" attribute not 
// 				  available in response / true / false is getting passed for the request if "dt" attribute not available in response
//	Fixed by	: Giridharan V / Sampath M
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29248
//	Date		: 11-Dec-2018
//	Description	: Multiple Issues Listed
//					* Tree Click & Tree Expand 
//					* Boxtype -> 5 -- Width update 
//					* Messagebox - default width update
//	Fixed by	: Satham Hussain J / Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29230
//	Date		: 12-Dec-2018
//	Description	: The below points are not working in Hub version in Leaped UAT server.
//					1)	List Edit control left side width increasing 
//					2)	Combo UI length increasing 
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29265
//	Date		: 12-Dec-2018
//	Description	: List edit column width is not adjustable
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29356
//	Date		: 13-Dec-2018
//	Description	: XSS scripting issue
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29208
//	Date		: 14-Dec-2018
//	Description	: Image attach control autosize issue.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29410
//	Date		: 17-Dec-2018
//	Description	: Customized Buttons are missing and not visible in hub server(LEAPED)
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29396 / TECH-29395 / TECH-29276 / AHBG-26482 / TECH-29362 / AHBG-27323 / MPTU-204 / AHBG-25665 / TECH-28863 / TECH-28866
//	Date		: 14-Dec-2018
//	Description	: Message alert coming behind mask when performing "Cancel" from model window / Exception while selecting item from trailbar / 
// 				  Global Variable Declaration for Data Saving task & Multi Sort is moved from RTC to controller / 
// 				  Exception on click of "File Delete" / WorkArea Name should be defaulted while creating new workarea / 
// 				  Navigation buttons not displayed for tiles if the tile height is less than 40px / Option to individual navigation buttons 
// 				  for tiles should be enabled / If grid has multiple pages and on click of "+" icon from grid toolbar, cursor should focus 
// 				  first editable column of newly inserted row / "+" icon click on grid zoom window does not clear values / 
// 				  On data navigation inside grid zoom window, control values are not formatted as per user preferences
//	Fixed by	: Giridharan V
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29485
//	Date		: 18-Dec-2018
//	Description	: Partner Call Ref: ANZ-230 - Ticker header should not be visible if no scroller message is presented
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29453
//	Date		: 19-Dec-2018
//	Description	: Stack grid is not working in hub
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29515
//	Date		: 19-Dec-2018
//	Description	: Handling format for numeric column while Import Excel in Grid.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29463
//	Date		: 19-Dec-2018
//	Description	: Pagination to be handled in the drilldown ML grid from pivot grid.
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29531 / TECH-29466 / TECH-29394
//	Date		: 18-Dec-2018
//	Description	: Code optimization as per review / .jsp should be included for Grid Expand Call / Error message from response not displayed 
// 				  in screen if severity is "1"
//	Fixed by	: Giridharan V
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29577
//	Date		: 20-Dec-2018
//	Description	: List Edit - Toggle Between two columns not working in EXTJS6 Version
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29511
//	Date		: 21-Dec-2018
//	Description	: After Deploying iEDK Deliverables fail to load error raises in screen
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29358
//	Date		: 21-Dec-2018
//	Description	: In front end Data is not coming for Org Chart. but in back end data is coming	
//	Fixed by	: Sampathkumar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29710/ANZ-241
//	Date		: 24-Dec-2018
//	Description	: Empty check with HCols(Hidden Columns) value in epreference node	
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29761/QA-142
//	Date		: 26-Dec-2018
//	Description	: Handling list edit control changes while launching zoom grid	
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29763/TAQ-121
//	Date		: 26-Dec-2018
//	Description	: Changes in personalisation handled	
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29725
//	Date		: 26-Dec-2018
//	Description	: Combo getting blank while click a button	
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29739
//	Date		: 26-Dec-2018
//	Description	: print and download is not working in Rchart
//	Fixed by	: Sampathkumar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29813/LH-290
//	Date		: 26-Dec-2018
//	Description	: Handling Search Issue for tree column in RamcoRSTreeGrid
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29580
//	Date		: 28-Dec-2018
//	Description	: Handling Search Issue for date column in grid
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29870
//	Date		: 28-Dec-2018
//	Description	: Partner Call Ref AHBG-27567 - Report is not launching
//	Fixed by	: Prabhakaran. SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29544 / TECH-29799 / TECH-29816 / TECH-29809 / AHBG-27296 / TECH-28875 / TECH-29396 / TECH-29809
//	Date		: 28-Dec-2018
//	Description	: Copy / Cut Append shortcut key functionality swapped / URL to be changed for OLH - JAVA / Precision for header controls not 
// 				  setting if "dt" attribute not coming in response / In multiline row number is not updated, if zoom window is opened and row 
// 				  next/previous navigation is clicked / Row no mismatch in grid zoom window / Task type "help" not set when coming back from 
// 				  nested help screen / Confirmation message should be shown on "Organize Favourites" and Switch Contexts invokation
//	Fixed by	: Giridharan V / Sampath M
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29848
//	Date		: 31-Dec-2018
//	Description	: Error in Initiate Master Copy Screen
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29907
//	Date		: 31-Dec-2018
//	Description	: Making mask false on Grid Search if records retrieved.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29150
//	Date		: 02-Jan-2019
//	Description	: UDS Link screen not working in Hub version
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30014
//	Date		: 03-Jan-2019
//	Description	: Multiple Issues Listed
//					* Wizard - Missing HTML binding in Inbox grid 
// 					* Performing Grid Column Chooser along with Ilbo Personalization.
//                  * AHBG-27805 - reference id,Row number not displaying in IE. 
//	Fixed by	: Satham Hussain J / Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29378
//	Date		: 03-Jan-2019
//	Description	: Cards are not displayed in the vertical tile
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29724 / TECH-30051
//	Date		: 04-Jan-2019
//	Description	: Screen is hanged when we give values for any question and try to proceed further by clicking next button / Activity is getting struck when I update and delete
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29856 / TECH-29802 / TECH-29906
//	Date		: 04-Jan-2019
//	Description	: SwitchContexts Cancel not re-directing to homepage / Error message dialog window should display grid even for single 
// 				  message returned from response / "Undefined" error on click of "Show Report" from grid toolbar
//	Fixed by	: Giridharan V / Sampath M
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29873
//	Date		: 04-Jan-2019
//	Description	: Go to particular record in grid , Record size more than 100 (getting from buffer scenario),when i give last record no and// 
//                enter, dispatcher request is not firing	  
//	Fixed by	: Prabhakaran. SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30052
//	Date		: 08-Jan-2019
//	Description	: When we click Home screen from some other screen, screen information is still showing in the bottom banner.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30033
//	Date		: 08-Jan-2019
//	Description	: Multiline search is not working after moving to last set of records.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29986
//	Date		: 07-Jan-2019
//	Description	: Short cut for Export to CSV "Shift + P" not working and same short cut is mapped to Export to PDF.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30166
//	Date		: 08-Jan-2019
//	Description	: UDS Menu Getting duplicated in hub version EXTJ6
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30180
//	Date		: 08-Jan-2019
//	Description	: Showing error message on importing PDF in grid - Partner call ref: MPTU-132
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: QA-145 
//	Date		: 08-Jan-2019
//	Description	: Screen save alert message is displaying when closing the zoom grid window
//	Fixed by	: Sampath Kumar M 
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30054 
//	Date		: 09-Jan-2019
//	Description	: Launch Edit main information, scroll to page down without changing any data, Click "Maintain Kit information" link. 			
//				  System will throw error, click OK. Now screen is scrolled to top and pointer is focused on first editable control
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30053 
//	Date		: 09-Jan-2019
//	Description	: If any multiline column is sorted then pointer focus is changed to header control and screen si moved up. 
//				  This is happening in all mutiline.
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30183 
//	Date		: 09-Jan-2019
//	Description	: Home Page Redirection Problem In Organize Favorites ,Cancel Button Issue in Change Password ,
//				  During Login Change Password After Updating Password Change password Screen is Not Closed Automatically .
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30187 
//	Date		: 09-Jan-2019
//	Description	: If the user login the (example Screen Rolemaster) "rolemaster" screen & then tried to launch 
//				  "About Virtual Works" system throws Error " Cannot read property 'toLowerCase' of undefined"
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29806 
//	Date		: 09-Jan-2019
//	Description	: Take any help, select multiple records in help, system will throw error msg like select only one record while clicking OK, 
//				  help screen is automatically closed again take any help or press any button in main screen system throw error	
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30249 /JSL-350
//	Date		: 09-Jan-2019
//	Description	: Handling columnChooser show/hide based on settings
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30073
//	Date		: 09-Jan-2019
//	Description	: Datahyperlink is not displaying proper in grid
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29895
//	Date		: 09-Jan-2019
//	Description	: Select any part and go to Maintain planning information, Go down to multi line , add new line, 
//			      Click transfer processing location, go to help, select any value, 
//				  system transfer the value but pointer focus is changed to header and screen is scrolled up.
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30255
//	Date		: 09-Jan-2019
//	Description	: If any multiline column is copy appended, cut appended, then pointer focus is changed to header control 
//				  and screen si moved up. This is happening in all mutiline
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30101
//	Date		: 09-Jan-2019
//	Description	: Issue in Post back task
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29773
//	Date		: 09-Jan-2019
//	Description	: issue in ascending and descending icon in ml
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30188 
//	Date		: 10-Jan-2019
//	Description	: Insert row not working inside grid zoom window if there is only dummy row
//	Fixed by	: Sampath Kumar M 
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30165
//	Date		: 10-Jan-2019
//	Description	: OLH from any application help screen it still refers the old path
//	Fixed by	: Sampath Kumar M 
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30233
//	Date		: 11-Jan-2019
//	Description	: Handling InlineTab attribute for Tab Involved Screen -JAVA
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30308
//	Date		: 11-Jan-2019
//	Description	: Handling Theme related case sensitive for JAVA
//	Fixed by	: Siva Sankar S 
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30370
//	Date		: 17-Jan-2019
//	Description	: Issue after Success OK message
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30269
//	Date		: 17-Jan-2019
//	Description	: List edit not loading properly
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30098
//	Date		: 18-Jan-2019
//	Description	: alignment is not working out correctly
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30433
//	Date		: 18-Jan-2019
//	Description	: Multiple Issues have been listed
//					* Partner Ref Call: JAI–407
//					* Screen mask is being shown, on clicking cancel from switch context window. Partner Ref Call: PNU-162
//	Fixed by	: Prabhakaran SS / Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30280
//	Date		: 18-Jan-2019
//	Description	: values are getting vary from hub version to EXTUI version
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30335
//	Date		: 18-Jan-2019
//	Description	: Requisition for checking star rating
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30310
//	Date		: 22-Jan-2019
//	Description	: Display  message in status Bar based on preference
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30396
//	Date		: 22-Jan-2019
//	Description	: Error Messages are not Displaying with full details in show Error details Description Column . 
//				  Full ds value should be display in Show Error Details "Description Column"
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30391
//	Date		: 22-Jan-2019
//	Description	: data hyperlink in grid full view is not working
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30390
//	Date		: 22-Jan-2019
//	Description	: combo and display only values are not listed in the grid full view
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30364
//	Date		: 22-Jan-2019
//	Description	: Issue in combo when using tab
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30546
//	Date		: 22-Jan-2019
//	Description	: Multiple Issues Listed
//					* PNU-164 - Employee created via Onboarding/Export to HRMS - requires Employee Type
//					* QA-151 - Issue in ML Zoom in Create shift
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29849
//	Date		: 22-Jan-2019
//	Description	: ML zoom option behavior is not working properly in QiK screens
//	Fixed by	: Sampath Kumar M
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30301
//	Date		: 23-Jan-2019
//	Description	: Personalisation changes while Launching Help Window
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28715
//	Date		: 25-Jan-2019
//	Description	: MapMyIndia Implementation in Ext JS6
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-29970
//	Date		: 23-Jan-2019
//	Description	: Horizantal tile card refresh is not wroking if we out more than 6 cards.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30544
//	Date		: 24-Jan-2019
//	Description	: In iedk the extui is getting loaded properly but not in hub version
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30607
//	Date		: 24-Jan-2019
//	Description	: Sort is not working in extjs6
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30659
//	Date		: 25-Jan-2019
//	Description	: List Edit value not binding
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30196
//	Date		: 25-Jan-2019
//	Description	: scroll bar is coming full page in asset snapshot screen
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30688
//	Date		: 25-Jan-2019
//	Description	: Partner RefId - JAI-441
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30743
//	Date		: 28-Jan-2019
//	Description	: Error when i close Forced Activity
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30747
//	Date		: 28-Jan-2019
//	Description	: When clicking generate preview getting error as "internal server error" in HUB version
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30744
//	Date		: 29-Jan-2019
//	Description	: Changes for dispatcher call for JAVA Environment.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30729
//	Date		: 29-Jan-2019
//	Description	: Image width handling based on visibleLength for ramcoimage control.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28732
//	Date		: 31-Jan-2019
//	Description	: Dynamic RVW About Page in Ext JS6 .
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30817
//	Date		: 31-Jan-2019
//	Description	: List edit Value settings while using Keyboard Navigation.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-25040
//	Date		: 29-Jan-2019
//	Description	: Adding/Updating Report Icon Class based on Tech_icon.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30685
//	Date		: 31-Jan-2019
//	Description	: Enabling Hidden View Name for saveContenttoDb .
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30684
//	Date		: 29-Jan-2019
//	Description	: Expand Grid View Multi Line Help is Not Working
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30682
//	Date		: 29-Jan-2019
//	Description	: Expand Grid View Screen Refresh Not Working
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30629
//	Date		: 29-Jan-2019
//	Description	: Following Options are not Working In Full Grid View 1.After Inserting(+) the Value in Expand Grid it is Not Transferred 
//				  to the main Screen 2.Copy And Append (Also Copying 1st Row) It's Not Reflecting In Main Screen
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30667
//	Date		: 29-Jan-2019
//	Description	: Error in Initiate Master Copy Screen
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30718
//	Date		: 29-Jan-2019
//	Description	: Error in active tab setting in asset snapshot page launch and image size in HUB version
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30723
//	Date		: 29-Jan-2019
//	Description	: Generate preview was not working in hub version in new model server
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30745
//	Date		: 31-Jan-2019
//	Description	: The 'System Generated File ID' property is not working.
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30810
//	Date		: 31-Jan-2019
//	Description	: Hidden controls are not visible
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30598
//	Date		: 31-Jan-2019
//	Description	: Print for R-chart is not proper alignment
//	Fixed by	: Sampathkumar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30599
//	Date		: 31-Jan-2019
//	Description	: Download is not working for hierarchy code and zoom in zoom out also slowly working --Z landmark group
//	Fixed by	: Sampathkumar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30928
//	Date		: 01-Feb-2019
//	Description	: Ref ID - PRES-73	- Issue in Browse Organization Map (EXTJS6)
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30923
//	Date		: 01-Feb-2019
//	Description	: Next Question is not flowing in sub group
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30816
//	Date		: 01-Feb-2019
//	Description	: Issue to new work area
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30937
//	Date		: 01-Feb-2019
//	Description	: Change of Request For JAVA Environment for ExportPdf.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30979
//	Date		: 04-Feb-2019
//	Description	: Handling Dummy Task firing while deleting attachment in grid.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-30946
//	Date		: 05-Feb-2019
//	Description	: On selection of a combo control value in OBJ Template Screen– the focus is back to the first column in the grid.
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31092
//	Date		: 06-Feb-2019
//	Description	: Changes For Error Id and Source Description in alert Window.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31021
//	Date		: 07-Feb-2019
//	Description	: ilbo title dynamic - vw_rt_ilbo_title - issue
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31148
//	Date		: 07-Feb-2019
//	Description	: When using key board the ML page up and down values not reflecting correctly in ML
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31176
//	Date		: 12-Feb-2019
//	Description	: Multiple Issues Listed
//					* TWP-52 - Freeze count issue
//					* Timer issue on long running scripts (Screen expires while an action executes for a long time)
//					* CDIH-95 - Refresh screen leads to Hub window
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31138 - TECH-28976
//	Date		: 12-Feb-2019
//	Description	: Issue in xoriant uat single sign on
//				  URL is changing in Active Directory in Americana Live server
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31365	
//	Date		: 14-Feb-2019
//	Description	: Sync List edit is not working
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31363
//	Date		: 14-Feb-2019
//	Description	: Synchronized List Edit is not Working
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31353
//	Date		: 14-Feb-2019
//	Description	: Multiline grid search is not working if we give any value in the search and search with All & with column name
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31141
//	Date		: 14-Feb-2019
//	Description	: Landmark Login page - User name default value to be renamed as Employee ID
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31387
//	Date		: 15-Feb-2019
//	Description	: list edit is not getting loaded in hub version
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31371
//	Date		: 15-Feb-2019
//	Description	: Getting Error while selecting Sorting option in MultiLine control
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31449
//	Date		: 18-Feb-2019
//	Description	: Can not view scroll bar in the screen
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31313 / TECH-31324
//	Date		: 18-Feb-2019
//	Description	: While click on submit button , grouping column refreshes,please check / Error in new gen workflow
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31386
//	Date		: 18-Feb-2019
//	Description	: Multiline Search filter combo not showing complete data, user need to use both vertical scroll and horizontal scroll
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28714
//	Date		: 19-Feb-2019
//	Description	: Restricting No of Work area based on configuration parameter Ext JS6
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-28716
//	Date		: 19-Feb-2019
//	Description	: Alternate Visualization for Work Area in Ext JS6
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31556
//	Date		: 20-Feb-2019
//	Description	: Multiple Issues Listed
//					* Wizard - Inbox count to be displayed as 0 instead of empty for zero value
//					* Chart - Should be displayed properly when purifyText option is set
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31607
//	Date		: 21-Feb-2019
//	Description	: Session or Url Replayed when on Enter Task fired Combo in grid zoom.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31606
//	Date		: 21-Feb-2019
//	Description	: Changes for ilbo level help 
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31705
//	Date		: 25-Feb-2019
//	Description	: Mutliple Issues  in Zoom Window 
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31663
//	Date		: 25-Feb-2019
//	Description	: vertical sub group tile card refresh is not working
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31669
//	Date		: 25-Feb-2019
//	Description	: State handling is not working properly
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31711
//	Date		: 26-Feb-2019
//	Description	: Appending Header Personalisation Changes during Grid level Personlisation .
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31782
//	Date		: 27-Feb-2019
//	Description	: Show Chart Not Launching in IE for JAVA .
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31733
//	Date		: 26-Feb-2019
//	Description	: Home button is not visible on the wizard screen.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31776
//	Date		: 27-Feb-2019
//	Description	: XSS - Stored Cross Site Scripting in Show Report with import from CSV
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31812
//	Date		: 27-Feb-2019
//	Description	: Sort is not Working in Multiline for JAVA.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31799
//	Date		: 27-Feb-2019
//	Description	: DataGrid Not Visible.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31467
//	Date		: 28-Feb-2019
//	Description	: Error converting data type numeric to numeric
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31861
//	Date		: 28-Feb-2019
//	Description	: Increase POP UP size
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31870
//	Date		: 28-Feb-2019
//	Description	: Section name is not hiding through Chrysallis preferences
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31937
//	Date		: 28-Feb-2019
//	Description	: After applying latest CU 2.2 tech fixes Schedule planning EJS is not getting supported.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-31814
//	Date		: 04-Mar-2019
//	Description	: Button missing in front end
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32026
//	Date		: 05-Mar-2019
//	Description	: Userpreferences screen - preview is not working.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32027 / CSGH-146 
//	Date		: 05-Mar-2019
//	Description	: Launching Application in IE browser - Partner Ref. Call - CSGH-146 
//				  Both the Preference and Defaults Mode Buttons should be displayed on clicking either of it.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32072
//	Date		: 06-Mar-2019
//	Description	: Getting error while clicking recent activity.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32075
//	Date		: 06-Mar-2019
//	Description	: If we click move to last row option without any data in the multiline then some negative number appears in row no box. 
// 				  There is more space after row number box when we add some data after this. This is happening all multiline without data.   
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32076
//	Date		: 06-Mar-2019
//	Description	: While giving value as 0.00 for a field with bt hrsalary field input value passes as -915 in trace
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32067
//	Date		: 06-Mar-2019
//	Description	: Message Mapping is done in IEDK ,but message is not displayed in front end
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32073
//	Date		: 07-Mar-2019
//	Description	: Alert Message suppressing for Favorites and recent Activity when no value found
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32120 / TECH-32134
//	Date		: 07-Mar-2019
//	Description	: Checkbox and Radiobutton task is not getting executed
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32118
//	Date		: 07-Mar-2019
//	Description	: view status Popup UI is disappearing while clicking the Exception,Employee list link in it
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32102
//	Date		: 08-Mar-2019
//	Description	: Customized hub login page is not having LDAP COMBO
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32131
//	Date		: 08-Mar-2019
//	Description	: Tree Node is not getting Refreshed in Compensation Planning (EXTJS6) version
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32220
//	Date		: 11-Mar-2019
//	Description	: Handling Precision Issue in Grid
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32261
//	Date		: 12-Mar-2019
//	Description	: Ref - LH-364 - After click on save button manage department hierarchy screen becoming blank
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32314
//	Date		: 13-Mar-2019
//	Description	: In ExtJ6, Grid Columns images to be deployed in generic path.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32296
//	Date		: 13-Mar-2019
//	Description	: Error pops up when color is changed for header controls in email tab	
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32380
//	Date		: 15-Mar-2019
//	Description	: Attach document icon is not shown in grid - Partner Ref.Call - APSH-221
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32462
//	Date		: 19-Mar-2019
//	Description	: Issue on Enabling Check box in Grid Control
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32422
//	Date		: 19-Mar-2019
//	Description	: tree grid is not loading
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32419
//	Date		: 19-Mar-2019
//	Description	: Followup task to be fixed in hub version
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32556
//	Date		: 21-Mar-2019
//	Description	: ML values not passing as input
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32588
//	Date		: 22-Mar-2019
//	Description	: Multiple Issues Listed
//					* Tree grid -> Default column value (when template is null or blank) to be set as empty.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32503/CDIH-122
//	Date		: 22-Mar-2019
//	Description	: Handling chrysalis feature for segmented button
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32615 / PEPS-170
//	Date		: 25-Mar-2019
//	Description	: HUB- Custom report button vanishing after switching from work area
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32618
//	Date		: 26-Mar-2019
//	Description	: While clicking button no respond is showing in the HUB version
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32718
//	Date		: 26-Mar-2019
//	Description	: Multiple Issues Listed
//					* Setting default theme on clicking "Application Preferences" menu 
//					* Prevent Session or URL replay error, while clicking empty recent activities menu.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32563
//	Date		: 26-Mar-2019
//	Description	: formatting issue in define message screen
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32726
//	Date		: 27-Mar-2019
//	Description	: Enable / Disable HTML Validation for Text Controls
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32573
//	Date		: 27-Mar-2019
//	Description	: Focus is not present at the same column when attaching document
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32685
//	Date		: 28-Mar-2019
//	Description	: Hyper link is not working
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32778
//	Date		: 29-Mar-2019
//	Description	: Visible Lines on Tree Grid
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32817 / TECH-32371
//	Date		: 29-Mar-2019
//	Description	: Export Excel Issue when having Sync View List Edit Column
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32876
//	Date		: 01-Apr-2019
//	Description	: Multiple Issues Listed
//					* Exporting sync view columns as Excel - TECH-32371 
//					* Manage time Entry Screen -Leave type Column Unable to Sort - EES-1811
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32867
//	Date		: 01-Apr-2019
//	Description	: Unable to Launch Mapped UI while clicking Master Icons
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32925
//	Date		: 02-Apr-2019
//	Description	: TreeGrid is not loading while clicking on Exception icon for the first time in both Event and Time based UI
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32861
//	Date		: 02-Apr-2019
//	Description	: Facing Issue in View PO UDS Screen.
//	Fixed by	: Prabhakaran SS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32904
//	Date		: 03-Apr-2019
//	Description	: Not able to select & copy the error description in show details.
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32964
//	Date		: 03-Apr-2019
//	Description	: Grid column is not displaying in Column Chooser window - Partner Ref Call: PFP-60
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32884 
//	Date		: 03-Apr-2019
//	Description	: Handling Grid cell editor changes with  with respect to Arabic Language.
//	Fixed by	: Siva Sankar S
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32997
//	Date		: 04-Apr-2019
//	Description	: Multiple Issues Listed
//					* Unable to delete the attachment - IMU-374 
//					* Handling Personalization for Mandatory Controls' Error Message (Hub.core dll) - SDC-44
//					* Unable to save Column Chooser values - TAQ-369
//					* LDAP Description Issue
//					* Import Export issue - CSV file - LBC-445
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33025
//	Date		: 04-Apr-2019
//	Description	: URL problem-fix for payment Gateway portal
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32977
//	Date		: 08-Apr-2019
//	Description	: Home button is not visible in Wizard screen
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32942
//	Date		: 08-Apr-2019
//	Description	: Password field filled with * mark even the value is empty
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33131
//	Date		: 09-Apr-2019
//	Description	: Wizard Creation Error - Partner Ref Call: TAQ-381 / SEH-318
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33111
//	Date		: 09-Apr-2019
//	Description	: Column chooser not working in hub version while being hidden from ExtUI
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-32502
//	Date		: 09-Apr-2019
//	Description	: Home & Back Button behavior is working as same
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33231
//	Date		: 12-Apr-2019
//	Description	: Scroll is disabled after applying state for textarea controls
//	Fixed by	: Satham Hussain J
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: SAG-319 / TECH-33249
//	Date		: 12-Apr-2019
//	Description	: Incorrect symbols for Import/Export in hub version
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33212
//	Date		: 15-Apr-2019
//	Description	: Disabling Smart Hide while Personalisation
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33310
//	Date		: 16-Apr-2019
//	Description	: Facing Issue in View PO UDS Screen
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33164
//	Date		: 17-Apr-2019
//	Description	: Dataview selection with SP execution not working properly
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33327
//	Date		: 22-Apr-2019
//	Description	: Handling Grouping for Million Based numeric Value.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33507 /MPTP-208
//	Date		: 25-Apr-2019
//	Description	: Personal Journal: Color Rating Bar Issue.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33453
//	Date		: 24-Apr-2019
//	Description	: State enable is setted as 'n' though column is editable
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33523 / SDC-56
//	Date		: 25-Apr-2019
//	Description	: Header Personalization works improper on setting control as non-mandatory
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33537
//	Date		: 26-Apr-2019
//	Description	: Screen Print - New Feature
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33539
//	Date		: 26-Apr-2019
//	Description	: Disabling Dataview Navigation button when showing all data at a stretch
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33610 / PTPH-22
//	Date		: 29-Apr-2019
//	Description	: Wizard Creation Error
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33548
//	Date		: 29-Apr-2019
//	Description	: Combo data Overflowing the screen width issue
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33556
//	Date		: 30-Apr-2019
//	Description	: Session reactivation on empty page is not working
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33447 /MPTP-228
//	Date		: 02-May-2019
//	Description	: Unable to Login after password expired alert. 
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33621
//	Date		: 02-May-2019
//	Description	: Textarea value rendering on new line 
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33683
//	Date		: 02-May-2019
//	Description	: Image Rendering Problem Causing Slow Loading
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33765
//	Date		: 06-May-2019
//	Description	: On repeative click of approval history icon, pop-up sections height is getting reduced
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33843
//	Date		: 07-May-2019
//	Description	: Locking columns properly based on freeze count value
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33668
//	Date		: 07-May-2019
//	Description	: Handling align attribute  changes start and end for IE.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33774
//	Date		: 08-May-2019
//	Description	: Handling disabled behaviour for checkcolumn in grid.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33857
//	Date		: 08-May-2019
//	Description	: Non editable columns are editable in hub version when clicking Insert button
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33892 / HAY-51
//	Date		: 08-May-2019
//	Description	: Multiple Issues Listed
//					* Processing screen data based on runtime implementor value (avoiding security vulnerabiity) 
//					* Configurable search text length for activity search (actSearchCharLength)
//					* Showing error for typing ahead of any control on XSS Attack in Zoom Window
//					* JAVA - Handling for JSON and JSP extension files
//					* Grid header text alignment issues
//					* Skipping PI Node based state(show/hide) when control state is enabled.
//	Fixed by	: Satham Hussain J /Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33654
//	Date		: 10-May-2019
//	Description	: attachment control in ml , when clicked getting the error " This XML file does not appear to have any style information
//				  associated with it. The document tree is shown below."																		
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33960
//	Date		: 10-May-2019
//	Description	: Wizard - Filter Message Display and File Download
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34035 / HAY-51
//	Date		: 14-May-2019
//	Description	: Multiple Issues Listed
//					* JAVA - Handling for JSON and JSP extension files - TECH-34035
//					* Skipping PI Node based state(show/hide) when control state is enabled.
//	Fixed by	: Satham Hussain J / Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34009
//	Date		: 14-May-2019
//	Description	: JAVA - Report Launching
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33759 
//	Date		: 15-May-2019
//	Description	: Issue with Grid in Booking Request Management screen 
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34021 
//	Date		: 15-May-2019
//	Description	: Skipping of getSessionData call repeated times 
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-33701 
//	Date		: 17-May-2019
//	Description	: Handling Column Defaulting Changes  
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34108
//	Date		: 17-May-2019
//	Description	: Vertical tile paging is not working after applying RT fixes
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34168
//	Date		: 20-May-2019
//	Description	: Create Repair Order - > Bottom of the screen is launched instead of top of the screen
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34239/KBH-97
//	Date		: 20-May-2019
//	Description	: Handling zoom window based value change in grid
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34272
//	Date		: 21-May-2019
//	Description	: New Column Chooser Implementation
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34273
//	Date		: 17-May-2019
//	Description	: Multisort Data Persistence
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34237
//	Date		: 21-May-2019
//	Description	: Facing some issues in Qik Screen.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34281 / CSGH-274 / EP-409
//	Date		: 21-May-2019
//	Description	: Multiple Issues Listed
//				  	* Smart UI Not Launching Properly
//					* Wrong picture for an employee in RAMCO
//					* Issue in Dimension Pivot Report
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34198
//	Date		: 23-May-2019
//	Description	: Issue in Report Launching in grid.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34304
//	Date		: 23-May-2019
//	Description	: Focus issue while Using Grid Filter.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34390 /LH-417 /ANZ-318 
//	Date		: 24-May-2019
//	Description	: Multiple Issues Listed 
                   * LH-417 - ToolTip for link control
				   * ANZ-318 - Grid data showing incorrect row when screen navigation done .
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34379
//	Date		: 27-May-2019
//	Description	: Change of Request call for JAVA Environment.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34441
//	Date		: 27-May-2019
//	Description	: Handling prevention of login into application for invalid user.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34447
//	Date		: 29-May-2019
//	Description	: Issue in HUB Version For link launched from smart View
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34598
//	Date		: 30-May-2019
//	Description	: Issue in supplier snapshot
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34521
//	Date		: 31-May-2019
//	Description	: Max file size for attachment control given in model , but its not working in application screen
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34828
//	Date		: 31-May-2019
//	Description	: Data item focus missing in Horizontal tile in Qik_staging server
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34667
//	Date		: 04-Jun-2019
//	Description	: Rule Builder Implementation
//	Fixed by	: Giridharan V
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34623
//	Date		: 06-Jun-2019
//	Description	: Multi select combo option, caption not visible (hub version)
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34743
//	Date		: 10-Jun-2019
//	Description	: tree colour is getting changed in EXTUI but not in HUB
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34656
//	Date		: 13-Jun-2019
//	Description	: Handling Numeric Control Precision Value
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34885
//	Date		: 13-Jun-2019
//	Description	: On click of template column, grid rows getting reordered
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34886
//	Date		: 13-Jun-2019
//	Description	: Issue on launching Help-UI from Smart view Popup
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34475
//	Date		: 13-Jun-2019
//	Description	: When selecting chid tree one by one it automatically colour changed
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34862
//	Date		: 13-Jun-2019
//	Description	: Multiline show report option is not working
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34925 / MPTP-299
//	Date		: 14-Jun-2019
//	Description	: * Column Chooser Access Buttons are duplicated
//				  * Performance Journal Pop Up Issue	
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35081 /PTPH-41
//	Date		: 20-Jun-2019
//	Description	: Handling Defaulting(Template) for Tab Page
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35136
//	Date		: 20-Jun-2019
//	Description	: Multiple Issues Listed 
                   * IMU-435 - Whenever the user tried to open the weightage table in the Additional Attributes tab, an error occured.
				   * Applying Numerical Precision Failed for some cases
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35101
//	Date		: 21-Jun-2019
//	Description	: Handling Integer Datatype for Checkbox Controls
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-34101
//	Date		: 26-Jun-2019
//	Description	: "Multifile select" implementation in HUB
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35031
//	Date		: 26-Jun-2019
//	Description	: IE 11 Issue - > Multiline data blinks completely when we use first row, next row, last row options
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35056
//	Date		: 26-Jun-2019
//	Description	: Event not getting fired for Metalink
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35301
//	Date		: 27-Jun-2019
//	Description	: Multiple Issues Listed 
                   * LMH-200 - While launching Wizard Activity from Wizard Step Menu, the overflowing menu items should be grouped and collectively shown as a button menu.
				   * Settings based showing of no rows found display text (showNoRowsFoundText: true / false)
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35011
//	Date		: 27-Jun-2019
//	Description	: Unable to read the text clearly in Non Editable Text area , 
				  font colour appears to be greyed out
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35380
//	Date		: 28-Jun-2019
//	Description	: Handling OTP based task for hub version
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Date		: 27-Jun-2019
//	Description	: Rule Builder - Multi-select implementation
//	Fixed by	: Giridharan V
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35412
//	Date		: 01-Jul-2019
//	Description	: Dynamic CSS is not applied to the Image column
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35252
//	Date		: 21-Jun-2019
//	Description	: When SP returns Null value, Link column shows NULL instead of blank value in the grid
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35461
//	Date		: 02-Jul-2019
//	Description	: Multiple Issues Listed 
                   * Default Theme is not checked in themes menu on screen launch. 
				   * While clicking MenuMap / MenuTag in wizard component, masking option disappears before the data completely loads on the screen.
				   * EJS - Raw data parsing from hidden control
				   * Handling OTP based Task changes for hub screen.
//	Fixed by	: Satham Hussain J/Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35608
//	Date		: 08-Jul-2019
//	Description	: Selection option not working in ramcorstreegrid
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35534 / TECH-35642 / TECH-35619 / TECH-35651
//	Date		: 09-Jul-2019
//	Description	: Applying state with sequence order causing grid header misalignment
//	Fixed by	: Satham Hussain
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35756
//	Date		: 09-Jul-2019
//	Description	: Multiple Issues Listed 
                   * Department Hierarchy - entire child node is not getting pasted
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35877
//	Date		: 12-Jul-2019
//	Description	: Tree grid expand was not working in Manage cabin configuration for EXTJS 6.0                  
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35818
//	Date		: 12-Jul-2019
//	Description	: Search Criteria Section Missing in View Count/Recount Results Page in Stock Management
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35790
//	Date		: 12-Jul-2019
//	Description	: check box is not showing in the multi line
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35689
//	Date		: 12-Jul-2019
//	Description	: Select task sections controls are missing in review work executions and report actuals screen
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35683
//	Date		: 12-Jul-2019
//	Description	: Additional Details Section missing
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35619 / TECH-35707
//	Date		: 11-Jul-2019
//	Description	: Applying state with width causing grid header misalignment
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35909
//	Date		: 12-Jul-2019
//	Description	: Tree Expand not working in Initialize & Update Configuration screen
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35921 / TECH-35735 / HSI-480
//	Date		: 12-Jul-2019
//	Description	: Text Area value is not showing in wrapped form
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36008
//	Date		: 16-Jul-2019
//	Description	: While performing link action in a grid, current row value need to be passed in the request.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35955
//	Date		: 16-Jul-2019
//	Description	: Avoiding afteruserprocess method call from code, when any error is returned
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35611
//	Date		: 15-Jul-2019
//	Description	: Executing task on select of a date in date picker control
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35584
//	Date		: 15-Jul-2019
//	Description	: ML appears distorted in IE browser
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35659
//	Date		: 12-Jul-2019
//	Description	: Handling NULL value in link column
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36007
//	Date		: 16-Jul-2019
//	Description	: Approve button is not available in product structure screen(tech-35774)
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35928
//	Date		: 18-Jul-2019
//	Description	: State handling for grid columns while ordering it from personalization xml
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36142
//	Date		: 19-Jul-2019
//	Description	: Multiple Issues Listed 
                   * Status bar alignment issue. 
				   * Security component password reminder screen changes.
				  
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36199 /KNB-259
//	Date		: 23-Jul-2019
//	Description	: Handling chrysalis for ramcomaskfield control
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36388
//	Date		: 25-Jul-2019
//	Description	: Multiple Issues Listed
                   * Executing task on select of date picker in header and ML (Ref: TECH-35611)
				   * Reading Scroller Message XML from Non-tenant folder (TECH-36331)
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36193 / SEH-226
//	Date		: 24-Jul-2019
//	Description	: Enhancement Request - Provision to define starting day of the week
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36394
//	Date		: 24-Jul-2019
//	Description	: Population of Error description in tooltip while mouse hover over error remarks template
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36262
//	Date		: 24-Jul-2019
//	Description	: Image Delete option not enable in glance properties, please disable image delete option in glance UI
//	Fixed by	: Sampathkumar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36492
//	Date		: 01-Aug-2019
//	Description	: Bpc Menu Bar Issue -> Bpc name is coming as wrong in Menu Bar
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36491
//	Date		: 01-Aug-2019
//	Description	: sorted the multiline column in ascending order, now edited the document, screen is refreshed with old data without sorting 
//				  but sorting symbol still exists in multiline column.
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36481
//	Date		: 01-Aug-2019
//	Description	: Document Attachment - Multi File Upload - > Thumb view icon is not looking good . need to change
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36479
//	Date		: 01-Aug-2019
//	Description	: Document Attachment - If the single file / Multi file is uploaded then system message is not 
//				  prompting “ File Uploaded successfully”.
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36299	
//	Date		: 01-Aug-2019
//	Description	: Uploaded multiple files using Add file option and deleted the 2 files out of 5.
//				  Then the line items showing blank for line item 1.
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36063
//	Date		: 01-Aug-2019
//	Description	: Short cut Keys are Not Working In IE 11
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-35985
//	Date		: 01-Aug-2019
//	Description	: When we right click in screen task menu is displayed near cursor in chrome but 
//				  this is displayed on top of the screen in IE browser
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36636
//	Date		: 02-Aug-2019
//	Description	: Session or URL Replay error occurs on launching any screen after login
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36673
//	Date		: 07-Aug-2019
//	Description	: sorted the multiline column in ascending order, now edited the document, screen is refreshed with old data without 
//				  sorting, but sorting symbol still exists in multiline column.
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36887	
//	Date		: 14-Aug-2019
//	Description	: Possible Short Cut Keys are Required in Extjs6 Version
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36832
//	Date		: 14-Aug-2019
//	Description	: Grid to form not rendering properly
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36970 / LSTH-114
//	Date		: 14-Aug-2019
//	Description	: Multiple Issues
					1.Zoom window for aviation
					2(Column show/hide in grid when both pi and epi node available )
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36961
//	Date		: 14-Aug-2019
//	Description	: The data is fetching in the back-end but not displaying in the Front-end(Questionairre Control).
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36883
//	Date		: 14-Aug-2019
//	Description	: F2 ellipse window when launching from help not visible
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37062
//	Date		: 19-Aug-2019
//	Description	: Applying Blue Jay and Artic Blue themes, is not working
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37101 / PTP-133
//	Date		: 20-Aug-2019
//	Description	: Column Chooser Window is not shown while clicking the menu
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37120
//	Date		: 20-Aug-2019
//	Description	: Multiple Issues
					1. Applying Enterprise level personalization is not working properly - LSTH-114
					2. Wizard - Action Handling Error in Inbox grid --> Callout.js -- EWBH-58
					3. Handling Width for Column Personalization -- LSBE-27
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37042
//	Date		: 21-Aug-2019
//	Description	: Remove debug mode in launching url in extjs6 java environment
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36982
//	Date		: 21-Aug-2019
//	Description	: For Single And MultiFile Upload Json Generation is Needed
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-36935
//	Date		: 21-Aug-2019
//	Description	: Bpc Menu Bar Issue -> Bpc name is coming as wrong in Menu Bar
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37261
//	Date		: 26-Aug-2019
//	Description	: On select of leavetype combo in last row but its automatically going to 1st row
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37274
//	Date		: 27-Aug-2019
//	Description	: ERA>> CSS file is not loaded. Skipping CSS File existence check for JAVA
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37397 /KNB-298 / QA-254 /QA-255
//	Date		: 28-Aug-2019
//	Description	: Multiple Issues
					1. Hiding Quick Search Ilbo based on config value
					2. Handling isInplaceZoom attribute for zoom window(aviation).
					3. KNB-298 - Personalisation Icon not visible Issue
					4. QA-254 - ZoomWindow add not Working.
					5. QA-255 - ZoomWindow is shown as shrink
					6. Maintaining error state on performing UI tasks
					7. Avoiding scroll over Multiline Chart
//	Fixed by	: Satham Hussain J/Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37478
//	Date		: 04-Sep-2019
//	Description	: Launching Crystal Report in same window causing problem
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37768
//	Date		: 06-Sep-2019
//	Description	: Removing attachment while doing copy / cut - append
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37822
//	Date		: 09-Sep-2019
//	Description	: Error text in the bottom status bar is shown misaligned
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37671
//	Date		: 10-Sep-2019
//	Description	: here maps not working in EXTJS6
//	Fixed by	: Siva Sankar
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37874
//	Date		: 11-Sep-2019
//	Description	: Change Request For IEDK Model Screen
//	Fixed by	: Siva Sankar
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37935 /LH-471
//	Date		: 12-Sep-2019
//	Description	: Handling Date Field showing as NaN
//	Fixed by	: Siva Sankar
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37523
//	Date		: 11-Sep-2019
//	Description	: Hays : Wizard traversal issue
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37794
//	Date		: 12-Sep-2019
//	Description	: Alternate Short Cut Keys are Required in Extjs6 Version
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37917 /TECH-37889
//	Date		: 12-Sep-2019
//	Description	: Hyper links in screens are not working while clicking second time
//	Fixed by	: Satham Hussain J/Siva Sankar
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37897
//	Date		: 16-Sep-2019
//	Description	: List Edit combo has to be double clicked to get values loaded
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37776
//	Date		: 16-Sep-2019
//	Description	: On selection of Group code in Applicable Employee Group - Group code and Group Desc is not coming as input parameter
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38020
//	Date		: 17-Sep-2019
//	Description	: Screen is getting blank after launching smartview once and launching another UI.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38034 / TECH-38059
//	Date		: 17-Sep-2019
//	Description	: Getting error as "'panelTitle' is undefined" while show report option is clicked in export option in the Grid.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38022
//	Date		: 18-Sep-2019
//	Description	: ML save Firing issue
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38013
//	Date		: 17-Sep-2019
//	Description	: In check box column Select all option is required in Select Employee screen.   
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38101 / PTP-183
//	Date		: 17-Sep-2019
//	Description	: Column length adjustment not getting saved on Save Personalization in hub version
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37832
//	Date		: 18-Sep-2019
//	Description	: a integer column is allowing decimal values 
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38075
//	Date		: 19-Sep-2019
//	Description	: Alternate Short Cut Key is Required For Cancel the task and screen goes back to previous screen
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38150
//	Date		: 19-Sep-2019
//	Description	: Couldn't hide delete button in attachement column
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38146
//	Date		: 19-Sep-2019
//	Description	: Multi line columns alignment mismatch with value fields
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38124
//	Date		: 19-Sep-2019
//	Description	: In grid level column numbers are displayed in certain position.Which is working in extui and not working extj6
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38258
//	Date		: 20-Sep-2019
//	Description	: Active Wizard Tab is not shown
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38234
//	Date		: 24-Sep-2019
//	Description	: Import excel - once import is clicked show message like in-progress or show loading progress . 
//				  User clicked import button multiple time during import,system does not import data
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38176
//	Date		: 24-Sep-2019
//	Description	: List Edit combo has to be double clicked to get values loaded for iedk columns. For normal columns it is working fine
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38395
//	Date		: 25-Sep-2019
//	Description	: Alignment Issue when label has Visible length '0'
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38435
//	Date		: 26-Sep-2019
//	Description	: Wizard Component Changes
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38081
//	Date		: 26-Sep-2019
//	Description	: Not able to select and drag the parameters in Nextgen Workflow
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38195 / TECH-38215
//	Date		: 27-Sep-2019
//	Description	: Personalization on Multiple tasks
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38726/ TECH-38522
//	Date		: 08-Oct-2019
//	Description	: Multiple Issues
					1. While clicking Search button in help on file screen search is not working.
					2. Handling "session or URL replayed" while clicking  refresh in ezeewizard screen.
					3. Issue in Ezeewizard screen when launching any acitivity and clicking back button
					   screen not navigating back to ezeewizard screen.
					4. Neplais Calendar
					5. Multiline Chart
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38699 / TECH-38690
//	Date		: 08-Oct-2019
//	Description	: Multiple scroll available for Initial Workscoping tab in ExtJS6.0
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38611
//	Date		: 08-Oct-2019
//	Description	: timesheet entry screen no need scrollbar but its displaying
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38856
//	Date		: 11-Oct-2019
//	Description	: Favourites screen is not launching after coming back from some other screen using the home icon
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38482
//	Date		: 15-Oct-2019
//	Description	: When I select the ‘select all’ option in the grid, the focus moves on to the top which leads the user getting confused on where the
                  current focus is.
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38754
//	Date		: 15-Oct-2019
//	Description	: Initial workscoping tab Due list section collapse in right side
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38989
//	Date		: 15-Oct-2019
//	Description	: Multiple Issues 
					1. Adding custom callout on validateEdit
					2. Multiline Chart - Resize and Multi Series Chart
					4. Delete operation is not working in Wizard-Inbox - APSH-350
//	Fixed by	: Satham Hussain J / Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-37260
//	Date		: 15-Oct-2019
//	Description	: In a display only tree grid mode flag value wrongly passed as "y" instead of "z"
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38997
//	Date		: 16-Oct-2019
//	Description	: Image and text need to be added in Home page
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39043
//	Date		: 16-Oct-2019
//	Description	: New window option required for EXTUIJS6 - Base Migration ERP
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39009
//	Date		: 16-Oct-2019
//	Description	: Wizard TabTask Not Firing for Inbox
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39037
//	Date		: 18-Oct-2019
//	Description	: Default theme should be displayed after login in Extjs 6.7
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39090 / TECH-39140 / TECH-39207 / TECH-39241 / TECH-39242
//	Date		: 21-Oct-2019
//	Description	: Date picker's 'select' event is called on screen launch
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39192
//	Date		: 21-Oct-2019
//	Description	: Multiple Issues Listed
					* Workarea - Child Link screen switching always maintains the old menu in the BPC and Component items. - Ref: IHH-516
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39027
//	Date		: 21-Oct-2019
//	Description	: Expand Grid - export options are not working in extjs6.7
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39039
//	Date		: 23-Oct-2019
//	Description	: Hide the “Favorites” icon from the “Title Bar” in Extjs 6.7 Version
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39243
//	Date		: 23-Oct-2019
//	Description	: Default Focus in IE
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39330
//	Date		: 25-Oct-2019
//	Description	: I haved designed one template column in grid but when i download the excel that column also coming.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39155
//	Date		: 25-Oct-2019
//	Description	: Error while clicking back button from the help window
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39424
//	Date		: 29-Oct-2019
//	Description	: Multiple Issues Listed
					* ILBO Toolbar is not hiding while clicking Home button (which has blank page)
					* After the timeout of the session, an exception occurs as a message.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39334
//	Date		: 29-Oct-2019
//	Description	: Blank is added when we copy and paste from multiline data
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39290
//	Date		: 30-Oct-2019
//	Description	: Change Request For Print Icon
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-38986
//	Date		: 30-Oct-2019
//	Description	: Combo loading with horizontal scroll bar in IE (Internet Explorer). 
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39120
//	Date		: 30-Oct-2019
//	Description	: When creating the Stock transfer, "warehouse#" control  was not fetch in screen refresh 
//	Fixed by	: Siva Sankar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39497
//	Date		: 04-Nov-2019
//	Description	: Image Column in Grid is not showing properly
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39573
//	Date		: 05-Nov-2019
//	Description	: Screen validation is not shown in the bottom Page error's section
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39603
//	Date		: 05-Nov-2019
//	Description	: Getting error when click reactivate timer in home screen
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39575
//	Date		: 05-Nov-2019
//	Description	: In schedule planning while doing copy shift an unwanted service getting fired
//	Fixed by	: Sampathkumar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39488
//	Date		: 06-Nov-2019
//	Description	: Smart search is not getting enabled after code generation
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39636
//	Date		: 06-Nov-2019
//	Description	: Tab title is overlapped,If tree grid was in expanded view in Extjs 6.7
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39427
//	Date		: 08-Nov-2019
//	Description	: Hidden Columns Specified in Multiline are visible in column choser
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39926
//	Date		: 11-Nov-2019
//	Description	: Multiple Issues Listed
					* Column default window was not shown properly. Ref: BIPH-69
					* New Feature For Rowcls and Column Blur and Focus Event
//	Fixed by	: Satham Hussain J / Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39953
//	Date		: 12-Nov-2019
//	Description	: Column captions are not enabling but column controls are enabling
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39940
//	Date		: 12-Nov-2019
//	Description	: Document Attachment is not working on first time upload in IE browser.
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39402
//	Date		: 12-Nov-2019
//	Description	: Popup launches even if the link is not clicked
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39449
//	Date		: 13-Nov-2019
//	Description	: Data is not copied from text area to multiline editable data
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40001
//	Date		: 13-Nov-2019
//	Description	: In Request change in personal information have Carousal  grid  scroll not working.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40041
//	Date		: 14-Nov-2019
//	Description	: defaultZeroTimePadding in settings.json not working
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40020
//	Date		: 14-Nov-2019
//	Description	: Delete button should not be visible in the link in the Payslip screen of Employee's Home
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39599
//	Date		: 14-Nov-2019
//	Description	: Tree grid data's not coming properly in "View aircraft configuration " screen
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40068
//	Date		: 15-Nov-2019
//	Description	: Multiline Sorting options are not working in Expand Grid View
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40067
//	Date		: 18-Nov-2019
//	Description	: After closing the modal window, the screen mask is not hiding in Wizard - Create Wizard
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39980
//	Date		: 18-Nov-2019
//	Description	: In Legacy state when some controls hidden in that sections and while hidden in state white spaces coming
//				  if smart hide is enabled.
//	Fixed by	: Sampathkumar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40121
//	Date		: 18-Nov-2019
//	Description	: In resource details screen, fetch details is not working
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39879
//	Date		: 18-Nov-2019
//	Description	: F2 for display only ellipse doesn't load fully
//	Fixed by	: P Keertana
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40145
//	Date		: 18-Nov-2019
//	Description	: Tool tip text shows as "Add favorites" for the activity menu in Extjs 6.7
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39454
//	Date		: 20-Nov-2019
//	Description	: Success message display in the bottom task bar
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39835
//	Date		: 20-Nov-2019
//	Description	: Insert/Delete tree node option need to be removed in expanded view
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39837
//	Date		: 20-Nov-2019
//	Description	: Search option does not highlight the tree node
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40238
//	Date		: 20-Nov-2019
//	Description	: When clicking child node in tree grid ,cursor goes top of the tree grid
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40161
//	Date		: 26-Nov-2019
//	Description	: on click of track response link "Cannot convert undefined or null to object" error thrown in hub
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40080
//	Date		: 22-Nov-2019
//	Description	: Input values not passed correctly to the SP
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40133
//	Date		: 25-Nov-2019
//	Description	: Export/Import Excel shows the error message when opening the downloaded Excel
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40247
//	Date		: 26-Nov-2019
//	Description	: Show report option in the grid is not working
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40504
//	Date		: 26-Nov-2019
//	Description	: Launching activity as a UI - Inline Report
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40243
//	Date		: 26-Nov-2019
//	Description	: values not passing from screen in Dcube
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39807
//	Date		: 27-Nov-2019
//	Description	: Help icon in the multiline grid moves during mouse over action
//	Fixed by	: P Keertana
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40278
//	Date		: 28-Nov-2019
//	Description	: No import button in the manage compensation-bulk
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40581
//	Date		: 28-Nov-2019
//	Description	: Enable/disable control using control attribute not working in Defaulting Dialogue box in Hub Version
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40634
//	Date		: 28-Nov-2019
//	Description	: Personalization option is not available in Modal Window
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40632
//	Date		: 28-Nov-2019
//	Description	: Remove component wise css calling Request in Extui 6.7
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40327
//	Date		: 02-Dec-2019
//	Description	: While no records found in grid search over a modal / help window, the message window is shown behind that.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40738
//	Date		: 02-Dec-2019
//	Description	: Screen validation error during login
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40742
//	Date		: 03-Dec-2019
//	Description	: Collaborator pop up not launching
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40320
//	Date		: 03-Dec-2019
//	Description	: Time picker value is not shown properly if entered in 12 AM format
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40768 / TECH-39617
//	Date		: 03-Dec-2019
//	Description	: BPC Menu scrolls at inverse direction when moving from extreme bottom or top
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40769
//	Date		: 03-Dec-2019
//	Description	: Change Request For Print Icon
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40734
//	Date		: 05-Dec-2019
//	Description	: Label name was not displayed on Ellipse header
//	Fixed by	: P Keertana
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40830 / RGSH-288
//	Date		: 05-Dec-2019
//	Description	: Grid lock columns feature is not working as expected
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40879
//	Date		: 06-Dec-2019
//	Description	: List Edit is not expanding even after the data has been returned
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40851
//	Date		: 06-Dec-2019
//	Description	: Data copied with blank space from grid
//	Fixed by	: P Keertana
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41092
//	Date		: 12-Dec-2019
//	Description	: Not Able to launch the Help on screen from the Tree Grid
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40721
//	Date		: 12-Dec-2019
//	Description	: Bulk xml is not getting updated when input values are changed.
//	Fixed by	: Sampathkumar S
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40820
//	Date		: 10-Dec-2019
//	Description	: Hiding 'Columns' option in the Sorting Menu
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41138 / FEH-133
//	Date		: 12-Dec-2019
//	Description	: Need to show the labels hidden in state on Personalization Mode
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40911
//	Date		: 13-Dec-2019
//	Description	: "Unable to process please select atlease one record" error on clcik of update button
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40854
//	Date		: 13-Dec-2019
//	Description	: On Clicking Cancel from Session Time Out window, is not re-initializing the session time
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40576
//	Date		: 11-Dec-2019
//	Description	: Invalid data error in the grid
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41167
//	Date		: 13-Dec-2019
//	Description	: Multiple Issues Listed
					* Session Or URL replay on tab task. Ref: HBM-94
					* Removing client validation in login screen. Ref: HBM-93
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41209
//	Date		: 17-Dec-2019
//	Description	: List Edit is not displaying properly
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41247
//	Date		: 18-Dec-2019
//	Description	: Need to change description "ilboSwitchContext" into "Switch Context" in new application. Please refer the attached image.
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40530
//	Date		: 17-Dec-2019
//	Description	: After performing column default, some column values are vanished
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41158
//	Date		: 18-Dec-2019
//	Description	: Tree collapses on any actions
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41283
//	Date		: 19-Dec-2019
//	Description	: Meta Link is not launching correct Child Screen in Hub Version.
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41255
//	Date		: 19-Dec-2019
//	Description	: Handling HTML in the grid cell
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41350
//	Date		: 19-Dec-2019
//	Description	: Change Request For Screen Print URL
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41251
//	Date		: 19-Dec-2019
//	Description	: State is not working properly in Fixed Assets Hub.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-39589
//	Date		: 20-Dec-2019
//	Description	: Unable to set Wizard tab as default tab activity in the Wizard Component from Application Preferences
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41358
//	Date		: 20-Dec-2019
//	Description	: The spinner keeps running even after the success message is displayed.
//	Fixed by	: Prabhakaran SS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-41241
//	Date		: 20-Dec-2019
//	Description	: For the timer picker control user deletes displayed value but still the displayed value is been sent to the SP's
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//	Defect ID	: TECH-40912
//	Date		: 20-Dec-2019
//	Description	: Organisation chart should be converted from horizontal to vertical view.
//	Fixed by	: Satham Hussain J
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

*/
//=====================================================================================================================================================
// ** RTS ** //
//=====================================================================================================================================================

function RTS(){};
(function(){
	RTS.prototype = {
		osType:'DNA',
		osVersion:'2.0',
		isMobile:false,
		rtPath : '',
		dispatcher:'',
		extention:'',
		handlerExt:'',
		startUpPage : 'ilrt/Startup',
		menu : 'ilrt/GetMenu',
		menuSearch: 'ilrt/MenuSearch',
		about :'ilrt/rvw_about',
		ServiceExecutor :  'ilrt/serviceExecutor',
		LogoutPage : 'rvw_logout',
		GridExportUrl : '../ilrt/RVW_GridDataExport',
		JGridExportUrl : '../../../hub/app/classic/security/Exporttopdf',//TECH-30937
		GridHtmlUrl: 'ilrt/RVW_GridReport',	
		// JGridHtmlUrl: 'ilrt/RVW_GridReport.jsp', // TECH-29232
		GridPDFUrl :  'ilrt/ExportToPdf',
		PrintUrl :  'Print', // TECH-33537
		JGridPDFUrl : '../../../hub/app/classic/security/Exporttopdf',//TECH-30937
		UploadUrl: '../ilrt/RVW_UploadToDriveHandler',
		UploadDBUrl: '../ilrt/RVW_UploadToDBHandler',
		GridImportUrl: '../ilrt/RVW_GridDataImport',
		JGridImportUrl: './ilrt/RVW_GridDataImport.jsp', // TECH-28364
		GridImportCSVUrl: '../hub/ilrt/RVW_ImportExcel',
		drillDownUrl:'ilrt/SetDrillDownData',
		rvwAsync :"../ilrt/RVWAsyncCall",
		wizardFileDownload :"../ilrt/AvnDocImgDownloadHandler", // TECH-33960
		rvwGridData:"ilrt/GetGridData",
		plfUrl : "ilrt/plfdispatcher",
		plfProtoUrl: "ilrt/Proto_Interactions",
		udsLaunchUrl : "../edk/UDSLaunchDispatcher", // TECH-29150
		plfInboxCountUrl : "ilrt/plfInboxMessage",
		plfPersUrl:"ilrt/plfdispatcherpers",
		treeSearchUrl:"ilrt/RVW_TreeSearch",
		avnCustomActionUrl: "ilrt/AvnCustomActions",
		avnUploadUrl: "../ilrt/AvnDocImgUploadHandler.ashx",
		avnDownloadUrl: "../ilrt/AvnDocImgDownloadHandler",
		savePersUrl : "ilrt/PlfDispatcherPers",
		dwUrl : "HTML/dw_security_login_for_rvw",
		rvwBlank :'../hub/ilrt/RVW_Blank',//TECH-30052
		GridExportReportUrl :"ilrt/ProcessGridRequest",
		// JGridExportReportUrl :"ilrt/ProcessGridRequest.jsp", // TECH-29232
		PortalRTUrl :"",
		lastRequestId: null,
		busy:false,
		rQueue:[],
		initialize:function(osVersion,osType,isMobile){
			var me=this
				me.osType=osType,
				me.osVersion = osVersion,
				me.isMobile=isMobile,
				me.requestOptions = [];
				me.requestQueue={};
				
			if(osType == 'DNA'){
				if (me.osVersion == '2.0') {
					me.rtPath = '../ilrt';
					me.dispatcher = me.rtPath +'/dispatcher';
					me.rvwAsync = me.rtPath + '/RVWAsyncCall';
					me.UploadUrl = me.rtPath + '/RVW_UploadToDriveHandler';
				}
				else {
					me.rtPath = '../ilrt/0/htm';
					me.dispatcher = me.rtPath + '/dispatcher';
					me.UploadUrl = me.rtPath + '/RVW_UploadToDriveHandler';
				}
				me.portalRTUrl = '../portal/PortalRuntimeController';
				me.extention='aspx';
				me.handlerExt='ashx';
			}
			else{
				me.rtPath = '../ilrt';
				me.dispatcher = '../hub/app/classic/security/dispatcher';//TECH-30744
				me.rvwAsync = '../hub/ilrt/RVWAsyncCall'; // TECH-28382
				me.UploadUrl =  '../hub/ilrt/RVW_UploadToDriveHandler';//TECH-34379
				me.rvwGridData = '../hub/ilrt/GetGridData';
				me.extention='jsp';
				me.handlerExt = 'jsp';
			}
		},
		getStartUpPage:function(){
			return this.startUpPage + "." + this.extention;
		},
		getMenu:function(){
			return this.menu + "." + this.extention;
		},
		getDrillDownUrl:function(){
			return this.drillDownUrl + ".ashx" 
		},
		getAbout:function(){//TECH-28732
			if(!RamcoUtil.prototype.isEmpty(RamcoRTC.settings.defaultRVWAboutPage))
				return 'ilrt/' +RamcoRTC.settings.defaultRVWAboutPage +"." + this.extention;
			else
				return this.about + "." + this.extention;
		},
		getRvwBlank:function(){//TECH-30052
			return this.rvwBlank + "." + this.extention;
		},
		getAvnCustomActionUrl: function() {
			if(this.osType == 'DNA')
				return this.avnCustomActionUrl + "." + this.extention;
			else
				return this.avnCustomActionUrl;
		},
		getAvnUploadUrl: function() {
			return this.avnUploadUrl;
		},
		getAvnDownloadfileUrl: function() {			
			if(this.osType == 'DNA')
				return this.avnDownloadUrl + "." + this.extention;
			else
				return this.avnDownloadUrl;
		},
		getTreeSearchUrl: function() {			
			if(this.osType == 'DNA')
				return this.treeSearchUrl + "." + this.extention;
			else
				return this.treeSearchUrl;
		},
		getDispatcher:function(){
			if(this.osType == 'DNA')
				return this.dispatcher + "." + this.extention;
			else
				return this.dispatcher;
		},
		getGridImportUrl:function(){
			if(this.osType == 'DNA')
				return this.GridImportUrl + "." + this.extention;
			else
				return this.JGridImportUrl; // TECH-28364
		},
		getGridImportCSVUrl:function(){
			if(this.osType == 'DNA')
				return this.GridImportCSVUrl + "." + this.extention;
			else
				return this.GridImportCSVUrl;
		},
		getGridExportUrl:function(){
			if(this.osType == 'DNA')
				return this.GridExportUrl + "." + this.extention;
			else
				return this.GridExportUrl;
		},
		getGridHtmlUrl:function(){
			// TECH-29232
			/*if(this.osType == 'DNA')
				return this.GridHtmlUrl + "." + this.extention;
			else
				return this.GridHtmlUrl;*/
			return this.GridHtmlUrl + "." + this.extention;
		},
		getGridPDFUrl:function(){
			if(this.osType == 'DNA')
				return this.GridPDFUrl + "." + this.extention;
			else
				return this.GridPDFUrl;
		},
		// TECH-33537
		getPrintUrl:function(){
			if(this.osType == 'DNA')
				return this.PrintUrl + "." + this.extention;
			else if(this.osType == 'JAVA')//TECH-39290 
				//TECH-40769
				return this.JGridPDFUrl; // TECH-41350
				//return this.JGridPDFUrl + '.' + this.extention;
			else
				return this.PrintUrl;
		},
		getGridExportReportUrl:function(){
			// TECH-29232
			/*if(this.osType == 'DNA')
				return this.GridExportReportUrl + "." + this.extention;
			else
				return this.GridExportReportUrl;*/
			return this.GridExportReportUrl + "." + this.extention;
		},
		getAsyncUrl:function () {
			return this.rvwAsync + "." + this.extention;
		},
		// TECH-33960
		getWizardFileDownloadUrl:function () {
			return this.wizardFileDownload + "." + this.extention;
		},
		getGridDataUrl:function(){
			return this.rvwGridData + "." + this.handlerExt;
		},
		getPlfUrl:function () {
			return this.plfUrl + "." + this.extention;
		},
		getPlfProtoUrl: function() {
			return this.plfProtoUrl + "." + this.extention;
		},
		// TECH-29150
		getUdsLaunchUrl:function () {
			return this.udsLaunchUrl + "." + this.extention;
		},
		getPlfInboxCountUrl:function () {
			return this.plfInboxCountUrl + "." + this.extention;
		},
		getDwUrl:function (){
			return this.dwUrl + "." + this.extention;
		},
		getPlfPersUrl:function () {
			return this.plfPersUrl + "." + this.extention;
		},
		getSavePersUrl:function () {
			return this.savePersUrl + "." + this.extention;
		},
		getUploadUrl: function(){
			return  this.UploadUrl +  "." + this.handlerExt;
		},
		getUploadDBUrl: function(){
			return  this.UploadDBUrl +  "." + this.handlerExt;
		},
		getMenuSearchUrl: function(){
			return  this.menuSearch +  "." + this.extention;
		},
		request:function(options){
			var me=this,
				err=false,
				requestId = new Date().getTime(),
				xhr;				
			
			//me.xhr = xhr = me.getXhrInstance(me.xhr);
			options = options ||{};
			/* if(RamcoRTC.xhr && options.RTC != 'getmsgcount'){
				if(me.requestQueue[RamcoRTC.xhr])
					me.requestQueue[RamcoRTC.xhr].abort();
				delete RamcoRTC.xhr;
			} */
			if(!options.resolve){
				throw e;
				//return;
			}
			me.requestOptions.push(options);
			if(me.busy) {				
				return;
			}
			me.processQueue();

			/*if(options.params && options.params.RVWRTQS_REQID && me.lastRequestId == options.params.RVWRTQS_REQID)
				return;
			me.xhr = xhr = me.getXhrInstance(me.xhr);
			me.requestQueue[requestId] = xhr;
			me.requestOptions[requestId] = options;
			if(options.params && options.params.RVWRTQS_REQID)
				me.lastRequestId = options.params.RVWRTQS_REQID;
			if(options.payload ) //&& options.payload.length > 0)
				xhr.open('POST',options.url,true);
			else
				xhr.open('GET',options.url,true);
			var stateChange  = function(res){
				me.onStateChange.call(me,res,requestId);
			};
			xhr['onreadystatechange'] = stateChange;
			xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');
			if(!options.payload || options.payload == "")
				xhr.send();
			else{
				if(options.payloadType != 'form')
					xhr.setRequestHeader('Content-Type',me.getContentType(options.payloadType));
				xhr.send(options.payload);
			}
			if(options.RTC == 'getmsgcount')
				RamcoRTC.xhr = requestId;
			return requestId;
			*/			
			return requestId;
		},		
		processQueue: function() {
			var me = this,
				request,
				urlParams,
				xhr;
			if (me.requestOptions.length > 0) {
				options = me.requestOptions[0];
				if(options.params && Ext.isString(options.params.RVWRTQS_REQID)) {
					urlParams = options.url.split('?');					
					if(RamcoRTC.sessionToken != options.params.RVWRTQS_REQID) {
						options.params.RVWRTQS_REQID = RamcoRTC.sessionToken;
						options.url = getCreateURL(urlParams[0], options.params);
					}
				}
				RamcoLog.end('Client Trans');
				RamcoLog.start('Server Trans', options.url);
				me.xhr = xhr = me.getXhrInstance();
				//console.log("rest- " + new Date().getTime());
				//xhr['onreadystatechange'] = function () {};
				//xhr['onreadystatechange'] = function () {};
				 /* xhr.onreadystatechange =null; */
				 xhr.onreadystatechange = function () {
					if (xhr.readyState === 4) {
						RamcoLog.end('Server Trans');
						RamcoLog.start('Client Trans','response');
						//console.log("com- " + new Date().getTime());
						me.onComplete(xhr.response,"");
						me.busy = false;
						me.processQueue();
					}
				}
				if(options.payload)
					xhr.open('POST',options.url,true);
				else
					xhr.open('GET',options.url,true);
				/*var stateChange  = function(res){
					me.onStateChange.call(me,res,options);
				};
				xhr['onreadystatechange'] = stateChange;
				*/
				/* xhr.onreadystatechange = function () {
					if (xhr.readyState === 4) {
						RamcoLog.end('Server Trans');
						RamcoLog.start('Client Trans','response');
						//console.log("com- " + new Date().getTime());
						me.onComplete(xhr.response,"");
						me.busy = false;
						me.processQueue();
					}
				} */
				//xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');
				//console.log("rest-b-" + new Date().getTime());				
				if(!options.payload || options.payload == "") {					
					xhr.send(null);
				}
				else{
					if(options.payloadType != 'form')
						xhr.setRequestHeader('Content-Type',me.getContentType(options.payloadType));
					xhr.send(options.payload);
				}
				//console.log("rest-s-" + new Date().getTime());				
				me.busy = true;
			}
		},
		getContentType:function(type){
			var contentType = 'text/plain';
			switch(type.toLowerCase()){
				case 'xml' :
					contentType = 'application/xml';
					break;
				case 'json' :
					contentType = 'application/json';
					break;
				case 'form' :
					contentType = 'application/x-www-form-urlencoded';
					break;				
			}
			return contentType;
		},
		onStateChange:function(response,requestId){
			var me=this;
			//console.log("resp- " + new Date().getTime());
			if(response.currentTarget.readyState==4){
				//console.log("com- " + new Date().getTime());
				RamcoLog.end('Server Trans');
				RamcoLog.start('Client Trans','response');
				me.onComplete(response,requestId);
				me.busy = false;
				me.processQueue();
			}
		},
		onComplete:function(xhrResult,requestId){
			var me =this,
				failure = { success: false, isException: false },
				options = this.requestOptions.shift(),
				scope = options.scope,
				resolve = options.resolve,
				reject = options.reject,
				result, success, response;
			try {
				result = me.parseStatus(me.xhr.status);
            	if (result.success) {
                	result.success = me.xhr.readyState === 4;
				}
			}
			catch (e) {
				// In some browsers we can't access the status if the readyState is not 4,
				// so the request has failed
				result = failure;
			}
			
			success = me.success = me.isXdr ? xdrResult : result.success;

			if(success){
				response = me.createResponse(me.xhr,requestId);
				response.ErrFlag = me.xhr.getResponseHeader("RVWErrorFlag");
				response.ErrMsg = me.xhr.getResponseHeader("RVWErrorMsg");
				resolve.call(scope,response,options);
			}
			else{
				if (result.isException) {
					response = {status:0,statusText:'Error.'};
				}
				else {
					response = me.createResponse(me.xhr,requestId);
				}
				response.ErrFlag = me.xhr.getResponseHeader("RVWErrorFlag");			
				response.ErrMsg = me.xhr.getResponseHeader("RVWErrorMsg");			
				reject.call(scope,response,options);
			}
			//me.cleanup(requestId);
		},
		cleanup: function(requestId) {
			this.requestQueue[requestId] = null;
			this.requestOptions[requestId] = null;
			delete this.requestQueue[requestId];
			delete this.requestOptions[requestId];
		},
		parseStatus: function(status) {
            status = status == 1223 ? 204 : status;
			var success = (status >= 200 && status < 300) || status == 304,
                isException = false;
            if (!success) {
                switch (status) {
                    case 12002:
                    case 12029:
                    case 12030:
                    case 12031:
                    case 12152:
                    case 13030:
                        isException = true;
                        break;
                }
            }
            return {
                success: success,
                isException: isException
            };
        },
		createResponse: function(xhr,requestId) {
			var me = this,
				headers = {},
				lines = xhr.getAllResponseHeaders().replace(/\r\n/g, '\n').split('\n'),
				count = lines.length,
				line, index, key, response, byteArray;

			while (count--) {
				line = lines[count];
				index = line.indexOf(':');
				
				if (index >= 0) {
					key = line.substr(0, index).toLowerCase();
					
					if (line.charAt(index + 1) == ' ') {
						++index;
					}
					
					headers[key] = line.substr(index + 1);
				}
			}
			
			response = {
				requestId: requestId,
				status: xhr.status,
				statusText: xhr.statusText,
				getResponseHeader: function(header) {
					return headers[header.toLowerCase()];
				},
				getAllResponseHeaders: function() {
					return headers;
				}
			};

			if (me.binary) {
				response.responseBytes = me.getByteArray(xhr);
			}
			else {
				// an error is thrown when trying to access responseText or responseXML
				// on an xhr object with responseType of 'arraybuffer', so only attempt
				// to set these properties in the response if we're not dealing with
				// binary data
				response.responseText = xhr.responseText;
				response.responseXML = xhr.responseXML;
			}
			return response;
		},
		postMessages: function(options) {
		  var me = this;			  
		  if(options.url == "setInProc"){
			  me.hasRequestInProc = false;
		  }
		  else {
			 if(me.hasRequestInProc ) {
				me.postMessage([false, {
					ErrMsg : "Request already in progress.",
					ErrFlag : "true",
					requestId : options.requestId
				},options]);
			 }
			 else {
				me.fetch(options); 
			 }
		  }
		},
		fetch: function(options) {
			var me = this,
				xhr;
			xhr = me.getXhrInstance();
			xhr.requestId = options;
			hasRequestInProc = true;
			if (options && options.RTC == "getmsgcount")
			  hasRequestInProc = false;
			if (RamcoRTC.isGProto === true) {
				options.payload = null;
				options = me.buildGlanceURL(options);
			}
			if(options.payload)
				xhr.open('POST',options.url,true);
			else
				xhr.open('GET',options.url,true);
			xhr.onreadystatechange = function() {
				if (4 == this.readyState ) {
					me.onReadystatechange(this);
				}
			};
			//TECH-31937
			if(options.header){
				var header = Object.keys(options.header),
					i=0,
					len = header.length;
				for(;i<len;i++){
					xhr.setRequestHeader(header[i],options.header[header[i]]);
				}
			}			
			if(!options.payload || options.payload == "") {
				xhr.send(null);
			}
			else {
				if(options.payloadType != 'form')
					xhr.setRequestHeader('Content-Type',me.getContentType(options.payloadType));
				xhr.send(options.payload);
			}
		},
		onReadystatechange: function(xhrResult) {
			var me =this,
				options = xhrResult.requestId,
				failure = { success: false, isException: false },
				result, success, response;
			try {
				result = me.parseStatus(xhrResult.status);
				if (result.success) {
					result.success = xhrResult.readyState === 4;
				}
			}
			catch (e) {
				result = failure;	
			}
			
			success = result.success;

			if(success) {
				response = me.createResponse(xhrResult);
				response.ErrFlag = xhrResult.getResponseHeader("RVWErrorFlag");
				response.ErrMsg = xhrResult.getResponseHeader("RVWErrorMsg");
			}
			else{
				if (result.isException) {
					response = {status:0,statusText:'Error.'};
				}
				else {
					response = me.createResponse(xhrResult);
				}
				response.ErrFlag = xhrResult.getResponseHeader("RVWErrorFlag");			
				response.ErrMsg = xhrResult.getResponseHeader("RVWErrorMsg");			
			}
			response.requestId = options.requestId;
			//me.RWTMessage([success,response,options]);
			RamcoRTC.RWTMessage([success,response,options]);
		},		
		getXhrInstance: function(xhr) {
			if(!xhr){
				var options = [function() {
					return new XMLHttpRequest();
				}, function() {
					return new ActiveXObject('MSXML2.XMLHTTP.3.0');
				}, function() {
					return new ActiveXObject('MSXML2.XMLHTTP');
				}, function() {
					return new ActiveXObject('Microsoft.XMLHTTP');
				}], 
				i = 0,
				len = options.length,
				fn;			
				for (; i < len; ++i) {
					try {
						fn = options[i];
						xhr = fn.call();
						break;
					}
					catch(e) {}
				}
			}
			return xhr;
		},
		buildGlanceURL: function(options) {
			var me = this,
				strTaskName = null;
			if (options && options.params) {
				strTaskName = options.params.RVWRTQS_EVENTNAME;
			
				switch(strTaskName)
				{
					case "tskstdlaunch":
					case "tskstdrefresh":				
						options.url = "/app/classic/" + options.params.RVWRTQS_COMPONENT + "/" + options.params.RVWRTQS_ACTIVITY + "_" + options.params.RVWRTQS_ILBO + ".xml";
						break;
					case "tskstdscreeninit":				
						options.url = "/app/classic/" + options.params.RVWRTQS_COMPONENT + "/" + options.params.RVWRTQS_ACTIVITY + "_" + options.params.RVWRTQS_ILBO + "_tskstdscreeninit.xml";
						break;
					case "tskstdtabinit":
						options.url = "/app/classic/" + options.params.RVWRTQS_COMPONENT + "/" + options.params.RVWRTQS_ACTIVITY + "_" + options.params.RVWRTQS_ILBO + "_" + options.params.RVWRTQS_TAB + "_tskstdtabinit.xml";
						break;
					default:
						if (!Ext.isEmpty(options.params.RVWRTQS_COMPONENT) && !Ext.isEmpty(options.params.RVWRTQS_ACTIVITY) && !Ext.isEmpty(options.params.RVWRTQS_ILBO)) {
							options.url = "/app/classic/" + options.params.RVWRTQS_COMPONENT + "/" + options.params.RVWRTQS_ACTIVITY + "_" + options.params.RVWRTQS_ILBO + "_" + strTaskName + ".xml";
						}
						break;
				}
			}
			options.url += "?_dc=" + Date.now();
			return options;
		}
	};
})();

//==============================================================================
	// ** RTC ** //
//==============================================================================

function Reader() {

};

(function() {
    Reader.prototype = {
        prefs: [],
        osVersion: null,
        treeNodes: null,
        fileUrl: '',
        dbFileUrl: '',
		avnDownloadfileUrl:'',
        colKey: 0,
        rowKey: 0,
        dateDataTypes: ['date', 'date-time', 'time'],
        numDataTypes: ['float', 'double', 'numeric', 'int', 'integer', 'long'],
		uiCtrlArray: {},
        readXml: function(response, options) {
            var me = this,
                trpi, sysi, tbi, mi, sci, scri, tabi, trl, ci, lci, ctex, nci, ddt, stateContent, chartContent, statepart,tfi,ddtData, snbi,
                treeConent, treeData = {},
                i = 0,
                responseXML = null,
                len = 0,
                sc, cls, psi,
                tbiInFo, objTbiInFo, ii, taskName = options.params.RVWRTQS_EVENTNAME,
                st, views,
                epi, pi, tabs, tab, control, controls, cLen = 0,
                pers = {},
                epers = {},
                name, type, view, vws, vw, vseq, hcols, j = 0,
                k = 0,
                vwArr = {},
                chartData = {},
                pageData = {},
                ctrlState = {},
                ddtInfo = {},
				ctrl = null,
                infNode, rNode, snbiData = {};
            pageData.messages = [];            
            // XIP-516 / TECH-28336
			pageData.message = [];
            pageData.data = {};
            if (response) {
                try {
                    if (response.responseXML && response.responseXML.querySelector)
                        responseXML = response.responseXML;
                    if (Ramcoutil.isEmpty(responseXML) && !Ramcoutil.isEmpty(response.responseText)) {
                        responseXML = new DOMParser().parseFromString(response.responseText, 'text/xml');
                    }
                    if (responseXML) {
                        trpi = responseXML.querySelector('trpi');
                        if (trpi) {
                            if (trpi.hasAttribute('url') && taskName != 'tskstdtabupdate') {
                                pageData.URL = trpi.getAttribute('url');
                                pageData.LaunchMode = trpi.getAttribute('lm');
                                pageData.iEDK = trpi.getAttribute('iedk');
								pageData.PostHlpTask = trpi.getAttribute("posthlptsk");
                                if (pageData.URL.indexOf('trcaltcalmnedtptc') != -1)
                                    pageData.iEDK = '1';
								//TECH-30684
								if (trpi.hasAttribute('rid')) {
                                    pageData.sessionToken = trpi.getAttribute('rid');
                                }                                
                            }
							
							sysi = trpi.querySelector('sysi')
                            if (sysi) {
                                if (sysi.hasAttribute('rid')) {
                                    pageData.sessionToken = sysi.getAttribute('rid');
                                }
                                if (sysi.hasAttribute('sto')) {
                                    var sto = parseInt(sysi.getAttribute('sto'));
                                    if (sto) {
                                        pageData.sessionTimeOut = parseInt(sto / 60000);
                                    }
                                }
                            }
							
							if (!pageData.data.ci)
                                pageData.data.ci = {};
							
							pageData.data.ci['dbFileUrl'] = {
                                value: me.dbFileUrl,
                                st: pageData.sessionToken
                            };
                            pageData.data.ci['fileUrl'] = {
                                value: me.fileUrl,
                                st: pageData.sessionToken
                            };
							pageData.data.ci['avnDownloadfileUrl'] = {
                                value: me.avnDownloadfileUrl,
                                st: pageData.sessionToken
                            };
							
                            if (trpi.hasAttribute('msg')) {
                                var msg = trpi.getAttribute('msg'),
                                    objMsg = {};
                                objMsg['sr'] = null;
                                objMsg['sv'] = 5;
                                objMsg['cd'] = null;
                                objMsg['ds'] = msg;
                                objMsg['ca'] = null;
								objMsg['exp'] = null;
                                pageData.messages.push(objMsg);
								// XIP-516 / TECH-28336
                                if (pageData.message.length == 0)
            						pageData.message = pageData.messages;
                            }
							if(trpi.hasAttribute('forcedactivity_result')){
								if(trpi.getAttribute('forcedactivity_result'))
									pageData.data.forcedActivity = trpi.getAttribute('forcedactivity_result');
							}                            

                            mi = trpi.querySelector('mi');
                            if (mi && mi.childElementCount > 0) {
                                var msg, objMsg;
                                len = mi.childNodes.length;
                                i = 0;
                                for (; i < len; i++) {
                                    msg = mi.childNodes[i];
                                    if (msg.nodeType == 1) {
                                        objMsg = {};
                                        objMsg['sr'] = msg.getAttribute('sr');
                                        objMsg['sv'] = msg.getAttribute('sv');
                                        objMsg['cd'] = msg.getAttribute('cd');
                                        objMsg['ds'] = msg.getAttribute('ds');
                                        objMsg['ca'] = msg.getAttribute('ca');
										objMsg['exp'] = msg.getAttribute('exp');
                                        pageData.messages.push(objMsg);
										// XIP-516 / TECH-28336
                                        if (objMsg['sv'] == "5" || objMsg['sv'].toLowerCase() == "error" || objMsg['sv'].toLowerCase() == "stop") {
											pageData.message.push(objMsg);											
										}
                                    }
                                }
								// XIP-516 / TECH-28336
                                if (pageData.messages.length > 0 && pageData.message.length == 0) {
									//ANZ-217
									//pageData.message.push(objMsg[0]);
									pageData.message.push(pageData.messages[0]);
								}
                            }
							//TECH-35380
							tfi = trpi.querySelector('tfi');
							if (tfi) {
								pageData.data.tfi = {};
								pageData.data.tfi['desc'] =tfi.getAttribute('des');
								pageData.data.tfi['ttl'] = tfi.getAttribute('ttl');
								pageData.data.tfi['klen'] = parseInt(tfi.getAttribute('klen'));//TECH-35461
								pageData.data.tfi['otpTsk'] = [];
								var tsk = trpi.querySelectorAll('tsk'),tskNode,h = 0;
								if(tsk && tsk.length > 0 ){
									for( h = 0 ; h < tsk.length ; h++){
										tskNode = tsk[h];
										if(tskNode){
											pageData.data.tfi['otpTsk'].push(tskNode.getAttribute('n'));
										}
										
									}
								}
							}
							//TECH-36142
							pageData.data.taskName = taskName;
                            if (pageData.URL && pageData.URL.toLowerCase().indexOf('homepage_homepage') > 0)
                                return pageData;
                            tbi = trpi.querySelector('tbi');
                            if (tbi) {
                                trl = tbi.querySelectorAll('trl');
								pageData.trailBar = [];
                                if (trl.length > 1) {									
                                    len = trl.length - 1;
                                    i = 0;
                                    for (; i < len; i++) {
                                        tbiInFo = trl[i];
                                        if (tbiInFo.nodeType == 1) {
                                            objTbiInFo = {};
                                            objTbiInFo['an'] = tbiInFo.getAttribute('an');
                                            objTbiInFo['ic'] = tbiInFo.getAttribute('ic');
                                            objTbiInFo['text'] = tbiInFo.getAttribute('id');
                                            //objTbiInFo['itemId'] = tbiInFo.getAttribute('id');
											objTbiInFo['itemId'] = objTbiInFo['an'] + "_" + objTbiInFo['ic'] + "_" + (i);
                                            objTbiInFo['index'] = i;
                                            objTbiInFo['role'] = 'trailbar';
											objTbiInFo.group = 'trailbar';
											objTbiInFo.checked = false;
                                            pageData.trailBar.push(objTbiInFo);
                                        }
                                    }
                                }
                            }
							//TECH-36142
                           // pageData.data.taskName = taskName;
                            sci = trpi.querySelector('sci');
                            scri = trpi.querySelector('scri');
                            epi = trpi.querySelector('epi');
                            pi = trpi.querySelector('pi');
                            if (scri) {
								mi = scri.querySelector('mi');
								if (mi) {
									var objMsg;																																					
									if (mi.nodeType == 1) {
										objMsg = {};
										objMsg['sr'] = mi.getAttribute('sr');
										objMsg['sv'] = 5;
										objMsg['cd'] = mi.getAttribute('cd');
										objMsg['ds'] = mi.getAttribute('v');
										objMsg['ca'] = mi.getAttribute('ca');
										pageData.messages.push(objMsg);
										// XIP-516 / TECH-28336
										if (pageData.message.length == 0)
											pageData.message = pageData.messages;										
									}
								}
                                nci = scri.querySelector('nci');
                                snbi = scri.querySelector('snbi');
                                if (nci) {
                                    // Control State Processing
                                    stateContent = nci.querySelector('_statecontent_');
                                    if (stateContent) {
                                        if (osVersion == "2.0") {
                                            statepart = stateContent.querySelector("state");
                                        } else {
                                            statepart = stateContent.querySelector("statepart");
                                        }
                                        if (statepart) {
                                            var pageLst,
                                                pageNode,
                                                secLst,
                                                secNode,
                                                ctrlLst,
                                                ctrlNode,
                                                len = 0,
                                                i = 0;
                                            pageLst = statepart.querySelectorAll('page');
                                            secLst = statepart.querySelectorAll('section');
                                            ctrlLst = statepart.querySelectorAll('control');
                                            //Pages
                                            len = pageLst.length;
                                            i = 0;
                                            if (len > 0) {
                                                if (!ctrlState['pages'])
                                                    ctrlState['pages'] = [];
                                                for (; i < len; i++) {
                                                    pageNode = pageLst[i];
                                                    ctrlState['pages'].push(me.getPageAtt(pageNode));
                                                }
                                            }

                                            //Sections		
                                            len = secLst.length;
                                            i = 0;
                                            if (len > 0) {
                                                if (!ctrlState['sections'])
                                                    ctrlState['sections'] = [];
                                                for (; i < len; i++) {
                                                    secNode = secLst[i];
                                                    ctrlState['sections'].push(me.getSectionAtt(secNode));
                                                }
                                            }
                                            //Controls
                                            len = ctrlLst.length;
                                            i = 0;
                                            if (len > 0) {
                                                if (!ctrlState['controls'])
                                                    ctrlState['controls'] = [];
                                                for (; i < len; i++) {
                                                    ctrlNode = ctrlLst[i];
                                                    ctrlState['controls'].push(me.getControlAtt(ctrlNode));
                                                }
                                            }
                                        }
                                    }
                                    //Chart
                                    chartContent = nci.querySelectorAll('_chartcontent_ > graph');
                                    if (chartContent && chartContent.length > 0) {
                                        i = 0;
                                        len = chartContent.length;
                                        chartData = {};
                                        var sChartID = null,
                                            chartType = null,
                                            id = null,
                                            graph = null;
                                        for (; i < len; i++) {
                                            graph = chartContent[i];
                                            if (graph) {
                                                sChartID = graph.getAttribute("chart_id");
                                                chartType = graph.getAttribute("charttype") || 'column2d';
                                                xml = me.xml2String(graph);
                                                id = sChartID.toLowerCase();
                                                pageData.data.ci[id + '_chart'] = {
                                                    chartType: chartType,
                                                    value: xml
                                                };
                                            }
                                        }
                                        //pageData.data.ci = chartData;
                                    }
                                    //Tree
                                    treeConent = nci.querySelectorAll('_treecontent_ > tc');
                                    if (treeConent && treeConent.length > 0) {
                                        i = 0;
                                        len = treeConent.length;
                                        treeData = {};
                                        var sTreeID = null,
                                            children,
                                            tc = null,
                                            tnsNode = null,
                                            rootNode = null,
                                            treeId = null,
                                            root = {};
                                        for (; i < len; i++) {
                                            tc = treeConent[i];
                                            treeId = tc.getAttribute('id');
                                            tnsNode = tc.querySelector('tns');
                                            clear = tc.getAttribute('clear');
                                            rootNode = tnsNode.querySelector("tn[pid='Root']");
                                            me.treeNodes = tnsNode;
                                            if (rootNode && clear != 'n') {
												//TECH-30667
												//root = me.formTreeRoot(treeId, rootNode);			
												//children = me.formTreeData(treeId, root.itemId);
                                                root = me.formTreeRoot(treeId, rootNode, '1');
                                                children = me.formTreeData(treeId, root.itemId,'', "1");
                                                if (children && children.length > 0) {
                                                    root.children = children;
                                                } else {
                                                    delete root.expandable;
                                                    delete root.expanded;
                                                    root.leaf = true;
                                                }
                                                pageData.data.ci[treeId] = {
                                                    store: {
                                                        text: '',
                                                        expanded: true,
                                                        children: root
                                                    },
													value: {
														rData: root
                                                    }
                                                }
                                            } else if (clear == 'n') {
                                                root = me.renderTreeData(treeId, tnsNode);
                                                pageData.data.ci[treeId] = {
                                                    store: {
                                                        clear: 'n',
                                                        text: '',
                                                        expanded: true,
                                                        children: root
                                                    }
                                                }
                                            }
                                        }
                                        //pageData.data.ci = treeData;
                                    }
                                }
                                // DDT Data
                                ddtData = trpi.querySelectorAll('ddt > ddt');
                                if (ddtData && ddtData.length > 0) {
                                    i = 0;
                                    ddtData = ddtData[0];
                                    var uNode = null,
                                        tNode = null,
                                        cid = null,
                                        view = null,
                                        name = null,
                                        tObj = null,
                                        uObj = null;
                                    ddtInfo['task'] = {};
                                    ddtInfo['value'] = {};
                                    tNode = ddtData.querySelectorAll('t');
                                    uNode = ddtData.querySelectorAll('u');
                                    len = tNode.length;
                                    if (len > 0) {
                                        if (!ddtInfo['task'])
                                            ddtInfo['task'] = [];
                                        for (; i < len; i++) {
                                            tObj = tNode[i];
                                            ddtInfo["task"][tObj.getAttribute('n')] = {
                                                name: tObj.getAttribute('n'),
                                                ctrl: tObj.getAttribute('cid'),
                                                view: tObj.getAttribute('vn')
                                            }
                                        }
                                    }
                                    i = 0;
                                    len = uNode.length;
                                    if (len > 0) {
                                        if (!ddtInfo['value'])
                                            ddtInfo['value'] = [];
                                        for (; i < len; i++) {
                                            uObj = uNode[i];
                                            ddtInfo["value"][uObj.getAttribute('n')] = {
                                                name: uObj.getAttribute('n'),
                                                task: uObj.getAttribute('tn')
                                            }
                                        }
                                    }

                                }
                                ii = scri.querySelector('ii');
                                if (ii && ii.nodeType == 1) {
                                    pageData.data.tab = ii.getAttribute('at');
                                    if (ii.getAttribute('fc')) {
                                        var fc = ii.getAttribute('fc');
                                        if (fc) {
                                            RamcoRTC.focusCtrl = fc.split('$');
                                        }
                                    }
									//TECH-38482
									 if(ii.getAttribute('ihsp')){
										RamcoRTC.LastPageScrollX = parseInt(ii.getAttribute('ihsp'),10);
									}
									else if(RamcoRTC.LastPageScrollX || RamcoRTC.LastPageScrollX  === 0)
										delete RamcoRTC.LastPageScrollX;
									if(ii.getAttribute('ivsp')){
										RamcoRTC.LastPageScrollY = parseInt(ii.getAttribute('ivsp'),10);
									}
									else if(RamcoRTC.LastPageScrollY || RamcoRTC.LastPageScrollY === 0)
										delete RamcoRTC.LastPageScrollY;

									// TECH-28636
									if (ii.getAttribute('dst')) {
                                        var dst = ii.getAttribute('dst');
										// TECH-29276
										/*var workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
										
										if(!RamcoRTC.dstRequired[workArea])
											RamcoRTC.dstRequired[workArea] = [];
										
                                        if (dst)
                                            RamcoRTC.dstRequired[workArea][options.params.RVWRTQS_ILBO] = dst;
										else
											RamcoRTC.dstRequired[workArea][options.params.RVWRTQS_ILBO] = "1";*/
										
										if(dst)
											pageData.data.dst = dst;
										else
											pageData.data.dst = "1";
									}
                                } else {
                                    pageData.data.tab = '';
                                }
                                ci = scri.querySelector('ci');
                                if (ci && ci.childElementCount > 0) {
									if (taskName == 'tskstdscreeninit')
                                        me.ci = null;
                                    if (!pageData.data.ci)
                                        pageData.data.ci = {};
                                    me.updateControls(ci, pageData.data.ci, ctrlState, options);
                                    if (taskName == 'tskstdscreeninit') {
                                        me.ci = pageData.data.ci;
										if (Ramcoutil.isEmpty(me.uiCtrlArray[options.params.RVWRTQS_ILBO]))
											me.uiCtrlArray[options.params.RVWRTQS_ILBO] = pageData.data.ci;
									}
									//else if(taskName == 'tskstdtabinit' && me.ci[options.params.RVWRTQS_ILBO]) {
									else if(taskName == 'tskstdtabinit' && me.uiCtrlArray[options.params.RVWRTQS_ILBO]) {
										for(ctrl in pageData.data.ci){
											/*if(ctrl && pageData.data.ci[ctrl] && !me.ci.hasOwnProperty(ctrl))
												me.ci[options.params.RVWRTQS_ILBO][ctrl] = pageData.data.ci[ctrl];*/
											if(ctrl && pageData.data.ci[ctrl] && !me.uiCtrlArray[options.params.RVWRTQS_ILBO].hasOwnProperty(ctrl))
												me.uiCtrlArray[options.params.RVWRTQS_ILBO][ctrl] = pageData.data.ci[ctrl];
										}
									}
                                }
								ctex = scri.querySelector('controlextensions');
                                if (ctex && ctex.childElementCount > 0) {
									//var ctexcnode = ctex.querySelector('cd > c');
									var ctexcnode = ctex.querySelectorAll('cd > c');
									if (ctexcnode)
										pageData.data.ctex = ctexcnode;
								}
                                if (snbi) {
                                    infNode = snbi.querySelector('inf');
                                    rNode = infNode.querySelectorAll('r');
                                    snbiData.ci = infNode.getAttribute('ci');
                                    snbiData.noi = infNode.getAttribute('noi');
                                    snbiData.psz = infNode.getAttribute('psz');
                                    snbiData.psi = infNode.getAttribute('psi');
                                    snbiData.pei = infNode.getAttribute('pei');
                                    if (rNode && rNode.length > 0) {
                                        snbiData.data = {};
                                        psi = snbiData.psi;
                                        i = 0;
                                        for (; i < rNode.length; i++) {
                                            cls = (snbiData.ci == psi) ? 'x-active-item' : '';
											if (rNode[i].getAttribute('err')) {
												cls = "x-smartnav-ban";
											}
                                            snbiData.data[i] = {
                                                cls: cls,
                                                text: psi,
                                                tooltip: rNode[i].getAttribute('v')
                                            };
                                            psi++;
                                        }
                                    }
                                }
                            }
							//TECH-35380
							/* tfi = trpi.querySelector('tfi');
							if (tfi) {
								pageData.data.tfi = {};
								pageData.data.tfi['desc'] =tfi.getAttribute('des');
								pageData.data.tfi['ttl'] = tfi.getAttribute('ttl');
							} */
                            tabi = trpi.querySelector('tabi');
                            if (tabi) {
                                ci = tabi.querySelector('ci');
                                if (ci && ci.childElementCount > 0) {
                                    var tabCi = {};
                                    me.updateControls(ci, tabCi, ctrlState, options);
                                    pageData.data[tabi.getAttribute('n')] = tabCi;
                                    tabCi = null;
                                }
                            }
                            if (!Ramcoutil.isEmpty(options.params.RVWRTQS_TAB) && (taskName == 'tskstdscreeninit' || taskName == 'tskstdtabinit')) {
                                pageData.data.ActiveTab = this.activeTab;
                            }
                            if (scri) {
                                // Layout Control Information
                                lci = scri.querySelector('lci');
                                if (lci && lci.childElementCount > 0) {
                                    if (!ctrlState['lci'])
                                        ctrlState['lci'] = [];
                                    var tabNode, secNode, btnNode, lnkNode, i = 0,
                                        len = 0,
                                        tabEl, secEl, btnEl, tabs = [],
                                        secs = [],
                                        btns = [],
                                        lciState = {};
                                    tabNode = lci.querySelectorAll("tabs>c");
                                    secNode = lci.querySelectorAll("secs>c");
                                    btnNode = lci.querySelectorAll("buttons>c");
                                    lnkNode = lci.querySelectorAll("links>c");
                                    if (tabNode != null) {
                                        len = tabNode.length;
                                        if (len > 0) {
                                            if (!ctrlState['pages'])
                                                ctrlState['pages'] = [];
                                            i = 0;
                                            for (; i < len; i++) {
                                                tabEl = tabNode[i];
                                                ctrlState['pages'].push(me.getLCITabAtt(tabEl));
                                            }
                                        }
                                    }
                                    if (secNode != null) {
                                        i = 0;
                                        len = secNode.length;
                                        if (len > 0) {
                                            if (!ctrlState['sections'])
                                                ctrlState['sections'] = [];
                                            for (; i < len; i++) {
                                                secEl = secNode[i];
                                                ctrlState['sections'].push(me.getLCISecAtt(secEl));
                                            }
                                        }
                                    }
                                    if (btnNode != null) {
                                        i = 0;
                                        len = btnNode.length;
                                        if (len > 0) {
                                            if (!ctrlState['controls'])
                                                ctrlState['controls'] = [];
                                            for (; i < len; i++) {
                                                btnEl = btnNode[i];
                                                ctrlState['controls'].push(me.getLCIBtnAtt(btnEl));
                                            }
                                        }
                                    }
                                    if (lnkNode != null) {
                                        i = 0;
                                        len = lnkNode.length;
                                        if (len > 0) {
                                            if (!ctrlState['controls'])
                                                ctrlState['controls'] = [];
                                            for (; i < len; i++) {
                                                btnEl = lnkNode[i];
                                                ctrlState['controls'].push(me.getLCILnkAtt(btnEl));
                                            }
                                        }
                                    }
                                }
                            }
                            if (epi) {
                                tabs = epi.querySelectorAll('Tab');
                                if (tabs.length > 0) {
                                    len = tabs.length;
									i = 0;
									var ej = 0;
                                    for (; i < len; i++) {
                                        tab = tabs[i];
                                        if (tab.nodeType == 1) {
                                            controls = tab.querySelectorAll('Control');
                                            cLen = controls.length;
											j = 0;
                                             for (; ej < cLen; ej++) {
                                                control = controls[ej];
                                                if (control.nodeType == 1) {
                                                    name = control.getAttribute('Name').toLowerCase();
                                                    epers[name] = {};
                                                    type = control.getAttribute('Type');
                                                    epers[name]["ct"] = type;
                                                    if (type == 'RSGrid') {
														// TECH-31176
														if (!Ramcoutil.isEmpty(control.getAttribute('fc')))
															epers[name]["fc"] = control.getAttribute('fc');
														view = control.querySelectorAll('vw');
                                                        if (view.length > 0) {
                                                            vLen = view.length;
                                                            epers[name]['views'] = [];
															j = 0;
															for (; j < vLen; j++) {
																vw = view[j];
																if (vw.nodeType == 1) {
																	vwArr = {};
																	vwArr['id'] = 'v' + vw.getAttribute('n');
																	vwArr['width'] = vw.getAttribute('wi');
																	vwArr['text'] = vw.getAttribute('hdr');
																	vwArr['choose'] = vw.getAttribute('choosed');
																	if (vw.hasAttribute('coldefactive')) {
																		vwArr['coldefval'] = vw.getAttribute('coldefval');
																		vwArr['coldefactive'] = vw.getAttribute('coldefactive');
																	}
																	epers[name]['views'].push(vwArr);
																}
															}															
														}
														vseq = control.querySelectorAll('n');
														if (vseq.length > 0) {
															vLen = vseq.length;
															epers[name]['order'] = [];
															j = 0;
															for (; j < vLen; j++) {
																vw = vseq[j];
																if (vw.nodeType == 1) {
																	epers[name]['order'].push('v' + vw.textContent)
																}
															}
														}
														
														hcols = control.querySelectorAll('View');
														if (hcols.length > 0) {
															vLen = hcols.length;
															epers[name]['hcols'] = [];
															j = 0;
															for (; j < vLen; j++) {
																vw = hcols[j];
																if (vw.nodeType == 1) {
																	epers[name]['hcols'].push('v' + vw.getAttribute('Name'))
																}
															}
														}
														
                                                        /* view = control.querySelectorAll('View');
                                                        if (view.length > 0) {
                                                            vLen = view.length;
                                                            epers[name]['views'] = [];
															k = 0;
                                                            for (; k < vLen; k++) {
                                                                vw = view[k];
                                                                if (vw.nodeType == 1) {
                                                                    vwArr = {};
                                                                    vwArr['id'] = 'v' + vw.getAttribute('Name');
                                                                    vwArr['visible'] = 'n';
                                                                    vwArr['enable'] = 'y';
                                                                    epers[name]['views'].push(vwArr);
                                                                }
                                                            }
                                                        } */
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            if (pi) {
                                controls = pi.querySelectorAll('c');
                                if (controls.length > 0) {
                                    len = controls.length;
                                    i = 0;
                                    for (; i < len; i++) {
                                        control = controls[i];
                                        if (control.nodeType == 1) {
                                            name = control.getAttribute('n');
                                            pers[name] = {};
                                            type = control.getAttribute('ct');
											pers[name]["fc"] = control.getAttribute('fc') || 0;
                                            pers[name]["ct"] = type;
                                            if (type == 'RSGrid') {
												// TECH-31176
												if (!Ramcoutil.isEmpty(control.getAttribute('fc')))
													pers[name]["fc"] = control.getAttribute('fc');
                                                view = control.querySelectorAll('vw');
                                                if (view.length > 0) {
                                                    vLen = view.length;
                                                    pers[name]['views'] = [];
                                                    j = 0;
                                                    for (; j < vLen; j++) {
                                                        vw = view[j];
                                                        if (vw.nodeType == 1) {
                                                            vwArr = {};
                                                            vwArr['id'] = 'v' + vw.getAttribute('n');
                                                            vwArr['width'] = vw.getAttribute('wi');
                                                            vwArr['choose'] = vw.getAttribute('choosed');
                                                            if (vw.hasAttribute('coldefactive')) {
                                                                vwArr['coldefval'] = vw.getAttribute('coldefval');
                                                                vwArr['coldefactive'] = vw.getAttribute('coldefactive');
                                                            }
                                                            pers[name]['views'].push(vwArr);
                                                        }
                                                    }
                                                }
                                                vseq = control.querySelectorAll('n');
                                                if (vseq.length > 0) {
                                                    vLen = vseq.length;
                                                    pers[name]['order'] = [];
                                                    j = 0;
                                                    for (; j < vLen; j++) {
                                                        vw = vseq[j];
                                                        if (vw.nodeType == 1) {
                                                            pers[name]['order'].push('v' + vw.textContent)
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            if (ctrlState['pages'] || ctrlState['sections'] || ctrlState['controls']) {
                                pageData.states = ctrlState;
                            }
                            if (epers || pers) {
                                pageData.personalization = [epers, pers];
                            }
                            if (ddtInfo && ddtInfo['task']) {
                                pageData.ddt = ddtInfo;
                            }
                            if (snbiData && snbiData.data) {
                                pageData.snbiData = snbiData;
                            }                            
							if (sci) {
								var ct = sci.getAttribute("sc"),
									sp = sci.getAttribute("sp"),
									scol = "v" + sci.getAttribute("scol"),
									srr= parseInt(sci.getAttribute("srr"), 10);
									
								if(pageData.data.ci[ct]) {
									pageData.data.ci[ct].value.sci = {
										sp:sp,
										scol:scol,
										srr:srr
									};
								}
							} // TECH-28121
							else
							{
								if(taskName == "tskstdsearch")
								{
									var ctSearch;
									ctSearch = Object.keys(pageData.data.ci)[0];
									if(ctSearch) {
										pageData.data.ci[ctSearch].value.sci = {
												sp:'',
												scol:-999,
												srr:-999
										};
									}
								}
							}
                            						
                        } else {
                            objMsg = {};
                            objMsg['sr'] = '';
                            objMsg['sv'] = 5;
                            objMsg['cd'] = 'js:response:1';
                            objMsg['ds'] = 'Invaild response';
                            objMsg['ca'] = '';
                            pageData.messages.push(objMsg);
                        }
                    } else {
                        objMsg = {};
                        objMsg['sr'] = '';
                        objMsg['sv'] = 5;
                        objMsg['cd'] = 'js:response:2';
                        objMsg['ds'] = 'Invaild response';
                        objMsg['ca'] = '';
                        pageData.messages.push(objMsg);
                    }
                } catch (e) {
                    objMsg = {};
                    objMsg['sr'] = '';
                    objMsg['sv'] = 5;
                    objMsg['cd'] = 'js:response:3';
                    objMsg['ds'] = e.message;
                    objMsg['ca'] = '';
                    pageData.messages.push(objMsg);
                }
            } else {
                objMsg = {};
                objMsg['sr'] = '';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'js:response:2';
                objMsg['ds'] = 'Invalid response';
                objMsg['ca'] = '';
                pageData.messages.push(objMsg);
            }
			// XIP-516 / TECH-28336
            if (pageData.message.length == 0)
            	pageData.message = pageData.messages;
            return pageData;
        },
        readeJson: function(jsonResponse) {},
		readListXml: function(response, options) {
			var me = this,
                trpi, scri, ci, cNodeList, len, i = 0,
                cNode,
                pageData = {},
                responseXML = null;
            pageData.data = {};
			pageData.messages = [];
			// XIP-516 / TECH-28336
			pageData.message = [];
            if (response) {
                try {
                    if (response.responseXML)
                        responseXML = response.responseXML;
                    if (Ramcoutil.isEmpty(responseXML) && !Ramcoutil.isEmpty(response.responseText)) {
                        responseXML = new DOMParser().parseFromString(response.responseText, 'text/xml');
                    }
                    if (responseXML) {
                        trpi = responseXML.querySelector('trpi');
                        if (trpi) {
                            scri = trpi.querySelector('scri');
                            if (scri) {
                                ci = scri.querySelector('ci');
                                if (ci && ci.childElementCount > 0) {
                                    if (!pageData.data.ci)
                                        pageData.data.ci = {};
                                    cNodeList = ci.querySelectorAll('c');
                                    len = cNodeList.length;
                                    for (; i < len; i++) {
                                        cNode = cNodeList[i];
                                        pageData.data.ci[cNode.getAttribute('n')] = me.parseListXml(cNode);
                                    }
                                }
                            }
                        } else {
                            objMsg = {};
                            objMsg['sr'] = '';
                            objMsg['sv'] = 5;
                            objMsg['cd'] = 'js:response:1';
                            objMsg['ds'] = 'Invaild response';
                            objMsg['ca'] = '';
                            pageData.messages.push(objMsg);
                        }
                    } else {
                        objMsg = {};
                        objMsg['sr'] = '';
                        objMsg['sv'] = 5;
                        objMsg['cd'] = 'js:response:2';
                        objMsg['ds'] = 'Invaild response';
                        objMsg['ca'] = '';
                        pageData.messages.push(objMsg);
                    }
                } catch (e) {
                    objMsg = {};
                    objMsg['sr'] = '';
                    objMsg['sv'] = 5;
                    objMsg['cd'] = 'js:response:3';
                    objMsg['ds'] = e.message;
                    objMsg['ca'] = '';
                    pageData.messages.push(objMsg);
                }
            } else {
                objMsg = {};
                objMsg['sr'] = '';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'js:response:2';
                objMsg['ds'] = 'Invalid response';
                objMsg['ca'] = '';
                pageData.messages.push(objMsg);
            }
			// XIP-516 / TECH-28336
            if (pageData.message.length == 0)
            	pageData.message = pageData.messages;
            return pageData;
		},
		readTreeSearchXml: function(response, options) {
			var me = this,
                trpi, scri, ci, cNodeList, len, i = 0,
                cNode, treeSearchNode,
				responseData, treeNode,
				responseText,
                pageData = {},
                responseXML = null;
            pageData.data = {};
			pageData.messages = [];
			// XIP-516 / TECH-28336
			pageData.message = [];
            if (response) {
                try {
                    if (response.responseXML)
                        responseXML = response.responseXML;
                    if (Ramcoutil.isEmpty(responseXML)) {
                        responseXML = new DOMParser().parseFromString(response.responseText, 'text/xml');
                    }
                    if (responseXML) {
                        treeSearchNode = responseXML.querySelector("_treesearch_");
                        if (treeSearchNode && treeSearchNode.hasChildNodes()) {
							treeNode = treeSearchNode.querySelectorAll("node");
								if(treeNode.length > 0) {
									if (!pageData.data.searchNode)
										pageData.data.searchNode = {};
									if (!pageData.data.searchNode[options.params.treeid])
										pageData.data.searchNode[options.params.treeid] = [];
									len = treeNode.length;
									for (; i < len; i++) {
										cNode = treeNode[i];
										pageData.data.searchNode[options.params.treeid][i] = treeNode[i].attributes.getNamedItem("id").value;
									}
								}
								else {
									objMsg = {};
									objMsg['sr'] = '';
									objMsg['sv'] = 5;
									objMsg['cd'] = 'js:response:1';
									objMsg['ds'] = 'No matching records found ..';
									objMsg['ca'] = '';
									pageData.messages.push(objMsg);
								}	
                        } else {
                            objMsg = {};
                            objMsg['sr'] = '';
                            objMsg['sv'] = 5;
                            objMsg['cd'] = 'js:response:1';
                            objMsg['ds'] = 'No matching records found ..';
                            objMsg['ca'] = '';
                            pageData.messages.push(objMsg);
                        }
                    } else {
                        objMsg = {};
                        objMsg['sr'] = '';
                        objMsg['sv'] = 5;
                        objMsg['cd'] = 'js:response:2';
                        objMsg['ds'] = 'No matching records found ..';
                        objMsg['ca'] = '';
                        pageData.messages.push(objMsg);
                    }
                } catch (e) {
                    objMsg = {};
                    objMsg['sr'] = '';
                    objMsg['sv'] = 5;
                    objMsg['cd'] = 'js:response:3';
                    objMsg['ds'] = e.message;
                    objMsg['ca'] = '';
                    pageData.messages.push(objMsg);
                }
            } else {
                objMsg = {};
                objMsg['sr'] = '';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'js:response:2';
                objMsg['ds'] = 'No matching records found ..';
                objMsg['ca'] = '';
                pageData.messages.push(objMsg);
            }
			// XIP-516 / TECH-28336
            if (pageData.message.length == 0)
            	pageData.message = pageData.messages;
            return pageData;
		},
        readCustomListXml: function(response, options) {
            var me = this,
                trpi, scri, ci, cNodeList, len, i = 0,
                cNode,
				responseData,
				responseText,
                pageData = {},
                responseXML = null;
            pageData.data = {};
			pageData.messages = [];
			// XIP-516 / TECH-28336
			pageData.message = [];
            if (response) {
                try {
                    if (response.responseXML)
                        responseXML = response.responseXML;
                    if (Ramcoutil.isEmpty(responseXML) && !Ramcoutil.isEmpty(response.responseText)) {
                        responseData = response.responseText.split("~#~");
						pageData.sessionToken = responseData[0];
						responseText = responseData[1];
						if (responseText && responseText.indexOf("Thread was being aborted.") != -1)
							responseText = data.responseText.replace("Thread was being aborted.", "");
						if (responseText.indexOf("Invaild session") != -1) 
						{
							objMsg = {};
                            objMsg['sr'] = '';
                            objMsg['sv'] = 5;
                            objMsg['cd'] = 'js:response:1';
                            objMsg['ds'] = 'Invaild response';
                            objMsg['ca'] = '';
                            pageData.messages.push(objMsg);							
						}
						try 
						{
							if (responseText) {
								responseText = Ext.decode(responseText);
								pageData.data = responseText;
							}
						}
						catch (e) { 
							objMsg = {};
                            objMsg['sr'] = '';
                            objMsg['sv'] = 5;
                            objMsg['cd'] = 'js:response:1';
                            objMsg['ds'] = 'Invaild Data';
                            objMsg['ca'] = '';
                            pageData.messages.push(objMsg);
						}												
                    }
                } catch (e) {
                    objMsg = {};
                    objMsg['sr'] = '';
                    objMsg['sv'] = 5;
                    objMsg['cd'] = 'js:response:3';
                    objMsg['ds'] = e.message;
                    objMsg['ca'] = '';
                    pageData.messages.push(objMsg);
                }
            } else {
                objMsg = {};
                objMsg['sr'] = '';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'js:response:2';
                objMsg['ds'] = 'Invalid response';
                objMsg['ca'] = '';
                pageData.messages.push(objMsg);
            }
			// XIP-516 / TECH-28336
            if (pageData.message.length == 0)
            	pageData.message = pageData.messages;
            return pageData;
        },		
        readPersXml: function(responseXML, options) {
            var me = this,
                temps, temp, tempType, tempName, grids, grid, views, view, ctrls, ctrl, props, prop, ctrlId, viewId,layoutCctrls, name, i = 0,
                j = 0,
                k = 0,
				allroleschecked,
				alltaskschecked,
                pageData = {};
			// XIP-516 / TECH-28336	
			pageData.messages = [];
			pageData.message = [];
            try {
                if (!Ramcoutil.isEmpty(responseXML)) {
                    responseXML = new DOMParser().parseFromString(responseXML, 'text/xml');
                }
                if (responseXML) {
                    pageData.xml = responseXML;
                    temps = responseXML.querySelectorAll('Templates>Template');
                    if (temps) {
                        for (; i < temps.length; i++) {
                            temp = temps[i];
                            tempName = temp.getAttribute('name');
                            tempType = temp.getAttribute('type');
                            if (tempType == '2') {
                                if (typeof pageData[tempType] == "undefined")
                                    pageData[tempType] = {};
                                if (!pageData[tempType][tempName])
                                    pageData[tempType][tempName] = {};
                                conData = temp.querySelectorAll('Condition');
							
                                for (k = 0; k < conData.length; k++) {
                                    tempData = conData[k].querySelector('Eval');
                                    tempCond = conData[k].querySelector('TrueCond');
									allroleschecked = conData[k].getAttribute('allroleschecked');//TECH-29763/TAQ-121
									alltaskschecked = conData[k].getAttribute('alltaskschecked');
                                    setMsg = conData[k].getElementsByTagName('SetMessage');
                                    role = tempData.firstChild.data;
                                    roleCtrl = role.split('&&');
                                    if (roleCtrl && roleCtrl.length > 0) {
                                        persrole = roleCtrl[0].split('||');
										if(Ramcoutil.isEmpty(allroleschecked)|| allroleschecked == "false")//TECH-29763/TAQ-121
											ctrl = roleCtrl[1].split('#')[1].split('.')[0];
										else if(allroleschecked == "true")
											ctrl = roleCtrl[0].split('#')[1].split('.')[0];
										
									    if (typeof pageData[tempType][tempName][ctrl] == "undefined")
                                            pageData[tempType][tempName][ctrl] = {};
                                        if (persrole && persrole.length > 0 ) {//TECH-29763/TAQ-121
                                            if (typeof pageData[tempType][tempName][ctrl].roles == "undefined")
                                                pageData[tempType][tempName][ctrl].roles = {};
											if(allroleschecked == "true")
												pageData[tempType][tempName][ctrl]['allroles'] = true;
											else if(allroleschecked == "false" || Ramcoutil.isEmpty(allroleschecked))
												pageData[tempType][tempName][ctrl]['allroles'] = false;
											if(alltaskschecked == "true")
												pageData[tempType][tempName][ctrl]['alltasks'] = true;
											else if(alltaskschecked == "false" || Ramcoutil.isEmpty(alltaskschecked))
												pageData[tempType][tempName][ctrl]['alltasks'] = false;
                                            pageData[tempType][tempName][ctrl]['errormessage'] = setMsg[0].getAttribute('Desc');

                                            for (j = 0; j < persrole.length; j++) {
                                                roleVal = persrole[j].split('==');
												if (roleVal && roleVal.length > 1) {
													if (roleVal[1].indexOf(')') > -1) {
														lastVal = roleVal[1].split(')');
														roleData = lastVal[0].split('"')[1];
														pageData[tempType][tempName][ctrl].roles[roleData] = roleData;
													} else {
														roleData = roleVal[1].split('"')[1];
														pageData[tempType][tempName][ctrl].roles[roleData] = roleData;
													}	
												}                                                
                                            }
                                        }
                                    }
                                }
                                continue;
                            }

                            if (temp.nodeType == 1) {
                                pageData[tempName] = {};
                                pageData[tempName].type = tempType;
                                pageData[tempName].data = {};
                                grids = temp.querySelectorAll('Grid');
                                ctrls = temp.querySelectorAll('Control');
								layoutCctrls = temp.querySelectorAll('LayoutControl');
                                if (grids) {
                                    for (; j < grids.length; j++) {
                                        grid = grids[j];
                                        ctrlId = grid.getAttribute('name');
                                        pageData[tempName].data[ctrlId] = {};
                                        views = grid.querySelectorAll('View');
                                        if (views) {
                                            pageData[tempName].data[ctrlId]['type'] = 'grid';
                                            k = 0;//TECH-28696 / TECH-29031
                                            for (; k < views.length; k++) {
                                                view = views[k];
                                                viewId = view.getAttribute('name');
                                              //  prop = view.querySelector('SetProperty');
                                                prop = view.querySelectorAll('SetProperty');
											    if (prop && prop.length > 0){ // TECH-30014
													var gridColProp,gridColVal,viewVal;
													for(var n=0;n < prop.length;n++){
														gridColProp = prop[n].getAttribute('name');
														gridColVal = prop[n].getAttribute('value');
														viewVal = 'v' + viewId;
														if(typeof pageData[tempName].data[ctrlId][viewVal] == "undefined")
															pageData[tempName].data[ctrlId][viewVal] = {};
														pageData[tempName].data[ctrlId][viewVal][gridColProp] = gridColVal;
													}
													
												}
                                                    
                                            }
                                        }
                                    }
                                }
                                if (ctrls) {
                                    j = 0;
                                    for (; j < ctrls.length; j++) {
                                        ctrl = ctrls[j];
                                        ctrlId = ctrl.getAttribute('name');
                                        pageData[tempName].data[ctrlId] = {};
                                        props = ctrl.querySelectorAll('SetProperty');
                                        if (props) {
                                            k = 0;
                                            for (; k < props.length; k++) {
                                                prop = props[k];
                                                name = prop.getAttribute('name');
                                                pageData[tempName].data[ctrlId][name] = prop.getAttribute('value');
                                            }
                                        }
                                        props = ctrl.querySelectorAll('SetValue');
                                        if (props) {
                                            k = 0;
                                            for (; k < props.length; k++) {
                                                prop = props[k];
                                                pageData[tempName].data[ctrlId]['value'] = prop.textContent;
                                            }
                                        }
                                    }
                                }
								if (layoutCctrls) {
                                    j = 0;
                                    for (; j < layoutCctrls.length; j++) {
                                        ctrl = layoutCctrls[j];
                                        ctrlId = ctrl.getAttribute('name');
                                        pageData[tempName].data[ctrlId] = {};
                                        props = ctrl.querySelectorAll('SetProperty');
                                        if (props) {
                                            k = 0;
                                            for (; k < props.length; k++) {
                                                prop = props[k];
                                                name = prop.getAttribute('name');
                                                pageData[tempName].data[ctrlId][name] = prop.getAttribute('value');
                                            }
                                        }
                                        props = ctrl.querySelectorAll('SetValue');
                                        if (props) {
                                            k = 0;
                                            for (; k < props.length; k++) {
                                                prop = props[k];
                                                pageData[tempName].data[ctrlId]['value'] = prop.textContent;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    } else {
                        objMsg = {};
                        objMsg['sr'] = '';
                        objMsg['sv'] = 5;
                        objMsg['cd'] = 'js:response:1';
                        objMsg['ds'] = 'Invaild response';
                        objMsg['ca'] = '';
                        pageData.messages.push(objMsg);
                    }
                } else {
                    objMsg = {};
                    objMsg['sr'] = '';
                    objMsg['sv'] = 5;
                    objMsg['cd'] = 'js:response:2';
                    objMsg['ds'] = 'Invaild response';
                    objMsg['ca'] = '';
                    pageData.messages.push(objMsg);
                }
            } catch (e) {
                objMsg = {};
                objMsg['sr'] = '';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'js:response:3';
                objMsg['ds'] = e.message;
                objMsg['ca'] = '';
                pageData.messages.push(objMsg);
            }
			// XIP-516 / TECH-28336
            if (pageData.message.length == 0)
            	pageData.message = pageData.messages;
            return pageData;
        },
        parseListXml: function(node) {
            var me = this,
                data = {},
                format,
                control = {},
                rValue, ldNode, mdNode, viNode, vwNode, vwIdNode, ctrl, len = -1,
                i = 0,
                vwName, defaultValue, colId, colCss,
                j = 0,
                ldNodeLen = -1,
                csv, cse;
            data.name = node.getAttribute('n');
            data.value = {};
            ldNode = node.querySelector('ld');
			data.store = [];
            if (ldNode) {
                //data.store = [];
                ldNodeLen = ldNode.childNodes.length
                j = 0;
                for (; j < ldNodeLen; j++) {
                    rowNode = ldNode.childNodes[j];
                    row = {}
                    if (rowNode.nodeType == 1) {
                        row['rn'] = rowNode.getAttribute('no');
                        k = 0;
                        colNodeLen = rowNode.childNodes.length;
                        for (; k < colNodeLen; k++) {
                            colNode = rowNode.childNodes[k];
                            if (colNode.nodeType == 1) {
                                colId = colNode.getAttribute('n');
								// TECH-35921 / TECH-35735 / HSI-480
								//row[colId] = me.getRegExValue(colNode.getAttribute('v'));
								row[colId] = me.getRegExValue(colNode.getAttribute('v'), true);
								if(isNaN(data.value[colId]))
									data.value[colId] = 0;
								if(data.value[colId] <= row[colId].length) {
									data.value[colId] = row[colId].length;
								}
                            }
                        }
                        data.store.push(row);
                    }
                }
            }
            return data;
        },
        updateControls: function(ciNode, data, ctrlState, options) {
            var me = this,
                cNodeList,
                cNode,
                ldNode, ldNodeLen = 0,
                j = 0,
                ctrlData,
                rNode, rValue, k = 0,
                rowNode, colNode, row = {},
                rowNodeLen = 0,
                colNodeLen = 0,
                gridStore = null,
                colId = '',
                sc = '';
            cNodeList = ciNode.querySelectorAll('c');
            len = cNodeList.length;
            i = 0;
            for (; i < len; i++) {
                cNode = cNodeList[i];
                //ctrlData = me.ci ? me.ci[cNode.getAttribute('n')] : null;
				ctrlData = me.uiCtrlArray[options.params.RVWRTQS_ILBO] ? me.uiCtrlArray[options.params.RVWRTQS_ILBO][cNode.getAttribute('n')] : null;
                data[cNode.getAttribute('n')] = me.parseXml(cNode, ctrlState, ctrlData);
            }
        },
        parseXml: function(node, ctrlState, ctrlData) {
            var me = this,
                data = {},
                format,
                control = {}, mainRoot = {}, rootData = {}, rootNode,
                rValue, ldNode, mdNode, viNode, vwNodes, vwNode, fidNode,
                riNode, rNode, fNode, rlNode, clNode, coNode, coNodes, colNode, aggNode,
                vwIdNode, ctrl, len = -1, nd, ndLen,
                i = 0,
                vwName,
                defaultValue, colId, colCss, key,
                j = 0, rt = 0,
                ldNodeLen = -1,
				seq,
                csv, cse,scc,css,href,sbc, nodeCType, cap, addlProps = {},
				lvnsr = 0, j,
				cssSplitValue = [];
			//TECH-39926
            data.name = node.getAttribute('n');
            data.controlType = ctrlData ? ctrlData.controlType : node.getAttribute('ct');
            csv = node.getAttribute('sv');
            cse = node.getAttribute('se');
            scc = node.getAttribute('scc');
            css = node.getAttribute('css');
			href = node.getAttribute('href');
			sbc = node.getAttribute('sbc');
            if (!Ramcoutil.isEmpty(csv) || !Ramcoutil.isEmpty(cse) || !Ramcoutil.isEmpty(scc) || !Ramcoutil.isEmpty(css) || !Ramcoutil.isEmpty(href) || !Ramcoutil.isEmpty(sbc)) {
                control['id'] = data.name;
                if (!Ramcoutil.isEmpty(csv))
                    control['visible'] = csv;
                if (!Ramcoutil.isEmpty(cse))
                    control['enable'] = cse;
                if (!Ramcoutil.isEmpty(scc))
                    control['caption'] = scc;
                if (!Ramcoutil.isEmpty(css))
                    control['css'] = css;
				if (!Ramcoutil.isEmpty(href))
                    control['href'] = href;
				if (!Ramcoutil.isEmpty(sbc))
                    control['mandatory'] = sbc;
            }
			if (data.controlType == 'RSTreeGrid' || data.controlType == 'RSTree') {				
				data.value = {};
                data.value.si = parseInt(node.getAttribute('si'), 10) || 1;
				data.value.tr = parseInt(node.getAttribute('tr'), 10);
				data.value.hsp = node.getAttribute('hsp') || '';
                data.value.nsr = parseInt(node.getAttribute('nsr'), 10);				
                data.value.tic = parseInt(node.getAttribute('tic'), 10);                                
                data.value.vsi = parseInt(node.getAttribute('vsi'), 10) || 1;
				data.value.vsp = node.getAttribute('vsp') || '';
                mdNode = node.querySelector('md');
                if (mdNode) {
                    if (mdNode.hasAttribute('vr')) {
                        data.value.vr = parseInt(mdNode.getAttribute('vr'), 10);
                        data.value.zt = mdNode.getAttribute('zt');
                        viNode = mdNode.querySelector('vi');
                        var views = [], view = {},
                            sv, se;
                        if (viNode) {
                            data.value.meteXml = mdNode.xml;
                            len = viNode.childNodes.length;
                            if (len > 0) {
                                data.value.columns = [];
                                data.value.columnsValue = {};
                            }
                            i = 0;
                            for (; i < len; i++) {
                                vwNode = viNode.childNodes[i];
                                if (vwNode.nodeType == 1) {
                                    ctrl = {};
                                    view = {};                                    
                                    vwName = vwNode.getAttribute('n');
                                    ctrl['n'] = 'v' + vwName;
                                    ctrl['v'] = vwNode.getAttribute('v');
                                    ctrl['vt'] = vwNode.getAttribute('vt');
                                    ctrl['dt'] = vwNode.getAttribute('dt');
                                    ctrl['prec'] = vwNode.getAttribute('prec');
                                    ctrl['scc'] = vwNode.getAttribute('scc');
                                    sv = vwNode.getAttribute('sv');
                                    se = vwNode.getAttribute('se');
                                    if (!Ramcoutil.isEmpty(sv) || !Ramcoutil.isEmpty(se)) {
                                        view['id'] = ctrl['n'];
                                        view['visible'] = sv;
                                        view['enable'] = se;
                                        views.push(view);
                                    }
                                    ctrl['css'] = vwNode.getAttribute('css');
                                    if (ctrl['dt']) {
                                        format = '';
                                        if (me.dateDataTypes.indexOf(ctrl['dt']) > -1)
                                            format = me.getDateFormat(ctrl['dt'])
                                        else if (me.numDataTypes.indexOf(ctrl['dt']) > -1)
                                            format = me.getNumberFormat(ctrl['prec']);
                                        ctrl['ft'] = format;
                                    }
                                    if (ctrl['vt'] == 'combobox') {
                                        ldNode = vwNode.querySelector('ld');
                                        if (ldNode) {
                                            ctrl['store'] = [];
                                            ldNodeLen = ldNode.childNodes.length
                                            j = 0;
                                            for (; j < ldNodeLen; j++) {
                                                rNode = ldNode.childNodes[j];
                                                if (rNode.nodeType == 1) {
                                                    rValue = me.getRegExValue(rNode.getAttribute('v'));
                                                    ctrl['store'].push({
                                                        text: rValue,
                                                        value: rValue
                                                    });
                                                }
                                            }
                                        }
                                    }
                                    data.value.columnsValue[ctrl['n']] = ctrl;
                                    data.value.columns.push(ctrl['n']);
                                }
                            }
                        }
                        if (views.length > 0) {
                            control['id'] = data.name;
                            control['views'] = views;
                        }
                    }
                }
				var columnValue = null;
				if (data && data.value && data.value.columnsValue) {
					columnValue = data.value.columnsValue;
				}
				if (data && data.value && Ext.isEmpty(data.value.columnsValue)) {
					if (ctrlData && ctrlData.value && ctrlData.value.columnsValue) {
						columnValue = ctrlData.value.columnsValue;
					}
				}
				data.store = [];				
				ldNode = node.querySelector('id');				
				if(ldNode) {
					rootNode = ldNode.getElementsByTagName("tn")[0];					
					if (ldNode.hasAttribute('pnid')) {
						data.value.pnid = ldNode.getAttribute('pnid');
					}
				}				
				if(ldNode.hasChildNodes()) {
					var chilen = ldNode.childNodes.length;
					var c = 0;
					var hasTN=false;
					mainRoot = {};
					mainRoot['rn'] = "0";
					mainRoot['in'] = "0";
					mainRoot['lvl'] = "0";
					mainRoot['sel'] = false;
					mainRoot['hc'] = "1";
					mainRoot['ex'] = "0";
					mainRoot['expanded'] = true;
					mainRoot['nid'] = "";
					mainRoot.children=[];
					for (; c < chilen; c++) {
						chNode = ldNode.childNodes[c];
						if (chNode.nodeType == 1 && chNode.nodeName == "tn") {							
						 	hasTN=false;
						 	rootNode ={};
							if(chNode.hasAttributes()) {
								rootNode['rn'] = chNode.getAttribute('rn');
								rootNode['in'] = chNode.getAttribute('in');
								rootNode['lvl'] = chNode.getAttribute('lvl');
								rootNode['sel'] = parseInt(chNode.getAttribute('sel')) == 0 ? false : true;
								rootNode['hc'] = chNode.getAttribute('hc');
								rootNode['ex'] = chNode.getAttribute('ex');
								rootNode['nid'] = chNode.getAttribute('nid');
								rootNode['pnid'] = chNode.getAttribute('pnid');
								//rootNode.expanded = false;
								rootNode.leaf = true;
								if(parseInt(rootNode['ex']) == 1)
									rootNode.expanded = true;
								if(parseInt(rootNode['hc']) == 1)
									rootNode.leaf = false;
								if (data.controlType == 'RSTree' && chNode.getAttribute('sel')) {
									rootNode.checked = (chNode.getAttribute('sel') == "1") ? true : false;
								}
								/*
								if(parseInt(rootNode['hc']) == 1) {									
									rootNode.expanded = false;
									if(parseInt(rootNode['ex']) == 1)
										rootNode.expanded = true;									
								}
								else
									rootNode.leaf = true;
								*/
							}
							if(chNode.hasChildNodes) {
								vwNodes = chNode.childNodes;
								vwLen = vwNodes.length;
								vw=0;
								var colId, colVal, colCSS;
								for(;vw < vwLen; vw++) {
									vwNode = vwNodes[vw];
									if (vwNode.nodeType == 1 && vwNode.nodeName == "vw") {
										colId = "v" + vwNode.getAttribute('n');
										colVal = vwNode.getAttribute('v');
										colCSS = vwNode.hasAttribute('css');
										if (colVal) {
											/*if (columnValue[colId].dt == 'time')
												rootNode[colId] = '1900-01-01 ' + me.getRegExValue(colVal);
											else if (columnValue[colId].dt == 'date'){
												//rootNode[colId] = me.getRegExValue(colVal) + ' 00:00:00';
												rootNode[colId] = me.getRegExValue(colVal);//datechange
											}*/
											if (columnValue[colId].dt == 'date' || columnValue[colId].dt == 'time' || columnValue[colId].dt == 'date-time')
												rootNode[colId] = me.getRegExValue(colVal);
											else
												rootNode[colId] = colVal;
										}
										rootNode.text = colVal;
										if(colCSS) {
											//TECH-39926
											//rootNode[colId + '-css'] = colCSS || "";
											cssSplitValue = colCSS.split("~");
											rootNode[colId + '-css'] = cssSplitValue[0] || "";
											if (cssSplitValue.length > 1)
												rootNode['rowClass'] = cssSplitValue[1] || "";
										}
										if (colId == "v__icon")	{
											if (colVal == "0") {
												rootNode.iconCls = "no-icon";
											}											
										}
										if (colId == "v__icls")	{
											if (!Ext.isEmpty(colVal)) {
												rootNode.iconCls = colVal;
											}
										}
									}									
								}
							}
							//if(rootNode['hc'] == '1' && rootNode['ex'] == '1')
							if(rootNode['hc'] == '1')
								rootNode.children = me.parseTreeGridNode(chNode, columnValue, (data.controlType == 'RSTree'));
							/*
							if(hasTN)
								rootNode.children = me.parseTreeGridNode(chNode);
							else
								if(rootNode['hc'] == "0")
									rootNode.leaf = true;
								else{
									rootNode.expanded = false;
									rootNode.leaf = false;
								}
							*/
							mainRoot.children.push(rootNode);
						}						
					}
				}
				/*
                if (rootNode) {
					if (rootNode.nodeType == 1 && rootNode.nodeName == "tn"){
						if(rootNode.hasAttributes()) {
							rootData['rn'] = rootNode.getAttribute('rn');
							rootData['sel'] = parseInt(rootNode.getAttribute('sel')) == 0 ? false : true;
							rootData['hc'] = rootNode.getAttribute('hc');
							rootData['ex'] = rootNode.getAttribute('ex');
							rootData['nid'] = rootNode.getAttribute('nid');
						}
						if(rootNode.hasChildNodes){
							vwNodes = rootNode.childNodes;
							vwLen = vwNodes.length;
							vw=0;
							for(;vw < vwLen; vw++){
								vwNode = vwNodes[vw];
								if (vwNode.nodeType == 1 && vwNode.nodeName == "vw") {
									rootData["v"+vwNode.getAttribute('n')] = vwNode.getAttribute('v');
								}
							}
						}
					}
					if(rootNode.hasChildNodes())
						rootData.children = this.parseTreeGridNode(rootNode);
					else
						rootData.leaf = "true";					
                }
				*/
				//mainRoot.children = [rootData];
				//TECH-30810
				//data.store = mainRoot;
				data.value.store = mainRoot;
				//data.store = rootData;
			}
            else if (data.controlType == 'RSPivotGrid') {
                me.colKey = 0,
                    me.rowKey = 0,
					pgdNode = null,
                    me.leftCol = [], me.topCol = [], me.aggCol = [],
                    me.leftAxis = [], me.topAxis = [], me.aggValues = [];
					data.value = {};
				
				//Parse Views From Md Node
                mdNode = node.querySelector('md');
                if (mdNode) {
                    if (mdNode.hasAttribute('vr')) {
                        data.value.vr = parseInt(mdNode.getAttribute('vr'), 10);                        
                        viNode = mdNode.querySelector('vi');
                        var views = [],
                            view = {},
                            sv, se;
                        if (viNode) {
                            data.value.meteXml = mdNode.xml;
                            len = viNode.childNodes.length;
                            if (len > 0) {
                                data.value.columns = [];
                                data.value.columnsValue = {};
                            }
                            i = 0;
                            for (; i < len; i++) {
                                vwNode = viNode.childNodes[i];
                                if (vwNode.nodeType == 1) {
                                    ctrl = {};
                                    view = {};
                                    //defaultValue = vwNode.getAttribute('v');
                                    vwName = vwNode.getAttribute('n');
                                    ctrl['n'] = 'v' + vwName;
                                    ctrl['v'] = vwNode.getAttribute('v');
                                    ctrl['vt'] = vwNode.getAttribute('vt');
                                    ctrl['dt'] = vwNode.getAttribute('dt');
                                    ctrl['prec'] = vwNode.getAttribute('prec');
                                    ctrl['scc'] = vwNode.getAttribute('scc');
                                    sv = vwNode.getAttribute('sv');
                                    se = vwNode.getAttribute('se');
                                    if (!Ramcoutil.isEmpty(sv) || !Ramcoutil.isEmpty(se)) {
                                        view['id'] = ctrl['n'];
                                        view['visible'] = sv;
                                        view['enable'] = se;
                                        views.push(view);
                                    }
                                    ctrl['css'] = vwNode.getAttribute('css');
                                    if (ctrl['dt']) {
                                        format = '';
                                        if (me.dateDataTypes.indexOf(ctrl['dt']) > -1)
                                            format = me.getDateFormat(ctrl['dt'])
                                        else if (me.numDataTypes.indexOf(ctrl['dt']) > -1)
                                            format = me.getNumberFormat(ctrl['prec']);
                                        ctrl['ft'] = format;
                                    }
                                    if (ctrl['vt'] == 'combobox') {
                                        ldNode = vwNode.querySelector('ld');
                                        if (ldNode) {
                                            ctrl['store'] = [];
                                            ldNodeLen = ldNode.childNodes.length
                                            j = 0;
                                            for (; j < ldNodeLen; j++) {
                                                rNode = ldNode.childNodes[j];
                                                if (rNode.nodeType == 1) {
                                                    rValue = me.getRegExValue(rNode.getAttribute('v'));
                                                    ctrl['store'].push({
                                                        text: rValue,
                                                        value: rValue
                                                    });
                                                }
                                            }
                                        }
                                    }
                                    data.value.columnsValue[ctrl['n']] = ctrl;
                                    data.value.columns.push(ctrl['n']);
                                }
                            }
                        }
                        if (views.length > 0) {
                            control['id'] = data.name;
                            control['views'] = views;
                        }
                    }
                }
				
				//Parse Pivot Cols and Rows from pgd Node
				pgdNode = node.querySelector('pgd');
				if (Ramcoutil.isEmpty(pgdNode)) {
					//throw new Error("No Pivot Data, Contact Runtime Support");
					console.log("No Pivot Data, Contact Runtime Support");
					//return;
				} 
				else {
					mdNode = pgdNode.querySelector('md');
					if (mdNode) {
						colNode = mdNode.querySelector('cols');
						rlNode = colNode.querySelector('rl');
						clNode = colNode.querySelector('cl');
						aggNode = mdNode.querySelector('agg');

						vwNodes = rlNode.querySelectorAll('vw');
						i = 0;
						len = 0;
						if (vwNodes)
							len = vwNodes.length;
						for (; i < len; i++) {
							vwNode = vwNodes[i];
							if (vwNode.nodeType == 1)
								me.leftCol.push({
									n: "v" + vwNode.getAttribute('n'),
									c: vwNode.getAttribute('cap')
								});
						}
						coNode = clNode.querySelector('co');
						if (coNode) {
							vwNodes = coNode.childNodes;
							i = 0;
							len = 0;
							if (vwNodes)
								len = vwNodes.length;
							for (; i < len; i++) {
								vwNode = vwNodes[i];
								//topCol.push({n:"v"+ vwNode.getAttribute('n'), s:vwNode.getAttribute('seq'),  c:vwNode.getAttribute('cap')});
								//topCol.push({n:"v3", s:vwNode.getAttribute('seq'),  c:vwNode.getAttribute('cap')});
								if (vwNode.nodeType == 1 && vwNode.nodeName == "vw") {
										key =  "t_" + vwNode.getAttribute('cap');
										seq =  "t_" + vwNode.getAttribute('seq');
										cap = vwNode.getAttribute('cap');
									me.topCol[seq] = {
										key: key,
										value: vwNode.getAttribute('seq'),
										dimensionId: "v" + coNode.getAttribute('vn'),
										//id: "v" + coNode.getAttribute('vn'),
										name: (Ramcoutil.isEmpty(cap) || cap == 'BLANK' || cap == 'blank') ? '(blank)' : cap,
										seq: vwNode.getAttribute('seq')
									}
									coNodes = vwNode.querySelector("co");
									if (coNodes) {
										me.parsePivotCol(key, coNodes,seq);
									}
									}
								}
							}
						for (key in me.topCol) {
							me.topAxis.push(me.topCol[key]);
						}
						vwNodes = aggNode.querySelectorAll('vw');
						i = 0;
						len = 0;
						if (vwNodes)
							len = vwNodes.length;
						for (; i < len; i++) {
							vwNode = vwNodes[i];
							if (vwNode.nodeType == 1)
								me.aggCol.push({
									n: "v" + vwNode.getAttribute('n') + "agg" + i,								
									type: vwNode.getAttribute('ty')
								});
						}
					}
					riNode = node.querySelector('ri');
					if (riNode) {
						i = 0;
						len = riNode.childNodes.length;
						for (; i < len; i++) {
							rNode = riNode.childNodes[i];
							if (rNode.nodeType == 1) {
								me.parsePivotRow(null, rNode,0);
							}
						}
					}
					//TECH-29463
					/*dddNode = node.querySelector('ddd');
					if (dddNode) {					
						data.value.ddtValue = {};
						data.value.ddtValue.hsp = dddNode.getAttribute('hsp');
						data.value.ddtValue.vsp = dddNode.getAttribute('vsp');
						data.value.ddtValue.nsr = parseInt(dddNode.getAttribute('nsr'), 10);
						data.value.ddtValue.si = parseInt(dddNode.getAttribute('si'), 10);
						data.value.ddtValue.tr = parseInt(dddNode.getAttribute('tr'), 10);
						data.value.ddtValue.vsi = parseInt(dddNode.getAttribute('vsi'), 10);
						data.value.ddtValue.v = dddNode.getAttribute('v');
						mdNode = dddNode.querySelector('md');
						if (mdNode) {
							if (mdNode.hasAttribute('vr')) {
								data.value.ddtValue.vr = parseInt(mdNode.getAttribute('vr'), 10);
								data.value.ddtValue.zt = mdNode.getAttribute('zt');
								viNode = mdNode.querySelector('vi');
								var views = [],
									view = {},
									sv, se;
								if (viNode) {
									data.value.ddtValue.meteXml = mdNode.xml;
									len = viNode.childNodes.length;
									if (len > 0) {
										data.value.ddtValue.columns = [];
										data.value.ddtValue.columnsValue = {};
									}
									i = 0;
									for (; i < len; i++) {
										vwNode = viNode.childNodes[i];
										if (vwNode.nodeType == 1) {
											ctrl = {};
											view = {};
											//defaultValue = vwNode.getAttribute('v');
											vwName = vwNode.getAttribute('n');
											ctrl['n'] = 'v' + vwName;
											ctrl['v'] = vwNode.getAttribute('v');
											ctrl['vt'] = vwNode.getAttribute('vt');
											ctrl['dt'] = vwNode.getAttribute('dt');
											ctrl['prec'] = vwNode.getAttribute('prec');
											ctrl['scc'] = vwNode.getAttribute('scc');
											sv = vwNode.getAttribute('sv');
											se = vwNode.getAttribute('se');
											if (!Ramcoutil.isEmpty(sv) || !Ramcoutil.isEmpty(se)) {
												view['id'] = ctrl['n'];
												view['visible'] = sv;
												view['enable'] = se;
												views.push(view);
											}
											ctrl['css'] = vwNode.getAttribute('css');
											if (ctrl['dt']) {
												format = '';
												if (me.dateDataTypes.indexOf(ctrl['dt']) > -1)
													format = me.getDateFormat(ctrl['dt'])
												else if (me.numDataTypes.indexOf(ctrl['dt']) > -1)
													format = me.getNumberFormat(ctrl['prec']);
												ctrl['ft'] = format;
											}
											if (ctrl['vt'] == 'combobox') {
												ldNode = vwNode.querySelector('ld');
												if (ldNode) {
													ctrl['store'] = [];
													ldNodeLen = ldNode.childNodes.length
													j = 0;
													for (; j < ldNodeLen; j++) {
														rNode = ldNode.childNodes[j];
														if (rNode.nodeType == 1) {
															rValue = me.getRegExValue(rNode.getAttribute('v'));
															ctrl['store'].push({
																text: rValue,
																value: rValue
															});
														}
													}
												}
											}
											data.value.ddtValue.columnsValue[ctrl['n']] = ctrl;
											data.value.ddtValue.columns.push(ctrl['n']);
										}
									}
								}
								if (views.length > 0) {
									control['id'] = data.name;
									control['views'] = views;
								}
							}
						}
						ldNode = dddNode.querySelector('id');
						if (ldNode) {
								//data.store = [];
								data.value.ddtValue.store = []
							ldNodeLen = ldNode.childNodes.length
							j = 0;
							for (; j < ldNodeLen; j++) {
								rowNode = ldNode.childNodes[j];
								row = {};
								if (rowNode.nodeType == 1) {
									row['rn'] = rowNode.getAttribute('rn');
									row['sel'] = parseInt(rowNode.getAttribute('sel')) == 0 ? false : true;
									k = 0;
									colNodeLen = rowNode.childNodes.length;
									for (; k < colNodeLen; k++) {
										colNode = rowNode.childNodes[k];
										if (colNode.nodeType == 1) {
											colId = 'v' + colNode.getAttribute('n');
											colCss = 'c' + colNode.getAttribute('n');
											if(colNode.getAttribute('stp'))
											row[colId + '-stp'] = colNode.getAttribute('stp') || "";
											row[colId] = me.getRegExValue(colNode.getAttribute('v'));
											if (colNode.getAttribute('v') && data.value.ddtValue && data.value.ddtValue.columnsValue && data.value.ddtValue.columnsValue[colId].dt == 'time') {
												row[colId] = '1900-01-01 ' + me.getRegExValue(colNode.getAttribute('v'));
											}
											if (colNode.getAttribute('v') && data.value && data.value.columnsValue && data.value.columnsValue[colId].dt == 'date') {
												//row[colId] = me.getRegExValue(colNode.getAttribute('v')) + ' 00:00:00';
												row[colId] = me.getRegExValue(colNode.getAttribute('v')) ;//datechange
											}
											row[colCss] = colNode.getAttribute('css');
										}
									}
										//data.store.push(row);
										data.value.ddtValue.store.push(row);							
								}
							}
						}					
					}*/                
				}
				//TECH-29463
				dddNode = node.querySelector('ddd');
				if (dddNode) {					
					data.value.ddtValue = {};
					data.value.ddtValue.hsp = dddNode.getAttribute('hsp');
					data.value.ddtValue.vsp = dddNode.getAttribute('vsp');
					data.value.ddtValue.nsr = parseInt(dddNode.getAttribute('nsr'), 10);
					data.value.ddtValue.si = parseInt(dddNode.getAttribute('si'), 10);
					data.value.ddtValue.tr = parseInt(dddNode.getAttribute('tr'), 10);
					data.value.ddtValue.vsi = parseInt(dddNode.getAttribute('vsi'), 10);
					data.value.ddtValue.v = dddNode.getAttribute('v');
					mdNode = dddNode.querySelector('md');
					if (mdNode) {
						if (mdNode.hasAttribute('vr')) {
							data.value.ddtValue.vr = parseInt(mdNode.getAttribute('vr'), 10);
							data.value.ddtValue.zt = mdNode.getAttribute('zt');
							viNode = mdNode.querySelector('vi');
							var views = [],
								view = {},
								sv, se;
							if (viNode) {
								data.value.ddtValue.meteXml = mdNode.xml;
								len = viNode.childNodes.length;
								if (len > 0) {
									data.value.ddtValue.columns = [];
									data.value.ddtValue.columnsValue = {};
								}
								i = 0;
								for (; i < len; i++) {
									vwNode = viNode.childNodes[i];
									if (vwNode.nodeType == 1) {
										ctrl = {};
										view = {};
										//defaultValue = vwNode.getAttribute('v');
										vwName = vwNode.getAttribute('n');
										ctrl['n'] = 'v' + vwName;
										ctrl['v'] = vwNode.getAttribute('v');
										ctrl['vt'] = vwNode.getAttribute('vt');
										ctrl['dt'] = vwNode.getAttribute('dt');
										ctrl['prec'] = vwNode.getAttribute('prec');
										ctrl['scc'] = vwNode.getAttribute('scc');
										sv = vwNode.getAttribute('sv');
										se = vwNode.getAttribute('se');
										if (!Ramcoutil.isEmpty(sv) || !Ramcoutil.isEmpty(se)) {
											view['id'] = ctrl['n'];
											view['visible'] = sv;
											view['enable'] = se;
											views.push(view);
										}
										ctrl['css'] = vwNode.getAttribute('css');
										if (ctrl['dt']) {
											format = '';
											if (me.dateDataTypes.indexOf(ctrl['dt']) > -1)
												format = me.getDateFormat(ctrl['dt'])
											else if (me.numDataTypes.indexOf(ctrl['dt']) > -1)
												format = me.getNumberFormat(ctrl['prec']);
											ctrl['ft'] = format;
										}
										if (ctrl['vt'] == 'combobox') {
											ldNode = vwNode.querySelector('ld');
											if (ldNode) {
												ctrl['store'] = [];
												ldNodeLen = ldNode.childNodes.length
												j = 0;
												for (; j < ldNodeLen; j++) {
													rNode = ldNode.childNodes[j];
													if (rNode.nodeType == 1) {
														rValue = me.getRegExValue(rNode.getAttribute('v'));
														ctrl['store'].push({
															text: rValue,
															value: rValue
														});
													}
												}
											}
										}
										data.value.ddtValue.columnsValue[ctrl['n']] = ctrl;
										data.value.ddtValue.columns.push(ctrl['n']);
									}
								}
							}
							if (views.length > 0) {
								control['id'] = data.name;
								control['views'] = views;
							}
						}
					}
					ldNode = dddNode.querySelector('id');
					if (ldNode) {
							//data.store = [];
							data.value.ddtValue.store = []
						ldNodeLen = ldNode.childNodes.length
						j = 0;
						for (; j < ldNodeLen; j++) {
							rowNode = ldNode.childNodes[j];
							row = {};
							if (rowNode.nodeType == 1) {
								row['rn'] = rowNode.getAttribute('rn');
								row['sel'] = parseInt(rowNode.getAttribute('sel')) == 0 ? false : true;
								k = 0;
								colNodeLen = rowNode.childNodes.length;
								for (; k < colNodeLen; k++) {
									colNode = rowNode.childNodes[k];
									if (colNode.nodeType == 1) {
										colId = 'v' + colNode.getAttribute('n');
										colCss = 'c' + colNode.getAttribute('n');
										if(colNode.getAttribute('stp'))
										row[colId + '-stp'] = colNode.getAttribute('stp') || "";
										// TECH-35921 / TECH-35735 / HSI-480
										//row[colId] = me.getRegExValue(colNode.getAttribute('v'));
										row[colId] = me.getRegExValue(colNode.getAttribute('v'), true);
										/*if (colNode.getAttribute('v') && data.value.ddtValue && data.value.ddtValue.columnsValue && data.value.ddtValue.columnsValue[colId].dt == 'time') {
											row[colId] = '1900-01-01 ' + me.getRegExValue(colNode.getAttribute('v'));
										}
										if (colNode.getAttribute('v') && data.value && data.value.columnsValue && data.value.columnsValue[colId].dt == 'date') {
											//row[colId] = me.getRegExValue(colNode.getAttribute('v')) + ' 00:00:00';
											row[colId] = me.getRegExValue(colNode.getAttribute('v')) ;//datechange
										}*/
										row[colCss] = colNode.getAttribute('css');
									}
								}
									//data.store.push(row);
									data.value.ddtValue.store.push(row);							
							}
						}
					}					
				}
                if (me.leftAxis.length > 0 || me.topAxis.length > 0) {
                    //data.value = {};
                    data.value['success'] = true;
                    data.value['leftAxis'] = me.leftAxis;
                    data.value['topAxis'] = me.topAxis;
                    data.value['results'] = me.aggValues;
					data.value['aggCol'] = me.aggCol;
                }
				//TECH-29463
				else if (!Ext.isEmpty(data.value.ddtValue)) {
					data.value['success'] = true;
				}
                else{
					data.value = {};
                    data.value['success'] = true;
                }
                delete me.leftAxis;
                delete me.topAxis;
                delete me.aggValues;
            } else if (data.controlType == 'RSAssorted') {
                data.value = {};
                mdNode = node.querySelectorAll('md>vi>vw');
                ldNode = node.querySelectorAll('id>vw');
                // USed for parsing or else set preference for the value. PLace for getting datatype
                if (mdNode && mdNode.length > 0) {
                    var dataType = {};
                    mdNodeLen = mdNode.length;
                    k = 0;
                    for (; k < mdNodeLen; k++) {
                        var view = 'v' + mdNode[k].getAttribute('n'),
                            prec = mdNode[k].getAttribute('prec'),
                            dType = mdNode[k].getAttribute('dt');
                        dataType[view] = {
                            dType: dType,
                            prec: prec
                        };
                    };
                    data.ft = Ext.encode(dataType);
                }
				if (ctrlData && ctrlData.ft)
					data.ft = ctrlData.ft;
				
                if (ldNode && ldNode.length > 0) {
                    ldNodeLen = ldNode.length;
                    data.value = '{';
                    j = 0;
                    for (; j < ldNodeLen; j++) {
                        if (ldNode[j].nodeType == 1) {
                            var colVal = ldNode[j].getAttribute('v'),
                                view = 'v' + ldNode[j].getAttribute('n');
                            data.value += view + ': "' + colVal + '"';
							if (j == ldNodeLen - 1)
								data.value += ""
							else
								data.value += ","
                        }
                    }
                    data.value += '}';
                }
				data.addlProps = {
					ft: data.ft,
					value: data.value
				};
				if (node.hasAttribute('stp'))
					data.addlProps.stp = node.getAttribute('stp');
            }
			else if (data.controlType == 'RSGrid' || node.hasAttribute('vsi') || node.getAttribute('ct') == "RSGrid" || data.controlType == 'RSListView') {
                data.value = {};
                data.value.hsp = node.getAttribute('hsp');
                data.value.vsp = node.getAttribute('vsp');
                data.value.nsr = parseInt(node.getAttribute('nsr'), 10);
                data.value.si = parseInt(node.getAttribute('si'), 10);
                data.value.tr = parseInt(node.getAttribute('tr'), 10);
                data.value.vsi = parseInt(node.getAttribute('vsi'), 10);
                data.value.v = node.getAttribute('v');
                mdNode = node.querySelector('md');
                if (mdNode) {
					var views = [],
						view = {},
						
						// TECH-34273
						sorts = [],
						sort = {},
						so, soi,
						
						sv, se,st;//TECH-28696 / TECH-29031
                    if (mdNode.hasAttribute('vr')) {
                        data.value.vr = parseInt(mdNode.getAttribute('vr'), 10);
                        data.value.zt = mdNode.getAttribute('zt');
                        viNode = mdNode.querySelector('vi');
                        if (viNode) {
                            data.value.meteXml = mdNode.xml;
                            len = viNode.childNodes.length;
                            if (len > 0) {
                                data.value.columns = [];
                                data.value.columnsValue = {};
                            }
                            i = 0;
                            for (; i < len; i++) {
                                vwNode = viNode.childNodes[i];
                                if (vwNode.nodeType == 1) {
                                    ctrl = {};
                                    view = {};
									// TECH-34273
									sort = {};
                                    //defaultValue = vwNode.getAttribute('v');
                                    vwName = vwNode.getAttribute('n');
                                    ctrl['n'] = 'v' + vwName;
                                    ctrl['v'] = vwNode.getAttribute('v');
                                    ctrl['vt'] = vwNode.getAttribute('vt');
                                    ctrl['dt'] = vwNode.getAttribute('dt');
                                    ctrl['prec'] = vwNode.getAttribute('prec');
                                    ctrl['scc'] = vwNode.getAttribute('scc');
                                    ctrl['stp'] = vwNode.getAttribute('stp');
									ctrl['sm'] = vwNode.getAttribute('sm');
									
									// TECH-34273
									so = vwNode.getAttribute('sort');
									soi = vwNode.getAttribute('soi');
									
									if (!Ramcoutil.isEmpty(so) && !Ramcoutil.isEmpty(soi)) {
										sort['view'] = ctrl['n'].replace('v', '');
										sort['so'] = so;
										sort['soi'] = soi;
										sorts.push(sort);
									}
									
                                    sv = vwNode.getAttribute('sv');
                                    se = vwNode.getAttribute('se');
									st = vwNode.getAttribute('st');//TECH-28696 / TECH-29031
                                    if (!Ramcoutil.isEmpty(sv) || !Ramcoutil.isEmpty(se) || !Ramcoutil.isEmpty(st)) {
                                        view['id'] = ctrl['n'];
                                        view['visible'] = sv;
                                        view['enable'] = se;
										if(sv == 'n')//TECH-28696 / TECH-29031
											view['st'] = st;
                                        views.push(view);
                                    }
                                    ctrl['css'] = vwNode.getAttribute('css');
                                    if (ctrl['dt']) {
                                        format = '';
                                        if (me.dateDataTypes.indexOf(ctrl['dt']) > -1)
                                            format = me.getDateFormat(ctrl['dt'])
                                        else if (me.numDataTypes.indexOf(ctrl['dt']) > -1)
                                            format = me.getNumberFormat(ctrl['prec']);
                                        ctrl['ft'] = format;
                                    }
                                    if (ctrl['vt'] == 'combobox') {
                                        ldNode = vwNode.querySelector('ld');
                                        if (ldNode) {
                                            ctrl['store'] = [];
                                            ldNodeLen = ldNode.childNodes.length
                                            j = 0;
                                            for (; j < ldNodeLen; j++) {
                                                rNode = ldNode.childNodes[j];
                                                if (rNode.nodeType == 1) {
													var oVal = rNode.getAttribute('v'),
														cVal;
                                                    rValue = me.getRegExValue(oVal);
													if (!Ramcoutil.isEmpty(format))
														cVal = me.formatData(oVal, ctrl);
													else  
														cVal = rValue;
                                                    ctrl['store'].push({ text: cVal, value: rValue });
                                                }
                                            }
                                        }
                                    }
                                    data.value.columnsValue[ctrl['n']] = ctrl;
                                    data.value.columns.push(ctrl['n']);
                                }
                            }
                        }
						
						// TECH-34273
						if (sorts.length > 0) {
							control['id'] = data.name;
                            control['sorts'] = sorts;
						}
						
                        if (views.length > 0) {
                            control['id'] = data.name;
                            control['views'] = views;
                        }
                    }
					else {
						viNode = mdNode.querySelector('vi');
						if (viNode) {
							len = viNode.childNodes.length;
							for (; i < len; i++) {
                                vwNode = viNode.childNodes[i];
                                if (vwNode.nodeType == 1) {
									ctrl = {};
                                    view = {};
                                    vwName = vwNode.getAttribute('n');
                                    ctrl['n'] = 'v' + vwName;
									sv = vwNode.getAttribute('sv');
									se = vwNode.getAttribute('se');
									if (!Ramcoutil.isEmpty(sv) || !Ramcoutil.isEmpty(se)) {
										view['id'] = ctrl['n'];
										view['visible'] = sv;
										view['enable'] = se;
										views.push(view);
									}
									if (views.length > 0) {
										control['id'] = data.name;
										control['views'] = views;
									}
								}
							}							
						}
					}
                }
				fidNode = node.querySelector('fid')
				if (fidNode && fidNode.hasChildNodes()) {
					vwNodes = fidNode.querySelectorAll('vw');
					var fviews = [],
						fview = {};						
					if (vwNodes.length > 0) {
						//len = vwNodes.childNodes.length;
						len = vwNodes.length;
						if (typeof data.value.fid == "undefined") {
							data.value.fid = {};
							data.value.fid.columns = [];
							data.value.fid.columnsValue = {};	
						}						
						i = 0;
						for (; i < len; i++) {
							//vwNode = vwNodes.childNodes[i];
							vwNode = vwNodes[i];
							if (vwNode.nodeType == 1) {
								ctrl = {};
								view = {};                                    
								vwName = vwNode.getAttribute('n');
								ctrl['n'] = 'v' + vwName;
								ctrl['v'] = vwNode.getAttribute('v');
								ctrl['vt'] = vwNode.getAttribute('fcnd');
								data.value.fid.columnsValue[ctrl['n']] = ctrl;
								data.value.fid.columns.push(ctrl['n']);
							}
						}
					}
				}
                ldNode = node.querySelector('id');
                if (ldNode) {
					var columnValue = null;
					if (data && data.value && data.value.columnsValue) {
						columnValue = data.value.columnsValue;
					}
					if (data && data.value && Ext.isEmpty(data.value.columnsValue)) {
						if (ctrlData && ctrlData.value && ctrlData.value.columnsValue) {
							columnValue = ctrlData.value.columnsValue;
						}
					}
                    data.value.store = [];
                    ldNodeLen = ldNode.childNodes.length;
                    j = 0;
					lvnsr = 0;
					var cssValue = "",
						cssSplitValue = [];
                    for (; j < ldNodeLen; j++) {
                        rowNode = ldNode.childNodes[j];
                        row = {};
                        if (rowNode.nodeType == 1) {
                            row['rn'] = rowNode.getAttribute('rn');
                            row['sel'] = parseInt(rowNode.getAttribute('sel')) == 0 ? false : true;
							if (row['sel'] == true) {
								lvnsr++;
							}
                            k = 0;
                            colNodeLen = rowNode.childNodes.length;
                            for (; k < colNodeLen; k++) {
                                colNode = rowNode.childNodes[k];
                                if (colNode.nodeType == 1) {
                                    colId = 'v' + colNode.getAttribute('n');
                                    colCss = 'c' + colNode.getAttribute('n');
									if(colNode.getAttribute('stp'))
										row[colId + '-stp'] = colNode.getAttribute('stp') || "";
									// TECH-35921 / TECH-35735 / HSI-480
									//row[colId] = me.getRegExValue(colNode.getAttribute('v'));
									row[colId] = me.getRegExValue(colNode.getAttribute('v'), true);
                                    /*if (colNode.getAttribute('v') && columnValue[colId].dt == 'time') {
                                        row[colId] = '1900-01-01 ' + me.getRegExValue(colNode.getAttribute('v'));
                                    }
									if (colNode.getAttribute('v') && columnValue[colId].dt == 'date') {
                                       // row[colId] = me.getRegExValue(colNode.getAttribute('v')) + ' 00:00:00';
                                        row[colId] = me.getRegExValue(colNode.getAttribute('v'));//datechange
                                    }*/
                                    //row[colCss] = colNode.getAttribute('css');
									if(colNode.hasAttribute('css')) {
										//TECH-39926
										//row[colId + '-css'] = colNode.getAttribute('css') || "";
										cssValue = colNode.getAttribute('css');
										cssSplitValue = cssValue.split("~");
										row[colId + '-css'] = cssSplitValue[0] || "";
										if (cssSplitValue.length > 1)
											row['rowClass'] = cssSplitValue[1] || "";
									}
                                }
                            }
                            data.value.store.push(row);
                        }
                    }
					if (data.controlType == 'RSListView'){
						data.value.nsr = lvnsr;
						data.value.si = 1;
						data.value.vsi = 1;
					}
                }
            } else if (data.controlType == 'RSStackedLinks' || node.hasAttribute('tr')) {
                data.value = {};
                data.value.vsp = node.getAttribute('hsp');
                data.value.tr = parseInt(node.getAttribute('tr'), 10);
                ldNode = node.querySelector('id');
                if (ldNode) {
                    data.store = [];
                    ldNodeLen = ldNode.childNodes.length
                    j = 0;
                    for (; j < ldNodeLen; j++) {
                        rowNode = ldNode.childNodes[j];
                        row = {}
                        if (rowNode.nodeType == 1) {
                            row['rn'] = rowNode.getAttribute('rn');
                            k = 0;
                            colNodeLen = rowNode.childNodes.length;
                            for (; k < colNodeLen; k++) {
                                colNode = rowNode.childNodes[k];
                                if (colNode.nodeType == 1) {
                                    row[data.name + "_lc"] = me.getRegExValue(colNode.getAttribute('na'));
                                    row['ca'] = me.getRegExValue(colNode.getAttribute('ca'));;
                                    row['lt'] = colNode.getAttribute('lt');
                                    row['url'] = colNode.getAttribute('url');
                                    data.store.push(row);
                                }
                            }
                        }
                    }
                }
            //} else if (data.controlType == 'RSCombo' || node.hasChildNodes('ld')) {
			} else if (data.controlType == 'RSCombo') {	
			 	data.value = {};
                data.precision = node.getAttribute('prec');
                data.ht = node.getAttribute('ht');
                data.sbc = node.getAttribute('sbc');
                data.css = node.getAttribute('css');
                if (node.getAttribute('dt')) {
                    data.dt = node.getAttribute('dt');
                    format = '';
                    if (me.dateDataTypes.indexOf(data.dt) > -1)
                        format = me.getDateFormat(data.dt)
                    else if (me.numDataTypes.indexOf(data.dt) > -1) {
                        format = me.getNumberFormat(data.precision);
                    }
                    data.ft = format;
                }
                ldNode = node.querySelector('ld');
                if (ldNode) {
                    data.store = [];
                    ldNodeLen = ldNode.childNodes.length
                    j = 0;
                    for (; j < ldNodeLen; j++) {
                        rNode = ldNode.childNodes[j];
                        if (rNode.nodeType == 1) {
							var oVal = rNode.getAttribute('v'),
								cVal;
							rValue = me.getRegExValue(oVal);
							if (!Ramcoutil.isEmpty(format))
								cVal = me.formatData(oVal, data);
							else
								cVal = rValue;
							if(isNaN(data[data.name]))
								data[data.name] = 0;
							if(data[data.name] <= rValue.length) {
								data[data.name] = rValue.length;
							}
							data.store.push({ text: cVal, value: rValue });
                        }
                    }
                }
                data.value = me.getRegExValue(node.getAttribute('v'));
					}
			else if(data.controlType == 'RSSlider') {
					var rdSlider = [], rd = {}, rdLen = 0, rdc = 0, rdNode = null, value={};
					value.stpv = node.getAttribute('stpv');
					value.stav = node.getAttribute('stav');
					value.endv = node.getAttribute('endv');
					value.value = node.getAttribute('endv');
					rdLen = node.childNodes.length;
					if(rdLen > 0) {
						for(;rdc < rdLen; rdc++) {
							rdNode = node.childNodes[rdc];
							if (rdNode.nodeType == 1) {
								rd['minval'] = rdNode.getAttribute('minv');
								rd['maxval'] = rdNode.getAttribute('maxv');								
								rdSlider.push(rd);
							}
						}
					}
					value.rdData = rdSlider;
					data.value = value;
			}
			else {
                data.precision = node.getAttribute('prec');
                data.ht = node.getAttribute('ht');
                data.sbc = node.getAttribute('sbc');
                data.caption = node.getAttribute('scc');
                data.css = node.getAttribute('css');
				data.href = node.getAttribute('href');
				data.sm = node.getAttribute('sm');
				// TECH -29816
                if (node.getAttribute('dt') || (RamcoRTC.osType == "JAVA" && data.precision)) {
                    data.dt = node.getAttribute('dt');
					if(RamcoRTC.osType == "JAVA" && data.precision && data.dt == null)
						data.dt = "numeric";
                    format = '';
                    if (me.dateDataTypes.indexOf(data.dt) > -1)
                        format = me.getDateFormat(data.dt)
                    else if (me.numDataTypes.indexOf(data.dt) > -1 || (RamcoRTC.osType == "JAVA" && data.precision)) {
                        format = me.getNumberFormat(data.precision);
                    }
                    data.ft = format;
                }
				// if(me.ci && (me.ci[node.getAttribute("n")].dt == "date" || me.ci[node.getAttribute("n")].dt == "date-time" || me.ci[node.getAttribute("n")].dt == "time"))
					// data.value = new Date(node.getAttribute('v'));
				// else
				//nodeCType = node.getAttribute('ct') || me.ci[data.name].controlType;
                //if (nodeCType == 'RSTextArea')
				//data.value = node.getAttribute('v');
				//TECH-26703
				/* if(data.controlType == 'RSTextArea')
					data.value = me.getRegExValue(node.getAttribute('v'),true);
				else */
				//TECH-26763
				
				// Vulnerability
				// TECH-32296
				//if (RamcoRTC.settings.purifyText != false) {
					// TECH-35461
					var dataVal = node.getAttribute('v');
					if (dataVal && dataVal.indexOf("<I") == 0){
						data.value = dataVal;	
					}
					else{
					if(data.controlType == 'RSTextArea')
							data.value = me.getRegExValue(dataVal,true);
					else
							data.value = me.getRegExValue(dataVal,false);
					}
				//}
				//else
				//	data.value = node.getAttribute('v');
				data.addlProps = {
					ft : data.ft,
					dt : data.dt,
					ht : data.ht,
					sbc : data.sbc,
					caption : data.caption,
					css : data.css,
					href : data.href,
					value : data.value,
					sm: data.sm
				};
				
				if (node.getAttribute('stp')) {
					data.addlProps.stp = node.getAttribute('stp');
				}
				
                //else
				
				//data.value = me.getRegExValue(node.getAttribute('v'));
            }
            if (control.id) {
                if (!ctrlState['controls'])
                    ctrlState['controls'] = [];
                ctrlState['controls'].push(control);
            }
            return data;
        },
		parseTreeGridNode:function(rootNode, columnValue, isRSTree) {
			var me =this,
				child =[],
				c=0,
				vw=0,
				vwLen=0,
				tn = {},
				hasTN=false,
				childNodes, childNode,childNodeLen,
				vwNodes,vwNode,
				colId, colVal, colCSS,
				cssValue = "",
				cssSplitValue = [];
			if(rootNode && rootNode.hasChildNodes) {
				childNodes = rootNode.childNodes;
				childNodeLen = childNodes.length;
				c=0;
				for (; c < childNodeLen; c++) {
					childNode =  childNodes[c];					
					if (childNode.nodeType == 1 && childNode.nodeName == "tn"){
						tn = {};
						if(childNode.hasAttributes()) {
							tn['rn'] = childNode.getAttribute('rn');
							tn['in'] = childNode.getAttribute('in');
							tn['lvl'] = childNode.getAttribute('lvl');
							tn['sel'] = parseInt(childNode.getAttribute('sel')) == 0 ? false : true;
							tn['hc'] = childNode.getAttribute('hc');
							tn['ex'] = childNode.getAttribute('ex');
							tn['nid'] = childNode.getAttribute('nid');
							tn['pnid'] = childNode.getAttribute('pnid');
							//tn.expanded = false;
							tn.leaf = true;
							if(parseInt(tn['ex']) == 1)
								tn.expanded = true;
							if(parseInt(tn['hc']) == 1)
								tn.leaf = false;
							if (isRSTree && childNode.getAttribute('sel')) {
								tn.checked = (childNode.getAttribute('sel') == "1") ? true : false;
							}
							/*
							if(parseInt(tn['hc']) == 1) {
								tn.expanded = false;
								if(parseInt(tn['ex']) == 1)
									tn.expanded = true;									
							}
							else
								rootNode.leaf = true;
							*/
						}
						if(childNode.hasChildNodes) {
							vwNodes = childNode.childNodes;
							vwLen = vwNodes.length;
							vw=0;							
							for(;vw < vwLen; vw++){
								vwNode = vwNodes[vw];					
								if (vwNode.nodeType == 1 && vwNode.nodeName == "vw") {
									//tn["v"+vwNode.getAttribute('n')] = vwNode.getAttribute('v');
									colId = "v" + vwNode.getAttribute('n');
									colVal = vwNode.getAttribute('v');
									colCSS = vwNode.hasAttribute('css');
									if (colVal) {
										/*if (columnValue[colId].dt == 'time')
											tn[colId] = '1900-01-01 ' + me.getRegExValue(colVal);
										else if (columnValue[colId].dt == 'date'){
											//tn[colId] = me.getRegExValue(colVal) + ' 00:00:00';
											tn[colId] = me.getRegExValue(colVal);	//datechange
										}*/
										if (columnValue[colId].dt == 'date' || columnValue[colId].dt == 'time' || columnValue[colId].dt == 'date-time')
											tn[colId] = me.getRegExValue(colVal);
										else
											tn[colId] = colVal;
									}
									tn.text = colVal;
									if(colCSS) {
										//TECH-39926
										//tn[colId + '-css'] = colCSS || "";										
										cssSplitValue = colCSS.split("~");
										tn[colId + '-css'] = cssSplitValue[0] || "";
										if (cssSplitValue.length > 1)
											tn['rowClass'] = cssSplitValue[1] || "";
									}
									if (colId == "v__icon")	{
										if (colVal == "0") {
											tn.iconCls = "no-icon";
										}								
									}
									if (colId == "v__icls")	{
										if (!Ext.isEmpty(colVal)) {
											tn.iconCls = colVal;
										}
									}
								}								
							}
							//if(tn['hc'] == '1' && tn['ex'] == '1')
							if (tn['hc'] == '1')
								tn.children = me.parseTreeGridNode(childNode, columnValue, isRSTree);
							/*
							else
								tn.leaf = true;*/
						}
						child.push(tn);
					}
				}
			}
			return child;
		},
        parsePivotCol: function(key, coNode,seq) {
            var me = this,
                vwNodes, vwNode, childCoNodes, childCoNode,
                i = 0,
                len = 0,
                j = 0,
				cap = '',
                jLen = 0,
				cSeq="",
                dimensionId, nextKey;
            dimensionId = "v" + (coNode.getAttribute("vn"));
            //vwNodes = coNode.querySelectorAll('vw');
            vwNodes = coNode.childNodes;
            if (vwNodes)
                len = vwNodes.length;
            for (; i < len; i++) {
                vwNode = vwNodes[i];
                if (vwNode.nodeType == 1 && vwNode.nodeName == "vw") {
					cap = vwNode.getAttribute('cap');
                    nextKey = key + "#_#" + cap;
					cSeq = seq + "_" + vwNode.getAttribute('seq');
                    me.topCol[cSeq]= {
                        key: nextKey,
                        value: cap,
                        name: (Ramcoutil.isEmpty(cap) || cap == 'BLANK' || cap == 'blank') ? '(blank)' : cap,
                        dimensionId: dimensionId,
						//id:dimensionId,
                        seq: vwNode.getAttribute('seq')
                        }
                    childCoNode = vwNode.querySelector("co");
                    if (childCoNode) {
						me.parsePivotCol(nextKey, childCoNode,cSeq);
                    }
                }
            }
        },
        parsePivotFact:function(key, fNode,seq) {
            var me = this,
                vwNodes, vwNode, vNodes, vNode, fChildNodes,fChildNode,
                i = 0,
                len = 0,
                j = 0,
                jLen = 0,
                lvl, dimensionId, topKey,
                row = 0,
                col = 0,
				dk ="",
				cSeq="",
                aggValues = {};
                vwNodes = fNode.childNodes;
                len = vwNodes.length;
                for (; i < len; i++) {
                    vwNode = vwNodes[i];
                    if (vwNode.nodeType == 1 && vwNode.nodeName == "vw") {
                        vNodes = vwNode.childNodes;
						cSeq = seq + "_" + vwNode.getAttribute("seq");
						dk = vwNode.getAttribute("dk");
						aggValues['dk'] = dk;						
                        j = 0;
                        col = 0;
                        jLen = vNodes.length;
					if (me.topCol[cSeq])
						topKey = me.topCol[cSeq].key;
                        else
                            topKey = 'grandtotal';
                        for (; j < jLen; j++) {
                            vNode = vNodes[j];
						if (vNode.nodeType == 1){
							if(vNode.nodeName == "v") {
                                aggValues[me.aggCol[col].n] = parseFloat(vNode.getAttribute('val'));
                                col++;
                            }
							if(vNode.nodeName == "f") {
								me.parsePivotFact(key,vNode, cSeq);
							}
						}
                        }
                        me.aggValues.push({
                            leftKey: key,
                            topKey: topKey,
                            values: aggValues
                        });
                        aggValues = {};
                        row++;
                    }
                }
		},
		parsePivotRow: function(key, node) {
            var me = this,
                rlNode, rNode, fNode, vwNodes, vwNode, vNodes, vNode,
                i = 0,
                len = 0,
                j = 0,
                jLen = 0,
                lvl, dimensionId, topKey,
                row = 0,
                col = 0,
				dk ="",
				tmpDk="",
				newKey,
                aggValues = {};
            rlNode = node.querySelector('rl');
            fNode = node.querySelector('f');
            lvl = parseInt(rlNode.getAttribute('lvl'));
            if (me.leftCol[lvl])
                dimensionId = me.leftCol[lvl].n;
            else
                dimensionId = 'notfound'
			dk = rlNode.getAttribute('dk')
			if(Ramcoutil.isEmpty(key))
				newKey = dk;
			else
				newKey = key + "#_#" + dk;
         		tmpDk = dk.split("#").join("");
			if (Ramcoutil.isEmpty(dk) || tmpDk.length == 0) {
                newKey = 'grandtotal';
            } else {
                me.leftAxis.push({
                    key: newKey,
                    value:(Ramcoutil.isEmpty(dk) || dk == 'BLANK' || dk == 'blank') ? '(blank)' : dk,					
                    dimensionId: dimensionId
                });
            }
			if (fNode) {
                me.parsePivotFact(newKey,fNode,"t");
            }
            //rNode = node.querySelectorAll('r');
			rNode = node.childNodes
            i = 0;
            len = rNode.length;
            for (; i < len; i++) {
                childRNode = rNode[i];
                if (childRNode.nodeType == 1 && childRNode.nodeName == "r")
                    me.parsePivotRow(newKey, childRNode);
            }
        },
		formatData: function(value, ctrl) {
			try {
				if(!value)
					return "";
				
				var me = this,
					tempNum = '999999999999999999',
					n1, n2, num, num1,num2, dataType, precision, format, dateVal;
					
				dataType = ctrl['dt'];
				precision = ctrl['ft'];
				
				if (me.dateDataTypes.indexOf(ctrl['dt']) > -1){
					if ( dataType == 'date') {
						//dateVal = Ext.Date.parse(value + ' 00:00:00',  "Y-m-d H:i:s");
						dateVal = Ext.Date.parse(value,  "Y-m-d");//datechange
					}
					if (dataType == 'time') {
						dateVal = Ext.Date.parse('1900-01-01 ' + value, "Y-m-d H:i:s");
					}
					if (dataType == 'date-time') {
						dateVal = Ext.Date.parse(value, "Y-m-d H:i:s");
					}
					if (dataType == "date") {
						//TECH-38726
						format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat;
						//if (new Date(value) != 'Invalid Date')
							//num = Ext.util.Format.date(value, format);
						num = Ext.util.Format.date(dateVal, format);
					}
					else if (dataType == "date-time") {
						format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat;
						num = Ext.util.Format.date(dateVal, format);
					}
					else if (dataType == "time") {
						format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat;
						num = Ext.util.Format.date(dateVal, format);
					}
					return num;
				}
				else {
					precision = precision ? parseInt(precision, 10) : 0;
					if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "no grouping") {
						format = '9.' + tempNum.substring(0, precision)
					} else {
						format = '9,9.' + tempNum.substring(0, precision)
					}
					Ext.util.Format.thousandSeparator = RamcoRTC.userPreference.numgroupsymbol;
					Ext.util.Format.decimalSeparator = RamcoRTC.userPreference.decimalseparator;
					if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "lakh based") {
						num2 = (value) ? parseFloat(value) : 0;
						num1 = num2.toFixed(precision);
						n1 = num1.split('.');
						n2 = n1[1] || null;
						n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
						num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
					} else {
						if (precision == null || precision == 0)
							num = Ext.util.Format.number(value, "0");
						else
						num = Ext.util.Format.number(value, format);
					}
					var neg = false;
					if (num.indexOf('-') != -1)
						neg = true;
					if (neg) {
						var numNegStyle = RamcoRTC.userPreference.numnegativestle;
						switch (numNegStyle) {
							case "(1.1)":
								num = "(" + num.replace("-", "") + ")";
								break;

							case "- 1.1":
								num = num.replace("-", "- ");
								break;

							case "1.1-":
								num = num.replace("-", "") + "-";
								break;

							case "1.1 -":
								num = num.replace("-", "") + " -";
								break;

							case "()1.1":
								num = "()" + num.replace("-", "");
								break;

							case "(-)1.1":
								num = "(-)" + num.replace("-", "");
								break;
							default:
								num = "-" + num.replace("-", "");
								break;
						}
					}
					return num;	
				}
			}
			catch(ex) {}			
		},
        getRegExValue: function(value,isTextArea) {
            var rValue = value,
                ret = false,
                re = '';

            if (value == null)
                value = '';
            rValue = value;
            if (value.indexOf("'../../../") > -1 || value.indexOf('"../../../') > -1) {
                re = /\.\.\/\.\.\/\.\.\//g;
                rValue = value.replace(re, '../');
                ret = true;
            } else if (value.indexOf("'..\\..\\..\\") > -1 || value.indexOf('"..\\..\\..\\') > -1) {
                re = /\.\.\\\.\.\\\.\.\\/g;
                rValue = value.replace(re, '..\\');
                ret = true;
            }
            if (ret)
                return rValue;
            if (value.indexOf("'../../") > -1 || value.indexOf('"../../') > -1) {
                re = /\.\.\/\.\.\//g;
                rValue = value.replace(re, '../');
            } else if (value.indexOf("'..\\..\\") > -1 || value.indexOf('"..\\..\\') > -1) {
                re = /\.\.\\\.\.\\/g;
                rValue = value.replace(re, '..\\');
            }
			rValue = rValue.replace(/&\w+?;/g, function( e ) {
					switch(e) {
						case '&lt;': 
							return "<";
						case '&gt;': 
							return ">";
						case '&amp;': 
							return "&";
						case '&apos;': 
							return "\'";
						case '&quot;': 
							return "\"";
						default: 
							return e;
					}
			});
            
			// TECH-33621
			if (!isTextArea) {
				re = /(\r|\t|\n)/g;
				rValue = rValue.replace(re, '');
			}
			
            re = />[\s]+</g;
            rValue = rValue.replace(re, '><');
			//TECH-26703			
			// Vulnerability
			/*if (RamcoRTC.settings.purifyText != false) {
				// TECH-31556 - Chart & Graph - Purify Option Enabled //TECH-31937
				if (rValue.indexOf('<chartresult>') == 0 || rValue.indexOf('<graph>') == 0 || !(new RegExp(/<[.]?>/gi)).test(rValue))
					return rValue;
				try{
					// TECH-31776
					//if(isTextArea)
						rValue = DOMPurify.sanitize(rValue,{ALLOWED_TAGS:RamcoRTC.settings.validHTMLEditorTags || []});
					else
						//rValue = DOMPurify.sanitize(rValue,{ALLOWED_TAGS:RamcoRTC.settings.validHTMLTags || []});
					//
					rValue = DOMPurify.sanitize(rValue);
				}catch(e){
					console.log(rValue);
					rValue = "";
				}
			}*/
			//TECH-32076
			//rValue = purifyDom(rValue); // TECH-32563 & TECH-32726
            return rValue;
        },
        setDataJSON: function(dataJSON) {},
        getDateFormat: function(dataType) {
            var me = this,
                format = null;
            switch (dataType) {
                case 'date':
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:me.prefs['dateFormat'];
                    break;
                case 'date-time':
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:me.prefs['dateTimeFormat'];
                    break;
                case 'time':
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:me.prefs['timeFormat'];
                    break;
                default:
            }
            return format;
        },
        getNumberFormat: function(precision) {
			if (Ramcoutil.isEmpty(precision))
				return 0;			
            var me = this,
                prec = parseInt(precision, 10);
                /*fm = '000000000000000000000000000000';
            if (prec > 0) {
                return fm.substring(0, 28 - (prec + 1)) + '.' + fm.substring(0, prec);
            } else {
                return fm.substring(0, 28);
            }*/
            return prec;
        },
        xml2String: function(node) {
            if (typeof(XMLSerializer) !== 'undefined') {
                var serializer = new XMLSerializer();
                return serializer.serializeToString(node);
            } else if (node.xml) {
                return node.xml;
            }
        },
        getPageAtt: function(pageNode) {
            var me = this,
                page = {};
            page['id'] = pageNode.getAttribute('name');
            page['focus'] = pageNode.getAttribute('focus');
            page['visible'] = pageNode.getAttribute('visible');
            page['enable'] = pageNode.getAttribute('enable');
            return page;
        },
        getSectionAtt: function(sectionNode) {
            var me = this,
                section = {};
            section['id'] = sectionNode.getAttribute('name');
            section['title'] = sectionNode.getAttribute('SectionTitle');
            section['collapse'] = sectionNode.getAttribute('collapse');
            section['visible'] = sectionNode.getAttribute('visible');
            section['enable'] = sectionNode.getAttribute('enable');
            return section;
        },
        getControlAtt: function(controlNode) {
            var me = this,
                control = {},
                len = 0,
                i = 0,
                links = [],
                views = [],
                linkLst, linkNode,
                viewLst, viewNode;
            control['id'] = controlNode.getAttribute('id');
            control['caption'] = controlNode.getAttribute('controlcaption');
            control['sectionname'] = controlNode.getAttribute('sectionname');
            control['visible'] = controlNode.getAttribute('visible');
            control['enable'] = controlNode.getAttribute('enable');
            linkLst = controlNode.querySelectorAll('link');
            if ((len = linkLst.length) > 0) {
                for (; i < len; i++) {
                    linkNode = linkLst[i];
                    links.push(me.getLinkatt(linkNode));
                }
                control['links'] = links;
            }
            viewLst = controlNode.querySelectorAll('vw');
            if ((len = viewLst.length) > 0) {
                i = 0;
                for (; i < len; i++) {
                    viewNode = viewLst[i];
                    views.push(me.getViewatt(viewNode));
                }
                control['views'] = views;
            }
            return control;
        },
        getLinkatt: function(linkNode) {
            var me = this,
                link = {};
            link['id'] = linkNode.getAttribute('name');
            link['sectionname'] = linkNode.getAttribute('sectionname');
            link['visible'] = linkNode.getAttribute('visible');
            link['enable'] = linkNode.getAttribute('enable');
            return link;
        },
        getViewatt: function(viewNode) {
            var me = this,
                view = {};
            view['id'] = 'v' + viewNode.getAttribute('n');
            view['columncaption'] = viewNode.getAttribute('columncaption');
            view['sectionname'] = viewNode.getAttribute('sectionname');
            view['visible'] = viewNode.getAttribute('visible');
            view['enable'] = viewNode.getAttribute('enable');
            return view;
        },
        getLCITabAtt: function(tabEl) {
            var me = this,
                tab = {};
            tab['id'] = tabEl.getAttribute('n');
            tab['visible'] = tabEl.getAttribute('sv');
            tab['enable'] = tabEl.getAttribute('se');
            tab['title'] = tabEl.getAttribute('scc');
            tab['bg'] = tabEl.getAttribute('sbc');
            tab['fg'] = tabEl.getAttribute('sfc');
            return tab;
        },
        getLCISecAtt: function(secEl) {
            var me = this,
                sec = {};
            sec['id'] = secEl.getAttribute('n');
            sec['visible'] = secEl.getAttribute('sv');
            sec['enable'] = secEl.getAttribute('se');
            sec['title'] = secEl.getAttribute('scc');
            sec['bg'] = secEl.getAttribute('sbc');
            sec['fg'] = secEl.getAttribute('sfc');
            sec['collapse'] = secEl.getAttribute('sc');
            sec['popup'] = secEl.getAttribute('shwpup');
            return sec;
        },
        getLCIBtnAtt: function(btnEl) {
            var me = this,
                btn = {};
            btn['id'] = btnEl.getAttribute('n');
            btn['visible'] = btnEl.getAttribute('sv');
            btn['enable'] = btnEl.getAttribute('se');
            btn['caption'] = btnEl.getAttribute('scc');
            btn['bg'] = btnEl.getAttribute('sbc');
            btn['fg'] = btnEl.getAttribute('sfc');
            btn['href'] = btnEl.getAttribute('href');
            btn['css'] = btnEl.getAttribute('css');
			btn['stp'] = btnEl.getAttribute('stp');
            return btn;
        },
        getLCILnkAtt: function(btnEl) {
            var me = this,
                btn = {};
            btn['id'] = btnEl.getAttribute('n');
            btn['visible'] = btnEl.getAttribute('sv');
            btn['enable'] = btnEl.getAttribute('se');
            btn['caption'] = btnEl.getAttribute('scc');
            btn['bg'] = btnEl.getAttribute('sbc');
            btn['fg'] = btnEl.getAttribute('sfc');
            btn['href'] = btnEl.getAttribute('href');
            btn['css'] = btnEl.getAttribute('css');
            btn['stp'] = btnEl.getAttribute('stp');
            return btn;
        },
		//TECH-30667
        //formTreeRoot: function(treeId, rootNode) {
		formTreeRoot: function(treeId, rootNode, level) {
            var me = this,
                sNodeId, sNodeText, sNodeType, sParentId, sToolTip, sNodeDesc, sTemp, sState, sParentSel,
                bTreeExpand, bChecked, bExpanded, bExpandable, sAction, sIcon, sSuccessor,
                i = 0, hideTbrSeq,
                treeData = {},
                bToolBar = false,
				selNode = null;
				
            if (rootNode) {
                sNodeId = rootNode.getAttribute('id');
                sNodeText = rootNode.getAttribute('td');
                sNodeType = rootNode.getAttribute('nt');
                sParentId = rootNode.getAttribute('pid');
                sState = rootNode.getAttribute('st');
                sToolTip = rootNode.getAttribute('tt');
                bChecked = rootNode.getAttribute('ch');
                bExpanded = rootNode.getAttribute('ex');
                bExpandable = rootNode.getAttribute('ep');
                sAction = rootNode.getAttribute('at');
                sIcon = rootNode.getAttribute('ic');
                sSuccessor = rootNode.getAttribute('sc');
                sCls = rootNode.getAttribute('cls');
                sExpandEvent = rootNode.getAttribute('expevnt');
                sChildSelect = rootNode.getAttribute('cs');
                bToolBar = rootNode.getAttribute('tb');
                sParentSel = rootNode.getAttribute('ps');
				hideTbrSeq = rootNode.getAttribute('tbex');
				selNode = rootNode.getAttribute('sel');

                if(Ramcoutil.isEmpty(bChecked))
                    bChecked = undefined;
                else if (bChecked == "true")
                    bChecked = true;
                else if (bChecked == "false")
                    bChecked = false;

                if (bExpanded == "true")
                    bExpanded = true;
                else if (bExpanded == "false")
                    bExpanded = false;

                if (sState == "e")
                    bExpanded = true;

                if (bToolBar == "")
                    bToolBar = false;
                else if (bToolBar == "true")
                    bToolBar = true;
                else if (bToolBar == "false")
                    bToolBar = false;

                treeData = {
                    treeId: treeId,
                    itemId: sNodeId,
                    pSelect: sParentSel,
                    text: sNodeText,
                    nodeType: sNodeType,
					pnode_type:'root',
                    pid: sParentId,
                    st: sState,
                    qTip: sToolTip,
                    expanded: bExpanded,
                    action: sAction,
                    successor: sSuccessor,
                    cls: sCls,
                    tbar: bToolBar,
                    qEvent: sExpandEvent,
					hideTbrSeq: hideTbrSeq,
                    qSelect: sChildSelect,
					sel: selNode,
					rowLevel: level//TECH-30667
                }
                if (!Ramcoutil.isEmpty(sIcon))
                    treeData.icon = 'resources/images/application/' + sIcon;
                if (Ramcoutil.isBoolean(bChecked))
                    treeData.checked = bChecked;
            }
            return treeData;
        },
		//TECH-30667
        //formTreeData: function(treeId, id, nodeType) {
		formTreeData: function(treeId, id, nodeType, level) {
            var me = this,
                childNodes = me.treeNodes.querySelectorAll("tn[pid='" + id + "']"),
                sNodeId, sNodeText, sNodeType, sParentId, sToolTip, sNodeDesc, sTemp, sState,
                bTreeExpand, bChecked, bExpanded, bExpandable, sAction, sIcon, sSuccessor, sParentSel, sExpandEvent, sChildSelect,
                oChildNode, i = 0,
                treeData = {},
                treeDatas = [],
                children, len = childNodes.length, selNode = null;
				
            if (len > 0) {
                for (; i < len; i++) {
                    oChildNode = childNodes[i];
                    sNodeId = oChildNode.getAttribute('id');
                    sNodeText = oChildNode.getAttribute('td');
                    sNodeType = oChildNode.getAttribute('nt');
                    sParentId = oChildNode.getAttribute('pid');
                    sState = oChildNode.getAttribute('st');
                    sToolTip = oChildNode.getAttribute('tt');
                    bChecked = oChildNode.getAttribute('ch');
                    bExpanded = oChildNode.getAttribute('ex');
                    bExpandable = oChildNode.getAttribute('ep');
                    sAction = oChildNode.getAttribute('at');
                    sIcon = oChildNode.getAttribute('ic');
                    sSuccessor = oChildNode.getAttribute('sc');
                    sCls = oChildNode.getAttribute('cls');
                    sExpandEvent = oChildNode.getAttribute('expevnt');
                    sChildSelect = oChildNode.getAttribute('cs');
                    sParentSel = oChildNode.getAttribute('ps');
					selNode = oChildNode.getAttribute('sel');

                    if (Ramcoutil.isEmpty(bChecked))
                        bChecked = undefined;
                    else if (bChecked == "true")
                        bChecked = true;
                    else if (bChecked == "false")
                        bChecked = false;

                    if (bExpanded == "true")
                        bExpanded = true;
                    else if (bExpanded == "false")
                        bExpanded = false;

                    if (sState == "e")
                        bExpanded = true;

                    if (bExpandable == "")
                        bExpandable = false;
                    else if (bExpandable == "true")
                        bExpandable = true;
                    else if (bExpandable == "false")
                        bExpandable = false;
                    treeData = {
                        treeId: treeId,
                        itemId: sNodeId,
                        text: sNodeText,
                        nodeType: sNodeType,
                        pid: sParentId,
                        st: sState,
                        pSelect: sParentSel,
                        expanded: bExpanded,
                        action: sAction,
                        successor: sSuccessor,
                        cls: sCls,
                        qEvent: sExpandEvent,
                        qSelect: sChildSelect,
						sel: selNode,
						rowLevel:  level + "-" + (i + 1) //TECH-30667
                    }
                    if (!Ramcoutil.isEmpty(sIcon))
                        treeData.icon = 'resources/images/application/' + sIcon;
                    if (Ramcoutil.isBoolean(bChecked))
                        treeData.checked = bChecked;
                    if (nodeType)
                        treeData.pnodeType = nodeType;
					//TECH-30667
                    //children = me.formTreeData(treeId, sNodeId, sNodeType);
					children = me.formTreeData(treeId, sNodeId, sNodeType, level + "-" + (i + 1));
                    if (children)
                        treeData.children = children;

                    if (!children) {
                        treeData.leaf = true;
                    }
					//TECH-41158
					/* if (bExpandable) {
                        delete treeData.expanded;
                        treeData.leaf = false;
                    }					 */
					if (!bExpandable) {
                        delete treeData.expanded;                        
                    }
                    treeDatas.push(treeData);
                }
                return treeDatas;
            }
            return null;
        },
        renderTreeData: function(sTreeId, tnsNode) {
            var oTc, _objControl, objTree, oTns, oTn;
            var sNodeId, sNodeText, sNodeType, sParentId, sPNodeType, sToolTip, sIcon, sTemp, sAction, sState, sCls, sParentSel;
            var bChecked, bExpanded, bExpandable, sAction, sIcon, sSuccessor, treeData, treeDatas = [], selNode = null;

            oTns = tnsNode.querySelectorAll("tn");
            for (var i = 0; i < oTns.length; i++) {
                oTn = oTns[i];
                sNodeId = oTn.getAttribute('id');
                sNodeText = oTn.getAttribute('td');
                sNodeType = oTn.getAttribute('nt');
                sParentId = oTn.getAttribute('pid');
                sState = oTn.getAttribute('st');
                sToolTip = oTn.getAttribute('tt');
                bChecked = oTn.getAttribute('ch');
                bExpanded = oTn.getAttribute('ex');
                bExpandable = oTn.getAttribute('ep');
                sAction = oTn.getAttribute('at');
                sIcon = oTn.getAttribute('ic');
                sSuccessor = oTn.getAttribute('sc');
                sCls = oTn.getAttribute('cls');
                sExpandEvent = oTn.getAttribute('expevnt');
                sChildSelect = oTn.getAttribute('cs');
                sParentSel = oTn.getAttribute('ps');
				selNode = oTn.getAttribute('sel');

                if (Ramcoutil.isEmpty(bChecked))
                    bChecked = undefined;
                else if (bChecked == "true")
                    bChecked = true;
                else if (bChecked == "false")
                    bChecked = false;

                if (bExpanded == "true")
                    bExpanded = true;
                else if (bExpanded == "false")
                    bExpanded = false;

                if (sState == "e")
                    bExpanded = true;

                if (bExpandable == "")
                    bExpandable = false;
                else if (bExpandable == "true")
                    bExpandable = true;
                else if (bExpandable == "false")
                    bExpandable = false;

                if (sSuccessor != undefined && sSuccessor != "")
                    sAction = "ins";

                if (sAction == '' || sAction == "add" || sAction == "ins" || sAction == "mod") {
                    treeData = {
                        treeId: sTreeId,
                        itemId: sNodeId,
                        text: sNodeText,
                        nodeType: sNodeType,
                        pid: sParentId,
                        pnode_type: sPNodeType,
                        st: sState,
                        pSelect: sParentSel,
                        expanded: bExpanded,
						expandable: bExpandable,
                        action: sAction,
                        successor: sSuccessor,
                        cls: sCls,
                        cs: sChildSelect,
                        qEvent: sExpandEvent,
                        expevnt: sExpandEvent,
                        qSelect: sChildSelect,
						sel: selNode
                    }
                    if (!Ramcoutil.isEmpty(sIcon))
                        treeData.icon = 'resources/images/application/' + sIcon;

                    if (Ramcoutil.isBoolean(bChecked))
                        treeData.checked = bChecked;
                    //children = me.formTreeData(treeId,sNodeId, sNodeType);

                    if (!bExpandable) {
                        delete treeData.expanded;
                        treeData.leaf = true;
                    }
					treeDatas.push(treeData);
                } else if (sAction == "del") {
					if(oTn) {
						oTn.remove();
					}
                }
                
            }
            return treeDatas;
        }
    };
})();

function XMLWriter(encoding, version) {
    if (encoding)
        this.encoding = encoding;
    if (version)
        this.version = version;
};

(function() {

    XMLWriter.prototype = {
        encoding: 'ISO-8859-1', // what is the encoding
        version: '1.0', //what xml version to use
        formatting: 'none', //how to format the output (indented/none)  ?
        indentChar: '\t', //char to use for indent
        indentation: 1, //how many indentChar to add per level
        newLine: '\n', //character to separate nodes when formatting
        xml_special_to_escaped_one_map: {
            '\'': '&apos;',
            '&': '&amp;',
            '"': '&quot;',
            '<': '&lt;',
            '>': '&gt;'
        },
        //start a new document, cleanup if we are reusing
        writeStartDocument: function(standalone) {
            this.close(); //cleanup
            this.stack = [];
            this.standalone = standalone;
        },
        //get back to the root
        writeEndDocument: function() {
            this.active = this.root;
            this.stack = [];
        },
        //set the text of the doctype
        writeDocType: function(dt) {
            this.doctype = dt;
        },
        //start a new node with this name, and an optional namespace
        writeStartElement: function(name, ns) {
            if (ns) //namespace
                name = ns + ':' + name;

            var node = {
                n: name,
                a: {},
                c: []
            }; //(n)ame, (a)ttributes, (c)hildren

            if (this.active) {
                this.active.c.push(node);
                this.stack.push(this.active);
            } else
                this.root = node;
            this.active = node;
        },
        //go up one node, if we are in the root, ignore it
        writeEndElement: function() {
            this.active = this.stack.pop() || this.root;
        },
        //add an attribute to the active node
        writeAttributeString: function(name, value) {
            if (this.active)
                this.active.a[name] = this.escapeString(value);
        },
        //add a text node to the active node
        writeString: function(text) {
            if (this.active)
                this.active.c.push(text);
        },
        escapeString: function(value) {
            var me = this;
            if (typeof value == 'string') {
                return value.replace(/([\&"'<>])/g, function(str, item) {
                    return me.xml_special_to_escaped_one_map[item];
                });
            }
            //return value || '';
			return (Ramcoutil.isEmpty(value)) ? '' : value;
        },

        //shortcut, open an element, write the text and close
        writeElementString: function(name, text, ns) {
            this.writeStartElement(name, ns);
            this.writeString(text);
            this.writeEndElement();
        },
        //add a text node wrapped with CDATA
        writeCDATA: function(text) {
            this.writeString('<![CDATA[' + text + ']]>');
        },
        //add a text node wrapped in a comment
        writeComment: function(text) {
            this.writeString('<!-- ' + text + ' -->');
        },
        //generate the xml string, you can skip closing the last nodes
        flush: function() {
            if (this.stack && this.stack[0]) //ensure it's closed
                this.writeEndDocument();

            var
                chr = '',
                indent = '',
                num = this.indentation,
                formatting = this.formatting.toLowerCase() == 'indented',
                buffer = []; //= '<?xml version='' + this.version + '' encoding='' + this.encoding + ''';

            //if (this.standalone !== undefined)
            //buffer += ' standalone='' + !!this.standalone + ''';
            //buffer += ' ?>';

            //buffer = [buffer];

            if (this.doctype && this.root)
                buffer.push('<!DOCTYPE ' + this.root.n + ' ' + this.doctype + '>');

            if (formatting) {
                while (num--)
                    chr += this.indentChar;
            }

            if (this.root) //skip if no element was added
                format(this.root, indent, chr, buffer);

            return buffer.join(formatting ? this.newLine : '');
        },
        //cleanup, don't use again without calling startDocument
        close: function() {
            if (this.root)
                clean(this.root);
            this.active = this.root = this.stack = null;
        },
        getDocument: window.ActiveXObject ?

            function() { //MSIE
                var doc = new ActiveXObject('Microsoft.XMLDOM');
                doc.async = false;
                doc.loadXML(this.flush());
                return doc;
            } :
            function() { // Mozilla, Firefox, Opera, etc.
                XMLDocument.prototype.__defineGetter__('xml', function() {
                    return new XMLSerializer().serializeToString(this);
                });
                return (new DOMParser()).parseFromString(this.flush(), 'text/xml');
            }
    };

    //utility, you don't need it
    function clean(node) {
        var l = node.c.length;
        while (l--) {
            if (typeof node.c[l] == 'object')
                clean(node.c[l]);
        }
        node.n = node.a = node.c = null;
    };

    //utility, you don't need it
    function format(node, indent, chr, buffer) {
        var
            xml = indent + '<' + node.n,
            nc = node.c.length,
            attr, child, i = 0;

        for (attr in node.a)
            xml += ' ' + attr + '="' + node.a[attr] + '"';

        xml += nc ? '>' : ' />';

        buffer.push(xml);

        if (nc) {
            do {
                child = node.c[i++];
                if (typeof child == 'string') {
                    if (nc == 1) //single text node
                        return buffer.push(buffer.pop() + child + '</' + node.n + '>');
                    else //regular text node
                        buffer.push(indent + chr + child);
                } else if (typeof child == 'object') //element node
                    format(child, indent + chr, chr, buffer);
            } while (i < nc);
            buffer.push(indent + '</' + node.n + '>');
        }
    };

})();

function Writer() {};
(function() {
    Writer.prototype = {
		//TECH-35056	
		//writeXml: function(data, taskType, taskName, tBIndex, gridId, colStatus) {
        writeXml: function(data, taskType, taskName, tBIndex, gridId, colStatus, metaViewName) {
            var me = this,
                objXml = null,
                gridData = null,
                treeData = [],
				treeMlData = [],
                len = 0,
                i = 0,
                row = null,
                selection = [],
                rowNum = 0,
                value = '',
                key,
				element = null,
                optreplace = false,
                vw,
				rtPopCollection = [],
				selData = {},
                xw = new XMLWriter('UTF-8');
            xw.writeStartDocument();
            // DefMode
			if (taskType == 'personalization' || taskType == 'defaults') {
				if (taskType == 'personalization')
					xw = me.writePersXml(xw, data, gridId);
				else
					xw = me.writeDefsXml(xw, data);
                if (typeof xw == 'string')
                    objXml = xw;
                else {
                    xw.writeEndDocument();
                    objXml = xw.flush();
                    xw.close();
                }
                return objXml;
            }
            if (taskType == 'personal') {
                xw = me.writeAppPrefXml(xw, data)
                xw.writeEndDocument();
                objXml = xw.flush();
                xw.close();
                return objXml;
            }
            if (taskType == 'fav') {
                xw = me.writeFavXml(xw, data)
                xw.writeEndDocument();
                objXml = xw.flush();
                xw.close();
                return objXml;
            }
            if (taskType == 'favchange') {
                xw = me.writeFavChangeXml(xw, data)
                xw.writeEndDocument();
                objXml = xw.flush();
                xw.close();
                return objXml;
            }
			// TECH-29773
			if (taskType == 'multisort' || taskName == 'tskstdsort') {
                xw = me.writeMultiSortXml(xw, data, gridId);
                xw.writeEndDocument();
                objXml = xw.flush();
                xw.close();
                return objXml;
            }
            xw.writeStartElement('trqi');
            xw.writeStartElement('scri');
            if (RamcoRTC.focusCtrl && taskName != 'ezwmainscdelet1ui') {
				//TECH-34304
                if((taskName == 'tskstdfiltergrid' || taskName == 'tskstdgriddefault') && RamcoRTC.focusCtrl.length == 0 && 
					RamcoRTC.lastFocusCtrl && RamcoRTC.lastFocusCtrl.length > 0){
                     xw.writeAttributeString('fc', RamcoRTC.lastFocusCtrl.join('$'));
                }else
					xw.writeAttributeString('fc', RamcoRTC.focusCtrl.join('$'));
                RamcoRTC.lastFocusCtrl = RamcoRTC.focusCtrl;
                RamcoRTC.focusCtrl = [];
            } 
			else
                xw.writeAttributeString('fc', '');
			
			//TECH-38482
			if(RamcoRTC.LastPageScrollX  != 0)
				xw.writeAttributeString('ihsp', RamcoRTC.LastPageScrollX);
			else
            	xw.writeAttributeString('ihsp', '0');
			if(RamcoRTC.LastPageScrollY != 0  )	
				xw.writeAttributeString('ivsp', RamcoRTC.LastPageScrollY);
			else
	            xw.writeAttributeString('ivsp', '0');
            xw.writeAttributeString('TaskType', (taskName == 'ezwmainscdelet1ui') ? 'ui' : taskType);
            /*
            if(taskType == "link"){
            	xw.writeStartElement('ci');
            	xw.writeStartElement('c');
            	xw.writeAttributeString('n', data[0].id);
            	xw.writeAttributeString('v', data[0].vl);
            	xw.writeEndElement();
            	xw.writeEndElement();
            	xw.writeEndElement();
            	xw.writeEndElement();
            	xw.writeEndDocument();
            	objXml = xw.flush();				
            	xw.close();
            	return objXml;
            	
            }
            */
            if (taskName == 'tskstdgo') {
                xw.writeAttributeString('TrailBarIndex', tBIndex);
            }
            if (taskName == 'tskstdgriddefault') {
                xw.writeStartElement('ci');
                xw.writeStartElement('c');
                xw.writeAttributeString('n', gridId);
                xw.writeAttributeString('vsi', "1");
                xw.writeAttributeString('hsp', "1");
                xw.writeAttributeString('vsp', "1");
                xw.writeStartElement('did');
                for (key in data) {
                    if (key == 'optonlyblank')
                        continue;
                    else if (key == 'chkcurrent' || key == 'optreplace') {
                        if (key == 'optreplace') {
                            optreplace = true;
                            continue;
                        } else if (data[key]) {
                            xw.writeAttributeString('um', "1");
                            xw.writeAttributeString('psr', "1");
                        } else {
                            xw.writeAttributeString('um', "0");
                        }
                    }
                    xw.writeStartElement('vw');
                    if (key.startsWith('v'))
                        xw.writeAttributeString('n', key.replace('v', ''));
                    else
                        xw.writeAttributeString('n', key);
                    xw.writeAttributeString('ft', data[key]);
                    xw.writeAttributeString('v', data[key]);
                    xw.writeAttributeString('fcnd', "");
					
                    if (optreplace || data["optreplace"] == true)
                        xw.writeAttributeString('owr', "1");
                    xw.writeEndElement();
                }
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndDocument();
                objXml = xw.flush();
                xw.close();
                return objXml;
            }
			if (taskName == 'tskstdfiltergrid') {
                xw.writeStartElement('ci');
                xw.writeStartElement('c');
                xw.writeAttributeString('n', gridId);
                xw.writeAttributeString('vsi', "1");
                xw.writeAttributeString('hsp', "1");
                xw.writeAttributeString('vsp', "1");
                xw.writeStartElement('fid');
                for (key in data) {
                    if (key == 'optonlyblank')
                        continue;
                    else if (key == 'chkcurrent' || key == 'optreplace') {
                        if (key == 'optreplace') {
                            optreplace = true;
                            continue;
                        } else if (data[key]) {
                            xw.writeAttributeString('um', "1");
                            xw.writeAttributeString('psr', "1");
                        } else {
                            xw.writeAttributeString('um', "0");
                        }
                    }
					if(!Ramcoutil.isEmpty(data[key])) {
						xw.writeStartElement('vw');
						if (key.startsWith('v'))
							xw.writeAttributeString('n', key.replace('v', ''));
						else
							xw.writeAttributeString('n', key);
						xw.writeAttributeString('ft', data[key]);
						xw.writeAttributeString('v', data[key]);
						xw.writeAttributeString('fcnd', "");
						if (optreplace)
							xw.writeAttributeString('owr', "1");
						xw.writeEndElement();
					}
                }
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndDocument();
                objXml = xw.flush();
                xw.close();
                return objXml;
            }
            if (data && data.gridId) {
                xw.writeStartElement('ci');
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeStartElement('pi');
                xw.writeStartElement('ci');
                xw.writeStartElement('c');
                xw.writeAttributeString('n', data.gridId);
                xw.writeAttributeString('ct', 'RSGrid');
                xw.writeStartElement('vws');
                for (key in data) {
                    if (key == 'gridId')
                        continue;
                    xw.writeStartElement('vw');
                    xw.writeAttributeString('n', key);
                    xw.writeAttributeString('coldefval', data[key]);
                    xw.writeAttributeString('coldefactive', colStatus);

                    xw.writeEndElement();

                }

                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
                objXml = xw.flush();
                xw.close();
                return objXml;
            }
            xw.writeStartElement('ci');
			
			// TECH-30607
           if (data && (data.length > 0 || data.msortData)) {
				// TECH-31371
				if (data.msortData) {
					xw.writeStartElement('c');
                    xw.writeAttributeString('n', gridId);
					xw.writeAttributeString('ct', "RSGrid");
					var appData = data.msortData;
					if (appData && appData.length > 0) {
						xw.writeStartElement('sd');
						for (var j = 0; j < appData.length; j++) {
							xw.writeStartElement('vw');
							xw.writeAttributeString('vn', appData[j].view);
							xw.writeAttributeString('so', appData[j].so);
							xw.writeEndElement();
						}
						xw.writeEndElement();
					}
					xw.writeEndElement();
					// TECH-31371
					if (data.length == 0) {
						objXml = xw.flush();
						xw.close();
						return objXml;
					}
					
				}
				
				var dlen = data.length,
					k = 0,
					element = null,
					scnSplitArr; //TECH-30667	
				//data.forEach(function(element, index, array) {
				for(; k<dlen; k++) {
					element = data[k];
                    if (element.tree) {
                        treeData.push(element);
                        continue;
                    }
					if (element.treeMlData) {
						treeMlData.push(element);
                        continue;
					}
                    selection = [];
					//RT POP
					if(element.rtPop) {
						rtPopCollection.push(element.id);						
					}
					else {
						xw.writeStartElement('c');
						xw.writeAttributeString('n', element.id);
						//Slider Control
						if(element.slider) {
							xw.writeAttributeString('ct', "RSSlider");	
							xw.writeAttributeString('endv', element.vl);
							xw.writeAttributeString('v', element.vl);
						}
						//Pivot
						else if (element.psc) {
							xw.writeStartElement('psc');
							xw.writeAttributeString('dk', element.v);
							xw.writeEndElement();
						}
						else if (element.pcf) {
							var i=0,len=0,axis,pcf;
							pcf = element.vl;
							xw.writeStartElement('pcf');
							//leftaxis
							xw.writeStartElement('rws');
							len= pcf.leftAxis.length;
							for (;i<len; i++) {
								axis = pcf.leftAxis[i];
								xw.writeStartElement('vw');
								xw.writeAttributeString('n', axis.dataIndex.replace('v', ''));
								xw.writeEndElement();
							}
							xw.writeEndElement();
							//topaxis
							i=0;
							len= pcf.topAxis.length;
							xw.writeStartElement('cls');
							for (;i<len; i++) {
								axis = pcf.topAxis[i];
								xw.writeStartElement('vw');
								xw.writeAttributeString('n', axis.dataIndex.replace('v', ''));
								xw.writeEndElement();
							}
							xw.writeEndElement();
							//aggaxis
							xw.writeStartElement('fts');
							i=0;
							len= pcf.aggregate.length;
							for (;i<len; i++) {
								axis = pcf.aggregate[i];
								xw.writeStartElement('vw');
								xw.writeAttributeString('n', axis.dataIndex.replace('v', ''));
								xw.writeAttributeString('agg', (axis.aggregator == 'avg' ? 'average' : axis.aggregator));
								xw.writeEndElement();
							}
							xw.writeEndElement();
							xw.writeEndElement();
						}					
						else if (element.ml) {
							gridData = element.vl;
							xw.writeAttributeString('vsi', gridData.vsi.toString());
							if (gridData.cr)
								xw.writeAttributeString('cr', gridData.cr.toString());
							if (element.rsListView) {
								xw.writeAttributeString('ct', 'RSListView');
							}
							else {
								if (taskName == 'ezwmainscdelet1ui')
									xw.writeAttributeString('ct', 'RSGrid');
								else
									xw.writeAttributeString('nsr', gridData.nsr.toString());
							}
							if (element.task == 'tskstdchkall' || element.task == 'tskstdunchkall') {
								if (taskName == 'tskstdchkall' || taskName == 'tskstdunchkall') {
									xw.writeAttributeString('clmnchkAll', 'true');
									xw.writeAttributeString('chkViewName', tBIndex);
									xw.writeAttributeString('chkValue', (taskName == 'tskstdchkall')?'1':'0');
								}
							}
							xw.writeStartElement('id');
							if (taskName == 'ezwmainscdelet1ui') {
								var _data = (element.md) ? element.md.data : null,
									i = 0,
									row = element.vl.r[0];

								if (!_data)
									return;

								xw.writeStartElement('r');
								xw.writeAttributeString('rn', row.rn);
								xw.writeAttributeString('sel', '0');
								for (n in _data) {
									if (n != 'rn' && n != 'sel' && n != '_mod' && n != 'id' && n.indexOf("c") < 0) {
										var _val = (n == "v14") ? _data["v11"] : _data[n];
										if (_val.indexOf('"') > -1)
											_val = _val.replace(new RegExp('"', 'g'), '&quot;');
										xw.writeStartElement('vw');
										xw.writeAttributeString('n', n.replace('v', ''));
										xw.writeAttributeString('v', '' + _val);
										xw.writeEndElement();
									}
								}
								xw.writeEndElement();
								xw.writeEndElement();

								xw.writeStartElement('sri');
								i = 0;
								gridData = data[0].vl;
								for (;(i < gridData.vr) && (i < gridData.tr); i++) {
									rowNum = parseInt(i + gridData.si);
									xw.writeStartElement('r');
									xw.writeAttributeString('rn', rowNum);
									xw.writeAttributeString('sel', '0');
									xw.writeEndElement();
								}
								xw.writeEndElement();
							} 
							else {
								if (gridData.r && gridData.r.length > 0) {
									i = 0;
									len = gridData.r.length;
									for (; i < len; i++) {
										row = gridData.r[i];
										/*if (row.sel) {
											selection[row.rn] = '1';
										} else {
											selection[row.rn] = '0';
										}*/
										if (row['_mod']) {
											xw.writeStartElement('r');
											xw.writeAttributeString('rn', row.rn);
											if (row.sel) {
												xw.writeAttributeString('sel', '1');
											} else {
												xw.writeAttributeString('sel', '0');
											}
											for (n in row) {
												//if (n != 'rn' && n != 'sel' && n != '_mod') {
												if (n != 'rn' && n != 'sel' && n != '_mod' && n != 'uplTemp') {	
													xw.writeStartElement('vw');
													xw.writeAttributeString('n', n.replace('v', ''));
													//TECH-30667			
													//xw.writeAttributeString('v', '' + row[n]);
													//TECH-30923
													if (!Ramcoutil.isEmpty(row[n]) && Ramcoutil.isString(row[n])) {
														scnSplitArr = row[n].split(":!#@SCN@#!:");
														if(scnSplitArr.length > 1)
														{
															xw.writeAttributeString('v', (scnSplitArr.length >= 1) ? scnSplitArr[0] : "");
															xw.writeAttributeString('nl', (scnSplitArr.length >= 2) ? scnSplitArr[1] : "");
															xw.writeAttributeString('at',(scnSplitArr.length >=3 ) ? scnSplitArr[2] : "");													
														}
														else {
															xw.writeAttributeString('v', '' + row[n]);
														}
													}
													else {
														xw.writeAttributeString('v', '' + row[n]);
													}
	                                                xw.writeEndElement();
												}
											}
											xw.writeEndElement();
										}
									}
								}
								xw.writeEndElement();
								//TECH-30391
								//if (gridData.selection.length > 0 && taskName != 'ezwmainscdelet1ui') {
								if (gridData.selection && gridData.selection.length > 0 && taskName != 'ezwmainscdelet1ui') {
									xw.writeStartElement('sri');
									i = 0;
									 for (; i < gridData.selection.length; i++) {
										//rowNum = parseInt(i + gridData.si);
										//rowNum = i;
										//if (!Ramcoutil.isEmpty(selection[rowNum])) {
											xw.writeStartElement('r');
											//xw.writeAttributeString('rn', rowNum);
											//xw.writeAttributeString('sel', selection[rowNum]);
											xw.writeAttributeString('rn', gridData.selection[i].rn);
											xw.writeAttributeString('sel', gridData.selection[i].sel);
											xw.writeEndElement();
										/* } else {
											xw.writeStartElement('r');
											xw.writeAttributeString('rn', rowNum);
											xw.writeAttributeString('sel', '0');
											xw.writeEndElement();
										} */
                                }
                                xw.writeEndElement();
								// TECH-37768
								if (gridData.el && gridData.el.length > 0) {
									xw.writeStartElement('el');
										i = 0;
										for (; i < gridData.el.length; i++) {
											xw.writeStartElement('ev');
												xw.writeAttributeString('n', gridData.el[i]);
											xw.writeEndElement();
										}
									xw.writeEndElement();
								}
								// TECH-29773
								// TECH-31371
								if (gridId == element.id) {
									var appData = (data.msortData) ? data.msortData : null;
									if (appData) {
										xw.writeStartElement('sd');
										for (var j = 0; appData && appData.length > 0 && j < appData.length; j++) {
											xw.writeStartElement('vw');
											xw.writeAttributeString('vn', appData[j].view);
											xw.writeAttributeString('so', appData[j].so);
											xw.writeEndElement();
										}
										xw.writeEndElement();
									}
								}
                            }
                        }
                    }
					else if (element.treeml) {
						gridData = element.vl;
						xw.writeAttributeString('vsi', gridData.vsi.toString());                        
							xw.writeAttributeString('cr', store.cr);
							xw.writeAttributeString('ct', 'RSGrid');
							xw.writeStartElement('id');
							xw.writeEndElement();
							if (gridData.r && gridData.r.length > 0) {
								var i = 0;
								len = gridData.r.length;
								for (; i < len; i++) {
									row = gridData.r[i];
									if (row.sel) {
										selection[row._rn] = '1';
									} else {
										selection[row._rn] = '0';
									}								
								}
							}
							if (selection.length > 0 && taskName != 'ezwmainscdelet1ui') {
								xw.writeStartElement('sri');
								i = 0;
								for (;
									(i < gridData.vr) && (i < gridData.tr); i++) {
									rowNum = parseInt(i + gridData.si);
									if (!Ramcoutil.isEmpty(selection[rowNum])) {
										xw.writeStartElement('r');
										xw.writeAttributeString('rn', rowNum);
										xw.writeAttributeString('sel', selection[rowNum]);
										xw.writeEndElement();
									} else {
										xw.writeStartElement('r');
										xw.writeAttributeString('rn', rowNum);
										xw.writeAttributeString('sel', '0');
										xw.writeEndElement();
									}
								}
								xw.writeEndElement();
							}                        
						}
						else if (element.ddt) {
							gridData = element.vl;
							xw.writeAttributeString('vsi', gridData.vsi.toString());
							if (gridData.cr)
								xw.writeAttributeString('cr', gridData.cr.toString());
							if (taskName == 'ezwmainscdelet1ui')
								xw.writeAttributeString('ct', 'RSGrid');
							else
								xw.writeAttributeString('nsr', gridData.nsr.toString());
							if(taskName == 'tskstdchkall' || taskName == 'tskstdunchkall'){
								xw.writeAttributeString('clmnchkAll', 'true');
								xw.writeAttributeString('chkViewName', tBIndex);
								xw.writeAttributeString('chkValue', (taskName == 'tskstdchkall')?'1':'0');
							}
							xw.writeStartElement('id');
							if (taskName == 'ezwmainscdelet1ui') {
								var _data = (element.md) ? element.md.data : null,
									i = 0,
									row = element.vl.r[0];

								if (!_data)
									return;

								xw.writeStartElement('r');
								xw.writeAttributeString('rn', row.rn);
								xw.writeAttributeString('sel', '0');
								for (n in _data) {
									if (n != 'rn' && n != 'sel' && n != '_mod' && n != 'id' && n.indexOf("c") < 0) {
										var _val = (n == "v14") ? _data["v11"] : _data[n];
										if (_val.indexOf('"') > -1)
											_val = _val.replace(new RegExp('"', 'g'), '&quot;');
										xw.writeStartElement('vw');
										xw.writeAttributeString('n', n.replace('v', ''));
										xw.writeAttributeString('v', '' + _val);
										xw.writeEndElement();
									}
								}
								xw.writeEndElement();
								xw.writeEndElement();

								xw.writeStartElement('sri');
								i = 0;
								gridData = data[0].vl;
								for (;(i < gridData.vr) && (i < gridData.tr); i++) {
									rowNum = parseInt(i + gridData.si);
									xw.writeStartElement('r');
									xw.writeAttributeString('rn', rowNum);
									xw.writeAttributeString('sel', '0');
									xw.writeEndElement();
								}
								xw.writeEndElement();
							} 
							else {
								if (gridData.r && gridData.r.length > 0) {
									i = 0;
									len = gridData.r.length;
									for (; i < len; i++) {
										selData = {};
										row = gridData.r[i];
										if (row.sel) {
											selData.rn = row.rn;
											selData.sel = '1';
											selection[i + 1] = selData;
											//selection[row.rn] = '1';
										} else {
											selData.rn = row.rn;
											selData.sel = '0';
											selection[i + 1] = selData;
											//selection[row.rn] = '0';
										}
										if (row['_mod']) {
											xw.writeStartElement('r');
											xw.writeAttributeString('rn', row.rn);
											if (row.sel) {
												xw.writeAttributeString('sel', '1');
											} else {
												xw.writeAttributeString('sel', '0');
											}
											for (n in row) {
												if (n != 'rn' && n != 'sel' && n != '_mod') {
													xw.writeStartElement('vw');
													xw.writeAttributeString('n', n.replace('v', ''));
													xw.writeAttributeString('v', '' + row[n]);
													xw.writeEndElement();
												}
											}
											xw.writeEndElement();
										}
									}
								}
								xw.writeEndElement();
								if (selection.length > 0 && taskName != 'ezwmainscdelet1ui') {
									xw.writeStartElement('sri');
									i = 0;
									for (;
										(i < gridData.vr) && (i < gridData.tr); i++) {
										rowNum = parseInt(i + gridData.si);
										if (!Ramcoutil.isEmpty(selection[rowNum])) {
											xw.writeStartElement('r');
											//xw.writeAttributeString('rn', rowNum);
											//xw.writeAttributeString('sel', selection[rowNum]);
											xw.writeAttributeString('rn', selection[rowNum].rn);
											xw.writeAttributeString('sel', selection[rowNum].sel);
											xw.writeEndElement();
										} else {
											xw.writeStartElement('r');
											xw.writeAttributeString('rn', rowNum);
											xw.writeAttributeString('sel', '0');
											xw.writeEndElement();
										}
									}
									xw.writeEndElement();
								}
							}
						} 
						else if(element.rstree) {						
							gridData = element.vl;
							console.log('totalrow' + gridData.tr);
							if(gridData.vsi)
								xw.writeAttributeString('vsi', gridData.vsi.toString());
							if (gridData.cr)
								xw.writeAttributeString('cr', gridData.cr.toString());                        
							if(taskName == 'tskstdchkall' || taskName == 'tskstdunchkall'){
								xw.writeAttributeString('clmnchkAll', 'true');
								xw.writeAttributeString('chkViewName', tBIndex);
								xw.writeAttributeString('chkValue', (taskName == 'tskstdchkall')?'1':'0');
							}
							xw.writeStartElement('id');
							if (gridData.r && gridData.r.length > 0) {
								i = 0;
								len = gridData.r.length;
								for (; i < len; i++) {
									row = gridData.r[i];
									if (row.sel) {
										selection[row.rn] = '1';
									} else {
										selection[row.rn] = '0';
									}
									if (row['_mod']) {
										xw.writeStartElement('r');
										xw.writeAttributeString('rn', row.rn);
										if (row.sel) {
											xw.writeAttributeString('sel', '1');
										} else {
											xw.writeAttributeString('sel', '0');
										}
										for (n in row) {
											if (n != 'rn' && n != 'sel' && n != '_mod') {
												if (n== 'pnid' && Ramcoutil.isEmpty(row[n])) {
													continue;
												}
												xw.writeStartElement('vw');
												xw.writeAttributeString('n', n.replace('v', ''));
												xw.writeAttributeString('v', '' + row[n]);
												xw.writeEndElement();
											}
										}
										xw.writeEndElement();
									}
								}
							}
							xw.writeEndElement();
							console.log('totalrow' + gridData.tr);
							if (selection.length > 0 && taskName != 'ezwmainscdelet1ui') {
								xw.writeStartElement('sri');
								i = 0;
								srn = 0;
								//for (;(i < gridData.tr); i++) {
								for (;(i < gridData.r.length); i++) {
									srn = gridData.r[i].rn
									console.log('inside sri' + srn + ' ' + selection[srn]);
									//rowNum = parseInt(i + gridData.si);
									//rowNum = parseInt(i + 1);
									if (!Ramcoutil.isEmpty(selection[srn])) {
										xw.writeStartElement('r');
										xw.writeAttributeString('rn', srn);
										xw.writeAttributeString('sel', selection[srn]);
										xw.writeEndElement();
									} else {
										xw.writeStartElement('r');
										xw.writeAttributeString('rn', srn);
										xw.writeAttributeString('sel', '0');
										xw.writeEndElement();
									}
								}
								xw.writeEndElement();
							}
						}
						else if (element.sl) {
							gridData = element.vl;
							xw.writeAttributeString('ct', 'RSStackedLinks');
							xw.writeAttributeString('vsi', gridData.vsi);
							xw.writeAttributeString('cr', gridData.cr);
							xw.writeAttributeString('sel', gridData.cr);
							xw.writeAttributeString('lktl', gridData.lktl);
						} else if (element.pl) {
							xw.writeAttributeString('v', element.vl);
							xw.writeAttributeString('ed', 'yes');
						} else {
							xw.writeAttributeString('v', element.vl);
							if (element.nl || element.at) {
								xw.writeAttributeString('nl', element.nl);
								xw.writeAttributeString('at', element.at);
							}
						}
						xw.writeEndElement();
					}
				}
				//);
            }
            xw.writeEndElement();
			if(data && taskName == 'ezwmainscPerforTr' || taskName == 'saveuserpassword' || (taskType == 'trans' && taskName != 'tskstdscreeninit' && taskName != 'tskstdlaunch') || rtPopCollection.length > 0) {
				xw.writeStartElement('lci');
				if (rtPopCollection.length > 0) {
					for (var key in rtPopCollection) {
						xw.writeStartElement('c');
						xw.writeAttributeString('n', rtPopCollection[key]);
						xw.writeAttributeString('shwpup', '0');
						xw.writeEndElement();
					}
				}
				if(!Ramcoutil.isEmpty(data)) {
					for (var key in data) {
						if(data[key].id == 'statesecs') {
							for (var k = 0; data[key].v1 && k < data[key].v1.length; k++) {
								xw.writeStartElement('c');
								xw.writeAttributeString('n', data[key].v1[k].id);
								xw.writeAttributeString('sc', data[key].v1[k].collapsed);
								xw.writeEndElement();
							}
							break;
						}
					}						
				}
				xw.writeEndElement();
				Ext.util.Cookies.set('lang', 1);
			}
            if (data && data.snbNum) {
                xw.writeStartElement('nbi');
                xw.writeStartElement('mtr');
                xw.writeAttributeString('rn', data.snbNum);
                xw.writeEndElement();
                xw.writeEndElement();
            }
            if (data && data.snbAction) {
                xw.writeStartElement('nbi');
                xw.writeStartElement('mtr');
                xw.writeAttributeString('act', data.snbAction);
                xw.writeEndElement();
                xw.writeEndElement();
            }
			//TECH-35056
            if(taskType == 'tskstdextendedlaunch') {
				me.writeMetaLinkXml(xw, data, metaViewName);                
			}
            xw.writeEndElement();
            // Personalization
            if (data && data.pers) {
                xw.writeStartElement('pi');
                xw.writeStartElement('ci');
                xw.writeStartElement('c');
                xw.writeAttributeString('n', data.pers.gridId);
                xw.writeAttributeString('ct', 'RSGrid');
				/* if (data.pers.fc && data.pers.fc > 0)					
					xw.writeAttributeString('fc', data.pers.fc); */
				if (!Ramcoutil.isEmpty(data.pers.fc))
					xw.writeAttributeString('fc', data.pers.fc);
                xw.writeStartElement('vws');
                for (key in data.pers) {
                    vw = data.pers[key];
                    if (vw.pa && (vw.wi || vw.choosed)) {
                        xw.writeStartElement('vw');
                        xw.writeAttributeString('n', key.replace('v', ''));
                        if (!Ramcoutil.isEmpty(vw.choosed))
                            xw.writeAttributeString('choosed', vw.choosed);
                        if (!Ramcoutil.isEmpty(vw.wi))
                            xw.writeAttributeString('wi', vw.wi);
                        xw.writeEndElement();
                    }
                }
                xw.writeEndElement();
                if (data.pers.vseq) {
                    xw.writeStartElement('vseq');
                    for (key in data.pers.vseq) {
                        vw = data.pers.vseq[key];
                        xw.writeStartElement('n');
                        xw.writeString(vw);
                        xw.writeEndElement();
                    }
                    xw.writeEndElement();
                }
                xw.writeEndElement();
                xw.writeEndElement();
                xw.writeEndElement();
            }
            if (treeData.length > 0)
                me.writeCustomXml(xw, treeData);
			//AHBG-25919, AHBG-25777, AHBG-24045, AHBG-24044
			if (treeMlData.length > 0)
				me.writeCustomTreeGridXml(xw, treeMlData);
            xw.writeEndElement();
            xw.writeEndDocument();
            objXml = xw.flush();
            xw.close();
			if(data && data.customPayLoad)
				objXml = objXml.replace("</trqi>" , data.customPayLoad + "</trqi>");        
            return objXml;
        },
		writeCustomXml: function(xw, treeData) {
            if (treeData && treeData.length > 0) {
				var len = treeData.length,
					i = 0,
					element = null;
				for(;i < len;i++) {
					element = treeData[i];
					//treeData.forEach(function(element, index, array) {
                    xw.writeStartElement('ctrqi');
                    xw.writeStartElement('tcs');
                    xw.writeStartElement('tc');
                    xw.writeAttributeString('id', element.id);
                    if (element.stp)
                        xw.writeAttributeString("stp", element.stp);
                    if (element.sll)
                        xw.writeAttributeString("sll", element.sll);
                    if (element.sel)
                        xw.writeAttributeString("sel", element.sel);
					if (element.vl) {
						for (var v=0; v < element.vl.length; v++) {
							xw.writeStartElement("tns");
							xw.writeStartElement("tn");
							xw.writeAttributeString("id", element.vl[v].value);
							if (element.st)
								xw.writeAttributeString("st", element.vl[v].st);
							xw.writeEndElement();
							xw.writeEndElement();
						}
					}
                    xw.writeEndElement();
                    xw.writeEndElement();
                    xw.writeEndElement();
                }
				//);
            }
        },
		//AHBG-25919, AHBG-25777, AHBG-24045, AHBG-24044
        writeCustomTreeGridXml: function(xw, treeData) {
            if (treeData && treeData.length > 0) {
				var len = treeData.length,
					i = 0,
					element = null;
				for(;i < len;i++) {
					element = treeData[i];					
                    xw.writeStartElement('ctrqi');
						xw.writeStartElement('tcs');
							xw.writeStartElement('tc');
								xw.writeAttributeString('id', element.id);
								if (element.stp)
									xw.writeAttributeString("stp", element.stp);
								if (element.sll)
									xw.writeAttributeString("sll", element.sll);
								if (element.sel)
									xw.writeAttributeString("sel", element.sel);
								xw.writeStartElement("tns");									
										var treeModData = element.vl;
										var treeModRow = treeModData.r;
										var treeModRowLen = treeModRow.length;
										for (var trd = 0; trd < treeModRowLen; trd++) {
											xw.writeStartElement("tn");
												var curTreeRow = treeModRow[trd];
												xw.writeAttributeString("id", curTreeRow.id);													
												xw.writeAttributeString("st", curTreeRow.st);
											xw.writeEndElement();
										}
								xw.writeEndElement();
							xw.writeEndElement();
						xw.writeEndElement();
                    xw.writeEndElement();
                }				
            }
        },
        writePersXml: function(xw, persData, gridId) {
            if (persData) {
                var view,
                    vw,
                    vwNode,
                    prop,
                    props,
                    propNode,
                    temp,
                    temps,
                    tempNode,
                    ctrlData = null,
                    name = 'default',
                    type = '6',
                    ctrlNode,
                    ctrls,
                    ctrl,
                    node,
                    count,
                    gridNode,
                    grids,
                    roleVal,
					hasPersistence = persData && persData.hasSortPersistence, // TECH-34273
					errorMsg, // TECH-33523 / SDC-56
                    grid;
                xw.writeStartElement('VWRules');
                xw.writeStartElement('Templates');
				
				// TECH-34273
				if (hasPersistence == true) {
					xw.writeStartElement('Template');
						xw.writeAttributeString('name', name);
						xw.writeAttributeString('type', type);
						
						if (persData.length > 0) {
							xw.writeStartElement('Grid');
								xw.writeAttributeString('name', gridId);
								for (var k = 0; k < persData.length; k++) {
									xw.writeStartElement('View');
										xw.writeAttributeString('name', persData[k].view);
										xw.writeStartElement('SetProperty');
											xw.writeAttributeString('type', 'Column');
											xw.writeAttributeString('name', 'so');
											xw.writeAttributeString('value', persData[k].so);
										xw.writeEndElement();
									xw.writeEndElement();
								}
							xw.writeEndElement();
						}						
						
					xw.writeEndElement();					
				}
				else {
					for (temp in persData) {
						if (temp == 'xml')
							continue;
						tempNode = persData[temp];
						if (temp == '2') {
							for (task in tempNode) {
								xw.writeStartElement('Template');
								xw.writeAttributeString('name', task);
								xw.writeAttributeString('type', '2');
								for (ctrl in tempNode[task]) {
									count = 0;
									// TECH-33523 / SDC-56
									errorMsg = tempNode[task][ctrl].errormessage;
									if (!Ramcoutil.isEmpty(errorMsg)) {
										xw.writeStartElement('Condition');
										xw.writeAttributeString('allroleschecked', tempNode[task][ctrl]['allroles']);
										xw.writeAttributeString('alltaskschecked', tempNode[task][ctrl]['alltasks']);
										xw.writeStartElement('Eval');
										roleVal = "";
										if(!tempNode[task][ctrl]['allroles']){
											for (role in tempNode[task][ctrl]['roles']) {
												if (count == 0) {
													roleVal += '(vwlowercase([~role])== "' + role + '"';
													count++;
												}
												else
													roleVal += '|| vwlowercase([~role])== "' + role + '"';
											}
											roleVal += ')&&'+ persData[RamcoRTC.currentTemplate].data[ctrl]['dataType'] +'([#' + ctrl + '.' + ctrl + '])';
										}
										else
											roleVal += persData[RamcoRTC.currentTemplate].data[ctrl]['dataType']+'([#' + ctrl + '.' + ctrl + '])';
		
										xw.writeCDATA(roleVal);
										xw.writeEndElement();
										xw.writeStartElement('TrueCond');
										xw.writeStartElement('SetMessage');
										xw.writeAttributeString('Id', '3');
										xw.writeAttributeString('Desc', errorMsg);
										xw.writeAttributeString('Severity', '5');
										xw.writeEndElement();
										xw.writeEndElement();
										xw.writeEndElement();
									}
								}
								xw.writeEndElement();
							}
							continue;
						}
						
						name = temp || 'default';					
						type = (name != 'default') ? '7' : '6';
						xw.writeStartElement('Template');
						xw.writeAttributeString('name', name);
						xw.writeAttributeString('type', type);
						
						for (ctrl in tempNode.data) {
							if (tempNode && tempNode.data[ctrl] && tempNode.data[ctrl].type == 'grid') {
								xw.writeStartElement('Grid');
								xw.writeAttributeString('name', ctrl);
								for (view in tempNode.data[ctrl]) {
									if (view == 'type')
										continue;
									xw.writeStartElement('View');
									xw.writeAttributeString('name', view.replace('v', ''));
									if (!Ramcoutil.isEmpty(tempNode.data[ctrl][view].sv)) {
										xw.writeStartElement('SetProperty');
										xw.writeAttributeString('type', 'Column');
										xw.writeAttributeString('name', 'sv');
										xw.writeAttributeString('value', (tempNode.data[ctrl][view].sv == true) ? 'n' : 'y');
										xw.writeEndElement();
									}
									if (!Ramcoutil.isEmpty(tempNode.data[ctrl][view].scc)) {
										xw.writeStartElement('SetProperty');
										xw.writeAttributeString('type', 'Column');
										xw.writeAttributeString('name', 'scc');
										xw.writeAttributeString('value', tempNode.data[ctrl][view].scc);
										xw.writeEndElement();
									}
									xw.writeEndElement();
								}
								xw.writeEndElement();
							} else {
								//if(tempNode.data[ctrl].sc){
									//xw.writeStartElement('LayoutControl');
								//}else{
								//} 							
								if(typeof tempNode.data[ctrl]['ctrlType'] !== "undefined"){
									xw.writeStartElement(tempNode.data[ctrl]['ctrlType']);//TECH-26897
									delete tempNode.data[ctrl]['ctrlType'];
								}
								if(typeof tempNode.data[ctrl]['dataType'] !== "undefined"){//TECH-29763/TAQ-121
									delete tempNode.data[ctrl]['dataType'];
								}
															
								xw.writeAttributeString('name', ctrl);
								for (prop in tempNode.data[ctrl]) {
									if (prop == 'mand' || prop == 'task' || prop == 'role' || prop == 'error')
										continue;
									if (prop == 'value') {
										xw.writeStartElement('SetValue');
										if(tempNode.data[ctrl][prop] && tempNode.data[ctrl][prop].indexOf('"') == 0)
											xw.writeCDATA(tempNode.data[ctrl][prop]);
										else
											xw.writeCDATA('"' + tempNode.data[ctrl][prop] + '"');
										xw.writeEndElement();
									} else {
										xw.writeStartElement('SetProperty');
										xw.writeAttributeString('type', 'Control');
										xw.writeAttributeString('name', prop);
										xw.writeAttributeString('value', tempNode.data[ctrl][prop]);
										xw.writeEndElement();
									}
								}
								if (!tempNode.data[ctrl]['sbc'] && name == 'default') {
									xw.writeStartElement('SetProperty');
									xw.writeAttributeString('type', 'Control');
									xw.writeAttributeString('name', 'sbc');
									xw.writeAttributeString('value', 'white');
									xw.writeEndElement();
								}
								xw.writeEndElement();
							}
						}
						
						xw.writeEndElement();
					}
				}				
                
                xw.writeEndElement();
                xw.writeEndElement();
            }
            return xw;
        },
		// DefMode
		writeDefsXml: function(xw, persData) {
            if (persData) {
                var temp,
                    tempNode,
                    name = 'default',
                    type = '6',
					defTemp,
                    ctrl,
					data,
					value;
					
                xw.writeStartElement('VWRules');
					xw.writeStartElement('Templates');
						for (temp in persData) {
							if (temp == 'xml' || temp == 'default') // DefModeChanges
								continue;
							tempNode = persData[temp];
							name = temp || 'default',
							type = (name != 'default') ? '7' : '6',
							xw.writeStartElement('Template');
								xw.writeAttributeString('name', name);
								xw.writeAttributeString('type', type);								
								data = tempNode.data;
								defTemp = (data && data.defTemp) ? name : null;
								for (ctrl in data) {
									if (ctrl == 'defTemp')
										continue;
									value = data[ctrl].value;
									xw.writeStartElement('Control');
										xw.writeAttributeString('name', ctrl);
										xw.writeStartElement('SetValue');											
											xw.writeCDATA('"' + value + '"');
										xw.writeEndElement();
									xw.writeEndElement();
								}
							xw.writeEndElement();
							
							if (!Ramcoutil.isEmpty(defTemp)) {
								xw.writeStartElement('Template');
									xw.writeAttributeString('name', 'default');
									xw.writeAttributeString('type', '6');
									xw.writeAttributeString('mapped_template', defTemp);
									for (ctrl in data) {
										if (ctrl == 'defTemp')
											continue;
										value = data[ctrl].value;
										xw.writeStartElement('Control');
											xw.writeAttributeString('name', ctrl);
											xw.writeStartElement('SetValue');											
												xw.writeCDATA('"' + value + '"');
											xw.writeEndElement();
										xw.writeEndElement();
									}
								xw.writeEndElement();
								RamcoRTC.defTemplate = defTemp;
							}
							
						}
					xw.writeEndElement();
                xw.writeEndElement();
            }
            return xw;
        },
        writeAppPrefXml: function(xw, appData) {
            if (appData && appData.length > 0) {
                var i = 0;
                xw.writeStartElement('appsettpref');
                for (; i < appData.length; i++) {
                    xw.writeStartElement('opt');
                    xw.writeAttributeString('optname', appData[i][0]);
                    xw.writeAttributeString('optval', appData[i][1]);
                    xw.writeEndElement();
                }
                xw.writeEndElement();
            }
            return xw;
        },
        writeFavXml: function(xw, appData) {
            xw.writeStartElement('fav_grp');
            xw.writeAttributeString('comp', appData[2].componentName);
            xw.writeAttributeString('act', appData[2].activityName);
            xw.writeAttributeString('ilbo', appData[2].ilboName);
            xw.writeStartElement('cat');
            xw.writeAttributeString('cdesc', appData[0]);
            xw.writeAttributeString('seq', appData[1]);
            xw.writeAttributeString('mapped', '1');
            xw.writeAttributeString('isnew', '1');
            xw.writeAttributeString('cname', appData[0]);
            xw.writeEndElement();
            xw.writeEndElement();
            return xw;
        },
        writeFavChangeXml: function(xw, appData) {
            if (appData && appData.length > 0) {
                xw.writeStartElement('fav_grp');
                xw.writeAttributeString('comp', appData[1].componentName);
                xw.writeAttributeString('act', appData[1].activityName);
                xw.writeAttributeString('ilbo', appData[1].ilboName);
                for (i in appData[0]) {
                    xw.writeStartElement('cat');
                    xw.writeAttributeString('cdesc', appData[0][i].text);
                    xw.writeAttributeString('seq', appData[0][i].catseq);
                    xw.writeAttributeString('mapped', (!appData[0][i].checked) ? '0' : '1');
                    xw.writeAttributeString('isnew', '0');
                    xw.writeAttributeString('cname', appData[0][i].catname);
                    xw.writeEndElement();
                }
                xw.writeEndElement();
            }
            return xw;
        },
		writeMultiSortXml: function(xw, appData, gridId) {
            xw.writeStartElement('trqi');
				xw.writeStartElement('scri');
					xw.writeAttributeString('fc', '');
					xw.writeAttributeString('ihsp', '0');
					xw.writeAttributeString('ivsp', '0');
					xw.writeAttributeString('TaskType', 'rvwstandardtask');
					xw.writeStartElement('ci');
						xw.writeStartElement('c');
							xw.writeAttributeString('n', gridId);
							xw.writeAttributeString('ct', 'RSGrid');
							xw.writeStartElement('sd');
								for (var j = 0; j < appData.length; j++) {
									xw.writeStartElement('vw');
									xw.writeAttributeString('vn', appData[j].view);
									xw.writeAttributeString('so', appData[j].so);
									xw.writeEndElement();
								}
							xw.writeEndElement();
						xw.writeEndElement();
					xw.writeEndElement();
				xw.writeEndElement();
			xw.writeEndElement();
            return xw;
        },
        writeJson: function(jsonResponse) {},
		//TECH-35056
		writeMetaLinkXml: function(xw, appData, metaViewName) {
			if (appData.length > 0) {
				xw.writeStartElement('dmd');
				xw.writeStartElement('cis');
				xw.writeEndElement();
				xw.writeStartElement('lci');
				for(var ad=0; ad < appData.length; ad++) {
					var gridData,
						curAppData;					
					curAppData = appData[ad];
					if (curAppData && curAppData.vl) {
						gridData = curAppData.vl
					}
					if (curAppData && curAppData.isDynamic) {
						xw.writeStartElement('c');
							xw.writeAttributeString('cid', curAppData.id);
							xw.writeAttributeString('rn', "0");
							xw.writeAttributeString('vwn', curAppData.vwn);							
						xw.writeEndElement();
					}
					//TECH-41283
					/* else if (gridData && gridData.isDynamic && gridData.r && gridData.r.length > 0) {
						var mv = 0,
							len = gridData.r.length;
						for (; mv < len; mv++) {
							row = gridData.r[mv];							
							if (row && row.sel == true) {
								xw.writeStartElement('c');
									xw.writeAttributeString('cid', curAppData.id);
									xw.writeAttributeString('rn', row.rn);
									xw.writeAttributeString('vwn', metaViewName);
								xw.writeEndElement();
							}
						}
					} */
					else if (gridData && gridData.isDynamic) {						
						xw.writeStartElement('c');
							xw.writeAttributeString('cid', curAppData.id);
							xw.writeAttributeString('rn', gridData.cr);
							xw.writeAttributeString('vwn', metaViewName);
						xw.writeEndElement();							
					}
				}
				xw.writeEndElement();				
				xw.writeEndElement();
			}
        }
    };
})();

function Uploader() {};

(function() {
    Uploader.prototype = {
        component: '',
        activity: '',
        ilbo: '',
        controlName: '',
        controlViewName: '',
        controlRowNo: 0,
        mode: true,
        srcPath: '',
        rid: '',
        dview: 'null',
        slices: 0,
        slicesTotal: 0,
        files: [],
        rts: null,
		date: Date.now,
        overWrite: '',
        initData: function(data, rts, uiInfo, rtc) {
            var me = this;
            me.component = uiInfo.componentName;
            me.activity = uiInfo.activityName;
            me.ilbo = uiInfo.ilboName;
            me.controlName = data.controlName;
            me.controlViewName = data.controlViewName;
            me.controlRowNo = data.controlRowNo;
            me.dView = data.dView;
            me.mode = true;
            me.srcPath = data.srcPath;
            me.saveToDb = data.saveToDb;
            me.assView = data.assView;
            me.overWrite = data.overWrite || '';
            me.rid = rtc.sessionToken;
            me.file = data.file;
			me.hdnFileId = data.hdnFileId;			
            me.fileName = data.fileName || 'RT_' + (Date.now());
            me.rts = rts;
			me.rwt = rtc.RWT;
        },
		 initAvnData: function(data, rts, uiInfo, rtc) {
            var me = this;
			me.avnUpload = true;
            me.component = uiInfo.componentName;
            me.activity = uiInfo.activityName;
            me.ilbo = uiInfo.ilboName;
            me.controlName = data.controlName;
            me.controlViewName = data.controlViewName;
			me.controlRowNo = data.controlRowNo;
			me.ml = data.ml,
			me.dView = data.dView;
            me.mode = true;
			me.srcPath = data.srcPath;
			me.overWriteOption = data.overWriteOption,
			me.destSrcPath = data.destSrcPath,
			me.maxFileSize = data.maxFileSize,
			me.uploadedFileSize = data.uploadedFileSize,			
            me.rid = rtc.sessionToken;
            me.file = data.file;			
            me.fileName = data.fileName || 'RT_' + (Date.now());
            me.rts = rts;
			me.rwt = rtc.RWT;
        },		
        getQueryParams: function() {
            return {
                RVWRTQS_COMPONENTNAME: this.component,
                RVWRTQS_ACTIVITY: this.activity,
                RVWRTQS_ILBO: this.ilbo,
                RVWRTQS_EVENTNAME: 'fileupload',
                RVWRTQS_CONTROLNAME: this.controlName,
                RVWRTQS_CONTROLVIEW: this.controlViewName,
                RVWRTQS_ROWNO: this.controlRowNo,
                RVWRTQS_DVIEW: this.assView,
				RVWRTQS_STOREPATH_VWNAME: this.dView,
                RVWRTQS_MODE: this.mode,
                RVWRTQS_STOREPATH: this.srcPath,
                RVWRTQS_CONTROLHIDDENVIEW: this.assView,//TECH-30685
				RVWRTQS_DTYPE: (this.saveToDb) ? 'db' : 'drive',
                RVWRTQS_REQID: this.rid,
                _dc: Date.now()
            };
        },
		getAvnQueryParams: function() {
            return {
                RVWRTQS_COMPONENTNAME: this.component,
                RVWRTQS_ACTIVITY: this.activity,
                RVWRTQS_ILBO: this.ilbo,
                RVWRTQS_EVENTNAME: 'fileupload',
                RVWRTQS_CONTROLNAME: this.controlName,
                RVWRTQS_CONTROLVIEW: this.controlViewName,
                RVWRTQS_ROWNO: this.controlRowNo,
				RVWRTQS_IS_ML: this.ml,
                RVWRTQS_DVIEW: this.assView,
				RVWRTQS_STOREPATH_VWNAME: this.dView,
                RVWRTQS_MODE: this.mode,				
                RVWRTQS_STOREPATH: this.srcPath,
                RVWRTQS_OVERWRITEOPTION: this.overWriteOption,
				RVWRTQS_DESTSUBFLDR: this.destSrcPath,
				RVWRTQS_MAXFILESIZE: this.maxFileSize,
				RVWRTQS_UPDFILESIZE: this.uploadedFileSize,
                RVWRTQS_REQID: this.rid,
                _dc: Date.now()
            };
        },
        uploadData: function(resolve, reject, scope) {
            var me = this,
                blob = me.file;
            if (!blob) {
                var objMsg = {};
                objMsg['sr'] = 'Uploader';
                objMsg['ds'] = 'No Files for upload';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'UPL-1';
                reject.call(scope || window, objMsg);
                return;
            }
            var me = this,
                start = 0,
                end,
                bytes_per_chunk = BYTES_PER_CHUNK,
                index = 0;
            me.blob = blob;
            me.resolveFn = resolve;
            me.rejectFn = reject;
            me.scope = scope;
            if (blob.size > BYTES_PER_CHUNK)
                me.slices = Math.ceil(blob.size / BYTES_PER_CHUNK);
            else {
                bytes_per_chunk = Math.ceil(blob.size / 4);
                me.slices = Math.ceil(blob.size / bytes_per_chunk);
            }
            if (!me.saveToDb) {
                me.bytes_per_chunk = bytes_per_chunk;
                me.slicesTotal = me.slices;
                if (start < blob.size) {
                    end = start + bytes_per_chunk;
                    if (end > blob.size) {
                        end = blob.size;
                    }
                    me.uploadFile(index, start, end)
                }
            } else {
                me.slicesTotal = 1;
                me.uploadDBFile(index, start, end)
            }
        },
		uploadAvnData: function(resolve, reject, scope) {
            var me = this,
                blob = me.file;
            if (!blob) {
                var objMsg = {};
                objMsg['sr'] = 'Uploader';
                objMsg['ds'] = 'No Files for upload';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'UPL-1';
                reject.call(scope || window, objMsg);
                return;
            }
            var me = this,
                start = 0,
                end,
                bytes_per_chunk = BYTES_PER_CHUNK,
                index = 0;
            me.blob = blob;
            me.resolveFn = resolve;
            me.rejectFn = reject;
            me.scope = scope;
            if (blob.size > BYTES_PER_CHUNK)
                me.slices = Math.ceil(blob.size / BYTES_PER_CHUNK);
            else {
                bytes_per_chunk = Math.ceil(blob.size / 4);
                me.slices = Math.ceil(blob.size / bytes_per_chunk);
            }
            if (!me.saveToDb) {
                me.bytes_per_chunk = bytes_per_chunk;
                me.slicesTotal = me.slices;
                if (start < blob.size) {
                    end = start + bytes_per_chunk;
                    if (end > blob.size) {
                        end = blob.size;
                    }
                    me.uploadAvnFile(index, start, end)
                }
            } else {
                me.slicesTotal = 1;
                me.uploadDBFile(index, start, end)
            }
        },
        checkAndSendNext: function() {
            var me = this,
                index = me.index,
                start = me.end,
                bytes_per_chunk = me.bytes_per_chunk,
                blob = me.blob;
            if (start < blob.size) {
                end = start + bytes_per_chunk;
                if (end > blob.size) {
                    end = blob.size;
                }
                index++;
				if (me.avnUpload)
					me.uploadAvnFile(index, start, end)
				else
					me.uploadFile(index, start, end)
            }
        },
        blobtoString: function(str, callback) {
            var blob;
            BlobBuilder = window.MozBlobBuilder || window.WebKitBlobBuilder || window.BlobBuilder;
            if (typeof(BlobBuilder) !== 'undefined') {
                var bb = new BlobBuilder();
                bb.append(str);
                blob = bb.getBlob();
            } else {
                blob = new Blob([str]);
            }
            var f = new FileReader();
            f.onload = function(e) {
                callback(e.target.result)
            }
            f.readAsArrayBuffer(blob);
        },
        uploadFile: function(index, start, end) {
            var me = this,
                blob = me.blob,
                options = {},
                url = me.rts.getUploadUrl(),
                params = me.getQueryParams(),
                mimetype = blob.type || "application/octet-stream",
                postData = new FormData(),
                reqID = me.date(),
                reqCallBack = {
                    resolve: me.resolve,
                    reject: me.reject,
                    scope: me
                },
                chunk;
            me.index = index;
            me.end = end;
			if(me.hdnFileId)
				params.RVWRTQS_CONTROL_HIDDENVIEW = me.hdnFileId;
			if (blob.webkitSlice) {
                chunk = blob.webkitSlice(start, end);
            } else if (blob.mozSlice) {
                chunk = blob.mozSlice(start, end);
            } else {
                chunk = blob.slice(start, end);
            }
            postData.append('chunk', unescape(encodeURIComponent(index)));
            postData.append('chunks', unescape(encodeURIComponent(me.slicesTotal)));
            postData.append('name', unescape(encodeURIComponent('hub_' + Date.now() + ".png")));
            postData.append('filename', unescape(encodeURIComponent(me.fileName)));
            postData.append('reNamedFile', unescape(encodeURIComponent(me.fileName.replace(/\.[^.]*$/,""))));
			//postData.append('reNamedFile', unescape(encodeURIComponent(me.fileName)));
            postData.append('file', chunk, blob.name);
            /*
            options = {
                requestId: reqID,
                payload: postData,
                payloadType: 'form',
                RTC: 'uiMethod',
                params: params,
                url: getCreateURL(url, params)
            };*/
			options = {
                resolve: me.resolve,
                reject: me.reject,
                scope: me,
                payload: postData,
                payloadType: 'form',
                RTC: 'uiMethod',
                params: params,
                url: getCreateURL(url, params)
            };
            me.rts.request(options);
			/*
            me.rts.requestQueue[reqID] = reqCallBack;
            RamcoLog.end('Client Trans');
            RamcoLog.start('Server Trans', options.url);
            me.RTS.postMessages(options);
			*/
        },		
        uploadDBFile: function(index, start, end) {
            var me = this,
                blob = me.blob,
                options = {},
                url = me.rts.getUploadDBUrl(),
                params = me.getQueryParams(),
                mimetype = blob.type || "application/octet-stream",
                postData = new FormData(),
                reqID = me.date(),
                reqCallBack = {
                    resolve: me.resolve,
                    reject: me.reject,
                    scope: me
                },
                chunk;
            me.index = index;
            me.end = end;
			if(me.hdnFileId)
				params.RVWRTQS_CONTROL_HIDDENVIEW = me.hdnFileId;
			if (blob.webkitSlice) {
                chunk = blob.webkitSlice(start, end);
            } else if (blob.mozSlice) {
                chunk = blob.mozSlice(start, end);
            } else {
                chunk = blob.slice(start, end);
            }
            postData.append('chunk', unescape(encodeURIComponent(index)));
            postData.append('chunks', unescape(encodeURIComponent(me.slicesTotal)));
            postData.append('name', unescape(encodeURIComponent('hub_' + Date.now() + ".png")));
            postData.append('filename', unescape(encodeURIComponent(me.fileName)));
            postData.append('reNamedFile', unescape(encodeURIComponent(me.fileName.replace(/\.[^.]*$/,""))));
			//postData.append('reNamedFile', unescape(encodeURIComponent(me.fileName)));
            postData.append('file', chunk, blob.name);
            options = {
                resolve: me.resolve,
                reject: me.reject,
                scope: me,
                payload: postData,
                payloadType: 'form',
                RTC: 'uiMethod',
                params: params,
                url: getCreateURL(url, params)
            };
            me.rts.request(options);
			//rts.request(options);
            /*options = {
                requestId: reqID,
                payload: postData,
                payloadType: 'form',
                RTC: 'uiMethod',
                params: params,
                url: getCreateURL(url, params)
            };
            //me.rts.request(options);
            me.requestQueue[reqID] = reqCallBack;
            RamcoLog.end('Client Trans');
            RamcoLog.start('Server Trans', options.url);
            me.RTS.postMessages(options);
			*/
        },
		uploadAvnFile: function(index, start, end) {
            var me = this,
                blob = me.blob,
                options = {},
                url = me.rts.getAvnUploadUrl(),
                params = me.getAvnQueryParams(),
                mimetype = blob.type || "application/octet-stream",
                postData = new FormData(),
                reqID = me.date(),
                reqCallBack = {
                    resolve: me.resolve,
                    reject: me.reject,
                    scope: me
                },
                chunk;
            me.index = index;
            me.end = end;
			if(me.hdnFileId)
				params.RVWRTQS_CONTROL_HIDDENVIEW = me.hdnFileId;
			if (blob.webkitSlice) {
                chunk = blob.webkitSlice(start, end);
            } else if (blob.mozSlice) {
                chunk = blob.mozSlice(start, end);
            } else {
                chunk = blob.slice(start, end);
            }
            postData.append('chunk', unescape(encodeURIComponent(index)));
            postData.append('chunks', unescape(encodeURIComponent(me.slicesTotal)));
            postData.append('name', unescape(encodeURIComponent('hub_' + Date.now() + ".png")));
            postData.append('filename', unescape(encodeURIComponent(me.fileName)));
            postData.append('reNamedFile', unescape(encodeURIComponent(me.fileName.replace(/\.[^.]*$/,""))));
			//postData.append('reNamedFile', unescape(encodeURIComponent(me.fileName)));
            postData.append('file', chunk, blob.name);
            /*
            options = {
                requestId: reqID,
                payload: postData,
                payloadType: 'form',
                RTC: 'uiMethod',
                params: params,
                url: getCreateURL(url, params)
            };*/
			options = {
                resolve: me.resolve,
                reject: me.reject,
                scope: me,
                payload: postData,
                payloadType: 'form',
                RTC: 'uiMethod',
                params: params,
                url: getCreateURL(url, params)
            };
            me.rts.request(options);
			/*
            me.rts.requestQueue[reqID] = reqCallBack;
            RamcoLog.end('Client Trans');
            RamcoLog.start('Server Trans', options.url);
            me.RTS.postMessages(options);
			*/
        },
        afterUpload: function(response, options) {
            var me = this;
            me.resolveFn.call(me.scope, response, options);
            me.resolveFn = null;
            me.rejectFn = null;
            me.scope = null;
            me.rts = null;
            delete me.resolveFn;
            delete me.rejectFn;
            delete me.scope;
            delete me.rts;
        },
        resolve: function(response, options) {
            var me = this,
                status = false;
            if (Ramcoutil.isEmpty(response.responseText) && Ramcoutil.isEmpty(response.responseXml)) {
                me.errorUpload.call(me, 'No Response');
            } else if (response.responseXml) {
                status = false;
            } else if (response.responseText) {
                status = response.responseText.indexOf('Chunk uploaded sucessfully') > -1;
            }
            me.slices--;
            if (me.slices != 0 && status) {
                me.checkAndSendNext();
            } else {
                me.afterUpload(response, options);
            }
        },
        reject: function(response, options) {
            var me = this;
            me.rejectFn.call(me.scope, response, options);
            me.resolveFn = null;
            me.rejectFn = null;
            me.scope = null;
            me.rts = null;
            delete me.resolveFn;
            delete me.rejectFn;
            delete me.scope;
            delete me.rts
        }
    };

})();

function RTC(hasRTS, osVersion, osType, isMobile, postDataType) {
    this.hasRTS = hasRTS;
    this.osVersion = osVersion;
    this.osType = osType;
    this.isMobile = isMobile;
    if (postDataType) {
        switch (postDataType.toLowerCase()) {
            case 'xml':
                this.postDataType = 'xml';
                this.prepareDataMethod = 'writeXml';
                break;
            case 'json':
                this.postDataType = 'json';
                prepareDataMethod = 'writeJson';
                break;
        }
    }
    this.reader = new Reader();
    this.writer = new Writer();
    this.reader.osVersion = this.osVersion;
};

(function() {
    RTC.prototype = {
        cacheId: '',
        date: Date.now,
        timerId: null,
        hasRTS: true,
        postDataType: 'xml',
        prepareDataMethod: 'writeXml',
        osType: 'DNA',
        osVersion: '2.0',
        isMobile: false,
        sessionToken: 'START',
        iEDK: '0',
        menu: [],
        userInfo: [],
        prefs: [],
        secs: [],
        showPortal: false,
        ou: null,
        role: null,
        lang: null,
        username: null,
        RTS: null,
        reader: null,
        writer: null,
        userPreference: [],
        segmentName: 'Ramco',
        asyncReqId: null,
		isEntUser: false,
        settings: {},
        sessionTimeOut: 120000, //20 minities
        defaultPage: null,
        currentInstance: null,
        currentTemplate: 'default',
        actWizItem: null,
        tenantName: null,
        userInformation: null,
        fileUrl: '',
        dbFileUrl: '',
        focusCtrl: [],
        lastFocusCtrl: [],
		// TECH-29276
		// multiSortGridData: [], // TECH-28159 / TECH-26959
		// dstRequired: [], // TECH-28636
        requestQueue: {},
		protoTrailBar: [],
        RWT: null,
		hasSmartViewLink: false,
		isProto: false,
		isGProto: false,
		errorObject : null,
		lastResponse: null,
		lastErrorObject : null,
		headerFontSize: 6.5,
        initialize: function(resolve, reject, scope) {
            var me = this;
            if (me.hasRTS) {
                /*me.RWT = new Worker('ramcoRWT.js');
                	me.RWT.addEventListener("message", me.RWTMessage.bind(me));
					me.RWT.addEventListener("message", 
					function(e){
						me.RWTMessage(e);
					});
				*/
				if(window.RTS){
					try {
						me.RTS = new RTS();
						me.RTS.initialize(me.osVersion, me.osType, me.isMobile);
						me.fileUrl = me.RTS.getAsyncUrl();
						//me.dbFileUrl = me.RTS.getPlfUrl();
						me.dbFileUrl = me.RTS.getAsyncUrl();
						me.avnDownloadfileUrl = me.RTS.getAvnDownloadfileUrl();
						me.reader.fileUrl = me.fileUrl;
						me.reader.dbFileUrl = me.dbFileUrl;
						me.reader.avnDownloadfileUrl = me.avnDownloadfileUrl;
						resolve.call(scope || window, true);
					} catch (e) {
						reject.call(scope || window, e);
					}
				}else{
                me.loadRTSScript(resolve, reject, scope, getCreateURL('ramco/ramcoRTS.js', {
                    _dc: me.getCacheId()
                }));
				}
            } else {
                resolve.call(scope || window, true);
            }
        },
		getCacheId: function() {
			return RamcoRTC.isProto ? (Date.now()) : RamcoRTC.cacheId;
		},
        loadRTSScript: function(resolve, reject, scope, src) {
            var me = this,
                oScript = document.createElement('script'),
                head = (document.getElementsByTagName('head')[0] || document.documentElement);
            oScript.language = 'javascript';
            oScript.type = 'text/javascript';
            oScript.defer = true;
            oScript.src = src;
            oScript.onerror = function(oError) {
                reject.call(scope || window, oError);
            };
            oScript.onload = function() {
                try {
                    me.RTS = new RTS();
                    me.RTS.initialize(me.osVersion, me.osType, me.isMobile);
                    me.fileUrl = me.RTS.getAsyncUrl();
                    //me.dbFileUrl = me.RTS.getPlfUrl();
					me.dbFileUrl = me.RTS.getAsyncUrl();
                    me.reader.fileUrl = me.fileUrl;
                    me.reader.dbFileUrl = me.dbFileUrl;
					me.reader.avnDownloadfileUrl = me.avnDownloadfileUrl;					
                    resolve.call(scope || window, true);
                } catch (e) {
                    reject.call(scope || window, e);
                }
            };
            head.appendChild(oScript);
        },
        setSessionToken:function(sessionToken){
			var me = this,	
				options = {
                        url:  "setInProc"
                    };
			me.sessionToken = sessionToken;
			me.RTS.postMessages(options);
		},
		getCsvReportUrl: function(ilboConfig, options) {
			var me = this,				
				rptUrl = me.RTS.getGridHtmlUrl(),
				params = {
					RVWRTQS_TYPE: "excelreport",
					RVWRTQS_AC: ilboConfig.activityName,
					RVWRTQS_IL: ilboConfig.ilboName,
					RVWRTQS_CT: options.params.RVWRTQS_CT,
					RVWRTQS_REQID: me.sessionToken || 'START',
					RVWQS_ACTIVEUI: ''
				};
			return getCreateURL(rptUrl, params);
		},
		//Web Worker Response
        RWTMessage: function(e) {
            RamcoLog.end('Server Trans');
            RamcoLog.start('Client Trans','response');
            var me = this,
                //data = e.data,
				data = e[1],
                //reqID = data[1].requestId,
				reqID = e[1].requestId,
                reqCallBack = me.requestQueue[reqID];
            /*if (data[0]) {
                reqCallBack.resolve.call(reqCallBack.scope, data[1], data[2]);
            } else {
                reqCallBack.reject.call(reqCallBack.scope, data[1], data[2]);
            }*/
			RamcoRTC.LastErrorObject = RamcoRTC.errorObject;
			RamcoRTC.errorObject = null;
			if (e[0])
                reqCallBack.resolve.call(reqCallBack.scope, e[1], e[2]);            
			else 
                reqCallBack.reject.call(reqCallBack.scope, e[1], e[2]);			
            reqCallBack.resolve = null;
            reqCallBack.reject = null;
            reqCallBack.scope = null;
            me.requestQueue[reqID] = null;
            delete me.requestQueue[reqID];
        },
        //Common Methods
        setUserSessionInfo: function(dataJson) {
            var me = this,
				secIndex = null;
            me.menu = dataJson.trpi.menu.bpcs;
            me.userInfo = dataJson.trpi.menu.userinfo;
            me.prefs = dataJson.trpi.menu.prefs;
            me.prepareUserPreference();
            me.secs = dataJson.trpi.menu.secs;
			/*if (me.userInfo.launchdefault == false) {
				me.secs.some(function(el, i) { if (el.aname == 'changedefaults') {secIndex = i; return; } });				
				//secIndex = me.secs.findIndex(function(a){return a.aname == "changedefaults"});
				if (secIndex)
					me.secs.splice(secIndex,1);
			}*/
            me.recs = dataJson.trpi.menu.recs;
            me.favs = dataJson.trpi.menu.favs;
            me.reader.prefs = me.userPreference;
        },
        setRecentActvities: function(dataJson) {
            var me = this;
            me.recs = (me.osType == 'JAVA') ? dataJson.trpi.menu.recs : dataJson.trpi.recs;
            me.favs = (me.osType == 'JAVA') ? dataJson.trpi.menu.favs : dataJson.trpi.favs;
        },
        prepareUserPreference: function() {
            var me = this,
                dateFormat = '',
                timeFormat = '',
                dateTimeFormat = '',
				dateFormatText = '',
                timeFormatText = '',
                dateTimeFormatText = '',
                numberFormat = '',
                integerFormat = '',
                decimalseparator = me.prefs['DECIMALSEPARATOR'] || '.',
                _dateFmt = me.prefs['DATEFORMAT'] || 'd/m/y',
                _dSep = me.prefs['DATESEPARATOR'] || '/',
                _timeFmt = me.prefs['TIMEFORMAT'] || '24-Hour',
                _tSep = me.prefs['TIMESEPARATOR'] || ':',
                _D = 'd',
                _M = 'm',
                _Y = 'Y';

            _D = (me.prefs['DATEDAYSTYLE'] == 'd') ? 'j' : 'd';

            if (me.prefs['DATEMONTHSTYLE'] == 'm')
                //me.prefs['DATEMONTHSTYLE'] = 'n';
				_M = 'n';
            else if (me.prefs['DATEMONTHSTYLE'] == 'mm')
                //me.prefs['DATEMONTHSTYLE'] = 'm';
				_M = 'm';
            else if (me.prefs['DATEMONTHSTYLE'] == 'MMM')
                _M = 'M';

            _Y = (me.prefs.DATEYEARSTYLE == 'yyyy') ? 'Y' : 'y';


            switch (_dateFmt) {
                case 'd/y/m':
                    dateFormat = _D + _dSep + _Y + _dSep + _M;
					dateFormatText = "DD" + _dSep + me.prefs.DATEYEARSTYLE + _dSep + me.prefs['DATEMONTHSTYLE'];
                    break;
                case 'd/m/y':
                    dateFormat = _D + _dSep + _M + _dSep + _Y;
					dateFormatText = "DD" + _dSep + me.prefs['DATEMONTHSTYLE'] + _dSep + me.prefs.DATEYEARSTYLE;
                    break;
                case 'm/d/y':
                    dateFormat = _M + _dSep + _D + _dSep + _Y;
					dateFormatText = me.prefs['DATEMONTHSTYLE'] + _dSep + "DD" + _dSep + me.prefs.DATEYEARSTYLE;
                    break;
                case 'm/y/d':
                    dateFormat = _M + _dSep + _Y + _dSep + _D;
					dateFormatText = me.prefs['DATEMONTHSTYLE'] + _dSep + me.prefs.DATEYEARSTYLE + _dSep + "DD";
                    break;
                case 'y/d/m':
                    dateFormat = _Y + _dSep + _D + _dSep + _M;
					dateFormatText = me.prefs.DATEYEARSTYLE + _dSep + "DD" + _dSep + me.prefs['DATEMONTHSTYLE'];
                    break;
                case 'y/m/d':
                    dateFormat = _Y + _dSep + _M + _dSep + _D;
					dateFormatText = me.prefs.DATEYEARSTYLE + _dSep + me.prefs['DATEMONTHSTYLE'] + _dSep + "DD";
                    break;
                default:
                    dateFormat = 'Y-m-d';
					dateFormatText = me.prefs.DATEYEARSTYLE + _dSep + me.prefs['DATEMONTHSTYLE'] + _dSep + "DD";
                    break;
            }
			dateFormatText = dateFormatText.toUpperCase();
            if (me.prefs['TIMEHRSTYLE'] == 'h') {
                if (_timeFmt == '12-Hour') {
                    timeFormat = 'g';
					timeFormatText = "h"
				}
                else {
					timeFormat = 'G';
					timeFormatText = "H"
				}
			}
			else if (me.prefs['TIMEHRSTYLE'] == 'hh'){
				if (_timeFmt == '12-Hour'){
					timeFormat = 'h'; 
					timeFormatText = "hh"
				}
				else {
					timeFormat = 'H';
					timeFormatText = "HH"
				}
			}

            timeFormat = timeFormat + _tSep + 'i';
			timeFormatText = timeFormatText + _tSep + 'mm';

            if (me.prefs['TIMESECSTYLE'] != 'none') {
                timeFormat = timeFormat + _tSep + 's';
				timeFormatText = timeFormatText + _tSep + 'ss';
			}

            if (_timeFmt == '12-Hour') {
                timeFormat = timeFormat + ' A';
				timeFormatText = timeFormatText + ' tt';
			}
			
            dateTimeFormat = dateFormat + ' ' + timeFormat;
			dateTimeFormatText = dateFormatText + ' ' + timeFormatText;
			
            me.userPreference['dateFormat'] = dateFormat;
            me.userPreference['timeFormat'] = timeFormat;
            me.userPreference['dateTimeFormat'] = dateTimeFormat;
			me.userPreference['dateFormatText'] = dateFormatText;
            me.userPreference['timeFormatText'] = timeFormatText;
            me.userPreference['dateTimeFormatText'] = dateTimeFormatText;
            me.userPreference['numberFormat'] = numberFormat;
            me.userPreference['integerFormat'] = integerFormat;
            me.userPreference['decimalseparator'] = decimalseparator;
            me.userPreference['numgroupstyle'] = me.prefs['NUMGROUPSTYLE'];
            me.userPreference['numgroupsymbol'] = me.prefs['NUMGROUPSYMBOL'];
            me.userPreference['numnegativestle'] = me.prefs['NUMNEGATIVESTLE'];
			//TECH-37935 /LH-471
			me.userPreference['firstdayofweek'] = (me.prefs['FIRSTDAYOFWEEK'] !== null)?parseInt(me.prefs['FIRSTDAYOFWEEK'],10):0; // TECH-36193
			// Numeric Preference
			Ext.util.Format.thousandSeparator = me.prefs['NUMGROUPSYMBOL'];
			Ext.util.Format.decimalSeparator = decimalseparator;
        },
        processResponse: function(response, options) {
            var me = this,
                data = {};
			me.lastResponse = response.responseXML;
            data = me.reader.readXml(response, options);
			me.errorObject = null;	
			if(data && data.messages)
				me.errorObject = new RamcoErrors(data.messages);
            me.sessionTimeOut = (data.sessionTimeOut) ? data.sessionTimeOut : (me.sessionTimeOut || 20);
            return data;
        },
        processPersonalization: function(response, options) {
            var me = this,
                data = {};
            data = me.reader.readPersXml(response, options);
            me.sessionTimeOut = (data.sessionTimeOut) ? data.sessionTimeOut : (me.sessionTimeOut || 20);
            return data;
        },
        processListEdit: function(response, options) {
            var me = this,
                data = {};
            data = me.reader.readListXml(response, options);
            me.sessionTimeOut = (data.sessionTimeOut) ? data.sessionTimeOut : (me.sessionTimeOut || 20);
            return data;
        },
		processCustomListEdit: function(response, options) {
            var me = this,
                data = {};
            data = me.reader.readCustomListXml(response, options);
            me.sessionTimeOut = (data.sessionTimeOut) ? data.sessionTimeOut : (me.sessionTimeOut || 20);
            return data;
        },
		processTreeSearchData: function(response, options) {
			var me = this,
                data = {};
            data = me.reader.readTreeSearchXml(response, options);
            me.sessionTimeOut = (data.sessionTimeOut) ? data.sessionTimeOut : (me.sessionTimeOut || 20);
            return data;
		},
        initializeSession: function(resolve, reject, scope) {
            var me = this,
                rts = me.RTS;
            if (me.hasRTS) {
                var url = rts.getStartUpPage(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        url: url
                    },
                    params = {
                        RVWRTQS_REQID: me.sessionToken
                    };
				if (qsParm.lid) {
					params.RVWRTQS_LID = qsParm.lid;
				}
				
				// TECH-30723
				if (RamcoRTC.isProto)
					params.RVWRTQS_PROTO = RamcoRTC.isProto;
				
				if(window.localStorage.getItem('reloaded')== "true"){
					params.RVWRTQS_REQID =  me.sessionToken = "START";
					window.localStorage.removeItem('reloaded');
				}
                options['RTC'] = 'initSession';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },
        doLogin: function(resolve, reject, scope, queryParam, payload) {},
        getAuthenticationToken: function(resolve, reject, scope) {},
        getUserInformation: function(resolve, reject, scope) {},
        getAllMenu: function(resolve, reject, scope) {
            var me = this,
                rts = me.RTS;
            if (me.hasRTS) {
                var url = rts.getMenu(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        url: url
                    },
                    params = {
                        RVWRTQS_REQID: me.sessionToken,
						type: 'menu' // Security Vulnerability
                    };
				if(me.isProto) {
					params.RVWRTQS_PROTO = me.isProto;
					params.RVWTQS_CUST = RamcoRTC.customer;
					params.RVWTQS_PROJ = RamcoRTC.project;
					params.RVWTQS_REQ = RamcoRTC.request;														
				}
                options['RTC'] = 'allMenu';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options)
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },
        getFavsAsMenu: function(resolve, reject, scope) {
            var me = this,
                rts = me.RTS;
            if (me.hasRTS) {
                var url = rts.getPlfUrl(),
                    data = '<NoLoad />',
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: data,
                        payloadType: me.postDataType
                    };
                params = {
                    RVWRTQS_CONTENTTYPE: 'favorites',
                    RVWRTQS_REQTYPE: 'favorites',
                    RVWRTQS_PROTO: false,
                    RVWQS_ACTIVEUI: '',
                    RVWQS_CURREQID: me.sessionToken,
                    RVWRTQS_REQID: me.sessionToken
                };
                options['RTC'] = 'getFavsAsMenu';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },
        getRecentMenu: function(resolve, reject, scope) {
            var me = this,
                params = {},
                rts = me.RTS;
            if (me.hasRTS) {
                var url = rts.getMenu(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        url: url
                    };
                options['RTC'] = 'recentMenu';
                params = {
                    type: 'recent',
                    RVWRTQS_REQID: me.sessionToken
                };
				if(me.isProto) {
					params.RVWRTQS_PROTO = me.isProto;
					params.RVWTQS_CUST = RamcoRTC.customer;
					params.RVWTQS_PROJ = RamcoRTC.project;
					params.RVWTQS_REQ = RamcoRTC.request;
				}
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                me.requestQueue[reqID] = reqCallBack;
				RamcoLog.end('Client Trans');
				RamcoLog.start('Server Trans', options.url);
				me.RTS.postMessages(options);
                //rts.request(options)
            }
        },
        getBPCs: function(resolve, reject, scope, type) {},
        getComponents: function(resolve, reject, scope, bpcID) {},
        getActivities: function(resolve, reject, scope, componentID) {},
        getContextMenu: function(resolve, reject, scope) {},
        getUserPreference: function(resolve, reject, scope, type) {},
        //UI Methods (ILBO)
        launchUI: function(resolve, reject, scope, uiInfo, data) {
            var me = this,
				isCancelTask = !Ramcoutil.isEmpty(data) && data == 'tskstdcancel'; // TECH-30816
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, 'rvwstandardtask');
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: '',
                            RVWRTQS_CONTROLNAME: '',
                            RVWRTQS_CONTROLVIEW: '',
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTNAME: (isCancelTask) ? 'tskstdcancel' : 'tskstdlaunch', // TECH-30816
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_LANGID: me.lang,
							RVWRTQS_PROTO: me.isProto,
                            RVWRTQS_EXTENDED: uiInfo.isEdk,
                            //RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_ACTCAROUSEL: (me.currentInstance) ? me.currentInstance.toLowerCase() : me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
                    if (Ramcoutil.isEmpty(uiInfo.isEdk))
						delete params.RVWRTQS_EXTENDED;
					else {
						if(uiInfo.isEdk == "1")
							params.RVWRTQS_EVENTNAME = 'tskstdlaunchedk';
					}
					// Portal launch with default values
					if (uiInfo.isPortal)
						params.RVWRTQS_EVENTNAME = 'tskstdexplaunch';
                    if (uiInfo.ilboName == 'ezelogin' || uiInfo.ilboName == 'passremans' || Ramcoutil.isEmpty(me.currentInstance))
                        delete params.RVWRTQS_ACTCAROUSEL;
					if ( uiInfo.ilboName == 'ezwizard' &&  params.RVWRTQS_EVENTNAME == 'tskstdlaunch' ) {
						params.RVWRTQS_EXTENDED = 0;
						params.RVWRTQS_ACTCAROUSEL = 'wizard';
					}
                    if (uiInfo.ilboType) {
                        params.RVWRTQS_ILBOTYPE = uiInfo.ilboType;
                        params.RVWRTQS_ACTDESC = uiInfo.activityDesc;
                    }
                    if (uiInfo.inlineTab)
                        params.RVWRTQS_EVENTDETAILS = 'INLINETAB';
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTDETAILS = '';
						params.RVWRTQS_EVENTTYPE = 'rvwstandardtask';
					}
                    options['RTC'] = 'uiMethod';
					if(me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_COMP = uiInfo.componentName;
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH =  '';
					}

                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		// TECH-29150
		launchEDKUI: function(resolve, reject, scope, uiInfo, data) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    //data = me.writer[me.prepareDataMethod](data, 'rvwstandardtask');
                    var rts = me.RTS,
                        url = rts.getUdsLaunchUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: '',
                            payloadType: me.postDataType
                        },
                        params = {
							RVWRTQS_ACTIVITY: uiInfo.activityName,
							RVWRTQS_ILBO: uiInfo.ilboName,
							RVWRTQS_COMPONENT: uiInfo.componentName,
							RVWRTQS_EVENTNAME: 'tskstdlaunch',
							RVWRTQS_PARENTILBO: uiInfo.parentIlbo,
							RVWRTQS_PARENTACTIVITY: uiInfo.parentActivity,
							RVWRTQS_PARENTCOMPONENT: uiInfo.parentComponent,
							Language: uiInfo.langId,
							RVWRTQS_REQID: me.sessionToken,
							RVWRTQS_PROTO: false,
							Extension_Control: uiInfo.extnControl
                        };
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		quickSearchLaunch: function(resolve, reject, scope, searchid, activityid) {			
			var me = this,
				scope = scope || window;			
			if (me.hasRTS) {
				data = [];
				var rts = me.RTS,
					url = rts.getPlfUrl(),
					reqID = me.date(),
					reqCallBack = {
						resolve: resolve,
						reject: reject,
						scope: scope || window
					},
					options = {
						requestId: reqID,
						payload: data,
						payloadType: me.postDataType
					},
					params = {
						RVWRTQS_REQTYPE: searchid,
						RVWRTQS_SEARCHID: activityid,
						RVWRTQS_REQID: me.sessionToken,
						RVWRTQS_PROTO: me.isProto                            
					};                    	
				options['RTC'] = 'quicksearchlaunch';					
				options['params'] = params;
				options['url'] = getCreateURL(url, params);
				//rts.request(options);
				me.requestQueue[reqID] = reqCallBack;
				RamcoLog.end('Client Trans');
				RamcoLog.start('Server Trans', options.url);
				me.RTS.postMessages(options);
			}
		},
        doDWLaunchUI: function(resolve, reject, scope, uiInfo, data) {
            var me = this,
                scope = scope || window;

            if (me.hasRTS) {
                data = me.writer[me.prepareDataMethod](data, 'rvwstandardtask');
                var rts = me.RTS,
                    url = "../../"+me.userInfo.dwendpoint+"/"+ rts.getDwUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: '',
                        payloadType: me.postDataType
                    },
                    params = {
                        USER_ID: me.userInfo.n,
                        ROLE_NAME: me.userInfo.r,
                        OU_ID: me.userInfo.ou,
                        LANG_ID: me.userInfo.l,
                        SRC: 'extjs',
                        SEG_ID: me.userInfo.segmentname
                    };

                options['RTC'] = 'dwLaunch';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                openWindow(options['url']);
            }

        },
        doForgetPwd: function(resolve, reject, scope, uiInfo, value) {
            var me = this,
                scope = scope || window;
            data = me.writer[me.prepareDataMethod](value, 'link');
            var rts = me.RTS,
                url = rts.getDispatcher(),
                reqID = me.date(),
                reqCallBack = {
                    resolve: resolve,
                    reject: reject,
                    scope: scope || window
                },
                options = {
                    requestId: reqID,
                    payload: data,
                    payloadType: me.postDataType
                },
                params = {
					RVWRTQS_COMPONENT: uiInfo.componentName,
                    RVWRTQS_ACTIVITY: uiInfo.activityName,
                    RVWRTQS_ILBO: uiInfo.ilboName,
                    RVWRTQS_TAB: uiInfo.tabName,
                    RVWRTQS_EVENTNAME: (me.osType == 'JAVA')?'forgotpwdlink':'forgotpassword',
                    RVWRTQS_PCONTROL: '',
                    RVWRTQS_PVIEW: '',
                    RVWRTQS_EVENTDETAILS: '',
                    RVWRTQS_TRACE: false,
                    RVWRTQS_XMLHTTP: true,
                    RVWRTQS_PROTO: false,
                    RVWRTQS_REQID: me.sessionToken
                };
			if (me.isProto) {
				url = rts.getPlfProtoUrl();
				params.RVWTQS_ACTION = 'ilbotask';
				params.RVWQTS_CMPPATH = '';
				params.RVWRTQS_PROTO = me.isProto;
			}	
				
				if (me.osType == 'JAVA') {
					params.RVWRTQS_TAB = uiInfo.tabName || 'main';
					params.RVWRTQS_EVENTTYPE = 'link';
				}			
            options['RTC'] = 'uiMethod';
            options['params'] = params;
            options['url'] = getCreateURL(url, params);
            //rts.request(options);
            me.requestQueue[reqID] = reqCallBack;
            RamcoLog.end('Client Trans');
            RamcoLog.start('Server Trans', options.url);
            me.RTS.postMessages(options);
        },
        launchPreferenceUI: function(resolve, reject, scope, uiInfo, value) {
            var me = this,
                scope = scope || window;
            data = me.writer[me.prepareDataMethod](value, 'personal');
            var rts = me.RTS,
                url = rts.getPlfUrl(),
                reqID = me.date(),
                reqCallBack = {
                    resolve: resolve,
                    reject: reject,
                    scope: scope || window
                },
                options = {
                    requestId: reqID,
                    payload: data,
                    payloadType: me.postDataType
                },
                params = {
                    RVWRTQS_CLIENTTYPE: 'extjs',
                    RVWRTQS_REQTYPE: 'menu',
                    RVWRTQS_CONTENTTYPE: 'setdeflaunch',
                    RVWRTQS_COMPONENT: null,
                    RVWRTQS_ACTIVITY: 'homepage',
                    RVWQS_CURREQID: me.sessionToken,
                    RVWRTQS_ILBO: 'homepage',
                    RVWRTQS_REQID: me.sessionToken,
                    RVWRTQS_PROTO: false,
                    RVWQS_ACTIVEUI: "",
                };
			if (me.isProto) {
				url = rts.getPlfProtoUrl();
				params.RVWTQS_ACTION = 'ilbotask';
				params.RVWQTS_CMPPATH = '';
				params.RVWRTQS_PROTO = me.isProto;
			}	
            options['RTC'] = 'preference';
            options['params'] = params;
            options['url'] = getCreateURL(url, params);
            //rts.request(options);
            me.requestQueue[reqID] = reqCallBack;
            RamcoLog.end('Client Trans');
            RamcoLog.start('Server Trans', options.url);
            me.RTS.postMessages(options);


        },
        initializeUI: function(resolve, reject, scope, uiInfo, data) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, 'rvwstandardtask');
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: '',
                            RVWRTQS_CONTROLNAME: '',
                            RVWRTQS_CONTROLVIEW: '',
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTNAME: 'tskstdscreeninit',
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            //RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_ACTCAROUSEL: (me.currentInstance) ? me.currentInstance.toLowerCase() : me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
                    if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}
                    if (uiInfo.ilboType) {
                        params.RVWRTQS_ILBOTYPE = uiInfo.ilboType;
                        params.RVWRTQS_ACTDESC = uiInfo.activityDesc;
                    }
                    if (uiInfo.ilboType == "3") {
                        params.RVWRTQS_PROTO = false;
                    }
					// TECH-30816
                    if (uiInfo.ilboName == 'ezelogin' || uiInfo.ilboName == 'passremans' || Ramcoutil.isEmpty(me.currentInstance) || me.currentInstance == 'default')
                        delete params.RVWRTQS_ACTCAROUSEL;
                    if (uiInfo.inlineTab && uiInfo.ilboName != 'passremans' && uiInfo.ilboName != 'ezelogin')
                        params.RVWRTQS_EVENTDETAILS = 'INLINETAB';
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						if(!uiInfo.isTabScreen)//TECH-30233
							params.RVWRTQS_EVENTDETAILS = '';
						params.RVWRTQS_EVENTTYPE = 'rvwstandardtask';
					}	
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-2';
                reject.call(scope, objMsg);
            }
        },
        doCreateInstance: function(resolve, reject, scope, uiInfo, data) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, 'rvwstandardtask');
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_EVENTNAME: 'tskdummyinst',
                            RVWRTQS_PCONTROL: '',
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_REQID: me.sessionToken,
                            //RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_ACTCAROUSEL: (me.currentInstance) ? me.currentInstance.toLowerCase() : me.currentInstance,
                            RVWRTQS_PROTO: false,
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}
					
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
					
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
					
                    options['RTC'] = 'dummyinst';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-2';
                reject.call(scope, objMsg);
            }
        },
        doGetFavorites: function(resolve, reject, scope, uiInfo, task, taskType) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = '<NoLoad />';
                    var rts = me.RTS,
                        url = rts.getPlfUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_CLIENTTYPE: 'extjs',
                            RVWRTQS_REQTYPE: 'menu',
                            RVWRTQS_CONTENTTYPE: 'fetch_mapped_favorites',
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWQS_CURREQID: me.sessionToken,
							RVWRTQS_PERSTYPE: me.isEntUser ? 'ENT' : 'USR',
                            RVWRTQS_REQID: me.sessionToken,
                            RVWRTQS_PROTO: false
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}	
                    options['RTC'] = 'getFav';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doCountInboxMsg: function(resolve, reject, scope, task, taskType) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getPlfInboxCountUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: '',
                        payloadType: me.postDataType
                    },
                    params = {
                        RVWRTQS_CLIENTTYPE: 'extjs',
                        RVWRTQS_REQTYPE: 'menu',
                        RVWRTQS_CONTENTTYPE: 'getmsgcount',
                        RVWRTQS_COMPONENT: null,
                        RVWRTQS_ACTIVITY: 'homepage',
                        RVWRTQS_ILBO: 'homepage',
                        RVWQS_CURREQID: me.sessionToken,
                        RVWRTQS_ASYNCREQID: me.userInfo.asyncReqID,
                        RVWQS_ACTIVEUI: ''
                    };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}

                options['RTC'] = 'getmsgcount';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },
        doWizardTask: function(resolve, reject, scope, uiInfo, task, taskType, data) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, taskType);
                    var rts = me.RTS,
                        url = (uiInfo.activityName.toLowerCase() == "ezwizard") ? rts.getPlfUrl() : rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: "<NoLoad />",
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_CONTENTTYPE: taskType,
                            RVWRTQS_REQTYPE: taskType,
                            RVWRTQS_PROTO: false,
                            RVWQS_ACTIVEUI: "",
                            RVWQS_CURREQID: me.sessionToken,
                            //RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_ACTCAROUSEL: (me.currentInstance) ? me.currentInstance.toLowerCase() : me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
                    options['RTC'] = taskType || uiInfo.tabName;
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            }
        },
        doWindowUi: function(resolve, reject, scope, uiInfo, task, taskType, data) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                data = me.writer[me.prepareDataMethod](data, 'fav');
                var rts = me.RTS,
                    url = rts.getPlfUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: data,
                        payloadType: me.postDataType
                    },
                    params = {
                        RVWRTQS_CLIENTTYPE: 'extjs',
                        RVWRTQS_REQTYPE: 'menu',
                        RVWRTQS_CONTENTTYPE: 'save_mapped_favorites',
                        RVWRTQS_COMPONENT: uiInfo.componentName,
                        RVWRTQS_ACTIVITY: uiInfo.activityName,
                        RVWRTQS_ILBO: uiInfo.ilboName,
                        RVWQS_CURREQID: me.sessionToken,
                        RVWRTQS_ASYNCREQID: me.sessionToken,
                        RVWRTQS_PROTO: false,
                        RVWQS_ACTIVEUI: ''
                    };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}

                options['RTC'] = 'setFav';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },
        doFavChange: function(resolve, reject, scope, uiInfo, task, taskType, data) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                if (taskType != 'delfavgroup')
					data = me.writer[me.prepareDataMethod](data, 'favchange');
                var rts = me.RTS,
                    url = rts.getPlfUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: data,
                        payloadType: me.postDataType
                    },
                    params = {
                        RVWRTQS_CLIENTTYPE: 'extjs',
                        RVWRTQS_REQTYPE: 'menu',
                        RVWRTQS_CONTENTTYPE: 'save_mapped_favorites',
                        RVWRTQS_COMPONENT: uiInfo.componentName,
                        RVWRTQS_ACTIVITY: uiInfo.activityName,
                        RVWRTQS_ILBO: uiInfo.ilboName,
                        RVWQS_CURREQID: me.sessionToken,
                        RVWRTQS_ASYNCREQID: me.sessionToken,
                        RVWRTQS_PROTO: false,
                        RVWQS_ACTIVEUI: ''
                    };

                options['RTC'] = (taskType == 'delfavgroup') ? 'favorites' : 'setFav';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },
        doWizardTransactions: function(resolve, reject, scope, uiInfo, task, taskType, data, helpTask, ctrlId, viewName, pCtrl, pView, wizDtls) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, taskType, task);
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: pCtrl || '',
                            RVWRTQS_PVIEW: pView || '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_EVENTDETAILS: ((uiInfo.tabName != 'wizard1') ? uiInfo.tabName : '') || '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            //RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_ACTCAROUSEL: (me.currentInstance) ? me.currentInstance.toLowerCase() : me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
                    /* if (uiInfo.ilboType) {
                    	params.RVWRTQS_ILBOTYPE = uiInfo.ilboType;
                    	params.RVWRTQS_ACTDESC = uiInfo.activityDesc;					
                    } */
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}
                    if (uiInfo.inlineTab && task == 'tskstdtabinit')
                        params.RVWRTQS_EVENTDETAILS = 'INLINETAB';
                    if (helpTask)
                        params.RVWRTQS_EVENTDETAILS = helpTask;

                    /* MenuTag - Updating Event Details */
                    if (uiInfo.tabName && uiInfo.tabName.toLowerCase() == "menutag")
                        params.RVWRTQS_EVENTDETAILS = 'INLINETAB';

                    /* WIZARD - INBOX */
                    if ((pCtrl && pView) || uiInfo.ilboName == 'ezwizard') {
                        params.RVWRTQS_ACTCAROUSEL = "wizard";
                        params.RVWRTQS_PROTO = false;
                        params.RVWRTQS_TRACE = false;
						if (wizDtls == 'stepLaunch')
							params.RVWRTQS_EXTENDED = 0;
                    }
                    if (wizDtls && task == 'tskstdwizardlink') {
                        params.RVWRTQS_REQTYPE = 'wizardLink';
                        params.RVWRTQS_WIZARDDET = wizDtls;
                    }
					if (task == 'ezwmainscPerforTr' && uiInfo.tabName.toLowerCase() == 'myinbox') {
						params.RVWRTQS_PCONTROL = '';
                        params.RVWRTQS_PVIEW = '';
                        params.RVWRTQS_EVENTDETAILS = '';
					}
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}

                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    if (task == 'tskstdwizardlink' && wizDtls)
                        options['url'] = decodeURIComponent(options['url']);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		doWizardStepTransactions: function(resolve, reject, scope, uiInfo, task, taskType, data, ctrlId, wizBtns, prevWizBtn) {
			try {
				var me = this,
					scope = scope || window;
				if (uiInfo && uiInfo.ilboName) {
					if (me.hasRTS) {
						data = me.writer[me.prepareDataMethod](data, taskType, task);
						var rts = me.RTS,
							url = rts.getPlfUrl(),
                            reqID = me.date(),
                            reqCallBack = {
								resolve: resolve,
								reject: reject,
                                scope: scope || window
                            },
                            options = {
                                requestId: reqID,
								payload: data,
								payloadType: me.postDataType
							},
							params = {
								RVWRTQS_CLIENTTYPE:'extjs',
								RVWRTQS_REQTYPE:'menu',
								RVWRTQS_CONTENTTYPE:task,
								RVWRTQS_COMPONENT:uiInfo.componentName,
								RVWRTQS_ACTIVITY:uiInfo.activityName,
								RVWRTQS_ILBO:uiInfo.ilboName,
								RVWQS_CURREQID:me.sessionToken,
								RVWQS_ACTIVEUI:'',
								RVWRTQS_ST_CURR_ILBO:uiInfo.ilboName,
								RVWRTQS_ST_CURR_TAB:'',
								RVWRTQS_ST_START_ILBO:uiInfo.ilboName,
								RVWRTQS_ST_FRM:prevWizBtn,
								RVWRTQS_ST_FRM_SQ:prevWizBtn,
								RVWRTQS_ST_LNCH_ACT:wizBtns.la,
								RVWRTQS_ST_LNCH_CMPNT:wizBtns.lc,
								RVWRTQS_ST_LNCH_ILBO:wizBtns.li,
								RVWRTQS_ST_GRP_NM:'',
								RVWRTQS_ST_WIZ_NM:'impl_0001',
								RVWRTQS_ST_NAME:wizBtns.wd,
								RVWRTQS_ST_SEQ:wizBtns.wd,
								RVWRTQS_ASYNCREQID:me.sessionToken
							};

						options['RTC'] = 'wizStep';
						options['params'] = params;
						options['url'] = getCreateURL(url, params);
                        //rts.request(options);
                        me.requestQueue[reqID] = reqCallBack;
                        RamcoLog.end('Client Trans');
                        RamcoLog.start('Server Trans', options.url);
                        me.RTS.postMessages(options);
					}
				} else {
					var objMsg = {};
					objMsg['sr'] = 'RTC';
					objMsg['sv'] = 5;
					objMsg['cd'] = 'RTC-1';
					reject.call(scope, objMsg);
				}
            } catch (ex) {}
        },
		doTabTransactions: function(resolve, reject, scope, uiInfo, task) {
            var me = this,
				data = '',
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod]('', 'trans');
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: '',
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_EVENTDETAILS: uiInfo.tabName,
                            RVWRTQS_TRACE: false,
							RVWRTQS_PROTO: false,
                            RVWRTQS_XMLHTTP: true,
                            //RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_ACTCAROUSEL: (me.currentInstance) ? me.currentInstance.toLowerCase() : me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}	
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		getFileRequest: function(resolve, reject, scope, url) {
			var me = this,
                scope = scope || window,
				rts = me.RTS;				
            reqID = me.date(),
                reqCallBack = {
					resolve: resolve,
					reject: reject,
                    scope: scope || window
                },
                options = {
                    requestId: reqID,
				};				
				options['RTC'] = 'filerequest';				
				options['url'] = url;
            //rts.request(options);
            me.requestQueue[reqID] = reqCallBack;
            RamcoLog.end('Client Trans');
            RamcoLog.start('Server Trans', options.url);
            me.RTS.postMessages(options);
		},
		//TECH-35056
        //doTransactions: function(resolve, reject, scope, uiInfo, task, taskType, data, helpTask, ctrlId, viewName, pCtrl, pView, pURL) {
		doTransactions: function(resolve, reject, scope, uiInfo, task, taskType, data, helpTask, ctrlId, viewName, pCtrl, pView, pURL, metaViewName) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
					//TECH-35056
                    //data = me.writer[me.prepareDataMethod](data, taskType);
					data = me.writer[me.prepareDataMethod](data, taskType, '', '', '', '', metaViewName);
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: pCtrl || '',
                            RVWRTQS_CONTROLNAME: ctrlId || '',
                            RVWRTQS_CONTROLVIEW: viewName || '',
                            RVWRTQS_PVIEW: pView || '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_ACTDESC: uiInfo.activityDesc,
                            RVWRTQS_PROTO: false,
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_ACTCAROUSEL: (me.currentInstance) ? me.currentInstance.toLowerCase() : me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWQTS_PREVURL = pURL;
						params.RVWRTQS_PROTO = me.isProto;
					}
                    if (uiInfo.ilboName == 'ezelogin' || uiInfo.ilboName == 'passremans' || Ramcoutil.isEmpty(me.currentInstance))
                        delete params.RVWRTQS_ACTCAROUSEL;
                    /* if (uiInfo.ilboType) {
                        params.RVWRTQS_ILBOTYPE = uiInfo.ilboType;
                        params.RVWRTQS_ACTDESC = uiInfo.activityDesc;
                    } */
                    if (uiInfo.inlineTab && (task == 'tskstdtabinit' || task == 'tskstdscreeninit'))
                        params.RVWRTQS_EVENTDETAILS = 'INLINETAB';
                    if (helpTask)
                        params.RVWRTQS_EVENTDETAILS = helpTask;
					if(task == 'saveuserpassword'){
						delete params.RVWRTQS_ACTCAROUSEL;
						delete params.RVWRTQS_ILBOTYPE;
					}
					if(!Ramcoutil.isEmpty(uiInfo.eventDetails))
						params.RVWRTQS_EVENTDETAILS = 'verifycode';
					
					if (me.osType == 'JAVA') {
						//if (task == 'submit' || task == 'tskstdlogin') {
							params.RVWRTQS_EVENTNAME = (task == 'submit' || task == 'tskstdlogin') ? 'submit' : task;
							params.RVWRTQS_TAB = uiInfo.tabName || 'main';
							// TECH-29211
							// params.RVWRTQS_EVENTTYPE = 'trans';
							params.RVWRTQS_EVENTTYPE = (task == 'transfer') ? 'rvwstandardtask' : 'trans';

							if (task == 'tskstdgetdata') {
								params.RVWRTQS_PCONTROL = 'helpscreen';
								params.RVWRTQS_EVENTTYPE = 'rvwstandardtask';
							}
						//}
					}
					if(task == 'tskstdclink'){
						delete params.RVWRTQS_ACTCAROUSEL;
						delete params.RVWRTQS_TAB;
						delete params.RVWRTQS_CONTROLNAME;
						delete params.RVWRTQS_CONTROLVIEW;
						delete params.RVWRTQS_ACTCAROUSEL;
						params.RVWRTQS_EVENTDETAILS = uiInfo.taskId;
					}
						
                    options['RTC'] = (taskType == 'dummyinstcancel') ? 'dummyinstcancel' : 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		doOProtoTransactions: function(resolve, reject, scope, uiInfo, task, taskType, data) {
			var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {                    
                    var rts = me.RTS,
                        url = rts.getPlfProtoUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: [],
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWTQS_ACTION: taskType,
                            RVWTQS_USER: data.uname,
                            RVWTQS_PWD: data.pwd,
                            RVWTQS_CUST: data.customer,
                            RVWTQS_PROJ: data.project,
                            RVWTQS_REQ: data.request,
                            RVWTQS_CNFGPATH: '',
                            RVWTQS_REVWXMLPATH: '',
                            RVWQS_ACTIVEUI: '',
                            RVWRTQS_REQID: me.sessionToken
                        };					
                    options['RTC'] = 'oprotoLogin';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
		},
        doLink: function(resolve, reject, scope, uiInfo, task, taskType, data) {},
        doHelp: function(resolve, reject, scope, uiInfo, task, taskType, data, ctrlID) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, taskType);
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: ctrlID,
                            RVWRTQS_CONTROLNAME: '',
                            RVWRTQS_CONTROLVIEW: '',
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
                    /* if (uiInfo.ilboType) {
                        params.RVWRTQS_ILBOTYPE = uiInfo.ilboType;
                        params.RVWRTQS_ACTDESC = uiInfo.activityDesc;
                    } */
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
                    if (uiInfo.inlineTab)
                        params.RVWRTQS_EVENTDETAILS = 'INLINETAB';
						
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}	
						
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		doGetMenuNavigationData: function(resolve, reject, scope, uiInfo, task, taskType, ctrlId, ctrlView, value, searchId, searchContext, targetCtrl, row, stVal) {
			var me = this,
                scope = scope || window;            
			if (me.hasRTS) {
				var rts = me.RTS,
					url = rts.getPlfUrl(),
					reqID = me.date(),
					reqCallBack = {
						resolve: resolve,
						reject: reject,
						scope: scope || window
					},
					options = {
						requestId: reqID,
						payload: '',
						payloadType: 'get'
					},
					params = {
						RVWRTQS_PCONTROL: ctrlId,
						RVWRTQS_PVIEW: ctrlView,
						RVWRTQS_REQTYPE: "autosearch",
						RVWRTQS_SEARCHID: searchId,
						RVWRTQS_SEARCHTEXT: value,
						RVWRTQS_SEARCHCONTEXT: searchContext,
						RVWRTQS_AC:uiInfo.activityName,
						RVWRTQS_IL:uiInfo.ilboName,
						RVWRTQS_REQID:me.sessionToken							
					};
				if(stVal)
					params.RVWRTQS_STVAL = stVal;
				else
					params.RVWRTQS_ROWNO = row;
				options['RTC'] = 'avnMenuSearch';
				options['params'] = params;
				options['targetCtrl'] = targetCtrl;					
				options['url'] = getCreateURL(url, params);
				//rts.request(options);
				me.requestQueue[reqID] = reqCallBack;
				RamcoLog.end('Client Trans');
				RamcoLog.start('Server Trans', options.url);
				me.RTS.postMessages(options);
			}            
		},
		doGetCustomListData: function(resolve, reject, scope, uiInfo, task, taskType, ctrlId, ctrlView, value, searchId, searchContext, targetCtrl, row, stVal) {
			var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getPlfUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: '',
                            payloadType: 'get'
                        },
                        params = {
                            RVWRTQS_PCONTROL: ctrlId,
							RVWRTQS_PVIEW: ctrlView,
							RVWRTQS_REQTYPE: "autosearch",
							RVWRTQS_SEARCHID: searchId,
							RVWRTQS_SEARCHTEXT: value,
							RVWRTQS_SEARCHCONTEXT: searchContext,
							RVWRTQS_AC:uiInfo.activityName,
							RVWRTQS_IL:uiInfo.ilboName,
							RVWRTQS_REQID:me.sessionToken							
                        };
					if(stVal)
						params.RVWRTQS_STVAL = stVal;
					else
						params.RVWRTQS_ROWNO = row;
                    options['RTC'] = 'customlistData';                    
                    options['params'] = params;
					options['targetCtrl'] = targetCtrl;					
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.apply(scope, [objMsg]);
            }
		},
        doGetListData: function(resolve, reject, scope, uiInfo, task, taskType, ctrlId, ctrlView, value, searchView, listView, targetCtrl, row) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getAsyncUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: '',
                            payloadType: 'get'
                        },
                        params = {
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_EVENTNAME: 'getlistdata',
                            RVWRTQS_CONTROLNAME: ctrlId,
                            RVWRTQS_CONTROLVIEW: ctrlView,
                            RVWRTQS_CONTROLVALUE: value,
                            RVWRTQS_SEARCHVIEW: searchView,
                            RVWRTQS_LISTVIEW: listView,
							RVWRTQS_ROWNO: row
                        };
					if(me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'getlistdata';
						params.RVWRTQS_PROTO = me.isProto;					
						params.RVWTQS_REQ = RamcoRTC.request;														
					}  	
                    options['RTC'] = 'listData';
                    options['targetCtrl'] = targetCtrl;
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.apply(scope, [objMsg]);
            }
        },
		doGetGridData: function(resolve, reject, scope, uiInfo, ctrlId) {
            var me = this,
                scope = scope || window;
			//TECH-31937
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getGridDataUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: '',
                            payloadType: 'get',
							header: {'Requid':me.sessionToken}
                        },
                        params = {
                            al: uiInfo.activityName,
                            il: uiInfo.ilboName,
                            ct: ctrlId
                        };
                    options['RTC'] = 'gridData';
                    options['targetCtrl'] = ctrlId;
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.apply(scope, [objMsg]);
            }
        },
		doGetLaunchAppPreferences: function(resolve, reject, scope, uiInfo) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getPlfUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: '',
                        payloadType: 'get'
                    },
                    params = {
                        RVWRTQS_REQTYPE: 'getdeflaunch',
                        RVWRTQS_CONTENTTYPE: 'getdeflaunch',
                        RVWQS_CURREQID: me.sessionToken,
                        RVWRTQS_REQID: me.sessionToken
                    };
                options['RTC'] = 'appprefdata';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);                
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                //me.RWT.postMessage(options);
				me.RTS.postMessages(options);
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.apply(scope, [objMsg]);
            }
        },
        doGetLaunch: function(resolve, reject, scope, uiInfo, task, taskType, ctrlId, ctrlView, value, searchView, listView) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getPlfUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: '',
                        payloadType: 'get'
                    },
                    params = {
                        RVWRTQS_REQTYPE: 'getdeflaunch',
                        RVWRTQS_CONTENTTYPE: 'getdeflaunch',
                        RVWRTQS_EVENTNAME: 'getlistdata',
                        RVWQS_CURREQID: me.sessionToken,
                        RVWRTQS_REQID: me.sessionToken,
                        RVWRTQS_PROTO: 'false'
                    };
                options['RTC'] = 'getlaunchdata';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doAbout: function(resolve, reject, scope, uiInfo, task, taskType, ctrlId, ctrlView, value, searchView, listView) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getAbout(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: '',
                        payloadType: 'get'
                    };
                options['RTC'] = 'abtvirtualworks';
                options['url'] = getCreateURL(url, "");
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doCancel: function(resolve, reject, scope, taskInfo, data) {},
        doRefresh: function(resolve, reject, scope, taskInfo, data) {},
        doBackNavigation: function(resolve, reject, scope, uiInfo, task, taskType, data, tBIndex) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, taskType, task, tBIndex);
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_PCONTROL: '',
                            RVWRTQS_CONTROLNAME: '',
                            RVWRTQS_CONTROLVIEW: '',
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_REQID: me.sessionToken
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
						params.RVWRTQS_COMPONENT = uiInfo.compName;
					}
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
					options['tbIndex'] = tBIndex;
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		//TECH-35056
        //doMLTransaction: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end, view) {
		doMLTransaction: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end, view, metaViewName) {
            var me = this,
                view = Ramcoutil.isEmpty(view) ? '' : view,
                pView = (task == 'tskstdmovetorow') ? '1' : view,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
					//TECH-35056
					//data = me.writer[me.prepareDataMethod](data, taskType, task, view);
                    data = me.writer[me.prepareDataMethod](data, taskType, task, view, '', '', metaViewName);
					if(task == 'tskstdunchkall')
						task = 'tskstdchkall';
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: gridId,
                            RVWRTQS_PVIEW: pView,
                            RVWRTQS_CONTROLNAME: '',
                            RVWRTQS_CONTROLVIEW: '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_EVENTDETAILS: start || '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}
                    /* if (uiInfo.ilboType) {
                        params.RVWRTQS_ILBOTYPE = uiInfo.ilboType;
                        params.RVWRTQS_ACTDESC = uiInfo.activityDesc;
                    } */
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
                    /*if(uiInfo.inlineTab) 
                    	params.RVWRTQS_EVENTDETAILS = 'INLINETAB';*/
						
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						// TECH-29204
						// params.RVWRTQS_EVENTTYPE = 'trans';
						params.RVWRTQS_EVENTTYPE = Ramcoutil.isEmpty(taskType)?'trans':taskType;
					}
					
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doSort: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, viewname, dir) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
					// TECH-29773
					/* if (viewname == 'msort')
						data = me.writer[me.prepareDataMethod](data, taskType, task, null, gridId);
					else */
                    	data = me.writer[me.prepareDataMethod](data, taskType, undefined, undefined, gridId); // TECH-30607
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: gridId,
                            //RVWRTQS_PVIEW: viewname, // TECH-31371
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_EVENTDETAILS: dir,
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken || 'START'
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}
					// TECH-30607
					if ((data && data.msortData && data.msortData.length > 0) || dir == 'msort') { // TECH-31812
						params.RVWRTQS_EVENTDETAILS = 0; // TECH-31812
						//delete params.RVWRTQS_PVIEW;
					}else{
						params.RVWRTQS_PVIEW = viewname; // TECH-31371
					}
                    /* if (uiInfo.ilboType) {
                        params.RVWRTQS_ILBOTYPE = uiInfo.ilboType;
                        params.RVWRTQS_ACTDESC = uiInfo.activityDesc;
                    } */
					if(Ramcoutil.isEmpty(me.currentInstance) || (me.currentInstance && me.currentInstance == 'default')) // TECH-31371
						delete params.RVWRTQS_ACTCAROUSEL;
					
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
					
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doExport: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = (me.osType == 'JAVA') ? rts.JGridExportUrl : rts.getGridExportUrl(),
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PARENTCONTROL: gridId,
                            RVWRTQS_CLIENTTYPE: 'extjs',
                            RVWRTQS_EVENTNAME: 'export',
                            RVWRTQS_EVENTDETAILS: 'excel',
                            RVWRTQS_ACTION: 'save',
                            RVWRTQS_REQTYPE: 'excel',
                            RVWRTQS_REQCLIENT: 'false',
                            RVWRTQS_NEWSHEET: '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_REQID: me.sessionToken || 'START'
                        };
                    if (uiInfo.ilboType) {
                        params.RVWRTQS_ILBOTYPE = uiInfo.ilboType;
                        params.RVWRTQS_ACTDESC = uiInfo.activityDesc;
                    }
					
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
					
                    url = getCreateURL(url, params);
                    var formObj = document.getElementById('payloadForm'),
						payLoadData = document.getElementById('payloadData');						
					if (formObj && payLoadData) {
						formObj.action = url;
						payLoadData.value = data;
						document.forms["RVWExportData"].submit();
					}
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doPDFExport: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = (me.osType == 'JAVA') ? rts.JGridPDFUrl : rts.getGridPDFUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_CLIENTTYPE: 'extjs',
                            RVWRTQS_ACTION: task,
                            RVWRTQS_REQTYPE: 'grid',
                            RVWRTQS_REQCLIENT: 'false',
                            RVWQS_ACTIVEUI: '',
                            RVWRTQS_REQID: me.sessionToken || 'START'
                        };
					var _url = getCreateURL(url, params);					
					options['RTC'] = 'exporttopdf';
                    options['params'] = params;
                    options['url'] = _url;
                    if (task == 'save') {
                        //rts.request(options);
                        me.requestQueue[reqID] = reqCallBack;
                        RamcoLog.end('Client Trans');
                        RamcoLog.start('Server Trans', options.url);
                        me.RTS.postMessages(options);
                    }
					//else
                        //window.open(_url, '_blank');
					else {
						var linkD=document.getElementById('anchordownload');
							linkD.href = _url;
							linkD.click();
					}
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doCSVExport: function(resolve, reject, scope, uiInfo, action, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = (me.osType == 'JAVA') ? rts.JGridPDFUrl : rts.getGridPDFUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_CLIENTTYPE: 'extjs',
                            RVWRTQS_ACTION: action,
                            RVWRTQS_REQTYPE: 'csv',
                            RVWRTQS_REQCLIENT: 'false',
                            RVWRTQS_NEWSHEET: '',
                            RVWQS_ACTIVEUI: '',
                            RVWRTQS_PROTO: false,
                            RVWRTQS_REQID: me.sessionToken || 'START'
                        };
                    options['RTC'] = 'exporttocsv'; //gridExportReport
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    if (action == 'save') {
                        //rts.request(options);
                        me.requestQueue[reqID] = reqCallBack;
                        RamcoLog.end('Client Trans');
                        RamcoLog.start('Server Trans', options.url);
                        me.RTS.postMessages(options);
                    } else {
                        //window.open(options['url'], '_blank');
						var linkD=document.getElementById('anchordownload');
							linkD.href = options['url'];
							linkD.click();
					}
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doExportReport: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        // TECH-29232
                        // url = (me.osType == 'JAVA') ? rts.JGridExportReportUrl : rts.getGridExportReportUrl(),
						url = rts.getGridExportReportUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_CLIENTTYPE: 'extjs',
                            RVWRTQS_ACTION: 'data',
                            RVWRTQS_REQTYPE: 'report',
                            RVWQS_ACTIVEUI: '',
                            RVWRTQS_PROTO: false,
                            RVWRTQS_REQID: me.sessionToken
                        };
                    options['RTC'] = 'gridExportReport';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    if (task == 'save') {
                        //rts.request(options);
                        me.requestQueue[reqID] = reqCallBack;
                        RamcoLog.end('Client Trans');
                        RamcoLog.start('Server Trans', options.url);
                        me.RTS.postMessages(options);
                    } else {
                        //window.open(options['url'], '_blank');
						var linkD=document.getElementById('anchordownload');
							linkD.href = options['url'];
							linkD.click();
					}
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doExportChart: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        // TECH-29232
                        // url = (me.osType == 'JAVA') ? rts.JGridExportReportUrl : rts.getGridExportReportUrl(),
						url = rts.getGridExportReportUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_CLIENTTYPE: 'extjs',
                            RVWRTQS_ACTION: 'data',
                            RVWRTQS_REQTYPE: 'chart',
                            RVWQS_ACTIVEUI: '',
							RVWRTQS_PROTO: false,
                            RVWRTQS_REQID: me.sessionToken
                        };
                    options['RTC'] = 'gridExportChart';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    if (task == 'save') {
                        //rts.request(options);
                        me.requestQueue[reqID] = reqCallBack;
                        RamcoLog.end('Client Trans');
                        RamcoLog.start('Server Trans', options.url);
                        me.RTS.postMessages(options);
                    } else {
                        //window.open(options['url'], '_blank');
						var linkD=document.getElementById('anchordownload');
							linkD.href = options['url'];
							linkD.click();
					}
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doHtmlExport: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
						// TECH-29232
						// url = (me.osType == 'JAVA') ? rts.JGridHtmlUrl : rts.getGridHtmlUrl(),
						url = rts.getGridHtmlUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_TYPE: task,
                            RVWRTQS_AC: uiInfo.activityName,
                            RVWRTQS_IL: uiInfo.ilboName,
                            RVWRTQS_CT: gridId,
                            RVWRTQS_REQID: me.sessionToken || 'START',
                            RVWQS_ACTIVEUI: ''
                        };
                    options['RTC'] = 'gridExport';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    if (task == 'save') {
                        //rts.request(options);
                        me.requestQueue[reqID] = reqCallBack;
                        RamcoLog.end('Client Trans');
                        RamcoLog.start('Server Trans', options.url);
                        me.RTS.postMessages(options);
                    } else {
                        /*//window.open(options['url'], '_blank');
						var linkD=document.getElementById('anchordownload');
							linkD.href = options['url'];
							linkD.click();*/
						me.requestQueue[reqID] = reqCallBack;
                        RamcoLog.end('Client Trans');
                        RamcoLog.start('Server Trans', options['url']);
						options['RTC'] = 'saveHtml';
                        me.RTS.postMessages(options);	
					}
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		doValidateFile: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getGridImportCSVUrl(),
                        reqID = me.date(),
                        /*reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },*/						
                        options = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope,
                            payload: data,
                            payloadType: 'form'
                        },
                        params = {
                            RVWQS_ACTIVEUI: '',
							RVWRTQS_TYPE: 'validate',
                            RVWRTQS_AC: uiInfo.activityName,
                            RVWRTQS_IL: uiInfo.ilboName,
                            RVWRTQS_CT: gridId,                            
                            RVWRTQS_REQID: me.sessionToken || 'START'                            
                        };
                    options['RTC'] = 'validateFile';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    rts.request(options);					
                    /*me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);*/
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		doImportCSV: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getGridImportCSVUrl(),
                        reqID = me.date(),
                        /*reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },*/						
                        options = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope,
                            payload: data,
                            payloadType: 'form'
                        },
                        params = {
                            RVWQS_ACTIVEUI: '',
							RVWRTQS_TYPE: 'import',
                            RVWRTQS_AC: uiInfo.activityName,
                            RVWRTQS_IL: uiInfo.ilboName,
                            RVWRTQS_CT: gridId,                            
                            RVWRTQS_REQID: me.sessionToken || 'START'                            
                        };
                    options['RTC'] = 'csvdataresponse';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    rts.request(options);					
                    /*me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);*/
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doImport: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId, start, end) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getGridImportUrl(),
                        reqID = me.date(),
                        /*reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },*/						
                        options = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope,
                            payload: data,
                            payloadType: 'form'
                        },
                        params = {
                            RVWRTQS_TYPE: 'import',
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_CONTROLNAME: gridId,
                            RVWRTQS_IMPORTEXCELPATH: 'test',
                            RVWRTQS_REQID: me.sessionToken || 'START',
                            RVWQS_ACTIVEUI: ''
                        };
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    rts.request(options);					
                    /*me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);*/
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doUpload: function(resolve, reject, scope, uiInfo, task, taskType, data) {
            var me = this,
                scope = scope || window;
            if (data) {
                if (me.hasRTS) {
                    me.scope = scope;
                    me.resolveFn = resolve;
                    me.rejectFn = reject;
                    me.upLoader = new Uploader();
					if(data.avnFileUplaod) {
						me.upLoader.initAvnData(data, me.RTS, uiInfo, me);
						me.upLoader.uploadAvnData(resolve, reject, scope);
					}
					else {
						me.upLoader.initData(data, me.RTS, uiInfo, me);
						me.upLoader.uploadData(resolve, reject, scope);
					}
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doGetTemplateData: function(resolve, reject, scope, uiInfo, eventDtls) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        data = me.writer[me.prepareDataMethod](data, 'rvwstandardtask');
                    reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName || '',//TECH-35081 /PTPH-41
                            RVWRTQS_PCONTROL: '',
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTNAME: 'tsksysapplydefaults',
                            RVWRTQS_EVENTDETAILS: eventDtls,
                            RVWRTQS_REQID: me.sessionToken || 'START',
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_TRACE: false,
                            RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_PROTO: false,
                            RVWRTQS_RTTASK: true
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}	
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
						
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
					
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doSearch: function(resolve, reject, scope, uiInfo, task, taskType, data, ctrlId, searchBy, searchValue) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        data = me.writer[me.prepareDataMethod](data, taskType);
                    reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: 'form'
                        },

                        params = {
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: '',
                            RVWRTQS_PCONTROL: ctrlId,
                            RVWRTQS_PVIEW: searchBy,
                            RVWRTQS_EVENTNAME: 'tskstdsearch',
                            RVWRTQS_EVENTDETAILS: searchValue,
                            RVWRTQS_REQID: me.sessionToken || 'START',
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_TRACE: false,
                            RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_XMLHTTP: true
                        };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}	
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
					
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
					
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        resolve: function(response, options) {
            var me = this;
            me.resolveFn.call(me.scope, response, options);
            me.resolveFn = null;
            me.rejectFn = null;
            me.scope = null;
            me.upLoader = null;
            delete me.resolveFn;
            delete me.rejectFn;
            delete me.scope;
            delete me.upLoader;
        },
        reject: function(response, options) {
            var me = this;
            me.rejectFn.call(me.scope, response, options);
            me.resolveFn = null;
            me.rejectFn = null;
            me.scope = null;
            me.upLoader = null;
            delete me.resolveFn;
            delete me.rejectFn;
            delete me.scope;
            delete me.upLoader;
        },
		getAvnCustomAction: function(resolve, reject, scope, uiInfo, task, taskType, role) {
			var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getAvnCustomActionUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            //payload: '',
                            //payloadType: 'get'
							payloadType: 'post',
							payload: '<NoLoad />'
                        },
                        params = {
                            RVWRTQS_COMPONENTNAME: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
							RVWRTQS_ILBO: uiInfo.ilboName,
							RVWRTQS_CLIENTTYPE: "extjs",
							RVWRTQS_ACTION: "SETOPTION",
							RVWRTQS_ROLE: role,
                            RVWQS_ACTIVEUI: ""
                        };
                    options['RTC'] = 'getavncustomdata';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
		},
        doDownload: function(resolve, reject, scope, taskInfo, data) {},
        // TECH-33960
		doWizardAttachmentDownload: function(resolve, reject, scope, uiInfo, ctrlId, ctrlView, row, fileName, srcPath) {
			var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getWizardFileDownloadUrl(),
                        reqID = me.date(),
						dateJunk = new Date().toGMTString(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: '',
                            payloadType: 'get'
                        },
                        params = {
                            RVWRTQS_COMPONENTNAME: uiInfo.componentName,
							RVWRTQS_ACTIVITY: uiInfo.activityName,
							RVWRTQS_ILBO: uiInfo.ilboName,
							RVWRTQS_EVENTNAME: 'null',
							RVWRTQS_CONTROLNAME: ctrlId,
                            RVWRTQS_CONTROLVIEW: ctrlView,
							RVWRTQS_ROWNO: row || 0,
							RVWRTQS_IS_ML: true,
							RVWRTQS_FILENAME: fileName,
							RVWRTQS_REQID: me.sessionToken,
							RVWRTQS_AVNDOWNLOAD: false,
							RVWRTQS_JUNK: dateJunk,
                            RVWRTQS_DVIEW: '',
                            RVWRTQS_MODE: 'undefined',
                            RVWRTQS_STOREPATH: srcPath
                        };
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
					
					var _url = options['url']					
					window.open(_url, '_blank');
					
					/* var linkD = document.getElementById('anchordownload');
					linkD.href = _url;
					linkD.click(); */
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
		},
		doDelete: function(resolve, reject, scope, uiInfo, task, taskType, ctrlId, view, row, srcPath, assView, dView) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getAsyncUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: '',
                            payloadType: 'get'
                        },
                        params = {
                            RVWRTQS_COMPONENTNAME: uiInfo.componentName,
                            RVWRTQS_ROWNO: row || 0,
                            RVWRTQS_DVIEW: assView,
							RVWRTQS_STOREPATH_VWNAME: dView,
                            RVWRTQS_MODE: null,
                            RVWRTQS_STOREPATH: srcPath,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_CONTROLNAME: ctrlId,
                            RVWRTQS_CONTROLVIEW: view,
                            RVWRTQS_EVENTNAME: 'filedelete',
                            RVWRTQS_JUNK: (Date.now())
                            //RVWRTQS_REQID: me.sessionToken || 'START'
                        };
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },		
		doAsyncCall: function(resolve, reject, scope, uiInfo) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getAsyncUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: '',
                            payloadType: 'get'
                        },
                        params = {
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_EVENTNAME: 'udsvisualcue'
                        };
                    options['RTC'] = 'rvwAsync';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doLogout: function(resolve, reject, scope, uiInfo, task, taskType) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getDispatcher(),
                    data = me.writer[me.prepareDataMethod](data, taskType),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: data,
                        payloadType: me.postDataType
                    },
                    params = {
                        RVWRTQS_PCONTROL: '',
                        RVWRTQS_CONTROLNAME: '',
                        RVWRTQS_CONTROLVIEW: '',
                        RVWRTQS_PVIEW: '',
                        RVWRTQS_EVENTNAME: task,
                        RVWRTQS_EVENTDETAILS: '',
                        RVWRTQS_TRACE: false,
                        RVWRTQS_XMLHTTP: true,
                        RVWRTQS_ACTCAROUSEL: me.currentInstance,
                        RVWRTQS_REQID: me.sessionToken
                    };
				if (me.isProto) {
					url = rts.getPlfProtoUrl();
					params.RVWTQS_ACTION = 'ilbotask';
					params.RVWQTS_CMPPATH = '';
					params.RVWRTQS_PROTO = me.isProto;
				}	
                if (uiInfo) {
                    params['RVWRTQS_COMPONENT'] = uiInfo.componentName;
                    params['RVWRTQS_ACTIVITY'] = uiInfo.activityName;
                    params['RVWRTQS_ILBO'] = uiInfo.ilboName;
                    params['RVWRTQS_TAB'] = uiInfo.tabName;
                }
				
				if (me.osType == 'JAVA') {
					params.RVWRTQS_TAB = uiInfo.tabName || 'main';
					params.RVWRTQS_EVENTTYPE = 'trans';
				}
				
                options['RTC'] = 'uiMethod';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },
		doLogoutDtls: function(task, taskType, uiInfo) {
            var me = this;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getDispatcher(),
                    params = {
                        RVWRTQS_PCONTROL: '',
                        RVWRTQS_CONTROLNAME: '',
                        RVWRTQS_CONTROLVIEW: '',
                        RVWRTQS_PVIEW: '',
                        RVWRTQS_EVENTNAME: task,
                        RVWRTQS_EVENTDETAILS: '',
                        RVWRTQS_TRACE: false,
                        RVWRTQS_XMLHTTP: true,
                        RVWRTQS_ACTCAROUSEL: me.currentInstance,
                        RVWRTQS_REQID: me.sessionToken
                    };
				if (me.isProto) {
					url = rts.getPlfProtoUrl();
					params.RVWTQS_ACTION = 'ilbotask';
					params.RVWQTS_CMPPATH = '';
					params.RVWRTQS_PROTO = me.isProto;
				}	
				if (uiInfo) {
                    params['RVWRTQS_COMPONENT'] = uiInfo.componentName;
                    params['RVWRTQS_ACTIVITY'] = uiInfo.activityName;
                    params['RVWRTQS_ILBO'] = uiInfo.ilboName;
                }
                return getCreateURL(url, params);
            }
        },
		onGetILBOOURoleData: function(resolve, reject, scope, uiInfo, task, taskType, data) {
			var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getDispatcher(),
                    data = me.writer[me.prepareDataMethod](data, taskType),
					reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: data,
                        payloadType: me.postDataType
                    },				
                    params = {
						RVWRTQS_LANGID: me.lang,                        
                        RVWRTQS_EVENTNAME: task,                        
                        RVWRTQS_TRACE: 'TRUE',
                        RVWRTQS_XMLHTTP: 'TRUE',
						RVWRTQS_ASYNC: 'TRUE',
						RVWRTQS_RTTASK: 'TRUE',                        
                        RVWRTQS_REQID: me.sessionToken
                    };
				if (me.isProto) {
					url = rts.getPlfProtoUrl();
					params.RVWTQS_ACTION = 'ilbotask';
					params.RVWQTS_CMPPATH = '';
					params.RVWRTQS_PROTO = me.isProto;
				}	
				if (uiInfo.ilboType) {
					params.RVWRTQS_ILBOTYPE = "3"; //|| uiInfo.ilboType;					
				}
                if (uiInfo) {
                    params['RVWRTQS_COMPNAME'] = uiInfo.componentName;
                    params['RVWRTQS_ACTIVITY'] = uiInfo.activityName;
                    params['RVWRTQS_ILBO'] = uiInfo.ilboName;
                    params['RVWRTQS_TAB'] = uiInfo.tabName;
                }
				
				if (me.osType == 'JAVA') {
					params['RVWRTQS_TAB'] = uiInfo.tabName || 'main';
					params['RVWRTQS_EVENTTYPE'] = 'trans';
				}
				
                options['RTC'] = 'ILBOOURoleData';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
				me.requestQueue[reqID] = reqCallBack;
				RamcoLog.end('Client Trans');
				RamcoLog.start('Server Trans', options.url);
				me.RTS.postMessages(options);
            }
		},
		applyILBOOURoleData: function(resolve, reject, scope, uiInfo, task, taskType, data) {
			var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getDispatcher(),
                    data = me.writer[me.prepareDataMethod](data, taskType),
					reqID = me.date(),
					reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: data,
                        payloadType: me.postDataType
                    },				
                    params = {
						RVWRTQS_LANGID: me.lang,                        
                        RVWRTQS_EVENTNAME: task,                        
                        RVWRTQS_TRACE: 'TRUE',
                        RVWRTQS_XMLHTTP: 'TRUE',
						RVWRTQS_ASYNC: 'TRUE',						
                        RVWRTQS_REQID: me.sessionToken
                    };
					if (me.isProto) {
						url = rts.getPlfProtoUrl();
						params.RVWTQS_ACTION = 'ilbotask';
						params.RVWQTS_CMPPATH = '';
						params.RVWRTQS_PROTO = me.isProto;
					}
				if (uiInfo.ilboType) {
					params.RVWRTQS_ILBOTYPE = "3"; //|| uiInfo.ilboType;					
				}
                if (uiInfo) {
                    params['RVWRTQS_COMPNAME'] = uiInfo.componentName;
                    params['RVWRTQS_ACTIVITY'] = uiInfo.activityName;
                    params['RVWRTQS_ILBO'] = uiInfo.ilboName;					
                    params['RVWRTQS_TAB'] = uiInfo.tabName;
                }
				
				if (me.osType == 'JAVA') {
					params['RVWRTQS_TAB'] = uiInfo.tabName || 'main';
					params['RVWRTQS_EVENTTYPE'] = 'trans';
				}
				
                options['RTC'] = 'uiMethod';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
				me.requestQueue[reqID] = reqCallBack;
				RamcoLog.end('Client Trans');
				RamcoLog.start('Server Trans', options.url);
				me.RTS.postMessages(options);
            }
		},
		doTreeSearchData: function(resolve, reject, scope, uiInfo, task, taskType, data, treeId, searchTxt, searchType, searchLvl, nodeId) {			
			var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getTreeSearchUrl(),
                    data = me.writer[me.prepareDataMethod](data, taskType),
					reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: data,
                        payloadType: ""
                    },				
                    params = {
						treeid: treeId,
                        srchtext: searchTxt,
                        srchtype: searchType,
                        srchlevel: searchLvl,
						ilbocode: uiInfo.ilboName,
						actname: uiInfo.activityName,                        
                        nodeid: nodeId
                    };				
                options['RTC'] = 'treesearchdata';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
				me.requestQueue[reqID] = reqCallBack;
				RamcoLog.end('Client Trans');
				RamcoLog.start('Server Trans', options.url);
				me.RTS.postMessages(options);
            }		
		},
        doSNBNavigation: function(resolve, reject, scope, uiInfo, task, taskType, data, num, action) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data.snbNum = num;
					if(!Ramcoutil.isEmpty(action))
                    	data.snbAction = action;
                    data = me.writer[me.prepareDataMethod](data, taskType);
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_PCONTROL: '',
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
						if (me.isProto) {
							url = rts.getPlfProtoUrl();
							params.RVWTQS_ACTION = 'ilbotask';
							params.RVWQTS_CMPPATH = '';
							params.RVWRTQS_PROTO = me.isProto;
						}
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
						
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
					
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doSavePersonalization: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, taskType);
                    var rts = me.RTS,
                        url = gridId ? rts.getDispatcher() : rts.getPlfPersUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRQTS_COMPNAME: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_PCONTROL: gridId,
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
						
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}	
						
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doRemovePersonalization: function(resolve, reject, scope, uiInfo, task, taskType, data, gridId) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, taskType);
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRQTS_COMPNAME: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_PCONTROL: gridId,
                            RVWRTQS_PVIEW: '',
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_ACTCAROUSEL: me.currentInstance,
                            RVWRTQS_REQID: me.sessionToken
                        };
						if (me.isProto) {
							url = rts.getPlfProtoUrl();
							params.RVWTQS_ACTION = 'ilbotask';
							params.RVWQTS_CMPPATH = '';
							params.RVWRTQS_PROTO = me.isProto;
						}
					if(Ramcoutil.isEmpty(me.currentInstance))
						delete params.RVWRTQS_ACTCAROUSEL;
						
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
						// TECH-29109
						params.RVWRTQS_COMPONENT = params.RVWRQTS_COMPNAME;
						delete params.RVWRQTS_COMPNAME;
					}
						
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		// TECH-28159 / TECH-26959
		// doMultiSort: function(resolve, reject, scope, uiInfo, task, taskType, gridId, data) {
		doMultiSort: function(resolve, reject, scope, uiInfo, task, taskType, gridId, data, sortState) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    data = me.writer[me.prepareDataMethod](data, taskType, task, '', gridId);
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRTQS_ACTIVITY:uiInfo.activityName,
							RVWRTQS_ILBO:uiInfo.ilboName,
							RVWRTQS_TAB:uiInfo.tabName || '',
							RVWRTQS_EVENTNAME:task,
							RVWRTQS_PCONTROL:gridId,
							RVWRTQS_REQID:me.sessionToken,
							RVWRTQS_PROTO:false,
							RVWRTQS_TRACE:false,
							RVWRTQS_XMLHTTP:true
                        };
                    options['RTC'] = 'gridMultiSort';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
					options['sortState'] = sortState; // TECH-28159 / TECH-26959
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doColumnPersonalization: function(resolve, reject, scope, uiInfo, task, taskType, gridId, data) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    if (task == 'SAVEDOC' && data) {
                        data = me.writer[me.prepareDataMethod](data, taskType, task, null, gridId); // TECH-34273
                    } else
                        data = '';
                    var rts = me.RTS,
                        url = rts.getPlfPersUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            RVWRQTS_COMPNAME: uiInfo.componentName,
                            RVWRTQS_ACTNAME: uiInfo.activityName,
                            RVWRTQS_ILBONAME: uiInfo.ilboName,
                            RVWRTQS_PERSTYPE: me.isEntUser ? 'ENT' : 'USR',
                            RVWRTQS_REQTYPE: task,
                            RVWRTQS_CTRL: gridId || '',
                            RVWRTQS_TRACE: false,
                            RVWRTQS_XMLHTTP: true,
                            RVWRTQS_REQID: me.sessionToken
                        };
						
					// TECH-30723
					if (RamcoRTC.isProto)
						params.RVWRTQS_PROTO = RamcoRTC.isProto;
						
                    options['RTC'] = (task == 'GETDOC') ? 'colGetPers' : 'colSavePers';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doColumnSaveDefaults: function(resolve, reject, scope, uiInfo, task, taskType, gridId, data, colStatus) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    if (data) {
                        data = me.writer[me.prepareDataMethod](data, taskType, task, '', gridId, colStatus);
                    }

                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            /* RVWRQTS_COMPNAME:uiInfo.componentName, */
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_PCONTROL: gridId,
                            RVWRTQS_PVIEW: (task == 'tskstdgriddefault' && colStatus == 'true') ? '1' : '',
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: 'false',
                            RVWRTQS_PROTO: 'false',
                            RVWRTQS_XMLHTTP: 'true',
                            RVWRTQS_REQID: me.sessionToken
                        };
						if (me.isProto) {
							url = rts.getPlfProtoUrl();
							params.RVWTQS_ACTION = 'ilbotask';
							params.RVWQTS_CMPPATH = '';
							params.RVWRTQS_PROTO = me.isProto;
						}
                    options['RTC'] = (task == 'tskstdgriddefault') ? 'colSaveDefault' : 'colSaveDefaultPers';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doColumnClearDefaults: function(resolve, reject, scope, uiInfo, task, taskType, gridId, data, colStatus) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    //if(data && task == 'tskstdsavepersonalization'){
                    data = me.writer[me.prepareDataMethod](data, taskType, task, '', gridId, colStatus);
                    //}

                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
                            /* RVWRQTS_COMPNAME:uiInfo.componentName, */
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_PCONTROL: gridId,
                            RVWRTQS_PVIEW: (task == 'tskstdcleardefault') ? '1' : '',
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: 'false',
                            RVWRTQS_PROTO: 'false',
                            RVWRTQS_XMLHTTP: 'true',
                            RVWRTQS_REQID: me.sessionToken
                        };
						if (me.isProto) {
							url = rts.getPlfProtoUrl();
							params.RVWTQS_ACTION = 'ilbotask';
							params.RVWQTS_CMPPATH = '';
							params.RVWRTQS_PROTO = me.isProto;
						}
                    options['RTC'] = (task == 'tskstdcleardefault') ? 'colClearDefaultPers' : 'colClearDefault';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		doColumnFilter: function(resolve, reject, scope, uiInfo, task, taskType, gridId, data, colStatus) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    if (data) {
                        data = me.writer[me.prepareDataMethod](data, taskType, task, '', gridId, colStatus);
                    }

                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: ""
                        },
                        params = {
                            /* RVWRQTS_COMPNAME:uiInfo.componentName, */
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_PCONTROL: gridId,
                            RVWRTQS_PVIEW: '1',
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: 'false',
                            RVWRTQS_PROTO: 'false',
                            RVWRTQS_XMLHTTP: 'true',
                            RVWRTQS_REQID: me.sessionToken
                        };
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doColumnClearFilter: function(resolve, reject, scope, uiInfo, task, taskType, gridId, data, colStatus) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    //if(data && task == 'tskstdsavepersonalization'){
                    data = me.writer[me.prepareDataMethod](data, taskType, task, '', gridId, colStatus);
                    //}

                    var rts = me.RTS,
                        url = rts.getDispatcher(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: ""
                        },
                        params = {
                            /* RVWRQTS_COMPNAME:uiInfo.componentName, */
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: '',
                            RVWRTQS_EVENTNAME: task,
                            RVWRTQS_PCONTROL: gridId,
                            RVWRTQS_PVIEW: (task == 'tskstdcleardefault') ? '1' : '',
                            RVWRTQS_EVENTDETAILS: '',
                            RVWRTQS_TRACE: 'false',
                            RVWRTQS_PROTO: 'false',
                            RVWRTQS_XMLHTTP: 'true',
                            RVWRTQS_REQID: me.sessionToken
                        };
                    options['RTC'] = 'uiMethod';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },		
		// TECH-29150
		doDummyTask: function(resolve, reject, scope, uiInfo, data, evtDtls) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getDispatcher(),
						data = me.writer[me.prepareDataMethod](data, 'trans');
                    reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: data,
                            payloadType: me.postDataType
                        },
                        params = {
							RVWRTQS_ACTIVITY: uiInfo.activityName,
							RVWRTQS_ILBO: uiInfo.ilboName,
							RVWRTQS_TAB: uiInfo.tabName,
							RVWRTQS_EVENTNAME: (me.osType == 'JAVA') ? 'tskstddummy' : 'tskdummy',
							RVWRTQS_PCONTROL: '',
							RVWRTQS_PVIEW: '',
							RVWRTQS_EVENTDETAILS: evtDtls || '',  // TECH-29150
							RVWRTQS_REQID: me.sessionToken,
							RVWRTQS_TRACE: 'false',
                            RVWRTQS_PROTO: 'false',
                            RVWRTQS_XMLHTTP: 'true',
                        };
						if (me.isProto) {
							url = rts.getPlfProtoUrl();
							params.RVWTQS_ACTION = 'ilbotask';
							params.RVWQTS_CMPPATH = '';
							params.RVWRTQS_PROTO = me.isProto;
						}

					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
					
					options['RTC'] = 'dummyTask';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
		},
        doPrintExport: function(resolve, reject, scope, uiInfo, action, taskType, data, helpTask, ctrlId, viewName, pCtrl, pView) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
						// TECH-33537
                        url = rts.getPrintUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: ((action == 'save') ? data : ''),
                            payloadType: 'form',
                        },
                        params = {
                            RVWRTQS_COMP: uiInfo.componentName,
                            RVWRTQS_ACT: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_TAB: uiInfo.tabName,
                            RVWRTQS_CLIENTTYPE: 'extjs',
                            RVWRTQS_ACTION: action,
                            RVWRTQS_REQTYPE: 'page',
                            RVWRTQS_PROTO: false,
                            RVWQS_ACTIVEUI: '',
                            RVWRTQS_REQID: me.sessionToken
                        };
                    if (action == 'view') {
                        delete params.RVWRTQS_COMP;
                        delete params.RVWRTQS_ACT;
                        delete params.RVWRTQS_ILBO;
                        delete params.RVWRTQS_TAB;
                        params.RVWRTQS_EXTENDED = '0';
                    }
					
					if (me.osType == 'JAVA') {
						params.RVWRTQS_TAB = uiInfo.tabName || 'main';
						params.RVWRTQS_EVENTTYPE = 'trans';
					}
					
                    options['RTC'] = 'printScreen';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);

                    if (action == 'save') {
                        /* var _divTag = document.createElement('DIV');
                        var dt='';
                        dt += '<form action="' + options['url']  + '" name="RVWExportData" enctype="multipart/form-data" target="fn1" method="post" onsubmit="return true;" >';
                        dt += "<input type='hidden' id='payload' name='payload' value='" + data + "'>";
                        dt += '</form>';
                        _divTag.innerHTML = dt;
                        document.body.appendChild(_divTag);
                        document.forms["RVWExportData"].submit(); */
                        //rts.request(options);
                        me.requestQueue[reqID] = reqCallBack;
                        RamcoLog.end('Client Trans');
                        RamcoLog.start('Server Trans', options.url);
                        me.RTS.postMessages(options);
                    } else
                        openWindow(options['url']);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
        doGetPersRoles: function(resolve, reject, scope, uiInfo) {
            var me = this,
                scope = scope || window;
            if (uiInfo && uiInfo.ilboName) {
                if (me.hasRTS) {
                    var rts = me.RTS,
                        url = rts.getPlfUrl(),
                        reqID = me.date(),
                        reqCallBack = {
                            resolve: resolve,
                            reject: reject,
                            scope: scope || window
                        },
                        options = {
                            requestId: reqID,
                            payload: ''
                        },
                        params = {
                            RVWRTQS_COMPONENT: uiInfo.componentName,
                            RVWRTQS_ACTIVITY: uiInfo.activityName,
                            RVWRTQS_ILBO: uiInfo.ilboName,
                            RVWRTQS_CLIENTTYPE: 'extjs',
                            RVWRTQS_REQTYPE: 'menu',
                            RVWRTQS_CONTENTTYPE: 'getallroles',
                            RVWQS_CURREQID: me.sessionToken,
                            RVWRTQS_PROTO: false,
                            RVWRTQS_REQID: me.sessionToken
                        };

                    options['RTC'] = 'colGetRoles';
                    options['params'] = params;
                    options['url'] = getCreateURL(url, params);
                    //rts.request(options);
                    me.requestQueue[reqID] = reqCallBack;
                    RamcoLog.end('Client Trans');
                    RamcoLog.start('Server Trans', options.url);
                    me.RTS.postMessages(options);
                }
            } else {
                var objMsg = {};
                objMsg['sr'] = 'RTC';
                objMsg['sv'] = 5;
                objMsg['cd'] = 'RTC-1';
                reject.call(scope, objMsg);
            }
        },
		doAvnMenuSearch: function(resolve, reject, scope, uiInfo, value) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getPlfUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: '',
                        payloadType: me.postDataType
                    },
                    params = {
                        RVWRTQS_REQTYPE: "quicksearch",
                        RVWRTQS_SEARCHID: "activitylist01",
                        RVWRTQS_QUERY: value,
                        RVWRTQS_ROLE: me.userInfo.r,
						RVWRTQS_OU: me.userInfo.ou,
						RVWRTQS_REQID: me.sessionToken,
						RVWRTQS_PROTO: me.isProto						
                    };
                options['RTC'] = 'avnMenuSearch';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },		
        doMenuSearch: function(resolve, reject, scope, searchText) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getMenuSearchUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: '',
                        payloadType: me.postDataType
                    },
                    params = {
                        query: searchText,
                        page: 1,
                        start: 0,
                        limit: 25
                    };
                options['RTC'] = 'menuSearch';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        },
		launchQuickIlboScreen: function(resolve, reject, scope, value) {
            var me = this,
                scope = scope || window;
            if (me.hasRTS) {
                var rts = me.RTS,
                    url = rts.getPlfUrl(),
                    reqID = me.date(),
                    reqCallBack = {
                        resolve: resolve,
                        reject: reject,
                        scope: scope || window
                    },
                    options = {
                        requestId: reqID,
                        payload: '',
                        payloadType: me.postDataType
                    },
                    params = {
                        RVWRTQS_OPERATION: "preference",
                        RVWRTQS_CONTENTTYPE: "ql",
                        RVWRTQS_TYPE: "ql",
                        RVWRTQS_REQTYPE: "preference",
						RVWRTQS_CODE: value,
						RVWQS_CURREQID: me.sessionToken,
						RVWRTQS_REQID: me.sessionToken,
						RVWRTQS_PROTO: me.isProto						
                    };
                options['RTC'] = 'quickilbolaunch';
                options['params'] = params;
                options['url'] = getCreateURL(url, params);
                //rts.request(options);
                me.requestQueue[reqID] = reqCallBack;
                RamcoLog.end('Client Trans');
                RamcoLog.start('Server Trans', options.url);
                me.RTS.postMessages(options);
            }
        }




        //Native Apis

    };
})();

//private APIs
function RamcoLogger() {

}

(function() {
    RamcoLogger.prototype = {
        log: [],
        logId: [],
        logNames: [],
		cSTime: null,
		sSTime: null,
		clientTime: 0,
		serverTime: 0,
		date:Date.now,
        start: function(name, url) {
            var me = this
				logdate = me.date();
            
			if (name == 'Client Trans')
                //me.cSTime = me.log[me.log.length - 1].t;
				me.cSTime = logdate;
            else
                //me.sSTime = me.log[me.log.length - 1].t;
				me.sSTime = logdate;
            me.logId.push(name + "-s");
            me.log.push({
                //d: Ext.util.Format.date(date, 'G:i:s:u'),
                t: logdate,
				u: url
            });
			/*
            if (me.logNames.indexOf(name) < 0) {
                me.logNames.push(name);
            }
			if(name == 'Client Trans')
				me.cSTime = me.log[me.log.length-1].t;
			else
				me.sSTime = me.log[me.log.length-1].t;
			*/
        },
        end: function(name) {
            var me = this;
                //date = Date.now;
				
			if (name == 'Client Trans')
                me.setCTime();
            else
                me.setSTime();
            me.logId.push(name + "-e");
            me.log.push({
                //d: Ext.util.Format.date(date, 'G:i:s:u'),
                t: me.date()
            });
			/*
			if(name == 'Client Trans')
				me.setCTime();
			else
				me.setSTime();
			*/
        },
        clear: function() {
            var me = this;
            me.log = [];
            me.logId = [];
            me.logNames = [];
			me.clientTime = 0;
			me.serverTime = 0;
			me.cSTime = 0;
			me.sSTime = 0;
        },
		setCTime: function(){
			var me = this,
                //date = Date.now,
				diff = null,
                t = me.date();
			if(me.cSTime){
				diff = (t - me.cSTime);
				me.clientTime += diff;
				delete me.cSTime;
			}
		},
		setSTime: function(){
			var me = this,
                //date = Date.now,
				diff = null,
                t = me.date();
			if(me.sSTime){
				diff = (t - me.sSTime);
				me.serverTime += diff;
                //delete me.cSTime;
				delete me.sSTime;
			}
		},
        getCTime: function() {
            var me = this,
                //start = me.log[0],
                //end = me.log[me.log.length - 1],
                //diff,
                time;
            //diff = (end.t - start.t);
            //time = Math.round(diff / 1000);
			// return time;
            return me.clientTime/1000;
        },
		getSTime: function() {
            var me = this,
                //start = me.log[0],
                //end = me.log[me.log.length - 1],
                //diff,
                time;
            //diff = (end.t - start.t);
            //time = Math.round(diff / 1000);
            return me.serverTime/1000;
        },
		logTime: function(){
			var me = this;
			console.log(me.log);
			console.log(me.log);
			console.log(me.logId);
			console.log(me.logNames);
		},
        getTimeDetails: function() {

        }
    }
})();
RamcoLog = new RamcoLogger();

//Error Object
function RamcoErrors(errors) {
	this.errors = errors
}
(function() {
	RamcoErrors.prototype = {
		errors: [],
		errStatus: 0,
		getErrorId: function() {
			if (this.errors.length > 0)
				return this.errors[0].cd;
			else
				return ""; 
		},
		setErrorId: function(value) {
			if (this.errors.length > 0)
				this.errors[0].cd = value;
		},
		getMessageDesc: function() {
			if (this.errors.length > 0)
				return this.errors[0].ds;
			else
				return "";			
		},
		getErrorStatus: function() {
			if (this.errors.length > 0) {
				if(this.errors[0].sv != "6")
					this.errStatus = -1;				
			}
			return this.errstatus;
		},
		setErrorStatus: function(status) {
			if (this.errors.length > 0) {
				this.errors[0].sv = status;
			}
		},		
		getErrors: function() {
			return this.errors;
		}
	}
}
)();

function RamcoUtil() {};

(function() {
    RamcoUtil.prototype = {
        isEmpty: function(value, allowEmptyString) {
            return (value == null) || (!allowEmptyString ? value === '' : false) || (this.isArray(value) && value.length === 0);
        },
        isArray: ('isArray' in Array) ? Array.isArray : function(value) {
            return Object.prototype.toString.call(value) === '[object Array]';
        },
        isDate: function(value) {
            return Object.prototype.toString.call(value) === '[object Date]';
        },
        isObject: (Object.prototype.toString.call(null) === '[object Object]') ? function(value) {
            // check ownerDocument here as well to exclude DOM nodes
            return value !== null && value !== undefined && Object.prototype.toString.call(value) === '[object Object]' && value.ownerDocument === undefined;
        } : function(value) {
            return Object.prototype.toString.call(value) === '[object Object]';
        },
        isBoolean: function(value) {
            return typeof value === 'boolean';
        },
		isString: function (value) {
            return typeof value === 'string';
        }
    }
})()
Ramcoutil = new RamcoUtil();


function getCreateURL(url, params) {
    if (params) {
        if (params['_dc'])
            return url + '?' + getQueryString(params);
        else
            return url + '?' + getQueryString(params) + '&_dc=' + (Date.now());
    } else
        return url + '?_dc=' + (Date.now());
};

function getQueryString(object, recursive) {
    var paramObjects = [],
        params = [],
        i, j, ln, paramObject, value;

    for (i in object) {
        if (object.hasOwnProperty(i)) {
            paramObjects = paramObjects.concat(getQueryStrings(i, object[i], recursive));
        }
    }

    for (j = 0, ln = paramObjects.length; j < ln; j++) {
        paramObject = paramObjects[j];
        value = paramObject.value;

        if (Ramcoutil.isEmpty(value)) {
            value = '';
        } else if (Ramcoutil.isDate(value)) {
            value = dateToString(value);
        }

        params.push(encodeURIComponent(paramObject.name) + '=' + encodeURIComponent(String(value)));
    }

    return params.join('&');
};

function getQueryStrings(name, value, recursive) {
    var self = getQueryStrings,
        objects = [],
        i, ln;

    if (Ramcoutil.isArray(value)) {
        for (i = 0, ln = value.length; i < ln; i++) {
            if (recursive) {
                objects = objects.concat(self(name + '[' + i + ']', value[i], true));
            } else {
                objects.push({
                    name: name,
                    value: value[i]
                });
            }
        }
    } else if (Ramcoutil.isObject(value)) {
        for (i in value) {
            if (value.hasOwnProperty(i)) {
                if (recursive) {
                    objects = objects.concat(self(name + '[' + i + ']', value[i], true));
                } else {
                    objects.push({
                        name: name,
                        value: value[i]
                    });
                }
            }
        }
    } else {
        objects.push({
            name: name,
            value: value
        });
    }

    return objects;
}

function dateToString(date) {
    if (!date) {
        date = new Date();
    }
    return date.getFullYear() + "-" +
        pad(date.getMonth() + 1, 2, '0') + "-" +
        pad(date.getDate(), 2, '0') + "T" +
        pad(date.getHours(), 2, '0') + ":" +
        pad(date.getMinutes(), 2, '0') + ":" +
        pad(date.getSeconds(), 2, '0');
}

//==============================================================================
	// ** RTP ** //
//==============================================================================

var BYTES_PER_CHUNK = 1024 * 1024,
    requestTimeout = 60000,
	// TECH-37042
    // hasRTS = true,
    // osVersion = '2.0',
    // uiFilePath = 'app',
    // uiResourcePath = '',
    // osType = 'DNA',
    // isMobile = false,
	hasRTS = (hasRTS) ? hasRTS : true,
    osVersion = (osVersion) ? osVersion : '2.0',
    uiFilePath = (uiFilePath) ? uiFilePath : 'app',
    uiResourcePath = (uiResourcePath) ? uiResourcePath : '',
    osType = (osType) ? osType : 'DNA',
    isMobile = (isMobile) ? isMobile : false,
    RamcoRTC = new RTC(hasRTS, osVersion, osType, isMobile),
    title = document.title;
var rvw_resources = {
    'R001': 'is not a valid it must be in the format',
    'R002': 'The value in this field is invalid.',
    'R003': 'The minimum length for this field is',
    'R004': 'The maximum length for this field is',
    'R005': 'The minimum value for this field is',
    'R006': 'The maximum value for this field is',
    'R007': 'All',
    'R008': 'Row Number',
    'R009': 'Selection',
    'R010': '[No records to display]',
    'R011': 'Move to first row',
    'R012': 'Move to last row',
    'R013': 'Previous row set',
    'R014': 'Next row set',
    'R015': 'No Record found.',
    'R016': 'Insert new row',
    'R017': 'Delete pressed row(s)',
    'R018': 'Copy and append pressed row(s)',
    'R019': 'Cut and append pressed row(s)',
    'R020': 'Show PDF',
    'R021': 'Show Report',
    'R022': 'Show HTML',
    'R023': 'Export to excel',
    'R024': 'Export to CSV',
    'R025': 'Export to Text',
    'R026': 'Import data',
    'R027': 'Show Chart',
    'R028': 'Save Personalize',
    'R029': 'Remove Personalize',
    'R030': 'Columns',
    'R031': 'Sort Ascending',
    'R032': 'Sort Descending',
    'R033': 'Found no rows to display!!!',
    'R034': 'Lock',
    'R035': 'Unlock',
    'R036': 'Search did not find any matching records',
    'R037': 'Task Confirmation',
    'R038': 'This process may take long time to complete do you want to proceed?',
    'R039': 'Server exception while exporting data from adobe air',
    'R040': 'Error occured while processing your request',
    'R041': 'Group By This Field',
    'R042': 'Show in Groups',
    'R043': 'Validation',
    'R044': 'Screen validation failed! Check for marked controls.',
    'R045': 'User pre-process returned false',
    'R046': 'Event completed successfully.',
    'R047': 'Select a file',
    'R048': 'Validate',
    'R049': 'Uploading and validating...',
    'R050': 'Import',
    'R051': 'Importing data....',
    'R052': 'Status',
    'R053': 'Refresh Chart',
    'R054': 'Caption',
    'R055': 'Sub Caption',
    'R056': 'Chart Type',
    'R057': 'File Type Not Supported',
    'R058': 'Image Size Exceeds the max allowed size',
    'R059': 'Browse...',
    'R060': 'Attach Objects',
    'R061': 'Attach',
    'R062': 'File(s)',
    'R063': 'Please select a file before submit',
    'R064': 'Files with the extension',
    'R065': 'is not allowed for upload',
    'R066': 'Close',
    'R067': 'Delete File',
    'R068': 'After Export. Your have to relaunch your Application. shall I proceed.',
    'R069': 'Add to Favorites',
    'R070': 'Favourites',
    'R071': 'Change Password',
    'R072': 'User Preferences',
    'R073': 'Switch Contexts',
    'R074': 'Setup Favourites',
    'R075': 'About',
    'R076': 'Signout',
    'R077': 'Themes',
    'R078': 'Change Theme',
    'R079': 'Quick Links',
    'R080': 'Trailbar',
    'R081': 'Goto HomePage',
    'R082': 'Print Screen',
    'R083': 'Refresh Screen Data',
    'R084': 'Go Back',
    'R085': 'Launch UDS',
    'R086': 'Show Help',
    'R087': 'Page Error(s)',
    'R088': 'Error(s)',
    'R089': 'Access Keys',
    'R090': 'Re-Activate Session',
    'R091': 'Ready',
    'R092': 'Request completed',
    'R093': 'Please Wait ',
    'R094': 'Home',
    'R095': 'Authentication',
    'R096': 'Username',
    'R097': 'Password',
    'R098': 'Signin',
    'R099': 'Clear',
    'R100': 'Forgot Password',
    'R101': 'This field is mandatory',
    'R102': 'Ok',
    'R103': 'Cancel',
    'R104': 'Yes',
    'R105': 'No',
    'R106': 'Minute(s)',
    'R107': 'User session is in-active',
    'R108': 'please {0} click here {1} to re-login',
    'R109': 'Message',
    'R110': 'Callup support engineer',
    'R111': 'Security Launch',
    'R112': 'Processing toolbar event',
    'R113': 'Toolbar Event',
    'R114': 'Completed',
    'R115': 'The resource you are looking for (or one of its dependencies) could have been removed is temporarily unavailable or scripting error',
    'R116': 'Expand / Collapse',
    'R117': 'Error Id',
    'R118': 'Severity',
    'R119': 'Source',
    'R120': 'Description',
    'R121': 'Corrective Action',
    'R122': 'record(s)',
    'R123': 'Default',
    'R124': 'Stop',
    'R125': 'Critical',
    'R126': 'Error',
    'R127': 'Continue',
    'R128': 'Application',
    'R129': 'System',
    'R130': 'System Error',
    'R131': 'Authentication executed successfully',
    'R132': 'Force Login',
    'R133': 'Security',
    'R134': 'Click to Home',
    'R135': 'Click to Back',
    'R136': 'Click to Refresh',
    'R137': 'Click to Show/Hide',
    'R138': 'Delete',
    'R139': 'Edit',
    'R140': 'Move to first row[Home]',
    'R141': 'Previous row set [Page Up]',
    'R142': 'No Rows to Display',
    'R143': 'Next row set [Page Down]',
    'R144': 'Move to last row[End]',
    'R145': 'Insert new row[Shift + Insert]',
    'R146': 'Delete selected row(s)[Shift + Delete]',
    'R147': 'Cut and append selected row(s)[Ctrl + X/F8]',
    'R148': 'Copy and append selected row(s)[Ctrl + Y/F7]',
    'R149': 'Import Data[Shift + I]',
    'R150': 'Import from Office',
    'R151': 'Export to Excel[Shift + E]',
    'R152': 'Show  Office',
    'R153': 'Show  Pdf [Shift + P]',
    'R154': 'Show  HTML [Shift + H]',
    'R155': 'Show Csv [Shift + V]', // TECH-30180
    'R156': 'Show  Report',
    'R157': 'Save Personalization',
    'R158': 'Remove Personalization',
    'R159': 'Column Chooser',
    'R160': 'Excel',
    'R161': 'Open Office',
    'R162': 'To Excel',
    'R163': 'To Open Office',
    'R164': 'To PDF',
    'R165': 'To HTML',
    'R166': 'To CSV',
    'R167': 'Expand All',
    'R168': 'Collapse All',
    'R169': 'Expand This Node',
    'R170': 'Search',
    'R171': 'Search Options',
    'R172': 'Filter',
    'R173': 'Preference',
    'R174': 'Recent Activities',
    'R175': 'Launch Favorites',
    'R176': 'Launch Inbox',
    'R177': 'Launch DW',
    'R178': 'Launch Menu Tags',
    'R179': 'Default Window',
    'R180': 'Go Home',
    'R181': 'Select Component',
    'R182': 'Select Module',
    'R183': 'Save',
    'R184': 'UDS Menu',
    'R185': 'Template',
    'R186': 'Refresh screen data',
    'R187': 'Show Help',
    'R188': 'Defaults Mode',
    'R189': 'Reactivate Timer',
    'R190': 'Apply',
    'R191': 'Save Preference',
    'R192': 'Group Name',
    'R193': 'Add to Group',
    'R194': 'Update',
    'R195': 'new',
    'R196': 'Search - Filter',
    'R197': 'New Work Area',
    'R198': 'Wizard',
    'R199': 'News',
    'R200': 'Create',
    'R201': 'Launch Preference',
    'R202': 'Select a Preference',
    'R203': 'Select Wizard',
    'R204': 'Select Theme',
    'R205': 'Initialize Screen',
    'R206': 'Get Screen data',
    'R207': 'Wizard Task',
    'R208': 'Trans Screen',
    'R209': 'On Help Screen',
    'R210': 'On Data Transfer',
    'R211': 'No error(s)',
    'R212': 'List Edit Data',
    'R213': 'File Upload',
    'R214': 'File Delete',
    'R215': 'Grid Search',
    'R216': 'On Cancel',
    'R217': 'Launching Screen',
    'R218': 'Current page has not been saved. Would you like to proceed?',
    'R219': 'This application has an update. Reload?',
    'R220': 'Please Enter a New Template ID',
    'R221': 'Before User post-process returned false',
    'R222': 'Error In Page Config',
    'R223': 'Fail to Load Screen. ',
    'R224': 'Specified WorkArea already exists. Please provide new.',
    'R225': 'Invalid Instance Name',
    'R226': 'Fail to Load.',
    'R227': 'invalid group name',
    'R228': 'After User post-process returned false',
    'R229': 'Users should change their password on first logon.',
    'R230': 'Please Enter a Error Message',
    'R231': 'Cannot create ramco server communication(RTS).',
    'R232': 'Error.',
    'R233': 'Server Down.',
    'R234': 'Error setting image',
    'R235': 'Error setting badge',
    'R236': 'Too many badges requests in queue.',
    'R237': 'Error setting video',
    'R238': 'Error setting webcam. ',
    'R239': 'Error in loading CSS. \n [ reson ',
    'R240': 'Error in loading script. \n [ reson ',
    'R241': 'Error in callout script.',
    'R242': 'Screen Initialization',
    'R243': 'Session Expired; Please relogin',
    'R244': 'Same session cannot be opened in multiple windows. Close this window and proceed in original window.',
    'R245': 'Default Columns(s)',
    'R246': 'Clear Defaults',
    'R247': 'Column Defaulting',
    'R248': 'Apply Default(s)',
    'R249': 'Update Only Blanks',
    'R250': 'Update Existing Data',
    'R251': 'Update Existing Rows',
    'R252': 'Are you sure to delete file {0} ? ', // TECH-28698 / KNB-184
    'R253': 'Delete Confirmation',
    'R254': 'Selected record(s) will be deleted permanently. You like to continue ?',
    'R255': 'Select Group Order',
    'R256': 'Search has reached the End Record, Do you like to continue to search from start?',
    'R257': 'Current page has not been saved, would you like to proceed?',
    'R258': 'Application User Preferences Saved',
    'R259': 'This process will discard your current screen, Do you want to proceed ?',
	'R260': 'Virtual Works™ Message',
	'R261': 'The attachment should not be of size [{0}] Kb !!',
	'R262': 'The attachment size should not exceed [{0}] MB !!',
	'R263': 'Activity Search',
	'R264': 'Insert Tree Node',
	'R265': 'Delete Tree Node',
	'R266': 'Export Excel',
	'R267': 'Import Excel',
	'R268': 'Copy Parent Node Only',
	'R269': 'Copy Child Node(s) Only',
	'R270': 'Copy Parent and Child Node(s)',
	'R271': 'Move Child Node(s) Only',
	'R272': 'Move Parent and Child Node(s)',
	'R273': 'Server',
	'R274': 'Client',
	'R275': 'At least one column should be checked from unlocked columns.',
	'R276': 'Blank Page',
	//'R277': 'Default Activity',
	'R277': 'Default Window', // AHBG-31967
	'R278': 'WIZARD',
	'R279': 'My Inbox',
	'R280': 'Wizard',
	'R281': 'Menu Map',
	'R282': 'Favorites',
	'R283': 'Menu Tag',
	'R284': 'Hydra',
	'R285': 'Aqua',
	'R286': 'Granite',
	'R287': 'Ascending',
	'R288': 'Descending',
	'R289': 'Select at least one row to delete',
	'R290': 'Smart Bar',
	'R291': 'Filter Data',
	'R292': 'Clear Filter Data',
	'R293': 'Browser Pop-ups are blocked. Please enable browser pop-up',
	'R294': 'Enter Search / Filter Text',
	'R295': 'Upload File',
	'R296': 'Dest.Sub Folder',
	'R297': 'Action if file Exists',
	'R298': 'Replace',
	'R299': 'Save As New',
	'R300': 'Warn & Abort',
	'R301': 'Max. File Size (KB)',
	'R302': 'Multi Sort',
	'R303': 'Clear Multi Sort',
	'R304': 'Expand Node',
	'R305': 'Collapse Node',
	'R306': 'Last Login Date and Time',
	'R307': 'File deleted successfully', // TECH-29531
	'R308': 'File uploaded successfully', // TECH-29531
	'R309': '',
	'R310': 'Not possible to generate pages more than 100 for printing',
	'R311': 'Not possible to generate image size more than 3MB for download',
	'R312': '{0} match{1} found.',
	'R313': 'No match found',
	'R314': 'You have reached Maximum limit for Workarea Creation',
	'R315': 'Your session will be timed out shortly. Click Cancel to Remain Active',
	'R316': 'Session TimeOut Alert',
	'R317': 'says:',
	'R318': 'News :',
	'R319': 'This process may take long time to complete, do you want to proceed?',//TECH-34198
	'R320': 'Default Theme', // AHBG-31967
	'R321': 'Theme Blue',
	'R322': 'Theme Green',
	'R323': 'Theme Grey',
	'R324': 'Artic Blue',
	'R325': 'Blue Jay',
	'R326': 'About VirtualWorks',
	'R327': 'Launch New Window', //TECH-39043
	'R328': 'Compact Menu', //TECH-40145
	'R329': 'Switch Context' //TECH-41247
};
Ext.BLANK_IMAGE_URL = 'data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';

// TECH-33892
Ext.HTMLTAGS = ["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","image","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","nav","nobr","noframes","noscript","object","ol","optgroup","option","output","p","param","plaintext","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","spacer","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"];
Object.freeze(Ext.HTMLTAGS);

Ext.enableFx = false;
// TECH-28698 / KNB-184 / TECH-29013
Ext.NOIMAGE = 'data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';
Ext.FILEBLANKIMAGE = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAFAElEQVR4XrXTW4ydZRWA4Wd9/7/3zPSUmbapLdISGrREI0gVqngooBfSVlSIiUYjh1iIhphUvbESIDGUhKBcGY1BgSgIRjwABWMwsSZqQ0nLodG2FkGnh1Gg587M3nv290mauZqkcyj4Jn/yZV29ef+1AvU1m574zViOtd2c/b+oUlKnsvnRjes+jTGAGn2dHGt//u012l0UhLeOgqBZ8fk7nlyLPhwHqNHbzdksbN1PI0jhLSMXOoUrljFeuHeiQJQC9CQeeGFII0EoAgCEgmImdDLXXrAYlMLEvjUA1BV14tyzFutiDF1AhbpQIUyNAF46MKSuTOB0AokipERk1pcbzbcNHHKx++JHoDI1EUQAdZquQFBKkLihtd5A2Yl+MN+LrvdlP+m7V1UIU5MSpVDHjAqQKgbaW4n5qABN8/NWaQ5VJgEEApi4IinNsEAKoFGh0yUy0QVKJmeNRI0EgUQ5+C1az7P0SVEhE4wXmPyqkokFCj2JI+kSOsN0OuPf8KlZM3FKItGoKQdukY8+JrcGlX9dpWZ8malnUiCjSlD0Br9dcr9P7btW//BWcGTWB07NeoMqEYmoOXHoYVH1U5IyskdPe4961jsppKCgSuTpLiFFT6ITPHbOA7oBVIW6kAqpIlUcfuUenW6vEChKbhp97SHzz7tdGRsXMM0lDKRAoZGITKNQChCIQCJVDO74rPaJHVI1h5IRlMqxoYe0TvzN0ot+IWXjJYhpn6FxAZRiIiKoKo6//idVc6GUQ4mCIgo5N7Re26JZYaYFqoqCOuE0AoIq0dUnd0ZFI/QeT2B0blY6o4o+dSBRUFVTFxg3pUgaFRGnEUDC+6/Y7bm/rHViZLdlz/aCXZeOmtO3wnsv3SwFVVCk8bKTCBQEUkLM1mxQ5dMLRNDT6LF6zdOq2Tz/9Dngqi8N6p4kj1EKVYWYLSUCZcodqJnzytn+PnCRPImAIAQpSX29OiM12PniJ+WRUSVnORWlojn4nNQ8BEwlUAWR5mq3eigJxaREILSPJZBGQmk1ZUXd7rp8ywEfyf3axzvMbSCmvgKRtFpjlGRadLrilvNA60RbLkUnilU7jjrro+t0c8v+n15nwVcfFKmaXCBQZCMnR0QkiqkJBABjERYdHnN2vUD/qrWUroMvbDQ8uEOpmlMLtDonHD56UEQyfQJItTrVVu4Jy7+wnuPbKcWKddfZfd/16t57TnMFBciFH9x8SDhz9j31Q1buUr99oWtu3g4e/f7HLXzPah/budnjkxWAsYwwY1Iw/NqQA3+91yVfu5OXviNcCOy92+LVt1m95w4bPrF0yT2/G3wVBWqIAOoghzMi4Z+PbPCOq27iv7+m+7pWpwun3oZ+ZfmVN/jM0e89+IbASrShhjolAMmZ8eozj2jWxcDbTrL/WXrnOXasAzTncWybeUvPt+j8i9/91Dd9/cq7d9yFHFh09aYn9ra7Mbebs1JMm4KuWsHt7dt8+Cs38Z/70aCB3gyMJjrQYcmNnvnxvVbdumU2hgP9OBcDCDOn/uWGD9512ZoPXbBg2V46bSTq7HPfvQw8/I0/MpaQafYY+ve77PrD7x+//M5tVwcamI2mM2Perk0X/mPFF5cTNTkIpEKVgW4iBwWpULLtPxvyvo1/nlejgyPOnDIy1nwj60E5owQQRQCKCfMUUhXQE948A8Z/oZlxGC/X3jwn8TL2mRkdnPwffPbw/NGUUiAAAAAASUVORK5CYII=';
//Ext.Date.formatCodes['g'] = "((m.getHours() > 12) ? (m.getHours()-12) : m.getHours())"; // TECH-40320
Ext.Ajax.timeout = 600000;
Ext.tip.QuickTipManager.init();
Ext.USE_NATIVE_JSON = false;
Ext.apply(Ext.tip.QuickTipManager.getQuickTip(), {
    maxWidth: 200,
    minWidth: 100,
    showDelay: 50 // Show 50ms after entering target
});

// ILBO Controller
Ext.define('Ext.ramco.IlboController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.ilbo',
    taskPending: false,
    errors: new Ext.util.MixedCollection(),
    config: {
        control: {
            'button[role=uipage]': {
                click: 'onClick',
                change: 'onAttach',
				ctrlfocus: 'onCtrlFocus',
                mousedown: 'onButtonContextClick'
            },
			//TECH-34101
			'button[role=multiupload]': {
                change: 'onGetMultiFiles',
				click: 'onMultifileUpload'
            },			
			'button[role=oprotoui]': {
				click: 'onOProtoBtnClick',
			},
            'splitbutton[role=wizard]': {
                click: 'onMsgGoButtonClick'
            },
			'ramcosplitbutton[role=uipage]': {
                click: 'onSplitMenuItemClick'
            },
            'textfield[role=wizard]': {
                specialkey: 'onMsgGoButtonClick'
            },
            'button[role=pers]': {
                click: 'onPersonalization',
				mouseover:'onPersMouseover',//TECH-37397 /KNB-298
				mouseout:'onPersMouseout'
            },
            'button[role=securitypage]': {
                click: 'onSecurityButtonClick'
            },
            'checkbox[role=template]': {
                change: 'onTemplatePersonalization'
            },
            'button[role=wizard]': {
                click: 'onWizardButtonClick'
            },
            'menuitem[role=uipage]': {
                click: 'onMenuItemClick'
            },
            'combofield[role=uipage]': {
                select: 'onSelect',
				blur: 'onBlur'
            },
			'ramcoorgchart[role=uipage]': {
                orgnodeselect: 'onOrgNodeSelect'
            },			
			'datefield[role=uipage]': {
                select: 'onSelect'
            },
            'ramcocombolink[role=uipage]': {
                select: 'onLinkSelect'
            },
            'segmentedbutton[role=uipage]': {
                change: 'onChange'
            },
            'ramcoradio': {
                change: 'onChange'
            },
            'tagcloud': {
                tagselect: 'onTagSelect',
                contextmenu: 'onTagContextClick'
            },
            'ramcomap': {
                refreshmap: 'onRefreshMap',
                mapclick: 'onMapClick',
                markerclick: 'onMarkerClick',
				circleMapClick: 'onCircleMapClick'				
            },
			'slidercontainer[role=uipage]': {
				change: 'onChange'
			},
			'ramcorating[role=uipage]': {
				change: 'onChange'
			},
			'ramcohtmleditor[role=uipage]': {
				change: 'onChange'
			},
			'ramcodivhtmleditor[role=uipage]': {
				change: 'onChange'
			},
			'ramcodivckhtmleditor[role=uipage]': {
				change: 'onChange'
			},
            'field[role=uipage]': {
                change: 'onChange',
                specialkey: 'onSpecialKey',
				lstedtspecialkey: 'onLstEdtSpecialKey',
				mouseclick: 'onMouseClick',
                help: 'onHelp',
                search: 'onSearch',
                uploadfile: 'onUploadFile',
                deletefile: 'onDeleteFile',
				avncustomaction: 'onAvnCustomAction',
                validitychange: 'updateErrorState',
                ctrlfocus: 'onCtrlFocus',
				focusenter:'onFocusEnter',
				blur:'onFocusLeave',
				timeblur:'onTimeBlur'
            },
            'ramcoimageattach': {
                uploadfile: 'onUploadFile',
                deletefile: 'onDeleteFile'
            },
            'ramcolistedit[role=uipage]': {
                listdata: 'onGetListData',
				customlistdata: 'onGetCustomListData',				
				getCustLstPagedata: 'onGetCustLstPageData',
				//focusleave: 'onChangeListData',
                select: 'onSetListData'
				//blur: 'onBlur'
            },
			'field[role=gridrole]': {
				validitychange: 'updateErrorState',
				lstedtspecialkey: 'onLstEdtSpecialKey'
			},
			'ramcolistedit[role=gridrole]': {
                listdata: 'onGetListData'
            },
            'ramcolabel[role=uipage]': {
                uiclick: 'onUIClick',
                linkclick: 'onLinkClick',
                contextmenu: 'onLabelContextClick'
            },
            'ramcotreegrid[role=uipage]': {
                uiclick: 'onGridUIClick'
            },
            'ramcogridcolumn': {
                //resize: 'onGridColumnResize',
                //columnmove: 'onGridColumnMove',
                ctrlfocus: 'onCtrlFocus',
                focus: 'onCtrlFocus'
            },
			'ramcotreecolumn': {
				ctrlfocus: 'onCtrlFocus',
                focus: 'onCtrlFocus',
				itemexpand: 'onRSTreeNodeExpand'
			},
            'ramcopivot[role=uipage]': {
				configchange:'onPivotConfigChange',
				showdrilldownpanel:'onShowdrilldownpanel'
			},
			'ramcoddtgrid': {
                movetorow: 'onGridMoveTo',
				linkclick: 'onGridLinkClick',
				uiclick: 'onGridUIClick'
            },
			'ramcorstreegrid[role=uipage]': {
				movetorow: 'onGridMoveTo',
				deleterow: 'onRSTreeNodeDeleteRow',
				sort: 'onGridSort',
				exportexcel: 'onshowExcel',                
                importexcel: 'onImportExcel',
				//itemexpand: 'onRSTreeNodeExpand',
				gridsearch: 'onGridSearch',
				selectall: 'onGridSelectAll',
				uiclick: 'onGridUIClick',
				mlTreeExpand: 'onMlTreeExpand',
				help: 'onGridHelp' //TECH-41092
			},
			'ramcoexpgrid[role=uipage]': {
				cutappend: 'onCutAppendRow',
                copyappend: 'onCopyAppendRow',
                columndefault: 'onColumnDefault',
                columncleardefault: 'onColumnClearDefault',
				columnfilter: 'onColumnFilter',
                columnclearfilter: 'onColumnClearFilter',
				mlExpand: 'onMlExpand',
                exportpdf: 'onshowPDF',
                exportcsv: 'onshowCSV',
                exportreport: 'onshowReport',
                exportchart: 'onshowChart',
                exportexcel: 'onshowExcel',
                exporthtml: 'onViewall',
                importexcel: 'onImportExcel',
				importcsv:'onImportCsv',
				validatefile: 'onValidateFile',
                savepers: 'onSavePers',
                removepers: 'onRemovePers',
                colchoose: 'onColumnChoose',				
                colpers: 'onColumnSave',
                gridsearch: 'onGridSearch',
				uiclick: 'onGridUIClick',
				sort: 'onGridSort'
			},
            'ramcogrid[role=uipage]': {
                movetorow: 'onGridMoveTo',
                help: 'onGridHelp',
                //cellclick: 'onGridCellClick',
                //edit: 'onEditComplete',
                beforeedit: 'onBeforeEdit',
                uiclick: 'onGridUIClick',
                linkclick: 'onGridLinkClick',
                rnclick: 'onShowGridZoom',
                dblclick: 'onDblClick',
                ui: 'onGridUi',
                sort: 'onGridSort',
                cmbselect: 'onGridSelect',
                enter: 'onGridEnter',
				focusenter:'onGridColumnFocusEnter',
				focusleave:'onGridColumnFocusLeave',
                selectall: 'onGridSelectAll',
                insert: 'onInsertRow',
                deleterow: 'onDeleteRow',
                cutappend: 'onCutAppendRow',
                copyappend: 'onCopyAppendRow',
                columndefault: 'onColumnDefault',
                columncleardefault: 'onColumnClearDefault',
				columnfilter: 'onColumnFilter',
                columnclearfilter: 'onColumnClearFilter',
				mlExpand: 'onMlExpand',
                exportpdf: 'onshowPDF',
                exportcsv: 'onshowCSV',
                exportreport: 'onshowReport',
                exportchart: 'onshowChart',
                exportexcel: 'onshowExcel',
                exporthtml: 'onViewall',
                importexcel: 'onImportExcel',
				importcsv:'onImportCsv',
				validatefile: 'onValidateFile',
                savepers: 'onSavePers',
                removepers: 'onRemovePers',
                colchoose: 'onColumnChoose',
				//multisort: 'onMultiSort',
                //clearmultisort: 'onClearMultiSort',
                colpers: 'onColumnSave',
                gridsearch: 'onGridSearch',
                uploadfile: 'onUploadFile',
                deletefile: 'onDeleteFile',
                attach: 'onAttach',
                listdata: 'onGetListData',
				customlistdata: 'onGetCustomListData',
				customlistselect: 'onSetCustomListGridData',
                listselect: 'onSetListGridData',
                lockcolumn: 'onGridLock',
                unlockcolumn: 'onGridUnLock',
				getCustLstPagedata: 'onGetCustLstPageData',
                itemkeydown: 'onGridKeyNavDown',
				ctrlfocus: 'onCtrlFocus'
            },
            'horizontalview[role=uipage]': {
                uiclick: 'onGridUIClick',
                movetorow: 'onGridMoveTo',
				linkclick: 'onGridLinkClick'
            },
			'verticalview[role=uipage]': {
                uiclick: 'onGridUIClick',
                movetorow: 'onGridMoveTo'
            },
            'ramcodataview[role=uipage]': {
                uiclick: 'onGridUIClick'
            },
			'ramcod3cloud[role=uipage]': {
                uiclick: 'onGridUIClick'
            },
            'ramcotagcloud[role=uipage]': {
                uiclick: 'onGridUIClick'
            },
			'ramcorstreepanel[role=uipage]': {
                itemexpand: 'onTreeNodeExpand',
                itemcollapse: 'onTreeNodeCollapse',
                itemclick: 'onTreeNodeClick',
                itemkeyup: 'onTreeNodeClick',
                checkchange: 'onTreeNodeCheck',
                treeexpand: 'onExpandAll',
                treesearch: 'onTreeSearch',
				treefilter: 'onTreeFilter'				
            },
            'ramcotreepanel[role=uipage]': {
                itemexpand: 'onTreeNodeExpand',
                itemcollapse: 'onTreeNodeCollapse',
                itemclick: 'onTreeNodeClick',
                itemkeyup: 'onTreeNodeClick',
                checkchange: 'onTreeNodeCheck',
                treeexpand: 'onExpandAll',
                treesearch: 'onTreeSearch',
				treefilter: 'onTreeFilter'				
            },
            'tabpanel': {
                tabchange: 'onUITabItemChange'
            },
            'ramcochart[role=uipage]': {
                chartdata: 'onSetChartDataVal'
            },
            'ramcopanel[role=uipage]': {
                collapse: 'onPanelCollapse',
                expand: 'onPanelExpand'
            }
        }
    },
	onPwdFocus: function(ctrl) {		
		ctrl.setReadOnly(false);
		return;
	},    
    callInit: function(view) {
        var me = this,
            ilboConfig = view.ilboConfig
			src=null;
        if (me.errors && me.errors.length > 0) {
            me.errors.removeAll();
        }
        view.tempId = ilboConfig.activityName + "_" + ilboConfig.ilboName;
        if (view.customStyles) {
            view.cssId = view.tempId + '_css';
			src = uiFilePath + ilboConfig.componentName + '/' + view.tempId + ".css?_dc=" + RamcoRTC.getCacheId();
			//if(view.hasCssFile || RamcoRTC.osType == 'JAVA') { // TECH-37274
			if(view.hasCssFile) { // TECH-40632
	            if(Ext.isEmpty(view.cssText))
					me.loadCustomStyle(src, view.cssId);
				else {
					me.onLoadCssText(view.cssText,src,view.cssId);
					view.cssText =null;
					delete view.cssText;
				}
	        }
			else{
				me.onLoadCssFail("File not deployed.")
			}
        }
        else if (view.requiredScripts && view.requiredScripts.length > 0) {
            me.requiredScripts = view.requiredScripts;
            me.loadReqScript();
        } else if (view.callout) {
            view.callOutId = view.tempId + '_callout';
            me.loadCallOut(uiFilePath + ilboConfig.componentName + '/' + view.tempId + "_callout.js?_dc=" + RamcoRTC.getCacheId(), view.callOutId);
        } else {
            view.setIsInit(true);
        }
    },
	loadCustomStyle: function(src, id) {
        var me = this;
		RamcoLog.end('Client Trans');
		RamcoLog.start('Server Trans', src);
        Ext.Ajax.request({
			timeout: 600000,
            url: src,
            disableCaching: false
		}).then(function(response){
			me.onLoadCssSucess(response, src,id);
		},function(response){
			me.onLoadCssFail(response);
		});
    },
    onLoadCssSucess: function(response, src,id) {
		//response.target.media ="all";
        var me =this;
		    view = me.getView(),
			href = window.location.href,
			url = href?href.split("/"):[],
			len = url.length,
            ilboConfig = view ? view.ilboConfig : {},
			head = document.head || document.getElementsByTagName('head')[0],
			el = document.createElement('style'),
			cssText = response.responseText || "";
			cssText = cssText.split("../../../").join('');
		if(len > 0)
			url[len-1] = src;
		src = url.join("/");
		cssText+= "\n/*# sourceURL=" + src + " */";
		//Ext.util.CSS.createStyleSheet(cssText,id);
		el.type = "text/css";
		el.id = id;
		ieMode = ('styleSheet' in el);
		if(ieMode) {
			head.appendChild(el);
			el.styleSheet.cssText = cssText;
        } else {
			el.textContent = cssText;
			head.appendChild(el);
        }
		RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','css');    
        if (view.requiredScripts && view.requiredScripts.length > 0) {
            me.requiredScripts = view.requiredScripts;
            me.loadReqScript();
        } else if (view.callout) {
            view.callOutId = view.tempId + '_callout';
            me.loadCallOut(uiFilePath + ilboConfig.componentName + '/' + view.tempId + "_callout.js?_dc=" + RamcoRTC.getCacheId(), view.callOutId);
        } else {
			view.setIsInit(true);
        }
    },
    onLoadCssFail: function(error) {
        console.log('Error in Custom Css. \n [ reson : ' + error + ']');
		RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','cssfail');    
        var me = this,
            view = me.getView(),
            ilboConfig = view ? view.ilboConfig : {};
        if(view.requiredScripts && view.requiredScripts.length > 0) {
			me.requiredScripts = view.requiredScripts;
			me.loadReqScript();
		} else if (view.callout) {
			view.callOutId = view.tempId + '_callout';
			me.loadCallOut(uiFilePath + ilboConfig.componentName + '/' + view.tempId + "_callout.js?_dc=" + RamcoRTC.getCacheId(), view.callOutId);
		} else {
			view.setIsInit(true);
        }
    },
	onLoadCssText: function(cssText,src,id) {
		//response.target.media ="all";
        var me =this;
            view = me.getView(),
			href = window.location.href,
			url = href?href.split("/"):[],
			len = url.length,
            ilboConfig = view ? view.ilboConfig : {},
			head = document.head || document.getElementsByTagName('head')[0],
			el = document.createElement('style');
			cssText = cssText.split("../../../").join('');
		if(len > 0)
			url[len-1] = src;
		src = url.join("/");
		cssText+= "\n/*# sourceURL=" + src + " */";
		el.type = "text/css";
		el.id = id;
		ieMode = ('styleSheet' in el);
		if(ieMode) {
			head.appendChild(el);
			el.styleSheet.cssText = cssText;
		} else {
			el.textContent = cssText;
			head.appendChild(el);
		}
		RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','css');    
		if(view.requiredScripts && view.requiredScripts.length > 0) {
			me.requiredScripts = view.requiredScripts;
			me.loadReqScript();
		} else if (view.callout) {
			view.callOutId = view.tempId + '_callout';
			me.loadCallOut(uiFilePath + ilboConfig.componentName + '/' + view.tempId + "_callout.js?_dc=" + RamcoRTC.getCacheId(), view.callOutId);
		} else {
			view.setIsInit(true);
        }
    },
    loadReqScript: function() {
        var me = this,
            view = me.getView(),
            ilboConfig = view ? view.ilboConfig : {},
            len = me.requiredScripts.length,
            i = 0,
            item = me.requiredScripts.length > 0 ? me.requiredScripts[0] : null,
            src,
            id = null,
            oScript = null,
			head = document.getElementsByTagName("body")[0];
            //head = (document.getElementsByTagName("head")[0] || document.documentElement);
            if (item) {
                if (item.src) {
                    if (item.src.indexOf('http://') > -1) {
                        src = item.src;
                        if (window.location.protocol.indexOf('https') > -1) {
                            src = item.src.replace('http', 'https');
                        }
                    } else if (item.src.indexOf('./') == 0) {
                        src = item.src.replace('./', '');
                    } else {
                        src = uiFilePath + ilboConfig.componentName + '/' + item.src;
                    }
                }
                if (item.type.toLowerCase() == "text/javascript") {
                    if (item.src) {
                        id = view.tempId + me.requiredScripts.length + '_CstJs';
                        oScript = document.createElement("script");
                        oScript.type = item.type;
                        oScript.async = true;
                        oScript.defer = true;
                        oScript.id = id;
                        oScript.src = src;
                        oScript.onerror = me.onLoadReqScriptFail.bind(me);
                        oScript.onload = me.onLoadReqScriptSucess.bind(me);
                        head.appendChild(oScript);
                    }
                } else if (item.type.toLowerCase() == "text/css") {
                    id = view.tempId + me.requiredScripts.length + '_CstCss';
					RamcoLog.end('Client Trans');
					RamcoLog.start('Server Trans', src);
					Ext.Ajax.request({
						timeout: 600000,
						url: src,
						disableCaching: false
					}).then(function(response, opts){
						me.onLoadReqCssSucess(response, src,id);
					},function(response, opts){
						me.onLoadReqCssFail(response, src,id);
					});
                } else {
					RamcoLog.end('Client Trans');
					RamcoLog.start('Server Trans', src);
                    Ext.Ajax.request({
						timeout: 600000,
                        url: src,
					disableCaching: false
					}).then(function(response, opts){
						me.onLoadReqScriptSucess(response, item.type,id);
					},function(response, opts){
						me.onLoadReqScriptFail(response, item.type,id);
					});
				}
        }
		else {
        if (view.callout) {
            view.callOutId = view.tempId + '_callout';
            me.loadCallOut(uiFilePath + ilboConfig.componentName + '/' + view.tempId + "_callout.js?_dc=" + RamcoRTC.getCacheId(), view.callOutId);
        } else {
				view.setIsInit(true);
			}
		}
    },
	
	onLoadReqCssSucess: function(response,src,id) {
        RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','cssSucess');    
		
		var me =this,
            view = me.getView(),
			href = window.location.href,
			url = href?href.split("/"):[],
			len = url.length,
            ilboConfig = view ? view.ilboConfig : {},
			head = document.head || document.getElementsByTagName('head')[0],
			el = document.createElement('style'),
			cssText = response.responseText;
			//cssText = cssText.split("../../../").join('');
		
		if(len > 0)
			url[len-1] = src;
		
		src = url.join("/");
		cssText+= "\n/*# sourceURL=" + src + " */";
		el.type = "text/css";
		el.id = id;
		ieMode = ('styleSheet' in el);
		if(ieMode) {
			head.appendChild(el);
			el.styleSheet.cssText = cssText;
		} else {
			el.textContent = cssText;
			head.appendChild(el);
		}
        if (!view.reqScrId)
            view.reqScrId = [];
        view.reqScrId.push(id);
        if (me.requiredScripts.length > 0)
            me.requiredScripts.shift();
        else
            me.requiredScripts = [];
        me.loadReqScript();
    },
    onLoadReqCssFail: function(error) {
        RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','customcssFail');    
		
		var me = this;
        console.log(rvw_resources.R240 + error + ']');
        if (me.requiredScripts.length > 0)
            me.requiredScripts.shift();
        else
            me.requiredScripts = [];
        me.loadReqScript();
    },
    onLoadReqScriptSucess: function(response) {
        RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','customScript');    
		
		var me = this,
            view = me.getView(),
            id = view.tempId + me.requiredScripts.length + '_CstJs';
        if (!view.reqScrId)
            view.reqScrId = [];
        view.reqScrId.push(id);
        if (response && response.responseText) {
			var head = document.getElementsByTagName("body")[0],
				oScript = document.createElement("script");
            oScript.type = arguments[1];
            oScript.defer = true;
            oScript.text = response.responseText + "\n//# sourceURL=" + arguments[1].url;
            oScript.id = id;
            head.appendChild(oScript);
        }
        if (me.requiredScripts.length > 0)
            me.requiredScripts.shift();
        else
            me.requiredScripts = [];
        me.loadReqScript();
    },
    onLoadReqScriptFail: function(error) {
        RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','customScriptFail');    
		
		var me = this,
            view = me.getView();
        console.log(rvw_resources.R239 + '[' + error + ']');
        if (me.requiredScripts.length > 0)
            me.requiredScripts.shift();
        else
            me.requiredScripts = [];
        me.loadReqScript();
    },
    
	loadCallOut: function(src, id) {
		RamcoLog.end('Client Trans');
		RamcoLog.start('Server Trans', src);
        var me = this,
            oScript = document.createElement("script"),
            head = (document.getElementsByTagName("head")[0] || document.documentElement);
        oScript.language = "javascript";
        oScript.type = "text/javascript";
        oScript.defer = true;
        oScript.src = src;
        oScript.id = id;
        oScript.onerror = me.onLoadCallOutFail.bind(me);
        oScript.onload = me.onLoadCallOutSucess.bind(me);
        head.appendChild(oScript);
		/* var me = this;
		RamcoLog.end('Client Trans');
		RamcoLog.start('Server Trans', src);
        Ext.Ajax.request({
			timeout: 600000,
            url: src,
            disableCaching: false
		}).then(function(response){
			me.onLoadCallOutSucess(response, src,id);
		},function(response){
			me.onLoadCallOutFail(response, src);
		}); */
    },
    onLoadCallOutSucess: function(response,src,id) {
        RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','callSucess');    
		
		var me = this,
            view = me.getView();
			//head = document.getElementsByTagName("body")[0],
			// href = window.location.href,
			// url = href?href.split("/"):[],
			// len = url.length,
			// content;
			//oScript = document.createElement("script");
		// if(len > 0)
			// url[len-1] = src;
		// src = url.join("/");	
        //head.appendChild(oScript);
		//oScript.language = "javascript";
        //oScript.type = "text/javascript";
        //oScript.id = id;
        //oScript.defer = true;
        //oScript.text = response.responseText + "\n//# sourceURL="  + src;
		/* content = response.responseText + "\n//# sourceURL="  + src;
		Ext.globalEval(content); */
        
        if (view) {
            if (typeof window[view.callOutId] == "function")
                view.callout = window[view.callOutId] ? window[view.callOutId]() : null;
            else {
                view.callout = null;
                console.log(rvw_resources.R241);
            }
            view.setIsInit(true);
        }
    },
    onLoadCallOutFail: function(error) {
	   RamcoLog.end('Server Trans');
	   RamcoLog.start('Client Trans','calloutFail');    
	   var me = this,
           view = me.getView();
        console.log(rvw_resources.R241 + ' \n [ reson : ' + error + ']');
        view.callout = null;
		view.setIsInit(true);
    },
    
    getErrors: function() {
        return this.errors;
    },
    onLabelContextClick: function(ctrl, e, eOpts) {
        var me = this,
            view = me.getView(),
            menu = me.menu,
            context = view.ezValue;
        view.tmpConfig = {};
        if (context && view.tempId == "ezwizard_ezwizard") {
            view.tmpConfig.activityDesc = ctrl.config.value;
            view.tmpConfig.activityName = ctrl.config.activity;
            view.tmpConfig.componentName = ctrl.config.comp;
            view.tmpConfig.ilboName = ctrl.config.ilbo;
            view.tmpConfig.tabName = "";
            view.tmpConfig.ilboType = "";
            if (!menu)
                me.menu = menu = new Ext.menu.Menu({
                    items: context
                });
            e.preventDefault();
            menu.showAt(e.getXY());
        }
    },
    getTaskData: function(view, index) {
        var me = this,
            data = [],
            task = (index <= 1) ? 'tskstdgettaskdata' : 'tskstdscreeninit';
		if (RamcoRTC.osType == 'JAVA' && task == 'tskstdgettaskdata')
			task = 'tskstdgetdata';				
        if (task != 'tskstdgettaskdata' && task != 'tskstdgetdata')
            view.fireEvent('getdata', view, data, task);
    },
    onButtonContextClick: function(ctrl, e, eOpts) {
        var me = this,
            view = me.getView(),
            menu = me.menu,
            context = view.ezValue;
        view.tmpConfig = {};
        if (context && view.tempId == "ezwizard_ezwizard") {
            view.tmpConfig.activityDesc = ctrl.config.value;
            view.tmpConfig.activityName = ctrl.config.activity;
            view.tmpConfig.componentName = ctrl.config.comp;
            view.tmpConfig.ilboName = ctrl.config.ilbo;
            view.tmpConfig.tabName = "";
            view.tmpConfig.ilboType = "";
            if (!menu)
                me.menu = menu = new Ext.menu.Menu({
                    items: context
                });
            e.preventDefault();
            menu.showAt(e.getXY());
        }
    },
    onSecurityButtonClick: function(btn, e) {
        var me = this,
            view = me.getView();
        view.fireEvent('securitybuttonclick', view, '', '', '');
    },
	getFavorites: function () {
		var me = this,
			view = me.getView();
			view.fireEvent('getfavorites');
	},	
    onMsgGoButtonClick: function(btn, e) {
        try {
            var me = this,
                view = me.getView(),
                viewModel = me.getViewModel(),
                task = null,
                taskType = null,
                viewValue = null,
                viewMessage = null,
                viewMessageVal = null,
                data = [],
                btnType = btn.getXType(),
                viewById = null,
				txtObj = null,
				val = null;
			
			if (view.ilboConfig.ilboName == "ezwizard") {
				if (btnType == 'textfield' && event.keyCode != 13)
					return;
				if ( (btnType == 'textfield' && event.keyCode == 13) || (btnType == 'button' && btn.getItemId() == 'btnGo') ) {
					txtObj = view.down('#txtPageNo');
					if (txtObj) {
						val = txtObj.getValue();
						if (Ext.isEmpty(val))
							return;
					}
					
					// TECH-32726
					val = purifyDom(val);
					var gridObj = view.down("#mlmessageml"),
						store = null,
						visibleRows = null,
						totalRows = null,
						totalVisibleRows = null,
						currentIndex = null,
						startIndex = null,
						inboxNav = null,
						pageNum = null,
						vr = null;
						viewValue = val;
						store = gridObj.getStore();
						currentIndex = store.vsi;
						totalRows = store.vr;
						totalVisibleRows = store.tr;
						visibleRows = gridObj.getVisibleRows();
						inboxNav = view.down("#txtPageNo");
						pageNum = view.down("#lblPageNo");
						viewValue = parseInt(viewValue);
					
                    startIndex = store.cr = visibleRows * (viewValue - 1) + 1;
					
                    vr = (viewValue + (store.vr / 3)) > totalVisibleRows ? totalVisibleRows : parseInt(viewValue + (totalVisibleRows / 3) - 1);
                    if (startIndex > totalVisibleRows)
                        return;

                    if (viewValue * visibleRows <= totalVisibleRows) {
                        if (currentIndex == startIndex)
                            return;
                        else {
							store.cr = store.vsi = startIndex;
                            if (currentIndex < startIndex)
                                gridObj.onInboxBtnNext();
                            else
                                gridObj.onInboxBtnPrev();

                            if (inboxNav)
                                inboxNav.setValue(viewValue);

                            if (pageNum)
                                pageNum.setHtml(parseInt(totalVisibleRows / visibleRows));
                        }
                    } else {
                        /* TO HANDLE THE NEXT SET OF RECORDS */
                        var start, end, vsi;

                        vsi = currentIndex + visibleRows;
                        store.vsi = vsi;
                        if (store.vsi > totalVisibleRows)
                            store.vsi = totalVisibleRows;
                        start = vsi > visibleRows ? startIndex : 1;
                        end = (visibleRows * 3) + (start - 1);

                        if (currentIndex < startIndex) {
                            gridObj.store.start = start;
                            gridObj.store.end = end;
                            gridObj.store.vsi = start;
                            store.cr = (start - visibleRows);
                            gridObj.store.changed = true;
                            gridObj.lastEvent = 'onnext';
							gridObj.fireEvent('movetorow', gridObj, start, end, store.vsi);
                            gridObj.updateSliderPosition(store.vsi);
                        }
                    }
					return;
                }
            }
            var postingFromDt = '',
                postingFromDtVal = '',
                postingEndDt = '',
                postingEndDtVal = '',
                dateSplitVal = '',
                searchValue = '',
                isSubject = '';
            viewById = (btnType == "splitbutton") ? "cmbviewby" : "cmbpviewby";
            viewMessageVal = view.down('#' + viewById).getValue() || "0";
            if (viewMessageVal) {
                switch (viewMessageVal) {
                    case "1":
                        viewMessage = "ALERT";
                        break;
                    case "2":
                        viewMessage = "ACTION";
                        break;
                    case "3":
                        viewMessage = "INFO";
                        break;
                    default:
                        viewMessage = "";
                        break;
                }
            }
            if (btnType == "splitbutton")
                viewValue = viewMessage + "::#::::#::::#::::#::";
            else if (btnType == "button") {
                postingFromDt = view.getControl('postingFromDt').getRawValue();
                postingEndDt = view.getControl('postingEndDt').getRawValue();
                searchValue = view.getControl('txtSearch').getValue() || "";
                isSubject = view.getControl('chkSubject').getValue();
                if (postingFromDt) {
                    dateSplitVal = postingFromDt.split('/');
					if(dateSplitVal.length > 1)//AHBG-25789
                    	postingFromDtVal = dateSplitVal[2] + "-" + dateSplitVal[0] + "-" + dateSplitVal[1];
                }
                if (postingEndDt) {
                    dateSplitVal = postingEndDt.split('/');
                    if(dateSplitVal.length > 1)//AHBG-25789
                    	postingEndDtVal = dateSplitVal[2] + "-" + dateSplitVal[0] + "-" + dateSplitVal[1];
                }
                isSubject = (isSubject == true) ? 1 : 0;
                viewValue = viewMessage + "::#::" + postingFromDtVal + "::#::" + postingEndDtVal + "::#::" + searchValue + "::#::" + isSubject;
            }
            view.setControlData('txthdrtextctrl', 'txthdrtextctrl', 0, viewValue);
            data = viewModel.getSessionData();
            task = btn.task;
            taskType = btn.taskType;
            me.taskPending = true;
            view.fireEvent('trans', view, data, task, taskType, '', '', null, 'txthdrtextctrl', 'txthdrtextctrl');
        } catch (ex) {}
    },
    loadTemplate: function(templateFile) {
        var me = this;
		/*RamcoRTC.getFileRequest(me.onTemplateResponse.bind(me), me.onTemplateRejected.bind(me), me, templateFile);
		*/
		RamcoLog.end('Client Trans');
		RamcoLog.start('Server Trans', templateFile);
        Ext.Ajax.request({
			timeout: 600000,
            url: templateFile,
            disableCaching: false
		}).then(function(response, opts){
			me.onTemplateResponse(response, opts);
		},function(response, opts){
			me.onTemplateRejected(response, opts);
        });
    },
    onTemplateResponse: function(response, options) {
		RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','template');
        var me = this,
            view = me.getView(),
            ilboName = view.ilboConfig.ilboName;
        try {
            view.templatesJson = Ext.decode(response.responseText, true);
            if (view.templatesJson && view.templates) {
                for (key in view.templatesJson) {
                    value = view.templates[ilboName + "_" + key];
                    if (value) {
                        value.destroy();
                        Ext.destroy(value);
                        value = null;
                    }
                    view.templates[ilboName + "_" + key] = null;
                    delete view.templates[ilboName + "_" + key];
                }
                view.templates = {};
            }
            //view.callScreenInit();
        } catch (e) {
            console.log(e);
        }
        me.templated = true;
        if (me.requiredScripts) {
            if (me.requiredScripts.length <= 0 && me.callOutInit)
                view.setIsInit(true);
        } else
        if (me.callOutInit)
            view.setIsInit(true);
    },
    onTemplateRejected: function(response, options) {
        var me = this;
        view = me.getView(),
            messages = [{
                sr: response.statusText,
                sv: response.status,
                cd: options.url,
                ds: response.statusText,
                ca: 'Contact Admin..'
            }];
        console.log('Fail to Load Templates');
        me.templated = true;
        if (me.callOutInit && me.templated) {
            view.setIsInit(true);
        }
        //view.callScreenInit();
    },
    onUITabItemChange: function(tabPanel, value, oldValue, eOpts) {
		// TECH-30546 / PNU-164
		if(tabPanel && tabPanel.role == "calander")
			return;
        if (this.taskPending)
            return;
        var me = this,
			view = me.getView(),
            viewModel = me.getViewModel(),
			task = view.ilboConfig.inlineTab ? 'tskstdtabdata' : 'tskstdtabupdate',
            data = [], mainView = getMainController();
        //data = viewModel.getSessionData();
        me.taskPending = true;
		tabPanel.activeTab.body.setStyle('opacity', 0);
		RamcoRTC.focusCtrl[1] = tabPanel.getItemId();
		// TECH-30546 / PNU-164
		if (mainView && mainView.getPersonalization() == true)
			view.performPersonalization(data, tabPanel);
		//TECH-35081 /PTPH-41
		if (mainView && mainView.getDefaultTemplate() == true)
			view.performDefaultTemplate(data, view);
        if (view.getActiveTabNeedInit()  === false) {
            /* if (RamcoRTC.currentInstance == 'Wizard' && view.ilboConfig.componentName == 'ezwizard') {
                RamcoRTC.actWizItem = view.activeTabName;
				me.taskPending = true;
                return;
            } */
			if (value.name != oldValue.name) {
				view.ilboConfig.tabName = (value.name) ? value.name.toLowerCase() : value.itemId;
				view.activeTabName = view.ilboConfig.tabName;
				if (RamcoRTC.currentInstance == 'Wizard' && view.ilboConfig.componentName == 'ezwizard')
					RamcoRTC.actWizItem = view.activeTabName;
				view.tabTask = value.task;
			}
			if(view.tabTask) {
				view.callBack = function() {
					me.taskPending = true;
					view.fireEvent('trans', view, data, view.tabTask, 'trans');
					delete view.tabTask;
					return;
				}
			}
			view.setTabScreenInfo(view.ilboConfig.tabName, true);
			task = view.ilboConfig.inlineTab ? 'tskstdtabinit' : 'tskstdscreeninit';
            view.fireEvent('trans', view, data, task, 'trans');
            return;
        }
		if (value.name != oldValue.name) {
            view.ilboConfig.tabName = (value.name) ? value.name.toLowerCase() : value.itemId;
            view.activeTabName = view.ilboConfig.tabName;
            if (RamcoRTC.currentInstance == 'Wizard' && view.ilboConfig.componentName == 'ezwizard')
                RamcoRTC.actWizItem = view.activeTabName;
            view.tabTask = value.task;
        }
        if(view.tabTask) {
			view.callBack = function() {
				me.taskPending = true;
				view.fireEvent('trans', view, data, view.tabTask, 'trans');
				delete view.tabTask;
				return;
			}
		}
        view.fireEvent('trans', view, data, task, 'trans');
    },
    onRefreshMap: function(map, value) {
        var mapCtrl = map.gmap,
            centerPoint = null,
            value = null;
        if (map !== undefined && map._jsonValue) {
            value = map._jsonValue.center;
            if (typeof google !== 'undefined') {
                google.maps.event.trigger(mapCtrl, 'resize');
                if (typeof mapCtrl.setCenter == "function" && value) {
                    centerPoint = new google.maps.LatLng(value.latitude, value.longitude);
                    mapCtrl.setCenter(centerPoint);
                    map.addMarker(value);
                }
            }
        }
    },
    onMapClick: function(map, e) {
        var me = this,
            view = me.getView(),
            item = {},
            viewValue = '';
			//TECH-28715 //TECH-37671
		if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia" || RamcoRTC.settings.mapProvider == "hereMap"){
			item.latitude = e.latlng.lat;
			item.longitude =  e.latlng.lng;
    	}else{
			item.latitude = e.latLng.lat() ;
			item.longitude = e.latLng.lng() ;
		}	
        map.addMarker(item);
        if (map.ascCtrl) {
            viewValue = "latitude:" + item.latitude + ", longitude:" + item.longitude;
            view.setControlData(map.ascCtrl, map.ascCtrl, 0, viewValue);
        }
    },
    onMarkerClick: function(map, marker, data) {
			var me = this,
            view = me.getView(),
            data = [],
			ascCtrl = map.ascCtrl,
			task = map.task,
			viewValue = '';
		if (ascCtrl && task) {
			//TECH-28715 //TECH-37671
			if(RamcoRTC.settings.mapProvider == "hereMap")
				viewValue = (marker.target && marker.target.options && marker.target.options.item) ?marker.target.options.item.key:null;
			else if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia")
				viewValue = marker.latlng.lat.toString() + ", " + marker.latlng.lng.toString();
			else
				viewValue = marker.position.lat().toString() + ", " + marker.position.lng().toString();
			view.setControlData(ascCtrl, ascCtrl, 0, viewValue);					
			view.fireEvent('trans', view, data, task, 'trans');
		}
    },
	onCircleMapClick: function(map, circle) {
		var me = this,
            view = me.getView(),
            data = [],
			ascCtrl = map.ascCtrl,
			task = map.task,
			viewValue = '';
		if (ascCtrl) {
            viewValue = circle.center.lat().toString() + ", " + circle.center.lng().toString();
			view.setControlData(ascCtrl, ascCtrl, 0, viewValue);					
			view.fireEvent('trans', view, data, task, 'trans');
		}
	},
    onWizardButtonClick: function(btn, e, eOpts) {
        var me = this,
            tagCloud,
            view = me.getView(),
			inboxNav = view.down("#txtPageNo");
        if (!view)
            return;

        if (view.ilboConfig.tabName == "myinbox") {
            var gridObj = view.down("#mlmessageml"),
				gridStore = gridObj.getStore(),
				pageNum, visibleRows = gridObj.visibleRows;
            if ((btn.getItemId() == "lnkMoveNext" || btn.getItemId() == "lnkMovePrevious")) {
                if (btn.getItemId() == "lnkMoveNext")
                    gridObj.onBtnNext();
                else if (btn.getItemId() == "lnkMovePrevious")
                    gridObj.onBtnPrev();
				if(gridStore) {
					pageNum = Math.ceil(gridStore.vsi/visibleRows);
					inboxNav.setValue(pageNum);
				}
            } else if (btn.getItemId() == 'btnPGo' || btn.getItemId() == 'btnGo')
                me.onMsgGoButtonClick(btn, e);

            return;
        } else if (view.ilboConfig.tabName == "wizard1" || view.activeTabName == 'wizard1') {
            var crtLaunchValue = "<link_data><step><di tsq='2' ssq='1' sil='ezwizard' til='def_user_ezwizard' scid='dspnew_activityname' scvn='dspnew_activityname' tcid='dspezwiz_hidden' tcvn='dspezwiz_hidden'/></step><ilbo></ilbo></link_data>",
                userType = 'USR',
                data = [], // TECH-33131 - SEH-318 / TAQ-381
                task = btn.task,
                taskType = btn.taskType,
                wizardDetails = 'segnm:' + RamcoRTC.segmentName + ',sno:2,wn:techtest,sc:ezwizard,sa:ezwizard,si:ezwizard,tc:ezwizard,ta:def_user_ezwizard,ti:def_user_ezwizard,lnkt:step,psno:1,actntype:savetask,actcmp:ezwizard';

            if (RamcoRTC.settings.implementorUsers) {
                for (var i = 0; i < RamcoRTC.settings.implementorUsers.length; i++) {
                    if (RamcoRTC.userInfo.n.toLowerCase() == RamcoRTC.settings.implementorUsers[i].user.toLowerCase() && RamcoRTC.userInfo.r.toLowerCase() == RamcoRTC.settings.implementorUsers[i].role.toLowerCase()) {
                        userType = 'ENT';
                        break;
                    }
                }
            }
            view.setControlData('hdnnew_activitykey', 'hdnnew_activitykey', 0, crtLaunchValue);
            view.setControlData('dspnew_activityname', 'dspnew_activityname', 0, userType);
            
			// TECH-33131 - SEH-318 / TAQ-381
            //data = view.getSessionData();
			
			view.callBack = function() {
				var controller = view.getController();
				controller.taskPending = true;
				data = [];
                wizardDetails = 'segnm:' + RamcoRTC.segmentName + ',sno:2,wn:techtest,sc:ezwizard,sa:ezwizard,si:ezwizard,tc:ezwizard,ta:def_user_ezwizard,ti:def_user_ezwizard,lnkt:step,psno:1,actntype:linktask,actcmp:ezwizard';
                view.fireEvent('wizardmltrans', view, data, task, taskType, null, '1', 0, 0, wizardDetails);
			};
			view.fireEvent('wizardmltrans', view, data, task, taskType, null, '1', 0, 0, wizardDetails);
			return;
        } else if (view.ilboConfig.tabName == "menutag") {
            tagCloud = view.down('#cloud');
            if (btn.getItemId() == 'sortbyname') {
                if (btn.pressed) {
                    tagCloud.store.sort('actdesc', 'ASC');
                    tagCloud.refresh();
                } else {
                    tagCloud.store.sort('actdesc', 'DESC');
                    tagCloud.refresh();
                }
            }
            if (btn.getItemId() == 'sortbyweight') {
                if (btn.pressed) {
                    tagCloud.store.sort('wgt', 'DESC');
                    tagCloud.refresh();
                } else {
                    tagCloud.store.sort('wgt', 'ASC');
                    tagCloud.refresh();
                }
            }
            if (btn.getItemId() == 'sortbyapp') {
                var list = tagCloud.el.down(".x-cloud-unordered-list");
                if (list) {
                    if (btn.pressed) {
                        list.addCls("alt");
                    } else {
                        list.removeCls("alt");
                        tagCloud.refresh();
                    }
                }
                tagCloud.updateLayout();
            }
        }
    },
    onTagSelect: function(itm, data, index) {
		// TECH-28395
        var me = this,
            view = me.getView(),
			activity;
        view.tmpConfig = {};
        if (view.ilboConfig) {
            view.tmpConfig.activityDesc = data.data.actdesc;
            view.tmpConfig.activityName = data.data.actname;
            view.tmpConfig.componentName = data.data.cmpname;
            view.tmpConfig.ilboName = data.data.stilbo;
            view.tmpConfig.tabName = "";
            view.tmpConfig.ilboType = "";
			activity = getActivityfromBPC(RamcoRTC.menu, data.data.actname);
			if (!Ext.isEmpty(activity)) {
				view.tmpConfig.isEdk = activity.isedk ? activity.edk : '';
			}
        }
        view.fireEvent('uilaunch', view, 'wizard');
    },
    onTagContextClick: function(ctrl, data, e) {
        var me = this,
            view = me.getView(),
            menu = me.menu,
            context = view.ezValue;
        view.tmpConfig = {};
        if (context && view.tempId == "ezwizard_ezwizard") {
            view.tmpConfig.activityDesc = data.data.actdesc;
            view.tmpConfig.activityName = data.data.actname;
            view.tmpConfig.componentName = data.data.cmpname;
            view.tmpConfig.ilboName = data.data.stilbo;
            view.tmpConfig.tabName = "";
            view.tmpConfig.ilboType = "";
            if (!menu)
                me.menu = menu = new Ext.menu.Menu({
                    items: context
                });
            e.preventDefault();
            menu.showAt(e.getXY());
        }
    },
    onChange: function(ctrl, newValue, oldValue, eOpts) {
        //if (!(ctrl.xtype == 'combofield' || ctrl.xtype == 'ramcotagfield' || ctrl.xtype == 'ramcolistedit')) {
            var me = this,
                id = (ctrl.xtype == 'segmentedbutton') ? ctrl.ascCtrl : ctrl.getItemId(),
                view = me.getView(),
                data = [],
                task = ctrl.task || ctrl.uiTask,
                taskType = ctrl.taskType,
				viewDataCtrl = null,
				ldapdesc,
                viewModel = me.getViewModel();
            if (viewModel && newValue != oldValue) {
				viewDataCtrl = viewModel.data[ctrl.itemId];
                viewModel.setModified(id);
            }
			if (ctrl.xtype == "ramcopassword") {
				if (viewDataCtrl) {
					viewDataCtrl.value = ctrl.getEncValue();
					viewDataCtrl.xtype = "ramcopassword";
				}
			}
			//TECH-28474
			 try{
				if (view.rendered && view.ilboConfig.ilboName == "ezelogin") {
					ldapdesc = view.down('#ldapdesc');
					// TECH-32997
					if (view.config.htmFile === true) {
						ldapdesc = view.login.ldapCombo;
					}
					if (!Ext.isEmpty(ldapdesc) && ldapdesc.isVisible()) {
						var frgtPwdLnk = view.down('#frgtpwdlink'),
							newVal = ldapdesc.value;
						// TECH-32997
						if (view.config.htmFile === true) {							
							frgtPwdLnk = view.login.frglnk;						
						}
						if (frgtPwdLnk) {					
							if(!Ext.isEmpty(newVal) && newVal.toLowerCase() != "default")
								frgtPwdLnk.hide();
							else
								frgtPwdLnk.show();
						}
					}
				}	
			 }catch(ex){
				console.log(ex); 
			 }
			if (ctrl.xtype == "ramcomaskfield") {
				ctrl.valueChanged = true;
			}
            //if ((ctrl.xtype == 'datefield' || ctrl.xtype == 'checkboxfield' || ctrl.xtype == 'ramcoradio') && task && window.event && (window.event.type == 'click' || window.event.type == 'change')){
			/*if (ctrl.eType == 'change' && (ctrl.xtype  == 'checkboxfield' || ctrl.xtype == 'ramcoradio') && task && window.event && (window.event.type == 'click' || window.event.type == 'change')){
                viewModel.set(id + ".value", ctrl.getValue());
				ctrl.eType=null;
				delete ctrl.eType;
				data = viewModel.getSessionData();
                view.fireEvent('trans', view, data, task, taskType, id, id);
                return;
            }*/
            /*if (ctrl.xtype == 'ramcotimefield') {
                viewModel.set(id + ".value", ctrl.getValue());
            }
            if (ctrl.xtype == 'datefield' && ctrl.uiTask) {
                viewModel.set(id + ".value", ctrl.getValue());
                data = viewModel.getSessionData();
                view.fireEvent('trans', view, data, ctrl.uiTask, taskType, id, id);
                return;
            }*/
        //}
    },
	onTimeBlur: function(ctrl, value) {
		var me = this,			
			id = ctrl.getItemId(),
			viewModel = me.getViewModel();
		if (viewModel) {
			viewModel.setModified(id);
		}
		viewModel.set(id + ".value", value);
	},
	onOrgNodeSelect: function(ctrl, node, record, gview, eOpts) {
		if (ctrl.nodeSelEvent) {
			if (this.taskPending)
				return;
			var me = this,
				id = ctrl.getItemId(),
				view = me.getView(),
				data = [],
				task = ctrl.nodeSelEvent,
				viewModel = me.getViewModel(),
				taskType = ctrl.uiTaskType || "ui",				
				store = ctrl.getStore(),
				curNode = null,
				rec = store.findNode('sel', true);
			while (rec) {
				rec.set('sel', false);
				rec = store.findNode('sel', true);				
			}
			curNode = store.getNodeById(record.get("id"));
			curNode.set('sel', true);			
			data = viewModel.getSessionData();
			me.taskPending = true;
			view.fireEvent('trans', view, data, task, taskType, '', '', '', '', '',id, ctrl.nodeSelView);
		}
	},
    onSelect: function(ctrl, newValue, oldValue, eOpts) {
        if (newValue != oldValue) {
            var me = this,
                id = ctrl.getItemId(),
                viewModel = me.getViewModel();
            if (viewModel) {
                viewModel.setModified(id);
            }
            if (ctrl.uiTaskType == 'ui' && ctrl.uiTask) {
                if (this.taskPending)
                    return;
                var me = this,
                    view = me.getView(),
                    data = [],
                    task = ctrl.uiTask,
                    taskType = ctrl.uiTaskType || "ui";
                //data = viewModel.getSessionData();
                me.taskPending = true;
                //view.fireEvent('trans', view, data, task, taskType, '', '', id, id);
				view.fireEvent('trans', view, data, task, taskType, '', '', '', '', '', id, id);
            }
        }
    },
	onBlur: function(field,evt) {
		try {
			var me = this,
				comboVal = field.getRawValue(),
				store = field.store,
				rec, index;
			/* if (field.xtype == "ramcolistedit") {
				field.setValue(comboVal);
				field.checkChange();
				return;
			} */
			if (!Ext.isEmpty(comboVal)) {
				field.checkChange();
			}
			
			if (!Ext.isEmpty(field.lastSelectedRecords) && field.lastSelectedRecords.length > 0) {
				field.lstRecord = field.lastSelectedRecords[0];
			}
			if(field.lstRecord){
				field.Val = field.lstRecord.data.value;
				if(comboVal != field.Val){
					store.clearFilter();
					field.setValue(field.Val);
				}
			}
			else if (store && store.data && field.lastQuery){
				rec = store.findRecord(field.displayField, field.lastQuery);
				index = (rec) ? store.indexOf(rec) : -1;
				if (index > -1) {
					field.setValue(rec.data.text);
				}
			}
		}
		catch(ex) { console.log(ex); }
	},
    onLinkSelect: function(ctrl, rec) {
        var me = this,
            task = rec.get('task'),
            //taskType = rec.get('tasktype') || 'link',
            id = ctrl.getItemId(),
            viewModel = me.getViewModel();
        /*if (viewModel) {
            viewModel.setModified(id);
        }*/
        if (task) {
            if (this.taskPending)
                return;
            var me = this,
                view = me.getView(),
                data = [];
            //data = viewModel.getSessionData();
            me.taskPending = true;
			//TECH-34447
            //view.fireEvent('trans', view, data, task, 'link', '', '', id, id);
			view.fireEvent('trans', view, data, task, 'link', id, id);
        }
    },
    onPivotConfigChange: function(panel, config, eOpts) {
        console.log(config);
        if (this.taskPending)
            return;
        if (panel && panel.pivot) {
            panel.pivot.reconfigurePivot(config);
        }
        var me = this,
            gridId = panel.pivot.getItemId(),
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstdrenderpivot',
            taskType = 'trans';
        data = viewModel.getSessionData();
        data.push({
            id: gridId,
            pcf: true,
            vl: config
        });
        me.taskPending = true;
        view.fireEvent('gridtool', view, data, task, 'rvwstandardtask', gridId);
    },
	onShowdrilldownpanel:function(ctrl,ddview,matrix){
		if (this.taskPending)
            return;
         var me = this,
            gridId = ctrl.getItemId(),
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstdpivotdrilldown',
            taskType = ctrl.taskType,
			key="";
		key = matrix.values.dk;
        data = viewModel.getSessionData();
		data.push({
			id:gridId,
			psc:true,
			v:key
		});
		me.taskPending = true;
		RamcoRTC.focusCtrl[1] = ctrl.getItemId() || null;
		RamcoRTC.focusCtrl[2] = matrix.leftKey || null;
		RamcoRTC.focusCtrl[3] = matrix.topKey || null;
		view.fireEvent('gridtool', view, data, task, 'rvwstandardtask', gridId);

    },
    onGridMoveTo: function(ctrl, start, end, vsi, keynav) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = ctrl.getItemId(),
            view = me.getView(),
            //viewModel = me.getViewModel(),
            data = [];
            //task = ctrl.task,
            //taskType = ctrl.taskType;
        //data = viewModel.getSessionData();
		if(ctrl.xtype == "ramcoddtgrid") 
			gridId = ctrl.parentId;
        me.taskPending = true;
        RamcoRTC.focusCtrl[1] = ctrl.getItemId() || null;
        RamcoRTC.focusCtrl[2] = vsi || null;
		RamcoRTC.focusCtrl[3] = null;
        RamcoRTC.focusCtrl[4] = keynav || null;
        view.fireEvent('movetorow', view, data, "tskstdmovetorow", 'rvwstandardtask', gridId, start, end);
    },
    onGridHelp: function(ctrl, column) {
        // TECH-33857
        if (this.taskPending || column.stateEnabled == false)
            return;
        var me = this,
            gridId = ctrl.getItemId(),
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            ddtObj = null,
            ddtTask = null,
            ddtCtrl = null,
            ddtView = null,
            ddtValue = null,
            srcCtrl = null,
            task = column.helpTask.toLowerCase(),
            selection = ctrl.getSelection(),
            record = selection ? selection[0] : null,
            taskType = column.helpTaskType.toLowerCase();
		//TECH-34021
        //data = viewModel.getSessionData();
        if (view.ddt && view.ddt['task'] && view.ddt['task'][task]) {
            ddtObj = view.ddt['task'][task];
            ddtCtrl = ddtObj.ctrl;
            ddtView = ddtObj.view;
            if (ddtCtrl == ddtView) {
                /*srcCtrl = view.down('#' + ddtCtrl);
                if (srcCtrl) {
                    ddtValue = srcCtrl.getValue();
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                }*/
                ddtValue = view.getControlData(ddtCtrl);
                if (!Ext.isEmpty(ddtValue))
                    ddtValue = ddtValue.toLowerCase();
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            } else {
                srcCtrl = view.down('#' + ddtCtrl);
                if (srcCtrl) {
                    ddtValue = record ? record.get('v' + ddtView) : null;
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                }
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            }
        }
		//TECH-29895
		column.fireEvent('ctrlfocus', ctrl.itemId, column.name, (record) ? record.get('rn') : ctrl.store.tr);
        if (ddtTask)
            task = ddtTask;
		/*var store = ctrl.getStore(),
			rec = store.findRecord('sel', true);
		while (rec) {
			rec.set('sel', false);
			rec = store.findRecord('sel', true);
		}*/
		/* if(record && record.set)
        	record.set('sel', true); */
		//TECH-29895
		if (RamcoRTC.osType == 'JAVA' && record && record.set)
        	record.set('sel', true);
        me.taskPending = true;
        view.fireEvent('help', view, data, task, taskType, gridId);
    },
    onGridUi: function(ctrl, start, end) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = ctrl.getItemId(),
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = ctrl.uiTask,
            taskType = ctrl.uiTaskType;
		//TECH-34021
        //data = viewModel.getSessionData();
        me.taskPending = true;
        view.fireEvent('trans', view, data, task, taskType, gridId);

    },
    onGridSort: function(grid, col, direction) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.getItemId(),
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstdsort',
            data = viewModel.getSessionData(),
			curSort, sortData = [], // TECH-28159 / TECH-26959
			workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
			// TECH-29531
			// ilbo =  getCurrentPage().ilboConfig.ilboName,
			ilbo = view.ilboConfig.ilboName,
			controller = getMainController(); // TECH-29276
		
		if (RamcoRTC.userInfo.hasmsort) {
			curSort = {view: col.name, so: direction};
			if (grid.prevSort) {
				grid.prevSort.so = -1;
				sortData.push(grid.prevSort, curSort);
			}
			else{ // TECH-28159 / TECH-26959
				sortData.push(curSort);
				// TECH-29276
				/*if(!RamcoRTC.multiSortGridData[workArea])
					RamcoRTC.multiSortGridData[workArea] = []
				if(!RamcoRTC.multiSortGridData[workArea][ilbo])
					RamcoRTC.multiSortGridData[workArea][ilbo] = []
				RamcoRTC.multiSortGridData[workArea][ilbo][gridId]  = [gridId, sortData];*/
				
				if(!controller.multiSortGridData[workArea])
					controller.multiSortGridData[workArea] = []
				if(!controller.multiSortGridData[workArea][ilbo])
					controller.multiSortGridData[workArea][ilbo] = []
				controller.multiSortGridData[workArea][ilbo][gridId]  = [gridId, sortData];
			}
			// grid.prevSort = curSort;
			me.taskPending = true;
			// TECH-31812
			view.fireEvent('trans', view, data, task, 'rvwstandardtask', gridId, sortData, 'msort');
		}
		else {
        	me.taskPending = true;
        	view.fireEvent('trans', view, data, task, 'rvwstandardtask', gridId, col.name, direction);
		}
    },
	onSplitMenuItemClick: function(ctrl, menuItem) {		
		if (ctrl.uiTask) {
            if (this.taskPending)
                return;
            var me = this,
                view = me.getView(),
                viewModel = me.getViewModel(),
                data = [],
                task = ctrl.uiTask,
                taskType = ctrl.uiTaskType;            
            me.taskPending = true;
			viewModel.setModified(ctrl.itemId);
            view.fireEvent('trans', view, data, task, taskType, ctrl.itemId, ctrl.itemId);
        }		
	},
    onGridSelect: function(grid, ctrl) {
        var me = this;
        if (ctrl.uiTask) {
            if (this.taskPending)
                return;
            var me = this,
                view = me.getView(),
                viewModel = me.getViewModel(),
                data = [],
                task = ctrl.uiTask,
                taskType = ctrl.uiTaskType;
            //data = viewModel.getSessionData();
            me.taskPending = true;
            view.fireEvent('trans', view, data, task, taskType);
        }
    },
    onGridEnter: function(grid, ctrl, record) {
        var me = this;
        if (ctrl.uiTask) {
            if (this.taskPending)
                return;
            var me = this,
                ctrlName = grid.itemId,
                view = me.getView(),
                viewModel = me.getViewModel(),
                data = [],
                task = ctrl.uiTask,
                taskType = ctrl.uiTaskType;
            //viewModel.setModified(ctrlName);
			/*if (taskType && taskType == "ui") {
				var store = grid.getStore(),
					rec = store.findRecord('sel', true);
				while (rec) {
					rec.set('sel', false);
					rec = store.findRecord('sel', true);
				}
				if(record)
					record.set('sel', true);
			}*/
            //data = viewModel.getSessionData();
            me.taskPending = true;
            //view.fireEvent('trans', view, data, task, taskType);
			view.fireEvent('mltrans', view, data, task, taskType, ctrlName, ctrl.name)
        }
    },
	//TECH-39926
	onGridColumnFocusEnter: function(grid, ctrl, record) {
        var me = this,
			eventDetails = ctrl.onFocusTask + "~" + (record?record.get("rn"):"~"),
			view = me.getView();
		if(!Ext.isEmpty(ctrl.onFocusTask) && view.lastEvent !== eventDetails){
            if (this.taskPending)
                return;
            var me = this,
                ctrlName = grid.itemId,
                view = me.getView(),
                viewModel = me.getViewModel(),
                data = [],
                task = ctrl.onFocusTask,
                taskType = ctrl.uiTaskType;
			view.lastEvent = eventDetails;
            me.taskPending = true;
            view.fireEvent('mltrans', view, data, task, taskType, ctrlName, ctrl.name)
        }
    },
	onGridColumnFocusLeave: function(grid, ctrl, record) {
        var me = this,
			eventDetails = ctrl.leaveFocusTask + "~" + (record?record.get("rn"):"~"),
			view = me.getView();
		if(!Ext.isEmpty(ctrl.leaveFocusTask) && view.lastEvent !== eventDetails){
            if (this.taskPending)
                return;
            var me = this,
                ctrlName = grid.itemId,
                view = me.getView(),
                viewModel = me.getViewModel(),
                data = [],
                task = ctrl.leaveFocusTask,
                taskType = ctrl.uiTaskType;
            me.taskPending = true;
			view.lastEvent = eventDetails;
            view.fireEvent('mltrans', view, data, task, taskType, ctrlName, ctrl.name)
        }
    },
    onGridCellClick: function(ctrl, cellData, row, record, rowData, col) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = ctrl.navigationModel.column.config.task,
            taskType = 'link';
        if (!task)
            return;
        record.set('sel', true);
	   // data = viewModel.getSessionData();
        me.taskPending = true;
        view.fireEvent('trans', view, data, task, taskType);
    },
    /*
    onGridColumnResize: function(column, width, height, oldWidth, oldHeight, eOpts) {
        if (!Ext.isEmpty(column) && !Ext.isEmpty(column.cellWidth)) {
            //if (width - column.cellWidth == 0 || Math.abs(width - column.cellWidth) < 5)
               // return;
            var me = this,
                grid = column.up('ramcogrid'),
                data = grid.getPersonalization() || [];
            if (grid) {
                if (!data[column.dataIndex])
                    data[column.dataIndex] = {
                        wi: (width - column.cellWidth)
                    };
                //else
                  //  data[column.dataIndex].wi = (width - column.cellWidth);
                grid.setPersonalization(data);
            }
        }
    },
    onGridColumnMove: function(ct, column, fromIdx, toIdx, eOpts) {
        if (!Ext.isEmpty(fromIdx) && !Ext.isEmpty(toIdx)) {
            var me = this,
                grid = column.up('ramcogrid'),
                data = grid.getPersonalization();
            if (grid) {
                data.seqChanged = true;
                grid.setPersonalization(data);
            }
        }
    },*/
    onGridLock: function(grid, column) {
        var me = this,
            data = grid.getPersonalization() || {};
        if (!data[column.dataIndex]) {
            data[column.dataIndex] = {
                lock: true
            };
		}
        else
            data[column.dataIndex].lock = true;
		data.seqChanged = true;
        grid.setPersonalization(data);
    },
    onGridUnLock: function(grid, column) {
        var me = this,
            data = grid.getPersonalization() || {};
        if (!data[column.dataIndex]) {
            data[column.dataIndex] = {
                lock: false
            };
		}
        else
            data[column.dataIndex].lock = false;
		data.seqChanged = true;
        grid.setPersonalization(data);
    },
    onUIClick: function(actCtrl, task, taskType, vCtrl, childWidth, childHeight, showWindow, popupSection, ctrl, ctrlObj, assView, isCallout) {
        if (this.taskPending)
            return;
        var me = this,ctrlVal,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
			storePathObj = '',
			storePath = '',
			ascCtrl = null;
        ctrl = ctrl || {};
		ctrlVal = (assView!= "") ? viewModel.data[assView] : "",
		dView = '', val = '';
        if (taskType == 'browsedownload') {
			if (actCtrl.isAssorted) {
				val = '';
				if (actCtrl.views) {
					storePathObj = actCtrl.views["v" + assView];
					if (storePathObj)
						storePath = storePathObj.storePath || '';
				}
				val = Ext.String.format(view.fileUrl, actCtrl.itemId, assView, '0', storePath, '');
			}
			else {
				ascCtrl = view.down('#'+ assView);
				if (!Ext.isEmpty(ctrlVal.value))
					val = Ext.String.format(view.fileUrl, actCtrl.itemId, assView, '0', ascCtrl?(ascCtrl.srcPath || ''):'', '');	
					//val = Ext.String.format(view.fileUrl, actCtrl.itemId, assView, '0', actCtrl.storePath || '', '');
					//val = Ext.String.format(view.fileUrl, actCtrl.itemId, assView, '0', ctrlVal.value, '');
				else
					val = Ext.String.format(view.dbFileUrl, actCtrl.itemId, assView, '0', '', dView);
			}
			if (val)
				openWindow(val);
            return;
        } else if (taskType == 'new') {
            openWindow(task);
            return;
        }
        childWidth = parseInt(childWidth, 10);
        childHeight = parseInt(childHeight, 10);
        if (!task)
            return;
        //view.coSecName = isCallout;
        //view.coCtrlName = ctrl.itemId;
        //data = viewModel.getSessionData();
        me.taskPending = true;
        if (showWindow) {
            taskType = 'modal';
        }
		if ((showWindow == 'true' || showWindow == true) && Ext.isEmpty(popupSection))
            taskType = 'modal';
		//TECH-38228		
		if (Ext.isEmpty(showWindow) && Ext.isEmpty(popupSection)) {
			popupSection = view.popupSec ? view.popupSec[task ? task.toLowerCase():''] : null;	
		}
        if (isCallout && isCallout.indexOf('#*#') != -1) {
            calloutArr = isCallout.split('#*#');
            calloutSec = calloutArr[0];
            popupClose = (calloutArr[1].toLowerCase() == 'y') ? true : false;
            view.popupClose = popupClose;
        } else if (isCallout) {
            view.coSecName = isCallout;
            view.coCtrlName = isCallout;
            //view.coView = record;
            view.coView = ctrl;
        }
        view.fireEvent('uitask', view, data, task, taskType, '', childWidth, childHeight, showWindow, popupSection);
    },
    onLinkClick: function(ctrl, task, taskType, row, controlName, activityName, ilboName, tabName, viewName, quickLinkDesc, childWidth, childHeight, showWindow, eventDtls, isReport, isFromSP, delay, extLinkType) {
        if (this.taskPending)
            return;
        if (!task)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [];
	   // data = viewModel.getSessionData();
        if (taskType == 'browsedownload') {
            var val = Ext.String.format(view.dbFileUrl, ctrl.itemId, assView, '0', ctrl.srcPath, ctrl.itemId);
            if (val)
                openWindow(val);
            return;
        } else if (taskType == 'new') {
            openWindow(task);
            return;
        }
        childWidth = parseInt(childWidth, 10);
        childHeight = parseInt(childHeight, 10);
        me.taskPending = true;
        if (showWindow) {
            taskType = 'modal';
        }
        view.fireEvent('linktask', view, data, task, taskType, '', childWidth, childHeight);
    },
    onDblClick: function(grid, record, recordIndex) {
        var me = this,
            view = me.getView(),
            gridId = grid.itemId,
            store = grid.getStore(),
            helpWin = view.up('ramcohelpwindow'),
            rec = store.findRecord('sel', true);
        if (helpWin) {
            while (rec) {
                rec.set('sel', false);
                rec = store.findRecord('sel', true);
            }
            record.set('sel', true);
            me.taskPending = true;			
            view.fireEvent('transfer', helpWin, view);
        }
    },
    onEditComplete: function(editor, context, eOpts) {
        /*if(context && context.record){
        	context.record.set('isNew', false);
        }*/
        /*if(context.column.lastEvent == 'select'){
        	context.column.lastEvent = null
        	;
        	context.grid.fireEvent('cmbselect', context.grid, context.column);
        }*/
    },
    onBeforeEdit: function(editor, context, eOpts) {
        editor.grid.edited = true;
		editor.grid.col = context.colIdx;
    },
    onGridUIClick: function(grid, record, task, taskType, viewId, childWidth, childHeight, showWindow, popupSection, ctrl, ctrlObj, assView, callout) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            dataCtrl = null,
            select = '',
            ddtObj = null,
            ddtTask = null,
            ddtCtrl = null,
            ddtView = null,
            ddtValue = null,
            calloutArr = [],
            calloutSec = null,
            popupClose = null,
            gridId = grid.itemId,
			metaViewName = ''; //TECH-35056
			if(grid.xtype == "ramcoddtgrid") 
				gridId = grid.parentId;				
        if (task == 'browsedownload' || taskType == 'browsedownload') {
            if (Ext.isEmpty(viewId)) {
                console.log("Invalid View Name");
                return;
            }
            var column = grid.getColumnById('v' + viewId),
                dView = column.assView || '',
                //val = Ext.String.format(view.fileUrl, grid.itemId, assView, record.get('rn'), column.srcPath, dView || column.itemId.replace('v', ''));
				val = Ext.String.format(view.fileUrl, grid.itemId, assView, record.get('rn'), column.srcPath, dView);
            if (val)
                openWindow(val);
            return;
        } else if (taskType == 'new') {
            openWindow(task);
        }
		
        // TECH-33164
		if (grid.xtype == 'ramcodataview' || (taskType && (taskType == 'modal' || taskType == 'link' || taskType.toLowerCase() == 'datahyperlink' || task == 'ezwmainscdelet1ui' || taskType == "ui"))) {
            var store = grid.getStore(),
				rec = store.findRecord('sel', true);
			while (rec) {
				if (grid.xtype == 'ramcodataview') 
					rec.data.sel = false;
				else
					rec.set('sel', false);
                rec = store.findRecord('sel', true);
            }
        }
		
        record.set('sel', true);
		record.dirty = true;
		// TECH-28131
		//TECH-30928		
		if (grid.xtype != 'ramcodataview') {
			if (grid.xtype == 'ramcod3cloud'){
				var store = grid.getStore();
				if(store)
					store.cr = record.get('in') || record.get('rn');
			}
			else
				grid.store.cr = record.get('in') || record.get('rn');
			
		}

		if (grid.xtype == "ramcoexpgrid") {
			view.expGridStore = grid.store;
			grid.lastEventType = taskType;
		}
        if ((showWindow == 'true' || showWindow == true) && Ext.isEmpty(popupSection)) {
            taskType = 'modal';
        }
		//TECH-38228		
		if (Ext.isEmpty(showWindow) && Ext.isEmpty(popupSection)) {
			popupSection = view.popupSec ? view.popupSec[task ? task.toLowerCase():''] : null;	
		}
        if (!task)
            return;
        childWidth = parseInt(childWidth, 10);
        childHeight = parseInt(childHeight, 10);
        var wizardDetails = '',
            wizBtnArray,
			column = null;
		if (typeof grid.getColumnById == "function")
			column = grid.getColumnById('v' + viewId);
		if (column && column.smartViewLink) {
			RamcoRTC.hasSmartViewLink = true;
			RamcoRTC.smartViewLnkCtrl = column;
			taskType = "smartviewlink";
		}	
		if (column && column.smartViewSec) {
			RamcoRTC.hasSmartViewSec = true;
			RamcoRTC.smartViewSecCtrl = grid.currentCell;
			taskType = "smartviewsec";
		}	
        if (grid.xtype == 'ramcodataview') {
            dataCtrl = grid.up('horizontalview') || grid.up('verticalview');
            if (dataCtrl) {
                select = dataCtrl.bind['select'],
                    ctrlId = select ? select.stub.path.replace('.value', '') : '';
                gridId = dataCtrl.itemId;
                dataCtrl.store.cr = record.get('rn');
                if (ctrlId)
                    view.setControlData(ctrlId, ctrlId, 0, dataCtrl.store.cr.toString());
            }
        }
        /* BLOCK OF STATEMENT NEED TO BE MOVED TO CALLOUT JS */
        else if (view.activeTabName == "wizard1" && grid.xtype == "ramcogrid" && record.data != null) {
            /* POPULATING VALUES FROM WIZARD GRID TO OTHER GRID */
            if (grid.itemId == "mlwizardml" || grid.itemId == "mlwizardstepml") {

                if (grid.itemId == "mlwizardstepml" && task == "tskstdwizardlink" && record.data["v4"] != "SYS") {
                    var _ctrl = view.down('#mlwizardml'),
                        _dataStore,
                        _record;

                    _dataStore = _ctrl.getStore();
					if (Ext.isEmpty(_dataStore.cr))
						_dataStore.cr = 2;
					if (_dataStore.cr) {
                    _record = _dataStore.getAt(_dataStore.cr - 1);

                    if (_record.data["v11"] == "0")
                        _record = _dataStore.getAt(_dataStore.cr);

                    record = _record;
                }
                }

                if (record.data["v11"] == 0)
                    return;

                view.setControlData('txtnew_wizardname', 'txtnew_wizardname', 0, record.data["v1"]);
                view.setControlData('txtnew_wizarddesc', 'txtnew_wizarddesc', 0, record.data["v2"]);

                /* TRAVERSING FROM WIZARD TO A UI */
                if (task == "ezwmainscwizadelk") {
                    var _data = record.data["v5"],
                        _dataEx;

                    _dataEx = _data.split("::#::");
                    wizardDetails = 'segnm:' + RamcoRTC.segmentName + ',sno:' + _dataEx[1] + ',wn:' + record.data["v1"] + ',sc:ezwizard,sa:ezwizard,' +
                        'si:ezwizard,tc:' + _dataEx[4] + ',ta:' + _dataEx[2] + ',ti:' + _dataEx[5] + ',lnkt:' + _dataEx[6] + ',psno:1,' +
                        'actntype:linktask,actcmp:ezwizard';

                    var _array = _data.split('~~#~~'),
                        __array,
                        colArray,
                        dataArray,
                        wizBtnArray = new Array(_array.length);

                    for (i = 0; i < _array.length; i++) {
                        __array = _array[i];
                        colArray = __array.split('::#::');
                        dataArray = {
                            lc: colArray[4],
                            la: colArray[2],
                            li: colArray[5],
                            wd: colArray[3],
                            lnkt: colArray[6],
                            lauth: colArray[7]
                        };
						
						// TECH-28395
						if (colArray.length > 8)
							dataArray.isedk = colArray[8];
						
                        wizBtnArray[i] = dataArray;
                    }

                    wizBtnArray["record"] = record;
                } else if (task == "tskstdwizardlink") {
					
					/* TECH-33610 / PTPH-22 - User Wizard Creation and Navigation */					
                    var _data = record.data["v5"],
                        _dataEx,
						gridRowData,
						_rowNo;
					
					if ( grid.itemId == "mlwizardml" ) {
						_dataEx = _data.split("::#::");
						wizardDetails = 'segnm:' + RamcoRTC.segmentName + ',sno:' + _dataEx[1] + ',wn:' + record.data["v1"] + ',sc:ezwizard,sa:ezwizard,' +
                        'si:ezwizard,tc:' + _dataEx[4] + ',ta:' + _dataEx[2] + ',ti:' + _dataEx[5] + ',lnkt:' + _dataEx[6] + ',psno:1,' +
                        'actntype:linktask,actcmp:ezwizard';
					}
					else if ( grid.itemId == "mlwizardstepml" ) {
						gridRowData = _data.split('~~#~~');
						_rowNo = grid.store.cr - 1;
						_dataEx = gridRowData[_rowNo].split("::#::");
						_rowNo = 1;
						wizardDetails = 'segnm:' + RamcoRTC.segmentName + ',sno:' + _dataEx[_rowNo] + ',wn:' + record.data["v1"] + ',sc:ezwizard,sa:ezwizard,' +
							'si:ezwizard,tc:' + _dataEx[_rowNo + 3] + ',ta:' + _dataEx[_rowNo + 1] + ',ti:' + _dataEx[_rowNo + 4] + ',lnkt:' + _dataEx[_rowNo + 5] + ',psno:1,' +
							'actntype:linktask,actcmp:ezwizard';
					}

                    var _array = _data.split('~~#~~'),
                        __array,
                        colArray,
                        dataArray,
                        wizBtnArray = new Array(_array.length);

                    for (i = 0; i < _array.length; i++) {
                        __array = _array[i];
                        colArray = __array.split('::#::');
                        dataArray = {
                            lc: colArray[4],
                            la: colArray[2],
                            li: colArray[5],
                            wd: colArray[3],
                            lnkt: colArray[6],
                            lauth: colArray[7]
                        };
						// TECH-28395
						if (colArray.length > 8)
							dataArray.isedk = colArray[8];
						if (grid.itemId == 'mlwizardml' && i == 0)
							dataArray.act = 1;
						else if(grid.itemId == 'mlwizardstepml') {
							if ((grid.store.cr-1) == i)
								dataArray.act = 1;
						}
						wizBtnArray[i] = dataArray;
                    }

                    wizBtnArray["record"] = record;
                }
            }
        }
		// TECH-38989 / APSH-350
		/* if (view.ilboConfig.ilboName == 'ezwizard')
        	data = viewModel.getSessionData(); */
        me.taskPending = true;
        if ((showWindow == 'true' || showWindow == true) && Ext.isEmpty(popupSection) && !RamcoRTC.hasSmartViewLink)
            taskType = 'modal';
        if (callout && callout.indexOf('#*#') != -1) {
            calloutArr = callout.split('#*#');
            calloutSec = calloutArr[0];
            popupClose = (calloutArr[1].toLowerCase() == 'y') ? true : false;
            view.popupClose = popupClose;
        } else if (callout) {
            view.coSecName = callout;
            view.coCtrlName = callout;
            view.coView = record;
        }
        if (view.ddt && view.ddt['task'] && view.ddt['task'][task]) {
            ddtObj = view.ddt['task'][task];
            ddtCtrl = ddtObj.ctrl;
            ddtView = ddtObj.view;
            if (ddtCtrl == ddtView) {
                /*srcCtrl = view.down('#' + ddtCtrl);
                if (srcCtrl) {
                    ddtValue = srcCtrl.getValue();
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                }*/
                ddtValue = view.getControlData(ddtCtrl);
                if (!Ext.isEmpty(ddtValue))
                    ddtValue = ddtValue.toLowerCase();
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            } else {
                srcCtrl = view.down('#' + ddtCtrl);
                if (srcCtrl) {
                    ddtValue = record.get('v' + ddtView);
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                }
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            }
        }
        if (ddtTask)
            task = ddtTask;
		//TECH-35056
		if (column && !Ext.isEmpty(column.metaLink)) {
			task = "tskstdextendedlaunch";
			taskType = "tskstdextendedlaunch";			
			metaViewName = column.metaLink;
			grid.store.isDynamic = true;
		}
        if (showWindow || !Ext.isEmpty(popupSection))
            view.fireEvent('uimltask', view, data, task, taskType, gridId, viewId || '1', 0, 0, 0, childWidth, childHeight, showWindow, popupSection);
        else {
            if (view.ilboConfig.tabName == 'myinbox' && task == 'ezwmainscdelet1ui') {
                Ext.RamcoMsg.confirm(rvw_resources.R253, rvw_resources.R254, function(btnId, controller) {
                    if (btnId == "ok" || btnId == "yes") {
                        view.fireEvent('mltrans', view, data, task, taskType, gridId, '1', 0, 0);
                    } else {
                        /* REMOVE SELECTION -  */
                        var grid = view.down('grid'),
                            store = grid.getStore(),
                            rec = store.findRecord('sel', true),
                            controller = view.getController();

                        while (rec) {
                            rec.set('sel', false);
                            rec = store.findRecord('sel', true);
                        }
                        if (controller)
                            controller.taskPending = false;
                    }
                });
            } else {
                if (view.activeTabName == "wizard1" && grid.xtype == "ramcogrid" && (task == 'ezwmainscwizadelk' || task == 'tskstdwizardlink') && wizBtnArray)
                    view.fireEvent('wizardmltrans', view, data, task, taskType, gridId, '1', 0, 0, wizardDetails, wizBtnArray);
                else {
					//viewModel.setModified(grid.itemId);
					//if (data && data.length == 0)
					//	data = viewModel.getSessionData();
					//TECH-35056
                    //view.fireEvent('mltrans', view, data, task, taskType, gridId, viewId || '1', 0, 0);
					view.fireEvent('mltrans', view, data, task, taskType, gridId, viewId || '1', 0, '', '', metaViewName);
            	}
        	}
        }
    },
    onGridLinkClick: function(grid, record, task, taskType, row, controlName, activityName, ilboName, tabName, viewName, quickLinkDesc, childWidth, childHeight, showWindow, eventDtls, isReport, isFromSP, delay, extLinkType) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            dataCtrl = null,
            select = '',
            ddtObj = null,
            ddtTask = null,
            ddtCtrl = null,
            ddtView = null,
            ddtValue = null,
            gridId = grid.itemId;
		if(grid.xtype == "ramcoddtgrid") 
			gridId = grid.parentId;			
        if (!task)
            return;
        if (taskType == 'browsedownload') {
            var me = this,
                val = me.getDBFileUrl(data.dbFileUrl.value, data.dbFileUrl.st);
            if (val)
                openWindow(val);
            return;
        } else if (taskType == 'new') {
            openWindow(task);
        }
        childWidth = parseInt(childWidth, 10);
        childHeight = parseInt(childHeight, 10);
        // TECH-36008
        var store = grid.getStore(),
            rec = store.findRecord('sel', true);
        while (rec) {
			if (grid.xtype == 'ramcodataview') 
				rec.data.sel = false;
			else
            rec.set('sel', false);
            rec = store.findRecord('sel', true);
        }
        record.set('sel', true);
        var wizardDetails = '',
            wizBtnArray;
        if (grid.xtype == 'ramcodataview') {
            dataCtrl = grid.up('horizontalview') || grid.up('verticalview');
            if (dataCtrl) {
                select = dataCtrl.bind['select'],
                    ctrlId = select ? select.stub.path.replace('.value', '') : '';
                gridId = dataCtrl.itemId;
                dataCtrl.store.cr = record.get('rn');
                if (ctrlId)
                    view.setControlData(ctrlId, ctrlId, 0, dataCtrl.store.cr.toString());
            }
        }
        /* BLOCK OF STATEMENT NEED TO BE MOVED TO CALLOUT JS */
        else if (view.activeTabName == "wizard1" && grid.xtype == "ramcogrid" && record.data != null) {
            /* POPULATING VALUES FROM WIZARD GRID TO OTHER GRID */
            if (grid.itemId == "mlwizardml" || grid.itemId == "mlwizardstepml") {

                if (grid.itemId == "mlwizardstepml" && task == "tskstdwizardlink" && record.data["v4"] != "SYS") {
                    var _ctrl = view.down('#mlwizardml'),
                        _dataStore,
                        _record;

                    _dataStore = _ctrl.getStore();
                    _record = _dataStore.getAt(_dataStore.cr - 1);

                    if (_record.data["v11"] == "0")
                        _record = _dataStore.getAt(_dataStore.cr);

                    record = _record;
                }

                if (record.data["v11"] == 0)
                    return;

                view.setControlData('txtnew_wizardname', 'txtnew_wizardname', 0, record.data["v1"]);
                view.setControlData('txtnew_wizarddesc', 'txtnew_wizarddesc', 0, record.data["v2"]);

                /* TRAVERSING FROM WIZARD TO A UI */
                if (task == "tskstdwizardlink") {
                    var _data = record.data["v5"],
                        _dataEx;

                    _dataEx = _data.split("::#::");
                    wizardDetails = 'segnm:' + RamcoRTC.segmentName + ',sno:' + _dataEx[1] + ',wn:' + record.data["v1"] + ',sc:ezwizard,sa:ezwizard,' +
                        'si:ezwizard,tc:' + _dataEx[4] + ',ta:' + _dataEx[2] + ',ti:' + _dataEx[5] + ',lnkt:' + _dataEx[6] + ',psno:1,' +
                        'actntype:linktask,actcmp:ezwizard';

                    var _array = _data.split('~~#~~'),
                        __array,
                        colArray,
                        dataArray,
                        wizBtnArray = new Array(_array.length);

                    for (i = 0; i < _array.length; i++) {
                        __array = _array[i];
                        colArray = __array.split('::#::');
                        dataArray = {
                            lc: colArray[4],
                            la: colArray[2],
                            li: colArray[5],
                            wd: colArray[3],
                            lnkt: colArray[6],
                            lauth: colArray[7]
                        };
                        wizBtnArray[i] = dataArray;
                    }

                    wizBtnArray["record"] = record;
                }
            }
        }
        // TECH-36008
        //data = viewModel.getSessionData();
        me.taskPending = true;
        if (showWindow)
            taskType = 'modal';
        if (view.ddt && view.ddt['task'] && view.ddt['task'][task]) {
            ddtObj = view.ddt['task'][task];
            ddtCtrl = ddtObj.ctrl;
            ddtView = ddtObj.view;
            if (ddtCtrl == ddtView) {
                /*srcCtrl = view.down('#' + ddtCtrl);
                if (srcCtrl) {
                    ddtValue = srcCtrl.getValue();
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                }*/
                ddtValue = view.getControlData(ddtCtrl);
                if (!Ext.isEmpty(ddtValue))
                    ddtValue = ddtValue.toLowerCase();
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            } else {
                srcCtrl = view.down('#' + ddtCtrl);
                if (srcCtrl) {
                    ddtValue = record.get('v' + ddtView);
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                }
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            }
        }
        if (ddtTask)
            task = ddtTask;
        if (showWindow)
            //view.fireEvent('uimltask', view, data, task, taskType, gridId, '1', 0, 0, 0, childWidth, childHeight);
			view.fireEvent('uimltask', view, data, task, taskType, gridId, '1', 0, 0, 0, childWidth, childHeight, showWindow);
        else {
            if (view.activeTabName == "wizard1" && grid.xtype == "ramcogrid" && task == 'tskstdwizardlink' && wizBtnArray)
                view.fireEvent('wizardmltrans', view, data, task, taskType, gridId, '1', 0, 0, wizardDetails, wizBtnArray);
            else
                view.fireEvent('mltrans', view, data, task, taskType, gridId, '1', 0, 0);
        }
    },
	//TECH-36970
    onShowGridZoom: function(grid, record, index) {
        var me = this,
            view = me.getView(),
            config = view.getCurrentConfig(),
			viewY = view.el ?view.el.getY():0,//AHBG-31996
			gridSize =grid.getSize(),
			preZoom = null,//AHBG-31996
			width = Math.ceil(gridSize.width * 0.2),
            zoomWindow = null;
        if (config && config.ilboConfig.ilboType != '6' || RamcoRTC.settings.isExt2) {
            zoomWindow = new Ext.ramco.GridZoom({
               /*  minHeight: 400,
                minWidth: 800, //TECH-37397
				width: gridSize.width - width,
				height: grid.getHeight(), //TECH-28198*/ //QA-255
                scrollable: true,
                hidden: true,
                modal: true,
				floating:true
            });
			 preZoom = view.down('[xtype=uigridzoom]');//AHBG-31996
			if(!Ext.isEmpty(preZoom))
				preZoom.destroy();
			view.add(zoomWindow);
            grid.zoomWindow = zoomWindow;
			//grid.zoomWindow.index = index;
			grid.zoomWindow.index = record.get('rn');
			// TECH-29395
            // zoomWindow.createControls(grid, index, record);
			if(RamcoRTC.settings.isExt2 === true && RamcoRTC.settings.isInplaceZoom){
				zoomWindow.setWidth(gridSize.width - width);
				zoomWindow.setHeight(grid.getHeight());
				zoomWindow.showAt(grid.getX()+width,grid.getY()-(viewY+5));//AHBG-31996
			}
			else{
				zoomWindow.setMinHeight(400);
				zoomWindow.setMinWidth(800);
				zoomWindow.setMaxHeight(view.getHeight() - 20);
            zoomWindow.show();
			}
			zoomWindow.createControls(grid, index, record);
			if(!RamcoRTC.settings.isExt2 || (RamcoRTC.settings.isExt2 && !RamcoRTC.settings.isInplaceZoom))
					zoomWindow.center();
			// TECH-28873
			var count = zoomWindow.query('field[editable][itemId!="rowNav"][itemId!="fieldList"][itemId!="fieldSearch"]');
			if(count && count[1])
				count[1].focus();
        }
    },
    onGridSelectAll: function(grid, column, state, callBack) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.getItemId(),
            store = grid.getStore(),
            count = store.getCount(),
            i = 0,
            rec = null,
            view = me.getView(),
            viewModel = me.getViewModel(),
            viewname = column ? column.dataIndex.replace('v', '') : 'sel',
            data = [],
            task = state ? 'tskstdselectall' : 'tskstdunselectall',
            taskType = 'rvwstandardtask',
            gridSelRow;
        if (viewname != 'sel') {
            task = state ? 'tskstdchkall' : 'tskstdunchkall';
            store.changed = true;
			store.task = task;
        } else {
            for (; i < count; i++) {
                rec = store.getAt(i);
                if (rec.get('isNew'))
                    continue;
                rec.set('sel', state.toString());
            }
        }
        store.nsr = (state == true) ? store.tr : 0

        gridSelRow = me.view.down('#gridSelRow');
        if (gridSelRow)
            gridSelRow.setValue(store.nsr + " Selected");
        //data = viewModel.getSessionData();
		RamcoRTC.focusCtrl[1] = gridId || null;
        RamcoRTC.focusCtrl[2] = grid.vsi || null;
		RamcoRTC.focusCtrl[3] = null;
        RamcoRTC.focusCtrl[4] = null;
        me.taskPending = true;
        view.fireEvent('gridtool', view, data, task, taskType, gridId, null, null, viewname);
        view.callBack = callBack;
    },
	//TECH-35056
	onGetMultiFiles: function(ctrl, e, newValue) {
		if (this.taskPending)
            return;
		var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
			file = [],			
			grid,
			promiseFile = [];
		
		grid = ctrl.ownerCt.ownerCt;
		grid.store.tr = grid.store.tr || 0;		
		
		if (ctrl && ctrl.multiple) {
			file = ctrl.getMultiFile();
		}
		
		e.stopPropagation();
        e.preventDefault();
		
		grid.processFiles(file);
		
		ctrl.reset(true);
	},
	//TECH-35056
	onMultifileUpload: function(ctrl, e, newValue) {		
		if (this.taskPending || Ext.isEmpty(ctrl.uploadFile))
            return;
		var me = this,
			view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            files = null,
			file = null,
            formData = null,
            saveToDb = null,
            task = ctrl.task,
            taskType = ctrl.taskType,
			fileSize, errorText,
			grid = ctrl.ownerCt.ownerCt,
			promiseUpload = [];
		
		ctrl.srcCtrl = grid.itemId;	
		
		if (ctrl && ctrl.uploadFile) {
            srcCtrl = view.down('#' + ctrl.srcCtrl);			
            if (srcCtrl) {
                //saveToDb = srcCtrl.getSaveToDb();
				var srcColumn = srcCtrl.columns[2];
                files = grid.store.data.items;
                if (files.length > 0) {
					for(var l=0; l < files.length; l++) {
						file = files[l].data.file;
						if (file) {
							fileSize = file.size;
							if (!Ext.isEmpty(fileSize)) {
								if (fileSize == 0) {
									errorText = Ext.String.format(rvw_resources.R261, fileSize);
									me.taskPending = false;
									Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
									return false;
								}
								else if ( fileSize > (RamcoRTC.settings.fileUploadMaxSize || 2) * BYTES_PER_CHUNK ) {				
									errorText = Ext.String.format(rvw_resources.R262, (RamcoRTC.settings.fileUploadMaxSize || 2));
									Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
									me.taskPending = false;
									return false;
								}
							}
							data = viewModel.getSessionData();
							formData = new FormData();
							formData.srcPath = srcColumn.srcPath;
							formData.assView = srcColumn.assView;
							formData.saveToDb = srcColumn.saveToDb;
							formData.controlName = srcCtrl.itemId;
							formData.controlViewName = srcColumn.itemId;
							//formData.autoFileName = srcCtrl.getAutoFileName();
							formData.hdnFileId = srcColumn.hdnFileId;
							formData.controlRowNo = (l + 1) || 0;
							formData.append('file', file);
							formData.file = file;
							//ctrl.reset(true);
							promiseUpload.push(me.onMultiUploadFile(ctrl, formData, data, ctrl, srcCtrl));
							//me.onMultiUploadFile(ctrl, formData, data, ctrl, srcCtrl);
						}
					}
					Promise.all(promiseUpload);
					return true;
                }								 
            }
        }        	
	},	
    onAttach: function(ctrl, e, newValue) {
        if (this.taskPending || ctrl.xtype != 'ramcofilebrowse')
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            srcCtrl = null,
            file = null,
            formData = null,
            saveToDb = null,
            task = ctrl.task,
            taskType = ctrl.taskType,
			fileSize, errorText, maxFileSize; // TECH-34521
		
		// TECH-34521
		maxFileSize = (!Ext.isEmpty(me.maxFileSize)) ? me.maxFileSize : (RamcoRTC.settings.fileUploadMaxSize || 2);
        if (ctrl && ctrl.uploadFile) {
            srcCtrl = view.down('#' + ctrl.srcCtrl);
            if (srcCtrl) {
                saveToDb = srcCtrl.getSaveToDb();
                file = ctrl.getFile();
                if (file) {
					fileSize = file.size;
					if (!Ext.isEmpty(fileSize)) {
						if (fileSize == 0) {
							errorText = Ext.String.format(rvw_resources.R261, fileSize);
							me.taskPending = false;
							Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
							return false;
						}
						// TECH-34521
						else if ( fileSize > maxFileSize * BYTES_PER_CHUNK ) {
							errorText = Ext.String.format(rvw_resources.R262, maxFileSize);
							Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
							me.taskPending = false;
							return false;
						}
					}
                    data = viewModel.getSessionData();
                    formData = new FormData();
                    formData.srcPath = srcCtrl.srcPath;
                    formData.assView = srcCtrl.assView;
                    formData.saveToDb = srcCtrl.saveToDb;
                    formData.controlName = srcCtrl.itemId;
                    formData.controlViewName = srcCtrl.itemId;
					formData.autoFileName = srcCtrl.getAutoFileName();
					formData.hdnFileId = srcCtrl.getHdnFileId();
                    formData.controlRowNo = ctrl.rowIndex + 1 || 0;
                    formData.append('file', file);
                    formData.file = file;
					ctrl.reset(true);
                    me.onUploadFile(ctrl, formData, data, ctrl, srcCtrl);
                    return true;
                }
            }
        }
        if (task) {
            data = viewModel.getSessionData();
            me.taskPending = true;
            view.fireEvent('trans', view, data, task, taskType);
        }
    },
    onFileAttach: function(browseCtrl, srcCtrl, ctrl, viewModel) {
        var me = this,
            formData = null,
            data = null,
            file = browseCtrl.getFile();
        if (file) {
            data = viewModel.getSessionData();
            formData = new FormData();
            formData.srcPath = srcCtrl.srcPath;
            formData.controlName = srcCtrl.itemId;
            formData.controlViewName = srcCtrl.itemId;
			formData.hdnFileId = srcCtrl.getHdnFileId();		
			formData.autoFileName = srcCtrl.getAutoFileName();
            formData.controlRowNo = 0;
            formData.append('file', file);
            formData.file = file;
            me.onUploadFile(ctrl, formData, data, ctrl)
            return true;
        }
        return false;
    },
    onFileDelete: function(srcCtrl, ctrl) {
        var me = this,
			assView = srcCtrl.assView,
            dView = srcCtrl.dView,
            srcPath = srcCtrl.srcPath;
        if (ctrl.task)
            me.deleteCtrl = ctrl;
		me.taskPending = false;
        me.onDeleteFile(srcCtrl, null, 0, srcPath, assView, dView);
        return true;
    },
	onOProtoBtnClick:function(ctrl, e, task, taskType, view) {
		if (this.taskPending || ctrl.xtype == 'ramcofilebrowse')
            return;
		this.taskPending = true;
        RamcoLog.start('Client Trans','click');
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = {},
			uname = '',
			pwd = '',
			customer = '',
			project = '',
			request = '';
		if (ctrl) {
			uname = view.down('#ide_username').value;
			pwd = view.down('#ide_password').value;
			customer = view.down('#ide_customer').value;
			project = view.down('#ide_project').value;
			request = view.down('#ide_request').value;
			taskType = ctrl.taskType;
		}			
		RamcoRTC.uname = data.uname = uname;
		data.pwd = pwd;
		RamcoRTC.customer = data.customer = customer;
		RamcoRTC.project = data.project = project;
		RamcoRTC.request = data.request = request;
		view.fireEvent('oprototrans', view, data, task, taskType);
	},
    onClick: function(ctrl, e, task, taskType, view, width, height, isModal, popup, itemId) {
        if (this.taskPending || ctrl.xtype == 'ramcofilebrowse'|| (ctrl.xtype == 'datahyperlink' && Ext.isEmpty(ctrl.getValue())))
            return;
		this.taskPending = true;
        RamcoLog.start('Client Trans','click');
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            srcCtrl = null,
            browseCtrl = null,
            file = null,
            formData = null,
            ddtObj = null,
            ddtTask = null,
            ddtCtrl = null,
            ddtView = null,
            ddtValue = null,
            popupClose = ctrl.popupClose,
            controller = view.getController(),
            modalClose = ctrl.modalClose,
            childWidth = ctrl.childWidth,
            childHeight = ctrl.childHeight,
            task = ctrl.task || task,
            taskType = ctrl.taskType || taskType,
            modal = ctrl.isModal || isModal,
            hasTaskInfo = false;
		if (ctrl.smartViewLink) {
			RamcoRTC.hasSmartViewLink = true;
			RamcoRTC.smartViewLnkCtrl = ctrl;
		}
		if (ctrl && ctrl.smartViewSec) {
			RamcoRTC.hasSmartViewSec = true;
			RamcoRTC.smartViewSecCtrl = ctrl;			
		}
        if (ctrl && ctrl.srcCtrl) {
            srcCtrl = view.down('#' + ctrl.srcCtrl);
            browseCtrl = view.down('#' + ctrl.browseCtrl);
            if (srcCtrl && browseCtrl) {
                if (me.onFileAttach(browseCtrl, srcCtrl, ctrl, viewModel))
                    return true;

            } else if (srcCtrl) {
                if (me.onFileDelete(srcCtrl, ctrl))
                    return true;
            }
        }
        ctrl = ctrl || {};
        //data = viewModel.getSessionData();
        view.coSecName = itemId;
        view.coCtrlName = ctrl.itemId;
        view.isCancel = ctrl.isCancel;
        if (e && e.type == 'click') {			
            var el = Ext.fly(e.target),
                elup,
                div = el ? el.down('div') : null,
                attributes = el ? el.getAttributes() : {},
                newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
                taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
                linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
                args = [];
            if (!taskInfo && el) {
                elup = el.up('div[taskinfo]') || el.down('div[taskinfo]');
                taskInfo = elup ? elup.getAttribute('taskinfo') : null;
            }
            if (!linkInfo && el) {
                elup = el.up('div[linkinfo]') || el.down('div[linkinfo]');
                linkInfo = elup ? elup.getAttribute('linkinfo') : null;
            }
            if (!newWindow && el) {
                elup = el.up('div[opennewwindow]') || el.down('div[opennewwindow]');
                newWindow = elup ? elup.getAttribute('opennewwindow') || 'about:blank' : null;
            }
            if (!newWindow)
                newWindow = ctrl.href;
			// TECH-28395
			if (task == 'tskstdlaunch' && (taskType == 'favlink' || taskType == 'menumaplink')) {
				var activity;
				view.tmpConfig = {};
				if (view.ilboConfig) {
					view.tmpConfig.activityDesc = '';
					view.tmpConfig.activityName = ctrl.activity;
					view.tmpConfig.componentName = ctrl.comp;
					view.tmpConfig.ilboName = ctrl.ilbo;
					view.tmpConfig.tabName = '';
					view.tmpConfig.ilboType = '';
					activity = getActivityfromBPC(RamcoRTC.menu, ctrl.activity);
					if (!Ext.isEmpty(activity)) {
						view.tmpConfig.isEdk = activity.isedk ? activity.edk : '';
					}
				}
				
				view.fireEvent('uilaunch', view, 'wizard');
				return true;
			}
            if (taskInfo) {
                args = ['uitask', view, data];
                args = args.concat(TaskInfoToObjectArray(taskInfo));
                while (args.length < 10) {
                    args[args.length] = null;
                }
                if (modal) {
                    args[4] = 'modal';
                    if (!args[6]) {
                        args[6] = childWidth;
                        args[7] = childHeight;
                    }
                    args[8] = true;
                }
                view.fireEvent.apply(view, args);
                return true;
            } else if (linkInfo) {
                args = ['linktask', view, data];
                args = args.concat(LinkInfoToObjectArray(linkInfo));
                view.fireEvent.apply(view, args);
                return true;
            } else if (newWindow) {
				me.taskPending = false;
                openNewWindow(newWindow);
                return true;
            }
        }
		//AHBG-27567
		if (ctrl.avnFileDownload) {
			var avnDownloadCallBack = function() {
				eventName = ctrl.task;
				fileUrl = view ? view.avnFileDownloadUrl : '';
				src = Ext.String.format(fileUrl, '', '', '', false, '', '', eventName, RamcoRTC.sessionToken);
				window.open(src, "AvnFileDownlodwindow","height=350,left=200,menubar=no,location=no,resizable=no,scrollbars=no,status=yes,top = 50, width=500");
				view.taskPending = false;
				view.avnFileDownload = true;
			};
			view.callBack = avnDownloadCallBack.bind(me);
			view.fireEvent('trans', view, [], 'tskdummy', 'trans');
		}
		else if (task) {
            me.taskPending = true;
            view.popupClose = popupClose;
            view.modalClose = modalClose;
            if (modal)
                taskType = 'modal';
            if (view.ddt && view.ddt['task'] && view.ddt['task'][task]) {
                ddtObj = view.ddt['task'][task];
                ddtCtrl = ddtObj.ctrl;
                ddtView = ddtObj.view;
                if (ddtCtrl == ddtView) {
                    /*srcCtrl = view.down('#' + ddtCtrl);
                    if (srcCtrl) {
                        ddtValue = srcCtrl.getValue();
                        if (!Ext.isEmpty(ddtValue))
                            ddtValue = ddtValue.toLowerCase();
                    }*/
                    ddtValue = view.getControlData(ddtCtrl);
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                    if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                        ddtTask = view.ddt['value'][ddtValue].task;
                    }
                }
            }
            if (ddtTask)
                task = ddtTask;
			//TECH-30054
			if((ctrl.xtype == "button" || ctrl.xtype == "link") && RamcoRTC.focusCtrl.length > 0) {
				RamcoRTC.lastFocusCtrl[1] = ctrl.getItemId();
				RamcoRTC.focusCtrl[1] = RamcoRTC.lastFocusCtrl[1];
				RamcoRTC.focusCtrl[2] = 0;
				RamcoRTC.focusCtrl[3] = 0;
			}
			ctrl.focus();
			//TECH-35056
			if (ctrl && !Ext.isEmpty(ctrl.metaLink)) {
				task = "tskstdextendedlaunch";
				taskType = "tskstdextendedlaunch";
				viewModel.setModified(ctrl.itemId);
			}
			//Ext.defer(function(){view.fireEvent('trans', view, data, task, taskType, '', '', '', childWidth, childHeight)},100);
			Ext.defer(function(){view.fireEvent('trans', view, data, task, taskType, '', '', '', childWidth, childHeight, '', '', '',ctrl.metaLink)},100);
        }
		else
			this.taskPending = false;
    },
	onPersMouseover :function(btn,e){//TECH-37397 /KNB-298
		var me = this,
			view = me.getView(),
			ctrlId = btn.ctrlId,
			ctrlObj;
		
		ctrlObj = view.down('#' + ctrlId);
		if(ctrlObj &&  ctrlObj.addCls)
			ctrlObj.addCls('x-pers-border');
	},
	onPersMouseout :function(btn,e){//TECH-37397 /KNB-298
		var me = this,
			view = me.getView(),
			ctrlId = btn.ctrlId,
			ctrlObj;
		ctrlObj = view.down('#' + ctrlId);
		if(ctrlObj && ctrlObj.removeCls)
			ctrlObj.removeCls('x-pers-border');
	},
    onPersonalization: function(btn, e) {
        var me = this,
            view = me.getView(),
            ctrlObj = null,
            lblObj = null,
            cType = btn.cType,
            persWindow = null,
            perMenu = null,
            textVal = null,
            rolebtn = null,
            btnArr = null,
            tskbtn,
            allTask,
            allRole,
            btnMenu, btnVal,

            data = view.persData || [],
            ctrlId = btn.ctrlId;
        ctrlObj = view.down('#' + ctrlId);
		//HSI-191
		//if(cType != 'task' && cType != 'panel' && cType != 'radio' && cType != 'label')
		// TECH-27833 / AHBG-25788
		if(cType != 'task' && cType != 'panel')
			lblObj = view.down('#lbl' + ctrlId);
		else
			lblObj = view.down('#'+ctrlId);
		
        if (ctrlObj) {
            switch (cType) {
                case 'panel':
                    persWindow = view.getCtrlWindow();
                    if (!persWindow) {
                        persWindow = Ext.create('Ext.ramco.CtrlPers', {
                            ctrlId: ctrlId
                        });
                        view.getCtrlWindow(persWindow);
                    } else {
                        persWindow.ctrlId = ctrlId;
                        view.setCtrlWindow(persWindow);
                    }
                    if (data.data && data.data[ctrlId])
                        persWindow.processData(ctrlObj, data.data[ctrlId], lblObj, cType);
                    else
                        persWindow.processData(ctrlObj, null, lblObj, cType);
                    persWindow.show();
                    break;
                case 'text':
                case 'combo':
                case 'date':
				case 'radio'://TECH-29763/TAQ-121
                    persWindow = view.getCtrlWindow();
                    if (!persWindow) {
                        persWindow = Ext.create('Ext.ramco.CtrlPers', {
                            ctrlId: ctrlId
                        });
                        view.setCtrlWindow(persWindow);
                    } else {
                        persWindow.ctrlId = ctrlId;
                        view.setCtrlWindow(persWindow);
                    }
                    if (data.data && data.data[ctrlId])
                        persWindow.processData(ctrlObj, data.data[ctrlId], lblObj, cType);
                    else
                        persWindow.processData(ctrlObj, null, lblObj, cType);
                    btnArr = view.query('button[taskType=trans],button[taskType=report]');
                    btnMenu = Ext.create('Ext.menu.Menu', {
                        itemId: 'taskMenu',
                        maxHeight: 200
                    });
                    if (btnArr && btnArr.length > 0) {
                        tskbtn = persWindow.down('#taskbtn');
                        btnArr.unshift({
                            text: 'ALL Tasks',
							itemId: 'alltasks',//TECH-29763/TAQ-121
                            task: 'alltasks'
                        });
                        for (i = 0; i < btnArr.length; i++) {
                            btnVal = {
                                text: btnArr[i].text,
                                xtype: 'menucheckitem',
                                itemId: btnArr[i].task,
                                role: 'rolepers'
                            }
                            btnMenu.add(btnVal);
                        }
                        allTask = btnMenu.down('#' + btnArr[0].task);
                        allTask.setChecked(true);
                        tskbtn.setText('Selected Task(s)');
                        tskbtn.setMenu(btnMenu);
                    }
                    perMenu = Ext.create('Ext.menu.Menu', {
                        itemId: 'roleMenu',
                        maxHeight: 200
                    });
                    rolebtn = persWindow.down('#rolebtn');
                    view.persrole.unshift({
                        itemId: 'allroles',
                        role: 'rolepers',
                        text: 'ALL Roles',
                        xtype: 'menucheckitem'
                    });
                    perMenu.add(view.persrole);
                    allRole = perMenu.down('#' + view.persrole[0].itemId);
                    allRole.setChecked(true);
                    rolebtn.setText('Selected Role(s)');
                    rolebtn.setMenu(perMenu);

                    persWindow.show();
                    break;
                case 'task':
				//HSI-191
				case 'label':
				/* case 'radio': */
                    persWindow = view.getCtrlWindow();
                    if (!persWindow) {
                        persWindow = Ext.create('Ext.ramco.CtrlPers', {
                            ctrlId: ctrlId
                        });
                        view.setCtrlWindow(persWindow);
                    } else {
                        persWindow.ctrlId = ctrlId;
                        view.setCtrlWindow(persWindow);
                    }
                    if (data.data && data.data[ctrlId])
                        persWindow.processData(ctrlObj, data.data[ctrlId], lblObj, cType);
                    else
                        persWindow.processData(ctrlObj, null, lblObj, cType);
                    persWindow.show();
                    break;
				case 'segmentedbtn'://TECH-32503/CDIH-122
					persWindow = view.getCtrlWindow();
                    if (!persWindow) {
                        persWindow = Ext.create('Ext.ramco.CtrlPers', {
                            ctrlId: ctrlId
                        });
                        view.setCtrlWindow(persWindow);
                    } else {
                        persWindow.ctrlId = ctrlId;
                        view.setCtrlWindow(persWindow);
                    }
					if(ctrlObj.items && ctrlObj.items.items){
						var segStoreArr = [],btnValue,btnCombo,btnRename,btnRenameVal;
							btnCombo = persWindow.down('[xtype=combobox]');
							btnRename = persWindow.down('#rename');
					for(var h = 0 ; h < ctrlObj.items.items.length ; h++){
							 if(ctrlObj.items.items[h].pressed){
								btnValue  = ctrlObj.items.items[h].itemId;
								btnRenameVal = ctrlObj.items.items[h].text;
							}	
						segStoreArr.push({text:ctrlObj.items.items[h].text,value:ctrlObj.items.items[h].itemId});
					}
					
					btnCombo.store.setData(segStoreArr);
					}	
				    if (data.data && data.data[ctrlId])
                        persWindow.processData(ctrlObj, data.data[ctrlId], lblObj, cType);
                    else
                        persWindow.processData(ctrlObj, null, lblObj, cType);
					if(btnRename && !Ext.isEmpty(btnRenameVal))
						btnRename.setValue(btnRenameVal);
					if(btnCombo && !Ext.isEmpty(btnValue))
						btnCombo.setValue(btnValue);
			        persWindow.show();
					break;
                case 'tab':
                    persWindow = view.getTabWindow();
                    if (!persWindow) {
                        persWindow = Ext.create('Ext.ramco.TabPers', {});
                        view.setTabWindow(persWindow);
                    }
                    persWindow.show();
                    break;
            }
        }
    },
    onTemplatePersonalization: function(chk, e) {
        var me = this,
            view = me.getView(),
            ctrlObj = null,
            value = null,
            chkVal = chk.getValue(),
            data = null,
            ctrlId = chk.ctrlId;
        ctrlObj = view.down('#' + ctrlId);
        if (chkVal == true && (RamcoRTC.currentTemplate == '' || RamcoRTC.currentTemplate == 'new' || RamcoRTC.currentTemplate == 'default')) { // DefMode
            Ext.Msg.alert('', rvw_resources.R220, function() {
				chk.suspendEvents();
				chk.setValue(false); // DefMode
				chk.resumeEvents();
			}, undefined, 'error');
			return false;
        }
        if (ctrlObj) {
            if (!view.persData[RamcoRTC.currentTemplate]) {
                view.persData[RamcoRTC.currentTemplate] = {};
                data = view.persData[RamcoRTC.currentTemplate].data = {};
            } else
                data = view.persData[RamcoRTC.currentTemplate].data || {};

            if (chkVal == '1') {
                value = ctrlObj.getValue();
                if (data && data[ctrlId])
                    data[ctrlId].value = value;
                else {
                    if (!data)
                        data = {};
                    data[ctrlId] = {};
                    data[ctrlId].value = value;
                }
            } else {
                if (data && data[ctrlId])
                    delete data[ctrlId];
            }
            view.fireEvent('deftemplate', me, view.persData);
        }
    },
    onMenuItemClick: function(item, e, eOpts) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = ctrl.task,
            taskType = ctrl.taskType;
        //data = viewModel.getSessionData();
        me.taskPending = true;
        view.fireEvent('trans', view, data, task, taskType);
    },
	onRSTreeNodeDeleteRow: function(grid, targetTree, row, col) {
		if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstddelete',
            taskType = 'trans';
        //data = viewModel.getSessionData();
		data = [];
        me.taskPending = true;
		/*
		var deleteCallBack = function() {
			this.taskPending = true;
            view.fireEvent('gridtool', view, data, 'tskstdinsert', taskType, gridId);
            return;
		};
        view.callBack = deleteCallBack.bind(me);*/
        view.fireEvent('gridtool', view, data, task, taskType, targetTree);
		delete grid.store.selRows;
	},
    onRSTreeNodeExpand:function(grid,node,index,item){
		console.log('itemexpand');
		if (this.taskPending)
            return;
        var me = this,
            gridId = grid.getItemId(),
            view = me.getView(),			
            data = [];
        me.taskPending = true;
        view.fireEvent('movetorow', view, data, "tskstdmovetorow", 'rvwstandardtask', gridId, 1, 1, node.data.rn);
	},
    onInsertRow: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstdinsert',
            taskType = 'trans';
        //data = viewModel.getSessionData();
        me.taskPending = true;
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onDeleteRow: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstddelete',
            taskType = 'trans';
        //data = viewModel.getSessionData();
        me.taskPending = true;
		me.onCtrlFocus(gridId, 0, 0);
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onCutAppendRow: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstdcutappend',
            taskType = 'trans';
        //data = viewModel.getSessionData();
        me.taskPending = true;
		grid.gridCutCopyAppend = true; // TECH-37768
		me.onCtrlFocus(gridId, 0, 0);
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onCopyAppendRow: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstdcopyappend',
            taskType = 'trans';
        //data = viewModel.getSessionData();
        me.taskPending = true;
		grid.gridCutCopyAppend = true; // TECH-37768
		me.onCtrlFocus(gridId, 0, 0);
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onColumnDefault: function(grid) {
        var me = this,
            view = me.getView(),
            cmp = null,
            cols = null,
            winds = null,
            ctrlArr = {},
        viewModel = me.getViewModel();
        // TECH-40581
        //cols = grid.getColumns();
        cols = grid.getVisibleColumns();
		me.onCtrlFocus(grid.itemId, 0, 0);
        cmp = Ext.create('Ext.form.FieldContainer', {
		    height: '75%',
            width: '100%',
            region: 'north',
            itemId: 'columnDefault',
            layout: {
                type: 'table',
                columns: 4,
				tableAttrs: {
					style: {
						width: '100%',
						padding: '2px'
					}
				},
				tdAttrs: {
					style: {
						width: '25%'
					}
				}				
            }
        });		
        for (i = 0; cols && i < cols.length; i++) {
			// TECH-40581
			if (cols[i].stateEnabled == false || cols[i].isStateHidden == true)
				continue;
            ctrlArr = {};
            if (cols[i].editor && cols[i].isDefault) {
                ctrlArr.xtype = cols[i].editor.xtype;
                ctrlArr.dataIndex = cols[i].dataIndex;
                ctrlArr.itemId = cols[i].dataIndex;
				ctrlArrLabel = {};
				ctrlArrLabel.xtype = 'label';
				ctrlArrLabel.text = cols[i].text;
				cmp.add(ctrlArrLabel);
                ctrlArr.fieldLabel = cols[i].text;
				ctrlArr.hideLabel = true;
				ctrlArr.width = 122;
                switch (cols[i].editor.xtype) {
                    case 'combofield':
                        store = viewModel.getStore(cols[i].editor.bind.store.replace(/[{}]/g, ''));
                        ctrlArr.displayField = "text";
                        ctrlArr.valueField = "value";
                        ctrlArr.queryMode = "local";
                        ctrlArr.store = store;
                        break;
                    case 'datefield':
				        ctrlArr.format = RamcoRTC.userPreference.dateFormat;
                        break;
					case 'ramcodatetimefield':
				        ctrlArr.format = RamcoRTC.userPreference.dateTimeFormat;
                        break;
					case 'ramcotimefield':
				        ctrlArr.format = RamcoRTC.userPreference.timeFormat;
                        break;
					case 'ramcolistedit':
                        if(cols[i].dataType == "numeric"){
							ctrlArr.xtype = "numberfield";
							ctrlArr.format = cols[i].format;
							ctrlArr.maxLength = cols[i].maxLength - cols[i].format; 
						}else if(cols[i].dataType == "char"){
							ctrlArr.xtype = "textfield";
							ctrlArr.maxLength = cols[i].maxLength; 
						}
						break;
                }
                cmp.add(ctrlArr);
            }
        }
        winds = Ext.create('Ext.window.Window', {
            title: rvw_resources.R247,
            //height: grid.getColumns().length / 2 * 32,
			//AHBG-31793
			alwaysOnTop:true,
            width: '50%',
			modal:true,
            height: 300, // TECH-39926
			scrollable:false,
            itemId: 'columnDefaultWindow',
            items: [cmp,
			{
                xtype: 'checkbox',
                boxLabel: rvw_resources.R251,
				userCls: 'x-chkcurrent',
                itemId: 'chkcurrent',
                checked: true,
            },
            {
                xtype: 'fieldcontainer',
                itemId: 'radioVal',
                defaultType: 'radiofield',
                defaults: {
                    flex: 1
                },
                layout: 'hbox',
                items: [{
                    boxLabel: rvw_resources.R249,
                    name: 'size',
                    value: '1',
                    itemId: 'optonlyblank'
                }, {
                    boxLabel: rvw_resources.R250,
                    name: 'size',
                    itemId: 'optreplace'
                }]
            }],
            dockedItems: [{
                xtype: 'ramcopanel',
                bodyPadding: 5,
                dock: 'bottom',
                layout: 'hbox',
                items: [{
                    xtype: 'button',
                    margin: '0 0 0 180',
                    text: rvw_resources.R248,
                    handler: function(btn) {
                        var win = btn.up('window'),
							view = this.getView(),//TECH-33701
                            colChooser = win.down('#columnDefault').items,
                            i = 0,
							winItems = win.items,
                            id, col,
                            format = RamcoRTC.userPreference.dateFormat,
                            colItem = null,
                            colData = {},
							chkItem = winItems && winItems.items, // TECH-40530
                            data = [],
                            data = colData['data'] = {},
                            radioArr = win.queryById('radioVal'),
                            len = colChooser.length;
                        colData.data['optselectrows'] = true;
                        if(chkItem && chkItem.length > 1)
							colData.data[chkItem[1].getItemId()] = chkItem[1].getValue();
						else
						{
							console.log("error in colum Default");
							return;
						}
						grid.colClear = null;
                        for (i = 0; i < len; i++) {
							// TECH-40530
							var colType = colChooser.items[i],
								colTypeId, value;							
							if(colType && colType.xtype != 'label' && colType.xtype != 'panel' && colType.xtype != 'button') {
								colTypeId = colType.getItemId();
								value = colType.getValue();
								if (Ext.isEmpty(value))
									continue;
								
								if(colType.xtype == 'datefield')
									value = Ext.util.Format.date(value, 'Y-m-d');
							    else if(colType.xtype == 'ramcodatetimefield')
									value = Ext.util.Format.date(value, 'Y-m-d H:i:s');
							    else if(colType.xtype ==  'ramcotimefield')
									value = Ext.util.Format.date(value, 'H:i:s');	
								if (!Ext.isEmpty(value))
									colData.data[colTypeId] = value;
							}
                        }
						
						// TECH-40530
						for (j = 0; j < chkItem[2].items.length; j++) {
						   colData.data[chkItem[2].items.items[j].getItemId()] = chkItem[2].items.items[j].getValue();
                        }
						//TECH-33701
						view.callBack = function() {
							this.taskPending = true;
							view.fireEvent('coldefaultsave', view, data, 'tskstdgriddefault', 'rvwstandardtask', grid.getItemId(), true);
							return;
						}.bind(this);
						this.taskPending = true;
						view.fireEvent('trans', view, [], 'tskdummy', 'trans');
                       // view.fireEvent('coldefaultsave', view, data, 'tskstdgriddefault', 'rvwstandardtask', grid.getItemId(), true);
                        var wind = btn.up('window');
                        wind.close();
                    }.bind(me),
                    itemId: 'coldefaultbtn'
                }, {
                    xtype: 'button',
                    margin: '0 0 0 20',
                    text: rvw_resources.R066,
                    handler: function(btn) {
                        var win = btn.up('window')

                        win.close();
                    },
                    itemId: 'colclosebtn'
                }]
            }],
            listeners: {
                beforeshow: function(wind) {
                    if (!Ext.isEmpty(grid.dummyRec)) {
                        for (i = 0; i < grid.columns.length; i++) {
                            if (grid.columns[i].dataIndex == 'rn' || grid.columns[i].dataIndex == 'sel')
                                continue;
                            for (j = 0; j < grid.dummyRec.length; j++) {
                                if (grid.dummyRec[j].id == grid.columns[i].dataIndex) {
                                    ctrl = this.queryById(grid.dummyRec[j].id);
                                    if (grid.dummyRec[j].coldefactive == "true")
										ctrl.setValue(grid.dummyRec[j].coldefval);
                                }
                            }
                        }
                    }
                }
            }
        });
        winds.show();
        winds.center(); // TECH-39926
    },
    onColumnClearDefault: function(grid) {
        var me = this,
            colData = {},
            view = me.getView();
        for (item in grid.dummyRec) {
            item = grid.dummyRec[item];
            name = item.id.replace('v', '');
            val = item.coldefval || '';
            if (name)
                colData[name] = val;
        }
        colData['gridId'] = grid.getItemId();
		me.onCtrlFocus(grid.itemId, 0, 0);
        view.fireEvent('coldefaultclear', view, colData, 'tskstdsavepersonalization', 'rvwstandardtask', grid.getItemId(), 'false');
    },
	onColumnFilter: function(grid) {
        var me = this,
            view = me.getView(),
            cmp = null,
            cols = null,
            winds = null,
			gridResponseData = null,
            ctrlArr = {},
        viewModel = me.getViewModel();
		gridResponseData = RamcoRTC.reader.uiCtrlArray[view.ilboConfig.ilboName][grid.itemId];		
        cols = grid.getColumns();
		me.onCtrlFocus(grid.itemId, 0, 0);
        cmp = Ext.create('Ext.form.FieldContainer', {
            height: '75%',
            width: '100%',
            region: 'north',
            itemId: 'columnFilter',
            layout: {
                type: 'table',
                columns: 4,
				tableAttrs: {
					style: {
						width: '100%',
						padding: '2px'
					}
				},
				tdAttrs: {
					style: {
						width: '25%'
					}
				}				
            }
        });
        for (i = 0; i < cols.length; i++) {
            ctrlArr = {};
            if (true) {
				if (cols[i].dataIndex == "rn" || cols[i].dataIndex == "sel" || cols[i].isHidden())
					continue;
				ctrlArr.xtype = gridResponseData.value.columnsValue[cols[i].dataIndex].vt;
				ctrlArr.dType = gridResponseData.value.columnsValue[cols[i].dataIndex].dt;
                ctrlArr.dataIndex = cols[i].dataIndex;
                ctrlArr.itemId = cols[i].dataIndex;
				ctrlArrLabel = {};
				ctrlArrLabel.xtype = 'label';
				ctrlArrLabel.text = cols[i].text;
				cmp.add(ctrlArrLabel);
                ctrlArr.fieldLabel = cols[i].text;
				ctrlArr.hideLabel = true;
				ctrlArr.width = 122;
				if(ctrlArr.xtype == "editbox" || ctrlArr.xtype == "displayonly") {
					switch(ctrlArr.dType) {
						case 'date':
							  ctrlArr.xtype = 'date';
							  break;
						case 'time':
							  ctrlArr.xtype = 'time';
							  break;
						case 'date-time':
							  ctrlArr.xtype = 'date-time';
							  break;
					}
				}						
                switch (ctrlArr.xtype) {
                    case 'combofield':
					case 'combobox':
                        store = viewModel.getStore(cols[i].editor.bind.store.replace(/[{}]/g, ''));
                        ctrlArr.xtype = "combofield",
						ctrlArr.displayField = "text";
                        ctrlArr.valueField = "value";
                        ctrlArr.queryMode = "local";
						ctrlArr.store = store;
                        break;
					case 'editbox':
						ctrlArr.xtype = "textfield",
						ctrlArr.maxLength = cols[i].maxLength;
						break;
					case 'displayonly':
						ctrlArr.xtype = "textfield";
						break;
                    case 'datefield':
					case 'date':
                        ctrlArr.xtype = "datefield",
						ctrlArr.format = RamcoRTC.userPreference.dateFormat;						
                        break;
					case 'ramcodatetimefield':
					case 'date-time':
						ctrlArr.xtype = "ramcodatetimefield",
				        ctrlArr.format = RamcoRTC.userPreference.dateTimeFormat;
                        break;
					case 'ramcotimefield':
					case 'time':
						ctrlArr.xtype = "ramcotimefield",
				        ctrlArr.format = RamcoRTC.userPreference.timeFormat;
                        break;
					case 'ramcolistedit':
                        if(cols[i].dataType == "numeric"){
							ctrlArr.xtype = "numberfield";
							ctrlArr.format = cols[i].format;
							ctrlArr.maxLength = cols[i].maxLength - cols[i].format; 
						}else if(cols[i].dataType == "char"){
							ctrlArr.xtype = "textfield";
							ctrlArr.maxLength = cols[i].maxLength; 
						}
						break;
                }
                cmp.add(ctrlArr);
            }
        }
        winds = Ext.create('Ext.window.Window', {
            title: "Column Filter Fields",            
            width: '50%',
			modal:true,
            minHeight: 300,
			scrollable:true,
			alwaysOnTop:true,//TECH-36970
            itemId: 'columnFilterWindow',
            items: [cmp],
            dockedItems: [{
                xtype: 'ramcopanel',
                bodyPadding: 5,
                dock: 'bottom',
                layout: 'hbox',
                items: [{
                    xtype: 'button',
                    margin: '0 0 0 180',
                    text: "Apply Filter",
                    handler: function(btn) {
                        var win = btn.up('window'),
                            colFiler = win.down('#columnFilter').items,
                            i = 0,
							winItems = win.items,
							column = null,
                            id, col,
                            format = RamcoRTC.userPreference.dateFormat,
                            colItem = null,
                            colData = {},
                            data = [],
                            data = colData['data'] = {},                            
                            len = colFiler.length;                        
                        for (i = 0; i < len; i++) {
							var colType = colFiler.items[i],
								value = "";
							if(colType.dataIndex) {
								column = grid.getColumnById(colType.dataIndex);								
							}
							switch(colType.xtype){
								case 'datefield':
								case 'date':
								   value = Ext.util.Format.date(colType.getValue(), 'Y-m-d');
                                   colData.data[colType.getItemId()] = value;
								   break;
								case 'ramcodatetimefield':
								case 'date-time':
									value = Ext.util.Format.date(colType.getValue(), 'Y-m-d H:i:s');
                                    colData.data[colType.getItemId()] = value;
								   break;
								case 'ramcotimefield':
								case 'time':
									value = Ext.util.Format.date(colType.getValue(), 'H:i:s');
                                    colData.data[colType.getItemId()] = value;
									break;
								default:
									if(colType.xtype != 'label') {
										value = colType.getValue();
										colData.data[colType.getItemId()] = value;
									}
                                }
								if(colType.xtype != 'label') {
									column.setFilter(false);
									if(!Ext.isEmpty(value)) {
										column.setFilter(true);
									}
								}
                            }						
						var fillerCallBack = function() {
							this.taskPending = true;
							view.fireEvent('colfiltersave', view, data, 'tskstdfiltergrid', 'rvwstandardtask', grid.getItemId(), true);
							var wind = btn.up('window');
							wind.close();
							return;
						};
						view.callBack = fillerCallBack.bind(me);
						view.fireEvent('trans', view, [], 'tskdummy', 'rvwstandardtask');
                        //view.fireEvent('colfiltersave', view, data, 'tskstdfiltergrid', 'rvwstandardtask', grid.getItemId(), true);
                        //var wind = btn.up('window');
                        //wind.close();
                    },
                    itemId: 'colfilterbtn'
                }, {
                    xtype: 'button',
                    margin: '0 0 0 20',
                    text: rvw_resources.R066,
                    handler: function(btn) {
                        var win = btn.up('window')

                        win.close();
                    },
                    itemId: 'colclosebtn'
                }]
            }],
            listeners: {
                beforeshow: function(wind) {
                    if (!Ext.isEmpty(grid.dummyRec)) {
                        for (i = 0; i < grid.columns.length; i++) {
                            if (grid.columns[i].dataIndex == 'rn' || grid.columns[i].dataIndex == 'sel')
                                continue;
                            for (j = 0; j < grid.dummyRec.length; j++) {
                                if (grid.dummyRec[j].id == grid.columns[i].dataIndex) {
                                    ctrl = this.queryById(grid.dummyRec[j].id);
                                    ctrl.setValue(grid.dummyRec[j].coldefval);
                                }
                            }
                        }
                    }
                }
            }
        });
        winds.show();
    },
	onMlExpand: function(grid) {
		var me = this,
			view = me.view,
			viewSize = me.view.getSize(),
			viewPosition = me.view.getPosition();	
		me.onCtrlFocus(grid.itemId, 0, 0);			
		view.mlExpandWin = Ext.create('Ext.ramco.MLExpandWindow', {
			scrollable: true,
			closable: true,
			modal: true,
			constrain : true,
			constrainTo : (me.view && me.view.body) ? me.view.body.dom : '',
			cfgGrid: grid,
			viewcfg: me.view.ilboConfig
		});
		view.add(view.mlExpandWin);
		view.mlExpandWin.setSize(viewSize);
		view.mlExpandWin.floatParent = me.view;		
		view.mlExpandWin.show();				
	},
	onMlTreeExpand: function(grid) {
		var me = this,
			view = me.view,
			viewSize = me.view.getSize(),
			viewPosition = me.view.getPosition();
		view.mlExpandWin = Ext.create('Ext.ramco.MLTreeExpandWindow', {
			scrollable: true,
			closable: true,
			modal: true,
			constrain : true,
			constrainTo : (me.view && me.view.body) ? me.view.body.dom : '',
			cfgGrid: grid,
			viewcfg: me.view.ilboConfig
		});
		view.add(view.mlExpandWin);
		view.mlExpandWin.setSize(viewSize);
		view.mlExpandWin.floatParent = me.view;		
		view.mlExpandWin.show();				
	},	
    onColumnClearFilter: function(grid) {
        var me = this,
            colData = {},
            view = me.getView();
        for (item in grid.dummyRec) {
            item = grid.dummyRec[item];
            name = item.id.replace('v', '');
            val = item.coldefval || '';
            if (name)
                colData[name] = val;
        }
        colData['gridId'] = grid.getItemId();
		me.onCtrlFocus(grid.itemId, 0, 0);
        view.fireEvent('colfilterclear', view, colData, 'tskstdclearfilter', 'rvwstandardtask', grid.getItemId(), 'false');
    },    
    onshowPDF: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            ilboConfig = view.getIlboConfig(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'exportpdf',
            taskType = 'trans';
        data = grid.getGridExportData('pdf', gridId, ilboConfig.activityName, ilboConfig.ilboName, 'pdf');
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onshowCSV: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            ilboConfig = view.getIlboConfig(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'exportcsv',
            taskType = 'trans';

        data = grid.getGridExportData('pdf', gridId, ilboConfig.activityName, ilboConfig.ilboName);
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onshowReport: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            ilboConfig = view.getIlboConfig(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'exportreport',
            taskType = 'trans';
        data = grid.getGridExportData('pdf', gridId, ilboConfig.activityName, ilboConfig.ilboName, 'report');
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onshowChart: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            ilboConfig = view.getIlboConfig(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'exportchart',
            taskType = 'trans';
        data = grid.getGridExportData('pdf', gridId, ilboConfig.activityName, ilboConfig.ilboName, 'chart');
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onshowExcel: function(grid, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'export',
            taskType = 'trans';
        data = grid.getGridExportData();
		//TECH-36063
		//me.onCtrlFocus(gridId, 0, 0);
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
    onViewall: function(grid, isZoom, startIndex) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            ilboConfig = view.getIlboConfig(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'exporthtml',
            taskType = 'trans';
        data = grid.getGridExportData('pdf', gridId, ilboConfig.activityName, ilboConfig.ilboName, 'html');
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
    },
	onValidateFile: function(grid, data, isZoom) {
		if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            gridData = null,
            ilboConfig = view.getIlboConfig(),
            task = 'validatefile',
            taskType = 'trans';
        gridData = grid.getGridExportData('pdf', gridId, ilboConfig.activityName, ilboConfig.ilboName);
		data.set("file-meta",gridData);
        view.importWindow = grid.importWindow;
        view.fireEvent('gridtool', view, data, task, taskType, gridId);
	},
	onImportCsv: function(grid, data, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
			formData = new FormData(),
            gridData = null,
            ilboConfig = view.getIlboConfig(),
            task = 'importcsv',
            taskType = 'trans';
        gridData = grid.getGridExportData('pdf', gridId, ilboConfig.activityName, ilboConfig.ilboName);
		data["file-meta"] = gridData;
		for(key in data) {
			formData.append(key, data[key]);
		}
        view.importWindow = grid.importWindow;
		view.fireEvent('gridtool', view, formData, task, taskType, gridId);
    },
    onImportExcel: function(grid, data, isZoom) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
			formData = new FormData(),
            gridData = null,
            ilboConfig = view.getIlboConfig(),
            task = 'importexcel',
            taskType = 'trans';
        gridData = grid.getGridExportData('pdf', gridId, ilboConfig.activityName, ilboConfig.ilboName);
		data["file-meta"] = gridData;
		for(key in data) {
			formData.append(key, data[key]);
		}
        view.importWindow = grid.importWindow;
		view.fireEvent('gridtool', view, formData, task, taskType, gridId);
    },
    onSavePers: function(grid, persData) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = viewModel.getSessionData(),
            ilboConfig = view.getIlboConfig(),
            task = 'tskstdsavepersonalization',
            taskType = 'trans',
            noofLockedCols = null;
        data.pers = persData;        
		
		// TECH-34272
		if (data.pers) {
			data.pers.gridId = gridId;
			if (!Ext.isEmpty(grid.vseq))
				data.pers.vseq = grid.vseq;
			else if (data.pers.seqChanged)
				data.pers.vseq = grid.getUpdatedSequence();
		}
		
        if (grid.lockedGrid) {
            noofLockedCols = grid.lockedGrid.getColumns().length - 2;
            data.pers.fc = noofLockedCols;
        }
        //grid.setPersonalization({});
        view.fireEvent('savepers', view, data, task, taskType, gridId);
    },
    onRemovePers: function(grid) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = viewModel.getSessionData(),
            ilboConfig = view.getIlboConfig(),
            task = 'tskstdremovepersonalization',
            taskType = 'trans';
        view.fireEvent('removepers', view, data, task, taskType, gridId);
    },
    onColumnChoose: function(grid) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            gridId = grid.getItemId(),
            viewModel = me.getViewModel(),
            ilboConfig = view.getIlboConfig(),
            task = 'GETDOC',
            taskType = 'trans';
        view.fireEvent('colchoose', view, task, taskType, gridId);
    },
    onColumnSave: function(grid, data) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            gridId = grid.getItemId(),
            viewModel = me.getViewModel(),
            ilboConfig = view.getIlboConfig(),
            task = 'SAVEDOC',
            taskType = 'personalization';//TECH-28696 / TECH-29031
        view.fireEvent('colchoose', view, task, taskType, gridId, data);
    },
    onGridChartExport: function(cView, response, options) {
        var me = this,
            store = me.store,
            data = '',
            ctrl = options.ctrl,
            index = options.index,
            pageObject = Erp.Interface.getCurrentPageObject(),
            grid = pageObject ? pageObject.callOut.controls[ctrl] : null,
            totalRows = store ? store.tr : 0,
            tbar = cView.toolbar;
        if (response) {
            if (response.responseXML)
                data = response.responseXML;
            if (Ext.isEmpty(data) && !Ext.isEmpty(response.responseText))
                data = new DOMParser().parseFromString(response.responseText, "text/xml");
            if (data) {
                cView.setChartData(data);
                var gdNode, cNode, vdNode, objXml;
                gdNode = data.querySelector("gd");
                cNode = gdNode.querySelector("c");
                vdNode = cNode.querySelector("vd");
                if (vdNode != null) {
                    var rNode = vdNode.querySelectorAll('r'),
                        rLen = rNode.length,
                        x = 0,
                        xw = new XMLWriter('UTF-8');
                    xw.writeStartDocument();
                    xw.writeStartElement('chartresult');
                    xw.writeStartElement('charttype');
                    xw.writeString('column2d');
                    xw.writeEndElement();
                    xw.writeStartElement('chart');
                    xw.writeStartElement('dataset');
                    xw.writeAttributeString('seriesName', 'Column');
                    for (; x < rLen; x++) {
                        xw.writeStartElement('set');
                        xw.writeAttributeString('value', rNode[x].querySelector("vw[n='2']").getAttribute("v"));
                        xw.writeEndElement();
                    }
                    xw.writeEndElement();
                    xw.writeEndElement();
                    xw.writeEndElement();
                    xw.writeEndDocument();
                    objXml = xw.getDocument();
                    xw.close();
                }
            }
            cView.setCtrlId(ctrl);
            cView.removeAll(true, true);
            cView.add({
                xtype: 'ramcochart',
                dataXml: objXml.xml
            });
            cView.show();
        }
        me.mask(false);
    },
    onGridSearch: function(grid, searchBy, searchValue, callBack) {
        if (this.taskPending)
            return;
        var me = this,
            gridId = grid.itemId,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = 'tskstdsearch',
            taskType = 'trans';
        //data = viewModel.getSessionData();
        me.taskPending = true;
        view.fireEvent('gridsearch', view, data, task, taskType, gridId, searchBy, searchValue);
        view.callBack = callBack;
    },
	onMouseClick: function(field, evt, eOpts) {
		var me = this,
			view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
			field = (field.xtype == 'radiofield') ? field.up('ramcoradio') : field,
			task = field.task || field.uiTask,
			taskType = field.taskType,
			id = field.getItemId();
			if(task) {
				viewModel.set(id + ".value", field.getValue());
				view.setControlModified(field.itemId);
				RamcoRTC.lastFocusCtrl[1] = id;
				RamcoRTC.focusCtrl[1] = id;
                view.fireEvent('trans', view, data, task, taskType, id, id);
                return;
			}
	},
	onLstEdtSpecialKey: function (field, evt, eOpts) {
		if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            cols = '',
            listElems = '',
            searchElem = '',
            task = field.uiTask,
            taskType = field.taskType,
            grid = view.down('ramcogrid'),
			picker, i=0,len=0,
			key = evt.getKey(),
			value, parseValue;
        if (field.getRole && field.getRole() == 'mainpage')
            return;
        if (evt.ctrlKey == true && field.xtype == 'ramcolistedit') {
            if (evt.SPACE == key) {                
				picker = field.picker?field.picker:field.getPicker();
				if(picker){
                	// TECH-29577
					//cols = picker.columns;
					cols = picker.getVisibleColumns();
					i = 0;
					len = cols.length;
                	for (i = 0; i < len; i++) {
                    if (cols[i].mandatory == true) {
                        cols[i].mandatory = null;
							searchElem = cols[i].ariaEl.dom;
							if (searchElem && searchElem.className.indexOf("item-mandatory") > -1) {
								searchElem.className = searchElem.className.replace("item-mandatory", "");
								searchElem.className = searchElem.className.replace("search-item", "");
							}
							if (evt.shiftKey) {
								if (i == cols.length - 1)
									i = 0;
								else
									i += 1;
							}
							else {
								if (i == 0)
									i = cols.length - 1;
								else
									i -= 1;
							}
                            searchElem = cols[i].ariaEl.dom;
                            if (cols[i]) {
                                cols[i].mandatory = true;
                                if (searchElem && searchElem.className.indexOf("item-mandatory") == -1)
                                    searchElem.className += " search-item item-mandatory";
                                field.searchView = cols[i].itemId;
                                if (field.store.getCount() == 0) {
									if (field.grid)
										field.grid.fireEvent('listdata', field.grid, field.column, field.lastValue, field.getListView(), field.searchView, field.grid);
									else
										field.fireEvent('listdata', field, null, field.getValue());
                                }
                                field.store.clearFilter();
                                filter = new Ext.util.Filter({
                                    anyMatch: true,
                                    property: field.searchView,
                                    value: field.getValue()
                                });
                                field.store.filter(filter);
                                break;
                            }
                        }
                    }
                }
            }
		}
	},
    onSpecialKey: function(field, e, eOpts) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            cols = '',
            listElems = '',
            searchElem = '',
            task = field.uiTask,
            taskType = field.taskType,
            grid = view.down('ramcogrid'),
			picker, i=0,len=0,
			selectedVal = null,
			value, parseValue;
        if (field.getRole && field.getRole() == 'mainpage')
            return;
		if(e.getKey() == e.TAB) {			
			if (field.xtype == "ramcodatetimefield" || field.xtype == "datefield" || field.xtype == "ramcotimefield") {
				value = field.getRawValue();
				if(field.isValid()) {
					field.setValue(field.getValue());
				}
				else {
					parseValue = field.parseSpecialData(field.itemId, value, field.format, "parse");
					parseValue = field.parseSpecialData(field.itemId, parseValue, field.format, "validate");
					parseValue = Ext.Date.parse(parseValue, field.format);
					if(!isNaN(Date.parse(parseValue)))
						field.setValue(parseValue);
					else 
						e.stopEvent();
				}
			}
		}		
		if (field.uiTask && e.getKey() == e.SPACE) {
			if(field.xtype == "checkboxfield" || field.xtype == "ramcoradio") {
				viewModel.set(field.itemId + ".value", field.getValue());
				view.setControlModified(field.itemId);
	            me.taskPending = true;
	            view.fireEvent('trans', view, data, task, taskType);
				return;
			}	
		}
        if((field.xtype == "ramcolistedit" || field.xtype == "combofield") && e.getKey() == e.ENTER) {
				field.collapse();
				field.doQueryTask.cancel();
			if (field.picker)
			selectedVal = field.picker.getSelection();
			//TECH-30817
			if (selectedVal && selectedVal.length > 0) {
				field.select(field.picker.getSelection()[0]);
				//field.fireEvent("select", field, field.picker.getSelection()[0]);
				field.fireEvent("select", field, selectedVal[0]);
				return;
			}
			else {
				field.setSelection(null);
				field.idField = null;
			}
			//else
				//field.select(null);
            //viewModel.set(field.itemId + ".value", field.getValue());
			//viewModel.setModified(field.itemId);
            //data = viewModel.getSessionData();
			}
		if (field.uiTask && e.getKey() == e.ENTER) {		
			if (field.xtype == "ramcopassword")
				viewModel.set(field.itemId + ".value", field.getEncValue());
			else
				viewModel.set(field.itemId + ".value", field.getValue());
			view.setControlModified(field.itemId);
	            me.taskPending = true;
	            view.fireEvent('trans', view, data, task, taskType);
			return;
		}        
        if (e && e.getKey() == e.ENTER) {
			if(field.getItemId() == "fieldSearch")
            field.onSearchClick();
			else if (field.getItemId() == 'rowNav')
            grid.onRowNumSet(field.getValue());
        }
    },
    onHelp: function(field) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            task = field.helpTask.toLowerCase(),
            taskType = field.helpTaskType.toLowerCase(),
			ddtObj = null,
            ddtTask = null,
            ddtCtrl = null,
            ddtView = null,
            ddtValue = null,
			srcCtrl = null;
			data = [];
			//TECH-40243
			// gridArrary = [],
			// gridArrLen = 0;
		//TECH-34021
        //data = viewModel.getSessionData();
		//TECH-40243
		// if (view) {
			// gridArrary = view.query("ramcogrid");
			// gridArrLen = gridArrary.length;
			// for (var g=0; g<gridArrLen; g++) {
				// var curGrid = gridArrary[g];
				// if (curGrid && curGrid.plugins[0] && curGrid.plugins[0].editing) {
					// curGrid.plugins[0].completeEdit();
				// }
			// }
		// }
        if(view.ddt && view.ddt['task'] && view.ddt['task'][task]) {
            ddtObj = view.ddt['task'][task];
            ddtCtrl = ddtObj.ctrl;
            ddtView = ddtObj.view;
            if (ddtCtrl == ddtView) {
                ddtValue = view.getControlData(ddtCtrl);
                if (!Ext.isEmpty(ddtValue))
                    ddtValue = ddtValue.toLowerCase();
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            } else {
                srcCtrl = view.down('#' + ddtCtrl);
                if (srcCtrl) {
                    ddtValue = record ? record.get('v' + ddtView) : null;
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                }
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            }
        }
        if (ddtTask)
            task = ddtTask;
        me.taskPending = true;
        view.fireEvent('help', view, data, task, taskType);
    },
    onSearch: function(field, val) {
        if (this.taskPending)
            return;
        var me = this,
            grid = field.up('ramcogrid'),
            view = me.getView(),
            viewModel = me.getViewModel(),
			selModel = null,
			navModel = null,
            result = false,
            data = [];
		if (!grid) {
			grid = field.up('ramcotreegrid');
		}			
		if (!grid) {
			grid = field.up('ramcoddtgrid');				
		}
		if (!grid) {
			grid = field.up('ramcorstreegrid');			
		}
		if (!grid) {
			grid = field.up('ramcoexpgrid');
		}
		if(grid) {
			selModel = grid.getSelectionModel();
			//navModel = grid.getNavigationModel();
			if(selModel)
				selModel.clearSelections();
			//TECH-31148
			/*if(navModel && navModel.previousCell)
				navModel.previousCell.removeCls('x-grid-cell-selected');
			if(navModel && navModel.cell)
				navModel.cell.removeCls('x-grid-cell-selected');			
			*/
			if (grid.view) {
				var selectedCls = grid.view.selectedCellCls,
					tds = grid.body && grid.body.query("td."+ selectedCls);
				for(td in tds){
					tds[td].classList.remove(selectedCls);
				}
			}			
		}		
        //data = viewModel.getSessionData();
		// TECH-26738 / ATH-84
		grid.lastEvent = "";
        grid.doSearch(val, field);
    },
    onCtrlFocus: function(ctrlId, viewId, row) {
        var me = this,
            view = me.getView();
        if (Ext.isEmpty(RamcoRTC.focusCtrl))
            RamcoRTC.focusCtrl = [];
		//TECH-30053
		//if (ctrlId.xtype == "ramcogridcheck" && ctrlId.ownerCt && ctrlId.ownerCt.xtype == "headercontainer" ) {
		if (ctrlId.ownerCt && ctrlId.ownerCt.xtype == "headercontainer" ) {	
			RamcoRTC.focusCtrl = [];
		}
        else if (ctrlId && !Ext.isEmpty(row)) {
            RamcoRTC.focusCtrl = [];
            RamcoRTC.focusCtrl.push(view.ilboConfig.ilboName);
            RamcoRTC.focusCtrl.push((ctrlId.getItemId) ? ctrlId.getItemId() : ctrlId);
            RamcoRTC.focusCtrl.push(row);
            RamcoRTC.focusCtrl.push(viewId);
        }
    },
	onFocusEnter:function(ctrl){
		if (this.taskPending)
            return;
		var me =this,
			view = me.getView();
		if(!Ext.isEmpty(ctrl.onFocusTask) && view.lastTaskName !== ctrl.onFocusTask){
			this.taskPending = true;
			view.fireEvent('trans', view, null, ctrl.onFocusTask, "ui");
		}
	},
	onFocusLeave:function(ctrl){
		if (this.taskPending)
            return;
		var me =this,
			view = me.getView();
		if(!Ext.isEmpty(ctrl.leaveFocusTask) && view.lastTaskName !== ctrl.leaveFocusTask){
			this.taskPending = true;
			view.fireEvent('trans', view, null, ctrl.leaveFocusTask, "ui");
		}
	},
    onUploadFile: function(ctrl, fdata, data, column, srcCtrl) {
        if (this.taskPending)
            return;
        var me = this,
            ctrlId = ctrl.itemId,
            view = me.getView(),
            ilboConfig = view.getIlboConfig(),
            task = 'uploadfile',
            taskType = 'trans';
        view.browseCtrl = {
            ctrl: ctrl,
            v: view,
            data: data,
            srcCtrl: srcCtrl,
            task: ctrl.task,
            taskType: ctrl.taskType
        };
		var uploadCallBack = function() {
			this.taskPending = true;
            view.fireEvent('upload', view, fdata, task, taskType, ctrlId);
            return;
		};
        view.callBack = uploadCallBack.bind(me);
        // TECH-32997
        //var viewModel = me.getViewModel();
            //dummyData = viewModel.getSessionData();
		this.taskPending = true;
        //view.fireEvent('trans', view, dummyData, 'tskdummy', 'trans');
        view.fireEvent('trans', view, [], 'tskdummy', 'trans');
    },
	//TECH-35056
	onMultiUploadFile: function(ctrl, fdata, data, column, srcCtrl) {
        if (this.taskPending)
            return;
        var me = this,
            ctrlId = ctrl.itemId,
            view = me.getView(),
            ilboConfig = view.getIlboConfig(),
            task = 'uploadfile',
            taskType = 'trans';
        view.browseCtrl = {
            ctrl: ctrl,
            v: view,
            data: data,
            srcCtrl: srcCtrl,
            task: ctrl.task,
            taskType: ctrl.taskType
        };
		return new Promise(function (resolve, reject) {		
			this.taskPending = true;
            view.fireEvent('upload', view, fdata, task, taskType, ctrlId);        
			resolve();
		});        
    },
    onDeleteFile: function(ctrl, grid, row, srcPath, assView, dView) {
        if (this.taskPending)
            return;
        var me = this,
            ctrlId = grid ? grid.itemId : ctrl.itemId,
            viewId = grid ? (ctrl.name || ctrl.itemId) : ctrl.itemId,
            rowNo = grid ? (row + 1) : row,
            view = me.getView(),
            ilboConfig = view.getIlboConfig(),
            task = 'deletefile',
			fileName = '',
            taskType = 'trans',
			formItems = null;
        if (ctrl.xtype == 'deletecolumn')
            //viewId = parseInt(ctrl.name) - 1;
            viewId = ctrl.assView;		
		if (grid) {
			fileName = grid.getViewValue(viewId, row + 1);
		}
		else {
			// TECH-28698 / KNB-184
			//fileName = ctrl.rawValue;
			fileName = ctrl.value || ctrl.rawValue;
		}
		if(ctrl.gridName && !Ext.isEmpty(ctrl.up('questioner'))){
				ctrlId = ctrl.gridName;
				rowNo = ctrl.rowNo;
				viewId = ctrl.viewName;
		}
		if (ctrl.isFormField) {
			formItems = ctrl.ownerCt;
			if (formItems && formItems.gridToForm === true) {
				ctrlId = formItems.parentId;
				viewId = ctrl.dataIndex.replace('v', '');
				rowNo = formItems.cr;
			}
		}
		if (Ext.isEmpty(fileName)) {
			this.taskPending = false;
			return;
		}
		
        // TECH-28698 / KNB-184
		fileName = '"<b>' + (fileName.substr(0, fileName.lastIndexOf('.')) || fileName) + '</b>"';
		fileName = Ext.String.format(rvw_resources.R252, fileName);
        Ext.RamcoMsg.confirm(rvw_resources.R253, fileName, function(btnId) {
            if (btnId == "ok" || btnId == "yes") {
				//TECH-30979
				var deleteCallBack = function() {
					this.taskPending = true;
					view.fireEvent('deletefile', view, task, taskType, ctrlId, viewId, rowNo, srcPath, assView, dView);
					return;
				};
				view.callBack = deleteCallBack.bind(me);
				var viewModel = me.getViewModel(),
				dummyData = viewModel.getSessionData();
				this.taskPending = true;
				view.fireEvent('trans', view, dummyData, 'tskdummy', 'trans');
				//view.fireEvent('deletefile', view, task, taskType, ctrlId, viewId, rowNo, srcPath, assView, dView);
            }
			else
				this.taskPending = false;
        });
    },
	onAvnCustomAction: function (ctrl, role) {
		if (this.taskPending)
            return;
		var me = this,
			view = me.getView(),			
            ilboConfig = view.getIlboConfig();
			view.avnuplctrl = ctrl;
		var avnCustActCallBack = function() {
			this.taskPending = true;
			view.fireEvent('avnactioncustom', view, 'avncustaction', 'avncustaction', role);		
            return;
		};		
        view.callBack = avnCustActCallBack.bind(me);
		var viewModel = me.getViewModel(),
            dummyData = viewModel.getSessionData();
			this.taskPending = true;
        view.fireEvent('trans', view, dummyData, 'tskdummy', 'trans');
	},
	onGetCustLstPageData: function(lstGrid, navType) {
		if (this.taskPending)
            return;
        var me = this,
			field = lstGrid.pickerField,
			grid = field.grid,
			lstGridStore = lstGrid.store,
			column = field.column,
			stVal = lstGridStore.st, totalNum = lstGridStore.tr,
			ctrlId = field.mapCtrl ? field.mapCtrl[0] : ((grid) ? grid.itemId : field.itemId),
            targetCtrl = (grid) ? grid.itemId : field.itemId,
            ctrlView = column ? column.name : field.itemId,			
            searchView = field.searchView,
			row = 0,            
            view = me.getView();
			if(parseInt(stVal, 10) == 1 && navType == "prev")
				return;
			if(stVal > -1 && navType == "next" && parseInt(stVal, 10) < parseInt(totalNum,10))
				stVal = parseInt(stVal, 10) + lstGridStore.pgs;
			if(!isNaN(stVal) && navType == "prev" && parseInt(stVal, 10) >= lstGridStore.pgs)
				stVal = parseInt(stVal, 10) - lstGridStore.pgs;											
			if(parseInt(stVal, 10) >= parseInt(totalNum,10) && navType == "next")
				return;
        me.taskPending = true;
		view.fireEvent('customlistdata', view, [], ctrlId, ctrlView, field.value, field.searchId, field.searchContext, targetCtrl, row, stVal);
	},
    onGetListData: function(field, column, value, fields, search, grid) {//TECH-29761/QA-142
        if (this.taskPending)
            return;
        var me = this,
            ctrlId = field.mapCtrl ? field.mapCtrl[0] : ((grid) ? grid.itemId : field.itemId),
            targetCtrl = (grid) ? grid.itemId : field.itemId,
            ctrlView = column ? column.name : field.itemId,
			syncView = column ? column.syncView : field.syncView,
            searchView = search || field.searchView,
			editor = field.ownerCt,
			context = (editor) ? editor.context : null,
			record = (context) ? context.record : null,
			row = 0,
			recIsNew = false,
            listView = column ? fields : field.getListView(),
            view = me.getView();
			if (field.role == 'gridrole' || field.role == 'gridzoom')//TECH-29761/QA-142
				row = (grid && grid.store) ? grid.store.cr : 1;
        me.taskPending = true;
		if(!field.formListEdit && syncView === true) {
			if (record && value != "ä¼ä") {
				record.set("v"+ ctrlView, value);
			}
			view.syncView = syncView;
			var listCallBack = function() {
				// For Creating DummyRecord in Syncview
				if (recIsNew === true)
					record.data.isNew = true;
				this.taskPending = true;
				// TECH-29577
				if (field && field.inputEl && field.inputEl.dom)
					field.inputEl.dom.focus();
				view.fireEvent('listdata', view, [], ctrlId, ctrlView, value, searchView, listView, targetCtrl, row);
				return;
			};
			view.callBack = listCallBack.bind(me);
			// For Sending GridData in Syncview
			// TECH-29577
			if (record && record.data && typeof record.data.isNew != "undefined" && record.data.isNew === true) {
				record.data.isNew = false;
				recIsNew = true;
			}
			if(record)
				record.dirty = true;
			
			view.fireEvent('trans', view, [], 'tskdummy', 'trans');	
		}
		else
			view.fireEvent('listdata', view, [], ctrlId, ctrlView, value, searchView, listView, targetCtrl, row);
    },
	onGetCustomListData: function(field, column, value, fields, search, grid) {
		if (this.taskPending)
            return;
        var me = this,
            ctrlId = field.mapCtrl ? field.mapCtrl[0] : ((grid) ? grid.itemId : field.itemId),
            targetCtrl = (grid) ? grid.itemId : field.itemId,
            ctrlView = column ? column.name : field.itemId,			
            searchView = search || field.searchView,
			row = 0,
            listView = column ? fields : field.getListView(),
			charLength,
            view = me.getView();
			if (field.role == 'gridrole' || field.role == 'gridzoom')//TECH-29761/QA-142
				row = (grid && grid.store) ? grid.store.cr : 1;
			field.position = field.position ? field.position:1;
        //me.taskPending = true;
		if(typeof value == "string" && value.length >= field.listIndexSearch)
		{
			charLength = (value.length - field.listIndexSearch);				
			if(value.length == field.listIndexSearch + 1) {							
				if(charLength % field.position === 0) {
					var customListCallBack = function() {
						this.taskPending = true;
						field.inputEl.dom.focus();
						view.syncView = true;
						view.fireEvent('customlistdata', view, [], ctrlId, ctrlView, value, field.searchId, field.searchContext, targetCtrl, row);
						return;
					}
					view.callBack = customListCallBack.bind(me);
				}
				me.taskPending = true;
				view.fireEvent('trans', view, [], 'tskdummy', 'trans');
			}
			else 
			{
				if(charLength % field.position === 0){
					me.taskPending = true;
					view.fireEvent('customlistdata', view, [], ctrlId, ctrlView, value, field.searchId, field.searchContext, targetCtrl, row);
				}
					
			}
		}
	},
    onGridKeyNavDown: function(ctrl, rec, item, index, e, eOpts) {
		return;
/*         var me = this,
            shiftKey = null,
			ctrlKey = null,
            evt = e.getKey(),
            grid = ctrl.up('ramcogrid'),
            map,
			gridToolbar,menuImport,btnFirst,btnPrev,btnNext,btnLast,btnInsert,btnDelete,
			btnCut,btnCopy,btnImpExcel,btnExpPdf,btnExpCsv,btnExpHtml,btnExpExcel;
			
        if (e.target && (e.target.nodeName == "INPUT" || e.target.nodeName == "TEXTAREA" ))
            return;
        gridToolbar = grid.getComponent('gridToolbar');
        menuImport = gridToolbar.getComponent('menuImport');
        btnFirst = gridToolbar.getComponent('btnFirst');
        btnPrev = gridToolbar.getComponent('btnPrev');
        btnNext = gridToolbar.getComponent('btnNext');
        btnLast = gridToolbar.getComponent('btnLast');
        btnInsert = gridToolbar.getComponent('btnInsert');
        btnDelete = gridToolbar.getComponent('btnDelete');
        btnCut = gridToolbar.getComponent('btnCut');
        btnCopy = gridToolbar.getComponent('btnCopy');
		if (RamcoRTC.settings.isExt2 == true) {
			btnImpExcel = gridToolbar.getComponent('btnImpExcel');
			btnExpPdf = gridToolbar.getComponent('btnExpPdf');
			btnExpCsv = gridToolbar.getComponent('btnExpCsv'); // TECH-29986
			btnExpHtml = gridToolbar.getComponent('btnExpHtml');
			btnExpExcel = gridToolbar.getComponent('btnExpExcel');
		}
		else {
			btnExport = gridToolbar.getComponent('btnExport');
			btnExpPdf = btnExport.menu.items.getByKey('btnExpPdf');
			btnExpCsv = btnExport.menu.items.getByKey('btnExpCsv'); // TECH-29986
			btnExpHtml = btnExport.menu.items.getByKey('btnExpHtml');
			btnExpExcel = btnExport.menu.items.getByKey('btnExpExcel');
			btnImpExcel = menuImport.menu.items.getByKey('btnImpExcel');
		}

        if (e.shiftKey)
            shiftKey = 16;
        if (e.ctrlKey)
            ctrlKey = 17;
        if (evt == "80")
            map = shiftKey + parseInt(evt);
		else if (evt == "86") // TECH-29986
            map = shiftKey + parseInt(evt);
        else if (evt == "69")
            map = shiftKey + parseInt(evt);
        else if (evt == "72")
            map = shiftKey + parseInt(evt);
        else if (evt == "45")
            map = shiftKey + parseInt(evt);
        else if (evt == "46")
            map = shiftKey + parseInt(evt);
        else if (evt == "89" || evt == "118")
            map = ctrlKey + parseInt(evt);
        else if (evt == "88" || evt == "119")
            map = ctrlKey + parseInt(evt);
        else if (evt == "73")
            map = shiftKey + parseInt(evt);

        if (map == "96" && btnExpPdf) {
            grid.fireEvent('exportpdf', grid);
        } else if (map == "102" && btnExpCsv) { // TECH-29986
            grid.fireEvent('exportcsv', grid);
        } else if (map == "85" && btnExpExcel) {
            grid.fireEvent('exportexcel', grid);
        } else if (map == "88" && btnExpHtml) {
            grid.fireEvent('exporthtml', grid);
        } else if (map == "61" && btnInsert) {
            grid.onInsert('', e);
        } else if (map == "62" && btnDelete) {
            grid.fireEvent('deleterow', grid);
		// TECH-29544
        // } else if ((map == "107" || map == "135") && btnCut) { // TECH-29544
		} else if ((map == "105" || map == "136") && btnCut) {
            grid.fireEvent('cutappend', grid);
        // } else if ((map == "106" || map == "136") && btnCopy) { // TECH-29544
		} else if ((map == "106" || map == "135") && btnCopy) {
            grid.fireEvent('copyappend', grid);
        } else if (map == "89" && btnImpExcel) {
            grid.onImportExcel();
            if (!btnImpExcel.isHidden() && Ext.isEmpty(grid.importWindow)) {
                grid.importWindow = Ext.create('Ext.ramco.Import', {
                    height: 200,
                    width: 400,
                    scrollable: true,
                    hidden: true,
                    modal: true
                });
                grid.importWindow.BtnImport.on('click', grid.onBtnImportClick, grid);
            }
        } else if (evt == "36" && btnFirst) {
            grid.onBtnFirst();
        } else if (evt == "33" && btnPrev) {
            grid.onBtnPrev();
        } else if (evt == "34" && btnNext) {
            grid.onBtnNext();
        } else if (evt == "35" && btnLast) {
            grid.onBtnLast();
        } */
    },
	onChangeListData: function(ctrl, eOpts) {
		if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            i = 0,
            mappedId = ctrl.mappedId,
            itemId = ctrl.getItemId(),
            fields = ctrl.columns,
            mappedView = ctrl.mappedView,
            field = null,
            id = null,
            viewId = null,
			value = ctrl.getValue(),
            ctrlObj = null,
            len = mappedId ? mappedId.length : 0;
			
		//if(!value || value == '' || value == ctrl.lastValue)
		/* if(!value || value == '')
			return; */
		var selection = ctrl.getSelection();
		if (!selection) {
			ctrl.setValue(value);
			if (ctrl.mapCtrl) {
				//if ( viewModel.modified && viewModel.modified.indexOf(ctrl.mapCtrl[0]) == -1 ) {
					viewModel.setModified(ctrl.mapCtrl[0]);
					view.setControlData(ctrl.mapCtrl[0], ctrl.mapCtrl[0], 0, value);
				//}
			}
			return;
		}
		/* for (; i < len; i++) {
			id = (len == 1) ? itemId : mappedId[i];
			field = fields[i].itemId;
			viewId = mappedView[i];
			if(Ext.isEmpty(viewId))
				continue;
			ctrlObj = view.down("#" + viewId);
			if (ctrlObj) {
				ctrlObj.setValue(value);
				if (viewModel.modified.indexOf(viewId) == -1) {
					view.setControlData(viewId, viewId, 0, value);
				}
			}
			else
                view.setControlData(viewId, viewId, 0, value);
		} */
	},
    onSetListData: function(ctrl, record) {
		if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = null,
            taskType = null,
            i = 0,
            mappedId = ctrl.mappedId,
            itemId = ctrl.getItemId(),
            fields = ctrl.columns,
            mappedView = ctrl.mappedView,
            field = null,
            id = null,
            viewId = null,
            ctrlObj = null,
            rec = null,
            vs = null,
            store = null,
            len = mappedId ? mappedId.length : 0;
		
		ctrl.idField = record.id;
		
        for (; i < len; i++) {
            id = (len == 1) ? itemId : mappedId[i];
			if(ctrl.customListEdit === true)//AHBG-31834
				field = ctrl.fromView[i];
			else
            	field = fields[i].itemId;
            viewId = mappedView[i];
			if(Ext.isEmpty(viewId))
				continue;
            ctrlObj = view.down("#" + id);
			if (!ctrlObj)
				ctrlObj = view.down("#" + viewId);
            if (ctrlObj && ctrlObj.xtype == 'ramcogrid') {
                store = ctrlObj.getStore();
				if(!me.store && !store.isEmptyStore && store.cr) {
                rec = store.getAt(store.cr - 1);
                rec.set('rn', store.cr);
                vs = 'v' + viewId;
                rec.set(vs, record.get(field));
				}
            } else {
			if (ctrlObj) {
                ctrlObj.setValue(record.get(field));
				viewModel.setModified(id); // AHBG-27238
                if (viewModel.modified.indexOf(viewId) == -1) {
                    view.setControlData(viewId, viewId, 0, record.get(field));
                }
            } else {
                view.setControlData(viewId, viewId, 0, record.get(field));
            }
        }
        }
		//ctrl.idField = record.id;
		if (Ext.isFunction(ctrl.collapse))
			ctrl.collapse();
        if (ctrl.uiTask && !ctrl.focusLeave) {
            task = ctrl.uiTask;
            taskType = ctrl.taskType || "ui";
            //data = viewModel.getSessionData();
            me.taskPending = true;
            //view.fireEvent('trans', view, data, task, taskType);
			view.fireEvent('trans', view, data, task, taskType, '', '', '', '', '', itemId, itemId);
        }
    },
    onSetListGridData: function(ctrl, record) {
		if(this.taskPending)
			return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = null,
			grid = ctrl.ownerCt.grid,
			column = ctrl.ownerCt.column,
            taskType = null,
            i = 0,
            //mappedId = ctrl.editor.mappedId,
			mappedId = ctrl.mappedId,
            //itemId = ctrl.getItemId(),
            //fields = ctrl.editor.columns,
			fields = ctrl.columns,
            //mappedView = ctrl.editor.mappedView,
			mappedView = ctrl.mappedView,
            field = null,
            id = null,
            viewId = null,
            ctrlObj = null,
            rec = null,
            vs = null,
            store = null,
            len = mappedId ? mappedId.length : 0;
		if(ctrl.formListEdit === true) {
			grid = ctrl.ownerCt.ownerCmp;
			column = grid.getColumnById(ctrl.dataIndex);
		}			
        for (; i < len; i++) {
            //id = (len == 1) ? itemId : mappedId[i];
            field = fields[i].itemId;
            viewId = mappedView[i];
            //ctrlObj = view.down("#" + id);
			if(Ext.isEmpty(viewId))
				continue;
            if (grid) {
                store = grid.getStore();
                //rec = store.getAt(store.cr - 1);				
				rec = store.findRecord('rn', store.cr);
                rec.set('rn', store.cr);
                vs = 'v' + viewId;
				if(record.get)
					rec.set(vs, record.get(field));
				else
					rec.set(vs, record);
            } 
			/*
			else if (ctrlObj) {
                ctrlObj.setValue(record.get(field));
                if (viewModel.modified.indexOf(id) == -1) {
                    view.setControlData(id, id, 0, record.get(field));
                }
            } 
			else {
                view.setControlData(id, viewId, 0, record.get(field));
            }*/
            }
        if (column.uiTask) {
            task = column.uiTask;
            taskType = column.taskType || "ui";
            //data = viewModel.getSessionData();
            me.taskPending = true;
            view.fireEvent('mltrans', view, data, task, taskType, grid.itemId, column.name);
        }
    },
	onSetCustomListGridData: function(ctrl, record) {
		if(this.taskPending)
			return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = null,
			grid = ctrl.ownerCt.grid,
			column = ctrl.ownerCt.column,
            taskType = null,
            i = 0,
            //mappedId = ctrl.editor.mappedId,
			mappedId = ctrl.mappedId,
			fromView = ctrl.fromView,
            //itemId = ctrl.getItemId(),
            //fields = ctrl.editor.columns,
			fields = ctrl.columns,
            //mappedView = ctrl.editor.mappedView,
			mappedView = ctrl.mappedView,
            field = null,
            id = null,
            viewId = null,
            ctrlObj = null,
            rec = null,
            vs = null,
            store = null,
            //len = mappedId ? mappedId.length : 0;
			len = fromView ? fromView.length: 0;
        for (; i < len; i++) {
            //id = (len == 1) ? itemId : mappedId[i];
            //field = fields[i].itemId;
			field = ctrl.fromView[i];
            viewId = mappedView[i];
            //ctrlObj = view.down("#" + id);
			if(Ext.isEmpty(viewId))
				continue;
            if (grid) {
                store = grid.getStore();
                //rec = store.getAt(store.cr - 1);				
				rec = store.findRecord('rn', store.cr);
                rec.set('rn', store.cr);
                vs = 'v' + viewId;
				if(record.get)
                rec.set(vs, record.get(field));
				else
					rec.set(vs, record);
            }
		}
        if (column.uiTask) {
            task = column.uiTask;
            taskType = column.taskType || "ui";
            //data = viewModel.getSessionData();
            me.taskPending = true;
            view.fireEvent('mltrans', view, data, task, taskType, grid.itemId, column.name);
        }
	},
    onTreeNodeExpand: function(record) {
        if (record.id == 'root')
            return;
		//TECH-30667
        //if (record.childNodes && record.childNodes.length > 0)
            //return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            viewData = null,
            treeData = null,
			treeArrData = [],
            sTreeId, sNodeId, sNodeText, sNodeType, sParentId, sPNodeType, sChecked, sRowNo, sTreeNodeClicked, sHiddenValue, sHiddenCtrl, objControl, task, eventObj, isLeaf,
			tree;
        sTreeId = record.get('treeId');
        sNodeId = record.get('itemId');
        sNodeText = record.get('text');
        sNodeType = record.get('nodeType');
        sParentId = record.get('pid');
		//TECH-30667
        //sPNodeType = record.get('pnodeType') || record.get('nodeType');
		sPNodeType = record.get('pnodeType') || "";
        sRowNo = record.get('index');
        isLeaf = record.isLeaf();
		tree = view.down('#' + sTreeId);
		if (Ext.isEmpty(tree)){
			return;
		}		
		view.setControlData(sTreeId, sTreeId, 0, sNodeId);
		viewData = viewModel.getData();
		if (viewData && viewData[sTreeId]) {
			treeArrData = tree.treeArrData || [];
			treeData = viewData[sTreeId];
			if (treeData) {
				treeData.tree = true;
				treeData.st = 'e';
			}
			treeArrData.push(JSON.parse(JSON.stringify(treeData)));
		}
		tree.treeArrData = treeArrData;
		
		if (record.childNodes && record.childNodes.length > 0)
			return;
				
        if (record.get('checked') != undefined) {
            if (record.get('checked') == true)
                sChecked = "1";
            else
                sChecked = "0";
        } else
            sChecked = "2";

        sTreeNodeClicked = sNodeId;
        sNodeText = sNodeText.replace(/\\/g, "\\\\");
        sNodeId = sNodeId.replace(/\\/g, "\\\\");
        if (typeof sRowNo == 'undefined' || sRowNo == null)
            sRowNo = '';
        else
            sRowNo = ':!#@SCN@#!:' + sRowNo + ':!#@SCN@#!:EXP';
        //sHiddenValue = (sParentId + "##" + sPNodeType + "##" + sNodeId + "##" + sNodeText + "##" + sNodeType + "##" + sChecked + "##" + sRowNo);
        //sHiddenCtrl = 'txttvwtree_sectionnodeid';		
		//sHiddenValue = sNodeId;
        tree = view.down('#' + sTreeId);
        if (!tree)
            return;
		//sHiddenCtrl = tree.ascCtrl || 'txttvwtree_sectionnodeid';		
		// TECH-35909 - To call Expand method for any task (even for blank)
        // eventObj = tree.nts ? tree.nts[sNodeType.toLowerCase()] : {};
        //if (view && eventObj && eventObj.eventRequired && eventObj.eventRequired.toLowerCase() == 'y' && !isLeaf) {
            //task = eventObj.mappedTask;
            //view.setControlData(sHiddenCtrl, sHiddenCtrl, 0, sHiddenValue);
            
			/*view.setControlData(sTreeId, sTreeId, 0, sNodeId);
            viewData = viewModel.getData();
            if (viewData && viewData[sTreeId]) {
                treeData = viewData[sTreeId];
                if (treeData) {
                    treeData.tree = true;
                    treeData.st = 'e';
                }
            }*/
			if (view.callout && typeof view.callout[tree.itemId + "_expandedid"] == "function") {
				try {
					sHiddenValue = view.callout[tree.itemId + "_expandedid"].call(view || window, tree, sParentId, sPNodeType, sNodeId, sNodeText, sNodeType, sChecked, sRowNo);
				} 
				catch (e) {
					console.log("Error in Tree Expand Callout Js." + e);
				}
			}			
            //data = viewModel.getSessionData();
            //view.fireEvent('trans', view, data, task, 'ui', '', '', '', '', '', sHiddenCtrl, sHiddenCtrl);
        //}
    },
    onTreeNodeCollapse: function() {

    },
    onTreeNodeCheck: function(record, checked, e, rep) {
        if (e.type == 'keyup' && (e.keyCode != 13 && e.keyCode != 32))
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            viewData = null,
            treeData = null,
            pNode = null,
            allCheck = true,
            app = RamcoHub.getApplication(),
            main = app ? app.getController('MainController') : null,
            sTreeId, sNodeId, sNodeText, sNodeType, sParentId, sPNodeType, sChecked, sRowNo, sTreeNodeClicked, sHiddenValue, sHiddenCtrl, objControl, task, eventObj, ps, cs, isLeaf, cNode;
        if (main && !rep) {
            main.mask(true);
            Ext.defer(me.onTreeNodeCheck.bind(me, record, checked, e, true), 10);
            return;
        }
        sTreeId = record.get('treeId');
        sNodeId = record.get('itemId');
        sNodeText = record.get('text');
        sNodeType = record.get('nodeType');
        sParentId = record.get('pid');
		//TECH-30667
        //sPNodeType = record.get('pnodeType') || record.get('nodeType');
		sPNodeType = record.get('pnodeType') || "";
        sRowNo = record.get('index');
        ps = record.get('pSelect');
        cs = record.get('qSelect');
        isLeaf = record.isLeaf();
        if (ps != '0' && !isLeaf) {
            record.cascadeBy(function(node) {
                node.set('checked', checked);
                me.updateTreeNodeData(node, checked, null);
            })
        } else if (cs == '0' && !isLeaf) {
            record.cascadeBy(function(node) {
                node.set('checked', checked);
                me.updateTreeNodeData(node, checked, null);
            })
            if (ps == '0') {
                pNode = record.parentNode;
                while (pNode != null) {
                    len = pNode.childNodes.length;
                    while (len > 0) {
                        cNode = pNode.childNodes[len - 1];
                        if (cNode.get('checked') == false) {
                            allCheck = false;
                            len = -1;
                        }
                        len--;
                    }
                    if (allCheck)
                        pNode.set('checked', true);
                    else
                        pNode.set('checked', false);
                    if (!pNode.isRoot())
                        pNode = pNode.parentNode;
                    else
                        pNode = null;
                }
            }
        } else if (ps == '0') {
            pNode = record.parentNode;
            while (pNode != null) {
                len = pNode.childNodes.length;
                while (len > 0) {
                    cNode = pNode.childNodes[len - 1];
                    if (cNode.get('checked') == false) {
                        allCheck = false;
                        len = -1;
                    }
                    len--;
                }
                if (allCheck)
                    pNode.set('checked', true);
                else
                    pNode.set('checked', false);
                if (pNode && !pNode.isRoot())
                    me.updateTreeNodeData(pNode, allCheck, e);
                if (!pNode.isRoot())
                    pNode = pNode.parentNode;
                else
                    pNode = null;
            }
        }
        if (isLeaf)
            me.updateTreeNodeData(record, checked, e);
        if (main)
            main.mask(false);
    },
    updateTreeNodeData: function(record, checked, e) {
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            index,
			tree = null, // TECH-29848
            viewData = null,
            treeData = null,
			treeArrData = [],
            treeCtrl, gridCtrl, ascGrid, row, store, rec, values = {},
            count = 0,
            sTreeId, sNodeId, sNodeText, sNodeType, sParentId, sPNodeType, sChecked, sRowNo, sTreeNodeClicked, sHiddenValue, sHiddenCtrl, objControl, task, eventObj,
			ascStore;//TECH-30667
        sTreeId = record.get('treeId');
        sNodeId = record.get('itemId');
        sNodeText = record.get('text');
        sNodeType = record.get('nodeType');
        sParentId = record.get('pid');
		//TECH-30667
        //sPNodeType = record.get('pnodeType') || record.get('nodeType');
		sPNodeType = record.get('pnodeType') || "";
        sRowNo = record.get('index');
        //row = record.get('index');
		row = record.get('rowLevel');
        // TECH-29848
		tree = view.down('#' + sTreeId);
		if (!tree)
			return;

        treeCtrl = view.getControl(sTreeId);
        if (treeCtrl && treeCtrl.ascGrid) {
            ascGrid = treeCtrl.ascGrid;
            gridCtrl = view.getControl(ascGrid);
			//TECH-30667
			if (Ext.isEmpty(gridCtrl)) {				
				ascStore = viewModel.getStore(ascGrid + "_store");
				ascStore.si = 1;
				ascStore.vsi = 1;
			}
        }

        if (record.get('checked') != undefined) {
            if (record.get('checked') == true)
                sChecked = "1";
            else
                sChecked = "0";
        } else
            sChecked = "2";

        sTreeNodeClicked = sNodeId;
        sNodeText = sNodeText.replace(/\\/g, "\\\\");
        sNodeId = sNodeId.replace(/\\/g, "\\\\");
        if (typeof sRowNo == 'undefined' || sRowNo == null)
            sRowNo = '';
        else
            sRowNo = ':!#@SCN@#!:' + sRowNo + ':!#@SCN@#!:CLK';
        sHiddenValue = (sParentId + "##" + sPNodeType + "##" + sNodeId + "##" + sNodeText + "##" + sNodeType + "##" + sChecked + "##" + sRowNo);
        sHiddenCtrl = 'txttvwtree_sectionnodeid';
        viewData = viewModel.getData();		
		if (viewData && viewData[sTreeId]) {
			treeArrData = tree.treeArrData || [];
			treeData = viewData[sTreeId];
			if (treeData) {
				treeData.tree = true;
				treeData.sel = sNodeId;
			}
			treeArrData.push(JSON.parse(JSON.stringify(treeData)));
		}
		tree.treeArrData = treeArrData;
		//TECH-30667
        //if (gridCtrl) {
 		if (gridCtrl || ascStore) {
			//TECH-30667
            //store = gridCtrl.getStore();
			store = ascStore;
			if (gridCtrl) {
				store = gridCtrl.getStore();
			}
			index = store.find('isTree', true);
			if (index < 0)
				store.removeAll(true);
			count = store.getCount();
			index = store.find('v2', sNodeId);
			if (index >= 0)
				rec = store.getAt(index);
			if (rec && rec.get('isTree')) {
				rec.set("sel", checked);
				rec.set("isTree", true);
				rec.set("v1", sNodeText + ':!#@SCN@#!:' + row + ':!#@SCN@#!:CHK');
				rec.set("v2", sNodeId);
				rec.set("v3", sNodeType);
				rec.set("v4", sParentId);
				rec.set("v5", sPNodeType);
				rec.set("v6", (checked ? 'true' : 'false'));
				store.cr = rec.get('rn');
			} 
			else {
				values["rn"] = (count + 1);
				values["sel"] = checked;
				values["v1"] = sNodeText + ':!#@SCN@#!:' + row + ':!#@SCN@#!:CHK';
				values["v2"] = sNodeId;
				values["v3"] = sNodeType;
				values["v4"] = sParentId;
				values["v5"] = sPNodeType;
				values["v6"] = (checked ? 'true' : 'false');
				values["isNew"] = false;//TECH-30667
				values["isTree"] = true;
				store.add([values]);
				store.cr = (count + 1);
				rec = store.getAt(count);//TECH-30667				
			}
			store.changed = true;
			store.treeAssGridMl = true;//TECH-30667
			store.tr = store.getCount();	        
		}
    },
    onTreeNodeClick: function(treeView, record, item, index, e, eOpts) {
        if (e.type == 'keyup' && (e.keyCode != 13 && e.keyCode != 32))
            return;
        var tree = treeView.up('ramcotreepanel');
        if (!tree)
            tree = treeView.up('ramcorstreepanel');
        if (!tree)
            return;
        var me = this,
            ascCtrl = tree.ascCtrl || 'txttvwtree_sectionnodeid',
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            viewData = null,
			treeArrData = [],
            treeData = null,
            sTreeId, sNodeId, sNodeText, sNodeType, sParentId, sPNodeType, sChecked, sRowNo, sTreeNodeClicked, sHiddenValue, sHiddenCtrl, objControl, task, eventObj;
        sTreeId = record.get('treeId');
        sNodeId = record.get('itemId');
        sNodeText = record.get('text');
        sNodeType = record.get('nodeType');
        sParentId = record.get('pid');
		//TECH-30667
        //sPNodeType = record.get('pnodeType') || record.get('nodeType');
		sPNodeType = record.get('pnodeType') || "";
        sRowNo = record.get('index');

        if (record.get('checked') != undefined) {
            if (record.get('checked') == true)
                sChecked = "1";
            else
                sChecked = "0";
        } else
            sChecked = "2";

        sTreeNodeClicked = sNodeId;
        sNodeText = sNodeText.replace(/\\/g, "\\\\");
        sNodeId = sNodeId.replace(/\\/g, "\\\\");
        if (typeof sRowNo == 'undefined' || sRowNo == null)
            sRowNo = '';
        else
            sRowNo = ':!#@SCN@#!:' + sRowNo + ':!#@SCN@#!:CLK';
        //sHiddenValue = (sParentId + "##" + sPNodeType + "##" + sNodeId + "##" + sNodeText + "##" + sNodeType + "##" + sChecked + "##" + sRowNo);
		//sHiddenCtrl = 'txttvwtree_sectionnodeid';
        if (!tree)
            return;
        eventObj = tree.nts ? tree.nts[sNodeType.toLowerCase()] : {};
		tree.onClearDataSelection(tree.store);
		record.set('sel', true);
		record.addCls("x-tree-item-selected");
        if (view && eventObj && eventObj.eventRequired && eventObj.eventRequired.toLowerCase() == 'y') {
            task = eventObj.mappedTask;
            //view.setControlData(ascCtrl, ascCtrl, 0, sHiddenValue);
            view.setControlData(sTreeId, sTreeId, 0, sNodeId);
            viewData = viewModel.getData();
            if (viewData && viewData[sTreeId]) {
				treeArrData = tree.treeArrData || [];
				treeData = viewData[sTreeId];
				if (treeData) {
					treeData.tree = true;
					treeData.sel = sNodeId;
				}
				treeArrData.push(JSON.parse(JSON.stringify(treeData)));
			}
			tree.treeArrData = treeArrData;
			if (view.callout && typeof view.callout[tree.itemId + "_clickedid"] == "function") {
				try {
					//TECH-32131
					sPNodeType = sNodeType;
					sHiddenValue = view.callout[tree.itemId + "_clickedid"].call(view || window, tree, sParentId, sPNodeType, sNodeId, sNodeText, sNodeType, sChecked, sRowNo);
				} 
				catch (e) {
					console.log("Error in Tree Callout Js." + e);
				}
			}
            //data = viewModel.getSessionData();
            // view.fireEvent('trans', view, data, task, 'ui');
        }
    },
    onExpandAll: function(tree, task) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            taskType = 'trans';
        data = [];
        data = viewModel.getSessionData();
        me.taskPending = true;
        view.fireEvent('gridtool', view, data, task, taskType);

    },
	onTreeSearch: function(tree, searchTxt) {
		if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            taskType = 'trans',
			task = '',
			treeId = tree.getItemId(),
			searchType = 'Any Match',
			searchLvl = 'All',
			searchDefault = 'All',
			treeSrcData,
			rNode = tree.getRootNode(),
			data = [];
			nodeId = rNode.firstChild.data.itemId;
			if (tree.treeSearchWin) {
				treeSrcData = tree.treeSearchWin.getTreeData();
				searchType = treeSrcData.SEARCH;
				searchLvl = treeSrcData.LEVEL;
				searchDefault = treeSrcData.DEFAULT;				
			}
        me.taskPending = true;
        view.fireEvent('gettreesearch', view, data, task, taskType, treeId, searchTxt, searchType, searchLvl, nodeId, tree, searchDefault);
	},
    onTreeFilter: function() {

    },	
    updateErrorState: function(cmp, isValid) {
        var me = this,
            itemId = cmp.getItemId(),
            view = me.getView(),
            caption = cmp.caption || 'No Caption',
            msg;
        if (view.isInit) {
			if (isValid && me.errors.length == 0) {
				// TECH-30546 / QA-151
				view.fireEvent('errors', view, me.errors);
				return;
			}				
            if (!isValid && !cmp.isHidden()) {
				// TECH-39573
				var gridModel, gridCol, gridRec, rowNo;
				gridModel = cmp.ownerCt && cmp.ownerCt.context;
				if (gridModel && gridModel.grid) {
					gridCol = cmp.column;
					gridRec = gridModel.record;
					rowNo = (gridRec && gridRec.get('rn')) || 1;
					if (gridCol)
						caption = 'Row ' + rowNo + ' - ' + gridCol.text;
				}
                msg = cmp.getErrors().join(",");
                me.errors.add(itemId, {
                    itemId: itemId,
                    text: caption + ' ' + msg
                });
			} 
			else {
                me.errors.removeAtKey(itemId);
            }
            view.fireEvent('errors', view, me.errors);
        }
    },
    onIlboResize: function(view, width, height, eOpts) {
        var me = this,
            size = view.getSize(),
            zoomWindow = view.down('uigridzoom'),
            modelWindow = view.up('ramcomodalwindow');
        if (zoomWindow && !zoomWindow.isHidden()) {
            zoomWindow.center();
        }
        if (modelWindow) {
            modelWindow.center();
        }
		//me.view.updateLayout();
    },
    onSetChartDataVal: function(task, chrtlbl, chrtval, assctrl) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [];
        view.setControlData(assctrl, assctrl, 0, chrtlbl + "#$$#" + chrtval);
        data = viewModel.getSessionData();
        me.taskPending = true;
        view.fireEvent('trans', view, data, task, 'trans');
    },
	//TECH-27479
    onPanelCollapse: function(panel) {
        if (RamcoRTC.settings.preserveSectionCollapse) {
            var me = this;
            me.onSetSections(panel, '1');
        }
		var tabPanel  = panel.up('tabpanel');
			if(tabPanel)
				Ext.defer(function() { tabPanel.updateLayout(); } , 1);
    },
    onPanelExpand: function(panel) {
        if (RamcoRTC.settings.preserveSectionCollapse) {
            var me = this;
            me.onSetSections(panel, '0');
        }
		var tabPanel  = panel.up('tabpanel');
			if(tabPanel)
				Ext.defer(function() { tabPanel.updateLayout(); } , 1);
			
		
    },
    onSetSections: function(panel, state) {
        try {
            var me = this,
                viewModel = me.getViewModel(),
                pos;
            if (viewModel.modSections.length == 0)
                viewModel.modSections.push({
                    'id': panel.getItemId(),
                    'collapsed': state,
                    'title': panel.title
                });
            else {
                pos = viewModel.modSections.map(function(e) {
                    return e.id;
                }).indexOf(panel.getItemId());
                if (pos > -1)
                    viewModel.modSections[pos].collapsed = state;
                else
                    viewModel.modSections.push({
                        'id': panel.getItemId(),
                        'collapsed': state,
                        'title': panel.title
                    });
            }
        } catch (ex) {}
    }
});

// ILBO Model
Ext.define('Ext.ramco.IlboModel', {
    extend: 'Ext.app.ViewModel',
    alias: 'viewmodel.ilbo',
    modified: [],
    sections: [],
    modSections: [],
    controls: [],
    tabpage: [],
    nonModifiedTasks: ['fileupload', 'filedelete', 'filedownload'],
    tabControl: null,
    loadData: function(sessionData) {
        var me = this,
            cData = me.getData();
        sessionData.data.ci = me.copyAll(cData, sessionData.data.ci);
        sessionData.data.ci.dbFileUrl = me.getDBFileUrl(sessionData.data.ci.dbFileUrl.value, sessionData.data.ci.dbFileUrl.st);
        sessionData.data.ci.fileUrl = me.getFileUrl(sessionData.data.ci.fileUrl.value, sessionData.data.ci.fileUrl.st);
		sessionData.data.ci.avnFileDownloadUrl = me.avnFileDownloadUrl(sessionData.data.ci.avnDownloadfileUrl.value, sessionData.data.ci.avnDownloadfileUrl.st);
        me.setSessionData(sessionData);
    },
    getFileUrl: function(filePathUrl, st) {
        var me = this,
            view = me.getView(),
            ilboConfig = view.ilboConfig;
        return filePathUrl + "?RVWRTQS_EVENTNAME=filedownload&RVWRTQS_DTYPE=drive&RVWRTQS_COMPONENTNAME=" + ilboConfig.componentName.toLowerCase() + "&RVWRTQS_ACTIVITY=" + ilboConfig.activityName.toLowerCase() + "&RVWRTQS_ILBO=" + ilboConfig.ilboName.toLowerCase() + "&RVWRTQS_CONTROLNAME={0}&RVWRTQS_CONTROLVIEW={1}&RVWRTQS_ROWNO={2}&RVWRTQS_STOREPATH={3}&RVWRTQS_DVIEW={4}&RVWRTQS_MODE={5}&RVWRTQS_STOREPATH_VWNAME={6}&RVWRTQS_REQID=" + st + "&RVWRTQS_JUNK=" + new Date().getTime();
    },
    getDBFileUrl: function(dbFilePathUrl, st) {
        var me = this,
            view = me.getView(),
            ilboConfig = view.ilboConfig;
        //return dbFilePathUrl + "?RVWQS_ACTIVEUI=&RVWRTQS_CLIENTTYPE=ExtJs&RVWRTQS_REQTYPE=download&RVWRTQS_OPERATION=file&RVWRTQS_ACT=" + ilboConfig.activityName.toLowerCase() + "&RVWRTQS_ILBO=" + ilboConfig.ilboName.toLowerCase() + "&RVWRTQS_CN={0}&RVWRTQS_DVIEW={1}&RVWRTQS_CROW={2}&RVWRTQS_STOREPATH={3}&RVWRTQS_SVIEW={4}&RVWRTQS_MODE=null&RVWRTQS_STOREPATH=&RVWRTQS_JUNK=" + new Date().getTime() + "&RVWRTQS_REQID=" + st + "";
        return dbFilePathUrl + "?RVWRTQS_EVENTNAME=filedownload&RVWRTQS_DTYPE=db&RVWRTQS_COMPONENTNAME=" + ilboConfig.componentName.toLowerCase() + "&RVWRTQS_ACTIVITY=" + ilboConfig.activityName.toLowerCase() + "&RVWRTQS_ILBO=" + ilboConfig.ilboName.toLowerCase() + "&RVWRTQS_CONTROLNAME={0}&RVWRTQS_DVIEW={1}&RVWRTQS_ROWNO={2}&RVWRTQS_STOREPATH={3}&RVWRTQS_CONTROLVIEW={4}&RVWRTQS_MODE={5}&RVWRTQS_STOREPATH_VWNAME={6}&RVWRTQS_REQID=" + st + "&RVWRTQS_JUNK=" + new Date().getTime();
    },
	avnFileDownloadUrl: function(avnDownloadUrl, st) {
		var me = this,
            view = me.getView(),
            ilboConfig = view.ilboConfig;                
			avnDownloadUrl += "?RVWRTQS_COMPONENTNAME=" + ilboConfig.componentName.toLowerCase() + "&RVWRTQS_ACTIVITY=" + ilboConfig.activityName.toLowerCase() + "&RVWRTQS_ILBO=" + ilboConfig.ilboName.toLowerCase();
		return avnDownloadUrl += "&RVWRTQS_EVENTNAME={6}&RVWRTQS_CONTROLNAME={0}&RVWRTQS_CONTROLVIEW={1}&RVWRTQS_ROWNO={2}&RVWRTQS_IS_ML={3}&RVWRTQS_FILENAME={4}&RVWRTQS_REQID={7}&RVWRTQS_AVNDOWNLOAD=true&RVWRTQS_JUNK="+ new Date().toGMTString() +"&RVWRTQS_DVIEW=&RVWRTQS_MODE=&RVWRTQS_STOREPATH={5}";
	},
    getModified: function() {
        return this.modified;
    },
    hasModified: function() {
        var me = this,
            key = null,
            store = null,
            splitArr = null,
            storeName = null,
            retVal = false;
        if (me.modified.length > 0)
            retVal = true;
        else if (me.storeInfo) {
            for (key in me.storeInfo) {
                store = me.storeInfo[key];
                if (store.gridStore) {
                    splitArr = key.split('_store');
                    splitArr.pop();
                    storeName = splitArr.join('_store');
                    newData = store.getNewRecords();
                    modifiedData = store.getUpdatedRecords();
                    if (modifiedData.length > 0 || newData.length > 1 || store.changed) {
                        retVal = true;
                    }
                }
            }
        }
        return retVal;
    },
    setModified: function(id) {
        if (this.modified.indexOf(id) < 0)
            this.modified.push(id);
    },
    clearModified: function() {
        this.modified = [];
    },
    getSessionData: function() {
        var me = this,
            data = me.getData(),
            view = me.getView(),
            newData = [],
            storeData = [],
            selectedData = [],
            modifiedData,
            mlSessionData,
            store,
            storeName,
            splitArr,
            startIndex,
            endIndex,
            vitualStartIndex,
            si,
            grid,
            len,
            itm,
            stData,
            row = {},
            rows = [],
			els = [], // TECH-37768
            fields = [],
            sessionData = [],
            selRow = {},
            selRows = [],
            key,
            k = 0,
            i = 0,
            j = 0,
            captcha = [],
			sData = {},
            pushVal = false,
            isChanged = false,
			dataPrec,
			gridObj, // TECH-37768
			colObj,
            rec;
		if(me.modified && me.modified.length > 0) {
			var len = me.modified.length,
				i = 0,
				element = null;
			for(; i < len; i++) {
				element = me.modified[i];			
				//me.modified.forEach(function(element, index, array) {
	            var ctrl = data[element],
	                ctrlObj = view.down('#' + element),
	                vType = ctrlObj ? ctrlObj.inputType : '',
	                value;
				if (Ext.isEmpty(vType)) {
					vType = ctrl ? ctrl.xtype : '';
				}
				
				if (!vType && element == 'ide_password' && view.login && view.login.pwd)
					vType = view.login.pwd.inputType;
				
				if(ctrlObj && ctrlObj.xtype == "window" && ctrlObj.rtPop == true) {
					sessionData.push({
						id: ctrlObj.itemId,
						vl: "0",
						rtPop: true
					});
				}						
				//TECH-35056
				if(ctrlObj && (ctrlObj.xtype == "link" || ctrlObj.xtype == "datahyperlink") && !Ext.isEmpty(ctrlObj.metaLink)) {
					sessionData.push({
						id: ctrlObj.itemId,					
						vwn: ctrlObj.metaLink,
						v: ctrlObj.value,
						vl: ctrlObj.value,
						isDynamic: true					
					});
					continue;
				}
	            if (ctrl) {
					if(RamcoRTC.settings.SendOpenPasswordToClientWithoutSecurity == true && (vType == 'password' || vType == 'ramcopassword'))
						vType = 'text';
					if (ctrl && ctrlObj && ctrlObj.xtype == "ramcopassword")
						value = ctrl.value;
					else
						value  = ctrlObj && ctrlObj.getValue ?  ctrlObj.getValue() : ctrl.value;
	
					// TECH-29081 / TECH-29216				
					// TECH-32120 / TECH-32134
					dataPrec = null;//TECH-32618
					if (ctrlObj && Ext.isFunction(ctrlObj.getFormat))
						dataPrec = ctrlObj.getFormat();
					// TECH-35101
					if (ctrl.controlType != 'RSCheck' && vType != 'checkbox')
						value = me.getRawFormat(ctrlObj ? (ctrlObj.ctype || ctrlObj.dataType || ctrlObj.datatype || ctrl.dt) : ctrl.dt, value, (vType == 'password' || vType == 'ramcopassword'), dataPrec);
	                if (ctrl.controlType == 'RSGroup' || (typeof value == 'object' && value != null)) {
	                    value = value[ctrl.name];
	                } 
					else if (ctrl.controlType == 'RSCheck' || (ctrlObj && ctrlObj.xtype == 'checkboxfield')) {
						var dt = ctrlObj ? (ctrlObj.dataType || ctrlObj.datatype || ctrl.dt) : ctrl.dt;
	            		if (dt == 'char')
	                    	value = (value == true) ? '1' : '0';
	                	else if (dt == 'integer' || dt == 'int' || dt == 'float' || dt == 'number')
	                    	value = (value == true) ? 1 : 0;
						else
							value = (value == true) ? '1' : '0';
	                }
					else if (ctrl.controlType == 'RSTextArea' && (ctrlObj && ctrlObj.xtype == 'ramcohtmleditor' && ctrlObj.editor)) {
						ctrlObj.editorChange = false;
					}
					// Vulnerability
					// TECH-31776				
					/*if (RamcoRTC.settings.purifyText != false) {
						
						// if(ctrl.controlType == 'RSTextArea')
						//		value = DOMPurify.sanitize(value,{ALLOWED_TAGS:RamcoRTC.settings.validHTMLEditorTags || []});
						// else
						//		value = DOMPurify.sanitize(value,{ALLOWED_TAGS:RamcoRTC.settings.validHTMLTags || []}); 
						value = DOMPurify.sanitize(value);
					}*/
					
					// TECH-33131 - SEH-318 / TAQ-381
					if (view.ilboConfig.activityName == 'ezwizard' && view.activeTabName == 'wizard1' && 'wizard1' && element == 'hdnnew_activitykey')
						value = value;
					else {
						//TECH-32076
						value = purifyDom(value);
					}
						
					if(ctrlObj && (ctrlObj.xtype == "slidercontainer" || ctrlObj.xtype == "ramcorating")) {
						sessionData.push({
	                        id: element,
	                        vl: ctrlObj.getEndValue(),
							slider: true
	                    });
					}
	                else if (ctrl.at || ctrl.nl)
	                    sessionData.push({
	                        id: element,
	                        vl: value,
	                        nl: ctrl.nl,
	                        at: ctrl.at
	                    });
	                else if (ctrl.tree) {
	                    sessionData.push({
	                        tree: true,
	                        id: element,
	                        vl: ctrlObj.treeArrData,
	                        st: ctrl.st,
	                        stp: ctrl.stp,
	                        sll: ctrl.sll,
							sel: ctrl.sel
	                    });
						ctrlObj.treeArrData = null;
						delete ctrlObj.treeArrData;
					}
	                else if (vType == 'password' || vType == 'ramcopassword')
	                    sessionData.push({
	                        id: element,
	                        pl: true,
	                        vl: value
	                    });
	                else{
						if(ctrl.isDynamic){
							sessionData.push({
								id: element,
								vl: value,
								isDynamic:true,
								vwn:element
							});
						}
						else{
		                    sessionData.push({
		                        id: element,
		                        vl: value
		                    });
	            		}
					}
	            }
			}
		//);
		}
        if (me.modSections && me.modSections.length > 0) {
            sessionData.push({
                id: 'statesecs',
                v1: me.modSections
            });
        }
        captcha = view.query("ramcocaptcha");
        if (captcha && captcha.length > 0) {
            //captcha.forEach(function(element, index, array) {
			var len = captcha.length,
				  i = 0,
				  element = null;
			for(; i < len; i++) {
				element = captcha[i];
                sessionData.push({
                    id: element.itemId,
                    vl: element.getValue()
                });
            }
			//)
        }
        for (key in me.storeInfo) {
            store = me.storeInfo[key];
            if (store.gridStore) {
                splitArr = key.split('_store');
                splitArr.pop();
                storeName = splitArr.join('_store');
                //startIndex = store.start;
                startIndex = store.si || store.start;
                endIndex = store.end;
                vitualStartIndex = store.vsi;
                selRow = {};
                selRows = [];
				mlSessionData = {};
                storeSource = store.getData().getSource();
                storeData = storeSource ? storeSource.getRange() : [];
				// TECH-37768
				gridObj = view.down('#' + storeName);
                newData = store.getNewRecords();
				if (newData && newData.length > 1)
					newData = newData.sort(function(a, b) {var s = (parseInt(a.get("rn")) - parseInt(b.get("rn"))); if(s>0) s = 1; else if(s<0) s=-1; else s=0; return s});
                len = store.getCount();
                if (Ext.isEmpty(storeSource) && len > 0) {
                    for (i = 0; i < len; i++) {
                        itm = store.getAt(i);
                        if (itm.get('sel') == true) {
                            selRow = {
                                _mod: (itm.get('sel') == true) ? false : true,
                                rn: itm.get('rn'),
                                sel: itm.get('sel')
                            };
                            selRows.push(selRow);
                        }
                    }
                } 
				else {
                    for (i = 0; i < storeData.length; i++) {
                        if (storeData[i].data['sel'] == true) {
                            selRow = {
                                _mod: (storeData[i].data["sel"] == true) ? false : true,
                                rn: storeData[i].data["rn"],
                                sel: storeData[i].data["sel"]
                            };
                            selRows.push(selRow);
                        }
                    }
                }
                modifiedData = store.getModifiedRecords();
				if (modifiedData && modifiedData.length > 1)
					modifiedData = modifiedData.sort(function(a, b) {var s = (parseInt(a.get("rn")) - parseInt(b.get("rn"))); if(s>0) s = 1; else if(s<0) s=-1; else s=0; return s});
                if (modifiedData.length > 0 || newData.length > 0 || store.changed || (!Ext.isEmpty(gridObj) && gridObj.gridCutCopyAppend  == true)) {
                    isChanged = store.changed;
                    store.changed = false;
                    //mlSessionData = {};                 
                    isModified = false,
                        fields = store.config.fields;
                    row = {};
                    rows = [];
					els = []; // TECH-37768
                    if (startIndex > 0 || mlSessionData['r']) {
                        mlSessionData['si'] = startIndex;
                        mlSessionData['vsi'] = vitualStartIndex;
                        mlSessionData['cr'] = store.cr;
                        rec = store.getAt(store.tr - 1);
                        mlSessionData['tr'] = store.tr;
                        if (rec && rec.data.isNew == true)
                            mlSessionData['tr'] = store.tr - 1;
                        mlSessionData['vr'] = store.vr;
                        mlSessionData['nsr'] = store.nsr || 0;
						var dataPrec = '',
							rowIdx; // TECH-38022
                        if (modifiedData && modifiedData.length > 0) {
                            i = 0;
                            for (; i < modifiedData.length; i++) {
                                row = {};
                                modifiedRecord = modifiedData[i];
								// TECH-38022
								rowIdx = newData && newData.findIndex(function(a) {return a.data.rn == modifiedRecord.data.rn});
								if ((!Ext.isEmpty(modifiedRecord.data.isNew) && modifiedRecord.data.isNew == true) || modifiedRecord.data.isTree || (rowIdx > -1))
                                    continue;
                                k = 0;
                                isModified = false;
                                row['rn'] = modifiedRecord.get('rn');
                                row['sel'] = modifiedRecord.get('sel');
                                for (; k < fields.length; k++) {
                                    fieldName = fields[k].name;
                                    fieldValue = modifiedRecord.get(fieldName);
									dataPrec = (store.prec) ? store.prec[fields[k].name]  : '';
                                    //if (Ext.String.hasHtmlCharacters(fieldValue) || typeof modifiedRecord.modified[fieldName] == 'undefined')
                                    if (modifiedRecord.modified && typeof modifiedRecord.modified[fieldName] == 'undefined' && modifiedRecord.isNew != false)
                                        continue;
                                    if (fieldName != 'rn' && fieldName != 'sel')
                                        isModified = true;
                                    if (Ext.isEmpty(fieldValue))
                                        row[fieldName] = '';
                                    else {
										// Vulnerability
										// TECH-29059 / UFS-517
										var dataType = fields[k].ctype || fields[k].type;
										// TECH-31776
										//if (RamcoRTC.settings.purifyText != false) {
											// TECH-29724 / TECH-30051											
											//TECH-30928
											if (!Ext.isEmpty(gridObj) && gridObj.xtype != 'horizontalview' && gridObj.xtype != 'verticalview' && gridObj.xtype != 'questioner' && gridObj.xtype != 'ramcotagfield' && gridObj.xtype != 'ramcod3cloud') {
												// TECH-32076 / TECH-32685
												if (fieldName != 'rn' && fieldName != 'sel')
													fieldValue = purifyDom(fieldValue);
											}
										//}
                                        row[fieldName] = me.getRawFormat(dataType, fieldValue, null, dataPrec);
                                	}
                                }
                                row['_mod'] = isModified;
                                rows.push(row);
                            }
                        }
                        if (newData && newData.length > 0) {
                            i = 0;
                            var rLen = rows.length;
                            for (; i < newData.length; i++) {
                                row = {};
                                newRecord = newData[i];
                                if (newRecord.get('isNew'))
                                    continue;
                                k = 0;
                                row['rn'] = newRecord.get('rn');
                                row['sel'] = newRecord.get('sel');
                                for (; k < fields.length; k++) {
                                    fieldName = fields[k].name;
                                    fieldValue = newRecord.get(fieldName);
									dataPrec = (store.prec) ? store.prec[fields[k].name]  : '';
                                    if (Ext.isEmpty(fieldValue))
                                        row[fieldName] = '';
                                    else
                                        row[fieldName] = me.getRawFormat(fields[k].ctype || fields[k].type, fieldValue, null, dataPrec);
                                }
                                row['_mod'] = true;
                                //if (rLen == 0)
								rows.push(row);
                                /*for (j = 0; j < rLen; j++) {
										if (rows[i].rn == row.rn)
											pushVal = false;                                    
										if (pushVal == true)
											rows.push(row);
									else // For isNew false/true all row value should sent in request
										rows[i] = row;
								}*/
                            }
                        }
						if (!Ext.isEmpty(gridObj) && gridObj.gridCutCopyAppend  == true) {
							k = 0;
							fields = store.config && store.config.fields;
							for (; fields && k < fields.length; k++) {
								fieldName = fields[k].name;
								if (fieldName != 'rn' && fieldName != 'sel') {
									colObj = gridObj.getColumnById(fieldName);
									if (colObj && (colObj.xtype == 'attachcolumn' || colObj.xtype == 'fileattachcolumn')) {
										fieldName = fieldName.replace('v', '');
										if (els.indexOf(fieldName) < 0)
											els.push(fieldName);
									}
								}
							}
							if (els.length > 0) {
								mlSessionData['el'] = els;
									delete  gridObj.gridCutCopyAppend;
							}
						}
                        mlSessionData['r'] = rows;
						// TECH-31313 / TECH-31324
						var storeAllRecords;
						if (store.isFiltered())
							storeAllRecords = store.getDataSource() && store.getDataSource().items;
						else
							storeAllRecords = store.getRange();
					
						var selection = [];
						var curRecord;
						for (var sr =0; storeAllRecords && sr < storeAllRecords.length; sr++) {
							curRecord = storeAllRecords[sr].data;		
							if (curRecord.sel) {
								selection.push({rn :curRecord.rn, sel: '1'});								
							} else {
								selection.push({rn :curRecord.rn, sel: '0'});
							}
						}	
						mlSessionData['selection']	= selection;					
						sData = {
                            id: storeName,
                            ml: true,
                            vl: mlSessionData,
                            dv: store.dataView
                        }
						if (store && store.task) {
							sData.task = store.task;
							store.task = null;
							delete store.task;
						}
						if (store && store.storeType == "ddt") {
							delete sData.ml;
							sData.ddt = true;
						}
						//TECH-30667
						if (store && store.treeAssGridMl) {							
							sData.treeAssGridMl = true;
						}
						if (store && store.searchGrid) {
							sData.rsListView = true;
						}
						//TECH-35056
						if (store && store.isDynamic) {
							sData.vl.isDynamic = true;
							delete store.isDynamic;
						}
                        sessionData.push(sData);
                        stData = sessionData[sessionData.length - 1];
                        if (key == "mlmessageml_store") {
                            var inboxData = store.getAt(store.cr - store.start);
                            if (inboxData)
                                stData.md = inboxData;
                        }
		                i = 0;
		                j = 0;
		                len = (stData && stData.vl && stData.vl.r) ? stData.vl.r.length : 0;
		
		                for (; i < len; i++) {
		                    for (; j < selRows.length; j++) {
		                        if (stData && stData.vl && stData.vl.r[i].rn == selRows[j].rn) {
		                            selRows.splice(j, 1);
		                            break;
		                        } else {
		                            if (stData.vl && stData.vl.r) {
		                                stData.vl.r.push(selRows[j]);
		                                break;
		                            }
		                        }
		                    }
		                }
		                if (selRows.length > 0) {
		                    for (var i = 0; i < selRows.length; i++) {
		                        if (stData && stData.vl && stData.vl.r)
		                            stData.vl.r.push(selRows[i]);
		                    }
		                }
                    }
                }
                if (store && isChanged)
                    store.commitChanges();
            } 
			else if (store.treeStore) {
                splitArr = key.split('_store');
                splitArr.pop();
                storeName = splitArr.join('_store');
                newData = store.getNewRecords();
                mlSessionData = {};
				//AHBG-25919, AHBG-25777, AHBG-24045, AHBG-24044
                //modifiedData = store.getUpdatedRecords();
				modifiedData = store.getRange();
                if (modifiedData.length > 0 || newData.length > 0 || store.changed) {
                    store.changed = false;
                    isModified = false,
                        fields = store.config.fields;
                    row = {};
                    rows = [];
                    mlSessionData['si'] = 1;
                    mlSessionData['vsi'] = 1;
                    mlSessionData['cr'] = '';
                    mlSessionData['tr'] = store.getCount();
                    mlSessionData['vr'] = store.getCount();
                    mlSessionData['nsr'] = '';
                    if (modifiedData && modifiedData.length > 0) {
                        i = 0;
                        for (; i < modifiedData.length; i++) {
                            row = {};
                            modifiedRecord = modifiedData[i];
                            k = 0;
                            isModified = false;
                            row['rn'] = modifiedRecord.get('_rn');
							row['st'] = modifiedRecord.get('expanded') ? "e" : "c";
							row['id'] = modifiedRecord.get('id');
                            for (; k < fields.length; k++) {
                                fieldName = fields[k].name;
                                fieldValue = modifiedRecord.get(fieldName);
                                if (Ext.String.hasHtmlCharacters(fieldValue))
                                    continue;
								//AHBG-25919, AHBG-25777, AHBG-24045, AHBG-24044
                                if (fieldName != '_rn' && fieldName != 'sel')
                                    isModified = true;
                                if (Ext.isEmpty(fieldValue))
                                    row[fieldName] = '';
                                else
                                    row[fieldName] = me.getRawFormat(fields[k].ctype || fields[k].type, fieldValue);
                            }
                            row['_mod'] = isModified;
                            rows.push(row);
                        }
                    }
                    if (newData && newData.length > 0) {
                        i = 0;
                        for (; i < newData.length; i++) {
                            row = {};
                            newRecord = newData[i];
                            if (newRecord.get('isNew'))
                                continue;
                            k = 0;
                            for (; k < fields.length; k++) {
                                fieldName = fields[k].name;
                                fieldValue = newRecord.get(fieldName);
                                if (Ext.isEmpty(fieldValue))
                                    row[fieldName] = '';
                                else
                                    row[fieldName] = me.getRawFormat(fields[k].ctype || fields[k].type, fieldValue);

                            }
                            row['_mod'] = true;
                            rows.push(row);
                        }
                    }
					//AHBG-25919, AHBG-25777, AHBG-24045, AHBG-24044
                    mlSessionData['r'] = rows;
                    sessionData.push({
                        id: storeName,
                        treeMlData: true,
                        vl: mlSessionData
                    });
					sessionData.push({
                        id: storeName,
                        treeml: true,
                        vl: mlSessionData
                    });
                }
            }
			else if (store.stackStore) {
                splitArr = key.split('_store');
                splitArr.pop();
                storeName = splitArr.join('_store');
                startIndex = store.si || store.start || 1;
                endIndex = store.end;
                vitualStartIndex = store.vsi || 1;
                modifiedData = store.getUpdatedRecords();
                if (modifiedData.length > 0 || store.changed) {
                    store.changed = false;
                    mlSessionData = {};
                    isModified = false;
                    fields = store.config.fields;
                    row = {};
                    rows = [];
                    if (startIndex > 0 || mlSessionData['r']) {
                        mlSessionData['si'] = startIndex;
                        mlSessionData['vsi'] = vitualStartIndex;
                        mlSessionData['cr'] = store.cr;
                        mlSessionData['tr'] = store.tr;
                        if (modifiedData && modifiedData.length > 0) {
                            i = 0;
                            for (; i < modifiedData.length; i++) {
                                modifiedRecord = modifiedData[i];
                                if (!modifiedRecord.get('sel'))
                                    continue;
                                k = 0;
                                isModified = false;
                                mlSessionData['rn'] = modifiedRecord.get('rn');
                                for (; k < fields.length; k++) {
                                    fieldName = fields[k].name;
                                    fieldValue = modifiedRecord.get(fieldName);
                                    fieldValue = Ext.util.Format.stripTags(fieldValue);
                                    if (fieldName != 'rn' && fieldName != 'sel')
                                        isModified = true;
                                    if (Ext.isEmpty(fieldValue))
                                        mlSessionData['lktl'] = '';
                                    else
                                        mlSessionData['lktl'] = me.getRawFormat(fields[k].ctype || fields[k].type, fieldValue);
                                }
                                mlSessionData['_mod'] = isModified;
                            }
                        }
                        sessionData.push({
                            id: storeName,
                            sl: true,
                            vl: mlSessionData
                        });
                    }
                }
            }
			else if (store.rsTreeStore || store.orgTreeStore) {
                splitArr = key.split('_store');
                splitArr.pop();
                storeName = splitArr.join('_store');                
				startIndex = store.si || store.start;
                endIndex = store.end;
                vitualStartIndex = store.vsi;
                selRow = {};
                selRows = [];
                storeSource = store.getData().getSource();
                storeData = storeSource ? storeSource.getRange() : [];
                newData = store.getNewRecords();
                len = store.getCount();
				if(store.selRows && store.selRows.length > 0) {
					selRows = store.selRows;
				}
				//TECH-37260
                if (Ext.isEmpty(storeSource) && len > 0) {
                    for (i = 0; i < len; i++) {
                        itm = store.getAt(i);
                        if (itm.get('sel') == true) {
                            selRow = {
                                _mod: (itm.get('sel') == true) ? false : true,
                                rn: itm.get('rn'),
                                sel: itm.get('sel')
                            };
                            selRows.push(selRow);
                        }
                    }
                } else {
                    for (i = 0; i < storeData.length; i++) {
                        if (storeData[i].data['sel'] == true) {
                            selRow = {
                                _mod: (storeData[i].data["sel"] == true) ? false : true,
                                rn: storeData[i].data["rn"],
                                sel: storeData[i].data["sel"]
                            };
                            selRows.push(selRow);
                        }
                    }
                }
                modifiedData = store.getRemovedRecords();
				if(modifiedData.length == 0)
					modifiedData = store.getModifiedRecords();
                if (modifiedData.length > 0 || newData.length > 0 || store.changed || selRows) {
                    isChanged = store.changed;
                    store.changed = false;
                    mlSessionData = {};
                    isModified = false,
                        fields = store.config.fields;
                    row = {};
                    rows = [];
                    if (startIndex > 0) {
                        mlSessionData['si'] = startIndex;
                        mlSessionData['vsi'] = vitualStartIndex;
                        mlSessionData['cr'] = store.cr;
                        rec = store.getAt(store.tr - 1);
                        mlSessionData['tr'] = store.tr;
                        if (rec && rec.data.isNew == true)
                            mlSessionData['tr'] = store.tr - 1;
                        mlSessionData['vr'] = store.vr;
                        mlSessionData['nsr'] = store.nsr || 0;
                        if (modifiedData && modifiedData.length > 0) {
                            i = 0;
                            for (; i < modifiedData.length; i++) {
                                row = {};                                
                                modifiedRecord = modifiedData[i];
                                k = 0;
                                isModified = false;
                                row.rn = modifiedRecord.get('rn');
                                row.sel = modifiedRecord.get('sel');
								row.nid = modifiedRecord.get('nid');
								row.pnid = modifiedRecord.get('pnid');
								row.ex = modifiedRecord.get('ex');								
								for (; k < fields.length; k++) {
                                    fieldName = fields[k].name;
                                    fieldValue = modifiedRecord.get(fieldName);
									if(fieldName == 'rn') {
										//fieldValue = (store.bufferedStore) ? modifiedRecord.get('in') : modifiedRecord.get('rn');
										fieldValue = modifiedRecord.get('in') || modifiedRecord.get('rn');
										//fieldValue = modifiedRecord.get('rn');
										if(modifiedRecord.get('isNew')) {
											fieldValue = modifiedRecord.get('rn');
										}
										row['rn'] = fieldValue;
									}
                                    //if (Ext.String.hasHtmlCharacters(fieldValue) || typeof modifiedRecord.modified[fieldName] == 'undefined')
									//if (modifiedRecord.modified && typeof modifiedRecord.modified[fieldName] == 'undefined')
                                        //continue;
                                    if (fieldName != 'rn' && fieldName != 'sel') {
                                        isModified = true;
									}
									if(modifiedRecord.get('isNew')) {
										isModified = true;										
									}
                                    if (Ext.isEmpty(fieldValue))
                                        row[fieldName] = '';
                                    else
                                        row[fieldName] = me.getRawFormat(fields[k].ctype || fields[k].type, fieldValue);									
                                }
								if(modifiedRecord.get('isDel') === "true") {
									isModified = false;
								}
                                row['_mod'] = isModified;
                                rows.push(row);
                            }
                        }
                        if (newData && newData.length > 0) {
                            i = 0;
                            var rLen = rows.length;
                            for (; i < newData.length; i++) {
                                row = {};
                                newRecord = newData[i];
                                if (newRecord.get('isNew'))
                                    continue;
                                k = 0;
                                row['rn'] = newRecord.get('rn');
                                row['sel'] = newRecord.get('sel');
                                for (; k < fields.length; k++) {
                                    fieldName = fields[k].name;
                                    fieldValue = newRecord.get(fieldName);
                                    if (Ext.isEmpty(fieldValue))
                                        row[fieldName] = '';
                                    else
                                        row[fieldName] = me.getRawFormat(fields[k].ctype || fields[k].type, fieldValue);

                                }
                                row['_mod'] = true;
                                if (rLen == 0)
                                    rows.push(row);
                                for (j = 0; j < rLen; j++) {
                                    if (rows[i].rn == row.rn)
                                        pushVal = false;
                                    if (pushVal == true)
                                        rows.push(row);
                                }
                            }
                        }
                        mlSessionData['r'] = rows;
						if(rows.length > 0) {
							sessionData.push({
								id: storeName,
								rstree: true,
								vl: mlSessionData,
								dv: store.dataView
							});
							stData = sessionData[sessionData.length - 1];
							if (key == "mlmessageml_store") {
								var inboxData = store.getAt(store.cr - store.start);
								if (inboxData)
									stData.md = inboxData;
							}
						}
                    }
                }
				//TECH-37260
                i = 0;
                j = 0;
                len = (stData && stData.vl && stData.vl.r) ? stData.vl.r.length : 0;
                for (; i < len; i++) {
                    for (; j < selRows.length; j++) {
						if (stData.vl && stData.vl.r) {
							stData.vl.r.push(selRows[j]);
							break;
						}
                    }
                }
                if (selRows.length > 0) {
                    for (var i = 0; i < selRows.length; i++) {
                        if (stData && stData.vl && stData.vl.r)
                            stData.vl.r.push(selRows[i]);
                    }
                }
                if (store && isChanged)
                    store.commitChanges();
            } 
		   //store.commitChanges();
		   if(view && view.customPayload)
				sessionData.customPayLoad = view.customPayload;
        };		
		if (view.expGridStore) {
			store = view.expGridStore;
			var currPage = store.currentPage,
				pageSize = store.getPageSize();
			startIndex = ((currPage - 1) * pageSize) + 1,
			splitArr = store.storeId.split('_buffStr');
			splitArr.pop();
			storeName = splitArr.join('_buffStr');
			newData = store.getNewRecords();
			mlSessionData = {};
			modifiedData = store.getUpdatedRecords();
			if (modifiedData.length > 0 || newData.length > 0 || store.changed) {
				isChanged = store.changed;
				store.changed = false;
				mlSessionData = {};
				isModified = false,
				fields = store.config.fields;
				row = {};
				rows = [];
				if (startIndex > 0 || mlSessionData['r']) {
					mlSessionData['si'] = startIndex;
					mlSessionData['vsi'] = startIndex;
					mlSessionData['cr'] = store.cr;
					rec = store.getAt(store.totalCount - 1);
					mlSessionData['tr'] = store.totalCount;
					if (rec && rec.data.isNew == true)
						mlSessionData['tr'] = store.totalCount - 1;
					mlSessionData['vr'] = pageSize;
					mlSessionData['nsr'] = store.nsr || 0;
					if (modifiedData && modifiedData.length > 0) {
						i = 0;
						for (; i < modifiedData.length; i++) {
							row = {};
							if (modifiedData[i].data.isNew || modifiedData[i].data.isTree)
								continue;
							modifiedRecord = modifiedData[i];
							k = 0;
							isModified = false;
							row['rn'] = modifiedRecord.get('rn');
							row['sel'] = modifiedRecord.get('sel');
							for (; k < fields.length; k++) {
								fieldName = fields[k].name;
								fieldValue = modifiedRecord.get(fieldName);                                    
								if (modifiedRecord.modified && typeof modifiedRecord.modified[fieldName] == 'undefined' && modifiedRecord.isNew != false)
									continue;
								if (fieldName != 'rn' && fieldName != 'sel')
									isModified = true;
								if (Ext.isEmpty(fieldValue))
									row[fieldName] = '';
								else
									row[fieldName] = me.getRawFormat(fields[k].ctype || fields[k].type, fieldValue);
							}
							row['_mod'] = isModified;
							rows.push(row);
						}
					}
					if (newData && newData.length > 0) {
						i = 0;
						var rLen = rows.length;
						for (; i < newData.length; i++) {
							row = {};
							newRecord = newData[i];
							if (newRecord.get('isNew'))
								continue;
							k = 0;
							row['rn'] = newRecord.get('rn');
							row['sel'] = newRecord.get('sel');
							for (; k < fields.length; k++) {
								fieldName = fields[k].name;
								fieldValue = newRecord.get(fieldName);
								if (Ext.isEmpty(fieldValue))
									row[fieldName] = '';
								else
									row[fieldName] = me.getRawFormat(fields[k].ctype || fields[k].type, fieldValue);

							}
							row['_mod'] = true;
							if (rLen == 0)
								rows.push(row);
							for (j = 0; j < rLen; j++) {
								if (rows[i].rn == row.rn)
									pushVal = false;
								if (pushVal == true)
									rows.push(row);
							}
						}
					}					
					mlSessionData['r'] = rows;
					//TECH-30391
					var storeAllRecords = store.getRange();
					var selection = [];
					var curRecord;
					for (var sr =0; sr < storeAllRecords.length; sr++) {
						curRecord = storeAllRecords[sr].data;		
						if (curRecord.sel) {
							selection.push({rn :curRecord.rn, sel: '1'});								
						} else {
							selection.push({rn :curRecord.rn, sel: '0'});
						}
					}	
					mlSessionData['selection']	= selection;
					sData = {
						id: storeName,
						ml: true,
						vl: mlSessionData,
						dv: store.dataView
					}						
					sessionData.push(sData);                        
				}
			}
			if (view.expGridStore) {
				view.expGridStore = null;
				delete view.expGridStore;
			}
		}
        return sessionData;
    },
	commitStore: function() {
		var me = this,md;		
		 for (key in me.storeInfo) {
            store = me.storeInfo[key];
			md=null;
			if(store && store.getModifiedRecords)
				md= store.getModifiedRecords();
			if(md && md.length > 0){
				var g = md.length
				  , e = 0;
				Ext.suspendLayouts();
				store.beginUpdate();
				for (; e < g; e++) {
					if(!md[e].get("isNew")) {
						md[e].data.isNew = null;
						delete md[e].data.isNew;
						md[e].commit();						
					}
				}
				store.cleanRemoved();
				store.endUpdate();
				Ext.resumeLayouts(true)
			}
		 }
	},
    setSessionData: function(sessionData) {
        var me = this,
            data = sessionData.data.ci,
            states = sessionData.states,
            task = sessionData.data.taskName,
            ddt = sessionData.ddt,
            personalization = sessionData.personalization,
            view = me.getView(),
            ct,
            splitIndex,
            gridName,
            columnName,
            storeId,
            len = 0,
            grid,
            column,
            dataStore,
            store,
            operation,
            reader,
            record,
            records,
            model,
            resultSet,
            gridCtrl,
            treeCtrl,
            storeName,
            splitArr,
            key,
            isCombo = false,
			isTreeEmpty = true,
			// TECH-41138 / FEH-133			
			persMode = view.hasCls('x-pers-ilbo') ? true : false,
            i = 0;
        view.dbFileUrl = data.dbFileUrl;
        view.fileUrl = data.fileUrl;
		view.avnFileDownloadUrl = data.avnFileDownloadUrl;
        view.ddt = ddt || view.ddt;
        // TECH-28977 / ANZ-171
		view.pers = (!Ext.isEmpty(view.pers)) ? view.pers : personalization;
		//view.suspendLayouts();
		Ext.suspendLayouts();
		//Ext.suspendLayouts();
        if (states && (states.pages || states.sections || states.controls)) {
            //view.suspendLayouts();
            var pages = states.pages,
                sections = states.sections,
                controls = states.controls,
                smartHide = view.smartHide,
                parent,
                parentItemId,
                rSP = [],
			    rSpC = {};
			
            if (pages) {
				//Ext.suspendLayouts();
				var len = pages.length,
					i = 0,
					element = null,
					tabCtrl = view.down('#tabcontrol');
				tabCtrl.suspendLayouts();
				for(; i < len; i++) {
					element = pages[i];
					//pages.forEach(function(element, index, array) {
                    var oCtrl, id,  tabBar, itemIndex, tabItem, tabItemPanel, tabItemBody;
                    id = element.id;
                    if (id) {
                        if (tabCtrl) {
                            itemIndex = tabCtrl.items.indexOfKey(id);
                            tabBar = tabCtrl.getTabBar();
                            tabItem = tabBar.items.getAt(itemIndex);
                            tabItemPanel = tabCtrl.items.getAt(itemIndex);
							if(tabItemPanel) {
								tabItemBody = tabItemPanel.body;
								if(tabItemBody)
									tabItemBody = tabItemBody.first();
                        	}
                    	}
                    }
                    if (tabItem) {
						var capValue = element.title;
                        if (!Ext.isEmpty(capValue)) {
							if(capValue.indexOf('{') == 0) {
								var valueJson = Ext.decode(capValue, true),
									templateID, xTpl;
								if (valueJson && view) {
									templateID = valueJson.tplid;
									xTpl = view.getTemplate(templateID);
									if (xTpl && xTpl.isTemplate) {
										capValue = xTpl.apply(valueJson);
										capValue = capValue.replace(/ on\w+="[^"]*"/g, '');
									}
								}
							}
                            tabItem.setText(capValue);
                        }
                        if (element.visible) {
                            if (element.visible == 'n')
                                tabItem.hide();
                            else
                                tabItem.show();
                        }
                        if (element.enable) {
                            if (element.enable == 'n') {
                                tabItem.disable();
								if(tabItemBody)
									tabItemBody.addCls('x-tabitem-disabled');
							}
                            else {
                                tabItem.enable();
								if(tabItemBody)
									tabItemBody.removeCls('x-tabitem-disabled');
							}
                        }
                        if (element.focus && element.focus == 'y')
                            sessionData.data.tab = id;
                    }
                }
				//);
				//Ext.resumeLayouts(true);
				tabCtrl.resumeLayouts(true);
            }
            if (sections) {
				var len = sections.length,
					i = 0,
					element = null;
				for(; i < len; i++) {
					element = sections[i];
                //sections.forEach(function(element, index, array) {
                    var oCtrl, column, columns, gridView, id, oCtrlConfig, oWindowConfig, parentTd;
                    id = element.id;
                    if (id) {
                        if (id.indexOf('[') == 0 && id.indexOf("]") == id.length - 1) {
                            id = id.replace('[', '');
                            id = id.replace(']', '');
                        }
                        oCtrl = view.down('#' + id);
                    }
                    //if (oCtrl && oCtrl.xtype && oCtrl.xtype != "window") {
					if (oCtrl) {
                        delete oCtrl.slideHide;
						//Ext.suspendLayouts();
                        oCtrl.suspendLayouts();
						if (!Ext.isEmpty(element.title)) {
                            oCtrl.setTitle(element.title);
                        }
                        if (element.visible) {
                            //parent = oCtrl.up();
                            //if (parent && parent.xtype == "ramcosliderpanel") {
                            if (oCtrl.isSlider === true) {
                                parentItemId = oCtrl.parentId;
                                rSP.push(parentItemId);
                                if (Ext.isEmpty(rSpC[parentItemId]))
                                    rSpC[parentItemId] = [];
                                rSpC[parentItemId].push(element);
                            } 
							else {
								if (oCtrl.rendered) {
									parentTd = oCtrl.el.up("td");
									if (element.visible == 'n') {
										oCtrl.hide();
										// TECH-41251
										var isSplitter = (!Ext.isEmpty(oCtrl.region)) || false;
                                        if (parentTd) {
											if (oCtrl.border) {
												parentTd.el.dom.setAttribute("data-bd", "noborder");
											}
											if (smartHide && !isSplitter) {
												parentTd.setVisibilityMode(2);
												parentTd.hide();
											}
                                        }
									}
									else {
										if (parentTd) {
											if (oCtrl.border) {
												parentTd.el.dom.setAttribute("data-bd", "border");
											}
											if (smartHide) {
												parentTd.setVisibilityMode(2);
												parentTd.show();
											}
                                        }
										oCtrl.show();
									}
								}
                            }
                        }
                        if (element.visible == "y" && element.collapse && oCtrl.expand) {
                            if (element.collapse == 'n' || (RamcoRTC.settings.preserveSectionCollapse && element.collapse == '0')){
								//TECH-35818 , TECH-35689, TECH-35683
								if(oCtrl.collapsed)
	                                oCtrl.expand();
								}
	                            else {
									if(!oCtrl.collapsed)
	                                oCtrl.collapse();
	                        }
                        }
                        if (element.enable) {
							if(oCtrl.xtype == "ramcoschedulergantt" || oCtrl.xtype == "ramcoschedulercalendar")
							{
								if (element.enable == 'n')
									oCtrl.setReadOnly(true);
								else
									oCtrl.setReadOnly(false);
							}
							else{
								if (element.enable == 'n')
									oCtrl.disable();
								else
									oCtrl.enable();
							}
                        }
						oCtrl.resumeLayouts(true);
						//Ext.resumeLayouts(true);
                        if (element.popup) {
                            if (oCtrl.isFloating() == false) {
                                //view.suspendLayouts();
                                oCtrlConfig = oCtrl.initialConfig;
                                oCtrl = view.remove(oCtrl, true);
                                Ext.destroy(oCtrl);
                                oWindowConfig = {
                                    xtype: 'window',
                                    bodyPadding: 5,
                                    border: 1,
                                    closeAction: 'hide',
                                    centered:true,
                                    modal: true,
									width: '80%',
									layout:{
										type:'table',
										columns: 1,
										tableAttrs: {
											style: {
												width: '100%',
												padding: '2px'
											}
										}
									},
									rtPop: true,
                                    itemId: oCtrlConfig.itemId,
                                    title: oCtrlConfig.title,
                                    scrollable: true
                                };
                                delete oCtrlConfig.title;
                                delete oCtrlConfig.collapsible;
                                delete oCtrlConfig.border;
                                oCtrlConfig.itemId = oCtrlConfig.itemId + "_p";
                                oWindowConfig.items = oCtrlConfig;
                                oCtrl = view.add(oWindowConfig);
								oCtrl.on('close', me.rtPopupClose, me);
                                //view.resumeLayouts(true);
                                oCtrl.show();
                                oCtrlConfig = oCtrl.getComponent(oCtrlConfig.itemId);
                                if (oCtrlConfig && oCtrlConfig.rendered) {
                                    var size = oCtrlConfig.getSize();
                                    size.height += 100;
                                    size.width += 20;
                                    oCtrl.setSize(size);
                                }
                                oCtrl.hide();
                            }
                            if (element.popup == '0')
                                oCtrl.hide();
                            else {
                                oCtrl.show();
                                oCtrl.center();
                            }
                        }
                    }
                }
				//);
            }
			//Ext.suspendLayouts();
            if (controls) {
				var len = controls.length,
					i = 0,
					element = null;
				for(; i < len; i++) {
					element = controls[i];
                //controls.forEach(function(element, index, array) {
                    var oCtrl, column, columns, gridView, id, label, isSegmented = false;
                    id = element.id;
                    if (id) {
                        if (id.indexOf('[') == 0 && id.indexOf("]") == id.length - 1) {
                            id = id.replace('[', '');
                            id = id.replace(']', '');
                        }
                        oCtrl = view.down('#' + id);
                        if (oCtrl) {
							oCtrl.suspendLayouts();
                            label = view.down('#lbl' + id);
							if(label)
								label.suspendLayouts();
                            isSegmented = oCtrl.ownerCt ? (oCtrl.ownerCt.xtype == 'segmentedbutton') : false;
                            if (!Ext.isEmpty(element.caption)) {
								var capValue = element.caption;
								if(capValue.indexOf('{') == 0) {
									var valueJson = Ext.decode(capValue, true),
										templateID, xTpl;
									if (valueJson && view) {
										templateID = valueJson.tplid;
										xTpl = view.getTemplate(templateID);
										if (xTpl && xTpl.isTemplate) {
											capValue = xTpl.apply(valueJson);
											capValue = capValue.replace(/ on\w+="[^"]*"/g, '');
										}
									}
								}
                                if (oCtrl.xtype == "button" || oCtrl.xtype == "link") {
                                    oCtrl.setText(capValue);
                                } else {
                                    if (label) {
                                        if (Ext.isFunction(label.setText))
                                        	label.setText(capValue);
										else if (Ext.isFunction(label.setValue))
											label.setValue(capValue);
                                        label.config.html = capValue;
                                    }
                                }
                            }
                            if (!Ext.isEmpty(element.css)) {
                                element.css = element.css.toLowerCase();
                                if (oCtrl.prevCls)
                                    oCtrl.removeCls(oCtrl.prevCls);
                                oCtrl.addCls(element.css);
								if(oCtrl.inputEl && oCtrl.inputEl.addCls)
                                	oCtrl.inputEl.addCls(element.css);
                                oCtrl.prevCls = element.css;
                            }
                            if (!Ext.isEmpty(element.href)) {
                                oCtrl.setValueData(element.href);
                            }
							// Personalization
							if (!Ext.isEmpty(element.mandatory) && Ext.isFunction(oCtrl.setMandatory)) {
								if(element.mandatory != "white") 
									oCtrl.setMandatory(true);
								else
									oCtrl.setMandatory(false);
							}
							if (!Ext.isEmpty(element.stp))
                            	oCtrl.setTooltip(element.stp);
                            if (element.visible) {
                                if (element.visible == 'n') {
									//AHBG-31928
									me.setHideMode(oCtrl);
									
									// TECH-41138 / FEH-133
									if (persMode && oCtrl.rendered)
										oCtrl.el.setVisibilityMode(1);
									else
										oCtrl.hide();
									
                                    if (label) {
										// TECH-41138 / FEH-133
										if (persMode && label.rendered)
											label.el.setVisibilityMode(1);
										else
											label.hide();
										
                                        if (smartHide && oCtrl.rendered) {
                                            parentTd = label.el.up("td");
                                            if (parentTd) {
                                                parentTd.setVisibilityMode(2);
                                                parentTd.hide();
                                            }
                                        }
                                    }
                                    if (smartHide && oCtrl.rendered && !isSegmented) {
                                        parentTd = oCtrl.el.up("td");
                                        if (parentTd) {
                                            parentTd.setVisibilityMode(2);
                                            parentTd.hide();
                                        }
                                    }
                                }
								else {
                                    if (label) {
                                        if (smartHide && oCtrl.rendered) {
                                            parentTd = label.el.up("td");
                                            if (parentTd) {
                                                parentTd.setVisibilityMode(2);
                                                parentTd.show();
                                            }
                                        }
										
										// TECH-41138 / FEH-133
										if (persMode && label.rendered)
											label.el.setVisibilityMode(0);
										else
											label.show();										
                                    }
                                    if (smartHide && oCtrl.rendered && !isSegmented) {
                                        parentTd = oCtrl.el.up("td");
                                        if (parentTd) {
                                            parentTd.setVisibilityMode(2);
                                            parentTd.show();
                                        }
                                    }
									
									// TECH-41138 / FEH-133
									if (persMode && oCtrl.rendered)
										oCtrl.el.setVisibilityMode(0);
									else
										oCtrl.show();									
                                }
                            }
                            if (element.enable) {
								// TECH-28264
								// TECH-33231
								//if (Ext.isFunction(oCtrl.setReadOnly) && Ext.isEmpty(oCtrl.helpIcon)) {								
								if (Ext.isFunction(oCtrl.setReadOnly) && (oCtrl.xtype == 'textarea' || oCtrl.xtype == 'textareafield' || Ext.isEmpty(oCtrl.helpIcon))) {
									if (element.enable == 'n')                                    
										oCtrl.setReadOnly(true);
									else
										oCtrl.setReadOnly(false);
								}
								else {
									if (element.enable == 'n')
										oCtrl.disable();
									else
										oCtrl.enable();
								}
								/*
                                if (oCtrl.getXTypes().indexOf('button') > -1) {
	                                if (element.enable == 'n')
	                                    oCtrl.disable();
	                                else
	                                    oCtrl.enable();
	                            	}
								else 
								{
									if (element.enable == 'n')                                    
										oCtrl.setReadOnly(true);
									else
										oCtrl.setReadOnly(false);
								}*/
                            }
							
							// TECH-34273
							var sortArray = element.sorts;
							if (sortArray && sortArray.length > 0) {
								oCtrl.applyGridMultiSort(sortArray, 'apply');
							}
							
                            /* TECH-28977 / ANZ-171 -- Excluding EPI based state handling */
							
							if (element.views && element.views.length > 0) {
								var epi = personalization[0], pi = personalization[1],
									epiGrid = epi && epi[element.id],piGrid = pi && pi[element.id],
									hcols, hcolsLen, vws = element.views, vwsLen, 
									curGridView;
									//TECH-34035 // HAY-51
								if(Ext.isEmpty(epiGrid)){
									epi = view.pers[0];
									if(epi && epi[element.id])
										epiGrid = epi[element.id];
									
								}
								if(Ext.isEmpty(piGrid)){
									pi = view.pers[1];
									if(pi && pi[element.id])
										piGrid = pi[element.id];
									
								}
								if (!Ext.isEmpty(epiGrid) && !Ext.isEmpty(epiGrid.hcols) && epiGrid.hcols.length > 0) {//TECH-29710/ANZ-241
									hcols = epiGrid.hcols;
									vwsLen = vws.length;
									hcolsLen = hcols.length;
									for (var j = 0; vwsLen > 0 && j < vwsLen; j++) {
										curGridView = vws[j];
										for (var k = 0; hcolsLen > 0 && k < hcolsLen; k++) {
											if (hcols[k] == curGridView.id) {//TECH-36970
												var cols = oCtrl.getColumnById(curGridView.id);
												cols.isStateHidden  = true;
												delete vws[j];
												continue;
											}
										}
									}
								}
								//TECH-33892 / HAY-51
								if(!Ext.isEmpty(piGrid) && !Ext.isEmpty(piGrid.views) && piGrid.views.length > 0){
										var pView = piGrid.views,gridView;
									for (var l = 0; l < vws.length; l++) {
										 gridView = vws[l];
										for (var m = 0; (m < pView.length &&  !Ext.isEmpty(gridView)); m++) {//TECH-36970
											if (pView[m].id == gridView.id && !Ext.isEmpty(gridView.visible)) {
												if(pView[m].choose){
													/* if(pView[m].choose == '0'){
															var cols = oCtrl.getColumnById(gridView.id);
															cols.isStateHidden  = true;
													} */
													delete pView[m].choose;
												}
												continue;
											}
										}
									}
								}
								
								oCtrl.processState(vws);
                            }
							if(label)
								label.resumeLayouts(true);
							oCtrl.resumeLayouts(true);
                        }
                    }
                }
				//);
            }
            if (rSP && rSP.length > 0) {
				var len = rSP.length,
					  i = 0,
					  element = null;
				for(; i < len; i++) {
					element = rSP[i];
					//rSP.forEach(function(element, index, array) {
                    var oCtrl;
                    oCtrl = view.down('#' + element);
                    if (oCtrl) {
                        oCtrl.processState(rSpC[element]);
                    }
                }
				//);
            }
            //view.resumeLayouts(true);
			//Ext.resumeLayouts(true);
        }
		//Ext.resumeLayouts(true);
		// TECH-35534 / TECH-35642 / TECH-35619 / TECH-35651
        if (personalization && personalization.length > 0) {
            var epi = personalization[0],
                pi = personalization[1],
                item, key, viewNode, oCtrl, hcols, views, fc;
            for (key in epi) {
                item = epi[key];
                if (item && item.ct == 'RSGrid') {
                    oCtrl = view.down('#' + key);
                    fc = item.fc;
					// TECH-37120 / LSTH-114
					if (!Ext.isEmpty(oCtrl)) {
						// Process Order
	                    viewNode = item.order;
						views = item.views;					
						if (!Ext.isEmpty(views))
							oCtrl.processViews(views, null);
						if (!Ext.isEmpty(viewNode))
							oCtrl.processOrder(viewNode,data[key].value);
						// Process Hidden Columns State
	                    viewNode = item.views;
						hcols = item.hcols;
						if (!Ext.isEmpty(viewNode))
							oCtrl.processState(viewNode);
						if (!Ext.isEmpty(hcols))
							oCtrl.processViews(null, hcols);
						// Freeze Columns
						if (!Ext.isEmpty(fc) && !Ext.isEmpty(fc) && parseInt(fc) > 0) {
							var cols = oCtrl.view.normalGrid.getColumns(),
								lockCols = oCtrl.view.lockedGrid.getColumns(),
								fcVal = parseInt(fc); // TECH-40830 / RGSH-288
							if (lockCols.length < fcVal + 2) {
								// TECH-33843
								//for (var j = 0; j <= fcVal; j++) {
								// TECH-40830 / RGSH-288
								for (var j = 0; j < fcVal; j++) {
									oCtrl.lock(cols[j], j + 2);
								}
							}
	                    }
	                }
	            }
            }
            for (key in pi) {
                item = pi[key];
                if (item && item.ct == 'RSGrid') {
                    oCtrl = view.down('#' + key);
                    fc = item.fc;
                    viewNode = item.views;
                    if (viewNode && viewNode.length > 0) {
                        oCtrl = view.down('#' + key);
                        if (oCtrl)
                            oCtrl.processState(viewNode);
                    }
                    viewNode = item.order;
                    if (viewNode && viewNode.length > 0) {
                        if (oCtrl) {
                            oCtrl.processOrder(viewNode,data[key].value);
                        }
                    }
					
                    if (!Ext.isEmpty(oCtrl) && !Ext.isEmpty(fc) && parseInt(fc) > 0) {
                        var cols = oCtrl.view.normalGrid.getColumns(),
                            lockCols = oCtrl.view.lockedGrid.getColumns(),
							fcVal = parseInt(fc); // TECH-40830 / RGSH-288
                        if (lockCols.length < fcVal + 2) {
							// TECH-33843
                            //for (var j = 0; j <= fcVal; j++) {
							// TECH-40830 / RGSH-288
                            for (var j = 0; j < fcVal; j++) {
                                oCtrl.lock(cols[j], j + 2);
                            }
                        }
                    }
                }
            }
        }
        for (key in me.storeInfo) {
            splitArr = key.split('_store');
            splitArr.pop();
            storeName = splitArr.join('_store');
            isCombo = false;
            if (data[storeName] && data[storeName].store) {
                treeCtrl = view.down('#' + storeName);
                store = me.storeInfo[key];
                dataStore = data[storeName];
                if (store.gridStore || store.cmblinkstore) {
                   //store.setData(dataStore.store);
				   continue;
				}
                else if (store.type == 'tree') {
					//TECH-30810
					if (treeCtrl && (treeCtrl.xtype == "ramcorstreepanel" || treeCtrl.xtype == "ramcorstreegrid" ))
						continue;
                    if (dataStore.store.clear == 'n') {
                        records = dataStore.store.children;
                        record = store.findRecord('itemId', dataStore.value);
						if(records && records.length > 0) {
							var len = records.length,
								  i = 0, r = 0,
								  item = null;
							
							for(; r < len; r++ ) {
								var selNode = store.findRecord('itemId', records[r].itemId);								
								if (selNode) {//Updating Modified Data //TECH-28711
									//TECH-34743
									//if (records[r].action == "mod") {
									if (records[r].action == "mod" || records[r].action == "") {
										var expandablee = selNode.isExpandable();
										//selNode.data.expandable = records[r].expandable;
										selNode.data.expandable = expandablee;
										selNode.data.icon = records[r].icon;
										selNode.data.sAction = "mod";
									}
								}//
								//TECH-28711
								//Insert New Data with Parent Record
								if (Ext.isEmpty(selNode) && (records[r].action == "" || records[r].action == "ins" || records[r].action == "add")) {
									var parentRecord = store.findRecord('itemId', records[r].pid);
									if (!Ext.isEmpty(parentRecord)) {
										parentRecord.appendChild(records[r]);
									}
								}
							}							
							for(; i < len; i++) {
								item = records[i];
								if (item && (item.itemId == dataStore.value)) {
									records.splice(i, i + 1);
                            }
								if(item && !Ext.isEmpty(item.itemId))
								isTreeEmpty = false;
							}
						}
                        /*if (record && !record.isLeaf() && !isTreeEmpty) {
                            record.removeAll();
                            record.appendChild(records);
                        }*/
                    } 
					else {
						// if(store.orgTreeStore)
							// store.setRoot(dataStore.store.children[0]);
						// else
						if (treeCtrl.xtype == "ramcoorgchart") {
							store.setRoot(dataStore.value.store);
						}
						else {
							store.setRoot(dataStore.store);
						}
                        if (dataStore.store.children && !dataStore.store.children.tbar) {
                            //treeCtrl = view.down('#' + storeName);
							if (treeCtrl && (treeCtrl.xtype == "ramcotreepanel" || treeCtrl.xtype == "ramcorstreepanel"))
                                treeCtrl.down('#tblTree').hide();
                        }
                    }
					//TECH-29358
					if(treeCtrl.xtype !="ramcoorgchart")
						treeCtrl.view.refresh();
                } 
				else if (store.stackStore) {
                    store.loadData(dataStore.store);
                } 
				else {
					try {
						treeCtrl = view.down('#' + storeName);					
						if (treeCtrl)
							treeCtrl.suspendCheckChange = true;
					} catch(e) {}
                    store.maxFieldLength = dataStore[storeName];
                    store.loadData(dataStore.store);                    
                    isCombo = true;
                }
				if (me.nonModifiedTasks.indexOf(sessionData.data.taskName) == -1)
                	store.commitChanges();
                if (isCombo && treeCtrl) {
                    treeCtrl.suspendCheckChange = false;
                }
                data[storeName].store = null;
                delete data[storeName].store;
            } 
			/*else {
                splitIndex = storeName.lastIndexOf('_');
                gridName = storeName.substring(0, splitIndex);
                len = storeName.length;
                columnName = storeName.substring(splitIndex + 1, len);
                grid = data[gridName] ? data[gridName].value : null;
                if (grid && grid.columnsValue) {
                    column = grid.columnsValue[columnName];
                    if (column && column.store) {
                        store = me.storeInfo[key];
                        store.loadData(column.store);
                        store.commitChanges();
                        column.store = null;
                        delete column.store;
                    }
                }
            }*/
        };
        me.setData(data);
		var sch = me.getScheduler();
            try {
            sch.notify();
        } catch (e) {
            console.log(e);
                }
		while(sch.isBusy()) {
			console.log('while');
        }
        if (me.nonModifiedTasks.indexOf(sessionData.data.taskName) == -1) {
            me.modified = [];
        }
        Ext.resumeLayouts();
		//view.resumeLayouts(true);
    },
	rtPopupClose: function(popusec) {
		var me = this;
		me.setModified(popusec.itemId);		
	},
	//AHBG-31928
	setHideMode:function(ctrl){
		var me = this,
			parentPanel= ctrl.up("ramcopanel");
		if(parentPanel && parentPanel.level !=="0"){
			parentPanel = parentPanel.up("ramcopanel");
			if(parentPanel && parentPanel.layout.columns > 1){
				try{
					ctrl.el.setVisibilityMode(1)
				}catch(e){}
			}
		}
	},
    applyPersonalization: function(ctrlId, data) {
        var me = this,
            view = me.getView(),
            wind = null,
            persData = data[RamcoRTC.currentTemplate] ? data[RamcoRTC.currentTemplate].data[ctrlId] : '',
            colEdit = null,
            editor = null,
            ctrl = null;
			
		// TECH-34272
		
        if (ctrlId) {
            ctrl = view.down('#' + ctrlId);
            ctrl.persData = persData;
			var cols = ctrl.getColumns(),
				colArray = [],
				tplText = '<div style="cursor: pointer;" class="x-fa x-toolbar-more-icon" />',
				visible, initState; // TECH-39427
				
			for (var j = 0; j < cols.length; j++) {
				
				//if (cols[j].dataIndex == 'rn' || cols[j].dataIndex == 'sel' || cols[j].hidden)
				if (cols[j].dataIndex == 'rn' || cols[j].dataIndex == 'sel')
					continue;
				
				if (!Ext.isEmpty(cols[j].dataIndex) && (cols[j].isStateHidden != true  || (persData && persData[cols[j].dataIndex] != 'sel' && persData[cols[j].dataIndex] != 'rn'))) {
					if (persData && !Ext.isEmpty(persData[cols[j].dataIndex]))
						visible = persData[cols[j].dataIndex].sv;
					else
						visible = (cols[j].isVisible()) ? 'y' : 'n';
					visible = (visible == 'y') ? true : false;
					// TECH-39427
					initState = cols[j].initVisibleState;
					if (initState == true ||  visible == true)
						colArray.push({'dataIndex': cols[j].dataIndex, 'drag': tplText, 'colname' : cols[j].text, 'visible' : visible});
				}
			}
			
			// TECH-34272
			
			if (me.colChooseWindow) {
				me.colChooseWindow.setGridColumns(ctrl, colArray);
			}
			else {
			
				me.colChooseWindow = Ext.create('Ext.ramco.Colchooser', {
					itemId: ctrlId + '_colchooser',
					colGridColumns: colArray,
					ctrlObj: ctrl,
					parentGridId: ctrlId
				});
				
				me.colChooseWindow.show();
	        }
        }
    },
    setListData: function(data, ctrl, view, ascCtrl) {
        var me = this,
            ctrlObj = null,
            ilbo = me.getView(),
            listEditCtrl,
            store;
        listEditCtrl = ilbo.down('#' + ctrl);
        if (listEditCtrl.activeListField)
            listEditCtrl = listEditCtrl.activeListField;
        if (ctrl == view)
            store = me.storeInfo[ctrl + '_store'];
        else
            store = me.storeInfo[ctrl + '_v' + view + '_store'];
        if (store) {
			if (RamcoRTC.isProto === true) {
        		store.loadData([]);
        		return;
        	}
            if (data && data.data && data.data.ci) {
				if (data.data.ci[ctrl] && data.data.ci[ctrl].value) {
					listEditCtrl.listColSize = data.data.ci[ctrl].value;
				}
                if (data.data.ci[ctrl] && data.data.ci[ctrl].store) {					
                    store.loadData(data.data.ci[ctrl].store);
				}
                else if (data.data.ci[ascCtrl] && data.data.ci[ascCtrl].store)
                    store.loadData(data.data.ci[ascCtrl].store);
                //store.commitChanges();
            } else {
                store.loadData([]);
            }
            /*if (listEditCtrl && Ext.isFunction(listEditCtrl.doAutoSelect)) {
                listEditCtrl.doAutoSelect();
                delete listEditCtrl.activeListField;
            }*/
        }
        /*try {
            me.getScheduler().notify();
        } catch (e) {
            console.log(e);
        }*/
    },
	setCustomListData: function(data, ctrl, view, ascCtrl) {
        var me = this,
            ctrlObj = null,
            ilbo = me.getView(),
            listEditCtrl,
            store;
        listEditCtrl = ilbo.down('#' + ctrl);
        if (listEditCtrl.activeListField)
            listEditCtrl = listEditCtrl.activeListField;
        if (ctrl == view)
            store = me.storeInfo[ctrl + '_store'];
        else
            store = me.storeInfo[ctrl + '_v' + view + '_store'];
        if (store) {
            if (data) {
				//AHBG-27183
				//if(data.data.response.docs) {
				if(data.data && data.data.response && data.data.response.docs) {
					store.st = data.data.response.start;
					store.tr = data.data.response.numFound;
					store.pgs = parseInt(data.data.responseHeader.params.rows, 10);
					store.loadData(data.data.response.docs);					
				}
				/*
				if (data.data.ci[ctrl] && data.data.ci[ctrl].value) {
					listEditCtrl.listColSize = data.data.ci[ctrl].value;
				}
                if (data.data.ci[ctrl] && data.data.ci[ctrl].store) {					
                    store.loadData(data.data.ci[ctrl].store);
				}
                else if (data.data.ci[ascCtrl] && data.data.ci[ascCtrl].store)
                    store.loadData(data.data.ci[ascCtrl].store);
				*/
                //store.commitChanges();
            } else {
                store.loadData([]);
            }
            /*if (listEditCtrl && Ext.isFunction(listEditCtrl.doAutoSelect)) {
                listEditCtrl.doAutoSelect();
                delete listEditCtrl.activeListField;
            }*/
        }
        /*try {
            me.getScheduler().notify();
        } catch (e) {
            console.log(e);
        }*/
    },
    setGridFullData:function(data, ctrl){
		var me = this,
			store;
        store = me.storeInfo[ctrl + '_store'];
        if (store) {
			store.tr = data.tr;
            if (data.tr > 0) {
				store.loadData(data.rows);
            } else {
                store.loadData([]);
            }
        }
	},
	copyAll: function(object, newObject) {
        if (object && newObject && typeof newObject === 'object') {
            var i, j, k, l;
            for (i in newObject) {
                k = newObject[i];
                for (j in k) {
                    if (typeof object[i] != 'object')
                        object[i] = {};
                    object[i][j] = k[j];
                }
            }
        }
        return object;
    },
    getRawFormat: function(type, value, encrypt, prec) {
        var ret = value,ht;
        // if (Ext.isEmpty(value))
		if (!encrypt && Ext.isEmpty(value))
            return value;
        switch (type) {
            case 'hdate':
                ret = Ext.util.Format.date(value, 'B-Q-R');
                break;
            case 'hdate-time':
                ret = Ext.util.Format.date(value, 'B-Q-R H:i:s');
                break;
            case 'htime':
                ret = Ext.util.Format.date(value, 'H:i:s');
                break;
            case 'date':
                ret = Ext.util.Format.date(value, 'Y-m-d');
                break;
			//TECH-26776 / APSH-93
            case 'datetime':
            case 'date-time':
                ret = Ext.util.Format.date(value, 'Y-m-d H:i:s');
                break;
            case 'time':
                ret = Ext.util.Format.date(value, 'H:i:s');
                break;
			case "float":
			case "double":
			case "numeric":
			case "int":
			case "integer":
			case "long":
			case 'number':
				// TECH-29059 / UFS-517
				if (value && Ext.isString(value))
					value = parseFloat(value);
				if (!Ext.isEmpty(prec))
					ret = value.toFixed(prec);
				else
					ret = value;
				break;
            default:
                if (encrypt == true)
                    ret = GetEncryptedValue(value);
                break;
        }
        return ret;
    }
});

// ILBO Container
Ext.define('Ext.ramco.Ilbo', {
    extend: 'Ext.panel.Panel',
    xtype: 'ilbo',
    scrollable: true,
    isInit: false,
	hasSmartLink: false,
    //rtl:true,
    //bodyPadding: '0 5',	
	//hidden: true,
	hideMode:'offsets',
    layout: {
        type: 'table',
        columns: 1,
        tableAttrs: {
            style: {
                width: 'calc(100% - 15px)'				
            }
        }
    },
    controller: 'ilbo',
    viewModel: {
        type: 'ilbo'
    },
    config: {
        panelWindow: null,
        ctrlWindow: null,
        tabWindow: null,
        taskWindow: null,
		ilboConfig: {
            componentName: '',
            activityName: '',
            activityDesc: '',
            ilboName: '',
            ilboDesc: '',
            ilboType: '',
            tabName: '',
            inlineTab: true
        }
    },
    callout: null,
    requiredScripts: [],
    templateFile: false,
    customStyles: false,
    templatesJson: {},
    templates: {},
    tabPageState: {},
    activeTabName: null,
    lastTaskName: null,
    listeners: {
        resize: 'onIlboResize'
    },
    initComponent: function() {
        var me = this, item1;	
		if(me.config.htmFile == true) {
			 item1 = me.items[0];
			 item1.html = me.htmtpl;
		}
		me.bodyPadding = (RamcoRTC.settings.isExt2 == true) ? '0 5' : 5;
		me.callParent();
	},
	/*isLayoutRoot:function(){
		return true;
    },*/
	getIsInit:function(){
		return this.isInit;
	},
	setIsInit:function(value){
        var me = this,
			mainController = getMainController(),
			controller = me.getController(); // TECH-39090 / TECH-39140 / TECH-39207 / TECH-39241 / TECH-39242
		me.isInit =  true;
		if(value){
			/*var viewModel = me.getViewModel();
			viewModel.notify();*/
        //me.callScreenInit();
		// TECH-39090 / TECH-39140 / TECH-39207 / TECH-39241 / TECH-39242
			controller.taskPending = true;			
			if (!me.userPreProcess("tskstdscreeninit", me.ilboConfig.activityName, me.ilboConfig.ilboName, me.activeTabName)) {
				// TECH-39090 / TECH-39140 / TECH-39207 / TECH-39241 / TECH-39242
				controller.taskPending = false;
				console.log('User pre-process returned false');
			}
			mainController.onScreenInit(me,[]);
		}
	},
	callInit:function(){
		var me =this,
			controller = me.getController();
		if(controller)
			controller.callInit(me);
    },
    applyIlboConfig: function(newConfig) {
        var me = this;
        me.ilboConfig = newConfig;
    },
    updateIlboConfig: function(newConfig, oldConfig) {
        var me = this;
        me.ilboConfig = Ext.apply(oldConfig, newConfig);
    },
    getTemplate: function(templateId, isModelTpl) {
        var me = this,
            ilboName = me.ilboConfig.ilboName;
        if (me.templates && Ext.isEmpty(me.templates[ilboName + "_" + templateId])) {
            if (me.templatesJson && !Ext.isEmpty(me.templatesJson[templateId])) {
                try {
                    me.templates[ilboName + "_" + templateId] = new Ext.XTemplate(me.templatesJson[templateId]);
                } catch (e) {
                    me.templates[ilboName + "_" + templateId] = new Ext.XTemplate('<div>Error in template ' + e + ' [' + templateId + '] </div>');
                }
            } else
                if(isModelTpl)
					me.templates[ilboName + "_" + templateId] = null;
				else
                	me.templates[ilboName + "_" + templateId] = new Ext.XTemplate('<div>Template not found [' + templateId + '] </div>');
        }
        return me.templates[ilboName + "_" + templateId];
    },
    userPreProcess: function(eventName, activityName, ilboName, tabName) {
        var me = this;
        if (me.callout && me.callout.userPreProcess) {
            try {
                return me.callout.userPreProcess.call(me || window, eventName, activityName, ilboName, tabName);
            } catch (e) {
                console.log("Error in Callout Js." + e);
            }
        }
        return true;
    },
    beforeUserPostProcess: function(eventName, activityName, ilboName, tabName) {
        var me = this;
        if (me.callout && me.callout.beforeUserPostProcess) {
            try {
                return me.callout.beforeUserPostProcess.call(me || window, eventName, activityName, ilboName, tabName);
            } catch (e) {
                console.log("Error in Callout Js." + e);
            }
        }
        return true;
    },
    afterUserPostProcess: function(eventName, activityName, ilboName, tabName) {
        var me = this,
            ilboConfig = me.ilboConfig,
            trees = [],
			calander=[],
			gantt=[],
			element = null;
       // if (eventName == 'tskstdscreeninit') {
        if (me.items){
            //trees = me.query("ramcotreegrid"); //TECH-40161
			trees = me.query("ramcotreegrid[rendered]");
	        if (trees && trees.length > 0) {
				var len = trees.length,
					i = 0;
				for(; i < len; i++) {
					element = trees[i];
					//trees.forEach(function(element, index, array) {
	                var url = 'ilrt/Ez_Report.aspx?gridid=' + element.getItemId() + '&component=' + ilboConfig.componentName + '&activity=' + activityName + '&ilbocode=' + ilboName + '&RVWQS_ACTIVEUI=' + '&type=treegrid',
	                    store = element.getStore(),
	                    proxy = store ? store.getProxy() : null;
	                if (proxy) {
						delete proxy.extraParams.node;
	                    proxy.setUrl(url);
	                    store.load({
	                        scope: element,
	                        callback: function(records, operation, success) {
	                            // the operation object
	                            // contains all of the details of the load operation
								//AHBG-25919, AHBG-25777, AHBG-24045, AHBG-24044 - Starts
								var totNode,
									tr;
								if (operation._response && operation._response.responseXML) {
									totNode = operation._response.responseXML.querySelector("xml > total");									
								}
	                            if (this.getStore()) {
	                                var root = this.getRootNode();
	                                root.expand();
									// AHBG-24044
									var topbar = this.getDockedComponent('gridToolbar');
									dspRow = topbar ? topbar.getComponent('dspRow') : null;
									rowNav = topbar ? topbar.getComponent('rowNav') : null;									
									if(totNode) {
										tr = parseInt(totNode.innerHTML || totNode.textContent , 10);//TECH-30014
										dspRow.suspendLayouts();
										if (tr > 0) {
											dspRow.update({v:'- ' + tr + '/' + tr});
											rowNav.setMaxValue(tr);
											rowNav.setRawValue(1);
											rowNav.show();
										}									
										else {
											dspRow.update({v:rvw_resources.R033});
											rowNav.hide();
										}
										dspRow.resumeLayouts();
									}
	                            }
								//AHBG-25919, AHBG-25777, AHBG-24045, AHBG-24044 - ends
							}
	                    });
	                }
	            }
				//);
	        }
			calander = me.query("ramcoschedulercalendar");
			if (calander && calander.length > 0) {
				var len = calander.length,
					i = 0;
				for(; i < len; i++) {
					element = calander[i];
					if(element.crudManager)
						element.crudManager.load();
				}
			}
			gantt = me.query("ramcoschedulergantt");
			if (gantt && gantt.length > 0) {
				var len = gantt.length,
					i = 0;
				for(; i < len; i++) {
					element = gantt[i];
					if(element.crudManager)
						element.crudManager.load();
				}
			}
		}
        //}
        if (me.callout && me.callout.afterUserPostProcess) {
            try {
                return me.callout.afterUserPostProcess.call(me || window, eventName, activityName, ilboName, tabName);
            } catch (e) {
                console.log("Error in Callout Js." + e);
            }
        }
        return true;
    },
    setSessionData: function(sessionData, options) {
        var me = this,
            ilboConfig = me.ilboConfig,
            viewModel = me.getViewModel(),
            controller = me.getController(),
			hasTab = null,
			tabPanObj = null,
			actTab = null,
			currWinorHelp = me.up('window'),
			ctexdata = sessionData.data.ctex,
            taskName = sessionData && sessionData.data && sessionData.data.taskName ? sessionData.data.taskName : '',
			sJson;//TECH-31141
        if (taskName == "tskstdscreeninit") {
            if (me.callbackid) {
                clearTimeout(me.callbackid);
                me.callbackid = null;
                delete me.callbackid;
            }
            if (me.getIsInit()) {
				console.log("before data bind " + Date.now());
            } else {
                me.callbackid = Ext.Function.defer(me.setSessionData, 10, me, [sessionData]);
				me.callBackStatus = "IP";
                return;
            }
			//TECH-32102
			/*if (ilboConfig.ilboName == "ezelogin" && !Ext.isEmpty(sessionData.data.ci["ldapdesc"])) {
				var ldapDesc = me.down('#ldapdesc'),
					frgtPwdLnk = me.down('#frgtpwdlink');//TECH-28474
				if (ldapDesc) {
					ldapDesc.show();
					if(frgtPwdLnk){//TECH-28474
						if(!Ext.isEmpty(sessionData.data.ci["ldapdesc"].value) && sessionData.data.ci["ldapdesc"].value.toLowerCase() != "default")
							frgtPwdLnk.hide();
						else
							frgtPwdLnk.show();
					}
				}
			}*/
			if(ilboConfig.ilboName == "ezelogin" && me.config.htmFile === true) {
				me.show();		
				me.login = {};
				//TECH-31141
				sJson = getConfigJson("span1_ide_username");
				var uname = Ext.create("Ext.form.field.Text", Ext.apply({
					renderTo: "span1_ide_username",								
					itemId : "ide_username",
					userCls: "custusername",
					hideLabel : true,
					role : "uipage",
					width: '100%',
					controller : controller,
					viewModel: viewModel,
					//allowBlank : false, // TECH-40738
					maxLength : 30,
					emptyText : "User Name",
					bind: "{ide_username.value}",
					hideTrigger: true
				}, sJson));
				uname.controller.setView(me);
				uname.viewModel.setView(me);
				me.login.uname = uname;
				//TECH-31141
				sJson = getConfigJson("span1_ide_password");				
				var pwd = Ext.create("Ext.form.field.Text", Ext.apply({
					renderTo: "span1_ide_password",					
					hideLabel : true,
					emptyText : "Password",
					userCls: "custpassword",
					inputType : "password",
					itemId : "ide_password",
					role : "uipage",					
					maxLength : 30,					
					width: '100%',					
					//allowBlank : false, // TECH-40738
					uiTask : "tskstdlogin",
					controller : controller,
					viewModel: viewModel,					
					taskType : "submit",
					bind : {
						value:"{ide_password.value}"
					},
					hideTrigger: true
				}, sJson));
				pwd.controller.setView(me);
				pwd.viewModel.setView(me);
				me.login.pwd = pwd;
				//TECH-32102
				if (!Ext.isEmpty(sessionData.data.ci["ldapdesc"])) {
					if (Ext.isEmpty(viewModel.stores)) {
						viewModel.stores = {};
					}
					viewModel.data =  {
						ldapdesc: ""
					},
					viewModel.stores["ldapdesc_store"] = {
						fields: [
									{
										name: "text",
										type: "string"
									},
									{
										name: "value",
										type: "string"
									}
								],
						proxy: {
							type: "memory"
						}
					};
					sJson = getConfigJson("span1_ide_ldapdesc");
					// TECH-32997
					//var ldapCombo = Ext.create('Ext.form.field.ComboBox', Ext.apply({
					var ldapCombo = Ext.create('Ext.ramco.field.ComboField', Ext.apply({	
						renderTo: "span1_ide_ldapdesc",	
						itemId : "ldapdesc",
						dataType : "char",
						queryMode: "local",
						hideLabel : true,
						hidden: true,
						caption: "LDAP Authentication",
						displayField: "text",
						valueField: "value",
						controller : controller,
						viewModel: viewModel,							
						mandatory: false,
						role : "uipage",
						width : "100%",
						bind: {
							store: "{ldapdesc_store}",
							value: "{ldapdesc.value}"
						}
					}, sJson));
					ldapCombo.viewModel = viewModel;
					ldapCombo.controller.setView(me);
					ldapCombo.viewModel.setView(me);
					me.login.ldapCombo = ldapCombo;	
					me.login.ldapCombo.store.setData(sessionData.data.ci["ldapdesc"].store);
					// TECH-32997
					me.login.ldapCombo.store.isEmptyStore = false;
					me.login.ldapCombo.setValueOnData();
				}
				//TECH-31141
				sJson = getConfigJson("span1_ide_forgetpwd");				
				var frglnk = Ext.create("Ext.ramco.link.Link", Ext.apply({
					renderTo: "span1_ide_forgetpwd",					
					role : "frgtpwd",
					controller : controller,
					viewModel: viewModel,
					text : "Forgot Password?"					
				}, sJson));
				frglnk.controller.setView(me);
				frglnk.viewModel.setView(me);
				me.login.frglnk = frglnk;
				//TECH-31141
				/*var sBtn , sconfg, sJson;
				sBtn = document.getElementById("span_submit");
				if(sBtn && sBtn.hasAttribute("config")) {
					sconfg = sBtn.getAttribute("config");
					if (sconfg) {
						sJson = Ext.decode(sconfg, true);						
					}
				}
				if (Ext.isEmpty(sJson)) {
					sJson = {};
				}*/
				sJson = getConfigJson("span_submit");
				var sbbtn = Ext.create("Ext.button.Button", Ext.apply({
					renderTo: "span_submit",					
					action : "task",
					task : "tskstdlogin",
					taskType : "submit",
					controller : controller,
					viewModel: viewModel,
					role : "uipage",
					text : "Login"
				}, sJson));
				sbbtn.controller.setView(me);
				sbbtn.viewModel.setView(me);
				uname.inputEl.focus(50);
			}
			//TECH-32102
			if (ilboConfig.ilboName == "ezelogin" && !Ext.isEmpty(sessionData.data.ci["ldapdesc"])) {
				var ldapDesc = me.down('#ldapdesc'),
					frgtPwdLnk = me.down('#frgtpwdlink'),//TECH-28474
					tdNode = null;
				if (me.config.htmFile === true) {
					ldapDesc = me.login.ldapCombo;
					frgtPwdLnk = me.login.frglnk;
					if (ldapDesc && ldapDesc.el) {
						tdNode = ldapDesc.el.up('td');
						if (tdNode) {
							tdNode.setStyle("display", "");
						}
					}
				}
				if (ldapDesc) {
					ldapDesc.show();
					if(frgtPwdLnk){//TECH-28474
						if(!Ext.isEmpty(sessionData.data.ci["ldapdesc"].value) && sessionData.data.ci["ldapdesc"].value.toLowerCase() != "default")
							frgtPwdLnk.hide();
						else
							frgtPwdLnk.show();
					}
				}
			}
        }
        // if (controller)
            // controller.taskPending = false;
        if (ilboConfig && !Ext.isEmpty(sessionData) && !me.beforeUserPostProcess(taskName, ilboConfig.activityName, ilboConfig.ilboName, me.activeTabName)) {
            Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R221);
        }
		if (!RamcoRTC.isGProto) {
			if (viewModel) {
				try {
					if (sessionData){
						viewModel.loadData(sessionData);
						viewModel.clearModified();
						Ext.suspendLayouts();
						viewModel.commitStore();
						Ext.resumeLayouts();
					}
					else{
						if (viewModel.nonModifiedTasks.indexOf(taskName) == -1) {
							viewModel.clearModified();
							Ext.suspendLayouts();
							viewModel.commitStore();
							Ext.resumeLayouts();
						}
					}
				} catch (e) {
					console.log(e);
				}
			}
		}
		else {
			var jsonControls = Object.keys(sessionData.data.ci).map(function (key) { return key;});
			var jcLen = jsonControls.length;
			for (var jc=0; jc<jcLen; jc++) {
				if (Ext.isEmpty(jsonControls[jc]))
					return;
				var curCtrl = this.down('#' + jsonControls[jc]);
				if (curCtrl) {
					if (curCtrl.xtype != "ramcogrid") {
						if ((curCtrl.xtype == "ramcorstreegrid" || curCtrl.xtype == "ramcorstreepanel") && curCtrl.store.type == "tree") {
							 curCtrl.store.setRoot(sessionData.data.ci[jsonControls[jc]].store);
							 curCtrl.setValue(sessionData.data.ci[jsonControls[jc]].value);
						}
						else if (curCtrl.xtype == "ramcoorgchart") {
							curCtrl.setStore(curCtrl.store);
							curCtrl.store.setRoot(sessionData.data.ci[jsonControls[jc]].value.store);							
							curCtrl.setValue(sessionData.data.ci[jsonControls[jc]].value);
						}
						else if (curCtrl.xtype == "ramcotagfield") {							
							curCtrl.setValueData(sessionData.data.ci[jsonControls[jc]].value);
							curCtrl.store.isEmptyStore = false;
						}
						else if (curCtrl.xtype == "ramcorslistview") {							
							curCtrl.setValue(sessionData.data.ci[jsonControls[jc]].value);
						}
						else if (curCtrl.xtype == "combofield") {
							curCtrl.store.loadData(sessionData.data.ci[jsonControls[jc]].store);
							curCtrl.store.isEmptyStore = false;
						}
						else if (curCtrl.xtype == "ramcosplitbutton") {
							curCtrl.setStore(sessionData.data.ci[jsonControls[jc]].store);
						}
						else if (curCtrl.xtype == "ramcodataview" && curCtrl.type == "stackedlink") {
							curCtrl.store.loadData(sessionData.data.ci[jsonControls[jc]].store);
							curCtrl.store.isEmptyStore = false;
						}
						else {
						if (curCtrl.setFormat) {
							curCtrl.setFormat(sessionData.data.ci[jsonControls[jc]].ft);
						}
						if (curCtrl.setValue) {
							curCtrl.setValue(sessionData.data.ci[jsonControls[jc]].value);
						}
					}
					}
					else {
						if (curCtrl.xtype == "ramcogrid") {	
							curCtrl.setValue(sessionData.data.ci[jsonControls[jc]].value);
							//curCtrl.store.loadData(sessionData.data.ci[jsonControls[jc]].value.store);
							//curCtrl.view.refresh();
						}
					}
				}
            }
        }
		if (controller)
			controller.errors.clear();
		//Ext.suspendLayouts();
		// TECH-35955
		if (ilboConfig && !Ext.isEmpty(sessionData) && !sessionData.hasError && !me.afterUserPostProcess(taskName, ilboConfig.activityName, ilboConfig.ilboName, me.activeTabName)) {
			Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R228);
		}
		//Ext.resumeLayouts(true);
        if (taskName == 'tskstdscreeninit') {
		    //Ext.defer(me.setPop, 10, me);
			me.suspendLayouts();
			me.show();
			me.setPop();			
			me.resumeLayouts(true);
			/*var rgrid = Ext.ComponentQuery.query('ramcogrid');
			var c = 0 , len = rgrid.length;		
			for(; c < len; c++) {
				//rgrid[c].onViewResize();			
				rgrid[c].updateLayout();
			}*/
			//me.updateLayout({defer:true,isRoot:true});
			
			tabPanObj = me.down('tabpanel');
			if (tabPanObj && tabPanObj.role != "calander") {
				me.callBackStatus = "IP";
				//tabPanObj.updateLayout();
				//return;
			}
			me.removeCls('x-hideilbo');
        }
		// TECH-38435
		me.showWizardTitle();
		// AHBG-31929 / AHBG-31944 / AHBG-31955
		if (!ctexdata)
			ctexdata = me.ctexdata;
		
		//if(ctexdata && ctexdata.childElementCount > 0) {
		if(ctexdata && ctexdata.length > 0) {
			me.ctexdata = ctexdata;			
			var ctexnode, ctExName, ctExCtrl, ctExView, ctExHlp, ctExSrc, ctTooltip,
				gridCol, childNodes, colId, x = 0, m =0,  j = 0, childNode,
				gridHeadColNode, gridHeadColNodeAttrs, gridColChildNode, gridColAttr, colObjArr = {}, imgSrc;
			for (; m < ctexdata.length; m++) {
				ctexnode = ctexdata[m];
				if (ctexnode && ctexnode.nodeType != '3') {
					ctExName = ctexnode.getAttribute('id');
					ctExCtrl = me.down('#' + ctExName);					
			
			if (ctExCtrl && ctExCtrl.xtypes) {
				if ((ctExCtrl.xtypes.indexOf('textarea') > -1 || ctExCtrl.xtypes.indexOf('textfield') > -1 || ctExCtrl.xtypes.indexOf('ramcolabel') > -1)) {
							ctExView = ctexnode.querySelector('vws > vw[id="' + ctExName + '"]');
							for (; ctExView.childNodes && j < ctExView.childNodes.length > 0; j++) {
						var ctExLnk = ctExView.childNodes[j];
						if(ctExLnk && ctExLnk.nodeType != 3) {
							var parentCtrl = ctExCtrl.ownerCt,
								ctExHlp,imgEl,ctrlPos, imgCtrl, hlpTask, tskId, chWidth, chHeight;
							ctTooltip = ctExLnk.getAttribute('ds');
							ctExSrc = ctExLnk.getAttribute("im");
							hlpTask = ctExLnk.getAttribute("tn");
							tskId = ctExLnk.getAttribute("id");
							chWidth = ctExLnk.getAttribute("width");
							chHeight = ctExLnk.getAttribute("height");
							if (Ext.isEmpty(hlpTask))
								hlpTask = 'tskstdclink';
							if (!Ext.isEmpty(ctExSrc)) {
								var spCtExSrc = ctExSrc.split('../');
								if (spCtExSrc)
									ctExSrc = '../hub/' + spCtExSrc[1];
							}
							if (parentCtrl.itemId != ctExName + 'panel'+ j && !parentCtrl.ctrlExProcessed) {
								for (k = 0;k < parentCtrl.items.length; k++) {
									if (parentCtrl.items.items[k].itemId == ctExCtrl.itemId)
										ctrlPos = k;
								}
								imgCtrl = {
									xtype: 'image',
											margin:'3 0 0 0', // AHBG-31785
									itemId: ctExName + 'help' + j,									
									src: ctExSrc,
									task: hlpTask,
									style: { cursor: 'pointer' }
								};
								ctExHlp = Ext.create('Ext.container.Container', {
									layout: { type: 'hbox' },
									itemId: ctExName + 'panel' + j,
									role:'uipage',
									items:[ctExCtrl, imgCtrl]
								});
								parentCtrl.insert(ctrlPos,ctExHlp);								
								me.updateLayout();
								if (ctExCtrl.xtypes.indexOf('textarea') > -1) {
									ctExCtrl.setWidth(ctExCtrl.ownerCt.getWidth()-30);
									//ctExCtrl.setHeight(ctExCtrl.ownerCt.getHeight()-80);
									ctExCtrl.inputEl.dom.style.height = '100px';
								}
								else if (ctExCtrl.container && ctExCtrl.container.dom) {
									var ctExCtrlWidth = ctExCtrl.ownerCt.getWidth();
									ctExCtrl.ownerCt.setWidth(ctExCtrlWidth +10);
								}
								imgEl = parentCtrl.down('image');								
								if(imgEl && imgEl.el) {
									imgEl.el.dom.setAttribute('data-qtip', ctTooltip);
									imgEl.el.on('click', function() {
										me.fireEvent('trans', me,'', imgEl.task, 'modal',tskId,'','',chWidth,chHeight,ctExCtrl.itemId,ctExCtrl.itemId);
									});
								}
								parentCtrl.ctrlExProcessed = true;
							}
						}
					}
				}
				// AHBG-31929 / AHBG-31944 / AHBG-31955
				else if (ctExCtrl.xtypes.indexOf('ramcogrid') > -1) {
					ctExView = ctexnode.querySelector('vws');
					childNodes = ctExView && ctExView.childNodes;
					if (!Ext.isEmpty(childNodes) && childNodes.length > 0) {
						for (; x < childNodes.length; x++) {
							childNode = childNodes[x];
							if (childNode && childNode.nodeType != 3) {
								colId = childNodes[x].getAttribute('id');
								gridCol = ctExCtrl.getColumnById('v' + colId);
										//gridHeadColNode = childNode && childNode.children[0];
										for (var p = 0; p < childNode.childNodes.length; p++) {
											gridColChildNode = childNode.childNodes[p];
											if (gridColChildNode && gridColChildNode.nodeType != 3)
												gridHeadColNode = gridColChildNode;
										}
										//gridHeadColNodeAttrs = gridHeadColNode && gridHeadColNode.getAttributeNames();
										gridHeadColNodeAttrs = gridHeadColNode && gridHeadColNode.attributes;
										for (var j = 0; j < gridHeadColNodeAttrs.length; j++) {
											//colObjArr[gridHeadColNodeAttrs[j]] = gridHeadColNode.getAttribute(gridHeadColNodeAttrs[j]);
											gridColAttr = gridHeadColNode.attributes[j];
											if (!Ext.isEmpty(gridColAttr))
												colObjArr[gridColAttr.name] = gridColAttr.value;
										}
								if (gridCol && !gridCol.ctrlExProcessed) {
									imgSrc = document.createElement('img');
									imgSrc.src = colObjArr.im;
									imgSrc.style.cssText = "padding-left: 5px; cursor: pointer";
									imgSrc.title = colObjArr.ds;
									imgSrc.onclick = function(e) {
											try {
												me.fireEvent('trans', me,'', 'tskstdclink', 'modal', colObjArr.id, colId, '', colObjArr.width, colObjArr.height, ctExCtrl.itemId, colId);
												event.preventDefault ? event.preventDefault() : (event.returnValue = false);
												e.stopPropagation();
											}
											catch(ex) {}
										};
									Ext.defer(function() {
										if (gridCol.rendered) {
											gridCol.textInnerEl.dom.appendChild(imgSrc);
											gridCol.ctrlExProcessed = true;
										}
									}, 1);
								}
									}
								}								
							}
						}
					}
				}

			}
        }
		if (currWinorHelp && me.callout && me.callout.handleWindowClose) {			
			try {
				return me.callout.handleWindowClose.call(me || window, 'child', ilboConfig.activityName, ilboConfig.ilboName, me.activeTabName);
			} catch (e) {
				console.log("Error in Callout Js." + e);
			}			
		}
		//TECH-41358
		/* if (me.isWindowClose === true) {
			RamcoRTC.isWindowClose = true;			
			return;
		}
		if (RamcoRTC.isWindowClose && me.callout && me.callout.handleWindowClose) {
			RamcoRTC.isWindowClose = false;
            try {
                return me.callout.handleWindowClose.call(me || window, 'parent', ilboConfig.activityName, ilboConfig.ilboName, me.activeTabName);
            } catch (e) {
                console.log("Error in Callout Js." + e);
            }
        } */
		if (controller)
			controller.taskPending = false;        
		if (me.callBack) {
            me.callBack.call();
			me.callBackStatus = "IP";
            me.callBack = null;
            delete me.callBack;
			return;
        }
		delete me.callBackStatus;
		
		try {
			tabPanObj = me.down('tabpanel');
		}
		catch(e){}
		
		if(!Ext.isEmpty(tabPanObj) && tabPanObj.role != "calander") {
			actTab = tabPanObj.getActiveTab();
			if (me.isInit && actTab && actTab.rendered)
				actTab.body.setStyle('opacity', 1);
		}
		/*var rgrid = Ext.ComponentQuery.query('ramcogrid');
		var c = 0 , len = rgrid.length;		
		for(; c < len; c++) {
			//rgrid[c].onViewResize();			
			rgrid[c].updateLayout();
		}*/		
		var rgrid = Ext.ComponentQuery.query('ramcoddtgrid');
		var c = 0 , len = rgrid.length;		
		for(; c < len; c++) {
			rgrid[c].updateLayout();
		}
		//if (taskName != 'tskstdscreeninit') 
			me.updateLayout(true); // TECH-40911
		/*if (tabPanObj) {
			tabPanObj.updateLayout({defer:true});
		}	 */	
		//TECH-35380
		/* if((taskName == "tskstdlogin" || taskName == "tsksendcode") && sessionData.data && sessionData.data.tfi){
			me.twoFactorWindow(sessionData.data.tfi);
		} */
		/* if((taskName == "tskstdlogin" || taskName == "tsksendcode") && sessionData.data && sessionData.data.tfi){
			var mainCt = getMainController();
			mainCt.twoFactorWindow(sessionData.data.tfi.ttl,sessionData.data.tfi.desc);
		} */
		/*me.fireEvent("completed",me);
			var c = getMainController();
			if(c){
			c.onCompleted(me);
		}*/
		//TECH-39575
		if (me.postCallBack) {
            me.postCallBack.call();
			me.callBackStatus = "IP";
            me.postCallBack = null;
            delete me.postCallBack;
			return;
        }
		
		//TECH-41358
		if (me.isWindowClose === true) {
			RamcoRTC.isWindowClose = true;			
			return;
		}
		if (RamcoRTC.isWindowClose && me.callout && me.callout.handleWindowClose) {
			RamcoRTC.isWindowClose = false;
            try {
                return me.callout.handleWindowClose.call(me || window, 'parent', ilboConfig.activityName, ilboConfig.ilboName, me.activeTabName);
            } catch (e) {
                console.log("Error in Callout Js." + e);
            }
        }
    },
	/*twoFactorWindow:function(data){
		var me =this,
		main = getMainController(),modalHelp,
		modalWindow = main.modalWindow,authLabel,sendCode,verify,
		timeToExpire = data.ttl,component,desc = data.desc;
		
		component =   {
						xtype: 'container',
						 layout: {
							type: 'vbox',
							align: 'center',
							pack: 'center'
						}, 
						items: [{
							xtype: 'panel',
							itemId:'passcodePanel',
							padding:'20 20 20 20',
							layout:'hbox',
							items:[{
								xtype: 'label',
								itemId: 'passcodeLabel',
								padding:'0 3 0 0',
								html:'Enter the Pass Code'
							 },{
								xtype: 'textfield',
								role: 'uipage',
								itemId: 'passcodeField',
							}]
							},{
							xtype: 'label',
							itemId: 'authLabel'
						  },{
							xtype: 'panel',
							layout:'hbox',
							 padding:'20 20 20 20',
							items:[{
								xtype: 'button',
								itemId: 'verify',
								role:'mainpage',
								text:'Verify'
							 },{
								xtype: 'button',
								itemId: 'sendCode',
								role:'mainpage',
								disabled:true,
								text:'Send Code'
							  }]
							}
							]
					 }
					
		modalWindow.addComponent(component);
		modalWindow.setSize(300,250);
		modalWindow.setTitle('Authenticate Secure Code');
	 	modalWindow.show();
		modalHelp = modalWindow.queryById('modalHelp');
        modalRefresh = modalWindow.queryById('modalRefresh');
		authLabel = modalWindow.queryById('authLabel');
		sendCode = modalWindow.queryById('sendCode');
		verify = modalWindow.queryById('verify');
		if(!Ext.isEmpty(modalHelp))
			modalHelp.hide();
		if(!Ext.isEmpty(modalRefresh))
			modalRefresh.hide();
		loginTimers = Ext.TaskManager.start({
						run: function() {
							if(timeToExpire > 1 ){
								  verify.setDisabled(false);
								  sendCode.setDisabled(true);
								  authLabel.setHtml('<div style = "padding:10 2 2 2">Pass code sent via '+desc+'</div><div style = "padding:10 2 2 2">Send Code will enable after '+timeToExpire--+'  seconds</div>');  	
							}
							else {
								 Ext.TaskManager.stop(loginTimers);
								 authLabel.setHtml('<div style = "padding:10 2 2 2">Pass code expired</div><div style = "padding:10 2 2 2">Kindly regenerate the pass code</div>');  	
								 sendCode.setDisabled(false);
								 verify.setDisabled(true);
							}
						},interval: 800}); 
		
		
	},*/
	// TECH-38435
	showWizardTitle: function(title) {
		var me = this,
			actTab, actWizText;
		if (me.ilboConfig.ilboName == 'ezwizard') {
			actTab = me.down('#cmpWizHeadTitle');				
			if (!Ext.isEmpty(actTab)) {
				if (Ext.isEmpty(title)) {
					if (RamcoRTC.actWizItem == 'myinbox')
						title = 'My Inbox';
					else if (RamcoRTC.actWizItem == 'favorites')
						title = 'Favorites';
					else if (RamcoRTC.actWizItem == 'menutag')
						title = 'Menu Tag';
					else if (RamcoRTC.actWizItem == 'menumap')
						title = 'Menu Map';
					else if (RamcoRTC.actWizItem == 'wizard1')
						title = 'Wizard';
				}				
				actWizText = actTab.tpl.apply({WizHeadTitle: title});
				actTab.setHtml(actWizText);
			}
		}
	},
    focusPage: function(pageFlag) {
		var me = this;			
		if (me && me.callout && me.callout.doCustomFocus) {
			me.callout.doCustomFocus.call(me);
			return;
		}
		//TECH-34168
		//if (RamcoRTC.focusCtrl.length == 0 && RamcoRTC.lastFocusCtrl.length > 0)
	 	if (RamcoRTC.focusCtrl.length == 0 && RamcoRTC.lastFocusCtrl.length > 0 && me.ilboConfig && (me.ilboConfig.ilboName == RamcoRTC.lastFocusCtrl[0]))
			RamcoRTC.focusCtrl = RamcoRTC.lastFocusCtrl;
        if (RamcoRTC.focusCtrl.length > 0 && pageFlag) {
            var fCtrl = me.down('#' + RamcoRTC.focusCtrl[1]),
                fView = RamcoRTC.focusCtrl[3],
                fRow = RamcoRTC.focusCtrl[2],
                cell = null;				

			if (me && me.popupSec && me.curPopupView) {
				fCtrl = me.curPopupView.down(('#' + RamcoRTC.focusCtrl[1]));
				me.curPopupView = null;
				delete me.curPopupView;
			}
			
            try {
                if (!fCtrl)
                    return true;
                if(fCtrl.itemId == "tabcontrol")
					fCtrl.tabBar.activeTab.focus(false, 50);
                else if (fView == 0 && fRow == 0) {
                    //TECH-33310
					//fCtrl.focus(true, 100);
					fCtrl.focus(100);
					//TECH-39488
					/* if (fCtrl.inputEl) {									
						fCtrl.inputEl.selectText(0, 0);						
					} */
					if (fCtrl.inputEl) {
						if (fCtrl.xtype == "ramcolistedit") {
							var ctrlLen = fCtrl.getValue() || "";
							fCtrl.inputEl.selectText(ctrlLen.length, ctrlLen.length);
						}
						else {
							fCtrl.inputEl.selectText(0, 0);
						}
					}
				}
                else {
                    if (Ext.isFunction(fCtrl.gridFocus))
                        fCtrl.gridFocus(fView, fRow);
                }
            } catch (e) {}
        }
		else{
			//AHBG-16075
			var count = [],
				defaultFocusCtrl; //TECH-33310
			try{
				count = me.query('field[editable][itemId!="rowNav"][itemId!="fieldList"][itemId!="fieldSearch"]');
			}catch(e){			
			}
			if(count.length > 0) {
				// TECH-32861
				//me.focus();
				defaultFocusCtrl = me.getDefaultFocus();
				if (defaultFocusCtrl && defaultFocusCtrl.inputEl) {
					//TECH-33310
					//defaultFocusCtrl.inputEl.focus();
					defaultFocusCtrl.inputEl.focus(50);
					defaultFocusCtrl.inputEl.selectText(0, 0);					
				}
			}
		}
		//TECH-38482
		if(!Ext.isEmpty(RamcoRTC.LastPageScrollX)  && !Ext.isEmpty(RamcoRTC.LastPageScrollY)){
			Ext.defer(function(scrollX,scrollY){
					scroller = this.getScrollable();
					if(scroller && typeof scroller.scrollTo == "function")
						scroller.scrollTo(scrollX,scrollY, false);
				},50,me,[RamcoRTC.LastPageScrollX,RamcoRTC.LastPageScrollY]);
		}
    },
    getTaskData: function(index) {
        var me = this,
            data = [],
			task = '',
            controller = me.getController();
		if (index < 1) {
			task = 'tskstdgettaskdata' 
		}
		else {
			task = 'tskstdscreeninit';
			me.ilboConfig.tabName = '';
			me.lastTaskName = '';
		}
		if (RamcoRTC.osType == 'JAVA' && task == 'tskstdgettaskdata')
			task = 'tskstdgetdata';
        if (controller)
            controller.taskPending = false;		
        me.fireEvent('getdata', me, data, task, me.lastTaskName);
    },
    setPop: function() {
        var me = this
        var popup = me.query('window');
		if (popup && popup.length > 0) {
			var len = popup.length,
				i = 0,
				element = null;
			for(; i < len; i++) {
				element = popup[i];
			//popup.forEach(function(element, index, array) {
				if(!element.isPvtDD) {
            element.constrain = true;
			//element.alwaysOnTop = true;
            element.constrainTo = (me && me.body) ? me.body.dom : '';
			element.maskClickAction = "hide";
            element.floatParent = me;
            element.setCollapsible(false);
			}
			}
		//);
		}
    },
    beforePopupHide: function() {
        var me = this;
        if (!me.taskPending)
            Ext.getBody().unmask();
    },
    updatePersonalization: function(ctrlId, data) {
        var me = this,
            viewModel = me.getViewModel(),
            controller = me.getController();
        if (controller)
            controller.taskPending = false;
        if (viewModel) {
            viewModel.applyPersonalization(ctrlId, data);
        }
    },
    // TECH-30546 / PNU-164
    performPersonalization: function(data, tabObj) {
        var me = this,
            iconCls = 'x-fa fa-thumb-tack',
            cnt = me.getController(),
            btn = null,
            comp = null, 
			queryObj; // TECH-30546 / PNU-164
        me.persData = data[RamcoRTC.currentTemplate];
		// TECH-30546 / PNU-164
        queryObj = (!Ext.isEmpty(tabObj)) ? tabObj : me;
        comp = queryObj.query('component[role="uipage"]');
		
		// TECH-30546 / PNU-164
		if (Ext.isEmpty(tabObj)) {
			me.callBack = function() {
				me.fireEvent('persgetdoc', me, 'GETDOC', 'trans');
				return;
			}
			me.fireEvent('persrole', me);
		}
		
        if (comp && comp.length > 0) {
			var len = comp.length,
				i = 0,
				element = null;
			for(; i < len; i++) {
				element = comp[i];
				//comp.forEach(function(element, index, array) {
                if (element.role == 'uipage') {
                    if (element && element.rendered) {
                        iconCls = 'x-fa fa-thumb-tack';
                        if (me.persData && me.persData.data[element.itemId])
                            iconCls = 'x-fa fa-thumb-tack-left';
						//HSI-191
                        // TECH-31870 
						//if (element.xtype == 'ramcopanel' && !element.hidden && element.config.header) {
                        if (element.xtype == 'ramcopanel' && !element.hidden) {
                            Ext.create('Ext.button.Button', {
                                ownerCt: me,
                                role: 'pers',
                                cType: 'panel',
                                ctrlId: element.itemId,
                                cls: 'x-btn-pers',
                                iconCls: iconCls,
                                renderTo: element.container.dom
                            });
							//TECH-32503/CDIH-122
							//element.setWidth("calc(100% - 30px)");
                            //element.setStyle({'display':'inline-block'}); //for getting personalization pop up on click of pinIcon for grid

							//TECH-36199 /KNB-259
                        } else if (element.xtype == 'ramcogrid') {//TECH-37397 /KNB-298
                            Ext.create('Ext.button.Button', {
                                ownerCt: me,
                                role: 'pers',
                                cType: 'panel',
                                ctrlId: element.itemId,
                                cls: 'x-btn-pers',
                                iconCls: iconCls,
                                renderTo: element.container.dom
                            });
							//TECH-32503/CDIH-122   TECH-37397 /KNB-298
							if(element.ownerCt && (element.ownerCt.xtype == 'ramcopanel' || element.ownerCt.xtype == 'container')){
									 element.ownerCt.setWidth("calc(100% - 30px)");
									 element.ownerCt.setStyle({'display':'inline-block'}); //for getting personalization pop up on click of pinIcon for grid
							}
							//TECH-36199 /KNB-259
                        } else if ((element.xtype == 'textfield' || element.xtype == 'textarea' || element.xtype == 'numberfield' || element.xtype == 'ramcomaskfield') && element.itemId != 'fieldSearch') {
                            Ext.create('Ext.button.Button', {
                                ownerCt: me,
                                role: 'pers',
                                cType: 'text',
                                ctrlId: element.itemId,
                                iconCls: iconCls,
								userCls:'x-pers-textfield',//TECH-32503/CDIH-122
                                /* style: {
                                    'position': 'relative',
                                    'right': 'auto'
                                }, */
                                renderTo: element.container.dom
                            });
                        } else if (element.xtype == 'checkbox' || element.xtype == 'checkboxfield' || element.xtype == 'ramcoradio') { // Personalization
                            Ext.create('Ext.button.Button', {
                                ownerCt: me,
                                role: 'pers',
                                cType: (element.xtype == 'checkbox') ? 'check' : 'radio',
                                ctrlId: element.itemId,
                                iconCls: iconCls,
								userCls:'x-pers-checkbox',//TECH-32503/CDIH-122
                                /* style: {
                                    'position': 'relative',
                                    'right': '0'
                                }, */
                                renderTo: element.container.dom
                            });
                        } else if (element.xtype == 'combofield' || element.xtype == 'ramcolistedit' || element.xtype == 'datefield' || element.xtype == 'ramcodatetimefield' || element.xtype == 'ramcotimefield') { // TECH-27833 / AHBG-25788
                            Ext.create('Ext.button.Button', {
                                ownerCt: me,
                                role: 'pers',
                                cType: (element.xtype == 'combofield') ? 'combo' : 'date',
                                ctrlId: element.itemId,
                                iconCls: iconCls,
								userCls:'x-pers-combo',//TECH-32503/CDIH-122
								/* style: {
                                    'position': 'relative',
                                    'right': '0'
                                }, */
                                renderTo: element.container.dom
                            });
                        } else if (element.xtype == 'ramcolabel') {
                            Ext.create('Ext.button.Button', {
                                ownerCt: me,
                                role: 'pers',
                                cType: 'label',
                                ctrlId: element.itemId,
								userCls:'x-pers-ramcolabel',//TECH-32503/CDIH-122
                                iconCls: iconCls,
                               /*  style: {
                                    'position': 'relative',
                                    'right': '0'
                                }, */
                                renderTo: element.container.dom
                            });
							element.setWidth("calc(100% - 32px)");
                        }  else if ( element.xtype == 'segmentedbutton') { // TECH-32503/CDIH-122
							Ext.create('Ext.button.Button', {
                                ownerCt: me,
                                role: 'pers',
                                cType: 'segmentedbtn',
							    ctrlId: element.id,
								userCls:'x-pers-segmentedbtn',//TECH-32503/CDIH-122
                                iconCls: iconCls,
                                /* style: {
                                    'position': 'relative',
									'right': '0'
                                }, */
                                renderTo: element.container.dom
                            });
							//TECH-37397 /KNB-298
                            if(element.ownerCt && (element.ownerCt.xtype == 'ramcopanel' || element.ownerCt.xtype == 'container')){
								element.ownerCt.setWidth("calc(100% - 30px)");
							}
							element.setWidth("calc(100% - 15px)");
						}
                          else if ((element.xtype == 'button' || element.xtype == 'link' || element.xtype == 'datahyperlink') && (element.ownerCt && element.ownerCt.xtype != 'segmentedbutton')) {
                            Ext.create('Ext.button.Button', {
                                ownerCt: me,
                                role: 'pers',
                                cType: 'task',
                                ctrlId: element.itemId,
								userCls:'x-pers-btn',//TECH-32503/CDIH-122
                                iconCls: iconCls,
                                /* style: {
                                    'position': 'relative',
                                    'right': '0',
									'margin-left': '3px'
                                }, */
                                renderTo: element.container.dom
                            });
                        }
                        //TECH-37397 /KNB-298
                        if (element.xtype != 'ramcosliderpanel' && element.xtype != 'ramcopanel')
                            element.setStyle({'display': 'inline-block'});
                    }
                //}
                }
            }
			
        }
    },
    // performDefaultTemplate: function(data, cmb, txt, store) { // DefModeChanges
    performDefaultTemplate: function(data,tabObj) { // DefModeChanges
        var me = this,
            cnt = me.getController(),
            tmp,
            comp = null,
            exitingCheck = null;
        me.persData = data;
		//TECH-35081 /PTPH-41
			queryObj = (!Ext.isEmpty(tabObj)) ? tabObj : me;
        comp = queryObj.query('component[role="uipage"]');
        //comp = me.query('component[role="uipage"]');
        exitingCheck = Ext.ComponentQuery.query('[role=template]');
        if (exitingCheck && exitingCheck.length > 0) {
            for (var k = 0; k < exitingCheck.length; k++)
                exitingCheck[k].destroy();
        }
        if (comp && comp.length > 0) {
			var len = comp.length,
				i = 0,
				element = null;
			for(; i < len; i++) {
				element = comp[i];
			// DefMode
            //comp.forEach(function(element, index, array) {
                if (element.role == 'uipage' && !element.up('ramcogrid')) {
					//TECH-36199 /KNB-259
                    if (element && element.rendered && (element.xtype == 'textfield' || element.xtype.indexOf('textarea') > -1 || element.xtype == 'combofield' || element.xtype == 'numberfield' || element.xtype == 'combofield' || element.xtype == 'datefield' || element.xtype == 'ramcomaskfield')) {
                        element.setStyle('display', 'inline-block');
						Ext.create('Ext.form.field.Checkbox', {
                            ownerCt: me,
                            role: 'template',
                            cType: 'text',
                            ctrlId: element.itemId,
							style: { 'display': 'inline-flex' },
                            renderTo: element.container.dom
                        });
						//TECH-35081 /PTPH-41
						if(!Ext.isEmpty(element.up('[xtype=container]'))){
							parentTd = element.el.up('td');
							parentTd.setStyle('display','inline-flex');
						}
					}
                }
            }
			//);
        }
		
		// DefMode
		var cmbValue = [{ text: '', value: '' }], cmbTemplate, tempStore,
			items = data.xml,
			VWrules = items && items.querySelectorAll('VWRules'),
			template, itemId, menu = [];
		cmbValue[cmbValue.length] = { text: 'new', value: 'new' };
		if (VWrules && VWrules.length > 0) {
			template = VWrules[0].querySelectorAll('Template');
			if (template && template.length > 0) {
				for (i = 0; i < template.length; i++) {
					itemId = template[i].getAttribute('name');
					if (itemId != 'xml' && itemId != 'default')
						cmbValue[cmbValue.length] = { text: itemId, value: itemId };
				}
			}
		}
		
        return cmbValue;
    },
    getSessionData: function() {
        var me = this,
            viewModel = me.getViewModel(),
            controller = me.getController();
        if (viewModel)
            return viewModel.getSessionData();
    },
    getGridFullData:function(ctrlId,callBack){
		//TECH-39575
		var me = this,
			controller = me.getController();
		me.gridCallBack = callBack;
		if (controller.taskPending) {
			var uiCallBack = function() {
				controller.taskPending = true;
				me.fireEvent('griddata',me,ctrlId);
			};
			me.postCallBack = uiCallBack.bind(me);
		}
		else {
			controller.taskPending = true;
			me.fireEvent('griddata',me,ctrlId);
		}
	},
	setGridFullData:function(data,ctrlId){
		var me =this,
			viewModel = me.getViewModel(),
            controller = me.getController();
        if (controller)
            controller.taskPending = false;
        //viewModel.setGridFullData(data, ctrlId);
		//TECH-39575
		if(typeof me.gridCallBack == "function"){
			me.gridCallBack.call(me,data,ctrlId);
			me.gridCallBack=null;
			delete me.gridCallBack;
			delete me.callBackStatus;
		}	
		if (me.callBack) {
			me.callBackStatus = "IP";
			me.callBack.call();
			me.callBack = null;
			delete me.callBack;
			return true;
		}	
		return false;
	},
    setListData: function(data, ctrlId, view, ascCtrl) {
        var me = this,
            viewModel = me.getViewModel(),
            controller = me.getController();
        if (controller)
            controller.taskPending = false;
        viewModel.setListData(data, ctrlId, view, ascCtrl);
    },
	setCustomListData: function(data, ctrlId, view, ascCtrl) {
        var me = this,
            viewModel = me.getViewModel(),
            controller = me.getController();
        if (controller)
            controller.taskPending = false;
        viewModel.setCustomListData(data, ctrlId, view, ascCtrl);
    },
    getControlData: function(ctrlName, viewName, row) {
        var me = this,
            viewModel = me.getViewModel();
        if (!viewName)
            viewName = ctrlName;
        if (viewModel) {
            if (ctrlName == viewName) {
                var data = viewModel.getData();
                if (data.hasOwnProperty(ctrlName) && data[ctrlName].value) {
                    return data[ctrlName].value;
                } else
                    return "";
            } else {
                var ctrl = me.down('#' + ctrlName),
                    store = ctrl ? ctrl.store : null,
                    record, val = "";
                if (store) {
                    record = store.findRecord('rn', row);
                    if (record) {
                        val = record.get(viewName);
                    }
                }
                return val;
            }
        }
    },
    setControlData: function(ctrlName, viewName, row, value) {
		//TECH-32026        
		var me = this,
            splitVal = null,
            nl = null,
            at = null,
			ctrl = me.down('#' + ctrlName),
            viewModel = me.getViewModel();
        if (viewModel) {
            var data = viewModel.getData();
		
		     if (ctrlName == viewName) {
                splitVal = value && value.split ? value.split(":!#@SCN@#!:") : '';
                if (splitVal.length > 1) {
                    value = splitVal[0];
                    nl = splitVal[1];
                    at = splitVal[2];
                }
                if (data.hasOwnProperty(ctrlName)) {
					if(ctrl && Ext.isFunction(ctrl.setValue) && typeof value != 'object'){
						ctrl.setValue(value);
					} 
                    if (data[ctrlName].value)
                        data[ctrlName].value = value;
                    else {
                        data[ctrlName] = {};
                        data[ctrlName].value = value;
                    }
                    if (nl || at) {
                        data[ctrlName].nl = nl;
                        data[ctrlName].at = at;
                    }
                    viewModel.setModified(ctrlName);
                }
            } else {
                var store = ctrl ? ctrl.store : null,
                    record;
                if (store) {
                    record = store.findRecord('rn', row);
                    if (record) {
                        record.set(viewName, value);
                    }
                } else if (data.hasOwnProperty(ctrlName)) {
					if(ctrl && Ext.isFunction(ctrl.setValue) && typeof value != 'object'){
						ctrl.setValue(value);
					} 
                    if (data[ctrlName].value)
                        data[ctrlName].value = value;
                    else {
                        data[ctrlName] = {};
                        data[ctrlName].value = value;
                    }
                    viewModel.setModified(ctrlName);
                }
            }
        }
    },
	setControlModified: function(ctrlName) {
		 var me = this,            
            viewModel = me.getViewModel();
		if (viewModel) {
			viewModel.setModified(ctrlName);
		}
	},
    getControl: function(ctrlName) {
        var me = this,
            ctrl = null;
        ctrl = me.down('#' + ctrlName);
        return ctrl;
    },
    getGridCell: function(ctrlName, viewName, row) {
        var me = this,
            ctrl = me.down('#' + ctrlName),
            cell;
        if (ctrl)
            cell = ctrl.getCell(row, viewName);
        return cell;
    },
    getElement: function(ctrlName) {
        var me = this,
            ctrl = null;
        ctrl = me.down('#' + ctrlName);
        if (ctrl)
            return ctrl.dom;
        return null;
    },
    setTabScreenInfo: function(tabName, isInit) {
        var me = this;
        me.tabPageState[tabName] = isInit;
        me.activeTabName = tabName;
    },
    getActiveTabNeedInit: function() {
        var me = this;
        if (me.activeTabName) {
            return !me.tabPageState[me.activeTabName];
        }
        return false;
    },
    getActiveTabName: function() {
        return this.activeTabName;
    },
    getDefaultFocus: function() {
        var defaultFocus = this.defaultFocus,
            result;

        if (defaultFocus) {
            result = this.down(defaultFocus);
        } else {
            result = this.down('field[editable=true]');
        }

        // Returning undefined is ok
        return result;
    },
    executeTask: function(task, taskType, isModel) {
        var me = this,
			controller = me.getController(),
            //viewModel = me.getViewModel(),
            data = [];
        if (!task)
            return;
        //data = viewModel.getSessionData();
		if (controller.taskPending) {
			var uiCallBack = function() {
				controller.taskPending = true;
				me.fireEvent('uitask', me, data, task, taskType, '', null, null, isModel, null);
			};
			me.callBack = uiCallBack.bind(me);
		}
		else {
			controller.taskPending = true;
			me.fireEvent('uitask', me, data, task, taskType, '', null, null, isModel, null);
		}
    },
	executeLinkTask: function(task, taskType, v, childWidth, childHeight, modal, popup, eventDetails) {
		var me = this,
			controller = me.getController(),            
            data = [];
        if (!task)
            return;        
		if (controller.taskPending) {
			var uiLinkCallBack = function() {
				controller.taskPending = true;				
				me.fireEvent('linktask', me, data, task, taskType, '', childWidth, childHeight, modal, '', eventDetails);
			};
			me.callBack = uiLinkCallBack.bind(me);
		}
		else {
			controller.taskPending = true;			
			me.fireEvent('linktask', me, data, task, taskType, '', childWidth, childHeight, modal, '', eventDetails);
		}
    },
    fireEvent: function(eventName) {
        var me = this,
            args = null,
            ilboConfig = me.ilboConfig,
            viewModel = me.getViewModel(),
            controller = me.getController(),
			mainCt = getMainController(),
            task = arguments.length > 3 ? arguments[3] : null,
			//TECH-34021 //TECH-40721 
			argArr0 = ['listdata','customlistdata'],
			argArr1 = ['disable_cancel','_cancelpass'],
			argArr2 = ['deletefile','GETDOC','SAVEDOC', 'tskstdsort'],
			argArr3 = ['tskstdpivotdrilldown','tskstdgriddefault','tskstdfiltergrid',
					   'tskstdrenderpivot', 'tskstdsavepersonalization',
					   'importexcel','exportpdf','exportcsv','export','exportexcel',
					   'exporthtml','exportreport','exportchart','uploadfile','validatefile',
					   'importcsv','tsksysuictxtswapply','tsksysuictxtsrolchg'];
		//TECH-40243
		var gridArrary = [],
			gridArrLen = 0;			   
        if (Ext.isString(task)) {
			task = task.toLowerCase();
			if(task == "tskstdscreeninit" && arguments[1].coCtrlName != '_cancelpass'){
				this.callParent(arguments);
				return;
			}
			//TECH-40243
			if (me && eventName != 'listdata' && eventName != 'customlistdata') { // TECH-40879
				gridArrary = me.query("ramcogrid");
				gridArrLen = gridArrary.length;
				for (var g=0; g<gridArrLen; g++) {
					var curGrid = gridArrary[g];
					if (curGrid && curGrid.plugins && curGrid.plugins[0] && curGrid.plugins[0].editing) {
						curGrid.plugins[0].completeEdit();
					}
				}
			}
			//TECH-35380
			if(mainCt && mainCt.timeToExpire && mainCt.desc && mainCt.otpTaskArr && mainCt.otpTaskArr.length > 0 ){
				var otpTaskVal = mainCt.otpTaskArr,i,data = viewModel.getSessionData();
					for( i= 0 ; i < otpTaskVal.length; i++ ){
						if(otpTaskVal[i] == task){
							mainCt.otpTask = task;
							//me.mask
							RamcoRTC.doTransactions(mainCt.onRequestComplete, mainCt.onRequestException, mainCt,{
										componentName: 'security',
										activityName:'login',
										activityDesc: 'Sign In',
										ilboName: 'ezelogin',
										ilboDesc: 'Sign In',
										ilboType: '1'
									}, 'tsksendcode', 'trans', data, null, null, null, null, null);	
							return;
						}
					}
		    }
			if(controller.errors.length > 0) {				
				Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R044, Ext.emptyFn, undefined, 'error');
				controller.taskPending = false;
				return false;
			}
            me.lastTaskName = task;
            if (me.cmsg && !Ext.isEmpty(me.cmsg[task])) {
                args = Array.prototype.slice.call(arguments, 1);
                Ext.RamcoMsg.confirm(rvw_resources.R037, me.cmsg[task], function(btnId) {
                    if (btnId == "ok" || btnId == "yes") {
                        if (me.userPreProcess(task, ilboConfig.activityName, ilboConfig.ilboName, me.activeTabName)) {
                            viewModel = me.getViewModel();
							//TECH-34021
							//if (args.length > 2 && (args[2] != 'tskstdpivotdrilldown' && args[2] != 'tskstdgriddefault' && args[2] != 'tskstdfiltergrid' && args[2] != 'tskstdrenderpivot' && args[2] != 'tskstdsavepersonalization' && args[2] != 'importexcel' && args[2] != 'exportpdf' && args[2] != 'exportcsv' && args[2] != 'export' && args[2] != 'exportexcel' && args[2] != 'exporthtml' && args[2] != 'exportreport' && args[2] != 'exportchart' && args[2] != 'uploadfile' && arguments[2] != 'deletefile' && arguments[2] != 'GETDOC' && arguments[2] != 'SAVEDOC'))
								args[1] = viewModel.getSessionData();
                            me.fireEventArgs(eventName, args);
						}
                        else {
                            console.log('User pre-process returned false');
                            controller.taskPending = false;
                        }
                    } else {
                        controller.taskPending = false;
                    }
                });
                return;
            } else {
                if (me.userPreProcess(task, ilboConfig.activityName, ilboConfig.ilboName, me.activeTabName)) {
                    //if (viewModel.getModified().length > 0) {
						/*if (arguments.length > 2 && (arguments[1].coCtrlName != 'disable_cancel' && arguments[1].coCtrlName != '_cancelpass'&& arguments[3] != 'tskstdpivotdrilldown' && arguments[3] != 'tskstdgriddefault' && arguments[3] != 'tskstdfiltergrid' && arguments[3] != 'tskstdrenderpivot' && arguments[2] != 'tskstdsort' && arguments[3] != 'tskstdsavepersonalization' && arguments[3] != 'importexcel' && arguments[3] != 'exportpdf' && arguments[3] != 'exportcsv' && arguments[3] != 'export' && arguments[3] != 'exportexcel' && arguments[3] != 'exporthtml' && arguments[3] != 'exportreport' && arguments[3] != 'exportchart' && arguments[3] != 'uploadfile' && arguments[3] != 'validatefile' && arguments[3] != 'importcsv' && arguments[2] != 'deletefile' && arguments[2] != 'GETDOC' && arguments[2] != 'SAVEDOC' && arguments[0] != 'listdata' && arguments[3] != "tsksysuictxtswapply" && arguments[3] != "tsksysuictxtsrolchg")) {
                            arguments[2] = viewModel.getSessionData();
                        }*/
                    //}
					//TECH-34021
					if (arguments.length > 2 && (argArr0.indexOf(arguments[0]) < 0) &&
						     (argArr1.indexOf(arguments[1].coCtrlName) < 0) &&
							 (argArr2.indexOf(arguments[2]) < 0) && 
							 (argArr3.indexOf(arguments[3]) < 0)){
								 arguments[2] = viewModel.getSessionData();
					 }
					//TECH-38482
					RamcoRTC.LastPageScrollX = me.getScrollX();
					RamcoRTC.LastPageScrollY = me.getScrollY();
		            return this.callParent(arguments);
                } else {
                    console.log('User pre-process returned false');
                    controller.taskPending = false;
                }
                return null;
            }
            /*} else {
                me.callbackid = Ext.Function.defer(me.fireEvent, 10, me, arguments);
                return null;
            }*/
        }
        return this.callParent(arguments);
    },
    hasModified: function() {
        var me = this,
            retVal = false,
            viewModel = me.getViewModel();
        if (viewModel) {
            retVal = viewModel.hasModified();
        }
        return retVal;
    },
    callScreenInit: function() {
        var me = this;
        me.fireEvent('screeninit', me, [], 'tskstdscreeninit');
    },
    afterRender: function() {
        var me = this;
        me.callParent();
        //me.setStyle('opacity', 0.5);
		//me.setStyle('opacity', 0);
        if (me.contextMenu) {
            me.container.on({
                contextmenu: {
                    fn: me.onContextmenu,
                    scope: me
                }
            });

        }
    },
    //onContextmenu: function(e, node, eOpts) {
	onContextmenu: function(e, node, eOpts, isMenu) {
        var me = this,
            menu = me.menu,
            context = me.contextMenu,
			target, srcElem, htmEditor, canAllow = true;
			
		try {
			target = e.target;
			srcElem = (target) ? Ext.fly(e.target) : null;
			if (!Ext.isEmpty(srcElem)) {
				htmEditor = srcElem.findParent("div.x-form-htmleditor");
				if (!Ext.isEmpty(htmEditor))
					canAllow = false;
			}			
		}
		catch(ex) {}
			
        if (context && canAllow) {
            //AHBG-25958
			if (menu){
				Ext.destroy(menu);
				menu = null;
			}
			//if (!menu)
                me.menu = menu = new Ext.menu.Menu({
                    items: context
                });
			if (isMenu && !Ext.isEmpty(node)) {
				menu.showBy(node);
			}
			else {
            	menu.showAt(e.event.clientX, e.event.clientY, false);
			}
            e.preventDefault();
        }
    },
	focusControl: function() {
		var me = this;		
        if (RamcoRTC.lastFocusCtrl.length > 0) {
            var fCtrl = me.down('#' + RamcoRTC.lastFocusCtrl[1]),
                fView = RamcoRTC.lastFocusCtrl[3],
                fRow = RamcoRTC.lastFocusCtrl[2],
                cell = null;
            try {
                if (!fCtrl)
                    return true;
                if (fView == 0 && fRow == 0)
                    fCtrl.focus();
                else {                    
                    if (Ext.isFunction(fCtrl.gridFocus))
						fCtrl.gridFocus(fView, fRow);
                }
            } catch (e) {}
        }
		else {
			me.focus();
		}
	},
    doDestroy: function() {
        var me = this,
			temp=[],
            ilboName = me.ilboConfig.ilboName;
        objectScript = null;
		if (me.login) {
			me.login.uname.destroy();
			me.login.pwd.destroy();
			me.login.frglnk.destroy();
		}
		if(RamcoRTC.reader.uiCtrlArray && !Ext.isEmpty(RamcoRTC.reader.uiCtrlArray[ilboName])) {
			RamcoRTC.reader.uiCtrlArray[ilboName] = null;
			delete RamcoRTC.reader.uiCtrlArray[ilboName];
		}
		
		/* After closing Smartview UI, and then opening a new modal UI causing error at displaying position. */
		if (!Ext.isEmpty(RamcoRTC.smartViewLnkCtrl))
			delete RamcoRTC.smartViewLnkCtrl;
		
        if (me.menu) {
            Ext.destroy(me.menu);
            me.menu = null;
            delete me.menu;
        }
		if (me.contextMenu) {
            me.container.un({
                contextmenu: {
                    fn: me.onContextmenu,
                    scope: me
                }
            });
			Ext.destroy(me.contextMenu);
        }
        if (me.reqScrId) {
            for (key in me.reqScrId) {
                objectScript = document.getElementById(me.reqScrId[key]);
                if (objectScript && objectScript.parentNode) {
                    objectScript.parentNode.removeChild(objectScript);
                    for (prop in objectScript) {
                        try {
                            if (prop != 'src') {
                                // If we set the src property to null IE
                                // will try and request a script at './null'
                                if (prop == 'contentEditable')
                                    continue;
                                else if (prop == 'outerText')
                                    continue;
                                else if (prop == 'outerHTML')
                                    continue;
                                else if (prop == 'prefix')
                                    continue;
                                else
                                    objectScript[prop] = null;
                            }
                        } catch (cleanEx) {
                            //ignore
                            //console.log(cleanEx);
                        }
                        delete objectScript[prop]; // and prepare for GC
                    }
                }
                objectScript = null;
                //delete objectScript;
            }
            me.reqScrId = null;
            delete me.reqScrId;
        }
        if (me.callOutId) {
			if (me.callout && me.callout.doDestroy) {			
				me.callout.doDestroy.call(me);
			}
            window[me.callout] = null;
            delete window[me.callout];
            me.callout = null;
            delete me.callout;
            objectScript = document.getElementById(me.callOutId);
            if (objectScript && objectScript.parentNode) {
                objectScript.parentNode.removeChild(objectScript);
                for (prop in objectScript) {
                    try {
                        if (prop != 'src') {
                            // If we set the src property to null IE
                            // will try and request a script at './null'
                            if (prop == 'contentEditable')
                                continue;
                            else if (prop == 'outerText')
                                continue;
                            else if (prop == 'outerHTML')
                                continue;
                            else if (prop == 'prefix')
                                continue;
                            else
                                objectScript[prop] = null;
                        }
                    } catch (cleanEx) {
                        //ignore
                        //console.log(cleanEx);
                    }
                    delete objectScript[prop]; // and prepare for GC
                }
                objectScript = null;
                //delete objectScript;
            }
            me.callOutId = null;
            delete me.callOutId;
        }
        if (me.cssId) {
            objectScript = document.getElementById(me.cssId);
            if (objectScript && objectScript.parentNode) {
                objectScript.parentNode.removeChild(objectScript);
                objectScript = null;
                //delete objectScript;
            }
            me.cssId = null;
            delete me.cssId;
        }
        if (me.templatesJson) {
			for(key in me.templates){
                value = me.templates[key];
                if (value) {
                    value.destroy();
                    temp.push(value);
                    value = null;
                }
                me.templates[key] = null;
                delete me.templates[key];
            }
			if(temp.length>0)
				Ext.destroy(temp);
			temp=[];
            me.templates = {};
            delete me.templates;
            me.templatesJson = null;
            delete me.templatesJson;
        }
        me.callParent();
    }
});
Ext.define('Ext.ux.desktop.o.TrayClock', {
		override: 'Ext.ux.desktop.TrayClock',
		updateTime: function () {
			var me = this, time = Ext.Date.format(new Date(), me.timeFormat),
				text = me.tpl.apply({ time: time });
			if (me.lastText != text) {
				me.suspendLayouts();
				me.setText(text);
				me.lastText = text;
				me.resumeLayouts();
			}
			me.timer = Ext.Function.defer(me.updateTime, 60000, me);
		}
});


// Table Layout

Ext.define('Ext.layout.container.o.Table', {
    override: 'Ext.layout.container.Table',
    getLayoutItems: function() {
        var me = this,
            result = [],
            owner = me.owner,
            items = owner && owner.items,
            items = (items && items.items) || [],
            len = items.length,
            item, i;
        return items;
    },

    getHiddenItems: function() {
        return [];
    },
    renderChildren: function() {
        var me = this,
            items = me.getLayoutItems(),
            tbody = me.tbody.dom,
            rows = tbody.rows,
            len = items.length,
            hiddenItems = me.getHiddenItems(),
			cell,w,style,wd,
            cells, curCell, rowIdx, cellIdx, item, trEl, tdEl, divEl, i;

        // Calculate the correct cell structure for the current items
        cells = me.calculateCells(items);

        // Loop over each cell and compare to the current cells in the table, inserting/
        // removing/moving cells as needed, and making sure each item is rendered into
        // the correct cell.
        for (i = 0; i < len; i++) {
            curCell = cells[i];
			// TECH-35136
			if (!curCell)
				continue;
            rowIdx = curCell.rowIdx;
            cellIdx = curCell.cellIdx;
            item = items[i];

            // If no row present, create and insert one
            trEl = rows[rowIdx];
            if (!trEl) {
                trEl = tbody.insertRow(rowIdx);
                if (me.trAttrs) {
                    trEl.set(me.trAttrs);
                }
            }

            // If no cell present, create and insert one
            tdEl = Ext.get(trEl.cells[cellIdx] || trEl.insertCell(cellIdx));

            // Render or move the component into the cell
            if (!item.rendered) {
                me.renderItem(item, tdEl, 0);
            } else if (!me.isValidParent(item, tdEl, rowIdx, cellIdx, tbody)) {
                me.moveItem(item, tdEl, 0);
            }
			//TECH-33668
			/*

            // Set the cell properties
			cell ={};
            if (me.tdAttrs) {
                //tdEl.set(me.tdAttrs);
				Ext.apply(cell,me.tdAttrs);
            }
            if (item.tdAttrs) {
                //tdEl.set(item.tdAttrs);
				Ext.apply(cell,item.tdAttrs);
            }
            if (item.colspan > 1 && me.tdAttrs && (!item.tdAttrs || !item.tdAttrs.style || !item.tdAttrs.style.width)) {
                w = me.tdAttrs.style.width;
                    style = {
                        style: {
                            width: w
                        }
				};
                    wd = 0;
                if (w) {
                    w = w.toLowerCase();
                    if (w.indexOf("px") > -1) {
                        wd = parseInt(w.replace("px"), 10);
                        style.style.width = wd * parseInt(item.colspan, 10) + "px"
                    } else if (w.indexOf("%") > -1) {
                        wd = parseInt(w.replace("%"), 10);
                        style.style.width = wd * parseInt(item.colspan, 10) + "%"
                    }
                }
				Ext.apply(cell,style);
                //tdEl.set(style);
            }
			Ext.apply(cell,{
                colSpan: item.colspan || 1,
                rowSpan: item.rowspan || 1,
                cls: me.cellCls + ' ' + (item.hidden?"":(item.cellCls || ''))
            });
            tdEl.set(cell);
			*/

            // If at the end of a row, remove any extra cells
            if (!cells[i + 1] || cells[i + 1].rowIdx !== rowIdx) {
                cellIdx++;
                while (trEl.cells[cellIdx]) {
                    trEl.deleteCell(cellIdx);
                }
            }
        }

        // Delete any extra rows
        rowIdx++;
        while (tbody.rows[rowIdx]) {
            tbody.deleteRow(rowIdx);
        }

        // Check if we've removed any cells that contain a component, we need to move
        // them so they don't get cleaned up by the gc
        for (i = 0, len = hiddenItems.length; i < len; ++i) {
            me.ensureInDocument(hiddenItems[i].getEl());
        }
    },
    calculateCells: function(items) {
		//TECH-33668
		if(this.cells)
			return this.cells;
        var cells = [],
            rowIdx = 0,
            colIdx = 0,
            cellIdx = 0,
            totalCols = this.columns || Infinity,
            rowspans = [], //rolling list of active rowspans for each column
            len = items.length,
            item, i, j;

        for (i = 0; i < len; i++) {
            item = items[i];

            // Find the first available row/col slot not taken up by a spanning cell
            while (colIdx >= totalCols || rowspans[colIdx] > 0) {
                if (colIdx >= totalCols) {
                    // move down to next row
                    colIdx = 0;
                    cellIdx = 0;
                    rowIdx++;

                    // decrement all rowspans
                    for (j = 0; j < totalCols; j++) {
                        if (rowspans[j] > 0) {
                            rowspans[j]--;
                        }
                    }
                } else {
                    colIdx++;
                }
            }

            // Add the cell info to the list
            cells.push({
                rowIdx: rowIdx,
                cellIdx: cellIdx
            });

            // Increment
            for (j = item.colspan || 1; j; --j) {
                rowspans[colIdx] = item.rowspan || 1;
                ++colIdx;
            }
            ++cellIdx;
        }
		//TECH-33668
		this.cells = cells;

        return cells;
    },

    getRenderTree: function() {
        var me = this,
            items = me.getLayoutItems(),
            rows = [],
            role,
            labelAlign = '',
            cls,
			columnsWidth = me.columnsWidth || "",
            result = Ext.apply({
                tag: 'table',
                per: me.owner.xtype || '',
                "data-cls": me.owner.ui || '',
                ctrlid: me.owner.itemId + '-table',
                id: me.owner.id + '-table',
                "data-ref": 'table',
                role: 'presentation',
                cls: me.tableCls,
                cellspacing: 0,
                cellpadding: 0,
                cn: {
                    tag: 'tbody',
                    id: me.owner.id + '-tbody',
                    "data-ref": 'tbody',
                    role: 'presentation',
                    cn: rows
                }
            }, me.tableAttrs),
            //tdAttrs = me.tdAttrs,//TECH-33668
            i, len = items.length,
            item, curCell, tr, rowIdx, cellIdx, cell, cells,
            clsName,
			totalCols = this.columns,			
			theadCells= [],
			thStyle,
			ilbo = me.owner.up('ilbo'),
			isSmartHide = false;
			
		if (ilbo && ilbo.xtype == 'ilbo' && !Ext.isEmpty(ilbo.smartHide) && (me.owner.xtype == 'ramcopanel' || me.owner.xtype == "ramcofieldset" || me.owner.xtype == "container") && me.owner.bodyCls != 'x-bodyinnercontrols')
			isSmartHide = ilbo.smartHide;
		
		if(!Ext.isEmpty(columnsWidth)) {
			var columnsWidthArr = columnsWidth.split("|");
			len = columnsWidthArr.length;
			
			for (i = 0; i < len; i++) {
				thStyle = {};
				thStyle.width =  columnsWidthArr[i];
				if (isSmartHide)
					thStyle.display = 'none';
				
				theadCells.push({
					tag: 'th',
					style:thStyle
				})
			}
			result.cn=[{
				tag: 'thead',
				id: me.owner.id + '-thead',
				"data-ref": 'thead',
				role: 'presentation',
				cn: [{
					tag: 'tr',
					cn: theadCells
				}]
			},
			{
				tag: 'tbody',
				id: me.owner.id + '-tbody',
				"data-ref": 'tbody',
				role: 'presentation',
				cn: rows
			}]
        }
		else if(totalCols > 0) {
			len = totalCols;
			for (i = 0; i < len; i++) {
				thStyle = {};
				if (isSmartHide)
					thStyle.display = 'none';
				
				theadCells.push({
					tag: 'th',
					style:thStyle
				})
			}
			result.cn=[{
				tag: 'thead',
				id: me.owner.id + '-thead',
				"data-ref": 'thead',
				role: 'presentation',
				cn: [{
					tag: 'tr',
					cn: theadCells
				}]
			},
			{
				tag: 'tbody',
				id: me.owner.id + '-tbody',
				"data-ref": 'tbody',
				role: 'presentation',
				cn: rows
			}]
		}
		else{
			result.cn = {
				tag: 'tbody',
				id: me.owner.id + '-tbody',
				"data-ref": 'tbody',
				role: 'presentation',
				cn: rows
			}
		}
		
		i=0;
		len = items.length;

        // Calculate the correct cell structure for the current items
        cells = me.calculateCells(items);

        for (i = 0; i < len; i++) {
            item = items[i];

            curCell = cells[i];
			// TECH-35136
			if (!curCell)
				continue;
            rowIdx = curCell.rowIdx;
            cellIdx = curCell.cellIdx;

            // If no row present, create and insert one
            tr = rows[rowIdx];
            if (!tr) {
                tr = rows[rowIdx] = {
                    tag: 'tr',
                    role: 'presentation',
                    cn: []
                };
                if (me.trAttrs) {
                    Ext.apply(tr, me.trAttrs);
                }
            }
            cell = tr.cn[cellIdx] = {
                tag: 'td',
                role: 'presentation',
                'data-bd': item.border ? 'border' : 'noborder',
                'data-tp': (item.xtype == "ramcopanel" || item.xtype == "ramcofieldset") ? 'top' : '',
                'data-id': item.itemId,
				style:{},
                cn: []
            };
            if (me.tdAttrs) {
                //tdEl.set(me.tdAttrs);//TECH-33668
				cell = MergeRecursive(cell,me.tdAttrs);
            }
            if (item.tdAttrs) {
                //tdEl.set(item.tdAttrs);//TECH-33668
				cell = MergeRecursive(cell,item.tdAttrs);
            }
            //if (item.colspan > 1 && me.tdAttrs && (!item.tdAttrs || !item.tdAttrs.style || !item.tdAttrs.style.width)) {
				//TECH-33668
			if (item.colspan > 1 && cell.style) {
                    var w = cell.style.width,
                        style = {
                            style: {
                                width: w
                            }
                        },
                        wd = 0;
                    if (w) {
                        w = w.toLowerCase();
                        if (w.indexOf("px") > -1) {
                            wd = parseInt(w.replace("px"), 10);
                            style.style.width = wd * parseInt(item.colspan, 10) + "px"
                        } else if (w.indexOf("%") > -1) {
                            wd = parseInt(w.replace("%"), 10);
                            style.style.width = wd * parseInt(item.colspan, 10) + "%"
                        }
			          }
					cell = MergeRecursive(cell, style);
            }
            /*if(me.owner.xtype=="ramcopanel" || me.owner.xtype=="ramcofieldset"){
            	clsName = item.getCustomCls();
            	if(!Ext.isEmpty(clsName)){
            		me.owner.cellCls = "x-panel-" + me.owner.getClsName(clsName);
            	}
            }*/
			//AHBG-16459
            //if (item.xtype == "ramcopanel" || item.xtype == "ramcofieldset" || item.xtype == "container") {
			//TECH-30098
			/* TECH-31449 - Applying Background For Filler */
			if (item.xtype == "container") {
				clsName = item.getCustomCls();
                if (!Ext.isEmpty(clsName)) {
                    item.cellCls = "x-panel-" + item.getClsName(clsName);
                }
			}
			/* TECH-31449 - Applying Background For Filler */
			
			else if (item.xtype == "ramcopanel" || item.xtype == "ramcofieldset" || item.xtype == "ramcogrid" || item.xtype == "ramcotreegrid" || 
						item.xtype == "ramcopivot" || item.xtype == "ramcorstreegrid" || item.xtype == "ramcorstreepanel" || item.xtype == "ramcotreepanel" ) {
                if(item.xtype == "ramcopanel"){
	                clsName = item.getCustomCls();
	                if (!Ext.isEmpty(clsName)) {
	                    item.cellCls = "x-panel-" + item.getClsName(clsName);
	                }
				}
				item.cellCls  = (item.cellCls?item.cellCls:" ")+ " x-panel-align";
            }
			else{
				item.cellCls  = (item.cellCls?item.cellCls:" ")+ " x-control-align";
            }
			//TECH-33668
			// AHBG-31843
			if (RamcoRTC.settings.isExt2 == true && (cell.style["text-align"] == "right" || cell.style["text-align"] == "end"))
				cell.style["padding-right"] = "10px";
			// AHBG-31904
			if((Ext.browser.is.IE || Ext.browser.is.Edge) && cell.style && (cell.style["text-align"] == "start" || cell.style["text-align"] == "end")){
				var style,textAlign =  cell.style["text-align"];
				if(RamcoRTC.ldir == "rtl"){
					if(textAlign == "start")
						cell.style["text-align"] = "right";
					if(textAlign == "end")
						cell.style["text-align"] = "left";
				}
				else{
					if(textAlign == "start")
						cell.style["text-align"] = "left";
					if(textAlign == "end")
						cell.style["text-align"] = "right";
				}
			}
            cell = MergeRecursive(cell, {
                colSpan: item.colspan || 1,
                rowSpan: item.rowspan || 1,
                cls: me.cellCls + ' ' + (item.cellCls || '')
            });
			//TECH-33668
			if (Object.keys(cell.style).length == 0)
				delete cell.style;
	        me.configureItem(item);
            cell.cn = item.getRenderTree();
        }
        return result;
    }
});

Ext.define('Ext.layout.container.RamcoTable', {
    extend: 'Ext.layout.container.Table',
    alias: ['layout.ramcotable'],
    type: 'ramcotable',
    getLayoutItems: function() {
        var me = this,
            result = [],
            items = me.callParent();
        return items;
    },

    getHiddenItems: function() {
        return [];
    },
    renderChildren: function() {
        var me = this,
            items = me.getLayoutItems(),
            tbody = me.tbody.dom,
            rows = tbody.rows,
            len = items.length,
            hiddenItems = me.getHiddenItems(),
			cell,w,style,wd,
            cells, curCell, rowIdx, cellIdx, item, trEl, tdEl, divEl, i;

        // Calculate the correct cell structure for the current items
        cells = me.calculateCells(items);

        // Loop over each cell and compare to the current cells in the table, inserting/
        // removing/moving cells as needed, and making sure each item is rendered into
        // the correct cell.
        for (i = 0; i < len; i++) {
            curCell = cells[i];
			// TECH-35136
			if (!curCell)
				continue;
            rowIdx = curCell.rowIdx;
            cellIdx = curCell.cellIdx;
            item = items[i];

            // If no row present, create and insert one
            trEl = rows[rowIdx];
            if (!trEl) {
                trEl = tbody.insertRow(rowIdx);
                if (me.trAttrs) {
                    trEl.set(me.trAttrs);
                }
            }

            // If no cell present, create and insert one
            tdEl = Ext.get(trEl.cells[cellIdx] || trEl.insertCell(cellIdx));

            // Render or move the component into the cell
            if (!item.rendered) {
                me.renderItem(item, tdEl, 0);
            } else if (!me.isValidParent(item, tdEl, rowIdx, cellIdx, tbody)) {
                me.moveItem(item, tdEl, 0);
            }
			//TECH-33668
			/*
			
            // Set the cell properties
			cell ={};
            if (me.tdAttrs) {
                //tdEl.set(me.tdAttrs);
				Ext.apply(cell,me.tdAttrs);
            }
            if (item.tdAttrs) {
                //tdEl.set(item.tdAttrs);
				Ext.apply(cell,item.tdAttrs);
            }
            if (item.colspan > 1 && me.tdAttrs && (!item.tdAttrs || !item.tdAttrs.style || !item.tdAttrs.style.width)) {
                w = me.tdAttrs.style.width;
                    style = {
                        style: {
                            width: w
                        }
				};
                    wd = 0;
                if (w) {
                    w = w.toLowerCase();
                    if (w.indexOf("px") > -1) {
                        wd = parseInt(w.replace("px"), 10);
                        style.style.width = wd * parseInt(item.colspan, 10) + "px"
                    } else if (w.indexOf("%") > -1) {
                        wd = parseInt(w.replace("%"), 10);
                        style.style.width = wd * parseInt(item.colspan, 10) + "%"
                    }
                }
				Ext.apply(cell,style);
                //tdEl.set(style);
            }
			Ext.apply(cell,{
                colSpan: item.colspan || 1,
                rowSpan: item.rowspan || 1,
                cls: me.cellCls + ' ' + (item.hidden?"":(item.cellCls || ''))
            });
            tdEl.set(cell);
			*/

            // If at the end of a row, remove any extra cells
            if (!cells[i + 1] || cells[i + 1].rowIdx !== rowIdx) {
                cellIdx++;
                while (trEl.cells[cellIdx]) {
                    trEl.deleteCell(cellIdx);
                }
            }
        }

        // Delete any extra rows
        rowIdx++;
        while (tbody.rows[rowIdx]) {
            tbody.deleteRow(rowIdx);
        }

        // Check if we've removed any cells that contain a component, we need to move
        // them so they don't get cleaned up by the gc
        for (i = 0, len = hiddenItems.length; i < len; ++i) {
            me.ensureInDocument(hiddenItems[i].getEl());
        }
    },
    calculateCells: function(items) {
		//TECH-33668
        if(this.cells)
			return this.cells;
        var cells = [],
            rowIdx = 0,
            colIdx = 0,
            cellIdx = 0,
            totalCols = this.columns || Infinity,
            rowspans = [], //rolling list of active rowspans for each column
            len = items.length,
            item, i, j;

        for (i = 0; i < len; i++) {
            item = items[i];

            // Find the first available row/col slot not taken up by a spanning cell
            while (colIdx >= totalCols || rowspans[colIdx] > 0) {
                if (colIdx >= totalCols) {
                    // move down to next row
                    colIdx = 0;
                    cellIdx = 0;
                    rowIdx++;

                    // decrement all rowspans
                    for (j = 0; j < totalCols; j++) {
                        if (rowspans[j] > 0) {
                            rowspans[j]--;
                        }
                    }
                } else {
                    colIdx++;
                }
            }

            // Add the cell info to the list
            cells.push({
                rowIdx: rowIdx,
                cellIdx: cellIdx
            });

            // Increment
            for (j = item.colspan || 1; j; --j) {
                rowspans[colIdx] = item.rowspan || 1;
                ++colIdx;
            }
            ++cellIdx;
        }
		//TECH-33668
		this.cells = cells;

        return cells;
    },

    getRenderTree: function() {
        var me = this,
            items = me.getLayoutItems(),
            rows = [],
            role,
            labelAlign = '',
            cls,
			columnsWidth = me.columnsWidth || "",
            result = Ext.apply({
                tag: 'table',
                per: me.owner.xtype || '',
                "data-cls": me.owner.ui || '',
                ctrlid: me.owner.itemId + '-table',
                id: me.owner.id + '-table',
                "data-ref": 'table',
                role: 'presentation',
                cls: me.tableCls,
                cellspacing: 0,
                cellpadding: 0
            }, me.tableAttrs),
            //tdAttrs = me.tdAttrs,//TECH-33668
            i, len = items.length,
            item, curCell, tr, rowIdx, cellIdx, cell, cells,
            clsName,
			totalCols = this.columns,
			theadCells= [],
			thStyle,
			ilbo = me.owner.up('ilbo'),
			isSmartHide = false;
		if (ilbo && ilbo.xtype == 'ilbo' && !Ext.isEmpty(ilbo.smartHide) && (me.owner.xtype == 'ramcopanel' || me.owner.xtype == "ramcofieldset" || me.owner.xtype == "container") && me.owner.bodyCls != 'x-bodyinnercontrols')
			isSmartHide = ilbo.smartHide;

		if(!Ext.isEmpty(columnsWidth)) {
			var columnsWidthArr = columnsWidth.split("|");
			len = columnsWidthArr.length;
			
			for (i = 0; i < len; i++) {
				thStyle = {};
				thStyle.width =  columnsWidthArr[i];
				if (isSmartHide)
					thStyle.display = 'none';
				
				theadCells.push({
					tag: 'th',
					style:thStyle
				})
			}
			result.cn=[{
				tag: 'thead',
				id: me.owner.id + '-thead',
				"data-ref": 'thead',
				role: 'presentation',
				cn: [{
					tag: 'tr',
					cn: theadCells
				}]
			},
			{
				tag: 'tbody',
				id: me.owner.id + '-tbody',
				"data-ref": 'tbody',
				role: 'presentation',
				cn: rows
			}]
        }
		else if(totalCols > 0) {
			len = totalCols;
			for (i = 0; i < len; i++) {
				thStyle = {};
				if (isSmartHide)
					thStyle.display = 'none';
				
				theadCells.push({
					tag: 'th',
					style:thStyle
				})
			}
			result.cn=[{
				tag: 'thead',
				id: me.owner.id + '-thead',
				"data-ref": 'thead',
				role: 'presentation',
				cn: [{
					tag: 'tr',
					cn: theadCells
				}]
			},
			{
				tag: 'tbody',
				id: me.owner.id + '-tbody',
				"data-ref": 'tbody',
				role: 'presentation',
				cn: rows
			}]
		}
		else{
			result.cn = {
				tag: 'tbody',
				id: me.owner.id + '-tbody',
				"data-ref": 'tbody',
				role: 'presentation',
				cn: rows
			}
		}
		
		i=0;
		len = items.length;

        // Calculate the correct cell structure for the current items
        cells = me.calculateCells(items);

        for (i = 0; i < len; i++) {
            item = items[i];

            curCell = cells[i];
			// TECH-35136
			if (!curCell)
				continue;
            rowIdx = curCell.rowIdx;
            cellIdx = curCell.cellIdx;

            // If no row present, create and insert one
            tr = rows[rowIdx];
            if (!tr) {
                tr = rows[rowIdx] = {
                    tag: 'tr',
                    role: 'presentation',
                    cn: []
                };
                if (me.trAttrs) {
                    Ext.apply(tr, me.trAttrs);
                }
            }
            cell = tr.cn[cellIdx] = {
                tag: 'td',
                role: 'presentation',
                'data-bd': item.border ? 'border' : 'noborder',
                'data-tp': (item.xtype == "ramcopanel" || item.xtype == "ramcofieldset") ? 'top' : '',
                'data-id': item.itemId,
				style:{},
                cn: []
            };
            if (me.tdAttrs) {
                //tdEl.set(me.tdAttrs);//TECH-33668
				cell = MergeRecursive(cell,me.tdAttrs);
            }
            if (item.tdAttrs) {
                //tdEl.set(item.tdAttrs);//TECH-33668
				cell = MergeRecursive(cell,item.tdAttrs);
            }
            //if (item.colspan > 1 && me.tdAttrs && (!item.tdAttrs || !item.tdAttrs.style || !item.tdAttrs.style.width)) {
			//TECH-33668
			if (item.colspan > 1 && cell.style) {
                    var w = cell.style.width,
                        style = {
                            style: {
                                width: w
                            }
                        },
                        wd = 0;
                    if (w) {
                        w = w.toLowerCase();
                        if (w.indexOf("px") > -1) {
                            wd = parseInt(w.replace("px"), 10);
                            style.style.width = wd * parseInt(item.colspan, 10) + "px"
                        } else if (w.indexOf("%") > -1) {
                            wd = parseInt(w.replace("%"), 10);
                            style.style.width = wd * parseInt(item.colspan, 10) + "%"
                        }
				     }
					cell = MergeRecursive(cell, style);
            }
            /*if(me.owner.xtype=="ramcopanel" || me.owner.xtype=="ramcofieldset"){
            	clsName = me.owner.getCustomCls();
            	if(!Ext.isEmpty(clsName)){
            		item.cellCls = "x-panel-" + me.owner.getClsName(clsName);
            	}
            }*/
			//AHBG-16459
            //if (item.xtype == "ramcopanel" || item.xtype == "ramcofieldset" || item.xtype == "container") {
			//TECH-30098
			/* TECH-31449 - Applying Background For Filler */
			if (item.xtype == "container") {
				clsName = item.getCustomCls();
                if (!Ext.isEmpty(clsName)) {
                    item.cellCls = "x-panel-" + item.getClsName(clsName);
                }
			}
			/* TECH-31449 - Applying Background For Filler */
			
			else if (item.xtype == "ramcopanel" || item.xtype == "ramcofieldset" || item.xtype == "ramcogrid" || item.xtype == "ramcotreegrid" 
						|| item.xtype == "ramcopivot" || item.xtype == "ramcorstreegrid" || item.xtype == "ramcorstreepanel" || item.xtype == "ramcotreepanel" ) {
                if(item.xtype == "ramcopanel"){
	                clsName = item.getCustomCls();
	                if (!Ext.isEmpty(clsName)) {
	                    item.cellCls = "x-panel-" + item.getClsName(clsName);
	                }
				}
				item.cellCls  = (item.cellCls?item.cellCls:" ")+ " x-panel-align";
            }
			else{
				item.cellCls  = (item.cellCls?item.cellCls:" ")+ " x-control-align";
            }
			//TECH-33668
			// AHBG-31843
			if (RamcoRTC.settings.isExt2 == true && (cell.style["text-align"] == "right" || cell.style["text-align"] == "end"))
				cell.style["padding-right"] = "10px";
			// AHBG-31904
			if((Ext.browser.is.IE || Ext.browser.is.Edge) && cell.style && (cell.style["text-align"] == "start" || cell.style["text-align"] == "end")){
				var textAlign =  cell.style["text-align"];
				if(RamcoRTC.ldir == "rtl"){
					if(textAlign == "start")
						cell.style["text-align"] = "right";
					if(textAlign == "end")
						cell.style["text-align"] = "left";
				}
				else{
					if(textAlign == "start")
						cell.style["text-align"] = "left";
					if(textAlign == "end")
						cell.style["text-align"] = "right";
				}
			}
            cell = MergeRecursive(cell, {
                colSpan: item.colspan || 1,
                rowSpan: item.rowspan || 1,
                cls: me.cellCls + ' ' + (item.cellCls || '')
            });
			//TECH-33668
			if (Object.keys(cell.style).length == 0)
				delete cell.style;
            me.configureItem(item);
            cell.cn = item.getRenderTree();
        }
        return result;
    }
});


// Component Overriding for Custom Class
Ext.define('Ext.o.Component', {
    override: 'Ext.Component',
    config: {
        customCls: null
    },
    initEvents: function() {
        var me = this,
			itemId;
        me.callParent();
        if (me.el) {
            var xtype = me.getXType();
            if (xtype) {
                xtype = xtype.replace(Ext.Component.INVALID_ID_CHARS_Re, '-');
            } else {
                xtype = Ext.name.toLowerCase() + '-comp';
            }
			if(xtype == "tab")
				itemId = me.initialConfig.card.itemId;
			else{
				itemId = me.initialConfig.itemId;
			}
            me.el.set({
				'data-id': itemId,
				'name': itemId + "_" + xtype
            });
        }
    },
    updateCustomCls: function(newCls, oldCls) {
        var me = this,
            oldClsArr = me.getClsName(oldCls),
            newClsArr = me.getClsName(newCls);
        if (this.cls && oldClsArr.length > 0) {
            me.cls = me.cls.replace(oldClsArr[0], '');
        } else {
            me.cls = '';
        }
        if (me.xtype == 'ramcolabel') {
            me.cstCls = newClsArr[0];
        } else {
            if (newClsArr.length > 0)
                me.cls += newClsArr[0];
        }
        if (me.isButton) {
            if (me.iconCls && oldClsArr.length > 1) {
                me.iconCls = me.iconCls.replace(oldClsArr[1], '');
            }
            if (newClsArr.length > 1) {
                me.iconCls += ' ' + newClsArr[1];
            }
            if (Ext.isEmpty(newClsArr[0])) {
                me.setUI("plain");
            }
            var lIndex = newCls.length - 5;
            if (newCls.lastIndexOf('right') == lIndex) {
                me.setIconAlign("right");
            }
        }
    },
    getClsName: function(clsText) {
        if (Ext.isEmpty(clsText))
            return [];
        var me = this,
            baseCls = ' ' + me.baseCls,
            clsTextLCase = clsText.toLowerCase();
        _tmp = [],
            ret = [];
        clsTextLCase = clsTextLCase.replace("lnk_btn_", "");
        _tmp = clsTextLCase.split("_");
        if (_tmp && _tmp.length > 0 && _tmp[_tmp.length - 1] == "right") {
            clsTextLCase = clsTextLCase.replace("_right", "");
        }
        switch (clsTextLCase) {
            case "icon":
                if (me.$initParent && me.$initParent.xtype != 'segmentedbutton') {
                    me.ui = "plain";
                } else {
                    me.$initParent.addCls("icons");
                }
                break;
			case "positive":
				ret.push(baseCls + '-green ');
                ret.push(baseCls + '-icon-green ');
                break;
			case "negative":
				ret.push(baseCls + '-red ');
                ret.push(baseCls + '-icon-red ');
                break;
			case "neutral":
				ret.push(baseCls + '-gray ');
                ret.push(baseCls + '-icon-gray ');
            case "greenicon":
                ret.push(baseCls + '-plain ');
                ret.push(baseCls + '-icon-green ');
                break;
            case "greenicontext":
                ret.push(baseCls + '-green ');
                ret.push(baseCls + '-icon-green ');
                break;
            case "green":
            case "greentext":
                ret.push(baseCls + '-green ');
                break;
            case "grayicon":
                ret.push(baseCls + '-plain ');
                ret.push(baseCls + '-icon-gray ');
                break;
            case "grayicontext":
                ret.push(baseCls + '-gray ');
                ret.push(baseCls + '-icon-gray ');
                break;
            case "gray":
            case "graytext":
                ret.push(baseCls + '-gray ');
                break;
            case "redicon":
                ret.push(baseCls + '-plain ');
                ret.push(baseCls + '-icon-red ');
                break;
            case "redicontext":
                ret.push(baseCls + '-red ');
                ret.push(baseCls + '-icon-red ');
                break;
            case "red":
            case "redtext":
                ret.push(baseCls + '-red ');
                break;
            case "blueicon":
                ret.push(baseCls + '-plain');
                ret.push(baseCls + '-icon-blue ');
                break;
            case "blueicontext":
                ret.push(baseCls + '-blue ');
                ret.push(baseCls + '-icon-blue ');
                break;
            case "blue":
            case "bluetext":
                ret.push(baseCls + '-blue ');
                break;
            case "blackicon":
                ret.push(baseCls + '-plain ');
                ret.push(baseCls + '-icon-black ');
                break;
            case "blackicontext":
                ret.push(baseCls + '-black ');
                ret.push(baseCls + '-icon-black ');
                break;
            case "black":
            case "blacktext":
                ret.push(baseCls + '-black ');
                break;
            case "orangeicon":
                ret.push(baseCls + '-plain ');
                ret.push(baseCls + '-icon-orange ');
                break;
            case "orangeicontext":
                ret.push(baseCls + '-orange ');
                ret.push(baseCls + '-icon-orange ');
                break;
            case "orange":
            case "orangetext":
                ret.push(baseCls + '-orange ');
                break;
            case "plainicon":
                ret.push(baseCls + '-plain ');
                ret.push(baseCls + '-icon-plain ');
                break;
            case "plainicontext":
                ret.push(baseCls + '-plain ');
                ret.push(baseCls + '-icon-plain ');
                break;
            case "plain":
            case "plaintext":
                ret.push(baseCls + '-plain ');
                break;
            default:
                if (clsTextLCase.substr(0, 4) == "lnk_")
                    ret.push(baseCls + '-' + clsText);
                else
                    ret.push(baseCls + '-' + clsText);
                break;
        }
        return ret;
    },
	getId: function() {
        var me = this,
            xtype,
			itemId;

        // If we have no id, attempt to gather it from our configuration.
        // Autogenerate it if none was configured.
        if (!(me.id || (me.id = me.initialConfig.id))) {
            xtype = me.getXType();
            if (xtype) {
                xtype = xtype.replace(Ext.Component.INVALID_ID_CHARS_Re, '-');
            } else {
                xtype = Ext.name.toLowerCase() + '-comp';
            }
			if(xtype == "tab")
				itemId = me.initialConfig.card.itemId;
			else{
				itemId = me.initialConfig.itemId;
			}
			if(itemId)
				me.id = itemId + "-" + xtype + '-' + me.getAutoId();
			else
				me.id = xtype + '-' + me.getAutoId();
        }
        return me.id;
    }
});

// Panel Overriding for Custom Class
Ext.define('Ext.o.button.Segmented', {
    override: 'Ext.button.Segmented',
    applyValue: function(value, oldValue) {
        if (Ext.isEmpty(value))
            return value;
        else if (Ext.isString(value))
            value = value.toLowerCase();
        else
			return value;
        var me = this,
            allowMultiple = me.getAllowMultiple(),
            buttonValue, button, values, oldValues, items, i, ln, hasPressed;

        values = (value instanceof Array) ? value : (value == null) ? [] : [value];
        oldValues = (oldValue instanceof Array) ? oldValue :
            (oldValue == null) ? [] : [oldValue];

        // Set a flag to tell our toggle listener not to respond to the buttons' toggle
        // events while we are applying the value.
        me._isApplyingValue = true;

        if (!me.rendered) {
            // first time - add values of buttons with an initial config of pressed:true
            items = me.items.items;
            for (i = items.length - 1; i >= 0; i--) {
                button = items[i];

                // If we've got back to zero with no pressed buttons and have forceSelection,
                // then make button zero pressed.
                if (me.forceSelection && !i && !hasPressed) {
                    button.pressed = true;
                }
                if (button.pressed) {
                    hasPressed = true;
                    buttonValue = button.value;
                    if (buttonValue == null) {
                        buttonValue = me.items.indexOf(button);
                    }

                    // We're looping backwards, unshift the values into the front of the array
                    if (!Ext.Array.contains(values, buttonValue)) {
                        values.unshift(buttonValue);
                    }
                }
            }
        }

        ln = values.length;

        //<debug>
        if (ln > 1 && !allowMultiple) {
            Ext.raise('Cannot set multiple values when allowMultiple is false');
        }
        //</debug>

        // press all buttons corresponding to the values
		try {
			for (i = 0; i < ln; i++) {
				value = values[i];
				button = me._lookupButtonByValue(value);
				if (button) {
					buttonValue = button.value;
					if ((buttonValue != null) && buttonValue !== value) {
						values[i] = buttonValue;
					}
					if (!button.pressed) {
						button.setPressed(true);
					}
				}
			}
		}
		catch(ex) {
			Ext.raise("Invalid value '" + value + "' for segmented button: '" + me.id + "'");
			return;
		}

        value = allowMultiple ? values : ln ? values[0] : null;

        // unpress buttons for the old values, if they do not exist in the new values array
        for (i = 0, ln = oldValues.length; i < ln; i++) {
            oldValue = oldValues[i];
            if (!Ext.Array.contains(values, oldValue)) {
                if (me._lookupButtonByValue(oldValue))
                    me._lookupButtonByValue(oldValue).setPressed(false);
            }
        }

        me._isApplyingValue = false;

        if (me.hasListeners.change && !Ext.Array.equals(values, oldValues)) {
            me.fireEvent('change', me, values, oldValues);
        }
        return value;
    }
});

//SearchGrid Panel
Ext.define('Ext.ramco.RSListViewSearchGrid', {
    extend: 'Ext.grid.Panel',
    requires: [
        'Ext.toolbar.TextItem',
        'Ext.form.field.Checkbox',
        'Ext.form.field.Text',
        'Ext.ux.statusbar.StatusBar'
    ],
	alias: 'widget.ramcosearchgrid',    
    searchValue: null,
    matches: [],
    currentIndex: null,
    searchRegExp: null,
    caseSensitive: false,
    regExpMode: false,
    matchCls: 'x-livesearch-match',    
    defaultStatusText: rvw_resources.R313,
    initComponent: function() {
        var me = this;		
        /*me.tbar = ['Search',{
             xtype: 'textfield',
             name: 'searchField',
             hideLabel: true,
             width: 100,
             listeners: {
                 change: {
                     fn: me.onTextFieldChange,
                     scope: this,
                     buffer: 500
                 }
             }
        }];*/       
		me.dockedItems = [
			{
				xtype: 'toolbar',
				dock: 'top',
				items: [				
					{
						xtype: 'label',
						itemId: 'lblGrSearch',						
						value:'Search'
					},
					{
						xtype: 'textfield',
						name: 'searchField',
						hideLabel: true,
						width: 150,
						emptyText: rvw_resources.R196,
						triggers: {
							clear: {
								cls: 'x-form-clear-trigger',
								handler: function () {
									var gridCtrl = this.ownerCt.ownerCt;
									this.setValue('');									
								}
							}
						},
						listeners: {
							change: {
								fn: me.onTextFieldChange,
								scope: this,
								buffer: 500
							}
						}
					}
				]
			}
		];
		me.bbar = new Ext.ux.StatusBar({
            defaultText: me.defaultStatusText,
            name: 'searchStatusBar'
        });
        me.callParent(arguments);
    },   
    // afterRender override: it adds textfield and statusbar reference and start monitoring keydown events in textfield input
    afterRender: function() {
        var me = this;
        me.callParent(arguments);
        me.textField = me.down('textfield[name=searchField]');
        me.statusBar = me.down('statusbar[name=searchStatusBar]'); 
        me.view.on('cellkeydown', me.focusTextField, me);
    },
    focusTextField: function(view, td, cellIndex, record, tr, rowIndex, e, eOpts) {
        if (e.getKey() === e.S) {
            e.preventDefault();
            this.textField.focus();
        }
    }, 
    // detects html tag
    tagsRe: /<[^>]*>/gm,
    // DEL ASCII code 
    tagsProtect: '\x0f',
    getSearchValue: function() {
        var me = this,
			test,
            value = me.textField.getValue();
            
        if (value === '') {
            return null;
        }
        if (!me.regExpMode) {
            value = Ext.String.escapeRegex(value);
        } 
		else {
            try {
               test = new RegExp(value);
            } 
			catch (error) {
                me.statusBar.setStatus({
                    text: error.message,
                    iconCls: 'x-status-error'
                });
                return null;
            }
            // this is stupid 
            if (value === '^' || value === '$') {
                return null;
            }
        }
        return value;
    },
    onTextFieldChange: function() {
         var me = this,
             count = 0,
             view = me.view,
             cellSelector = view.cellSelector,
             innerSelector = view.innerSelector,
             columns = me.visibleColumnManager.getColumns();
			 
         // reset the statusbar 
         me.statusBar.setStatus({
             text: me.defaultStatusText,
             iconCls: ''
         });
 
         me.searchValue = me.getSearchValue() || "";
         me.matches = [];
         me.currentIndex = null;
 
         if (me.searchValue !== null) {
             me.pickerField.clearLocalFilter();
			 me.view.refresh();
			 count = me.store.getCount();			 
             if (count) {
				for (var gc=0; gc< columns.length; gc++) {
					var searchColumn = columns[gc].dataIndex;
					if (me.searchValue !== null) {
						me.pickerField.changingFilters = true;
						var filter = me.pickerField.queryFilter = new Ext.util.Filter({
							id: me.id + '-filter',
							anyMatch: false,
							caseSensitive: me.caseSensitive,
							root: 'data',
							property: searchColumn,
							value: me.searchValue
						});
						me.store.addFilter(filter, true);					
						me.pickerField.changingFilters = false;
						me.view.refresh();
						count = me.store.getCount();
						if (count > 0)
							break;
					}
				}
				me.currentIndex = 0;
				count = (me.searchValue == "") ? 0 : count;
				me.statusBar.setStatus({
					text: Ext.String.format(rvw_resources.R312, count, count === 1 ? 'es' : ''),
					iconCls: 'x-status-valid'
				});
			 }
         }
		 me.updateLayout();
    }
});

// Panel Overriding for Custom Class
Ext.define('Ext.o.panel.Panel', {
    override: 'Ext.panel.Panel',
    animCollapse: false,
    config: {
        customCls: null
    },
    /*
    initComponent: function() {
        var me = this;
        if (me.border && (!me.header || me.title)) {
            me.userCls = Ext.baseCSSPrefix + 'panel-border';
        }
        me.callParent(arguments);
    },
	*/
	close: function() {
        if (this.fireEvent("beforeclose", this) !== false) {
            this.doClose.apply(this, arguments);
        }
    },	
    updateCustomCls: function(newCls, oldCls) {
        var me = this,
            newClsArr = me.getClsName(newCls);
        if (newClsArr)
            me.ui = newClsArr;
        //me.setUI(newClsArr);
    },
    getClsName: function(clsText) {
        if (Ext.isEmpty(clsText))
            return null;
        var me = this,
            ret = '';
        clsText = clsText.toLowerCase();
        switch (clsText) {
            case "green":
            case "greenpanel":
            case "greenpanel-border":
                ret = 'green';
                break;
            case "greenpanel-nc":
                ret = 'green-nc';
                break;
            case "gray":
            case "graypanel":
            case "graypanel-border":
                ret = 'gray';
                break;
            case "graypanel-nc":
                ret = 'gray-nc';
                break;
            case "blue":
            case "bluepanel":
            case "bluepanel-border":
                ret = 'blue';
                break;
            case "bluepanel-nc":
                ret = 'blue-nc';
                break;
            case "orange":
            case "orangepanel":
            case "orangepanel-border":
                ret = 'orange';
                break;
            case "orangepanel-nc":
                ret = 'orange-nc';
                break;
            case "redpanel":
            case "redpanel-border":
                ret = 'red';
                break;
            case "redpanel-nc":
                ret = 'red-nc';
                break;
            default:
                ret = "default " + clsText;
        }
        return ret;
    }
});
// Container Overriding for Custom Class
Ext.define('Ext.o.container.Container', {
    override: 'Ext.container.Container',
    config: {
        customCls: null
    },
    updateCustomCls: function(newCls, oldCls) {
        var me = this,
            newClsArr = me.getClsName(newCls);
        if (newClsArr)
            me.ui = newClsArr;
    },
    getClsName: function(clsText) {
        if (Ext.isEmpty(clsText))
            return null;
        var me = this,
            ret = '';
        clsText = clsText.toLowerCase();
        switch (clsText) {
            case "green":
            case "greenpanel":
            case "greenpanel-border":
                ret = 'green';
                break;
            case "greenpanel-nc":
                ret = 'green-nc';
                break;
            case "gray":
            case "graypanel":
            case "graypanel-border":
                ret = 'gray';
                break;
            case "graypanel-nc":
                ret = 'gray-nc';
                break;
            case "blue":
            case "bluepanel":
            case "bluepanel-border":
                ret = 'blue';
                break;
            case "bluepanel-nc":
                ret = 'blue-nc';
                break;
            case "orange":
            case "orangepanel":
            case "orangepanel-border":
                ret = 'orange';
                break;
            case "orangepanel-nc":
                ret = 'orange-nc';
                break;
            case "redpanel":
            case "redpanel-border":
                ret = 'red';
                break;
            case "redpanel-nc":
                ret = 'red-nc';
                break;
            default:
                ret = "default " + clsText;
        }
        return ret;
    }
});

// FieldSet Override
Ext.define('Ext.o.form.FieldSet', {
    override: 'Ext.form.FieldSet',
    config: {
        customCls: null
    },
    renderTpl: [
        '{%this.renderLegend(out,values);%}',
        '<div id="{id}-body" data-ref="body" class="{baseCls}-body {baseCls}-body-{ui} {bodyTargetCls} {bodyCls}" ',
        'role="presentation"<tpl if="bodyStyle"> style="{bodyStyle}"</tpl>>',
        '{%this.renderContainer(out,values);%}',
        '</div>'
    ],
    /*
    initComponent: function() {
        var me = this;
        if (me.border && (!me.header || me.title)) {
            me.userCls = Ext.baseCSSPrefix + 'fieldset-border';
        }
        me.callParent(arguments);
    },
	*/
    initRenderData: function() {
        var me = this,
            data = me.callParent();

        if (me.bodyCls)
            data.bodyCls = me.bodyCls;
        return data;
    },
    updateCustomCls: function(newCls, oldCls) {
        var me = this,
            newClsArr = me.getClsName(newCls);
        if (newClsArr)
            me.ui = newClsArr;
        //me.setUI(newClsArr);
    },
    getClsName: function(clsText) {
        if (Ext.isEmpty(clsText))
            return null;
        var me = this,
            ret = '';
        clsText = clsText.toLowerCase();
        switch (clsText) {
            case "green":
            case "greenpanel":
            case "greenpanel-border":
                ret = 'green';
                break;
            case "greenpanel-nc":
                ret = 'green-nc';
                break;
            case "gray":
            case "graypanel":
            case "graypanel-border":
                ret = 'gray';
                break;
            case "graypanel-nc":
                ret = 'gray-nc';
                break;
            case "blue":
            case "bluepanel":
            case "bluepanel-border":
                ret = 'blue';
                break;
            case "bluepanel-nc":
                ret = 'blue-nc';
                break;
            case "orange":
            case "orangepanel":
            case "orangepanel-border":
                ret = 'orange';
                break;
            case "orangepanel-nc":
                ret = 'orange-nc';
                break;
            case "redpanel":
            case "redpanel-border":
                ret = 'red';
                break;
            case "redpanel-nc":
                ret = 'red-nc';
                break;
            default:
                ret = "default " + clsText;
        }
        return ret;
    },
    afterRender: function() {
        var me = this,
            el = me.el,
            pEL = el ? el.parent() : null;
        if (el && pEL) {
            var pH = pEL.getHeight(),
                cH = me.getHeight();
            if (cH != pH)
                me.setHeight(pH);
        }
        me.callParent();
    }
});

Ext.define('Ext.ramco.Split', {
	extend: 'Ext.button.Split',
    alias: 'widget.ramcosplitbutton',
	defaultBindProperty: 'value',	
	config: {
        value: null,
		store: null
    },	
    initComponent: function() {
        var me = this;        
        me.callParent(arguments);
		//TECH-36007
		me.setText(me.caption || "");
    },	
	updateStore: function(store) {
        var me = this,
			menuItems,
			menuObj,
			menuArray = [],
			curMenuItem ,
			menuItemLen;
		if (store && store.length > 0) {
			menuItems = store;
			menuItemLen = menuItems.length;
			for (var m=0; m < menuItemLen; m++) {
				curMenuItem = menuItems[m];
				menuObj = {};
				menuObj.text = curMenuItem.text;
				menuObj.checked = false;
				menuObj.group = me.itemId;
				menuObj.handler = function(){ me.menuItemClick(arguments); };
				menuArray.push(menuObj);
			}
			me.menuItems = menuArray;            
            me.split = true;
            me.setMenu(me.menuItems, false, true);
        }        
    },
	updateValue: function(newValue, oldValue) {
		var me = this,
			menuItems,
			menuObj,
			menuArray = [],
			curMenuItem,
			menuItemLen;
			
		if (me.menuItems) {
			menuItems = me.menuItems;
			menuItemLen = menuItems.length;
			for (var m=0; m < menuItemLen; m++) {
				curMenuItem = menuItems[m];								
				curMenuItem.checked = (newValue == curMenuItem.text) ? true : false;				
			}
			me.setMenu(me.menuItems, false, true);
        }
		
		if (me.dataAsCaption == true) {
			me.setText(newValue);			
		}
	},	
	menuItemClick: function(args) {
		var me = this,
			menuItem = args[0],
			eOpts = args[1];	
		me.setValue(menuItem.text);
		me.publishValue();
		if (me.uiTask) {
			me.fireEvent('click', me, menuItem);
		}
	},
	publishValue: function () {
        var me = this; 
        if (me.rendered) {
            me.publishState('value', me.getValue());
        }
    }
});

// button
Ext.define('Ext.o.button.Button', {
    override: 'Ext.button.Button',
    afterRender: function() {
        this.callParent();
        var me = this,
            customCls = me.getCustomCls();
        if (customCls && !me.isEndsWith(customCls, 'texticon') && me.isEndsWith(customCls, 'icon')) {
            me.btnEl.addCls(me._noTextCls);
            me.btnInnerEl.hide();
        }
    },
    isEndsWith: function(givenStr, subst) {
        var ln = givenStr.length;
        var idx = ln - subst.length;
        return ((givenStr.substr(idx)).toLowerCase() == subst);
    }
});
Ext.define('Ext.o.resizer.BorderSplitterTracker', {//TECH-28171
	override: 'Ext.resizer.BorderSplitterTracker',
    performResize: function(j, i) {
        var d = this, b = d.splitter, e = b.getCollapseDirection(), h = b.collapseTarget, f = d.splitAdjusters[b.vertical ? 'horz' : 'vert'], a = i[f.index], c = d.dragInfo, g;
        if (e === 'right' || e === 'bottom') {
            a = -a
        }
        a = Math.min(Math.max(c.minRange, a), c.maxRange);
        if (a) {
            (g = b.ownerCt).suspendLayouts();
            f.adjustTarget(h, c.targetSize, a);
            g.resumeLayouts(!0);
			g.updateLayout();
        }
		
    }
});
// Ramco Panel 
Ext.define('Ext.ramco.Panel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.ramcopanel',
    cls: Ext.baseCSSPrefix + 'ramcopanel',
	hideMode:'offsets',
    animCollapse: false,
	titleCollapse:true,	
	//titlePosition: 0,
    config: {
        customCls: null
    },
	/*initEvents: function() {
        var me = this;
        me.callParent();
		if (me.header) {
			me.mon(me.header, {
				scope: me,				
				click: me.onPanelHeaderClick,				
			});		
		}
    },*/
    
    initComponent: function() {
        var me = this;
        /*if (me.border && (!me.header || me.title)) {
            me.userCls = Ext.baseCSSPrefix + 'panel-border';
        }*/
		me.titlePosition = (RamcoRTC.settings.isExt2 == true) ? 2 : 0;
		delete me.maxHeight;
        me.callParent(arguments);
    },
	
    updateCustomCls: function(newCls, oldCls) {
        var me = this,
            newClsArr = me.getClsName(newCls);
        if (newClsArr){
			me.userCls = (me.userCls?me.userCls:"") + " "+ newClsArr;
		}
        //me.setUI(newClsArr);
    },
    getClsName: function(clsText) {
        if (Ext.isEmpty(clsText))
            return null;
        var me = this,
            ret = '';
        switch (clsText) {
            case "green":
            case "greenpanel":
            case "greenpanel-border":
                ret = 'green';
                break;
            case "greenpanel-nc":
                ret = 'green-nc';
                break;
            case "gray":
            case "graypanel":
            case "graypanel-border":
                ret = 'gray';
                break;
            case "graypanel-nc":
                ret = 'gray-nc';
                break;
            case "blue":
            case "bluepanel":
            case "bluepanel-border":
                ret = 'blue';
                break;
            case "bluepanel-nc":
                ret = 'blue-nc';
                break;
            case "orange":
            case "orangepanel":
            case "orangepanel-border":
                ret = 'orange';
                break;
            case "orangepanel-nc":
                ret = 'orange-nc';
                break;
            case "redpanel":
            case "redpanel-border":
                ret = 'red';
                break;
            case "redpanel-nc":
                ret = 'red-nc';
                break;
            default:
                ret = "default " + clsText;
        }
        return ret;
    }
	/*onPanelHeaderClick: function(panel) {
		var me = this;
		if (me.collapsed) {
			me.expand();
		}
		else {
			me.collapse();
		}
	}*/
});

//TECH-31067
Ext.define('Ext.Ramco.Iframe', {
    extend: 'Ext.ux.IFrame',
    alias: 'widget.ramcoiframe',
    setValue: function(value) {
        var me = this;
        if (!Ext.isEmpty(value) && me.checkValidURL(value)) {
            me.load(value);
        }
    },
    checkValidURL: function(url) {
		// TECH-33025
		if (url && url.indexOf('../') == 0)
			return true;
        var regexp = /(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
        return regexp.test(url);
    }
}); 

Ext.define('Ext.Ramco.BlankPageCmp', {
    extend: 'Ext.ux.IFrame',
    alias: 'widget.ramcoblankpagecmp',
	// TECH-39603
	mixins: [
        'Ext.mixin.Queryable'
    ],
	//src: '../hub/ilrt/rvw_blank.aspx',
	src: 'about:blank',
	hasModified: function() {
		return false;
	},
	// TECH-39603
	setSessionData: Ext.emptyFn
});
// Ramco Video

Ext.define('Ext.Ramco.Video', {
    extend: 'Ext.ux.IFrame',
    alias: 'widget.ramcovideo',
    configData: '',
    fallbackData: '',
    initComponent: function() {
        var me = this;
        me.callParent();
    },
    setFallbackData: function(data) {
        var me = this;
        me.fallBackData = data;
    },
    setConfigData: function(data) {
        var me = this;
        me.configData = data;
    },
    setValueData: function(data) {
        var me = this;
        me.valueData = data;
        me.setValue(me.valueData);
    },
    setValue: function(value) {
        var me = this;
        if (!Ext.isEmpty(value) && me.checkValidURL(value)) {
            me.load(value);
        } else {
            var elem = me.el.dom;
            elem.innerHTML = (me.fallBackData) ? me.fallBackData : 'Invalid Data';
            elem.style.textAlign = 'center';
            me.fallBackData = null;
        }
    },
    checkValidURL: function(url) {
        var regexp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
        return regexp.test(url);
    }
});
// Ramco FieldSet 
Ext.define('Ext.ramco.FieldSet', {
    extend: 'Ext.form.FieldSet',
    alias: 'widget.ramcofieldset',

    config: {
        customCls: null
    },
    /*
    initComponent: function() {
        var me = this;
        if (me.border && (!me.header || me.title)) {
            me.userCls = Ext.baseCSSPrefix + 'fieldset-border';
        }
        me.callParent(arguments);
    },
	*/
    initRenderData: function() {
        var me = this,
            data = me.callParent();

        if (me.bodyCls)
            data.bodyCls = me.bodyCls;
        return data;
    },
    updateCustomCls: function(newCls, oldCls) {
        var me = this,
            newClsArr = me.getClsName(newCls);
        if (newClsArr)
            me.ui = newClsArr;
        //me.setUI(newClsArr);
    },
    getClsName: function(clsText) {
        if (Ext.isEmpty(clsText))
            return null;
        var me = this,
            ret = '';
        clsText = clsText.toLowerCase();
        switch (clsText) {
            case "green":
            case "greenpanel":
            case "greenpanel-border":
                ret = 'green';
                break;
            case "greenpanel-nc":
                ret = 'green-nc';
                break;
            case "gray":
            case "graypanel":
            case "graypanel-border":
                ret = 'gray';
                break;
            case "graypanel-nc":
                ret = 'gray-nc';
                break;
            case "blue":
            case "bluepanel":
            case "bluepanel-border":
                ret = 'blue';
                break;
            case "bluepanel-nc":
                ret = 'blue-nc';
                break;
            case "orange":
            case "orangepanel":
            case "orangepanel-border":
                ret = 'orange';
                break;
            case "orangepanel-nc":
                ret = 'orange-nc';
                break;
            case "redpanel":
            case "redpanel-border":
                ret = 'red';
                break;
            case "redpanel-nc":
                ret = 'red-nc';
                break;
            default:
                ret = "default " + clsText;
        }
        return ret;
    }
});

// Text Field
Ext.define('Ext.o.form.Label', {
    extend: 'Ext.form.Label',
    mandatoryCls: Ext.baseCSSPrefix + 'mandatory',
    config: {
        mandatory: false
    },
    updateMandatory: function(newValue, oldValue) {
        var me = this;
        if (newValue === true) {
            me.cls = me.mandatoryCls;
        } else {
            if (me.cls)
                me.cls = me.cls.replace(me.mandatoryCls, '');
        }
    }
});
// Window
Ext.define('Ext.o.window.Window', {
	override: 'Ext.window.Window',
    constrain: true,
	doClose: function() {
        var me = this,
		e = arguments[0]; 
        // Being called as callback after going through the hide call below 
		if(e && (e.type == 'click' || e.type == 'mouseup')) {
			me.isClose = true;
			if (!Ext.isEmpty(me.isCallout))
				delete me.isCallout;
		}
        if (me.hidden) {
            me.fireEvent('close', me, arguments);
            
            // This method can be called from hide() which in turn can be called 
            // from destroy() 
            if (me.closeAction === 'destroy' && !me.destroying && !me.destroyed) {
                me.destroy();
            }
        } else {
            // close after hiding 			
			me.hide(me.animateTarget, me.doClose, me, arguments);			
        }
    }
});
Ext.define('Ext.o.form.field.Checkbox', {
    override: 'Ext.form.field.Checkbox',
	afterRender: function() {
		var me = this,
			bodyObj = (me.el) ? me.el.dom : null,
			noLblCls = 'x-item-cb-nolabel';
		if ( (me.xtype == 'checkboxfield' || me.xtype == 'checkbox') && Ext.isEmpty(me.boxLabel) && !Ext.isEmpty(bodyObj) && !Ext.isEmpty(bodyObj.className) ) {
			if(bodyObj.className.indexOf('x-form-item-no-label') > -1)
				me.addCls(noLblCls);
		}
	},
    onChangeEvent: function(e) {
		var me = this,
			radCtrl = me.up('ramcoradio');			
			if (Ext.isEmpty(radCtrl))
				me.eType = e.type;			
			else
				radCtrl.eType = e.type;			
        this.updateValueFromDom();
    }
});

// Data Field Override
Ext.define('Ext.o.data.field.Field', {
    override: 'Ext.data.field.Field',
    allowNull: true
});
//trigger Override
Ext.define('Ext.o.form.trigger.Trigger', {
    override: 'Ext.form.trigger.Trigger',
    onClick: function() {
        var me = this,
            args = arguments,
            e = me.clickRepeater ? args[1] : args[0],
            handler = me.handler,
            field = me.field;

        if (handler && (!field.readOnly || handler) && me.isFieldEnabled()) {
            Ext.callback(me.handler, me.scope, [field, me, e], 0, field);
        }
    }
});
// TECH-26633 - Numeric Preference
Ext.define('Ext.o.form.field.Number',{
	override:'Ext.form.field.Number',
	decimalPrecision:0,
	initComponent: function() {
        var me = this;
		if (Ext.isEmpty(RamcoRTC.settings.disableNumericSpin) || RamcoRTC.settings.disableNumericSpin === true) {
            me.keyNavEnabled = false;
			me.mouseWheelEnabled = false;		
		}
		//TECH-37832
		if(me.dataType == 'integer' || me.dataType == 'int' ){
			me.decimalSeparator = '';
			me.decimalPrecision = 0;
		// TECH-34656
		}else if(me.itemId != 'passcodeField' && me.itemId != 'rowNav' && me.maxLength){// TECH-35136 //TECH-35461
			me.maxLength += 1;
		}
		/* // TECH-34656
		if (me.itemId != 'passcodeField' && me.itemId != 'rowNav' && me.maxLength) // TECH-35136 //TECH-35461
			me.maxLength += 1; */
        me.callParent(arguments);
    },
	initEvents : function(){        
		var me = this,
            inputEl = me.inputEl;
		me.callParent();			
		if (inputEl) {
			inputEl.dom.onpaste = me.handleClipData.bind(me);
		}
	},
	handleClipData: function(clipData) {
		var me = this,
			copiedText = '',
			caretPos = me.inputEl && me.inputEl.getCaretPos? me.inputEl.getCaretPos():0,
			text = me.getValue(),
			dirtyValue;
		// TECH-40851
		if(clipData && clipData.browserEvent && clipData.browserEvent.clipboardData) {
			copiedText = clipData.browserEvent.clipboardData.getData('text/plain');
			if (copiedText.indexOf('(') == 0 && copiedText.lastIndexOf(')') == (copiedText.length - 1)) {
				copiedText = copiedText.replace(/^\s*\(/,'-').replace(/\)/,'')
			}
			dirtyValue = copiedText.replace(/\,/g,"");
			dirtyValue = dirtyValue.trim();
			var textBefore = text.substring(0,caretPos);
            var textAfter  = text.substring(caretPos, text.length);
            if(dirtyValue)
               caretPos =  caretPos + dirtyValue.length
            dirtyValue = textBefore + dirtyValue + textAfter;
            me.setValue(dirtyValue);
            clipData.stopPropagation();
            clipData.preventDefault();
            me.focus();
            Ext.defer(function(){
            	if(me.inputEl && me.inputEl.setCaretPos)
                	me.inputEl.setCaretPos(caretPos);
            },100);
			return false;
		}
	},
	valueToRaw: function(value) {
	   if(Ext.isEmpty(value))
			return "";
		var me = this,
			fixed = '00000000000000000',
			decimalSeparator = RamcoRTC.prefs.DECIMALSEPARATOR || me.decimalSeparator,
			precision = me.getFormat() || me.decimalPrecision,
			fixedFormat = '0'+ decimalSeparator + fixed.substring(0,precision),
			errors = me.getErrors(); // TECH-34656
		//TECH-28304
		//if (decimalSeparator == ',' && value.toString().indexOf(',',value.length - (precision + 1)) > -1)
		//	return value;
	value = me.parseValue(value);
	//value = me.fixPrecision(value); // TECH-31467

		value = Ext.isNumber(value) ? value : parseFloat(String(value).replace(decimalSeparator, '.'));
		if(isNaN(value))
			value =  '';
		else{
			if(precision == 0)
				value = String(value).replace('.', decimalSeparator);	
			else {
				//value = Ext.util.Format.number(value, fixedFormat);
				// TECH-34656
				if(Ext.isEmpty(me.up('ramcogrid')) && Ext.isEmpty(errors))//TECH-28304
					value = me.formatNumeric(value, precision);
			}
		}
		return value;
	},	
	rawToValue: function(oldValue) {
        var me = this, 
			decimalSeparator = me.decimalSeparator,
			precision = me.getFormat() || me.decimalPrecision,
			value;
			//TECH-28304
		//if (!Ext.isEmpty(oldValue) && decimalSeparator == ',' && oldValue.toString().indexOf(',',oldValue.length - (precision + 1)) > -1)
			//return oldValue;
			
		// value = me.fixPrecision(this.parseValue(oldValue)); // TECH-31467
		value = this.parseValue(oldValue);
        if (value === null) {
            value = oldValue || null
        }
        return value
    },
	// TECH-31467
	formatNumber: function(value, prec) {
		try {
			var me = this,
				thousandSep = Ext.util.Format.thousandSeparator,
				decSep = Ext.util.Format.decimalSeparator,
				tempValue = "00000000000000000000",
				splitVal = [], valueObj = value, decObj = "0", returnVal;
			
			if (!Ext.isEmpty(value))
				value = value.toString();
			
			if (value.indexOf(decSep) >= 0) {
				splitVal = value.split(decSep);
				if (splitVal && splitVal.length > 1) {
					valueObj = splitVal[0];
					decObj = splitVal[1];
				}
			}
			
			splitVal = String(valueObj).replace(new RegExp('[/' + thousandSep + "]", 'g'), "");
			if (!Ext.isEmpty(decObj)) {
				if(String(decObj).length < prec)
					decObj = decObj + tempValue.substring(0, prec - String(decObj).length);
				decObj = decObj.substring(0,prec);
			}
			else
				valueObj = value;
			
			if(valueObj != "" && valueObj.length == 1 && valueObj == "-")
				valueObj = valueObj + 0;
			//TECH-32220
			if(prec > 0)
				returnVal =   valueObj + decSep + decObj;
			else if(prec  == 0)
				returnVal =   valueObj;
			//returnVal =   valueObj + decSep + decObj;
			
			var tmpv = parseInt(returnVal, 10);
			if(isNaN(tmpv))
				returnVal = "";
			
			return returnVal;
		}
		catch(ex) {}		
	},
	formatNumeric: function(value, dataType) {
		if(Ext.isEmpty(value))
			return "";
        var tempNum = '999999999999999999',
			n1, n2, num, num1,num2;
			
        dataType = dataType ? parseInt(dataType, 10) : 0;
        if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "no grouping") {
            format = '9.' + tempNum.substring(0, dataType)
        } else {
            format = '9,9.' + tempNum.substring(0, dataType)
        }
        Ext.util.Format.thousandSeparator = RamcoRTC.userPreference.numgroupsymbol;
        Ext.util.Format.decimalSeparator = RamcoRTC.userPreference.decimalseparator;
		
		var numGroupStyle = RamcoRTC.userPreference.numgroupstyle.toLowerCase();
		if (!Ext.isEmpty(numGroupStyle) && numGroupStyle != 'no grouping') {//TECH-33327
			num2 = parseFloat(this.formatNumber(value, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
			if (numGroupStyle == "lakh based")
				n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			else if (numGroupStyle == "million based")
				n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			
			num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
		}else{
			if (dataType == null || dataType == 0){
				//TECH-32220
				num = this.formatNumber(value, 0);
				/*if (!Ext.isEmpty(num))//TECH-33327
					num = Ext.util.Format.number(num, "0");*/
			}
			else{
				//TECH-32220
				num = this.formatNumber(value,dataType);
            	/* if (!Ext.isEmpty(num))//TECH-33327
					num = Ext.util.Format.number(num, format); */
			}
		}
		
        /* if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "lakh based") {
            // TECH-31467
			//num2 = (value) ? parseFloat(value) : 0;
			num2 = parseFloat(this.formatNumber(value, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
            n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        }else if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "million based") {//TECH-33327
         	num2 = parseFloat(this.formatNumber(value, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
	       // n1 = n1[0].replace(/(?<!\.)(\d)(?=(\d{3})+(\.|$))/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
	        n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        } else {
			if (dataType == null || dataType == 0){
				//TECH-32220
				num = this.formatNumber(value, 0);
				//if (!Ext.isEmpty(num))//TECH-33327
				//	num = Ext.util.Format.number(num, "0");
			}
			else{
				//TECH-32220
				num = this.formatNumber(value,dataType);
            	// if (!Ext.isEmpty(num))//TECH-33327
				//	num = Ext.util.Format.number(num, format); 
			}
        } */
        var neg = false;
		if(Ext.isNumber(num))//TECH-33327
			num = num.toString();
        if (num.indexOf('-') != -1)
            neg = true;
        if (neg) {
            var numNegStyle = RamcoRTC.userPreference.numnegativestle;
            switch (numNegStyle) {
                case "(1.1)":
                    num = "(" + num.replace("-", "") + ")";
                    break;

                case "- 1.1":
                    num = num.replace("-", "- ");
                    break;

                case "1.1-":
                    num = num.replace("-", "") + "-";
                    break;

                case "1.1 -":
                    num = num.replace("-", "") + " -";
                    break;

                case "()1.1":
                    num = "()" + num.replace("-", "");
                    break;

                case "(-)1.1":
                    num = "(-)" + num.replace("-", "");
                    break;
                default:
                    num = "-" + num.replace("-", "");
                    break;
            }
        }
        return num;
	} ,
	   getErrors: function(b) {//TECH-28304
        b = arguments.length > 0 ? b : this.processRawValue(this.getRawValue());
        var a = this, c = Ext.form.field.Spinner.prototype.getErrors.call(this, b), e = Ext.String.format, d;
        if (b.length < 1) {
            return c
        }
        b = String(b).replace(Ext.util.Format.decimalSeparator, '.');
		var s = new RegExp("["+Ext.util.Format.thousandSeparator+"]","g"); 
		b = b.replace(s, '');
        if (isNaN(b)) {
            c.push(e(a.nanText, b))
        }
		d = a.parseValue(b);
	    if (a.minValue === 0 && d < 0) {
            c.push(this.negativeText)
        } else {
            if (d < a.minValue) {
                c.push(e(a.minText, a.minValue))
            }
        }
        if (d > a.maxValue) {
            c.push(e(a.maxText, a.maxValue))
        }
        return c
    },
	parseValue: function(a) {//TECH-28304
	var s,b;
	if(Ext.util.Format.decimalSeparator == "."){
			b = String(a).replace(Ext.util.Format.decimalSeparator, '.');
			s = new RegExp("["+Ext.util.Format.thousandSeparator+"]","g"); 
	}else if(Ext.util.Format.decimalSeparator == ","){
		if(Ext.util.Format.thousandSeparator == ".")
			b = String(a).replace(/[.]/g,',').replace(/,([^,]*)$/g,'.$1');
		else
			b = String(a).replace(/[\s]/g,',').replace(/,([^,]*)$/g,'.$1');
		s = new RegExp(",","g"); 
		//var b = String(val).replace('.', '.');
	}else if(Ext.util.Format.decimalSeparator == " "){
		if(Ext.util.Format.thousandSeparator == ".")
			b = String(a).replace(/[.]/g,',').replace(/\s([^\s]*)$/g,'.$1');
		else
			b = String(a).replace(/[,]/g,',').replace(/\s([^\s]*)$/g,'.$1');
		s = new RegExp(",","g"); 
	}
	b = b.replace(s, '');
	a = parseFloat(b); 
	return isNaN(a) ? null : a;
  }
});
//CKEDitor
Ext.define('Ext.form.field.DivCkHtmlEditor', {
    extend: 'Ext.form.field.TextArea',
    alias: ['widget.ramcodivckhtmleditor', 'widget.ramcohtmleditor'],
    validateOnChange:false,
	height:150,
    
    defaultListenerScope: true,
    cls: Ext.baseCSSPrefix + 'form-htmleditor',
    
    listeners: {
      instanceReady: 'instanceReady',
      resize: 'resize'
    },

    editorId: null,
    editor:null,
	editorChange: false,
    CKConfig: {
		skin: 'moono-lisa',
		resize_enabled : false,
		plugins:'dialogui,dialog,about,a11yhelp,dialogadvtab,basicstyles,bidi,blockquote,notification,button,toolbar,clipboard,panelbutton,panel,floatpanel,colorbutton,colordialog,templates,menu,contextmenu,copyformatting,div,resize,elementspath,enterkey,entities,popup,filebrowser,find,fakeobjects,flash,floatingspace,listblock,richcombo,font,forms,format,horizontalrule,htmlwriter,iframe,wysiwygarea,image,indent,indentblock,indentlist,smiley,justify,menubutton,language,link,list,liststyle,magicline,maximize,newpage,pagebreak,pastetext,pastefromword,preview,print,removeformat,save,selectall,showblocks,showborders,sourcearea,specialchar,stylescombo,tab,table,tabletools,tableselection,undo,lineutils,widgetselection,widget,filetools,notificationaggregator,uploadwidget,uploadimage,wsc,bgimage,backgrounds,custimage,divarea,docprops,docfont,emojione,fixed,imagepaste,imageresizerowandcolumn,lineheight,maxheight,embedbase,media,textindent,pastefromexcel,pastebase64,placeholder,placeholder_select,SimpleImage,stat,staticspace,toc,contents,tableresize,tableresizerowandcolumn,tablesorter,tabletoolstoolbar,wordcount,balloonpanel,ccmsacdc,allmedias,autolink,autoembed,autocorrect,brclear,dropdownmenumanager,easykeymap,image2,imagerotate,onchange,selectallcontextmenu,SimpleLink,zoom,toolbarswitch,base64image,quicktable,sharedspace,confighelper,deselect,ccmsconfighelper',
		toolbar:[
				{ name: 'tools', items: [ 'Maximize' ] },
				{ name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline']},
			{ name: 'colors', items: [ 'TextColor', 'BGColor' ] },
				{ name: 'links', items: [ 'Link'] },
				{ name: 'paragraph', items: ['JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock']},
				{ name: 'insert', items: [ 'Image', 'Table', 'Smiley'] },
			{ name: 'styles', items: [ 'Format', 'Font', 'FontSize' ] }
		]
	},

    initComponent: function () {
		var me = this;
		me.callParent(arguments);
        me.on("afterrender", function () {
            Ext.apply(me.CKConfig, {
					height: me.getHeight(),
					width: me.getWidth()
            });
            if(Ext.isEmpty(CKEDITOR))
            {
                Ext.log({level:'error',msg:'CKEditor has not loaded. Please check your app.json and make sure ckeditor.js is loaded first'});
                return true;
            }
			me.editor = CKEDITOR.replace(me.inputEl.id, me.CKConfig);
            me.editorId = me.inputEl.id;
            me.editor.name = me.name;

            me.editor.on("instanceReady", function (ev) {
					me.fireEvent("instanceReady",me,me.editor);
            }, me);
			me.editor.on("contentPreview", function (ev) {
                me.beforePreview(ev);
            }, me);
			me.editor.on("change", function (ev) {
				if (me.didValueChange(me.getValue(), me.lastValue)) {
					me.editorChange = true;
					me.checkChange();
				}
			}, me); 
        }, me);
    },
    instanceReady : function (ev) {
        // Set read only to false to avoid issue when created into or as a child of a disabled component.
        ev.editor.setReadOnly(this.readOnly || false);
		var me = this,
			editorId = ev.editor.id,
			size =  me.getSize(),
			topTbr = document.getElementById(editorId + "_top"),
			bottomTbr = document.getElementById(editorId + "_bottom");
		if (me.readOnly && topTbr && bottomTbr) {
			topTbr.style.display = "none";
			bottomTbr.style.display = "none";
		}
		me.resizeEditor(size.width,size.height);
		me.fireEvent("editorready",me,me.editor);
    },
	beforePreview:function(ev){
		var me =this,
			data = ev.data.dataValue,
			ilbo = me.up('ilbo');
		if(!Ext.isEmpty(ilbo) && ilbo.callout && ilbo.callout.onBeforePreview){
			try {
					ev.data.dataValue = ilbo.callout.onBeforePreview.apply(ilbo || window, [data]);
				}
			catch (e) {
				console.log("Error in Callout Js." + e);
			}	
		}
	},
    onRender: function (ct, position) {
		var me =this;
        if (!me.el) {
            me.defaultAutoCreate = {
                tag: 'textarea',
                autocomplete: 'off'
            };
        }
        me.callParent(arguments)
    },

    setValue: function (value) {
		var me =this;
		me.callParent(arguments);
		if (me.editor) {
			if (!me.editorChange)
            me.editor.setData(value);
			me.editorChange	 = false;
        }
    },

    getValue: function () {
		var me =this;
        if (me.editor) {
            return me.editor.getData();
        }
        else {
            return ''
        }
    },

    destroy: function(){
        var me =this;
		// delete instance
        if(!Ext.isEmpty(CKEDITOR.instances[me.editorId])){
            delete CKEDITOR.instances[me.editorId];
        }
    },

    resize: function(win,width, height,opt) {
        var me =this;
		me.resizeEditor(width,height);
    },
	resizeEditor:function(width,height){
		var me =this,
			eid = me.editorId,
            editor = CKEDITOR.instances[me.editorId];     
        if (!Ext.isEmpty(editor) && editor.status =="ready"){
            editor.resize(width, height);
        }
	}
});


Ext.define('Ext.ramco.PasswordMask', {
	extend: 'Ext.form.field.Text',
	alias: 'widget.ramcopassword',
	options: null,
	enableKeyEvents: false,
	inputType: 'password',
	keysDown: {},	
	previousInputValue: null,
	timeout: null,
	observing: false,
	switchToPasswordType: false,
	inputFieldTypes: {},	
	form: null,
	toggleIcon: null,
	delay: 1,
	prevVal: '',
	observeForm: true,					 						
	cloakingCharacters: (navigator.platform == "MacIntel") ? '\u2022' : '\u25CF',		 
	cloakingCharacter: '',
	//onChange: null,
	onStateChange: null,
	showIcon: false,
	//switchToPasswordType: Ext.isIE || false,	
	initComponent: function() {
		var me = this,
			triggers = me.getTriggers();
		if (me.showIcon) {
			trigger = {
				eye: {
					weight: -1,
					handler: 'toggleIconClick',
					hideOnReadOnly: false,
					scope: me
				}
			};			
			if (triggers) {
                triggers.eye = trigger.eye;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }			
		}
		me.callParent();
	},
	initEvents: function() {
        var me = this;
        me.callParent();
        me.mon(me.inputEl, {
            scope: me,
            keydown: me.onKeyPress,
			keyup: me.onKeyUp,
			paste: me.onKeyUp,
			blur: me.onPwdBlur
        });								
		me.cloakingCharacter = me.cloakingCharacters.charAt(0);
		me.activate();
    },
	toggleIconClick: function() {
		var me = this;
		if(me.observing)
			me.deactivate(false);
		else 
			me.activate(true);
	},
	onKeyUp: function(e){
		var me = this,
			pwInput = me.inputEl,
			keysDown = me.keysDown,
			value = '';
		if (me.observing) {
			if (e.event.type == "paste") {
				setTimeout(me.afterInputHandler.bind(me), 0);
				return;
			}
			if (me.isSpecialKey(e.event.keyCode) || e.event.metaKey || e.event.ctrlKey) 
				return;
			if (keysDown[e.event.keyCode] || e.event.keyCode < 11) 
				me.afterInputHandler(e.event);
		} else {
			value = me.getValue();
			if (value != me.previousInputValue) {
				me.previousInputValue = value;
				//if (me.onChange) 
					//me.onChange(me.getValue());
			}
		}
	},
	onPwdBlur: function(e) {
		var me = this;
		me.cloakInput();
	},
	onKeyPress: function(e) {
        var me = this,
            val = null,
            ellipse = null,
			keysDown = me.keysDown;
		if (me.observing) {
			if (!(me.isSpecialKey(e.event.keyCode) || e.event.metaKey || e.event.ctrlKey)) {
				var keyCode = null;
				for (var keyCode in keysDown) {
					me.afterInputHandler(keyCode);
				}
				me.storeSelection();
				if (!keyCode) 
					me.cloakInput();
				if (e.event.keyCode > 10) {
					me.keysDown[e.event.keyCode] = true;					
				}
				// Purge value when user holds backspace key
				if (e.event.keyCode == 8 && !keyCode) {
					me.prevVal = me.prevVal.substring(0, me.prevVal.length - 1);
				}
			} else {
				me.storeSelection();
				if (me.timeout) {
					clearTimeout(me.timeout);
					me.timeout = null;
					me.cloakInput();
				}
			}
		}
		return;	
    },
	afterInputHandler: function(keyCode) {
		var me = this,
			value = me.getValue(),
			selection = me.getFieldSelection(me.inputEl.dom);
		
		delete me.keysDown[keyCode];
		if (me.previousInputValue != value) {
			var sStart = me.previousSelection[0],
				sEnd = me.previousSelection[1],
				sLength = me.previousSelection[2],
				lengthDifference = value.length - me.prevVal.length,	// > 0: characters added
				newValue;
			if (lengthDifference < 0 && sLength == 0) {		// single character deletion
				if (sStart == selection[0])	{				// forward deletion
					newValue = me.prevVal.substring(0, sStart) + me.prevVal.substring(sEnd + 1);
				} else {									// has to be backward deletion
					newValue = me.prevVal.substring(0, value.length);
				}
			} else {										// a selection has been replaced/deleted
				newValue = me.prevVal.substring(0, sStart) + value.substring(sStart, selection[1]) + me.prevVal.substring(sEnd);
			}
			me.prevVal = newValue;
			if (me.onChange) 
				me.onChange(me.getValue());
			if (me.timeout) {
				clearTimeout(me.timeout);
				me.timeout = null;
			}
			if (lengthDifference != 0) {
				// leave newly written part uncloaked
				me.cloakInput([sStart + 1, selection[1]]);
				me.timeout = setTimeout(me.cloakInput.bind(me), me.delay * 900);
			}
		} 
		else {
			me.previousSelection = selection;
		}
	},
	getEncValue: function() {
		return this.prevVal;
	},
	setEncValue: function(value) {
		this.prevVal = value;
	},
	isSpecialKey: function(keyCode) {
		// TODO: Need to check OS? Windows key?
		return (keyCode >= 9 && keyCode <= 20) || (keyCode >= 33 && keyCode <= 40) || keyCode == 224;
	},
	getFieldSelection: function(element) {
		if (document.selection) {
			var range = document.selection.createRange();
			var length = range.text.length;
			range.moveStart('character', -element.val().length);	// Move selection start to 0 position
			var cursorPos = range.text.length;	// The caret position is now the selection length
			return [cursorPos - length, cursorPos, length];
		} 
		else {				
			var el = element;
			return [el.selectionStart, el.selectionEnd, el.selectionEnd - el.selectionStart];
		}
	},
	setFieldSelection: function(element, selection) {
		var el = element;
		if (document.selection) {
			var range = el.createTextRange();
			range.collapse();
			range.moveStart('character', selection[0]);
			range.moveEnd('character', selection[1] - selection[0]);
			range.select();
		} else {
			el.selectionStart = selection[0];
			el.selectionEnd = selection[1];
		}
	},
	cloakInput: function(keepRange) {			
		var me = this,			
			selection = me.getFieldSelection(me.inputEl.dom),
			value = me.getValue();
		if (keepRange) {
			me.setValue(value.substring(0, keepRange[0] - 1 ).replace(/./g, me.cloakingCharacter) + value.substring(keepRange[0] - 1, keepRange[1]) + value.substring(keepRange[1]).replace(/./g, me.cloakingCharacter));
		} 
		else {
			me.setValue(value.replace(/./g, me.cloakingCharacter));
			if (me.inputEl.dom.getAttribute("type") != "text") {
				if (me.switchToPasswordType) {
					_switchInputTypeIE("text");
				} else {
					me.inputEl.dom.setAttribute("type", "text");	// override jQuery's behaviour
				}
				me.inputEl.dom.setAttribute("autocomplete", "off");
			}
		}
		if (document.activeElement && document.activeElement == me.inputEl.dom) 
			me.setFieldSelection(me.inputEl.dom, selection);
		me.previousInputValue = me.getValue();
	},
	storeSelection: function() {
		var me = this;
		if (me.observing) {
			me.previousSelection = me.getFieldSelection(me.inputEl.dom);
		}
	},
	activate: function() {
		var me = this,		
			triggers = me.getTriggers();
		me.observing = true;
		me.prevVal = me.getValue(),
		me.cloakInput();
		if (triggers.eye)
			me.switchToggleIcon(true);
		if (me.onStateChange) 
			me.onStateChange(me.observing, this, me.toggleIcon);
	},
	deactivate: function (temporarily) {
		var me = this,
			triggers = me.getTriggers();
		if (me.observing) {
			if (me.timeout) {
				clearTimeout(me.timeout);
				me.timeout = null;
			}
			var selection = me.getFieldSelection(me.inputEl.dom);
			me.switchToPasswordType ? _switchInputTypeIE("password") : me.inputEl.dom.setAttribute("type", "text");
			me.setValue(me.prevVal);
			if (document.activeElement && document.activeElement == me.inputEl) 
				me.setFieldSelection(me.inputEl.dom, selection);
			if (temporarily !== true) {
				me.observing = false;
				if (triggers.eye) 
					me.switchToggleIcon(false);
				if (me.onStateChange) 
					me.onStateChange(me.observing, this, me.toggleIcon);
			}
		}
	},
	switchToggleIcon: function(state) {
		var me = this,
			triggers = me.getTriggers();
		if (triggers.eye) {
			if (state) {
				//me.triggerCell.elements[0].removeCls('fa-eye');
				//me.triggerCell.toggleCls('fa-eye-slash');
				triggers.eye.el.removeCls('fa-eye');
				triggers.eye.el.toggleCls('fa-eye-slash');				
			} 
			else {
				// me.triggerCell.elements[0].removeCls('fa-eye-slash');
				// me.triggerCell.toggleCls('fa-eye');				
				triggers.eye.el.removeCls('fa-eye-slash');
				triggers.eye.el.toggleCls('fa-eye');
			}
		}
	},
	doDestroy: function() {
		var me = this,
			inputEl = me.inputEl;			
		if (inputEl) {			
			me.mun(me.inputEl, {
				scope: me,
				keydown: me.onKeyPress,
				keyup: me.onKeyUp,
				paste: me.onKeyUp
			});	
		}		
		me.callParent();
    }
});

// Text Field Override
Ext.define('Ext.o.form.field.Text', {
    override: 'Ext.form.field.Text',
    mandatoryCls: Ext.baseCSSPrefix + 'mandatory',
    dataType: 'string',
    enableKeyEvents: true,
    format: null,
    allowNull: true,
	growAppend: 'W',
    //visibleLength: 15,
    enforceMaxLength: true,
    grow: false,
    growToLongestValue: false,
	spellCheck:false,
    config: {
        helpIcon: false,
        expandIcon: false,
        searchIcon: false,
		ctrlValue: null,
        dataPrec: null,
        mandatory: false,
		sTooltip: '',
		ctrlConfig: null
    },
	initComponent:function(){
		var me=this;
		me.inputAttrTpl="spellcheck=" + me.spellCheck;
		if (Ext.isEmpty(me.visibleLength) && me.xtype != 'textarea' && me.xtype != 'textareafield')
			me.visibleLength = 15;
		me.sizeControl();
		//TECH-35011
		if (RamcoRTC.settings.headerDisableColor === true) {
			me.readOnlyCls += " customreadonly";
		}
		me.callParent(arguments);
	},
    initEvents: function() {
        var me = this,
			sTooltip = me.getSTooltip();
        me.callParent();
        me.el.dom.setAttribute('itemId', me.getItemId());
        if (me.xtype == 'numberfield') {
            var triggers = me.getTriggers();
            if (triggers && triggers['spinner']) {
				triggers['spinner'].hideOnReadOnly = false;
                triggers['spinner'].hide();
            }
            me.keyNavEnabled = false;
            me.mouseWheelEnabled = false;
			if(!me.readOnly && me.spinner === true) {
				triggers['spinner'].show();
				me.keyNavEnabled = true;
				me.mouseWheelEnabled = true;
			}			
        }
		if(me.lookupViewModel()) {
			me.setBind({
				ctrlConfig: "{" + me.itemId + ".addlProps}"
			});	
		}

        if (me.xtype == 'textarea') {
            me.returnRe = '';
            me.growAppend = 'W';
            if (me.height) {
                me.inputEl.setHeight(me.height);
            }
        }
		if (!Ext.isEmpty(sTooltip) && me.inputEl) {
			me.inputEl.dom.setAttribute("data-qtip", sTooltip);
		}
		
		if (me.inputEl)
        me.mon(me.inputEl, {
            scope: me,
            keydown: me.onKeyPress,
			paste: me.handleClipData.bind(me) //TECH-39334
        });
    },
	//TECH-39334
	handleClipData: function(clipData) {
		var me = this,
			copiedText = '',
			caretPos = me.inputEl && me.inputEl.getCaretPos? me.inputEl.getCaretPos():0,
			text = me.getValue(),
			dirtyValue;
		// TECH-40851
		if(clipData && clipData.browserEvent && clipData.browserEvent.clipboardData) {
			copiedText = clipData.browserEvent.clipboardData.getData('text/plain');
			if (copiedText.indexOf('(') == 0 && copiedText.lastIndexOf(')') == (copiedText.length - 1)) {
				copiedText = copiedText.replace(/^\s*\(/,'-').replace(/\)/,'')
			}
			dirtyValue = copiedText.replace(/\,/g,"");
			dirtyValue = dirtyValue.trim();
			var textBefore = text.substring(0,caretPos);
            var textAfter  = text.substring(caretPos, text.length);
            if(dirtyValue)
               caretPos =  caretPos + dirtyValue.length
            dirtyValue = textBefore + dirtyValue + textAfter;
            me.setValue(dirtyValue);
            clipData.stopPropagation();
            clipData.preventDefault();
            me.focus();
            Ext.defer(function(){
            	if(me.inputEl && me.inputEl.setCaretPos)
                	me.inputEl.setCaretPos(caretPos);
            },100);
			return false;
		}
	},
    onKeyPress: function(e) {
        var me = this,
            val = null,
            ellipse = null;
        if (e && e.keyCode == 113 && e.event.key.toUpperCase() == "F2") {
            me.onShowEllipseWindow(e);
        }
        if (e && e.keyCode == 112 && e.event.key.toUpperCase() == "F1" && me.getHelpIcon()) {
            e.stopEvent();
            me.fireEvent('help', me);
        } else {
            this.fireEvent('keypress', this, e);
        }
    },
    validator: function(v) {
        var me = this,
            val = v,
            rw, sa, t, newTag, tagWithEnd, stIndex, curTag, reservedWords, htmlTags,
            stringArray = val.split ? val.split(" ") : val;
		//TECH-26312
		// Vulnerability
		//if (me.xtype == 'ramcodivckhtmleditor' || me.xtype == 'ramcohtmleditor' || me.xtype == 'ramcodivhtmleditor' || RamcoRTC.settings.purifyText == true )
		// TECH-31467
		if (me.xtype == 'ramcodivckhtmleditor' || me.xtype == 'ramcohtmleditor' || me.xtype == 'ramcodivhtmleditor') //&& RamcoRTC.settings.purifyText != false ) // TECH-32296
			return true;
		// TECH-32726
		val	= purifyDom(val);
        if (val && RamcoRTC.settings && RamcoRTC.settings.blockedWords) {
            reservedWords = RamcoRTC.settings.blockedWords;
            if (reservedWords && reservedWords.length > 0) {
                for (var rw = 0; rw < reservedWords.length; rw++) {
                    if (val == reservedWords[rw]) {
                        return 'Invalid String';
                    }
                }
            }
        }

        // TECH-33892
		if (val) {
            htmlTags = Ext.HTMLTAGS;
            if (htmlTags && htmlTags.length > 0) {
                var rwIndex = 0;
                for (sa = 0; sa < stringArray.length; sa++) {
                    for (t = 0; t < htmlTags.length; t++) {
                        newTag = "<" + htmlTags[t];
                        tagWithEnd = newTag + ">";
                        stIndex = stringArray[sa].toLowerCase().indexOf(newTag);

                        if (stIndex == -1)
                            stIndex = stringArray[sa].toLowerCase().indexOf(tagWithEnd);

                        curTag = stringArray[sa].toLowerCase().substring(stIndex);

                        if ((stIndex > -1 && (curTag == newTag || curTag == newTag + ">" || curTag == newTag + " >" || 
											curTag == newTag + "/>" || curTag == newTag + " />" || 
											curTag.indexOf(newTag) > -1 || curTag.indexOf(tagWithEnd) > -1))) {
                            rwIndex = -1;
                            break;
                        }
                    }
                }
            }
            return (rwIndex !== -1) ? true : 'Invalid String';
        }
        return true;
    },
	getErrors: function(value) {
        value = arguments.length ? (value == null ? '' : value) : this.processRawValue(this.getRawValue()); 
        var me = this,
            //errors = me.callParent([value]),
			errors = [],
            validator = me.validator,
            vtype = me.vtype,
            vtypes = Ext.form.field.VTypes,
            regex = me.regex,
            format = Ext.String.format,
            msg, trimmed, isBlank, view = me.up('ilbo'); // TECH-41167
		
		// TECH-41167
		if (view && view.ilboConfig && (view.ilboConfig.activityName == 'login' || view.ilboConfig.activityName == 'Logon'))
			return errors;	
			
        if (Ext.isFunction(validator)) {
			if (me.xtype == "combocheckfield" && me.multiSelect === true)
				msg = true;
			else 
				msg = validator.call(me, value);
            //if (msg !== true) {
			// TECH-34656
			if (!Ext.isBoolean(msg) && !Ext.isEmpty(msg)) {
                errors.push(msg);
            }
        } 
        trimmed = me.allowOnlyWhitespace ? value : Ext.String.trim(value); 
        if (trimmed.length < 1) {
            if (!me.allowBlank) {
                errors.push(me.blankText);
            }
            // If we are not configured to validate blank values, there cannot be any additional errors 
            if (!me.validateBlank) {
                return errors;
            }
            isBlank = true;
        } 
        // If a blank value has been allowed through, then exempt it from the minLength check. 
        // It must be allowed to hit the vtype validation. 
        if (!isBlank && value.length < me.minLength) {
            errors.push(format(me.minLengthText, me.minLength));
        }
		if(this.xtype == "textarea" /* && !this.hidden */) {
			if (value.length > me.maxLength) {
				errors.push(format(me.maxLengthText, me.maxLength));
			}
		}
        if (vtype) {
            if (!vtypes[vtype](value, me)) {
                errors.push(me.vtypeText || vtypes[vtype +'Text']);
            }
        }
        if (regex && !regex.test(value)) {
            errors.push(me.regexText || me.invalidText);
        }
		
		// TECH-30546 / QA-151
		if (me.xtype != 'numberfield' && errors && errors.length == 0) { // TECH-31467
			var ilbo = me.up('ilbo'),
				controller = ilbo && ilbo.controller,
				sErrors = controller && controller.errors,
				// TECH-37397
				itemId = me.itemId;			
			if (sErrors && sErrors.length > 0 && me.wasValid == true && !Ext.isEmpty(sErrors.getByKey(itemId))) { // TECH-39573
				sErrors.removeAtKey(itemId);
				//sErrors.clear();
				ilbo.fireEvent('errors', ilbo, sErrors);	
			}
		}
		
        return errors;
    },
	/*
    afterRender: function() {
        var me = this;
        me.callParent();
    },*/
    sizeControl: function() {
        var me = this,
            value = null,
			width = 0,
            triggers = me.getTriggers(),
            triggerWidth = 0,
            dataType = me.getDataType(),
            inputEl = me.inputEl;
        if (me.xtype == 'numberfield') {
            me.growAppend = '5';
        }
		
		// TECH-27832
		if ((me.xtype == 'textarea' || me.xtype == 'textareafield') && !Ext.isEmpty(me.visibleLength) && me.width == '100%') {
			width = me.visibleLength * 8;
			me.setWidth(width);
			return;
		}
		
        if (me.width && me.xtype != 'ramcoimageattach')//TECH-29208
            return;
			//TECH-31705
		if(!Ext.isEmpty(me.up('uigridzoom')) && me.xtype == 'ramcoimageattach'){
			me.setWidth(me.width);
			return;
		}
		// Datepicker
		if (dataType == 'date' || me.xtype == 'datefield') {
			if (!me.plugins)
				me.format = RamcoRTC.userPreference.dateFormat;
			if (RamcoRTC.settings.enforceDateWidth == false)
				  me.visibleLength = 11;
			if(me.visibleLength === 0){
				me.setWidth('90%');
				return;
			}
		} else if (dataType == 'date-time' || me.xtype == 'ramcodatetimefield') {
			me.format = RamcoRTC.userPreference.dateTimeFormat;
			if (RamcoRTC.settings.enforceDateWidth == false)
				me.visibleLength = 20;
			if(me.visibleLength === 0){
				me.setWidth('90%');
				return;
			}
		} else if (dataType == 'time' || me.xtype == 'ramcotimefield') {
			me.format = RamcoRTC.userPreference.timeFormat;
			if (RamcoRTC.settings.enforceDateWidth == false)
				me.visibleLength = 11;
			if(me.visibleLength === 0){
				me.setWidth('90%');
				return;
			}			
		}
        else if (me.xtype == 'combofield') {
            if (me.visibleLength && me.visibleLength > 0) {
                me.grow = false;
                me.growToLongestValue = false;
            } else {
                me.grow = true;
                me.growToLongestValue = true;
                return;
            }
        } else {
            if (!me.visibleLength || me.visibleLength == 0) {
                if (me.xtype == 'textarea') {
                    return;
                }
                //if (me.xtype == 'textfield' || me.xtype == 'ramcolistedit' || me.xtype == 'ramcoimageattach') {//TECH-29208
                    me.setWidth('90%');
                    return;
                //}
                //me.visibleLength = 20;
            }
        }
        //width = me.visibleLength * 6.5 + 22;
		//width = me.visibleLength * RamcoRTC.headerFontSize + 22;
        /*for (triggerId in triggers) {
            if (me.xtype != 'numberfield')
                triggerWidth += triggers[triggerId].el.getWidth();
        }
        width = me.visibleLength * 7.5;
        width = width + triggerWidth + me.inputWrap.getBorderWidth('lr') + me.triggerWrap.getBorderWidth('lr');
        width = Math.min(Math.max(width, me.growMin), me.growMax);
		if(me.lastWidth != width){
			me.lastWidth = width;
        me.bodyEl.setWidth(width);
        me.updateLayout();
		}*/
		width = me.visibleLength * RamcoRTC.headerFontSize;
		for (triggerId in triggers) {
            if (me.xtype != 'numberfield')
                triggerWidth += 18;
        }
		if(triggerWidth <=18)
			triggerWidth=0;
		else 
			triggerWidth = triggerWidth - 18;
		width = width + triggerWidth + 25;
		width = Math.ceil(width);
		me.setWidth(width);
    },
    updateMandatory: function(newValue, oldValue) {
        var me = this;
        if (newValue === true) {
            me.cls = me.mandatoryCls;
        } else {
            if (me.cls && !Ext.isArray(me.cls))
                me.cls = me.cls.replace(me.mandatoryCls, '');
        }
        if (!Ext.isEmpty(me.uiTask)) {
            if (me.cls)
                me.cls += ' ' + me.baseCls + '-ui';
            else
                me.cls = me.baseCls + '-ui';

        }
		if(me.rendered){
			if(newValue === true)
				me.addCls(me.mandatoryCls);
			else
				me.removeCls(me.mandatoryCls);
		}
    },
    updateHelpIcon: function(value) {
        var me = this,
            triggers = me.getTriggers()
        trigger = {
            help: {
                weight: 1,
                handler: 'onHelpClick',
                hideOnReadOnly: false,
                scope: me,
                cls: Ext.baseCSSPrefix + 'form-help-trigger'
            }
        };
        if (value !== false) {
            if (triggers) {
                triggers.help = trigger.help;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
    },
    updateExpandIcon: function(value) {
        var me = this,
            triggers = me.getTriggers()
        trigger = {
            expand: {
                weight: 3,
                handler: 'onExpandClick',
                scope: me,
                cls: Ext.baseCSSPrefix + 'form-expand-trigger'
            }
        };
        if (value !== false) {
            if (triggers) {
                triggers.expand = trigger.expand;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
    },
    updateSearchIcon: function(value) {
        var me = this,
            triggers = me.getTriggers()
        trigger = {
            search: {
                weight: 2,
                handler: 'onSearchClick',
                scope: me,
                cls: Ext.baseCSSPrefix + 'form-search-trigger'
            }
        };
        if (value !== false) {
            if (triggers) {
                triggers.search = trigger.search;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
    },
    onHelpClick: function() {
        var me = this;
        me.fireEvent('help', me);
    },
    onExpandClick: function() {
        var me = this;
    },
    onSearchClick: function() {
        var me = this;
        me.fireEvent('search', me, me.getRawValue());
    },
    updateDataPrec: function(newValue, oldValue) {
        var me = this,
			numLen;
		// TECH-34656
        //numLen = me.maxLength - newValue;
		
		// TECH-35136		
        //numLen = (me.config.maxLength  + 1) - newValue;
        if (newValue)
            newValue = me.decimalPrecision = me.getFormat() || newValue; // TECH-34656
		
		numLen = (me.config.maxLength) - newValue; // TECH-35136
        if (me.decimalPrecision != me.precision) {
            if (Ext.isNumber(me.precision)) {
                me.maxLength = numLen + me.precision;
                me.setMaxLength(numLen + me.precision);
            }
        }
        var tempNumber = "99999999999999999999999999999999999999999999999999",
            decSep = RamcoRTC.userPreference.decimalseparator;
        if (me.setMinValue && me.setMaxValue) {

            if (newValue > 0) {
                me.setMinValue("-" + tempNumber.substring(0, numLen) + decSep + tempNumber.substring(0, newValue));
                me.setMaxValue(tempNumber.substring(0, numLen) + decSep + tempNumber.substring(0, newValue));
            } else {
                me.setMinValue("-" + tempNumber.substring(0, me.maxLength));
                me.setMaxValue(tempNumber.substring(0, me.maxLength));
            }
        }
    },
    getDataType: function() {
        return this.dataType;
    },
    setDataType: function(value) {
        this.dataType = value;
        if (this.rendered)
            this.sizeControl();
    },
    getFormat: function(format) {
        return this.format;
    },
    setFormat: function(format) {
        var me = this;
        me.format = format;
        me.title = format;
        if (me.xtype == 'numberfield') {
			// TECH-34656
            me.updateDataPrec(format);
            me.setValue(me.getValue());
		}
        else if (me.xtype == 'datefield')
            me.format = RamcoRTC.userPreference.dateFormat;
        else if (me.xtype == 'ramcotimefield')
            me.format = RamcoRTC.userPreference.timeFormat;
        else if (me.xtype == 'ramcodatetimefield')
            me.format = RamcoRTC.userPreference.dateTimeFormat;
    },
    onShowEllipseWindow: function(e) {
		try {
			var me = this,ellipse,val;
			if (me.itemId == "ellipseText" || me.getItemId() == 'cmbActSearch')
				return false;
			else if (me.xtype == 'combofield' || me.xtype == 'datefield' || me.xtype == 'ramcodatetimefield' || me.xtype == 'ramcotimefield') {
				if (Ext.isFunction(me.expand))
					me.expand();
				return false;
			}				
			val = me.getValue();
			ellipse = Ext.create('Ext.ramco.Ellipse', {
				scrollable: false,
				hidden: true,
				modal: true
			});
			if (RamcoRTC.settings.ellipseSize && Object.keys(RamcoRTC.settings.ellipseSize).length > 0 && parseInt(RamcoRTC.settings.ellipseSize.height) > 0 && parseInt(RamcoRTC.settings.ellipseSize.width) > 0) {//AHBG-26068
				var userWinWidth = parseInt(RamcoRTC.settings.ellipseSize.width, 10),
					userWinHeight = parseInt(RamcoRTC.settings.ellipseSize.height, 10);
				if (userWinWidth > 0) {
					ellipse.maxWidth = (userWinWidth > 500) ? userWinWidth : 500;
					ellipse.setWidth(userWinWidth);
					ellipse.ellipseText.setWidth(userWinWidth - 20);
				}
				if (userWinHeight > 0) {
					ellipse.setHeight(userWinHeight);
					ellipse.ellipseText.setHeight(userWinHeight >= 110 ? userWinHeight - 50 : 60);
				}
			}
			if (ellipse) {
				if (!me.readOnly && me.xtype != 'ramcolabel' && me.xtype != 'label')
					ellipse.ellipseText.setReadOnly(false);
				var gridObj = me.ownerCt.grid,
					column;
				if (gridObj) {
					column = me.ownerCt.column;
					var selPos = gridObj.getSelectionModel().getCurrentPosition();
					// gridObj.columns[colIndex].text;
					if (selPos && selPos.columnHeader)
						ellipse.title = selPos.columnHeader.text;
					if (!(column && column.editor))
						ellipse.ellipseText.setReadOnly(true);
					
					ellipse.showBy(Ext.fly(me.ownerCt.context.cell), 'tl-bl');
				}
				else {
					ellipse.title = me.caption;
					var totWidth = document.body.offsetWidth,
						ellipseWidth = ellipse.width || ellipse.maxWidth,
						ctrlX = me.getX();
					
					if (ellipseWidth <= 300)
						ellipse.showBy(me, 'tl-bl');				
					else {
						ellipse.show();
						ellipse.center();
					}
				}
				ellipse.ascCtrl = me;
				ellipse.ellipseText.setValue(val);
				ellipse.ellipseText.focus(true);
			}
			e.stopEvent();
			e.stopPropagation();
		}
		catch(ex) { console.log('onShowEllipseWindow Exception is ' + ex); }		
	},
    onFocus: function(e) {
        var me = this,
			selModel = null,
			pos = null,
			autoExpand = false,
			editorContext = null;

        if (me.xtype == 'textfield' && !Ext.isEmpty(me.autoExpand)) {
			autoExpand = me.autoExpand;
			if (autoExpand == true) {
				me.onShowEllipseWindow(e);
				return;
			}
		}
		
		if (me.xtype == 'combofield') {
            me.curentValue = me.getRawValue();
        }
        //if(me.xtype != 'ramcolistedit') {
        	me.callParent([e]);
		//}
		if(me.xtype == 'ramcolistedit' && Ext.isEmpty(me.up('uigridzoom'))) {//TECH-29761/QA-142
			if(me.grid) {
				//selModel = me.grid.view.getSelectionModel();
				//pos = selModel.getPosition();
				//me.fireEvent('ctrlfocus', me.grid.itemId, pos.colIdx, (pos.rowIdx + 1));
				editorContext = me.ownerCt.context;
				me.fireEvent('ctrlfocus', me.grid.itemId, editorContext.colIdx, (editorContext.rowIdx + 1));
				return;
			}
		}
		
		me.fireEvent('ctrlfocus', me.itemId, 0, 0);
    },
    onFocusLeave: function(e) {
        var me = this,
			selRec = null;
			me.focusLeave = true,
			lstCtrl = null;
        if (me.xtype == 'combofield') {
            var displayValue = me.getDisplayValue(),
				//TECH-29739
                rec = me.findRecordByDisplay(displayValue);
            if (!rec) {
				// TECH-28318
                if (!Ext.isEmpty(me.curentValue))
                    rec = me.findRecordByDisplay(me.curentValue);
                else
                    rec = me.findRecordByDisplay(displayValue);
                delete me.curentValue;
                if (rec) {
                    if (me.getDisplayValue([me.getRecordDisplayData(rec)]) !== displayValue) {
                        me.select(rec, true);
                    }
                }
            }
        }
		if (me.xtype == "ramcodatetimefield" || me.xtype == "datefield" || me.xtype == "ramcotimefield") {
			value = me.getRawValue();
			if(me.isValid()) {
				me.setValue(me.getValue());
			}
			else {
				parseValue = me.parseSpecialData(me.itemId, value, me.format, "parse");
				parseValue = me.parseSpecialData(me.itemId, parseValue, me.format, "validate");
				parseValue = Ext.Date.parse(parseValue, me.format);
				if(!isNaN(Date.parse(parseValue)))
					me.setValue(parseValue);
				else  {
					e.event.stopEvent();
					me.focusLeave = false;					
				}
			}
		}
		if(me.xtype == 'ramcolistedit'){//AHBG-26058
			me.focusLeave = false;
			 var ilbo = me.up('ilbo'),
				  viewModel = ilbo?ilbo.getViewModel():'',
				  val = me.getValue();
			  if(viewModel){
				  if(viewModel.data && viewModel.data[me.itemId])
					  lstCtrl = viewModel.data[me.itemId].value
				  if(lstCtrl != val || val == null)
					  viewModel.setModified(me.itemId);
			  }
		}
       /*  if(me.xtype == 'ramcolistedit') {
			//selRec = this.getSelectedRecord();
			value = me.getRawValue();
			if (Ext.isEmpty(value))
				me.idField = null;			
			if (!Ext.isEmpty(me.idField))
				selRec = me.store.getById(me.idField) 
			else
				selRec = this.getSelectedRecord();
			
        	if(!Ext.isEmpty(selRec)) {
				//this.callParent([e]);
				//me.select(selRec, true);
				me.fireEvent("select", me, selRec);
			}
			else {
				me.setValue(me.getValue());
				me.fireEvent('focusleave', me, e);
			}
			me.focusLeave = false;
		} */
    },
    autoSize: function() {
        var me = this,
            triggers, triggerId, triggerWidth, inputEl, width, value,
			picker;
        if (me.store && me.store.filters && me.store.filters.length > 0)
            return;

        if (me.grow && me.rendered && me.getSizeModel().width.auto) {
            inputEl = me.inputEl;
            triggers = me.getTriggers();
            triggerWidth = 0;

            value = Ext.util.Format.htmlEncode(
                me.getGrowWidth() || (me.hasFocus ? '' : me.emptyText) || ''
            );

			//if(Ext.isEmpty(value))
            //value += me.growAppend;

            for (triggerId in triggers) {
                triggerWidth += triggers[triggerId].el.getWidth();
            }
            //width = value.length * 7.5;
			width = value.length * RamcoRTC.headerFontSize + 25;
			if(triggerWidth <=18)
				triggerWidth=0;
			else 
				triggerWidth = triggerWidth - 18;
			width = width + triggerWidth;  //+ me.inputWrap.getBorderWidth('lr') + me.triggerWrap.getBorderWidth('lr');
			width = Math.ceil(width);
            width = Math.min(Math.max(width, me.growMin), me.growMax);
            if(me.lastWidth != width){
				me.lastWidth = width;
	            me.bodyEl.setWidth(width);
    	        picker = me.picker;
				if (typeof me.getPicker == "function" && Ext.isEmpty(me.picker))
					 picker = me.getPicker();
					//me.updateLayout();
	            if (picker) {
	                picker.setWidth(width);
					var dropdown = picker.isHidden();
	                if (dropdown)
	                	me.collapse();
	                else
	                	me.expand();
	            }
	
	            me.fireEvent('autosize', me, width);
        	}
    	}
    },
	updateCtrlConfig:function(newValue, oldValue) {
		var me = this;
		if(Ext.isObject(newValue)) {			
			me.stp = newValue.stp;
			if(!Ext.isEmpty(me.stp) && me.inputEl)
				me.inputEl.dom.setAttribute("data-qtip", me.stp);			
		}
    }
});

// TECH-26873
Ext.define('Ext.o.tab.Panel', {
	override: 'Ext.tab.Panel',
	initComponent: function() {
		var me = this,
			height = me.height,
			cont = me.up("[region=center]"),
			mainCt	= cont && cont.up();		
		if (Ext.isEmpty(me.isResizable)) {
			if (!Ext.isEmpty(height)) {
				// TECH-27745
				// TECH-34598
				//height = height + (0.3 * height) + 30;
				//TECH-38699 / TECH-38690
				if(mainCt && mainCt.height){
					height  = mainCt.height - 4;
				}else{
					height = height + (0.2 * height);				
					if (me.tabPosition === "top" || me.tabPosition === "bottom") {
						height += 30;
					}
				}
				me.setHeight(height);
			}
		}
		me.callParent();
    }
});

Ext.define('Ext.o.form.field.TextArea', {
	override: 'Ext.form.field.TextArea',
	
	initComponent: function() {
		var me = this;
		me.height += 4;
		me.callParent();		
	},
	
	initEvents: function() {
		var me = this,
			height = me.getHeight();
		
		me.callParent();
		if (me.inputEl) {			
			me.inputEl.setHeight(height - 4);
		}		
	},
	
	setValue: function(b) {
		var me = this;
		me.callParent([b]);
		if (me.inputEl && me.inputEl.dom && me.readOnly == true) {
			// TECH-39243
			me.suspendEvents();
			me.inputEl.dom.selectionStart = 0;
			me.inputEl.dom.selectionEnd = 0;
			me.resumeEvents();
		}
    }
}); 
Ext.define("Ext.o.form.field.Date", {
    override: 'Ext.form.field.Date',
	initComponent: function() {
		var me = this;
		me.callParent();
		me.setDataType("date");
		me.altFormats = me.format = me.title = RamcoRTC.userPreference.dateFormat;
		me.formatText = 'Expected date time format '  + RamcoRTC.userPreference.dateFormatText;
		me.invalidText = " is not a valid date - it must be in the format {1}";
		me.startDay = RamcoRTC.userPreference.firstdayofweek; // TECH-36193
		if(RamcoRTC.settings.isNepali)
		   this.addPlugin({ ptype:'nepalidate'});
    },
	setRawValue: function(value) {
		if(!RamcoRTC.settings.isNepali){
			return this.callParent(arguments);
		}
        var me = this,
            rawValue = me.rawValue;

        if (!me.transformRawValue.$nullFn) {
            value = me.transformRawValue(value);
        }
		value = Ext.valueFrom(value, '');

		/* var convert = Ext.Date.convertToNepali(me.rawDate),
			dateFormatPattern = "%y-%m-%d",
			bsYear = convert.bsYear,
			bsMonth = convert.bsMonth,
			bsDate = convert.bsDate,
			rawDateText =  calendarData.bsDateFormat(dateFormatPattern, bsYear, bsMonth, bsDate); */
		if(me.xtype == "ramcotimefield"){
			if(Ext.isString(value))
				rawDateText = value;
			else
				rawDateText = Ext.util.Format.date(value, RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat);
		}
		else if(me.xtype == "ramcodatetimefield"){
			rawDateText = Ext.util.Format.date(value, RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.DateTimeFormat);
		}
		else{
			rawDateText =  Ext.util.Format.date(value, RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat);
		}
        if (rawValue === undefined || rawValue !== value) {
            me.rawValue = value;

            // Some Field subclasses may not render an inputEl
            if (me.inputEl) {
                me.bindChangeEvents(false);
                me.inputEl.dom.value = rawDateText;
				me.inputEl.rawValue = value;
                me.bindChangeEvents(true);
            }
        }

        if (me.rendered && me.reference) {
            me.publishState('rawValue', value);
        }

       return value;
    },
	/*
    beforeBlur: function(e) {
        var me = this,
			parseValue = '';
        if (me.xtype == "ramcotimefield") {
            value = me.getRawValue();
			me.setValue(value);				
			//me.fireEvent('timeblur',me, me.getValue());
        } else {
			value = me.getRawValue();
			if(me.isValid()) {
                me.setValue(value);
			}
			else {
				parseValue = this.parseSpecialData(me.itemId, value, this.format, "parse");
				parseValue = this.parseSpecialData(me.itemId, parseValue, this.format, "validate");
				parseValue = Ext.Date.parse(parseValue, me.format);
				if(!isNaN(Date.parse(parseValue))) {
					me.setValue(parseValue);
				}
				else
					return false;
			}
        }
    },
	*/
	getRawValue: function() {
		if(!RamcoRTC.settings.isNepali){
			return this.callParent();
		}
			
        var me = this,
			inputValue,
			nepaliDate,
			nepaliValue,
			rawDate,
			retDate;
		if(me.inputEl){
			inputValue = me.inputEl.getValue();
			if(!Ext.isEmpty(inputValue)){
				nepaliDate = calendarData.parseFormattedBsDateFromNum("%y-%m-%d",inputValue);
				if(me.inputEl.rawValue){
					if(me.xtype == "ramcotimefield"){
						rawDate = Ext.Date.parse(me.inputEl.rawValue,RamcoRTC.userPreference.timeFormat)
					}
					else if(me.xtype == "ramcodatetimefield"){
						rawDate = Ext.Date.parse(me.inputEl.rawValue,RamcoRTC.userPreference.dateTimeFormat)
					}
					else{
						rawDate = Ext.Date.parse(me.inputEl.rawValue,RamcoRTC.userPreference.dateFormat)
					}
					retDate = Ext.Date.convertToNepali(rawDate);
					if(retDate != nepaliDate) {
						retDate = calendarData.getAdDateByBsDate(nepaliDate.bsYear,nepaliDate.bsMonth,nepaliDate.bsDate);
					}
					rawDate.setFullYear(retDate.getFullYear());
					rawDate.setMonth(retDate.getMonth());
					rawDate.setDate(retDate.getDate());
					retDate = rawDate;
				}
				else
				{
					retDate = calendarData.getAdDateByBsDate(nepaliDate.bsYear,nepaliDate.bsMonth,nepaliDate.bsDate);
					nepaliValue = calendarData.bsDateFormatNum("%y-%m-%d",nepaliDate.bsYear,nepaliDate.bsMonth,nepaliDate.bsDate);
					inputValue = "1900-01-01" + inputValue.replace(nepaliValue,"");
					rawDate = Ext.Date.parse(inputValue,"Y-m-d H:i:s A");
					rawDate.setFullYear(retDate.getFullYear());
					rawDate.setMonth(retDate.getMonth());
					rawDate.setDate(retDate.getDate());
					retDate = rawDate;
				}
			}
			else{
				retDate = ''
			}
		}
		else 
			retDate = Ext.valueFrom(me.rawValue, '')
        me.rawValue = retDate;
        return retDate
    },
	valueToRaw: function (value) {
		return this.getUserFormatedValue(value);
	},
	getUserFormatedValue: function(value) {
		var me = this,
			i = me.altFormats, 
			m = me.altFormatsArray, 
			dataType = me.getDataType(),
			p = 0, j, l, newValue;
		if (Ext.isEmpty(value))
			return "";		
		if (Ext.isDate(value)) {
			//if(i && i.indexOf(this.format) > -1)
				return this.formatDate(value, this.format);
		}
		if(Ext.isString(value)) {
			if(value.indexOf('-') > -1 && RamcoRTC.userPreference.dateFormat != '-') {
				//newValue = new Date(value);
				if(dataType == "date") {
					newValue = Ext.Date.parse(value, "Y-m-d");//datechange
					//newValue = Ext.Date.parse(value + ' 00:00:00',  "Y-m-d H:i:s");
				}
				else if(dataType == "date-time") {
					newValue = Ext.Date.parse(value, "Y-m-d H:i:s");
				}
				if (!isNaN(Date.parse(newValue))) {
					return this.formatDate(newValue, this.format);
				}
			}
		}
		if(Ext.isString(value)) {
			var parseValue = this.parseSpecialData(me.itemId, value, this.format, "parse");
			return this.parseSpecialData(me.itemId, parseValue, this.format, "validate");
		}
    },
	parseSpecialData: function(_name, inputValue, format, calltype) {		
		try
        {				
			var me = this,
				ctrlName = viewName = _name,			
				retunValue = inputValue,						
				dataType = me.dataType,
				_DSep = RamcoRTC.prefs.DATESEPARATOR,
				_DateFmt =  RamcoRTC.prefs.DATEFORMAT,
				_timeformat = RamcoRTC.userPreference.timeFormat,
				_timeSeprator = RamcoRTC.prefs.TIMESEPARATOR,
				_now = new Date(),
				_tempData= [_now.getFullYear(), _now.getMonth() + 1, _now.getDate(), _now.getHours(), _now.getMinutes(), _now.getSeconds()],
				rawArr = inputValue.split(_DSep),
				_D, _M, _Y, _D1, _M1,_d,_m,_y,_DC,_MC,_YC,
				endType = [],
				endData = null,
				tval = '', _lastIndex = '',
				_datime = undefined;
			if(!rawArr)
				return inputValue;			
			if(!me && _name.indexOf("-") != -1) //multiline
			{
				if(_name.substring(0,2) == "Z_") //from zoom page
					_name = _name.substring(3);
					
				_lastIndex = _name.lastIndexOf("-");
				ctrlName = _name.substring(0, _lastIndex);
				viewName  = _name.substring(_lastIndex + 1);				
				if(!me)
					return retunValue;
			}			
			if(dataType == "date" || dataType == "date-time")
			{				
				_d = format.indexOf("d") == -1 ? format.indexOf("j") : format.indexOf("d");
				_m = format.indexOf("n") == -1 ? format.toLowerCase().indexOf("m") : format.indexOf("n");
				_y = format.toLowerCase().indexOf("y");			
				_DC = format.substring(_d, _d + 1);
				_MC = format.substring(_m, _m + 1);
				_YC = format.substring(_y, _y + 1);				
				switch(_DateFmt)
				{
					case "d/y/m":
						_d = 0;
						_y = 1;
						_m = 2;
						break
					case "d/m/y":
						_d = 0;
						_y = 2;
						_m = 1;
						break;
					case "m/d/y":
						_d = 1;
						_y = 2;
						_m = 0;
						break;
					case "m/y/d":
						_d = 2;
						_y = 1;
						_m = 0;
						break;
					case "y/d/m":
						_d = 1;
						_y = 0;
						_m = 2;
						break;
					default:
						_d = 2;
						_y = 0;
						_m = 1;
						break;
				}
				_D = rawArr[_d];
				_M = rawArr[_m];
				_Y = rawArr[_y];				
				if(!_D)
					_D = _tempData[2];
				if(!_M)
					_M = _tempData[1];
				if(!_Y)
					_Y = _tempData[0];				
				else if(dataType == "date-time")
				{
					endType = _DateFmt.split("/");
					endData = endType[2];
					switch(endData)
					{
						case "d":
							_datime = String(_D).split(" ");
							if(_datime)
								_D = _datime[0];
							break
						case "m":
							_datime = String(_M).split(" ");
							if(_datime)
								_M = _datime[0];
							break;
						case "y":
							_datime = String(_Y).split(" ");
							if(_datime)
								_Y = _datime[0];
							break;
					}
				}					
				if(calltype == "validate")
				{
					_D1 = parseInt(_D, 10);
					_M1 = parseInt(_M, 10);
					if(!isNaN(_D1) && (_D1 > 31 || _D1 < 1))
						return false;
					if(!isNaN(_M1) && (_M1 > 12 || _M1 < 1))
						return false;
				}	
				else
				{
					if(_DC == "d" && String(_D).length < 2)
						_D = Ext.String.leftPad(_D, 2, "0");
			
					if(_MC.toLowerCase() == "m" && String(_M).length < 2)
						_M = Ext.String.leftPad(_M, 2, "0");
			
					if(_YC == "Y" && String(_Y).length != 4)
					{
						_Y = parseInt(_Y, 10);
						if(isNaN(_Y))
							_Y = 0;
						
						if(_Y > 99)
							return;
							
						if(_Y < 50)
							_Y = 2000 + _Y;
						else	
							_Y = 1900 + _Y;
					}

					rawArr[_d] = _D;
					rawArr[_m] = _M;
					rawArr[_y] = _Y;
					retunValue = rawArr[0] + _DSep + rawArr[1]  + _DSep + rawArr[2]
                    if(dataType == "date-time")
					{						
	                    tval = _now.getHours() + _timeSeprator + _now.getMinutes() + _timeSeprator + _now.getSeconds();
	                    if (_datime)
	                    {
	                        if (_timeSeprator == " ") 
	                        {
	                            tval = (_datime[1] ? _datime[1] : _now.getHours()) + _timeSeprator + (_datime[2] ? _datime[2] : _now.getMinutes()) + _timeSeprator + (_datime[3] ? _datime[3] : _now.getSeconds());
	                            _datime[1] = null;
	                        }
	                        tval = _datime[1] ? _datime[1] : tval;
	                        if (_datime[2])
	                            tval += " " + _datime[2];
							
							if(_timeformat == "12-hour")
							{
								var timeArr = inputValue.split(' ');
								tval = timeArr[1] + " " + timeArr[2];
							}
	                    }
						retunValue += " " + this.parseSpecialTimeData(tval, format, calltype);
                    }
				}
			}
			else if(dataType == "time") {
			 	if (calltype == "validate") {
					retunValue = inputValue;
				}
				else {
			 		retunValue = this.parseSpecialTimeData(inputValue, format, calltype);
        		}
			}
        }
        catch(e){}
        return retunValue;
	},
	parseSpecialTimeData: function(inputValue, format, calltype) {
		try
	 	{
			if(Ext.isEmpty(inputValue))
				return "";
			var me = this,
				_timeformat = RamcoRTC.prefs.TIMEFORMAT,
				_timeSeprator = RamcoRTC.prefs.TIMESEPARATOR,
				_timeHr = RamcoRTC.prefs.TIMEHRSTYLE,
				_timeMin = RamcoRTC.prefs.TIMEMINSTYLE,
				_timeSec = RamcoRTC.prefs.TIMESECSTYLE,
				formatedval = inputValue.split(_timeSeprator),
				curTime = new Date(),
				h = parseInt(formatedval[0], 10) || 0,
				m = (formatedval[1]) ? parseInt(formatedval[1], 10) : curTime.getMinutes(),
				s = (formatedval[2]) ? parseInt(formatedval[2], 10) : curTime.getSeconds(),
				a = "";
			
			/* if(isNaN(h))
				h = 0;
			if(isNaN(m))
				m=0;
			if(m === 0 && s !== 0) {
				if (!RamcoRTC.settings.defaultZeroTimePadding) {
					var curTime = new Date(),
						m = curTime.getMinutes(),					
						s = curTime.getSeconds();
				}
			} */
			//TECH-40041
			if(RamcoRTC.settings.defaultZeroTimePadding === true)
				m=0;			
			if(_timeformat == "12-Hour")
			{	
				a = " AM";
				if(h > 12 && h < 24) {
					h = h - 12
					a = " PM";
				}
				else if(h == 12)			
					a = " PM";			
				if(h == 0 || h == 24) {
					h = 12;
					a = " AM";
				}
			}
			if(_timeHr == "hh" && h < 10)
				h = "0" + h + "";
			if(m < 10)
				m = "0" + m + "";			
			inputValue = h + _timeSeprator + m;			
			if(_timeSec != "none")
			{
				//TECH-40041
				if (RamcoRTC.settings.defaultZeroTimePadding === true) {
					s = 0;
				}
				
				if(isNaN(s)) {
					s = 0;
				}
				if(s < 10)
					s = "0" + s + "";					
				inputValue += _timeSeprator + s;
			}
			inputValue += a;			
		}
		catch(e){}
		return inputValue;
    }
});

/*
Ext.define('Ext.o.menu.Menu', {
    override : 'Ext.menu.Menu',
	hideMode :'display',
    onClick: function(e) {
        var me = this,
            type = e.type,
            item,
            clickResult,
            iskeyEvent = type === 'keydown';

        if (me.disabled) {
            e.stopEvent();
            return;
        }
        item = me.getItemFromEvent(e);
        if (item && item.isMenuItem) {
            if (item.leaf) {
                clickResult = item.onClick(e);
            } else {
                e.stopEvent();
            }

            // SPACE and ENTER invokes the menu
            if (item.menu && clickResult !== false) {
                item.expandMenu(e, 0);
            }
        }
        // Click event may be fired without an item, so we need a second check
        if (!item || item.disabled) {
            item = undefined;
        }
        me.fireEvent('click', me, item, e);
    },
    onMouseOver: function(e) {
        var me = this,
            fromEl = e.getRelatedTarget(),
            mouseEnter = !me.el.contains(fromEl),
            item = me.getItemFromEvent(e),
            parentMenu = me.parentMenu,
            ownerCmp = me.ownerCmp;

        if (mouseEnter && parentMenu) {
            parentMenu.setActiveItem(ownerCmp);
            ownerCmp.cancelDeferHide();
            parentMenu.mouseMonitor.mouseenter();
        }

        if (me.disabled) {
            return;
        }

        // Do not activate the item if the mouseover was within the item, and it's already active
        if (item) {
            if (!item.containsFocus) {
                item.focus();
            }
            // This will not be needed here!
            //if (item.expandMenu) {
                //item.expandMenu(e);
            //}
        }
        if (mouseEnter) {
            me.fireEvent('mouseenter', me, e);
        }
        me.fireEvent('mouseover', me, item, e);
    }
});
*/
//Rating Control
Ext.define('Ext.ramco.Rating', {
    extend: 'Ext.form.field.Base',
    xtype: 'ramcorating',
    requires: [
        'Ext.util.KeyNav'
    ],
    mouseWheelEnabled: true,
    value: 0,
    minValue: 0,
    maxValue: 0,
    step: 1,
    boxType: 'star',
    defaultBindProperty: 'value',
    ariaRole: 'rating',
    focusable: true,
    needArrowKeys: true,
    tabIndex: 0,
    fieldCls: Ext.baseCSSPrefix + 'rating-field',
    overCls: Ext.baseCSSPrefix + 'rating-over',
    focusCls: 'rating-focus',
    starCls: Ext.baseCSSPrefix + 'rating-star',
    boxCls: Ext.baseCSSPrefix + 'rating-box',
    boxChar: '■',
    starChar: '★',
    gray: '#ccc',
    showValue: true,
    colors: ['#bf3f3f', '#bfbf3f', '#7fbf3f', '#3fbf3f', '#3fbf7f', '#3fbfbf', '#3f7fbf', '#3f3fbf', '#7f3fbf', '#bf3fbf', '#82076c'],
    childEls: [
        'disValue', 'ratingTrack', 'ratingValue', 'ratingWrap'
    ],
    fieldSubTpl: [
        '<div id="{id}" data-ref="inputEl" {inputAttrTpl}',
        ' class="', Ext.baseCSSPrefix, 'rating {fieldCls} {vertical}',
        '{childElCls}"',
        '<tpl if="tabIdx != null"> tabindex="{tabIdx}"</tpl>',
        '<tpl foreach="inputElAriaAttributes"> {$}="{.}"</tpl>',
        '>',
        '<div id="{cmpId}-ratingWrap" data-ref="ratingWrap" class="' + Ext.baseCSSPrefix + 'rating-inner" role="presentation">',
        '<tpl if="hasStar">',
        '<div class="' + Ext.baseCSSPrefix + 'rating-star">',
        '<div id="{cmpId}-ratingValue" data-ref="ratingValue" class="' + Ext.baseCSSPrefix + 'rating-value">{items}</div>',
        '<div id="{cmpId}-ratingTrack" data-ref="ratingTrack" class="' + Ext.baseCSSPrefix + 'rating-track">{items}</div>',
        '</div>',
        '<tpl else>',
        '<ui id="{cmpId}-ratingValue" data-ref="ratingValue" class="' + Ext.baseCSSPrefix + 'rating-box" role="presentation">',
		'<li role="option" unselectable="on" class="' + Ext.baseCSSPrefix + 'rating-emptybox" value="0"></li>',
        '<tpl for="items">',
        '<li role="option" unselectable="on" class="' + Ext.baseCSSPrefix + 'rating-box-{value}" value="{value}"></li>',
        '</tpl>',
        '</ui>',
        '</tpl>',
        '<span id="{cmpId}-disValue" data-ref="disValue" class="' + Ext.baseCSSPrefix + 'rating-text">{value}</span>',
        '</div>',
        '</div>', {
            disableFormats: true
        }
    ],
    initComponent: function() {
        var me = this;
        me.items = [];
        me.callParent();
    },
    initValue: function() {
        var me = this,
            extValueFrom = Ext.valueFrom,
            min = extValueFrom(me.minValue, 0),
            max = extValueFrom(me.maxValue, 0),
			stpCnt = min,
            value = parseFloat(extValueFrom(me.value, min)),
            boxType = me.boxType;
        if (isNaN(value))
            value = me.minValue;
        // Store for use in dirty check
        me.originalValue = value;
        me.value = value;
		me.items = [];
		if(me.step <= 0) {
			console.log('step value cannot be zero');
			return;
		}
        for (; stpCnt < max;) {
			stpCnt = stpCnt + me.step;
            if (boxType == "star")
                me.items.push(me.starChar);
            else {
                me.items.push({
					value: stpCnt
                });
			}
        }
		me.setWidth(20 * (((max - min) / me.step) + 1));
    },
	setFormat:function(format){
		this.format = format;
	},
	getFormat:function(){
		return this.format;
	},

    getSubTplData: function(fieldData) {
        var me = this,
            data,
            boxType = me.boxType;
        data = me.callParent([fieldData]);
        if (boxType == "star") {
            data.hasStar = true;
            data.itemCls = me.starCls;
            data.items = me.items.join('');
        } else {
            data.itemCls = me.boxCls;
            data.items = me.items;
        }
        data.value = me.value;
        ariaAttr = data.inputElAriaAttributes;
        if (ariaAttr) {
            ariaAttr['aria-valuemin'] = me.minValue;
            ariaAttr['aria-valuemax'] = me.maxValue;
            ariaAttr['aria-valuenow'] = me.value;
        }
        return data;
    },
    initEvents: function() {
        var me = this;

        me.callParent();

        me.mon(me.inputEl, {
            scope: me,
            click: me.onClick,
            mousemove: me.onMouseMove,
            mouseenter: me.onMouseEnter,
            mouseleave: me.onMouseLeave,
            keydown: me.onKeyDown
        });
        if (!me.showValue) {
            me.disValue.setVisibilityMode(2);
            me.disValue.hide();
        }
    },
	onClick: function(evt) {
        var me = this,
            ariaDom = me.ariaEl.dom,
			value = me.valueFromEvent(evt);
		// IMU-194 / TECH-27455 - Star rating
		if (isNaN(value))
            value = me.minValue;
        if (value !== me.value && me.fireEvent('beforechange', me, value, me.value) !== false) {
            // TECH-30335
			//me.value = value;
            if (me.rendered) {
                me.showSelection(value);
                if (ariaDom) {
                    ariaDom.setAttribute('aria-valuenow', value);
                }
				//TECH-33507 /MPTP-208
				me.value = value;
                me.fireEvent('change', me, value, me.originalValue);
                me.checkDirty();
            }
			// TECH-30335 
			//TECH-33507 /MPTP-208
			me.originalValue = value;
        }
		
        //this.setValue(value);
    },

    onMouseEnter: function() {
        this.el.addCls(this.overCls);
        this.showSelection(this.value);
    },

    onMouseLeave: function() {
        this.el.removeCls(this.overCls);
        this.showSelection(this.value);
    },

    onMouseMove: function(evt) {
        var value = this.valueFromEvent(evt);
        this.showSelection(value);
    },
    showSelection: function(value) {
        var me = this,
            valueEl = me.ratingValue,
            spanEl = me.disValue,
            value = parseFloat(value),
            i = 0,
            len = 0,
            ch,
            el;

        if (isNaN(value))
            value = me.minValue;
        if (valueEl) {
            if (me.boxType == "star") {
                valueEl.setStyle('width', me.valueToPercent(value));
            } else {
                ch = valueEl.query('li', false);
                i = 1;
				stpCnt = 0;
                len = ch.length;
                for (; i < len; i++, stpCnt+=me.step) {
                    el = ch[i];
                    el.setStyle('background-color', me.gray);
                    if (stpCnt < value)
                        el.setStyle('background-color', me.colors[i]);

                }
            }
        }
        if (spanEl) {
            spanEl.setText(value);
            /*if(me.boxType == "star"){
            	spanEl.setVisibilityMode(2);
            	spanEl.hide();
            }*/
        }
    },
    afterRender: function() {
        var me = this;
        me.callParent();
        me.showSelection(me.value);
    },
    onKeyDown: function(e) {
        var me = this,
            k, val;

        k = e.getKey();

        /*
         * The behaviour for keyboard handling with multiple thumbs is currently undefined.
         * There's no real sane default for it, so leave it like this until we come up
         * with a better way of doing it.
         */
        if (me.disabled) {
            e.preventDefault();
            return;
        }

        switch (k) {
            case e.UP:
            case e.RIGHT:
                val = e.ctrlKey ? me.maxValue : me.getValue() + me.step;
                break;

            case e.DOWN:
            case e.LEFT:
                val = e.ctrlKey ? me.minValue : me.getValue() - me.step;
                break;

            case e.HOME:
                val = me.minValue;
                break;

            case e.END:
                val = me.maxValue;
                break;
        }

        if (val !== undefined) {
            e.stopEvent();
            if (val > me.maxValue || val < me.minValue)
                return;
            me.setValue(val);


        }
    },
    valueFromEvent: function(evt) {
        var me = this,
            el = me.inputEl,
            ex = evt.getX(),
            rounding = me.step,
            cx = el.getX(),
            x = ex - cx,
            w = el.getWidth(),
            limit = me.maxValue,
			trgEle = evt.getTarget(),
			trgValue = 0,
            v;

		if (me.boxType != "star"){
			if(trgEle.hasAttribute("value")) {
				v = parseInt(trgEle.getAttribute("value"));
				return v;
			}
			else { 
				return me.getValue();			
			}
		}

        if (me.getInherited().rtl) {
            x = w - x;
        }
        if (x < 10)
            x = 0;

        v = (x / w * limit)+0.5;
		v = (v > me.maxValue)?me.maxValue:v;

        // We have to round up here so that the area we are over is considered
        // the value.
        v = Math.ceil(v / rounding) * rounding;

        return v;
    },
    getValue: function() {
        return this.value;
    },
	updateRdData: function() {
		var me = this,
			starValues;
		if(me.boxType == "star") {
			starValues = me.items.join('');		
			me.ratingValue.dom.innerText = starValues;
			me.ratingTrack.dom.innerText = starValues;
		}
		else {
			me.tpl = new Ext.XTemplate(
                '<li role="option" unselectable="on" class="' + Ext.baseCSSPrefix + 'rating-emptybox" value="0"></li>',
				'<tpl for="items">',
					'<li role="option" unselectable="on" class="' + Ext.baseCSSPrefix + 'rating-box-{value}" value="{value}"></li>',        
                '</tpl>'
            );
			me.tpl.overwrite(me.ratingValue, {items: me.items});			
		}
	},
    setValue: function(value) {
		if (Ext.isEmpty(value))
			return;
		// IMU-194 / TECH-27455 - Star rating
        var me = this;
		if(value.rdData && value.rdData.length > 0) {
			me.step = parseFloat(value.stpv);
			me.minValue = parseFloat(value.rdData[0].minval);
			me.maxValue = parseFloat(value.rdData[0].maxval);
			value = parseFloat(value.endv);
			me.initField();
			me.updateRdData();
		}
		else {
			value = value.value || value;
			value = parseFloat(value);
		}
		
		// IMU-194 / TECH-30335
		if (!Ext.isEmpty(value))
			me.showSelection(value);
        return me;
    },
	getEndValue: function() {
		return this.value;
	},	
    valueToPercent: function(value) {
        if (value > 0)
			value = (value / this.maxValue) * 100;
        return value + '%';
    }
})

//Marquee Control
Ext.define('Ext.ramco.Marquee', {
    extend: "Ext.Component",
    alias: "widget.marquee",
    baseCls: 'x-ticker',
    config: {
        textRotation: -90,
        animateInterval: 30,
        direction: 'left',
        speed: 1,
        pauseOnMouseOver: true,
        messageOnClick: null
    },

    autoStart: true,
    messages: [],
    tickerTextWidth: 0,
    status: 'stop',
    ownerSize: {
        width: 0,
        height: 0
    },
    task: {},
    currentIndex: -1,
    childEls: [
        'contentEl'
    ],
    renderTpl: '<span id="{id}-contentEl" data-ref="contentEl" unselectable="on"></span>',
    initComponent: function() {
        var me = this;
        me.callParent();
        me.task = {
            interval: this.getAnimateInterval(),
            scope: this
        };
        me.setPosInfo();
    },
    initEvents: function() {
        if (this.contentEl) {
            // Mouse over stop ticking
            this.contentEl.on('mouseover', function() {
                if (this.pauseOnMouseOver) {
                    this.speed_save = this.speed;
                    this.speed = 0;
                }
            }, this);

            // Mouse out - resume
            this.contentEl.on('mouseout', function() {
                this.pauseOnMouseOver && (this.speed = this.speed_save);
            }, this);
            this.contentEl.setStyle(this.posInfo);
            this.tickerTextWidth = this.contentEl.getTextWidth();
            this.initMessagePos();
            this.left = this.contentEl.getLeft();
            if (this.autoStart) {
                this.status = 'play';
                Ext.TaskManager.start(this.task);
            }
        }
    },
    getStatus: function() {
        return this.status;
    },

    setDirection: function(direction) {
        if (this.direction == 'up' || this.direction == 'down') {
            if (direction == 'left' || direction == 'right')
                return this;
        } else if (this.direction == 'left' || this.direction == 'right') {
            if (direction == 'up' || direction == 'down')
                return this;
        }

        this.direction = direction;

        (direction == 'up' || direction == 'down') && (this.setHeight('100%'));

        // Update the new directional scrolling
        this.rendered && this.setPosInfo();

        return this;
    },

    setTextRotation: function(degree) {
        if (Ext.isNumeric(degree)) {

            if (parseInt(degree, 10) == this.textRotation)
                return this;

            this.textRotation = degree;
            if (this.rendered) {
                this.setPosInfo();
                this.contentEl = this.contentEl.destroy();
                this.setMessages(this.currentMessages);
            }
            return this;
        }
        return null;
    },
    setPosInfo: function() {
        var posInfo;
        switch (this.direction) {
            case "left":
            case "right":
                posInfo = {
                    left: '100%',
                    display: 'block',
                    "white-space": "nowrap"
                };
                this.task.run = this.scroller.horz;
                break;
            case "up":
            case "down":
                posInfo = {
                    top: this.height || this.el.getHeight(),
                    "white-space": "nowrap",
                    display: 'block',
                    "-webkit-transform": "rotate(" + this.textRotation + "deg)",
                    "-moz-transform": "rotate(" + this.textRotation + "deg)",
                    "-ms-transform": "rotate(" + this.textRotation + "deg)",
                    "-o-transform": "rotate(" + this.textRotation + "deg)"
                };
                this.task.run = this.scroller.vert;
                break;
        }
        posInfo.position = 'absolute';

        this.posInfo = posInfo;
    },


    setAnimateInterval: function(interval) {
        if (interval) {
            this.animateInterval = interval;
            this.task && (this.task.interval = this.getAnimateInterval());
        }
    },

    setMessages: function(msgs) {
        this.messages = msgs;
        if (this.rendered && this.contentEl && msgs.length > 0) {
            var txt = this.messages[0].split("#~#");
            //lblNewTicker
			if (!Ext.isEmpty(txt)) {
				if (txt.length > 1)
					this.contentEl.update(txt[1]);
				else
					this.contentEl.update(txt[0]);
				this.tickerTextWidth = this.contentEl.getTextWidth();
			}
        }
    },

    beforeRender: function() {

        this.ownerCt.on('resize', function(container) {
            this.ownerSize = container.getSize();
        }, this);

    },

    afterRender: function() {
        this.callParent(arguments);
        this.ownerSize = this.ownerCt.getSize();
    },
    initMessagePos: function() {

        if (!this.contentEl)
            return;
        var left = null,
            top = null;
        switch (this.direction) {
            case 'left':
                left = this.getBox().width;
                break;
            case 'right':
                left = -this.tickerTextWidth;
                break;
            case 'up':
                top = (this.textRotation == -90) ? this.tickerTextWidth + this.ownerSize.height : this.ownerSize.height;
                break;
            case 'down':
                top = (this.textRotation == -90) ? 0 : -(this.tickerTextWidth + this.ownerSize.height);
                break;
        }

        Ext.isNumber(left) && this.contentEl.setLeft(left);
        Ext.isNumber(top) && this.contentEl.setTop(top);
    },

    pause: function() {
        if (this.task) {
            Ext.TaskManager.stop(this.task);
            this.status = 'pause';
        }
    },
    stop: function(removeCache) {
        if (this.task) {
            Ext.TaskManager.stop(this.task);
            this.status = 'stop';
        }

        (this.contentEl) && (this.contentEl.update(''));

        if(removeCache) {
			this.currentMessages = '';
			this.newMessages = '';
		}
    },
    start: function(opts) {
        if (this.rendered) {
            // Start the animateInterval call - this just resumes the scroller
            Ext.TaskManager.start(this.task);
            this.status = 'play';
        }
    },

    onDestroy: function() {
        if (this.task) {
            Ext.TaskManager.stop(this.task);
        }
        this.callParent(arguments);
    },

    scroller: {
        horz: function() {
            if (!this.contentEl)
                return;
			if(Ext.isEmpty(this.messages) || this.messages.length == 0)
				return;
            var contentEl = this.contentEl;
            var nextIndex = this.currentIndex + 1
            if (nextIndex >= this.messages.length)
                nextIndex = 0;
            if (this.direction == 'left') {
                if (this.left <= -this.tickerTextWidth) {
                    this.currentIndex = nextIndex;
                    var txt = "";
					if (!Ext.isEmpty(this.messages[nextIndex])) {
						txt = this.messages[nextIndex].split("#~#");
					}
					if (!Ext.isEmpty(txt)) {
						if (txt.length > 1)
							this.contentEl.update(txt[1]);
						else
							this.contentEl.update(txt[0]);
						this.tickerTextWidth = this.contentEl.getTextWidth();
					}
					
                    this.left = this.getSize().width;
                } else {
                    this.left -= this.speed;
                }
            } else {
                if (this.left >= this.getBox().width) {
                    this.left = -this.tickerTextWidth;
                } else {
                    this.left += this.speed;
                }
            }
            //contentEl.setLeft(this.left);
            contentEl.setStyle({
                transform: 'translate3d(' + this.left + 'px, 0, 0)'
            });
        },

        vert: function() {
			if(Ext.isEmpty(this.messages) || this.messages.length == 0)
				return;
            var contentEl = this.contentEl;
            var top = contentEl.getTop(true);
            if (this.direction == 'up') {
                if (this.textRotation == -90) {
                    if (top <= 0) {
                        top = (this.tickerTextWidth + this.ownerSize.height);
                    } else {
                        top -= this.speed;
                    }
                } else {
                    if (top <= -(this.tickerTextWidth)) {
                        // Start from the bottom
                        top = this.ownerSize.height;
                    } else {
                        top -= this.speed;
                    }
                }
            } else {
                if (this.textRotation == -90) {
                    if (top >= (this.tickerTextWidth + this.ownerSize.height)) {
                        top = 0;
                    } else {
                        top += this.speed;
                    }
                } else {
                    if (top >= this.ownerSize.height) {
                        top = -(this.tickerTextWidth + this.ownerSize.height);
                    } else {
                        top += this.speed;
                    }
                }
            }
            contentEl.setTop(top);
        }
    }
});
// MaskTextField Control
Ext.define('Ext.ramco.field.MaskField', {
    extend: 'Ext.form.field.Text',
    alias: 'widget.ramcomaskfield',
    focusable: true,
    isAssorted: false,
    tplId: null,
    grow: false,
    growToLongestValue: true,
    forceSelection: true,
    visibleLength: 10,
	focusIn: false,
	valueChanged: false,
    dataType: 'string',
    cls: 'x-form-display-field',
    config: {
        helpIcon: false,
        expandIcon: false,
        searchIcon: false,
        dataPrec: null,
        format: null,
		ctrlConfig: null,
        dataType: 'string'
    },    
    focusCls: 'form-display-focus',	
    initEvents: function() {
        var me = this,
            onClick = me.onClick,
            inputEl = me.inputEl,
            contextmenu = me.onContextmenu,
			onTxtBlur = me.onTxtBlur,
            onTxtFocus = me.onTxtFocus,
            cstCls = me.getCustomCls();
		if(me.lookupViewModel()) {
			me.setBind({
				ctrlConfig: "{" + me.itemId + ".addlProps}"
			});	
		}
        if (inputEl) {
            me.mon(inputEl, 'blur', onTxtBlur, me);
            //me.mon(inputEl, 'contextmenu', contextmenu, me);
            me.mon(inputEl, 'focus', onTxtFocus, me);
        }
        if (!Ext.isEmpty(cstCls)) {
            inputEl.addCls(me.getClsName(cstCls));
        }
        me.callParent();
    },
    onTxtFocus: function(e) {
        var me = this,
            val = null,
            ellipse = null;
        if (e && e.keyCode == 113 && e.event.key.toUpperCase() == "F2") {
			me.onShowEllipseWindow(e);
        }
		// TECH-27457 - When focusing masked control
		if (me.focusIn === false && !Ext.isEmpty(me.valueJson)) {
			me.setValue(me.valueJson.value);
			me.focusIn = true;
		}
    },
	onShowEllipseWindow: function(e) {
		// TECH-26067
		var me = this,ellipse,val;
		if (me.itemId == "ellipseText" || me.getItemId() == 'cmbActSearch')
			return false;
		val = me.getValue();
		ellipse = Ext.create('Ext.ramco.Ellipse', {
			scrollable: false,
			hidden: true,
			modal: true
		});
		if (RamcoRTC.settings.ellipseSize && Object.keys(RamcoRTC.settings.ellipseSize).length > 0 && parseInt(RamcoRTC.settings.ellipseSize.height) > 0 && parseInt(RamcoRTC.settings.ellipseSize.width) > 0) {//AHBG-26068
			if (parseInt(RamcoRTC.settings.ellipseSize.width) > 0) {
				ellipse.setWidth(RamcoRTC.settings.ellipseSize.width);
				ellipse.ellipseText.setWidth(RamcoRTC.settings.ellipseSize.width);
			}
			if (parseInt(RamcoRTC.settings.ellipseSize.height) > 0)
				ellipse.setHeight(RamcoRTC.settings.ellipseSize.height);
		}
		if (!me.readOnly && me.xtype != 'ramcolabel' && me.xtype != 'label')
			ellipse.ellipseText.setReadOnly(false);
		ellipse.showBy(me);
		ellipse.body.setHeight(ellipse.body.getHeight() + 20);
		ellipse.setHeight((ellipse.getHeight() < 120) ? ellipse.getHeight() + 20 : 120);
		ellipse.ascCtrl = me;
		ellipse.ellipseText.setValue(val);
		//ellipse.showBy(me);
		e.stopEvent();
	},
    onTxtBlur: function(e) {
		var me = this,
			inpValue = me.getValue(),
			encVlaue = '',
			ascJSON, ascJSONValue, // TECH-28214
			view = me.up('ilbo');
		// TECH-27457 - When focusing masked control
		if (!Ext.isEmpty(me.valueJson)) {
			me.valueJson[me.dataCol] = inpValue;
			encVlaue = Ext.encode(me.valueJson, true);
			
			// TECH-28214
			// view.setControlData(me.ascCtrl, me.ascCtrl, 0, inpValue);
			ascJSON = Ext.decode(encVlaue, true);
			delete ascJSON["value"];
			ascJSONValue = Ext.encode(ascJSON, true);
			view.setControlData(me.ascCtrl, me.ascCtrl, 0, ascJSONValue);

			me.setValue(encVlaue);
			me.focusIn = false;
			// TECH-27904
			// me.valueChanged = false;
		}

		// TECH-27904
		me.valueChanged = false;
	},
	onContextmenu: function(e) {
        var me = this;
        args = [];
        args = ['contextmenu', me, e];
        me.fireEvent.apply(me, args);
    },    
    getDataType: function() {
        return this.dataType;
    },
    setDataType: function(value) {
        this.dataType = value;
    },
    getFormat: function(format) {
        return this.format;
    },
    setFormat: function(format) {
        this.format = format;
        this.title = format;
        //if (format && this.xtype == 'numberfield')
			this.setValue(this.getValue());
    },
	updateCtrlConfig:function(newValue, oldValue) {
		var me = this;
		if(Ext.isObject(newValue)) {
			if(!Ext.isEmpty(newValue.ft)){
				me.format = newValue.ft;
				me.title = newValue.ft;
			}
			me.stp = newValue.stp;
			if(!Ext.isEmpty(me.stp) && me.inputEl)
				me.inputEl.dom.setAttribute("data-qtip", me.stp);
			me.setValue(newValue.value);			
		}
	},
    setValue: function(value) {
        var me = this,
            dataType = me.getDataType() || '',
			key,
            format = me.getFormat(),
			view = me.up('ilbo'),
			isFrmTemplate = false;
            returnValue = value;
		// TECH-28214
		// if (me.valueChanged === false && Ext.isEmpty(value)) {
		if (me.valueChanged === false && (Ext.isEmpty(value) || Ext.isEmpty(me.valueJson))) {
			value = view.getControlData(me.ascCtrl);
		}
        if (!Ext.isEmpty(value) && Ext.isString(value) && value.indexOf('{') == 0) {
            var valueJson = Ext.decode(value, true),
                templateID,
                xTpl;
            if (valueJson && view) {
                templateID = valueJson.tplid || me.tplId;
                //xTpl = view.getTemplate(templateID);
				if (me.isAssorted && me.tplView && value) {
					/* var tplVal = Ext.decode(value, true);
					if (tplVal) */
						templateID = valueJson["v" + me.tplView];
				}
				xTpl = view.getTemplate(templateID, templateID == me.tplId);
				//if(me.hasMasking && xTpl){
				if (me.hasMasking){
					var rep,val,req,regRep,regCol,value,
						data =  {}, tmpTpl = me.tpl;
					 tmpTpl	= new Ext.XTemplate(tmpTpl);
					 //data = Ext.decode(value,true);
					 data = valueJson;
					 regRep = me.regRep;
					 regCol = me.regCol;
					 rep = data[regRep];
					 val = data[regCol];
					 try{
						req = new RegExp(val, 'g');
					 }catch(e){
						 req = new RegExp(".", 'g');
					 }
					 data.value = value = data[me.dataCol];
					 me.valueJson = data;
					 if(Ext.isEmpty(value)){
						 value = "";
					 }
					 value = value.replace(req,rep);
					 data[me.dataCol] = value;
					 //value = tmpTpl.apply(data);
				}
                else if (xTpl && xTpl.isTemplate) {
                    if (me.isAssorted)
                        valueJson = me.setPref(valueJson);
                    value = xTpl.apply(valueJson);
                    value = value.replace(/ on\w+="[^"]*"/g, '');
                    me.focusable = false;
					isFrmTemplate = true;
					me.isFrmTemplate = true;
                } else {                    
					returnValue = [];
					for(key in valueJson){
						returnValue.push(valueJson[key]);	
					}
					value= returnValue.join(" ");
                }
            }
        }
		else if (value) {
			var _dataType = dataType.toLowerCase(), dateVal;
			if ( _dataType == 'date') {
				//dateVal = Ext.Date.parse(value + ' 00:00:00',  "Y-m-d H:i:s");
				dateVal = Ext.Date.parse(value,  "Y-m-d");//datechange
			}
			if ( _dataType == 'time') {
				dateVal = Ext.Date.parse('1900-01-01 ' + value, "Y-m-d H:i:s");
			}
			if ( _dataType == 'date-time') {
				dateVal = Ext.Date.parse(value, "Y-m-d H:i:s");
			}
            switch (_dataType) {
                case "date":
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat;
					value = Ext.util.Format.date(dateVal, format);
					break;
                case "date-time":
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat;
                    value = Ext.util.Format.date(dateVal, format);
                    break;
                case "time":
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat;                    
					value = Ext.util.Format.date(dateVal, format);
                    break;
                case "float":
                case "double":
                case "numeric":
                case "int":
                case "integer":
                case "long":
                    value = me.formatNumeric(value, format);
                    break;
                default:
            }
        }
        if (me.rendered && value && (!me.visibleLength || me.visibleLength == 0)) {
			// TECH-38395
			 //me.inputEl.setStyle('display','inline !important');
			 if(!isFrmTemplate && !me.isFrmTemplate){
				var v = Ext.util.Format.stripTags(value),
				    //w= v.length * 6.5 + 22,
					//w = v.length * RamcoRTC.headerFontSize + 22,
					w = v.length * RamcoRTC.headerFontSize + 25,
				    cw = me.getWidth();
				if(v.length <= 0){
					me.inputEl.setWidth('100%');
					me.inputEl.setStyle('display','block');
				}
				else if(cw <= 0) {
					me.inputEl.setWidth('100%');
					// TECH-38395
					me.inputEl.setStyle('display','inline');
				}
				else if(cw <= 0) {
					me.inputEl.setWidth('100%');
					me.inputEl.setStyle('display','block');
				}
				else {
					me.inputEl.setWidth(cw);    
					// TECH-38395
					me.inputEl.setStyle('display','inline');
				}
			 }
			 else{
				me.inputEl.setWidth('100%');
				me.inputEl.setStyle('display','block');
			 }            
        }
        me.suspendEvents();
		me.suspendLayouts();
        me.setRawValue(me.valueToRaw(value));
        me.mixins.field.setValue.call(me, value);
		me.resumeLayouts(true);
        me.resumeEvents();
    },
    setPref: function(value) {
        var me = this,
            val = null,
            decSep, digGrp,
            dataType = null,
			dateVal,
            format = null,
            num,
			returnVal = {}, replaceVal = '',
            formatObj = me.getFormat();
			if (!Ext.isEmpty(formatObj))
				formatObj = Ext.decode(formatObj, true);
        for (var itm in value) {
            val = value[itm];
			replaceVal = itm.replace('v', '');
            dataType = formatObj[itm];
			returnVal[replaceVal] = val;
            switch (dataType["dType"]) {
                case "date":
                    format = RamcoRTC.userPreference.dateFormat;
					//dateVal = Ext.Date.parse(val + ' 00:00:00',  "Y-m-d H:i:s");
					dateVal = Ext.Date.parse(val,  "Y-m-d");//datechange
					returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
					break;
                case "date-time":
                    format = RamcoRTC.userPreference.dateTimeFormat;
					dateVal = Ext.Date.parse(val, "Y-m-d H:i:s");
                    returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
                    break;
                case "time":
                    format = RamcoRTC.userPreference.timeFormat;                    
					dateVal = Ext.Date.parse('1900-01-01 ' + val, "Y-m-d H:i:s");
					returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
                    break;
                case "float":
                case "double":
                case "numeric":
                case "int":
                case "integer":
                case "long":
                    returnVal[replaceVal] = me.formatNumeric(val, dataType['prec']);
                    break;
				default:
                    returnVal[replaceVal] = val;
                    break;
            }
        }
        return returnVal;
    },
    formatNumeric: function(value, dataType) {
		if(Ext.isEmpty(value))
			return "";
        var tempNum = '999999999999999999',
			n1, n2, num, num1,num2;
        dataType = dataType ? parseInt(dataType, 10) : 0;
        if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "no grouping") {
            format = '9.' + tempNum.substring(0, dataType)
        } else {
            format = '9,9.' + tempNum.substring(0, dataType)
        }
        Ext.util.Format.thousandSeparator = RamcoRTC.userPreference.numgroupsymbol;
        Ext.util.Format.decimalSeparator = RamcoRTC.userPreference.decimalseparator;
		
		 var numGroupStyle = RamcoRTC.userPreference.numgroupstyle.toLowerCase();
		if (!Ext.isEmpty(numGroupStyle) && numGroupStyle != 'no grouping') {//TECH-33327
			num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
			if (numGroupStyle == "lakh based")
				n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			else if (numGroupStyle == "million based")
				n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			
			num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
		}else{
			if (dataType == null || dataType == 0){
				num = Ext.util.Format.number(value, "0");
			}
			else{
				num = Ext.util.Format.number(value, format);
			}
		}
	    /* if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "lakh based") {
            num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
            n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        }else if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "million based") {//TECH-33327
         	num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
	       // n1 = n1[0].replace(/(?<!\.)(\d)(?=(\d{3})+(\.|$))/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
	        n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        } else {
			if (dataType == null || dataType == 0)
				num = Ext.util.Format.number(value, "0");
			else
            num = Ext.util.Format.number(value, format);
        } */
        var neg = false;
		if(Ext.isNumber(num))//TECH-33327
			num = num.toString();
        if (num.indexOf('-') != -1)
            neg = true;
        if (neg) {
            var numNegStyle = RamcoRTC.userPreference.numnegativestle;
            switch (numNegStyle) {
                case "(1.1)":
                    num = "(" + num.replace("-", "") + ")";
                    break;

                case "- 1.1":
                    num = num.replace("-", "- ");
                    break;

                case "1.1-":
                    num = num.replace("-", "") + "-";
                    break;

                case "1.1 -":
                    num = num.replace("-", "") + " -";
                    break;

                case "()1.1":
                    num = "()" + num.replace("-", "");
                    break;

                case "(-)1.1":
                    num = "(-)" + num.replace("-", "");
                    break;
                default:
                    num = "-" + num.replace("-", "");
                    break;
            }
        }
        return num;
    },
    afterRender: function() {
        var me = this;
        me.callParent();
        me.sizeControl();
    },
    sizeControl: function() {
        var me = this,
            //value = null,
            dataType = me.getDataType(),
            growAppend = 'W';
        /*if (me.width)
            return;

        value = Ext.util.Format.htmlEncode(
            (me.hasFocus ? '' : me.emptyText) || ''
        );
		*/
		if(me.rendered){
	        if (dataType == 'date'){
				if (RamcoRTC.settings.enforceDateWidth == false)
	            me.visibleLength = 11;
				if(me.visibleLength === 0){
					me.setWidth('90%');
					return;
				}
			}
	        else if (dataType == 'date-time'){
	            if (RamcoRTC.settings.enforceDateWidth == false)
	            me.visibleLength = 20;
				if(me.visibleLength === 0){
					me.setWidth('90%');
					return;
				}
			}
	        else if (dataType == 'time'){
	            if (RamcoRTC.settings.enforceDateWidth == false)
	            me.visibleLength = 11;
				if(me.visibleLength === 0){
					me.setWidth('90%');
					return;
				}
			}
	        else {
	            if (me.visibleLength === 0) {
						me.bodyEl.setWidth('100%');
						me.inputEl.addCls('x-textarea-display');
	                //me.el.setStyle('display','inline-block');
	                //me.updateLayout();
	                return;
	            }
	        }
	        //var width = me.visibleLength * 6.5;
			var width = me.visibleLength * RamcoRTC.headerFontSize;
	        //if (dataType == "char" || dataType == "string")
	        //    width += 25;
	        //else if (dataType == "numeric")
	        width += 25;
			width = Math.ceil(width);
			if (!me.isAssorted && Ext.isEmpty(me.width))
				me.bodyEl.setWidth(width);
	        //me.updateLayout();
		}
    }
});

// DispalyOnly Control
Ext.define('Ext.ramco.LabelView', {
    extend: 'Ext.form.field.Display',
    alias: 'widget.ramcolabel',
    focusable: true,
    isAssorted: false,
    tplId: null,
    grow: true,
    growToLongestValue: true,
    forceSelection: true,
    /* visibleLength: 0, */
    dataType: 'string',
    cls: 'x-form-display-field',
    config: {
        helpIcon: false,
        expandIcon: false,
        searchIcon: false,
        dataPrec: null,
        format: null,
		ctrlConfig: null,
        dataType: 'string',
		sm: null
    },
    fieldSubTpl: [
        '<span id="{id}" data-ref="inputEl" tabindex="-1" role="textbox" aria-readonly="true"',
        ' aria-labelledby="{cmpId}-labelEl" {inputAttrTpl}',
        '<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',
        ' class="{fieldCls} {fieldCls}-{ui}">{value}</span>', {
            compiled: true,
            disableFormats: true
        }
    ],
    focusCls: 'form-display-focus',
	initComponent:function(){
		var me=this;
		///me.sizeControl();
		if (Ext.isEmpty(me.visibleLength) && Ext.isEmpty(me.width)) {
			//Defect Id: TECH-28198
			//me.setWidth("100%");
			me.visibleLength = 15;
		}
		else if(!Ext.isEmpty(me.width)) {
			me.setWidth(me.width);
		}
		me.callParent(arguments);
	},
    initEvents: function() {
        var me = this,
            onClick = me.onClick,
            inputEl = me.inputEl,
            contextmenu = me.onContextmenu,
            lblKeyDown = me.lblKeyDown,
            cstCls = me.getCustomCls();
		if(me.lookupViewModel()) {
			me.setBind({
				ctrlConfig: "{" + me.itemId + ".addlProps}"
			});	
		}
        if (inputEl) {
            me.mon(inputEl, 'click', onClick, me);
            me.mon(inputEl, 'contextmenu', contextmenu, me);
            me.mon(inputEl, 'keydown', lblKeyDown, me);
        }
        if (!Ext.isEmpty(cstCls)) {
            inputEl.addCls(me.getClsName(cstCls));
        }
        me.callParent();
    },
    lblKeyDown: function(e) {
        var me = this,
            val = null,
            ellipse = null;
        if (e && e.keyCode == 113 && e.event.key.toUpperCase() == "F2") {
			me.onShowEllipseWindow(e);
        }
    },
	onShowEllipseWindow: function(e) {
		// TECH-26067
		var me = this,ellipse,val;
            if (me.itemId == "ellipseText" || me.getItemId() == 'cmbActSearch')
                return false;
            val = me.getValue();
            ellipse = Ext.create('Ext.ramco.Ellipse', {
                scrollable: false,
                hidden: true,
                modal: true
            });
            //if (RamcoRTC.settings.ellipseSize) {//AHBG-26068
            // TECH-40734
            if (RamcoRTC.settings.ellipseSize && Object.keys(RamcoRTC.settings.ellipseSize).length > 0 && parseInt(RamcoRTC.settings.ellipseSize.height) > 0 && parseInt(RamcoRTC.settings.ellipseSize.width) > 0) {//AHBG-26068			
               // if (parseInt(RamcoRTC.settings.ellipseSize.width) > 0) {
				var userWinWidth = parseInt(RamcoRTC.settings.ellipseSize.width, 10),
					userWinHeight = parseInt(RamcoRTC.settings.ellipseSize.height, 10);
					if (userWinWidth > 0) {
						ellipse.maxWidth = (userWinWidth > 500) ? userWinWidth : 500;
						ellipse.setWidth(userWinWidth);
						ellipse.ellipseText.setWidth(userWinWidth - 20);
					}
                    //ellipse.setWidth(RamcoRTC.settings.ellipseSize.width);
                    //ellipse.ellipseText.setWidth(RamcoRTC.settings.ellipseSize.width);
               // }
              //  if (parseInt(RamcoRTC.settings.ellipseSize.height) > 0)
                   // ellipse.setHeight(RamcoRTC.settings.ellipseSize.height);
			   if (userWinHeight > 0) {
					ellipse.setHeight(userWinHeight);
					ellipse.ellipseText.setHeight(userWinHeight >= 110 ? userWinHeight - 50 : 60);
				}
            }
            if (!me.readOnly && me.xtype != 'ramcolabel' && me.xtype != 'label')
                ellipse.ellipseText.setReadOnly(false);
			ellipse.showBy(me);
			//TECH-39879 - Upon F2,the display only control's ellipse height loads 
			ellipse.setWidth(ellipse.getWidth());
			ellipse.setHeight(ellipse.ellipseText.height < 120 ? ellipse.getHeight() : userWinHeight + 10 );
			//TECH-40734 - Label Name is displayed on Ellipse Header
			var lblId = 'lbl' + me.getItemId(),
                ilbo = me.up('ilbo'),
                lblObj = ilbo && ilbo.down('#' + lblId);
            if (lblObj && lblObj.initialConfig && lblObj.initialConfig.html)
            	ellipse.setTitle(lblObj.initialConfig.html);
			//ellipse.body.setHeight(ellipse.body.getHeight() + 20);
			//ellipse.setHeight((ellipse.ellipseText.height < 120) ? ellipse.getHeight() + 20 : 200);
			//ellipse.setHeight((ellipse.getHeight() < 120) ? ellipse.getHeight() + 20 : 120);
			ellipse.ascCtrl = me;
            ellipse.ellipseText.setValue(val);
            //ellipse.showBy(me);
            e.stopEvent();
    },
    onContextmenu: function(e) {
        var me = this;
        args = [];
        args = ['contextmenu', me, e];
        me.fireEvent.apply(me, args);
    },
    onClick: function(e) {
        var me = this,
            type = e.type;
        if (type == 'click') {
            var el = Ext.fly(e.target),
                elup,
                attributes = el ? el.getAttributes() : {},
                newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
                taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
                linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
                args = [];
            if (!taskInfo && el) {
                elup = el.up('div[taskinfo]');
                taskInfo = elup ? elup.getAttribute('taskinfo') : null;
            }
            if (!linkInfo && el) {
                elup = el.up('div[linkinfo]');
                linkInfo = elup ? elup.getAttribute('linkinfo') : null;
            }
            if (!newWindow && el) {
                elup = el.up('div[opennewwindow]');
                newWindow = elup ? elup.getAttribute('opennewwindow') || 'about:blank' : null;
            }
			if (me.smartViewLink) {
				RamcoRTC.hasSmartViewLink = true;
				RamcoRTC.smartViewLnkCtrl = me;				
			}
			if (me.smartViewSec) {
				RamcoRTC.hasSmartViewSec = true;
				RamcoRTC.smartViewSecCtrl = me;			
			}
            if (me.task || !Ext.isEmpty(taskInfo) || !Ext.isEmpty(linkInfo)) {
                args = ['uiclick', me];
                if (Ext.isEmpty(taskInfo) && Ext.isEmpty(linkInfo))
                    args = args.concat(me.task, me.taskType);
                else if (!Ext.isEmpty(taskInfo))
                    args = args.concat(TaskInfoToObjectArray(taskInfo));
                else {
                    args[0] = 'linkclick';
                    args = args.concat(LinkInfoToObjectArray(linkInfo));
                }
                me.fireEvent.apply(me, args);
            } else if (newWindow) {
                openNewWindow(newWindow);
                return true;
            }
        }
    },
    getDataType: function() {
        return this.dataType;
    },
    setDataType: function(value) {
        this.dataType = value;
    },
    getFormat: function(format) {
        return this.format;
    },
    setFormat: function(format) {
        this.format = format;
        this.title = format;
        if (format && (this.xtype == 'numberfield' || this.isAssorted == true))
            this.setValue(this.getValue());
    },
	updateCtrlConfig:function(newValue, oldValue) {
		var me = this;
		if(Ext.isObject(newValue)) {
			if(!Ext.isEmpty(newValue.ft)){
				me.format = newValue.ft;
				me.title = newValue.ft;
			}
			me.sm = newValue.sm;
			me.stp = newValue.stp;
			if(!Ext.isEmpty(me.stp) && me.inputEl)
				me.inputEl.dom.setAttribute("data-qtip", me.stp);
			me.setValue(newValue.value);			
		}
	},
    setValue: function(value) {
        var me = this,
            dataType = me.getDataType() || '',
			key,
            format = me.getFormat(),
			// TECH-40121
			originalValue = value,
			isFrmTemplate = false,
            returnValue = value,
			sm = me.getSm();
		if (me.isAssorted && !format) {
			me.lastValue = value;
			return;
		}
		
		if (me.isAssorted && Ext.isEmpty(value))
			value = me.lastValue;
        if (!Ext.isEmpty(value) && Ext.isString(value) && value.indexOf('{') == 0) {
            var ilbo = me.up('ilbo'),
                valueJson = Ext.decode(value, true),
                templateID,
				displayFields = me.displayFields,
                xTpl;
            if (valueJson && ilbo) {
                templateID = valueJson.tplid || me.tplId;
                //xTpl = ilbo.getTemplate(templateID);
				if (me.isAssorted && me.tplView && value) {
					/* var tplVal = Ext.decode(value, true);
					if (tplVal) */
					templateID = valueJson["v" + me.tplView];
				}
				xTpl = ilbo.getTemplate(templateID, templateID == me.tplId);
                if (xTpl && xTpl.isTemplate) {
                    if (me.isAssorted)
                        valueJson = me.setPref(valueJson);
                    value = xTpl.apply(valueJson);
                    value = value.replace(/ on\w+="[^"]*"/g, '');
                    me.focusable = false;
					isFrmTemplate = true;
					me.isFrmTemplate = true;
                } else {
                    //value = "Template not found for " + templateID;
					returnValue = [];
					for(key in valueJson){
						returnValue.push(valueJson[key]);	
					}
					value= returnValue.join(" ");
                }
            }
        } 
		else if (value && (Ext.isEmpty(sm) || sm.toLowerCase() === "n")) {
			var _dataType = dataType.toLowerCase(), dateVal;
			if ( _dataType == 'date') {
				//dateVal = Ext.Date.parse(value + ' 00:00:00',  "Y-m-d H:i:s");
				dateVal = Ext.Date.parse(value,  "Y-m-d");//datechange
			}
			if ( _dataType == 'time') {
				dateVal = Ext.Date.parse('1900-01-01 ' + value, "Y-m-d H:i:s");
			}
			if ( _dataType == 'date-time') {
				dateVal = Ext.Date.parse(value, "Y-m-d H:i:s");
			}
            switch (_dataType) {
                case "date":
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat;
					value = Ext.util.Format.date(dateVal, format);
					//if (new Date(value) != 'Invalid Date')
					//	value = Ext.util.Format.date(value, format);
                    break;
                case "date-time":
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat;
                    value = Ext.util.Format.date(dateVal, format);
                    break;
                case "time":
                    format = RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat;
                    //value = Ext.util.Format.date('1900-01-01 ' + dateVal, format);
					value = Ext.util.Format.date(dateVal, format);
                    break;
                case "float":
                case "double":
                case "numeric":
                case "int":
                case "integer":
                case "long":
                    value = me.formatNumeric(value, format);
                    break;
                default:
            }
        }
        if (me.rendered && value && (!me.visibleLength || me.visibleLength == 0)) {
			// TECH-38395
			 //me.inputEl.setStyle('display','inline !important');
			 if(!isFrmTemplate && !me.isFrmTemplate){
				var v = Ext.util.Format.stripTags(value),
				    w= v.length * 6.5 + 22,
				    cw = me.getWidth();
				if(v.length <= 0){
					me.inputEl.setWidth('100%');
					me.inputEl.setStyle('display','block');
				}
				else if(w < cw) {
					me.inputEl.setWidth(w);
					// TECH-38395
					me.inputEl.setStyle('display','inline');
				}
				else if(cw <= 0) {
					me.inputEl.setWidth('100%');
					me.inputEl.setStyle('display','block');
				}
				else {
					me.inputEl.setWidth(cw);    
					// TECH-38395
					me.inputEl.setStyle('display','inline');
				}
			 }
			 else{
				me.inputEl.setWidth('100%');
				me.inputEl.setStyle('display','block');
			 }
            //var width = me.el.getTextWidth(value);
            //me.el.setWidth(width);
            //me.el.setWidth('100%');
            //me.el.setStyle('display','inline-block');
        }
        me.suspendEvents();
		me.suspendLayouts();
		// TECH-32726
		value = purifyDom(value);
        me.setRawValue(me.valueToRaw(value));
        // TECH-40121
        //me.mixins.field.setValue.call(me, value);
        me.mixins.field.setValue.call(me, originalValue);
		me.resumeLayouts(true);
        me.resumeEvents();
    },
    setPref: function(value) {
        var me = this,
            val = null,
            decSep, digGrp,
            dataType = null,
            format = null,
            num,
			dateVal,
			returnVal = {}, replaceVal = '',
            formatObj = me.getFormat();
			if (!Ext.isEmpty(formatObj))
				formatObj = Ext.decode(formatObj, true);
        for (var itm in value) {
            val = value[itm];
			replaceVal = itm;
			if(!me.displayFields)
				replaceVal = itm.replace('v', '');
            dataType = formatObj[itm];
			returnVal[replaceVal] = val;
			switch (dataType["dType"]) {
                case "date":
                    format = RamcoRTC.userPreference.dateFormat;
					//dateVal = Ext.Date.parse(val + ' 00:00:00',  "Y-m-d H:i:s");
					dateVal = Ext.Date.parse(val,  "Y-m-d");//datechange
					returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
					break;
                case "date-time":
                    format = RamcoRTC.userPreference.dateTimeFormat;
					dateVal = Ext.Date.parse(val, "Y-m-d H:i:s");
                    returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
                    break;
                case "time":
                    format = RamcoRTC.userPreference.timeFormat;                    
					dateVal = Ext.Date.parse('1900-01-01 ' + val, "Y-m-d H:i:s");
					returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
                    break;
                case "float":
                case "double":
                case "numeric":
                case "int":
                case "integer":
                case "long":
                    returnVal[replaceVal] = me.formatNumeric(val, dataType.prec);
                    break;
				default:
                    returnVal[replaceVal] = val;
                    break;
            }
        }
        return returnVal;
    },
    formatNumeric: function(value, dataType) {
		if(Ext.isEmpty(value))
			return "";
        var tempNum = '999999999999999999',
			n1, n2, num, num1,num2;
        dataType = dataType ? parseInt(dataType, 10) : 0;
        if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "no grouping") {
            format = '9.' + tempNum.substring(0, dataType)
        } else {
            format = '9,9.' + tempNum.substring(0, dataType)
        }
        Ext.util.Format.thousandSeparator = RamcoRTC.userPreference.numgroupsymbol;
        Ext.util.Format.decimalSeparator = RamcoRTC.userPreference.decimalseparator;
		var numGroupStyle = RamcoRTC.userPreference.numgroupstyle.toLowerCase();
		if (!Ext.isEmpty(numGroupStyle) && numGroupStyle != 'no grouping') {//TECH-33327
			num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
			if (numGroupStyle == "lakh based")
				n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			else if (numGroupStyle == "million based")
				n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			
			num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
		}else{
			if (dataType == null || dataType == 0)
				num = Ext.util.Format.number(value, "0");
			else
				num = Ext.util.Format.number(value, format);
		}
       /* if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "lakh based") {
            num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
            n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        }else if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "million based") {//TECH-33327
         	num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
	       // n1 = n1[0].replace(/(?<!\.)(\d)(?=(\d{3})+(\.|$))/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
	        n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        } else {
			if (dataType == null || dataType == 0)
				num = Ext.util.Format.number(value, "0");
			else
				num = Ext.util.Format.number(value, format);
        }*/
        var neg = false;
		if(Ext.isNumber(num))//TECH-33327
			num = num.toString();
        if (num.indexOf('-') != -1)
            neg = true;
        if (neg) {
            var numNegStyle = RamcoRTC.userPreference.numnegativestle;
            switch (numNegStyle) {
                case "(1.1)":
                    num = "(" + num.replace("-", "") + ")";
                    break;

                case "- 1.1":
                    num = num.replace("-", "- ");
                    break;

                case "1.1-":
                    num = num.replace("-", "") + "-";
                    break;

                case "1.1 -":
                    num = num.replace("-", "") + " -";
                    break;

                case "()1.1":
                    num = "()" + num.replace("-", "");
                    break;

                case "(-)1.1":
                    num = "(-)" + num.replace("-", "");
                    break;
                default:
                    num = "-" + num.replace("-", "");
                    break;
            }
        }
        return num;
    },
    afterRender: function() {
        var me = this;
        me.callParent();
        me.sizeControl();
    },
    sizeControl: function() {
        var me = this,
            //value = null,
            dataType = me.getDataType(),
            growAppend = 'W';
        if (me.width)
            return;
		/*
        	value = Ext.util.Format.htmlEncode(
            (me.hasFocus ? '' : me.emptyText) || ''
        );
		*/
		if(me.rendered){
	        if (dataType == 'date'){
				if (RamcoRTC.settings.enforceDateWidth == false)
				me.visibleLength = 11;
				if(me.visibleLength === 0){
					me.setWidth('90%');
					return;
				}
			}
			else if (dataType == 'date-time'){
				if (RamcoRTC.settings.enforceDateWidth == false)
				  me.visibleLength = 11;
				if(me.visibleLength === 0){
					me.setWidth('90%');
					return;
				}
			}
			else if (dataType == 'time'){
				if (RamcoRTC.settings.enforceDateWidth == false)
				me.visibleLength = 11;	
				if(me.visibleLength === 0){
					me.setWidth('90%');
					return;
				}
			}
	        else {
	            if (me.visibleLength === 0) {
						me.bodyEl.setWidth('100%');
						me.inputEl.addCls('x-textarea-display');
	                //me.el.setStyle('display','inline-block');
	                //me.updateLayout();
	                return;
	            }
	        }
	        //var width = me.visibleLength * 6.5;
			var width = me.visibleLength * RamcoRTC.headerFontSize;
	        //if (dataType == "char" || dataType == "string")
	        //    width += 25;
	        //else if (dataType == "numeric")
	        width += 25;
			width = Math.ceil(width);
			if (!me.isAssorted && Ext.isEmpty(me.width))
				me.bodyEl.setWidth(width);
			//me.updateLayout();
		}
    }
});
//Picker Override
Ext.define('Ext.form.field.o.Picker', {
	override: 'Ext.form.field.Picker',
	onDownArrow: function(e) {
        var me = this,
		    editorXtypes = ["datefield", "ramcodatetimefield", "ramcotimefield"];
		if(!(me.ownerCt && me.ownerCt.xtype =="celleditor" && editorXtypes.indexOf(me.xtype) > -1)){
			me.callParent(arguments);
		}
	}
});

// Combo Field
Ext.define('Ext.ramco.field.ComboField', {
    extend: 'Ext.form.field.ComboBox',
    xtype: 'combofield',
    enforceMaxLength: true,
	grow: false,
    //grow: true,
	//growMax: true,
	inputAttrTpl:"spellcheck=false",
    growToLongestValue: true,
    forceSelection: true,
	valueField: 'value',
    validateOnChange: true,
	defaultListConfig: {
        loadingHeight: 10,
        minWidth: 10,
        maxHeight: 300,
        shadow: 'sides'
    },
    initComponent: function() {
        var me = this,
    		trigger; // AHBG-25241
        me.callParent(arguments);
        if (RamcoRTC.settings.disableComboEdit === true && me.itemId != "cmbActSearch")
            me.setEditable(false);

		// AHBG-25241
		trigger = me.getTriggers();
		if (!Ext.isEmpty(trigger) && !Ext.isEmpty(trigger.picker))
			 	trigger.picker.hideOnReadOnly = false;
    },
    onDataChanged: function() {
		// TECH-33548
    	var me = this,
    		picker = me.picker,
			ilbo, ilboSize;

        if (this.grow && this.growToLongestValue) {
            this.autoSize()
        }
        
        // Picker Width Customization //TECH-38986
		 if (RamcoRTC.settings.autoDropDownWidth === true && me.rendered && ((me.store.maxFieldLength * 7) + 25 ) > me.bodyEl.getWidth()) {
			if (typeof me.getPicker == "function" && Ext.isEmpty(me.picker))
			 	picker = me.getPicker();
			if (picker) {
				ilbo = me.up('ilbo');
				ilboSize = ilbo && ilbo.getWidth();
				// TECH-33548
				me.matchFieldWidth = false;
				if(ilboSize > ((me.store.maxFieldLength * 7 )+ 25))
					picker.setMinWidth((me.store.maxFieldLength * 7) + 25);
					//me.defaultListConfig.minWidth =  picker.minWidth = (me.store.maxFieldLength * 6) - 25;
					///picker.minWidth = (me.store.maxFieldLength * 7);
				else
					picker.width = ilboSize - 5;
			}
		}
    },
    validator: function(v) {
        var me = this,
            store = this.getStore(),
            index = store.findExact(this.displayField, v),
			rec,					
            count = store.getCount(),
            val = v,
            rw, sa, t, newTag, tagWithEnd, stIndex, curTag, reservedWords, htmlTags,
            stringArray = val.split ? val.split(" ") : val;
		if (index == -1) {
			//rec = store.findRecord(this.displayField, v);
			//index = (rec) ? store.indexOf(rec) : -1;
			index = store.findExact(this.displayField, v); // TECH-40576
		}
        if (me.itemId == 'cmbActSearch' || me.xtype == "ramcolistedit")
            return true;
        if (val && RamcoRTC.settings && RamcoRTC.settings.blockedWords) {
            if (RamcoRTC.settings.blockedWords) {
                var reservedWords = RamcoRTC.settings.blockedWords;
                if (reservedWords && reservedWords.length > 0) {
                    for (var rw = 0; rw < reservedWords.length; rw++) {
                        if (val == reservedWords[rw]) {
                            Ext.RamcoMsg.alert(rvw_resources.R260, 'invalid value');
                            return true;
                        }
                    }
                }
            }
        }
        
		// TECH-33892
		if (val) {
            htmlTags = Ext.HTMLTAGS;
            if (htmlTags && htmlTags.length > 0) {
                var rwIndex = 0;
                for (sa = 0; sa < stringArray.length; sa++) {
                    for (t = 0; t < htmlTags.length; t++) {
                        newTag = "<" + htmlTags[t];
                        tagWithEnd = newTag + ">";
                        stIndex = stringArray[sa].toLowerCase().indexOf(newTag);

                        if (stIndex == -1)
                            stIndex = stringArray[sa].toLowerCase().indexOf(tagWithEnd);

                        curTag = stringArray[sa].toLowerCase().substring(stIndex);

                        if ((stIndex > -1 && (curTag == newTag || curTag == newTag + ">" || curTag == newTag + " >" || 
											curTag == newTag + "/>" || curTag == newTag + " />" || 
											curTag.indexOf(newTag) > -1 || curTag.indexOf(tagWithEnd) > -1))) {
                            Ext.RamcoMsg.alert(rvw_resources.R260, 'invalid value');
                            return true;
                        }
                    }
                }
            }
        }

        if (index === -1 && store.isLoading()) {
            store.on('load', function() {
                this.validate();
            }, this, {
                single: true,
                delay: 100
            });
            return true;
        } 
		else {
            if (count > 0) {
                return (index !== -1) ? true : 'Invalid selection';
            } 
			else {
				// TECH-40576
                if(store.isFiltered() && index < 0)
				  return 'Invalid selection';
                else
				  return true;
            }
        }
    },
    createPicker: function() {
        var me = this,
            picker,
            pickerCfg = Ext.apply({
                xtype: 'boundlist',
                id: me.id + '-picker',
                pickerField: me,
                selectionModel: me.pickerSelectionModel,
                floating: true,
                hidden: true,
                reSelect: true,
                store: me.getPickerStore(),
                displayField: me.displayField,
                preserveScrollOnRefresh: true,
                pageSize: me.pageSize,
                tpl: me.tpl
            }, me.listConfig, me.defaultListConfig);

        picker = me.picker = Ext.widget(pickerCfg);
        if (me.pageSize) {
            picker.pagingToolbar.on('beforechange', me.onPageChange, me);
        }

        if (!picker.initialConfig.maxHeight) {
            picker.on({
                beforeshow: me.onBeforePickerShow,
                scope: me
            });
        }
        picker.getSelectionModel().on({
            beforeselect: me.onBeforeSelect,
            beforedeselect: me.onBeforeDeselect,
            focuschange: me.onFocusChange,
            scope: me
        });
        //TECH-39120
		if(picker && me.uiTask){
			picker.on({
              hide:me.onPickerHide,
                scope: me
            })
		}

        picker.getNavigationModel().navigateOnSpace = false;

        return picker;
    },
    checkChange: function() {
        var me = this,
            newVal, oldVal;

        if (!me.suspendCheckChange) {
            newVal = me.getValue();
            oldVal = me.lastValue;

            if (!me.destroyed) {
                me.lastValue = newVal;
                me.fireEvent('change', me, newVal, oldVal);
                me.onChange(newVal, oldVal);
            }
        }
    },

    onTriggerClick: function() {
        var me = this;
        me.callParent();
        if (me.isExpanded)
            me.selectText();
    },
	onPickerHide:function(){//TECH-39120
		var me = this;
		if(me.uiTask){
			me.store.clearFilter();
		}
	},
	doLocalQuery: function(e) {
		var me = this,
			stCont = 0;
		me.callParent(arguments);
		stCont = me.store.count();
		if (stCont > 0)
			me.lstRecord = me.store.getAt(0);
	},
	onFieldMutation: function(e) {
        var me = this,
            key = e.getKey(),
            isDelete = key === e.BACKSPACE || key === e.DELETE,
            rawValue = me.inputEl.dom.value,
			picker = me.getPicker(),
            len = rawValue.length;
		me.callParent(arguments);
		if (len == 0 && (!key || isDelete)) {
			picker.refresh();
			if(me.itemId != 'cmbActSearch')
				me.expand();
		}
	}
});

// Combocheck Field
Ext.define('Ext.ramco.field.ComboCheckField', {
    extend: 'Ext.ramco.field.ComboField',
    xtype: 'combocheckfield',    
	multiSelect: true,
	valueField: 'value',
	tpl: ['<tpl for=".">', '<div class="x-boundlist-item">', '<input type="checkbox" />', '{value}', '</div>', '</tpl>'],
	initComponent: function() {
        var me = this;
        me.tpl = new Ext.XTemplate(me.tpl);
        me.callParent();
    },
	initEvents: function() {
        var me = this;
        me.callParent();		
		me.mon(me, {
			scope: me,				
			select: me.onMultiComboSelect,				
			beforedeselect: me.onMultiComboBeforeDeselect
		});
    },
	onTriggerClick: function(field, trigger, e) {
        var me = this;
        me.callParent();
        if (me.isExpanded) {
			if (field.picker) {
				me.onMultiComboSelect(me, field.picker.getSelectedNodes());
			}
		}
    },
	onMultiComboSelect: function(combo, records) {
		var me = this,
			node,
			input,
			picker;
		Ext.each(records, function (rec) {
			picker = combo.getPicker();
			node = picker.getNode(rec);
			if (node) {
				input = Ext.get(node).down('input');
				input.dom.checked = true;
			}
		});
	},
	onMultiComboBeforeDeselect: function(combo, record) {
		var me = this,
			node,
			input,
			picker;
		picker = combo.getPicker();
		node = picker.getNode(record);
		if (node) {
			input = Ext.get(node).down('input');
			input.dom.checked = false;
		}
	}
});

Ext.override(Ext.selection.Model, {
    doSingleSelect: function(record, suppressEvent) {
        var me = this,
            changed = false,
            selected = me.selected,
            commit;

        if (me.locked) {
            return;
        }
        // already selected. 
        // should we also check beforeselect? 
        if (me.isSelected(record) && (me.view && !me.view.reSelect)) {
            return;
        }

        commit = function() {
            // Deselect previous selection. 
            if (selected.getCount()) {
                me.suspendChanges();
                var result = me.deselectDuringSelect([record], suppressEvent);
                if (me.destroyed) {
                    return;
                }
                me.resumeChanges();
                if (result[0]) {
                    // Means deselection failed, so abort 
                    return false;
                }
            }

            me.lastSelected = record;
            if (!selected.getCount()) {
                me.selectionStart = record;
            }
            selected.add(record);
            changed = true;
        };

		
        me.onSelectChange(record, true, suppressEvent, commit);

        if (changed && !me.destroyed) {
            me.maybeFireSelectionChange(!suppressEvent);
        }
    }
});
// Ramco Combo Link Field
Ext.define('Ext.ramco.field.ComboLink', {
    extend: 'Ext.form.field.ComboBox',
    xtype: 'ramcocombolink'
});
Ext.define('Ext.o.form.field.ComboBox', {
	override: 'Ext.form.field.ComboBox',
	doSetValue: function(value /* private for use by addValue */, add) {
        var me = this,
            store = me.getStore(),
            Model = store.getModel(),
			nRecord = [],
            matchedRecords = [],
            valueArray = [],
            autoLoadOnValue = me.autoLoadOnValue,
            isLoaded = store.getCount() > 0 || store.isLoaded(),
            pendingLoad = store.hasPendingLoad(),
            unloaded = autoLoadOnValue && !isLoaded && !pendingLoad,
            forceSelection = me.forceSelection,
            selModel = me.pickerSelectionModel,
            displayIsValue = me.displayField === me.valueField,
            isEmptyStore = store.isEmptyStore,
            lastSelection = me.lastSelection,
            i, len, record, dataObj,
            valueChanged, key;
 
        //<debug> 
        if (add && !me.multiSelect) {
            Ext.raise('Cannot add values to non multiSelect ComboBox');
        }
        //</debug> 
 
        // Called while the Store is loading or we don't have the real store bound yet. 
        // Ensure it is processed by the onLoad/bindStore. 
        // Even if displayField === valueField, we still MUST kick off a load because even though 
        // the value may be correct as the raw value, we must still load the store, and 
        // upon load, match the value and select a record sop we can publish the *selection* to 
        // a ViewModel. 
        if (pendingLoad || unloaded || !isLoaded || isEmptyStore) {
 
            // If they are setting the value to a record instance, we can 
            // just add it to the valueCollection and continue with the setValue. 
            // We MUST do this before kicking off the load in case the load is synchronous; 
            // this.value must be available to the onLoad handler. 
            if (!value.isModel) {
                if (add) {
                    me.value = Ext.Array.from(me.value).concat(value);
                } else {
                    me.value = value;
                }
 
                me.setHiddenValue(me.value);
 
                // If we know that the display value is the same as the value, then show it. 
                // A store load is still scheduled so that the matching record can be published. 
                me.setRawValue(displayIsValue ? value : '');
                // if display is value, let's remove the empty text since the store might not be loaded yet 
                if (displayIsValue && !Ext.isEmpty(value) && me.inputEl && me.emptyText) {
                    me.inputEl.removeCls(me.emptyUICls);
                }
            }
 
            // Kick off a load. Doesn't matter whether proxy is remote - it needs loading 
            // so we can select the correct record for the value. 
            // 
            // Must do this *after* setting the value above in case the store loads synchronously 
            // and fires the load event, and therefore calls onLoad inline. 
            // 
            // If it is still the default empty store, then the real store must be arriving 
            // in a tick through binding. bindStore will call setValueOnData. 
            if (unloaded && !isEmptyStore) {
                store.load();
            }
 
            // If they had set a string value, another setValue call is scheduled in the onLoad handler. 
            // If the store is the defauilt empty one, the setValueOnData call will be made in bindStore 
            // when the real store arrives. 
            if (!value.isModel || isEmptyStore) {
                return me;
            }
        }
 
        // This method processes multi-values, so ensure value is an array. 
        value = add ? Ext.Array.from(me.value).concat(value) : Ext.Array.from(value);
 
        // Loop through values, matching each from the Store, and collecting matched records 
        for (i = 0, len = value.length; i < len; i++) {
            record = value[i];
 
            // Set value was a key, look up in the store by that key 
            if (!record || !record.isModel) {
                record = me.findRecordByValue(key = record);
 
                // The value might be in a new record created from an unknown value (if !me.forceSelection). 
                // Or it could be a picked record which is filtered out of the main store. 
                // Or it could be a setValue(record) passed to an empty store with autoLoadOnValue and aded above. 
                if (!record) {
                    record = me.valueCollection.find(me.valueField, key);
                }
            }
            // record was not found, this could happen because 
            // store is not loaded or they set a value not in the store 
            if (!record) {
                // If we are allowing insertion of values not represented in the Store, then push the value and 
                // create a new record to push as a display value for use by the displayTpl 
                if (!forceSelection) {
                    
                    // We are allowing added values to create their own records. 
                    // Only if the value is not empty. 
                    if (!record && value[i]) {
                        dataObj = {};
                        dataObj[me.displayField] = value[i];
                        if (me.valueField && me.displayField !== me.valueField) {
                            dataObj[me.valueField] = value[i];
                        }
                        record = new Model(dataObj);
						if (me.xtype == "ramcotagfield" && Ext.isEmpty(record.data.rn)) {
							store.tr = store.tr + 1;
							store.nsr++;
							record.data.rn = store.tr;
							record.data.sel = true;
							record.data.isNew = false;
							nRecord.push(record);
							//store.add(record);
						}
                    }
                }
                // Else, if valueNotFoundText is defined, display it, otherwise display nothing for this value 
                else if (me.valueNotFoundRecord) {
                    record = me.valueNotFoundRecord;
                }
            }
            // record found, select it. 
            if (record) {
                matchedRecords.push(record);
                valueArray.push(record.get(me.valueField));
            }
			if (nRecord.length) {				
                selModel.select(matchedRecords, false);				
				store.add(nRecord);
            }
        }
 
        // If the same set of records are selected, this setValue has been a no-op 
        if (lastSelection) {
            len = lastSelection.length;
            if (len === matchedRecords.length) {
                for (i = 0; !valueChanged && i < len; i++) {
                    if (Ext.Array.indexOf(me.lastSelection, matchedRecords[i]) === -1) {
                        valueChanged = true;
                    }
                }
            } else {
                valueChanged = true;
            }
        } else {
            valueChanged = matchedRecords.length;
        }
 
        if (valueChanged) {
            // beginUpdate which means we only want to notify this.onValueCollectionEndUpdate after it's all changed. 
            me.suspendEvent('select');
            me.valueCollection.beginUpdate();
            if (matchedRecords.length) {
                selModel.select(matchedRecords, false);
            } else {
                selModel.deselectAll();
            }			
            me.valueCollection.endUpdate();
            me.resumeEvent('select');
        } else {
            me.updateValue();
        }
        
        return me;
    }
});

Ext.define('Ext.grid.o.CellEditor', {
	override:'Ext.grid.CellEditor',
	//alignment: "l-t!",//TECH-32884
	
	startEdit: function(d, g, e) {
		//TECH-30364
		var curField = this.field;
		this.context = this.editingPlugin.context;
        Ext.Editor.prototype.startEdit.call(this, d, g, e);		
		/*
		if(this.field.clearValue)
			this.field.clearValue();
		*/
		if (curField) {
			curField.hasEnter = false;
			curField.grid = this.context.grid.ownerCt;
			curField.column = this.context.column;
			curField.suspendEvents();	
		if (this.context.column.hasMasking === true) {
				curField.setValue(this.context.record.get(this.context.column.dataCol));
		}
		else {
				curField.setValue(this.context.record.get(this.context.column.dataIndex));
		}
			curField.resumeEvents();
		//TECH-30364
		Ext.defer(function() {
				if (curField.xtype == "combofield") {
				curField.selectText();
			}
				// TECH-37897
				else if (curField.xtype == "ramcolistedit" && curField.showAutoList != false && curField.column.isTriggerClick == true) {
					// TECH-38176
					curField.column.isTriggerClick=false;
					if (!curField.isExpanded)
						curField.onTriggerClick();
				}
		}, 50);
		}		
    },
	onEditComplete: function(remainVisible, canceling) {
        var me = this,
            activeElement = Ext.Element.getActiveElement(),
            boundEl;
 
        me.editing = false;
 
        // Must refresh the boundEl in case DOM has been churned during edit. 
        boundEl = me.boundEl = me.context.getCell();
 
        // We have to test if boundEl is still present because it could have been 
        // de-rendered by a bufferedRenderer scroll. 
        if (boundEl) {
            me.restoreCell();
 
            // IF we are just terminating, and NOT being terminated due to focus 
            // having moved out of this editor, then we must prevent any upcoming blur 
            // from letting focus fly out of the view. 
            // onFocusLeave will have no effect because the editing flag is cleared. 
            if (boundEl.contains(activeElement) && boundEl.dom !== activeElement) {
                boundEl.focus();
            }
        }
		
        Ext.Editor.prototype.onEditComplete.apply(this, arguments);
 
        // Do not rely on events to sync state with editing plugin, 
        // Inform it directly. 
        if (canceling) {
            me.editingPlugin.cancelEdit(me);
        } else {
			if(me.field.xtype == "ramcolistedit")
				me.editingPlugin.onEditComplete(me, me.field.getRawValue(), me.startValue);
			else
				me.editingPlugin.onEditComplete(me, me.field.getValue(), me.startValue);
        }
    },
	onSpecialKey: function(field, evt, eOpts) {
		 var me = this,
			cols = '',
			searchView = '',
			listSelection = null,
            key = evt.getKey(),
            complete = me.completeOnEnter && key === evt.ENTER && (!eOpts || !eOpts.fromBoundList),
            cancel = me.cancelOnEsc && key === evt.ESC,
            view = me.editingPlugin.view,
			grid = field.grid,
			listSelVal = '', value = '', parseValue = '';
			if(key == evt.TAB) {
				if (field.xtype == "ramcodatetimefield" || field.xtype == "datefield" || field.xtype == "ramcotimefield") {
					value = field.getRawValue();
					if(field.isValid()) {
						field.setValue(field.getValue());
					}
					else {
						parseValue = field.parseSpecialData(field.itemId, value, field.format, "parse");
						parseValue = field.parseSpecialData(field.itemId, parseValue, field.format, "validate");
						parseValue = Ext.Date.parse(parseValue, field.format);
						if(!isNaN(Date.parse(parseValue)))
							field.setValue(parseValue);
						else 
							evt.stopEvent();
					}
				}
			}
			if (grid && grid.xtype == "ramcoexpgrid") {
				complete = (key === evt.TAB || key === evt.ENTER);
			}			
			if(complete) {
				field.hasEnter = true;
				//if(field.xtype == 'combofield' || field.xtype == 'ramcolistedit'){
				if(field.xtype == 'combofield'){
					searchView = field.searchView || field.valueField;
					field.picker = field.picker || field.getPicker();
					listSelection = field.picker.getSelectionModel().getSelection();					
					if(listSelection.length == 0) {
						field.listSelection = listSelection;
						//listSelection = field.getValue();
						//field.select(listSelection);						
						//field.picker.grid.fireEvent('listselect', field.picker.column.editor,record,field.picker.grid);
						//me.grid.fireEvent('listselect', field, listSelection)
					}
					else
						field.listSelection = listSelection[0];
						//field.select(listSelection);
					
					if (Ext.isEmpty(field.listSelection)) {
						field.setValue(null);
					}
					else {
						field.setValue(field.listSelection.get(searchView));
					}
					//me.completeEdit();
					//me.grid.fireEvent('listselect', field, field.listSelection);
					
					//field.listSelection = listSelection;
					//me.completeEdit();
					//field.select(field.getSelectedRecord() || field.getValue());										
					//if(!Ext.isEmpty(field.getSelection()))
						//field.hasEnter = false;
				}
				if((field.xtype == "ramcolistedit") && key == evt.ENTER) {
					field.doQueryTask.cancel();
					field.picker = field.picker || field.getPicker();
					if (field.picker){
						listSelection = field.picker.getSelectionModel().getSelection();
						selectedVal = field.picker.getSelection();
					}
					if (selectedVal && selectedVal.length > 0) {
						field.listSelection = listSelection[0];
						field.setValue(field.listSelection.get(field.searchView));
						me.completeEdit();
					}
					else {
						field.setSelection(null);
						field.idField = null;
					}
				} 
			}
			if (complete && grid && grid.xtype == "ramcoexpgrid") {
				if (field.xtype == "textfield") {
					me.completeEdit();
				}
				grid.store.sync();
			}
			me.callParent(arguments);
	 }
});

Ext.define('Ext.ramco.RSListView', {
    extend: 'Ext.form.field.Picker',
    xtype: 'ramcorslistview',
	uses: [
        'Ext.grid.Panel'
    ],
	triggerCls: Ext.baseCSSPrefix + 'form-arrow-trigger',
	listColSize:[],
    config: {
        store: null,
        displayField: null,
        columns: null,
        selectOnTab: true,
        maxPickerHeight: 300,
        minPickerHeight: 100,
		listWidth: 500,
		listHeight: 150,
    },   
    editable: false,	
	initComponent: function() {
        var me = this;
        me.callParent(arguments);		
    },
	applyStore: function(store) {
		var me = this;
		store = Ext.create('Ext.data.Store', store);
		return store;
	},
	setStore: function(store) {
        var me = this,
            oldStore = me.store;
		if (RamcoRTC.isGProto) {
			store = me.applyStore(store);
		}
			
        if (store && store !== oldStore) {
            me.unbindStore();
            me.bindStore(store);
        }
        if (this.autoLoad && !store.isEmptyStore && !(store.loading || store.isLoaded())) {
            store.load();
        }
    },
	onStoreLoad: Ext.emptyFn,
    bindStore: function(store, initial) {
        var me = this;
        if (store) {
            // Bind to store immediately because subsequent processing looks for grid's store property
            me.store = store;
			me.mon(store, {
				scope: me,
				load: me.onLoad,
				update: me.onUpdate
			});            
        } 
		else {
            me.unbindStore();
        }
    },
    unbindStore: function() {
        var me = this,
            store = me.store;
        if (store) {
            store.trackStateChanges = false;
            me.store = null;
            me.mun(store, {
                scope: me,
				load: me.onLoad,
				update: me.onUpdate
            });            
        }
    },    
	updateColumns: function(columns) {
        var me = this,
            column,
            fields = [],
            i = 0,
            len = columns ? columns.length : 0,
			visibleColLength = 0,
            width = 0,
            cellWidth = 0,
            lastVIndex = 0,
			colLen;
        for (; i < len; i++) {
            column = columns[i];
			colLen = column.visibleLength;
			fields.push(column.itemId);
            if (column.hidden)
                continue;
			cellWidth = 0;
            if(!column.dataIndex)
				column.dataIndex = column.itemId;
			if (typeof colLen == "undefined")
				cellWidth = column.width;
			if (!cellWidth && colLen)
				column.width = colLen * 7;
			cellWidth = column.width;
            if (column.text && column.width < (column.text.length * 7))
                cellWidth = column.text.length * 7;
			column.width = cellWidth || 30;
			column.width += 4;
			width += column.width;			
			me.listColSize[column.dataIndex] = column.text.length;
        }
        me.setListWidth(width);        
    },
	createPicker: function() {
        var me = this,
            picker = new Ext.ramco.RSListViewSearchGrid({
                baseCls: Ext.baseCSSPrefix + 'boundlist',
				userCls: Ext.baseCSSPrefix + 'searchgrid',
                shrinkWrapDock: 2,
                store: me.store,
				role: 'uipage',
				height: me.getListHeight() + 35,
				id: me.id + '-listviewpicker',
                pickerField: me,
				columnLines: true,
				rowLines: false,							
                floating: true,                
                columns: me.columns,
                minHeight: me.minPickerHeight,
                maxHeight: me.maxPickerHeight,
                manageHeight: false,
                shadow: false,
				viewConfig: {
					forceFit: true,
					stripeRows: false
				},
                listeners: {
                    scope: me,
                    itemclick: me.onItemClick,
                    itemkeydown: me.onPickerKeyDown,
					headerclick: me.onItemHeaderClick,
                }
            }),
            view = picker.getView();   
			picker.minWidth = this.width;			
			picker.getNavigationModel().navigateOnSpace = false;			
        return picker;
    },
	onRefresh: function() {
        var me = this,
            listWidth = me.getListWidth(),
            ilbo = me.up('ilbo'),
			picker = null,
			hdrWidth = null,
			ilboX = 0,
			size = {width:0},
			lstColumns = null;
		if(ilbo) {
			ilboX = ilbo.getX();
            size = ilbo.getSize();
		}
        if (me.grow && me.growToLongestValue) {
            me.autoSize();
        }
        if (!me.destroyed && me.queryPlan) {
            me.afterQuery(me.queryPlan);
        }
        delete me.queryPlan;
        picker = me.getPicker();
        if (picker.rendered === false) {
			return;
		}
		hdrWidth = (picker && picker.headerCt && picker.headerCt.rendered) ? picker.headerCt.getWidth() : 0;
		lstColumns = picker.getColumns();
		//me.doAutoSelect();		
		if(document.activeElement && me.inputEl) {
			if (document.activeElement.id == me.inputEl.id) {
				me.expand();				
				if (lstColumns && lstColumns.length > 0) {
					var len = lstColumns.length,
						  i = 0,
						  newWidth = 0,
						  oldWidth = 0,
						  adjLstWidth = 0,
						  element = null,
						  isGrid = (me.ownerCt && me.ownerCt.grid) ? true : false,
						  gridObj, totWidth = 0, cellWidth = 0;
					for(; i < len; i++) {
						element = lstColumns[i];
						oldWidth = element.getWidth();						
						cellWidth = element.text.length;
						if (isGrid) {
							gridObj = me.up('ramcogrid');
							if (gridObj && Ext.isObject(gridObj.listColSize) && Object.keys(gridObj.listColSize).length > 0) {								
								// TECH-41209
								if(!Ext.isEmpty(gridObj.listColSize) && !Ext.isEmpty(gridObj.listColSize[element.dataIndex]))
									cellWidth = Math.max(gridObj.listColSize[element.dataIndex], cellWidth);								
							}
						}
						else {
							// TECH-41209
							if (!Ext.isEmpty(me.listColSize) && !Ext.isEmpty(me.listColSize[element.dataIndex]))
								cellWidth = Math.max(me.listColSize[element.dataIndex], cellWidth);
						}
						newWidth = cellWidth * 7.5 + 4;
						// TECH-41209
						//if (oldWidth < newWidth) {
							if (!Ext.isEmpty(element.maxWidth))
								element.maxWidth = newWidth;
							element.setWidth(newWidth);						
						//}
						if (!element.hidden)
							totWidth += newWidth;
					}					
					if (totWidth < me.width)
						totWidth = me.width;
					me.setListWidth(totWidth);
				}
				if (picker) {
					picker.unmask();
					if (picker.menuListEdit)
						return;					
					var listColumnWid = me.getListWidth(),
						listHeight = me.getListHeight(),
						lstLeft = me.getX();
					lstLeft = lstLeft - ilboX;
					if((listColumnWid + lstLeft) < size.width)
						picker.setWidth(listColumnWid + 20);
					else {
						if(listColumnWid < size.width){
							picker.setWidth(listColumnWid + 20);
							picker.setHeight(listHeight + 20);
							picker.alignTo(me.el, "b?");							
						} else {
							picker.setWidth(size.width - 50);
							picker.setX(ilboX + 25);
						}
					}
				}
			}
		}
    },
	clearLocalFilter: function() {
        var me = this,
            filter = me.queryFilter;
 
        if (filter) {
            me.queryFilter = null;
            // Must set changingFilters flag for this.checkValueOnChange. 
            // the suppressEvents flag does not affect the filterchange event 
            me.changingFilters = true;
            me.store.removeFilter(filter, true);
            me.changingFilters = false;
        }
    },
	repaintPickerView: function() {
        var style = this.picker.getView().getEl().dom.style;
 
        // can't use Element.repaint because it contains a setTimeout, which results in a flicker effect 
        style.display = style.display;
    },
	onItemClick: function(view, record, node, rowIndex, e) {
        this.selectItem(record);
    },
	onItemHeaderClick: function(header, column, e, t, eOpts) {
		var me = this;
		me.checkRecordCheck(column);		
	},
	checkRecordCheck: function(column){
		var me = this,
			grid = column.up('ramcosearchgrid'),
			gridCheck = grid.query('ramcogridcheck'),
			checked = false,
			store = grid.getStore(),
			c=0,
			count = store.getCount();
		 
		if (column.checkEl.hasCls('x-column-header-unchecked')) {
            column.checkEl.removeCls('x-column-header-checked');
            column.checkEl.addCls('x-column-header-unchecked');            
			checked = false;
			store.nsr = 0;
        } 
		else {
            column.checkEl.removeCls('x-column-header-checked');
            column.checkEl.addCls('x-column-header-checked');            
			checked = true;
			store.nsr = store.tr;
        }
		
		for (; c < count; c++) {
			var rec = store.getAt(c);
			if (rec.get('isNew'))
				continue;
			rec.set('sel', checked);
		}
		
		if (store) {
			me.setRawValue(store.nsr + " items selected");
		}		
	},
	onPickerKeyDown: function(treeView, record, item, index, e) {
        var key = e.getKey();
 
        if (key === e.ENTER || (key === e.TAB && this.selectOnTab)) {
            this.selectItem(record);
        }
    },
	selectItem: function(record) {
        var me = this,
			store = me.getStore();
		store.cr = record.get("rn");
		me.setSelectedRows(store);
    },
	setSelectedRows: function(store) {
		var me = this;
		if (store) {
			me.setRawValue(store.nsr + " items selected");
		}
	},
	onExpand: function() {
        var me = this,
			picker = this.picker,
            store = picker.store,
            value = this.value,
			keyNav = me.listKeyNav,
            selectOnTab = me.selectOnTab,            
            node,
			columns,
			checkColumn,
			checkHeaders = picker.query('ramcogridcheck'),
			checkHeader;
		columns = picker.getColumns();
		checkColumn = columns[0];
		picker.setWidth(me.getListWidth() + 45);
		for (var l = 0; l < checkHeaders.length; l++) {
			checkHeader = checkHeaders[l];
			if (checkHeader.dataIndex == 'sel') {
				if (value.nsr > 0 && value.nsr == value.tr) {
					checkHeader.checkEl.removeCls('x-column-header-unchecked');
					checkHeader.checkEl.addCls('x-column-header-checked');
				}
				else {
					if (checkHeader && checkHeader.checkEl && checkHeader.checkEl.hasCls('x-column-header-checked')) {
						checkHeader.checkEl.removeCls('x-column-header-checked');
						checkHeader.checkEl.addCls('x-column-header-unchecked');
					}
				}
			}
		}		
		if (keyNav) {
			keyNav.enable();
		} 
		else {
			keyNav = me.listKeyNav = Ext.create('Ext.ux.form.field.GridPickerKeyNav', {
				target: this.inputEl,
				forceKeyDown: true,
				pickerField: this,
				grid: this.getPicker()
			});
		}
		if (selectOnTab) {
			me.ignoreMonitorTab = true;
		}
		Ext.defer(keyNav.enable, 1, keyNav); //wait a bit so it doesn't react to the down arrow opening the picker
		me.inputEl.focus();		
		me.onRefresh();
    },
	setValue: function(value) {
        var me = this,
            record;
 
        me.value = value;
 
        if (me.store && me.store.loading) {
            // Called while the Store is loading. Ensure it is processed by the onLoad method. 
            return me;
        }
		
		if (value.store) {
			me.store.setData(value.store);
			me.store.tr = value.tr;			
			me.store.nsr = value.nsr;
			me.store.si = value.si;
			me.store.vsi = value.vsi;
			me.store.searchGrid = true;
		}		
		me.setSelectedRows(me.store);            		
        return me;
    },
    getSubmitValue: function(){
        return this.value;    
    },
    getValue: function() {
        return this.value;
    },
	onLoad: function() {
        var value = this.value;
 
        if (value) {
            this.setValue(value);
        }
    },    
    onUpdate: function(store, rec, type, modifiedFieldNames){
        var display = this.displayField;
        
        if (type === 'edit' && modifiedFieldNames && Ext.Array.contains(modifiedFieldNames, display) && this.value === rec.getId()) {
            this.setRawValue(rec.get(display));
        }
    },
	highlightAt: function(index) {
        var grid = this.getPicker(),
            sm = grid.getSelectionModel(),
            view = grid.getView(),
            node = view.getNode(index),
            plugins = grid.plugins,
            bufferedPlugin = plugins && plugins.filter(function(p) {
                return p instanceof Ext.grid.plugin.BufferedRenderer
            })[0];
        if (!(typeof index === "number")) {
            index = grid.store.indexOf(index);
        }
        sm.select(index, false, true);

        if (node) {
            Ext.fly(node).scrollIntoView(view.el, false);
        } else if (bufferedPlugin) {            
            bufferedPlugin.scrollTo(index);            
        }
    }
});

// List Edit
Ext.define('Ext.ramco.ListPicker', {
    extend: 'Ext.form.field.ComboBox',
    xtype: 'ramcolistedit',
    forceSelection: false,
    allQuery: 'ä¼ä',
    triggerAction: 'all',
    queryCaching: false,
	focusLeave:false,
	showAutoList: true,
	hideListHeader: false,
	inputAttrTpl:"spellcheck=false",
	listColSize:[],
	triggerCls: "tech-list_edit",
    config: {
        columns: null,
        fields: null,
        listWidth: 500,
        listHeight: 150
    },
    initComponent: function() {
        var me = this,
            columns = me.getColumns();
        me.callParent();
        me.minChars = me.startIndex || me.listIndexSearch || 4;
    },
    updateColumns: function(columns) {
        var me = this,
            column,
            fields = [],
            i = 0,
            len = columns ? columns.length : 0,
			visibleColLength = 0,
            width = 0,
            cellWidth = 0,
            lastVIndex = 0,
			colLen;
        for (; i < len; i++) {
            column = columns[i];
			colLen = column.visibleLength;
			fields.push(column.itemId);
            if (column.hidden)
                continue;
			cellWidth = 0;
            if(!column.dataIndex)
				column.dataIndex = column.itemId;
			if (typeof colLen == "undefined")
				cellWidth = column.width;
			if (!cellWidth && colLen)
				column.width = colLen * 7;
			cellWidth = column.width;
            if (column.text && column.width < (column.text.length * 7))
                cellWidth = column.text.length * 7;
			column.width = cellWidth || 30;
			column.width += 4;
			width += column.width;
			//column.maxWidth = (column.maxWidth) ? column.maxWidth * 7 : column.width;
			me.listColSize[column.dataIndex] = column.text.length;
        }
        me.setListWidth(width);
        me.setFields(fields);
    },
    getListView: function() {
        var me = this,
            fields = me.getFields(),
            ret = '';
        if (fields)
            ret = fields.join(';');
        return ret;
    },
	doLocalQuery: function(queryPlan) {
        var me = this,
			picker = me.getPicker(),
			listCol = picker.getColumns();
			
        if (me.isExpanded) {            
            me.collapse();			
        } 
		else {
            me.expand();		
			me.onRefresh();
			for(var cl=0;cl < listCol.length; cl++) {
				if(listCol[cl].mandatory && listCol[cl].ariaEl) {
					listCol[cl].ariaEl.dom.classList.add('search-item');
					listCol[cl].ariaEl.dom.classList.add('item-mandatory');
				}
			}
        }        
    },
    doRemoteQuery: function(queryPlan) {
        var me = this,
			charLength,
			rawVal = me.getRawValue(),
            lastQuery = me.lastValue || '';
			if(!Ext.isEmpty(me.up('uigridzoom'))){//TECH-29761/QA-142
				var uigrid  = me.up('uigridzoom');
				me.grid = uigrid.grid;
			}
		if(!Ext.isString(me.lastValue))
			lastQuery = lastQuery.toString();
        if (!me.upWidth) {
            var ilbo = me.up('ilbo'),
                listWidth = me.getListWidth(),
               	size = {width:listWidth};
			if (ilbo)
				size = ilbo.getSize();
            if (size.width < listWidth) {
                me.setListWidth(size.width - 40);
            }
            me.upWidth = true;
        }
		if (me.showAutoList == false) {
		if (!Ext.isEmpty(rawVal))
			queryPlan.query = rawVal;
			if (queryPlan.query == "ä¼ä")
			return;
			else if (queryPlan.query.length <= me.startIndex)
			return;
		}
        me.queryPlan = queryPlan;

        // expand before loading so LoadMask can position itself correctly
        me.expand();
        me.collapse();
		me.checkChange();
        var picker = me.getPicker();
		var listCol = picker.getColumns();
		for(cl=0;cl < listCol.length; cl++) {
			if(listCol[cl].mandatory && listCol[cl].ariaEl) {
				listCol[cl].ariaEl.dom.classList.add('search-item');
				listCol[cl].ariaEl.dom.classList.add('item-mandatory');
			}
		}
        if (picker) {
            picker.mask('Searching...');
        }
		if(me.formListEdit === true) {
			me.grid = me.ownerCt.ownerCmp;
			me.column = me.grid.getColumnById(me.dataIndex);
		}		
		if(me.menuListEdit === true && !Ext.isEmpty(queryPlan.query)) {
			me.fireEvent('menuListEdit', me, null, queryPlan.query);
			me.lastValue = queryPlan.query;
		}
		if(me.customListEdit === true) {
			me.fireEvent('customlistdata', me, null, queryPlan.query);
			me.lastValue = queryPlan.query;
		}
		else if(me.column && me.column.customListEdit === true) {
			me.grid.fireEvent('customlistdata', me, me.column, queryPlan.query, me.getListView(), me.searchView, me.grid);
			me.lastValue = queryPlan.query;
		}
		else 
		{
			// In queryMode: 'remote', we assume Store filters are added by the developer as remote filters,
			// and these are automatically passed as params with every load call, so we do *not* call clearFilter.
	        if (lastQuery == '' || lastQuery == 'ä¼ä' || me.store.count() == 0 || (queryPlan.query.indexOf(lastQuery) == -1 && (lastQuery.indexOf(queryPlan.query) == -1 || queryPlan.query.length <= me.startIndex))) {
				me.store.clearFilter();
				if(!me.grid)
					me.fireEvent('listdata', me, null, queryPlan.query);
				else
					me.grid.fireEvent('listdata', me, me.column, queryPlan.query, me.getListView(), me.searchView, me.grid);
				me.lastValue = queryPlan.query;
			} else {
				me.store.filter([{
					property: me.searchView,
					value: queryPlan.query
				}])
				if(me && Ext.isFunction(me.doAutoSelect))
					me.doAutoSelect();			
			}
		}
    },
    getStoreListeners: function(store) {
        // Don't bother with listeners on the dummy store that is provided for an unconfigured ComboBox
        // prior to a real store arriving from a ViewModel. Nothing is ever going to be fired.
        if (!store.isEmptyStore) {
            var me = this,
                result = {
                    refresh: me.onRefresh,
                    exception: me.onException
                };

            // If we are doing remote filtering, then mutating the store's filters should not
            // result in a re-evaluation of whether the current value is still present in the store.
            if (!store.getRemoteFilter()) {
                result.filterchange = me.checkValueOnChange;
            }

            return result;
        }
    },
    onRefresh: function() {
        var me = this,
            listWidth = me.getListWidth(),
            ilbo = me.up('ilbo'),
			picker = null,
			hdrWidth = null,
			ilboX = 0,
			size = {width:0},
			lstColumns = null;
		if(ilbo) {
			ilboX = ilbo.getX();
            size = ilbo.getSize();
		}
        if (me.grow && me.growToLongestValue) {
            me.autoSize();
        }
        if (!me.destroyed && me.queryPlan) {
            me.afterQuery(me.queryPlan);
        }
        delete me.queryPlan;
        picker = me.getPicker();
        if (picker.rendered === false) {
			return;
		}
		hdrWidth = (picker && picker.headerCt && picker.headerCt.rendered) ? picker.headerCt.getWidth() : 0;
		lstColumns = picker.getColumns();
		me.doAutoSelect();		
		if(document.activeElement && me.inputEl) {
			if (document.activeElement.id == me.inputEl.id) {
				me.expand();
				// TECH-27457 - List picker complete width
				if (lstColumns && lstColumns.length > 0) {
					var len = lstColumns.length,
						  i = 0,
						  newWidth = 0,
						  oldWidth = 0,
						  adjLstWidth = 0,
						  element = null,
						  isGrid = (me.ownerCt && me.ownerCt.grid) ? true : false,
						  gridObj, totWidth = 0, cellWidth = 0;
					for(; i < len; i++) {
						element = lstColumns[i];
						oldWidth = element.getWidth();
						// TECH-29265
						cellWidth = element.text.length;
						if (isGrid) {
							gridObj = me.up('ramcogrid');
							if (gridObj && Ext.isObject(gridObj.listColSize) && Object.keys(gridObj.listColSize).length > 0) {
								// AHBG-26357
								// TECH-41209
								if(!Ext.isEmpty(gridObj.listColSize) && !Ext.isEmpty(gridObj.listColSize[element.dataIndex]))
									cellWidth = Math.max(gridObj.listColSize[element.dataIndex], cellWidth);
								//newWidth = Math.max(gridObj.listColSize[element.dataIndex], element.text.length) * 7 + 4;
							}
						}
						else {
							// TECH-41209
							if (!Ext.isEmpty(me.listColSize) && !Ext.isEmpty(me.listColSize[element.dataIndex]))
								cellWidth = Math.max(me.listColSize[element.dataIndex], cellWidth);
							//newWidth = Math.max(me.listColSize[element.dataIndex], element.text.length) * 7 + 4;
						}
						newWidth = cellWidth * 7.5 + 4; // TECH-29230
						// TECH-41209
						//if (oldWidth < newWidth) {
							if (!Ext.isEmpty(element.maxWidth))
								element.maxWidth = newWidth;
							element.setWidth(newWidth);
							//adjLstWidth += (newWidth - oldWidth);
						//}
						if (!element.hidden)
							totWidth += newWidth;
					}
					/* var totalWidth = me.inputEl.getWidth();
					var listWidth = me.getListWidth();
					if (listWidth + adjLstWidth < totalWidth) {
						adjLstWidth = totalWidth - listWidth;	
					}
					me.setListWidth(listWidth + adjLstWidth); */
					if (totWidth < me.width)
						totWidth = me.width;
					me.setListWidth(totWidth);
				}
				if (picker) {
					picker.unmask();
					if (picker.menuListEdit)
						return;
					//var listColumnWid = picker.getView().el.dom.scrollWidth,
					var listColumnWid = me.getListWidth(),
						listHeight = me.getListHeight(),
						lstLeft = me.getX();
					lstLeft = lstLeft - ilboX;
					if((listColumnWid + lstLeft) < size.width)
						picker.setWidth(listColumnWid + 20);
					else {
						if(listColumnWid < size.width){
							picker.setWidth(listColumnWid + 20);
							picker.setHeight(listHeight + 20);
							picker.alignTo(me.el, "b?");
							//picker.setX(ilboX + (size.width - listColumnWid) / 2);
						} else {
							picker.setWidth(size.width - 50);
							picker.setX(ilboX + 25);
						}
					}
				}
			}
		}
    },
	doSetValue: function(value) {
		var me = this;
		me.setRawValue(value);
		// TECH-30269
		//me.checkChange();
		//TECH-30659
		me.mixins.field.setValue.call(me, value);
	},
	assertValue:function(){
		var me = this;		
		me.doSetValue(me.getRawValue());
		me.collapse();
		
	},
    createPicker: function() {
        var me = this,
			visibleColmns, colLen, lastColumn, diffWidth,
            columns = me.getColumns(), custlstedit = null, menulstedit = null,
			hideListHeader;
        me.listConfig = {};
        me.listConfig.tpl = me.Itemtpl;
        me.listConfig.minWidth = me.getListWidth();
        me.listConfig.minHeight = me.getListHeight();
        me.listConfig.maxHeight = me.getListHeight() + 35;
		custlstedit = me.customListEdit || (me.column && me.column.customListEdit) || false;
		menulstedit = me.menuListEdit || false;
		hideListHeader = me.hideListHeader || false;
		
        var me = this,
            picker,
            pickerCfg = Ext.apply({
                xtype: 'ramcolistgrid',
				stripeRows: false,
				height: me.listConfig.maxHeight, // TECH-27457 - List picker height
				userCls: Ext.baseCSSPrefix + 'boundlist',
				style:{
					padding:'0 !important'
				},
				/*viewConfig: {
					forceFit: false,
				},*/
                id: me.id + '-picker',
                pickerField: me,
                columns: columns,
				hideHeaders: hideListHeader,
				customListEdit: custlstedit,
				menuListEdit: menulstedit,
                //selectionModel: me.pickerSelectionModel,
                floating: true,
                hidden: true,
                //constrain: true,
                //width:me.listConfig.minWidth,
				//renderTo: me.up('ilbo').el,
                store: me.getPickerStore(),
                displayField: me.displayField	
                //preserveScrollOnRefresh: true,
                //pageSize: me.pageSize,
                //tpl: me.tpl
            }, me.listConfig, me.defaultListConfig);
		//AHBG-32066
		if (custlstedit) {
			pickerCfg.userCls+= " x-avnsearchwindow";
		}

        picker = me.picker = Ext.widget(pickerCfg);
		visibleColmns = picker.getVisibleColumns();
		colLen = visibleColmns.length;		
		if (colLen > 0) {
			lastColumn = visibleColmns[colLen - 1];
		}
		if (RamcoRTC.isGProto) {
			var inputElWidth = me.inputEl.getWidth();
			if (inputElWidth > me.listConfig.minWidth) {
				diffWidth = inputElWidth - me.listConfig.minWidth;
				lastColumn.width += diffWidth;
				lastColumn.maxWidth = lastColumn.width;
			}
		}
		else {
			if (me.width > me.listConfig.minWidth) {
				diffWidth = me.width - me.listConfig.minWidth;
				lastColumn.width += diffWidth;
				lastColumn.maxWidth = lastColumn.width;
			}
		}
        if (me.pageSize) {
            picker.pagingToolbar.on('beforechange', me.onPageChange, me);
        }

        // We limit the height of the picker to fit in the space above
        // or below this field unless the picker has its own ideas about that.
        if (!picker.initialConfig.maxHeight) {
            picker.on({
                beforeshow: me.onBeforePickerShow,
                scope: me
            });
        }
        picker.getSelectionModel().on({
            beforeselect: me.onBeforeSelect,
            beforedeselect: me.onBeforeDeselect,
            focuschange: me.onFocusChange,
            scope: me
        });

        picker.getNavigationModel().navigateOnSpace = false;

        return picker;
    },
	
	onExpand: function() {
        var me = this,
            keyNav = me.listKeyNav,
            selectOnTab = me.selectOnTab;

        if (keyNav) {
            keyNav.enable();
        } else {
            keyNav = me.listKeyNav = Ext.create('Ext.ux.form.field.GridPickerKeyNav', {
                target: this.inputEl,
                forceKeyDown: true,
                pickerField: this,
                grid: this.getPicker()
            });
        }
        if (selectOnTab) {
            me.ignoreMonitorTab = true;
        }
        Ext.defer(keyNav.enable, 1, keyNav); //wait a bit so it doesn't react to the down arrow opening the picker
        me.inputEl.focus();
        //this.focusWithoutSelection(10);
    },
	
	/*alignPicker: function() {
        this.getPicker().showBy(this);
    },*/
	
	bindPicker: function(grid) {
        grid.ownerCt = this;
        grid.registerWithOwnerCt();
        this.mon(grid, {
            scope: this,
            itemclick: this.onItemClick,
            refresh: this.onListRefresh,
            beforeselect: this.onBeforeSelect,
            beforedeselect: this.onBeforeDeselect,
            selectionchange: this.onListSelectionChange
        });
        // Prevent deselectAll, that is called liberally in combo box code, to
        // actually deselect
        // the current value
        var me = this,
            sm = grid.getSelectionModel(),
            uber = sm.deselectAll;
        sm.deselectAll = function() {
            if (!me.ignoreSelection) {
                uber.apply(this, arguments);
            }
        };
    },
    // @private
    onTypeAhead: function() {
        var me = this,
            displayField = me.displayField,
            record = me.store.findRecord(displayField, me.getRawValue()),
            newValue, len, selStart;

        if (record) {
            newValue = record.get(displayField);
            len = newValue.length;
            selStart = me.getRawValue().length;
            this.highlightAt(record);
            if (selStart !== 0 && selStart !== len) {
                me.setRawValue(newValue);
                //me.selectText(selStart, newValue.length);
            }
        }
    },
    /**
     * @private
     * If the autoSelect config is true, and the picker is open, highlights the first item.
     */
    doAutoSelect: function() {
        var me = this,
            picker = me.picker,
            lastSelected;
		if (me.menuListEdit	=== true)
			return;
        if (picker && me.autoSelect && me.store.getCount() > 0) {
            // Highlight the last selected item and scroll it into view
            //lastSelected = picker.getSelectionModel().getLastSelected();
            //if (picker.store.indexOf(lastSelected) != -1) {
               // this.highlightAt(lastSelected);
            //}
            //            else {
            //                this.highlightAt(0);
            //            }
            //this.highlightAt(lastSelected || 0);
			this.highlightAt(0);
        }
    },
	
	afterQuery: function(queryPlan) {
        var sm = this.getPicker().getSelectionModel()
        //this.callParent(arguments);
        var lastSelected = sm.getLastSelected();
        if (sm.hasSelection()) {
            this.highlightAt(sm.getSelection()[0]);
        }
    },
    /**
     * Highlight the record at the specified index.
     *
     * @param {Integer} or {@link Ext.data.Model}
     *            index
     * @private
     */
    highlightAt: function(index) {
        var grid = this.getPicker(),
            sm = grid.getSelectionModel(),
            view = grid.getView(),
            node = view.getNode(index),
            plugins = grid.plugins,
            bufferedPlugin = plugins && plugins.filter(function(p) {
                return p instanceof Ext.grid.plugin.BufferedRenderer
            })[0];
        if (!(typeof index === "number")) {
            index = grid.store.indexOf(index);
        }
        sm.select(index, false, true);

        if (node) {
            Ext.fly(node).scrollIntoView(view.el, false);
        } else if (bufferedPlugin) {
            //if (!isNaN(bufferedPlugin.viewSize)) { //if view is not ready yet! viewSize is NaN, fixed by hideMode: offset
            bufferedPlugin.scrollTo(index);
            //}
        }
    }
});

Ext.define('Ext.ramco.GridList', {
    extend: 'Ext.panel.Table',
    alias: 'widget.ramcolistgrid',
	viewType: 'tableview',    
	ariaRole: 'gridlist',
	role:'gridrole',
    lockable: false,
    rowLines: true,	
	columnLines:true,	
	initComponent: function() {
		var me = this;			
		me.plugins = [{
			ptype: 'bufferedrenderer',
			leadingBufferZone: 5,
			trailingBufferZone: 5
		}];
		me.viewConfig = {					
			stripeRows: false			
		};
		if(me.customListEdit === true || me.menuListEdit) {
			me.dockedItems = [
			{
				dock: 'bottom',
				xtype: 'toolbar',
				itemId: 'gridListToolbar',			
				items: [
					{
						xtype: 'tbtext',
						html:'Total Rows :',					
						itemId: 'lblListGridTotalRow'                    
					},
					{
						xtype: 'tbtext',					
						html:'',
						itemId: 'listGridTotalRow'                    
					},
					'->',
					{
						itemId: 'btnShowAll',					
						xtype: 'button',					
						text:'Adv Search',
						hidden: true,
						tooltip: rvw_resources.R140
					}, 	
					'->',	
					{
						xtype: 'tbtext',
						html: '',					
						itemId: 'listGridPageDetails'                    
					},
					{
						itemId: 'btnPrevList',
						xtype: 'button',
						handler: me.onCustListPrev.bind(me),
						iconCls: 'x-fa fa-caret-left',
						tooltip: rvw_resources.R141
					},
					{
						itemId: 'btnNextList',
						xtype: 'button',					
						handler: me.onCustListNext.bind(me),
						iconCls: 'x-fa fa-caret-right',
						tooltip: rvw_resources.R143
					}
				]
			}];
		}	
		me.callParent();
	},
	onCustListPrev: function() {
		var me = this,
			field=me.pickerField,
			eventName = "getCustLstPagedata";
		if (field.menuListEdit === true)
			eventName = "getMenuLstPageData";		
		if(field.grid)	
			field.grid.fireEvent(eventName, me, 'prev');
		else
			field.fireEvent(eventName, me, 'prev');
	},
	onCustListNext: function() {
		var me = this,
			field=me.pickerField,
			eventName = "getCustLstPagedata";
		if (field.menuListEdit === true)
			eventName = "getMenuLstPageData";	
		if(field.grid)	
			field.grid.fireEvent(eventName, me, 'next');
		else
			field.fireEvent(eventName, me, 'next');
	},
	initEvents: function() {
		var me = this,
		view = me.getView();
		view.on({				
				beforecellclick:me.onBeforeCellClick,				
				scope:me			
		});
		me.view.reSelect = false;	
		me.mon(me.store, {      
            refresh: me.onDataUpdate,
            scope: me
        });		
	},
	onDataUpdate: function() {
		var me = this,
			trow = 0,
			pageDt = 0,
			totSum = 0,
			startVal = 0,
			bbar = me.getComponent('gridListToolbar');
		if(bbar) {
			trow = bbar.getComponent('listGridTotalRow');
			trow.setHtml(me.store.tr);
			startVal = me.store.st + 1;
			totSum = me.store.pgs + me.store.st;
			if(totSum > me.store.tr)
				totSum = me.store.tr;
			pageDt = bbar.getComponent('listGridPageDetails');
			pageDt.setHtml(startVal + " - " + totSum);
		}
	},
	onBeforeCellClick: function(view , td , cellIndex , record , tr , rowIndex , e , eOpts) {
		var me = this;					
			//me.pickerField.select(record);
		me.pickerField.setSelection(record);
		if(me.pickerField.column && me.pickerField.column.customListEdit === true) {
			if(me.pickerField.grid && Ext.isEmpty(me.up('uigridzoom'))) {//TECH-29761/QA-142				
				me.pickerField.ownerCt.completeEdit();
				me.pickerField.grid.fireEvent('customlistselect', me.pickerField, record);
				me.pickerField.fireEvent('specialkey', me.pickerField, e, {
					fromBoundList: true
				});
			}
			else
				me.pickerField.fireEvent('select', me.pickerField, record);
		}
		else {
			if(me.pickerField.grid && Ext.isEmpty(me.up('uigridzoom'))) {//TECH-29761/QA-142
				//me.pickerField.grid.fireEvent('listselect', me.pickerField.column, me.pickerField.grid, record);
				if(me.pickerField.formListEdit === true)
					me.pickerField.completeEdit();
				else	
					me.pickerField.ownerCt.completeEdit();
				me.pickerField.grid.fireEvent('listselect', me.pickerField, record);
				me.pickerField.fireEvent('specialkey', me.pickerField, e, {
					fromBoundList: true
				});
			}
			else
				me.pickerField.fireEvent('select', me.pickerField, record);
		}
		if (e.pointerType === 'mouse') {
            // Stop the mousedown from blurring the input field
            // We can't do this for touch events otherwise scrolling
            // won't work.
            e.preventDefault();
        }			
	},
	getNodeByRecord:function(record) {		
		var me = this,
		view = me.getView();				
        return view.retrieveNode(view.getRowId(record), false);
	}
});

Ext.define('Ext.ux.form.field.GridPickerKeyNav', {
    extend: 'Ext.util.KeyNav',
    constructor: function(config) {
        this.pickerField = config.pickerField;
        this.grid = config.grid;	
		//if(this.pickerField.role == 'gridrole')
		//if(this.pickerField.role == 'uipage') {
			/*this.defaultHandlers.enter = function(e) {			
				var pickerField = this.getPickerField();
				var selModel = this.getGrid().getSelectionModel(),
					count = selModel.getCount();
				this.selectHighlighted(e);
				if (!pickerField.multiSelect && count) {
					pickerField.collapse();
				}
			};*/
		//}		
        this.callParent([Ext.apply({}, config, this.defaultHandlers)]);
    },	
    defaultHandlers: {
        up: function() {
            this.goUp(1);
        },
        down: function() {
            this.goDown(1);
        },
        pageUp: function() {
            this.goUp(10);
        },
        pageDown: function() {
            this.goDown(10);
        },
        home: function() {
            this.highlightAt(0);
        },
        end: function() {
            var count = this.getGrid().getStore().getCount();
            if (count > 0) {
                this.highlightAt(count - 1);
            }
        }
	},
	headerDefaultHandlers: {		
        tab: function(e) {
            var pickerField = this.getPickerField();
            if (pickerField.selectOnTab) {
                this.selectHighlighted(e);
                pickerField.triggerBlur();
            }
            // Tab key event is allowed to propagate to field
            return true;
        },
        enter: function(e) {			
            var pickerField = this.getPickerField();
            var selModel = this.getGrid().getSelectionModel(),
                count = selModel.getCount();
            this.selectHighlighted(e);
            if (!pickerField.multiSelect && count) {
                pickerField.collapse();
            }
        }
    },
	
    goUp: function(n) {
        var grid = this.getGrid(),
            store = grid.getStore(),
            sm = grid.getSelectionModel(),
            lastSelected = sm.lastSelected,
            count = store.getCount(),
            nextIndex = count - n;

        if (count > 0) {
            if (lastSelected) {
                nextIndex = store.indexOf(lastSelected) - n;
                if (nextIndex < 0) {
                    nextIndex = count - 1;
                }
            }

            this.highlightAt(nextIndex);
        }
    },
    goDown: function(n) {
        var grid = this.getGrid(),
            store = grid.getStore(),
            sm = grid.getSelectionModel(),
            lastSelected = sm.lastSelected,
            count = store.getCount(),
            nextIndex = 0;

        if (count > 0) {
            if (lastSelected) {
                nextIndex = store.indexOf(lastSelected) + n;
                if (nextIndex >= count) {
                    nextIndex = 0;
                }
            }

            this.highlightAt(nextIndex);
        }
    },
    getPickerField: function() {
        return this.pickerField;
    },
    getGrid: function() {
        return this.grid;
    },
    highlightAt: function(index) {
        this.getPickerField().highlightAt(index);
    },
    selectHighlighted: function(e) {
        var selection = this.getGrid().getSelectionModel().getSelection(),
            selected = selection && selection[0],
            pickerField = this.pickerField;
        if (selection.length) {
            pickerField.select(selection);
            pickerField.fireEvent('select', pickerField, selection[0]);
        }
    }
});

// BoundList Override
Ext.define('Ext.o.view.BoundList', {
    override: 'Ext.view.BoundList',
    initComponent: function() {
        var me = this,
            baseCls = me.baseCls,
            itemCls = me.itemCls;

        me.selectedItemCls = baseCls + '-selected';
        if (me.trackOver) {
            me.overItemCls = baseCls + '-item-over';
        }
        me.itemSelector = "." + itemCls;
        me.scrollerSelector = 'ul.' + Ext.baseCSSPrefix + 'list-plain';

        if (me.floating) {
            me.addCls(baseCls + '-floating');
        }

        if (!me.tpl) {
            // should be setting aria-posinset based on entire set of data
            // not filtered set
            me.tpl = new Ext.XTemplate(
                '<tpl for=".">',
                '<li role="option" unselectable="on" class="' + itemCls + '">',
                '<tpl if="this.isDate(' + me.displayField + ', values)">',
                me.getInnerTpl('date'),
                '<tpl else>',
                me.getInnerTpl(me.displayField),
                '</tpl>',
                '</li>', {
                    isDate: function(name, values) {
                        if (Ext.isDate(name) && this.field.format) {
                            values[this.field.displayField] = Ext.Date.format(name, this.field.format);
                            values['date'] = Ext.Date.format(name, this.field.format);
                            return true;
                        } else
                            return false;
                    }
                },
                '</tpl>'
            );
        } else if (!me.tpl.isTemplate) {
            me.tpl = new Ext.XTemplate(me.tpl);
        }

        if (me.pageSize) {
            me.pagingToolbar = me.createPagingToolbar();
        }

        me.callParent();
    }
});

// BoundList Extend
Ext.define('Ext.ramco.BoundList', {
    extend: 'Ext.view.BoundList',
    alias: 'widget.ramcoboundlist',
    renderTpl: [
        '{%',
        'var headerCt=values.$comp.headerCt;',
        'if (headerCt) {',
        'Ext.DomHelper.generateMarkup(headerCt.getRenderTree(), out);',
        '}',
        '%}',
        '<div id="{id}-listWrap" data-ref="listWrap"',
        ' class="{baseCls}-list-ct ', Ext.dom.Element.unselectableCls, '">',
        '<ul id="{id}-listEl" data-ref="listEl" class="', Ext.baseCSSPrefix, 'list-plain"',
        '<tpl foreach="ariaAttributes"> {$}="{.}"</tpl>',
        '>',
        '</ul>',
        '</div>',
        '{%',
        'var pagingToolbar=values.$comp.pagingToolbar;',
        'if (pagingToolbar) {',
        'Ext.DomHelper.generateMarkup(pagingToolbar.getRenderTree(), out);',
        '}',
        '%}', {
            disableFormats: true
        }
    ],
    initComponent: function() {
        var me = this;
        if (me.headerCt)
            me.headerCt = me.createHeaderCt();
        me.callParent();
    },
    createHeaderCt: function() {
        var me = this,
            html = '<ul class="x-list-header x-list-plain"><li class="x-list-header x-listpicker-item"><div class="search-column">',
            columns = me.columns,
            column,
            cellWidth = '',
            width = 0,
            i = 0,
            lastVIndex = 0,
            len = columns ? columns.length : 0;
        for (; i < len; i++) {
            column = columns[i];
            if (column.hidden)
                continue;
            lastVIndex = i;
        }
        i = 0;
        for (; i < len; i++) {
            column = columns[i];
            if (column.hidden)
                continue;
            if (column.width == 0) {
                cellWidth = 'min-width:20px;flex:1';
                width += 20;
            } else {
                if (i == lastVIndex)
                    cellWidth = 'min-width:' + column.width + 'px;flex:1';
                else
                    cellWidth = 'width:' + column.width + 'px;';
                width += column.width;
            }
            html += '<div class="search-item' + (column.mandatory ? ' item-mandatory' : '') + '" style="' + cellWidth + '">' + column.text + '</div>';
        }
        html += '</div></li></ul>';
        return new Ext.Component({
            itemId: me.id + '-headerCt',
            cls: 'x-list-header',
            minheight: 24,
            width: width,
            html: html,
            ownerCt: me,
            ownerLayout: me.getComponentLayout()
        });
    },
    afterComponentLayout: function() {
        var me = this;
        me.callParent();
        if (me.headerCt) {
            var height = me.listWrap.getHeight(),
                el = me.el ? me.el.first() : null,
                headerHeight = el ? el.getHeight() : 24;
            me.listWrap.setHeight(height - headerHeight);
            if (headerHeight < me.listWrap.getAttribute('scrollHeight') && el) {
                var margin = me.listWrap.getAttribute('offsetWidth') - me.listWrap.getAttribute('clientWidth');
                me.el.first().el.setStyle('marginRight', margin + 'px');
            }
        }
    }
});
//Tag Field

Ext.define('Ext.ramco.Tag', {
    extend: 'Ext.form.field.Tag',
    xtype: 'ramcotagfield',
	scrollable: true,
	cls: Ext.baseCSSPrefix + 'tagfield-comp',
    valueData: '',
    filterPickList: true,
	removeByListItemNode: function(itemEl) {
        var me = this,
			userVal = null,
            rec = me.getRecordByListItemNode(itemEl);		
        if (rec) {
			userVal = rec.get('isNew');
			if (!Ext.isEmpty(userVal)) {
				me.store.remove(rec);
			}
			me.pickerSelectionModel.deselect(rec);
        }
    },
    setValueData: function(newValue, oldValue) {
        var me = this;
        if (!me.store || me.store.isEmptyStore) {
            me.lastValueData = newValue;
            return;
        }
        if (newValue) {
            var store = me.store,
                records = [];
			if(!Ext.isEmpty(newValue.store)){
				store.setData(newValue.store);
				store.commitChanges();
			}
            store.vsi = newValue.vsi;
            store.si = newValue.si;
            store.tr = newValue.tr;
            store.nsr = newValue.nsr;
            store.start = newValue.si;
            store.end = newValue.tr;
            store.vr = newValue.vr;
            records = store.query("sel", true);
            if (records && records.length > 0) {
                records = records.clone();
                records = records.sort(me.seqField, 'ASC');
                var data = records.collect(me.valueField, 'data');
                me.suspendEvents();
                me.setValue(data.join(","));
                me.resumeEvents();
            }
			else {
				me.suspendEvents();
				me.setValue(null);
				me.resumeEvents();
			}
        }
    },
    onValueCollectionEndUpdate: function() {
        var me = this,
            store = me.store,
            selectedRecords = me.valueCollection.getRange();
			var len = selectedRecords.length,
				i = 0,
				element = null;
        me.callParent();
		if (selectedRecords && selectedRecords.length > 0) {			
			i = 0;
			element = null;
			for(; i < len; i++) {
				element = selectedRecords[i];
				//selectedRecords.forEach(function(element, index, array) {
				element.set(me.seqField, parseInt(i + 1, 10));
				if (element.get("sel") == false) {
					store.nsr++;
					element.set("sel", true);
				}
			}
		}
		
		len = store.getCount();
		if(store && len > 0) {
			i = 0;
			element = null;			
			for(; i < len; i++) {
				element = store.getAt(i);
				if (element.get("sel") == true) {					
					store.nsr--;
					element.set("sel", false);					
				}
			}
		}
		//);
    },
    setValueOnData: function() {
        var me = this;
        me.callParent();
        me.setValueData(me.lastValueData);
    }
});
Ext.define('Ext.o.ZIndexManager', {
    override: 'Ext.ZIndexManager',
	privates: {
		showModalMask: function(comp) {
            var me = this,
                compEl = comp.el,
                maskTarget = null,
                mask = me.mask;
			if(comp.floatParent && comp.floatParent.xtype == 'ilbo') {
				maskTarget = comp.container;
			}
			else {
				maskTarget = comp.floatParent ? comp.floatParent.getEl() : comp.container;
			}
            if (!mask) {
                // Create the mask at zero size so that it does not affect upcoming target measurements. 
                me.mask = mask = Ext.getBody().createChild({
                    //<debug> 
                    // tell the spec runner to ignore this element when checking if the dom is clean  
                    'data-sticky': true,
                    //</debug> 
                    role: 'presentation',
                    cls: Ext.baseCSSPrefix + 'mask ' + Ext.baseCSSPrefix + 'border-box',
                    style: 'height:0;width:0'
                });
                mask.setVisibilityMode(Ext.Element.DISPLAY);
                mask.on({
                    mousedown: me.onMaskMousedown,
                    click: me.onMaskClick,
                    scope: me
                });
            }
            
            // If the mask is already shown, hide it before showing again 
            // to ensure underlying elements' tabbability is restored 
            else {
                me.hideModalMask();
            }
 
            mask.maskTarget = maskTarget;
            
            // Since there is no fast and reliable way to find elements above or below 
            // a given z-index, we just cheat and prevent tabbable elements within the 
            // topmost component from being made untabbable. 
            maskTarget.saveTabbableState({
                excludeRoot: compEl
            });
 
            // Size and zIndex stack the mask (and its shim) 
            me.syncModalMask(comp);
        }
	}
});

// HIJRI - Date Plugin

var ummalqura_dat = [28607, 28636, 28665, 28695, 28724, 28754, 28783, 28813, 28843, 28872, 28901, 28931, 28960, 28990, 29019, 29049, 29078, 29108, 29137, 29167,
    29196, 29226, 29255, 29285, 29315, 29345, 29375, 29404, 29434, 29463, 29492, 29522, 29551, 29580, 29610, 29640, 29669, 29699, 29729, 29759,
    29788, 29818, 29847, 29876, 29906, 29935, 29964, 29994, 30023, 30053, 30082, 30112, 30141, 30171, 30200, 30230, 30259, 30289, 30318, 30348,
    30378, 30408, 30437, 30467, 30496, 30526, 30555, 30585, 30614, 30644, 30673, 30703, 30732, 30762, 30791, 30821, 30850, 30880, 30909, 30939,
    30968, 30998, 31027, 31057, 31086, 31116, 31145, 31175, 31204, 31234, 31263, 31293, 31322, 31352, 31381, 31411, 31441, 31471, 31500, 31530,
    31559, 31589, 31618, 31648, 31676, 31706, 31736, 31766, 31795, 31825, 31854, 31884, 31913, 31943, 31972, 32002, 32031, 32061, 32090, 32120,
    32150, 32180, 32209, 32239, 32268, 32298, 32327, 32357, 32386, 32416, 32445, 32475, 32504, 32534, 32563, 32593, 32622, 32652, 32681, 32711,
    32740, 32770, 32799, 32829, 32858, 32888, 32917, 32947, 32976, 33006, 33035, 33065, 33094, 33124, 33153, 33183, 33213, 33243, 33272, 33302,
    33331, 33361, 33390, 33420, 33450, 33479, 33509, 33539, 33568, 33598, 33627, 33657, 33686, 33716, 33745, 33775, 33804, 33834, 33863, 33893,
    33922, 33952, 33981, 34011, 34040, 34069, 34099, 34128, 34158, 34187, 34217, 34247, 34277, 34306, 34336, 34365, 34395, 34424, 34454, 34483,
    34512, 34542, 34571, 34601, 34631, 34660, 34690, 34719, 34749, 34778, 34808, 34837, 34867, 34896, 34926, 34955, 34985, 35015, 35044, 35074,
    35103, 35133, 35162, 35192, 35222, 35251, 35280, 35310, 35340, 35370, 35399, 35429, 35458, 35488, 35517, 35547, 35576, 35605, 35635, 35665,
    35694, 35723, 35753, 35782, 35811, 35841, 35871, 35901, 35930, 35960, 35989, 36019, 36048, 36078, 36107, 36136, 36166, 36195, 36225, 36254,
    36284, 36314, 36343, 36373, 36403, 36433, 36462, 36492, 36521, 36551, 36580, 36610, 36639, 36669, 36698, 36728, 36757, 36786, 36816, 36845,
    36875, 36904, 36934, 36963, 36993, 37022, 37052, 37081, 37111, 37141, 37170, 37200, 37229, 37259, 37288, 37318, 37347, 37377, 37406, 37436,
    37465, 37495, 37524, 37554, 37584, 37613, 37643, 37672, 37701, 37731, 37760, 37790, 37819, 37849, 37878, 37908, 37938, 37967, 37997, 38027,
    38056, 38085, 38115, 38144, 38174, 38203, 38233, 38262, 38292, 38322, 38351, 38381, 38410, 38440, 38469, 38499, 38528, 38558, 38587, 38617,
    38646, 38676, 38705, 38735, 38764, 38794, 38823, 38853, 38882, 38912, 38941, 38971, 39001, 39030, 39059, 39089, 39118, 39148, 39178, 39208,
    39237, 39267, 39297, 39326, 39355, 39385, 39414, 39444, 39473, 39503, 39532, 39562, 39592, 39621, 39650, 39680, 39709, 39739, 39768, 39798,
    39827, 39857, 39886, 39916, 39946, 39975, 40005, 40035, 40064, 40094, 40123, 40153, 40182, 40212, 40241, 40271, 40300, 40330, 40359, 40389,
    40418, 40448, 40477, 40507, 40536, 40566, 40595, 40625, 40655, 40685, 40714, 40744, 40773, 40803, 40832, 40862, 40892, 40921, 40951, 40980,
    41009, 41039, 41068, 41098, 41127, 41157, 41186, 41216, 41245, 41275, 41304, 41334, 41364, 41393, 41422, 41452, 41481, 41511, 41540, 41570,
    41599, 41629, 41658, 41688, 41718, 41748, 41777, 41807, 41836, 41865, 41894, 41924, 41953, 41983, 42012, 42042, 42072, 42102, 42131, 42161,
    42190, 42220, 42249, 42279, 42308, 42337, 42367, 42397, 42426, 42456, 42485, 42515, 42545, 42574, 42604, 42633, 42662, 42692, 42721, 42751,
    42780, 42810, 42839, 42869, 42899, 42929, 42958, 42988, 43017, 43046, 43076, 43105, 43135, 43164, 43194, 43223, 43253, 43283, 43312, 43342,
    43371, 43401, 43430, 43460, 43489, 43519, 43548, 43578, 43607, 43637, 43666, 43696, 43726, 43755, 43785, 43814, 43844, 43873, 43903, 43932,
    43962, 43991, 44021, 44050, 44080, 44109, 44139, 44169, 44198, 44228, 44258, 44287, 44317, 44346, 44375, 44405, 44434, 44464, 44493, 44523,
    44553, 44582, 44612, 44641, 44671, 44700, 44730, 44759, 44788, 44818, 44847, 44877, 44906, 44936, 44966, 44996, 45025, 45055, 45084, 45114,
    45143, 45172, 45202, 45231, 45261, 45290, 45320, 45350, 45380, 45409, 45439, 45468, 45498, 45527, 45556, 45586, 45615, 45644, 45674, 45704,
    45733, 45763, 45793, 45823, 45852, 45882, 45911, 45940, 45970, 45999, 46028, 46058, 46088, 46117, 46147, 46177, 46206, 46236, 46265, 46295,
    46324, 46354, 46383, 46413, 46442, 46472, 46501, 46531, 46560, 46590, 46620, 46649, 46679, 46708, 46738, 46767, 46797, 46826, 46856, 46885,
    46915, 46944, 46974, 47003, 47033, 47063, 47092, 47122, 47151, 47181, 47210, 47240, 47269, 47298, 47328, 47357, 47387, 47417, 47446, 47476,
    47506, 47535, 47565, 47594, 47624, 47653, 47682, 47712, 47741, 47771, 47800, 47830, 47860, 47890, 47919, 47949, 47978, 48008, 48037, 48066,
    48096, 48125, 48155, 48184, 48214, 48244, 48273, 48303, 48333, 48362, 48392, 48421, 48450, 48480, 48509, 48538, 48568, 48598, 48627, 48657,
    48687, 48717, 48746, 48776, 48805, 48834, 48864, 48893, 48922, 48952, 48982, 49011, 49041, 49071, 49100, 49130, 49160, 49189, 49218, 49248,
    49277, 49306, 49336, 49365, 49395, 49425, 49455, 49484, 49514, 49543, 49573, 49602, 49632, 49661, 49690, 49720, 49749, 49779, 49809, 49838,
    49868, 49898, 49927, 49957, 49986, 50016, 50045, 50075, 50104, 50133, 50163, 50192, 50222, 50252, 50281, 50311, 50340, 50370, 50400, 50429,
    50459, 50488, 50518, 50547, 50576, 50606, 50635, 50665, 50694, 50724, 50754, 50784, 50813, 50843, 50872, 50902, 50931, 50960, 50990, 51019,
    51049, 51078, 51108, 51138, 51167, 51197, 51227, 51256, 51286, 51315, 51345, 51374, 51403, 51433, 51462, 51492, 51522, 51552, 51582, 51611,
    51641, 51670, 51699, 51729, 51758, 51787, 51816, 51846, 51876, 51906, 51936, 51965, 51995, 52025, 52054, 52083, 52113, 52142, 52171, 52200,
    52230, 52260, 52290, 52319, 52349, 52379, 52408, 52438, 52467, 52497, 52526, 52555, 52585, 52614, 52644, 52673, 52703, 52733, 52762, 52792,
    52822, 52851, 52881, 52910, 52939, 52969, 52998, 53028, 53057, 53087, 53116, 53146, 53176, 53205, 53235, 53264, 53294, 53324, 53353, 53383,
    53412, 53441, 53471, 53500, 53530, 53559, 53589, 53619, 53648, 53678, 53708, 53737, 53767, 53796, 53825, 53855, 53884, 53913, 53943, 53973,
    54003, 54032, 54062, 54092, 54121, 54151, 54180, 54209, 54239, 54268, 54297, 54327, 54357, 54387, 54416, 54446, 54476, 54505, 54535, 54564,
    54593, 54623, 54652, 54681, 54711, 54741, 54770, 54800, 54830, 54859, 54889, 54919, 54948, 54977, 55007, 55036, 55066, 55095, 55125, 55154,
    55184, 55213, 55243, 55273, 55302, 55332, 55361, 55391, 55420, 55450, 55479, 55508, 55538, 55567, 55597, 55627, 55657, 55686, 55716, 55745,
    55775, 55804, 55834, 55863, 55892, 55922, 55951, 55981, 56011, 56040, 56070, 56100, 56129, 56159, 56188, 56218, 56247, 56276, 56306, 56335,
    56365, 56394, 56424, 56454, 56483, 56513, 56543, 56572, 56601, 56631, 56660, 56690, 56719, 56749, 56778, 56808, 56837, 56867, 56897, 56926,
    56956, 56985, 57015, 57044, 57074, 57103, 57133, 57162, 57192, 57221, 57251, 57280, 57310, 57340, 57369, 57399, 57429, 57458, 57487, 57517,
    57546, 57576, 57605, 57634, 57664, 57694, 57723, 57753, 57783, 57813, 57842, 57871, 57901, 57930, 57959, 57989, 58018, 58048, 58077, 58107,
    58137, 58167, 58196, 58226, 58255, 58285, 58314, 58343, 58373, 58402, 58432, 58461, 58491, 58521, 58551, 58580, 58610, 58639, 58669, 58698,
    58727, 58757, 58786, 58816, 58845, 58875, 58905, 58934, 58964, 58994, 59023, 59053, 59082, 59111, 59141, 59170, 59200, 59229, 59259, 59288,
    59318, 59348, 59377, 59407, 59436, 59466, 59495, 59525, 59554, 59584, 59613, 59643, 59672, 59702, 59731, 59761, 59791, 59820, 59850, 59879,
    59909, 59939, 59968, 59997, 60027, 60056, 60086, 60115, 60145, 60174, 60204, 60234, 60264, 60293, 60323, 60352, 60381, 60411, 60440, 60469,
    60499, 60528, 60558, 60588, 60618, 60648, 60677, 60707, 60736, 60765, 60795, 60824, 60853, 60883, 60912, 60942, 60972, 61002, 61031, 61061,
    61090, 61120, 61149, 61179, 61208, 61237, 61267, 61296, 61326, 61356, 61385, 61415, 61445, 61474, 61504, 61533, 61563, 61592, 61621, 61651,
    61680, 61710, 61739, 61769, 61799, 61828, 61858, 61888, 61917, 61947, 61976, 62006, 62035, 62064, 62094, 62123, 62153, 62182, 62212, 62242,
    62271, 62301, 62331, 62360, 62390, 62419, 62448, 62478, 62507, 62537, 62566, 62596, 62625, 62655, 62685, 62715, 62744, 62774, 62803, 62832,
    62862, 62891, 62921, 62950, 62980, 63009, 63039, 63069, 63099, 63128, 63157, 63187, 63216, 63246, 63275, 63305, 63334, 63363, 63393, 63423,
    63453, 63482, 63512, 63541, 63571, 63600, 63630, 63659, 63689, 63718, 63747, 63777, 63807, 63836, 63866, 63895, 63925, 63955, 63984, 64014,
    64043, 64073, 64102, 64131, 64161, 64190, 64220, 64249, 64279, 64309, 64339, 64368, 64398, 64427, 64457, 64486, 64515, 64545, 64574, 64603,
    64633, 64663, 64692, 64722, 64752, 64782, 64811, 64841, 64870, 64899, 64929, 64958, 64987, 65017, 65047, 65076, 65106, 65136, 65166, 65195,
    65225, 65254, 65283, 65313, 65342, 65371, 65401, 65431, 65460, 65490, 65520, 65549, 65579, 65608, 65638, 65667, 65697, 65726, 65755, 65785,
    65815, 65844, 65874, 65903, 65933, 65963, 65992, 66022, 66051, 66081, 66110, 66140, 66169, 66199, 66228, 66258, 66287, 66317, 66346, 66376,
    66405, 66435, 66465, 66494, 66524, 66553, 66583, 66612, 66641, 66671, 66700, 66730, 66760, 66789, 66819, 66849, 66878, 66908, 66937, 66967,
    66996, 67025, 67055, 67084, 67114, 67143, 67173, 67203, 67233, 67262, 67292, 67321, 67351, 67380, 67409, 67439, 67468, 67497, 67527, 67557,
    67587, 67617, 67646, 67676, 67705, 67735, 67764, 67793, 67823, 67852, 67882, 67911, 67941, 67971, 68000, 68030, 68060, 68089, 68119, 68148,
    68177, 68207, 68236, 68266, 68295, 68325, 68354, 68384, 68414, 68443, 68473, 68502, 68532, 68561, 68591, 68620, 68650, 68679, 68708, 68738,
    68768, 68797, 68827, 68857, 68886, 68916, 68946, 68975, 69004, 69034, 69063, 69092, 69122, 69152, 69181, 69211, 69240, 69270, 69300, 69330,
    69359, 69388, 69418, 69447, 69476, 69506, 69535, 69565, 69595, 69624, 69654, 69684, 69713, 69743, 69772, 69802, 69831, 69861, 69890, 69919,
    69949, 69978, 70008, 70038, 70067, 70097, 70126, 70156, 70186, 70215, 70245, 70274, 70303, 70333, 70362, 70392, 70421, 70451, 70481, 70510,
    70540, 70570, 70599, 70629, 70658, 70687, 70717, 70746, 70776, 70805, 70835, 70864, 70894, 70924, 70954, 70983, 71013, 71042, 71071, 71101,
    71130, 71159, 71189, 71218, 71248, 71278, 71308, 71337, 71367, 71397, 71426, 71455, 71485, 71514, 71543, 71573, 71602, 71632, 71662, 71691,
    71721, 71751, 71781, 71810, 71839, 71869, 71898, 71927, 71957, 71986, 72016, 72046, 72075, 72105, 72135, 72164, 72194, 72223, 72253, 72282,
    72311, 72341, 72370, 72400, 72429, 72459, 72489, 72518, 72548, 72577, 72607, 72637, 72666, 72695, 72725, 72754, 72784, 72813, 72843, 72872,
    72902, 72931, 72961, 72991, 73020, 73050, 73080, 73109, 73139, 73168, 73197, 73227, 73256, 73286, 73315, 73345, 73375, 73404, 73434, 73464,
    73493, 73523, 73552, 73581, 73611, 73640, 73669, 73699, 73729, 73758, 73788, 73818, 73848, 73877, 73907, 73936, 73965, 73995, 74024, 74053,
    74083, 74113, 74142, 74172, 74202, 74231, 74261, 74291, 74320, 74349, 74379, 74408, 74437, 74467, 74497, 74526, 74556, 74586, 74615, 74645,
    74675, 74704, 74733, 74763, 74792, 74822, 74851, 74881, 74910, 74940, 74969, 74999, 75029, 75058, 75088, 75117, 75147, 75176, 75206, 75235,
    75264, 75294, 75323, 75353, 75383, 75412, 75442, 75472, 75501, 75531, 75560, 75590, 75619, 75648, 75678, 75707, 75737, 75766, 75796, 75826,
    75856, 75885, 75915, 75944, 75974, 76003, 76032, 76062, 76091, 76121, 76150, 76180, 76210, 76239, 76269, 76299, 76328, 76358, 76387, 76416,
    76446, 76475, 76505, 76534, 76564, 76593, 76623, 76653, 76682, 76712, 76741, 76771, 76801, 76830, 76859, 76889, 76918, 76948, 76977, 77007,
    77036, 77066, 77096, 77125, 77155, 77185, 77214, 77243, 77273, 77302, 77332, 77361, 77390, 77420, 77450, 77479, 77509, 77539, 77569, 77598,
    77627, 77657, 77686, 77715, 77745, 77774, 77804, 77833, 77863, 77893, 77923, 77952, 77982, 78011, 78041, 78070, 78099, 78129, 78158, 78188,
    78217, 78247, 78277, 78307, 78336, 78366, 78395, 78425, 78454, 78483, 78513, 78542, 78572, 78601, 78631, 78661, 78690, 78720, 78750, 78779,
    78808, 78838, 78867, 78897, 78926, 78956, 78985, 79015, 79044, 79074, 79104, 79133, 79163, 79192, 79222, 79251, 79281, 79310, 79340, 79369,
    79399, 79428, 79458, 79487, 79517, 79546, 79576, 79606, 79635, 79665, 79695, 79724, 79753, 79783, 79812, 79841, 79871, 79900, 79930, 79960,
    79990
];

function UQCal(date) {
    date = (date ? date : new Date());

    this.Gday = date.getDate();
    this.Gmonth = date.getMonth();
    this.Gyear = date.getFullYear();
    this.Hday = null;
    this.Hmonth = null;
    this.Hyear = null;
    this.ilunnum = null;
    this.Hlength = null;
    this.julday = null;
    this.wkday = null;

    this.gmod = function(n, m) {
        return ((n % m) + m) % m;
    }
    this.convert = function() {
            day = this.Gday;
            month = this.Gmonth;
            year = this.Gyear;

            var m = month + 1,
                y = year;

            if (m < 3) {
                y -= 1;
                m += 12;
            }

            // determine offset between Julian and Gregorian calendar 
            var a = Math.floor(y / 100.),
                jgc = a - Math.floor(a / 4.) - 2,
                cjdn, b, c, d, wd, mcjdn;

            // compute Chronological Julian Day Number (CJDN)
            cjdn = Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + day - jgc - 1524;

            a = Math.floor((cjdn - 1867216.25) / 36524.25);
            jgc = a - Math.floor(a / 4.) + 1;
            b = cjdn + jgc + 1524;
            c = Math.floor((b - 122.1) / 365.25);
            d = Math.floor(365.25 * c);
            month = Math.floor((b - d) / 30.6001);
            day = (b - d) - Math.floor(30.6001 * month);

            if (month > 13) {
                c += 1;
                month -= 12;
            }

            month -= 1;
            year = c - 4716;

            //  output Western calendar date
            this.Gday = day;
            this.Gmonth = month;
            this.Gyear = year;

            // compute weekday
            wd = this.gmod(cjdn + 1, 7) + 1;

            // output Chronological Julian Day Number and weekday
            this.julday = cjdn;
            this.wkday = wd - 1;

            // compute Modified Chronological Julian Day Number (MCJDN)
            mcjdn = cjdn - 2400000;

            // the MCJDN's of the start of the lunations in the Umm al-Qura calendar are stored in 'islamcalendar_dat.js'  
            for (var i = 0; i < ummalqura_dat.length; i++) {
                if (ummalqura_dat[i] > mcjdn) break;
            }

            // compute and output the Umm al-Qura calendar date
            iln = i + 16260;
            ii = Math.floor((iln - 1) / 12);
            iy = ii + 1;
            im = iln - 12 * ii;
            id = mcjdn - ummalqura_dat[i - 1] + 1;
            ml = ummalqura_dat[i] - ummalqura_dat[i - 1];

            this.Hday = id;
            this.Hmonth = im;
            this.Hyear = iy;
            this.ilunnum = iln;
            this.Hlength = ml;
            return this;
        },
        this.getDaysInMonth = function() {
            day = this.Gday;
            month = this.Gmonth;
            year = this.Gyear;

            var m = month + 1,
                y = year;

            if (m < 3) {
                y -= 1;
                m += 12;
            }

            // determine offset between Julian and Gregorian calendar 
            var a = Math.floor(y / 100.),
                jgc = a - Math.floor(a / 4.) - 2,
                cjdn, b, c, d, wd, mcjdn;
            // compute Chronological Julian Day Number (CJDN)
            cjdn = Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + day - jgc - 1524;

            a = Math.floor((cjdn - 1867216.25) / 36524.25);
            jgc = a - Math.floor(a / 4.) + 1;
            b = cjdn + jgc + 1524;
            c = Math.floor((b - 122.1) / 365.25);
            d = Math.floor(365.25 * c);
            month = Math.floor((b - d) / 30.6001);
            day = (b - d) - Math.floor(30.6001 * month);

            if (month > 13) {
                c += 1;
                month -= 12;
            }

            month -= 1;
            year = c - 4716;

            //  output Western calendar date
            this.Gday = day;
            this.Gmonth = month;
            this.Gyear = year;

            // compute weekday
            wd = this.gmod(cjdn + 1, 7) + 1;

            // output Chronological Julian Day Number and weekday
            this.julday = cjdn;
            this.wkday = wd - 1;

            // compute Modified Chronological Julian Day Number (MCJDN)
            mcjdn = cjdn - 2400000;

            // the MCJDN's of the start of the lunations in the Umm al-Qura calendar are stored in 'islamcalendar_dat.js'  
            for (var i = 0; i < ummalqura_dat.length; i++) {
                if (ummalqura_dat[i] > mcjdn) break;
            }

            // compute and output the Umm al-Qura calendar date
            var iln = i + 16260,
                ii = Math.floor((iln - 1) / 12),
                iy = ii + 1,
                im = iln - 12 * ii,
                id = mcjdn - ummalqura_dat[i - 1] + 1,
                ml = ummalqura_dat[i] - ummalqura_dat[i - 1];

            this.Hday = id;
            this.Hmonth = im;
            this.Hyear = iy;
            this.ilunnum = iln;
            this.Hlength = ml;
            return this.Hlength;
        }
}

(function() {

    Ext.define('Ext.ux.HijriDate', {
        override: 'Ext.Date',

        createHijri: function(year, month, date) {
            var g = Ext.Date.HijriConverter.hijriToGregorian([year, month, date]);
            return g;
        },

        parseHijri: function(hijriString, strict) {
            var g, d,
                split = hijriString.split('-'),
                jy = parseInt(split[0], 10),
                jm = parseInt(split[1], 10),
                jd = parseInt(split[2], 10);
            if (isNaN(jy) || isNaN(jm) || isNaN(jd) || jy > 1500 || jy < 1 || jm > 12 || jm < 1 || jd > 31 || jd < 1) {
                return null;
            }
            g = Ext.Date.HijriConverter.hijriToGregorian([jy, jm, jd]);
            if (Ext.isArray(g))
                d = new Date(g[0], g[1] - 1, g[2], 12);
            else
                d = g;
            if (strict &&
                (!d || Ext.Date.getHijriFullYear(d) !== jy || Ext.Date.getHijriMonth(d) + 1 !== jm || Ext.Date.getHijriDate(d) !== jd)) {
                return null;
            }
            return d;
        },

        convertToHijri: function(date) {
            var j = Ext.Date.HijriConverter.gregorianToHijri(date);
            return {
                hijriYear: j[0],
                hijriMonth: j[1] - 1,
                hijriDate: j[2]
            };
        },

        getHijriFullYear: function(date) {
            return Ext.Date.convertToHijri(date).hijriYear;
        },

        getHijriMonth: function(date) {
            return Ext.Date.convertToHijri(date).hijriMonth;
        },

        getHijriDate: function(date) {
            return Ext.Date.convertToHijri(date).hijriDate;
        },

        addHijri: function(date, interval, value, action) {
            var jd, gd,
                d = new Date(date.getTime());
            if (!interval || value === 0) {
                return d;
            }
            jd = Ext.Date.convertToHijri(d);
            switch (interval.toLowerCase()) {
                case Ext.Date.DAY:
                    jd.hijriDate += value;
                    break;
                case Ext.Date.MONTH:
                    jd.hijriMonth += value;
                    jd.hijriYear += Math.floor(jd.hijriMonth / 12);
                    jd.hijriMonth %= 12;
                    if (jd.hijriMonth < 0) {
                        jd.hijriMonth += 12;
                    }
                    break;
                case Ext.Date.YEAR:
                    jd.hijriYear += value;
                    break;
            }
            gd = Ext.Date.HijriConverter.hijriToGregorian([jd.hijriYear, jd.hijriMonth, jd.hijriDate]);
            d.setFullYear(gd[0]);
            d.setMonth(gd[1]);
            d.setDate(gd[2]);
            return d;
        },

        hijriMonthNames: ['Muh', 'Saf', 'Rab1', 'Rab2', 'Jum1', 'Jum2', 'Raj', 'Sha\'', 'Ram', 'Shaw', 'DhuQ', 'DhuH'],
        hijriDayNames: ['Ah', 'Ith', 'Th', 'Ar', 'Kh', 'Ju', 'Sa'],
    }, function() {
        Ext.apply(Ext.Date.formatCodes, {
            r: "Ext.Date.getHijriDate(this)",
            R: "Ext.String.leftPad(Ext.Date.getHijriDate(this), 2, '0')",
            q: "(Ext.Date.getHijriMonth(this) + 1)",
            Q: "Ext.String.leftPad(Ext.Date.getHijriMonth(this) + 1, 2, '0')",
            e: "Ext.Date.hijriMonthNames[Ext.Date.getHijriMonth(this)]",
            b: "('' + Ext.Date.getHijriFullYear(this)).substring(2, 4)",
            B: "Ext.Date.getHijriFullYear(this)"
        });

        Ext.apply(Ext.Date.formatFunctions, {
            'Hijri': function() {
                var jd = Ext.Date.convertToHijri(this);
                return jd.hijriYear + '-' +
                    Ext.String.leftPad(jd.hijriMonth + 1, 2, '0') + '-' +
                    Ext.String.leftPad(jd.hijriDate, 2, '0');
            }
        });

        Ext.apply(Ext.Date.parseFunctions, {
            'Hijri': Ext.Date.parseHijri,
            'B-Q-R': Ext.Date.parseHijri,
            'B-q-r': Ext.Date.parseHijri,
            'b-q-r': function(value, strict) {
                return Ext.Date.parseHijri('13' + value, strict);
            },
            'b-Q-R': function(value, strict) {
                return Ext.Date.parseHijri('13' + value, strict);
            },
            'B': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(value + '-' + (Ext.Date.getHijriMonth(now) + 1) + '-' + Ext.Date.getHijriDate(now), strict);
            },
            'b': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri('13' + value + '-' + (Ext.Date.getHijriMonth(now) + 1) + '-' + Ext.Date.getHijriDate(now), strict);
            },
            'q': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(Ext.Date.getHijriFullYear(now) + '-' + value + '-' + Ext.Date.getHijriDate(now), strict);
            },
            'Q': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(Ext.Date.getHijriFullYear(now) + '-' + value + '-' + Ext.Date.getHijriDate(now), strict);
            },
            'r': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(Ext.Date.getHijriFullYear(now) + '-' + (Ext.Date.getHijriMonth(now) + 1) + '-' + value, strict);
            },
            'R': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(Ext.Date.getHijriFullYear(now) + '-' + (Ext.Date.getHijriMonth(now) + 1) + '-' + value, strict);
            },
            'b-q': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri('13' + value + '-' + Ext.Date.getHijriDate(now), strict);
            },
            'B-q': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(value + '-' + Ext.Date.getHijriDate(now), strict);
            },
            'B-Q': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(value + '-' + Ext.Date.getHijriDate(now), strict);
            },
            'b-Q': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri('13' + value + '/' + Ext.Date.getHijriDate(now), strict);
            },
            'q-r': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(Ext.Date.getHijriFullYear(now) + '/' + value, strict);
            },
            'Q-r': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(Ext.Date.getHijriFullYear(now) + '/' + value, strict);
            },
            'Q-R': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(Ext.Date.getHijriFullYear(now) + '/' + value, strict);
            },
            'q-R': function(value, strict) {
                var now = new Date();
                return Ext.Date.parseHijri(Ext.Date.getHijriFullYear(now) + '/' + value, strict);
            }
        });
    });
}());


(function() {

    Ext.define('Ext.ux.Hijri', {
        override: 'Ext.Date',
        HijriConverter: {
            gregorianToHijri: function(date) {
                var dObj, cDate, dateDiff, newDate;
                dObj = new UQCal(date);
                cDate = dObj.convert();
                return [cDate.Hyear, cDate.Hmonth, cDate.Hday];
            },
            hijriToGregorian: function(j) {
                var day = 2,
                    m = 6,
                    y = 2016;

                // append January and February to the previous year (i.e. regard March as
                // the first month of the year in order to simplify leapday corrections)

                if (m < 3) {
                    y -= 1;
                    m += 12;
                }

                // determine offset between Julian and Gregorian calendar 

                var a = Math.floor(y / 100.),
                    jgc = a - Math.floor(a / 4.) - 2,
                    b, c, d;

                // compute Chronological Julian Day Number (CJDN)

                var cjdn = Math.floor(365.25 * (y + 4716)) + Math.floor(30.6001 * (m + 1)) + day - jgc - 1524;
                a = Math.floor((cjdn - 1867216.25) / 36524.25);
                jgc = a - Math.floor(a / 4.) + 1;
                b = cjdn + jgc + 1524;
                c = Math.floor((b - 122.1) / 365.25);
                d = Math.floor(365.25 * c);
                month = Math.floor((b - d) / 30.6001);
                day = (b - d) - Math.floor(30.6001 * month);


                if (month > 13) {
                    c += 1;
                    month -= 12;
                }

                month -= 1;
                year = c - 4716;

                var wd = this.gmod(cjdn + 1, 7) + 1;

                // output Chronological Julian Day Number and weekday

                var julday = cjdn;
                var wkday = wd - 1;

                // compute Modified Chronological Julian Day Number (MCJDN)

                var mcjdn = cjdn - 2400000;

                // the MCJDN's of the start of the lunations in the Umm al-Qura calendar are stored in 'islamcalendar_dat.js'  
                for (var i = 0; i < ummalqura_dat.length; i++) {
                    if (ummalqura_dat[i] > mcjdn) break;
                }

                // compute and output the Umm al-Qura calendar date

                var iln = i + 16260,
                    ii = Math.floor((iln - 1) / 12),
                    iy = ii + 1,
                    im = iln - 12 * ii,
                    id = mcjdn - ummalqura_dat[i - 1] + 1,
                    ml = ummalqura_dat[i] - ummalqura_dat[i - 1],

                    iday1 = id,
                    imonth1 = im,
                    iyear1 = iy,
                    ilunnum = iln,
                    imlength = ml;
                var dateCount = this.dateDifference(j[2], j[1], j[0], id, imonth1, iyear1, day, m - 1, y);
                var todDate = new Date(m + "," + day + "," + y);
                var date = this.addDays(todDate, dateCount)
                return date;
            },

            addDays: function(date, days) {
                var addedDate = date;
                addedDate.setDate(addedDate.getDate() + days);
                return addedDate;
            },
            gmod: function(n, m) {
                // generalized modulo function (n mod m) also valid for negative values of n
                return ((n % m) + m) % m;
            },
            dateDifference: function(d, m, y, ud, um, uy, cd, cm, cy) {
                var difYear = y - uy,
                    count = 0,
                    daysGeorge, tDay = cd,
                    tMonth = cm + 1,
                    tYear = cy;

                if (difYear < 0) {
                    difYear = -1 * difYear;
                    if (m > um) {

                        var mondif = (((difYear - 1) * 12) + (12 - (m - um)));
                        count = this.monthlesstoday(mondif, tDay, tMonth, tYear, ud, d)
                    } else if (m < um) {

                        var mondif = ((difYear * 12) - m + um);
                        count = this.monthlesstoday(mondif, tDay, tMonth, tYear, ud, d);
                    } else if (m == um) {
                        var mondif = (((difYear - 1) * 12) + (12 - (m - um)));
                        count = this.monthlesstoday(mondif, tDay, tMonth, tYear, ud, d)
                    } else {
                        alert('date is invalid!!');
                    }

                } else if (difYear > 0) {
                    if (m > um) {
                        var mondif = ((difYear * 12) + (m - um));
                        count = this.monthgreaterToday(mondif, tDay, tMonth, tYear, ud, d)
                    } else if (m < um) {
                        var mondif = (((difYear - 1) * 12) + (12 - (um - m)));
                        count = this.monthgreaterToday(mondif, tDay, tMonth, tYear, ud, d);
                    } else if (m == um) {
                        var mondif = ((difYear * 12) + (m - um));
                        count = this.monthgreaterToday(mondif, tDay, tMonth, tYear, ud, d)
                    } else {
                        alert('date is invalid!!');
                    }

                } else if (difYear == 0) {
                    if (m > um) {
                        var mondif = m - um;
                        count = this.monthgreaterToday(mondif, tDay, tMonth, tYear, ud, d)

                    } else if (m < um) {
                        var mondif = um - m;
                        count = this.monthlesstoday(mondif, tDay, tMonth, tYear, ud, d)

                    } else if (m == um) {
                        count = d - ud; //solved if month are equal and year is equal
                    } else {
                        alert('date is invalid!!');
                    };
                };

                return count;
            },
            monthlesstoday: function(mondif, tDay, tMonth, tYear, ud, d) {
                var count;
                for (var i = 0; i <= mondif; i++) {
                    var temCount = this.monthLength(tDay, tMonth, tYear);
                    if (i == 0) {
                        count = (ud - 2 * ud)
                    } else if (i == (mondif)) {
                        count -= (temCount - d)
                    } else {
                        count -= temCount;
                    };
                    var temDate = new Date(tMonth.toString() + "," + tDay.toString() + "," + tYear.toString());
                    var dateAdd = this.addDays(temDate, -temCount);
                    tDay = dateAdd.getDate(),
                        tMonth = dateAdd.getMonth() + 1,
                        tYear = this.getYr(dateAdd.getYear());
                }
                return count;
            },
            monthgreaterToday: function(mondif, tDay, tMonth, tYear, ud, d) {
                var count;
                for (var i = 0; i < mondif; i++) {
                    var temCount = this.monthLength(tDay, tMonth, tYear);
                    if (i == 0) {
                        if (i == (mondif - 1)) {
                            count = temCount - ud + d;
                        } else {
                            count = temCount - ud;
                        }
                    } else if (i == (mondif - 1)) {
                        if ((mondif - 1) == 0) {
                            count += d
                        } else {
                            count += (temCount + d)
                        }
                    } else {
                        count += temCount;
                    };
                    var temDate = new Date(tMonth.toString() + "," + tDay.toString() + "," + tYear.toString());
                    var dateAdd = this.addDays(temDate, temCount);
                    tDay = dateAdd.getDate(),
                        tMonth = dateAdd.getMonth() + 1,
                        tYear = this.getYr(dateAdd.getYear());
                }
                return count;
            },
            getYr: function(year) {
                if (year < 100) {
                    year = '19' + year;
                } else {
                    year = 1900 + parseInt(year);
                }
                return parseInt(year, 10);
            },
            monthLength: function(md, mm, my) {
                if (mm < 3) {
                    my -= 1;
                    mm += 12;
                }
                var a = Math.floor(my / 100.),
                    jgc = a - Math.floor(a / 4.) - 2,
                    cjdn = Math.floor(365.25 * (my + 4716)) + Math.floor(30.6001 * (mm + 1)) + md - jgc - 1524,
                    mcjdn = cjdn - 2400000;
                for (var i = 0; i < ummalqura_dat.length; i++) {
                    if (ummalqura_dat[i] > mcjdn) break;
                }
                var mml = ummalqura_dat[i] - ummalqura_dat[i - 1],
                    imlength = mml;
                return imlength;
            }
        }
    });
}());
// HIJRI - Date Plugin
Ext.define('Ext.ramco.picker.Date', {
    extend: 'Ext.picker.Date',
    renderTpl: [
        '<div id="{id}-innerEl" data-ref="innerEl" role="presentation">',
        '<div class="{baseCls}-header">',
        '<div id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-prev {baseCls}-arrow" role="presentation" title="{prevText}"></div>',
        '<div id="{id}-middleBtnEl" data-ref="middleBtnEl" class="{baseCls}-month" role="heading">{%this.renderMonthBtn(values, out)%}</div>',
        '<div id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-next {baseCls}-arrow" role="presentation" title="{nextText}"></div>',
        '</div>',
        '<table role="grid" id="{id}-eventEl" data-ref="eventEl" class="{baseCls}-inner" cellspacing="0" tabindex="0" aria-readonly="true">',
        '<thead>',
        '<tr role="row">',
        '<tpl for="dayNames">',
        '<th role="columnheader" class="{parent.baseCls}-column-header" aria-label="{.}">',
        '<div role="presentation" class="{parent.baseCls}-column-header-inner">{.:this.firstInitial}</div>',
        '</th>',
        '</tpl>',
        '</tr>',
        '</thead>',
        '<tbody>',
        '<tr role="row">',
        '<tpl for="days">',
        '{#:this.isEndOfWeek}',
        '<td role="gridcell">',
        '<div hidefocus="on" class="{parent.baseCls}-date"></div>',
        '</td>',
        '</tpl>',
        '</tr>',
        '</tbody>',
        '</table>',
        '<tpl if="showToday">',
        '<div id="{id}-footerEl" data-ref="footerEl" role="presentation" class="{baseCls}-footer">{%this.renderTodayBtn(values, out)%}</div>',
        '</tpl>',
        // These elements are used with Assistive Technologies such as screen readers 
        '<div id="{id}-todayText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{todayText}.</div>',
        '<div id="{id}-ariaMinText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{ariaMinText}.</div>',
        '<div id="{id}-ariaMaxText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{ariaMaxText}.</div>',
        '<div id="{id}-ariaDisabledDaysText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{ariaDisabledDaysText}.</div>',
        '<div id="{id}-ariaDisabledDatesText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{ariaDisabledDatesText}.</div>',
        '</div>',
        {
            firstInitial: function(value) {
                return Ext.ramco.picker.Date.prototype.getDayInitial(value);
            },
            isEndOfWeek: function(value) {
                // convert from 1 based index to 0 based 
                // by decrementing value once. 
                value--;
                var end = value % 7 === 0 && value !== 0;
                return end ? '</tr><tr role="row">' : '';
            },
            renderTodayBtn: function(values, out) {
                Ext.DomHelper.generateMarkup(values.$comp.todayBtn.getRenderTree(), out);
            },
            renderMonthBtn: function(values, out) {
                Ext.DomHelper.generateMarkup(values.$comp.monthBtn.getRenderTree(), out);
            }
        }
    ],
    getDayInitial: function(value) {
        return value;
    }
});
(function() {
    var safeParse, createPicker, afterCreateMonthPicker, afterShowMonthPicker,
        onOkClick, showPrevMonth, showNextMonth, showPrevYear, showNextYear, update, fullUpdate;

    Ext.define('Ext.ux.hijriDatePlugin', {
        extend: 'Ext.AbstractPlugin',
        alias: 'plugin.hijridate',

        statics: {
            enabled: true,
            localization: {
                DatePicker: {},
                DateField: {}
            }
        },

        constructor: function() {
            if (this.enabled === undefined) {
                this.enabled = this.statics().enabled;
            }
        },

        /**
         * Initializes this plugin. Some methods in the main class are instrumented, others are replaced.
         * @param {Ext.Component} component Component that should be instrumented.
         */
        init: function(component) {
            if (!this.enabled) {
                return;
            }
            if (component instanceof Ext.DatePicker) { // for both Ext.DatePicker & Ext.menu.DateMenu
                component.monthNames = Ext.Date.hijriMonthNames;
                component.createMonthPicker = Ext.Function.createSequence(component.createMonthPicker, afterCreateMonthPicker);
                component.showMonthPicker = Ext.Function.createSequence(component.showMonthPicker, afterShowMonthPicker);
                component.onOkClick = onOkClick;
                component.showPrevMonth = showPrevMonth;
                component.showNextMonth = showNextMonth;
                component.showPrevYear = showPrevYear;
                component.showNextYear = showNextYear;
                component.update = update;
                component.fullUpdate = fullUpdate;
                Ext.apply(component, this.statics().localization.DatePicker);
                component.dayNames = component.dayNames.slice(component.startDay).concat(component.dayNames.slice(0, component.startDay));
                component.setValue(component.value);
            } else if (component instanceof Ext.form.field.Date) { // for Ext.form.field.Date
                component.ctype = "h" + component.dataType;
                component.createPicker = createPicker;
                component.safeParse = safeParse;
                Ext.apply(component, this.statics().localization.DateField);
                component.setValue(component.value);
            }
        },

    });

    /**
     * Replaces DateField.safeParse method. Since that method adds an hour field to format,
     * the parse functions in Date.parseFunctions are not used. Here we skip the hour conversion part.
     * It may produce errors when using different time zones.
     * @param {String} value The value to attempt to parse.
     * @param {String} format A valid date format (see {@link Ext.Date#parse}).
     * @return {Date} The parsed Date object, or null if the value could not be successfully parsed.
     */
    safeParse = function(value, format) {
        var me = this,
            result = null,
            strict = me.useStrict,
            parsedDate;

        parsedDate = Ext.Date.parseDate(value, format, strict);
        if (parsedDate) {
            result = Ext.Date.add(parsedDate, Ext.Date.HOUR, -12);
        }
        return result;
    };

    /**
     * Override create picker in DateField.
     */
    createPicker = function() {
        var me = this,
            format = Ext.String.format;

        return new Ext.ramco.picker.Date(Ext.applyIf({
            pickerField: me,
            width: 230,
            rtl: true,
            ownerCt: me.ownerCt,
            renderTo: Ext.getBody(),
            floating: true,
            hidden: true,
            focusOnShow: true,
            minDate: me.minValue,
            maxDate: me.maxValue,
            disabledDatesRE: me.disabledDatesRE,
            disabledDatesText: me.disabledDatesText,
            disabledDays: me.disabledDays,
            disabledDaysText: me.disabledDaysText,
            format: me.format,
            showToday: me.showToday,
            startDay: me.startDay,
            minText: format(me.minText, me.formatDate(me.minValue)),
            maxText: format(me.maxText, me.formatDate(me.maxValue)),
            listeners: {
                scope: me,
                select: me.onSelect
            },
            keyNavConfig: {
                esc: function() {
                    me.collapse();
                }
            },
            monthNames: Ext.Date.hijriMonthNames,
            createMonthPicker: Ext.Function.createSequence(Ext.picker.Date.prototype.createMonthPicker, afterCreateMonthPicker),
            showMonthPicker: Ext.Function.createSequence(Ext.picker.Date.prototype.showMonthPicker, afterShowMonthPicker),
            onOkClick: onOkClick,
            showPrevMonth: showPrevMonth,
            showNextMonth: showNextMonth,
            showPrevYear: showPrevYear,
            showNextYear: showNextYear,
            update: update,
            fullUpdate: fullUpdate
        }, Ext.ux.hijriDatePlugin.localization.DatePicker));
    };

    afterCreateMonthPicker = function() {
        if (this.mpMonthsInstrumented) {
            return;
        }
        this.mpMonthsInstrumented = true;
        var monthNames = this.monthNames,
            monthPicker = this.monthPicker;
        monthPicker.months.each(function(m, a, i) {
            m.update(monthNames[monthPicker.resolveOffset(i, 6)]);
        });
    };

    /**
     * Corrects month picker's selected month and year.
     */
    afterShowMonthPicker = function() {
        if (!this.disabled) {
            this.monthPicker.setValue([
                Ext.Date.getHijriMonth(this.activeDate || this.value),
                Ext.Date.getHijriFullYear(this.activeDate || this.value)
            ]);
        }
    };

    /**
     * Selects correct month and year when OK button is selected.
     */
    onOkClick = function(picker, value) {
        var me = this,
            month = value[0],
            year = value[1],
            date = Ext.Date.createHijri(year, month, me.getActive().getDate()),
            uqCal = new UQCal(date),
            days = uqCal.getDaysInMonth();

        if (Ext.Date.getHijriMonth(date) !== month) {
            // 'fix' the JS rolling date conversion if needed			
            date = Ext.Date.createHijri(year, month, days);
        }
        me.setValue(date);
        me.hideMonthPicker();
    };

    /**
     * Handles showing previous month.
     */
    showPrevMonth = function() {
        var uqCal = new UQCal(this.activeDate),
            convert = uqCal.convert(),
            dt = Ext.Date.createHijri(convert.Hyear, convert.Hmonth - 1, 1);
        //var dt = Ext.Date.addHijri(this.activeDate, Ext.Date.MONTH, -1);
        this.update(dt, null, 'prev');
    };

    /**
     * Handles showing next month.
     */
    showNextMonth = function() {
        var uqCal = new UQCal(this.activeDate),
            convert = uqCal.convert(),
            dt = Ext.Date.createHijri(convert.Hyear, convert.Hmonth + 1, 1);
        //var dt = Ext.Date.addHijri(this.activeDate, Ext.Date.MONTH, 1);
        this.update(dt, null, 'next');
    };

    /**
     * Handles showing previous year.
     */
    showPrevYear = function() {
        this.update(Ext.Date.addHijri(this.activeDate, Ext.Date.YEAR, -1));
    };

    /**
     * Handles showing next year.
     */
    showNextYear = function() {
        this.update(Ext.Date.addHijri(this.activeDate, Ext.Date.YEAR, 1));
    };

    update = function(newdate, forceRefresh, action) {
        var me = this,
            active = me.activeDate;

        if (me.rendered) {
            me.activeDate = newdate;
            if (!forceRefresh && active && me.el && Ext.Date.getHijriMonth(active) === Ext.Date.getHijriMonth(newdate) && Ext.Date.getHijriFullYear(active) === Ext.Date.getHijriFullYear(newdate)) {
                me.selectedUpdate(newdate, active);
            } else {
                me.fullUpdate(newdate, active, action);
            }
        }
        return me;
    };

    fullUpdate = function(newdate, active, action) {
        var me = this,
            cells = me.cells.elements,
            textNodes = me.textNodes,
            disabledCls = me.disabledCellCls,
            eDate = Ext.Date,
            i = 0,
            extraDays = 0,
            visible = me.isVisible(),
            newDate = +eDate.clearTime(newdate, true),
            today = +eDate.clearTime(new Date()),
            min = me.minDate ? eDate.clearTime(me.minDate, true) : Number.NEGATIVE_INFINITY,
            max = me.maxDate ? eDate.clearTime(me.maxDate, true) : Number.POSITIVE_INFINITY,
            ddMatch = me.disabledDatesRE,
            ddText = me.disabledDatesText,
            ddays = me.disabledDays ? me.disabledDays.join('') : false,
            ddaysText = me.disabledDaysText,
            format = me.format,
            uqCal = new UQCal(newdate),
            convert = uqCal.convert(),
            days = uqCal.Hlength,
            startingPos = convert.wkday,
            previousMonth = eDate.createHijri(convert.Hyear, convert.Hmonth - 1, 1),
            longDayFormat = me.longDayFormat,
            prevStart,
            current,
            disableToday,
            tempDate,
            setCellClass,
            html,
            cls,
            nextdate,
            formatValue,
            value;

        if (uqCal.Hday != 1) {
            me.olddate = new Date(uqCal.Gyear, (uqCal.Gmonth - 1), uqCal.Gday);
            var dateDiff = 1 - uqCal.Hday,
                dObj = null,
                cDate = null,
                currDate = Ext.Date.HijriConverter.addDays(this.olddate, dateDiff);
            dObj = new UQCal(currDate);
            cDate = dObj.convert();
            startingPos = cDate.wkday;
        }

        if (startingPos < 0) {
            startingPos += 7;
        }

        days += startingPos;
        uqCal = new UQCal(previousMonth);
        convert = uqCal.convert();
        prevStart = convert.Hlength - startingPos;
        if (action == 'next' || action == 'prev')
            current = eDate.createHijri(eDate.getHijriFullYear(newdate), eDate.getHijriMonth(newdate), (prevStart + 1));
        else
            current = eDate.createHijri(eDate.getHijriFullYear(newdate), eDate.getHijriMonth(newdate), prevStart + 1);
        current.setHours(me.initHour);

        if (me.showToday) {
            tempDate = eDate.clearTime(new Date());
            disableToday = (tempDate < min || tempDate > max ||
                (ddMatch && format && ddMatch.test(eDate.dateFormat(tempDate, format))) ||
                (ddays && ddays.indexOf(tempDate.getDay()) !== -1));

            if (!me.disabled) {
                me.todayBtn.setDisabled(disableToday);
            }
        }

        setCellClass = function(cell, cls) {
            nextdate = nextdate || current;
            value = +eDate.clearTime(current, true);
            cell.title = eDate.format(nextdate, longDayFormat) + ' DATE' + Ext.Date.format(new Date(value), 'd-m-Y');
            // store dateValue number as an expando
            cell.firstChild.dateValue = value;
            if (value === today) {
                cls += ' ' + me.todayCls;
                cell.title = me.todayText;

                // Extra element for ARIA purposes
                /*me.todayElSpan = Ext.DomHelper.append(cell.firstChild, {
                    tag: 'span',
                    cls: Ext.baseCSSPrefix + 'hide-clip',
                    html: me.todayText
                }, true);
				*/
            }
            if (value === newDate) {
                cls += ' ' + me.selectedCls;
                me.fireEvent('highlightitem', me, cell);
                if (visible && me.floating) {
                    Ext.fly(cell.firstChild).focus(50);
                }
            }

            if (value < min) {
                cls += ' ' + disabledCls;
                cell.title = me.minText;
            } else if (value > max) {
                cls += ' ' + disabledCls;
                cell.title = me.maxText;
            } else if (ddays && ddays.indexOf(current.getDay()) !== -1) {
                cell.title = ddaysText;
                cls += ' ' + disabledCls;
            } else if (ddMatch && format) {
                formatValue = eDate.dateFormat(current, format);
                if (ddMatch.test(formatValue)) {
                    cell.title = ddText.replace('%0', formatValue);
                    cls += ' ' + disabledCls;
                }
            }
            cell.className = cls + ' ' + me.cellCls;
        };

        for (; i < me.numDays; ++i) {
            if (i < startingPos) {
                html = (++prevStart);
                cls = me.prevCls;
            } else if (i >= days) {
                html = (++extraDays);
                cls = me.nextCls;
            } else {
                html = i - startingPos + 1;
                cls = me.activeCls;
            }
            textNodes[i].innerHTML = html;
            setCellClass(cells[i], cls);
            nextdate = new Date(current.setDate(current.getDate() + 1));
        }

        me.monthBtn.setText(Ext.Date.format(newdate, me.monthYearFormat));
    };
}());

Ext.define('Ext.ux.hijriDatePlugin-fa_IR', {
        override: 'Ext.Date',

        requires: 'Ext.ux.hijriDatePlugin',

        hijriMonthNames: ['المحرّم', 'صفر', 'ربيع الأول', 'ربيع الثاني', 'جمادى الاول', 'جمادى الآخر', 'رجب', 'شعبان', 'رمضان', 'شوّال', 'ذو القعدة', 'ذو الحجة'],

        hijriDayNames: ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت']
    },
    function() {
        Ext.override(Ext.ux.hijriDatePlugin.localization.DatePicker, {
            dayNames: Ext.Date.hijriDayNames,
            longDayFormat: 'r e B',
            monthYearFormat: 'e B',
            format: 'B-Q-R',
            todayText: 'امروز',
            okText: 'ادامه',
            cancelText: 'برگشت',
            todayTip: '{0} (جای خالی)',
            minText: 'این تاریخ پیش از نخستین تاریخ است',
            maxText: 'این تاریخ پس از آخرین تاریخ است',
            disabledDaysText: 'غیرفعال',
            disabledDatesText: 'غیرفعال',
            nextText: 'ماه پسین (مهار+راست)',
            prevText: 'ماه پیشین (مهار+چپ)',
            monthYearText: 'ماه را انتخاب کنید (جابجایی سال با مهار+بالا/پایین)',
            startDay: 6
        });

        Ext.override(Ext.ux.hijriDatePlugin.localization.DateField, {
            format: 'B-Q-R',
            altFormats: 'B-Q-R|B-q-r|b-q-r|b-Q-R|q-r|Q-R|Q-r|q-R|r|R',
            minText: 'باید تاریخ‌های پس از {0} را برگزینید',
            maxText: 'باید تاریخ‌های پیش از {0} را برگزینید',
            invalidText: '{0} تاریخ درستی نیست، باید در قالب «سال/ماه/روز» باشد',
            disabledDaysText: 'غیرفعال',
            disabledDatesText: 'غیرفعال',
            startDay: 6
        });
    }
);

// HIJRI ENDS
Ext.define('Ext.o.util.ClickRepeater', {
	override: 'Ext.util.ClickRepeater',
	handleMouseDown: function(e) {
		
		var me = this,
                el = me.getEl();
 
            Ext.undefer(me.timer);
            if (me.pressedCls) {
                el.addCls(me.pressedCls);
            }
            me.mousedownTime = Ext.now();
 
            if (e.pointerType === 'mouse') {
                el.on("mouseout", me.handleMouseOut, me);
            }
            Ext.getDoc().on("mouseup", me.handleMouseUp, me);
 
            me.fireEvent("mousedown", me, e);
            if(e && e.stopped != true)
         		   me.fireClick(e);
 
            // Do not honor delay or interval if acceleration wanted. 
            if (me.accelerate) {
                me.delay = 400;
            }
 
            me.timer =  Ext.defer(me.click, me.delay || me.interval, me, [e]);
 
            if (me.mousedownPreventDefault) {
                e.preventDefault();
            }
 
            if (me.mousedownStopEvent) {
                e.stopEvent();
            }
    }
});
Ext.define('Ext.o.picker.Date', {
    override: 'Ext.picker.Date',
	initComponent: function() {
		var me = this;
			me.showToday = !(RamcoRTC.settings.isExt2 == true);
			me.callParent();
			me.initHour = 0;
	}
});
// DateTime Picker
Ext.define('Ext.ramco.DateTimePicker', {
    extend: 'Ext.picker.Date',
    alias: 'widget.ramcodatetimepicker',
    childEls: [
        'innerEl', 'eventEl', 'prevEl', 'nextEl', 'middleBtnEl', 'footerEl', 'timerEl'
    ],
    renderTpl: [
        '<div id="{id}-innerEl" data-ref="innerEl" role="presentation">',
        '<div class="{baseCls}-header">',
        '<div id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-prev {baseCls}-arrow" role="presentation" title="{prevText}"></div>',
        '<div id="{id}-middleBtnEl" data-ref="middleBtnEl" class="{baseCls}-month" role="heading">{%this.renderMonthBtn(values, out)%}</div>',
        '<div id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-next {baseCls}-arrow" role="presentation" title="{nextText}"></div>',
        '</div>',
        '<table role="grid" id="{id}-eventEl" data-ref="eventEl" class="{baseCls}-inner" cellspacing="0" tabindex="0">',
        '<thead>',
        '<tr role="row">',
        '<tpl for="dayNames">',
        '<th role="columnheader" class="{parent.baseCls}-column-header" aria-label="{.}">',
        '<div role="presentation" class="{parent.baseCls}-column-header-inner">{.:this.firstInitial}</div>',
        '</th>',
        '</tpl>',
        '</tr>',
        '</thead>',
        '<tbody>',
        '<tr role="row">',
        '<tpl for="days">',
        '{#:this.isEndOfWeek}',
        '<td role="gridcell">',
        '<div class="{parent.baseCls}-date"></div>',
        '</td>',
        '</tpl>',
        '</tr>',
        '</tbody>',
        '</table>',
        '<div id="{id}-timerEl" role="heading" data-ref="timerEl" class="{baseCls}-timer">{%this.renderTime(values, out)%}</div>',
        '<tpl if="showToday">',
        '<div id="{id}-footerEl" data-ref="footerEl" role="presentation" class="{baseCls}-footer">{%this.renderTodayBtn(values, out)%}</div>',
        '</tpl>',
        // These elements are used with Assistive Technologies such as screen readers
        '<div id="{id}-todayText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{todayText}.</div>',
        '<div id="{id}-ariaMinText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{ariaMinText}.</div>',
        '<div id="{id}-ariaMaxText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{ariaMaxText}.</div>',
        '<div id="{id}-ariaDisabledDaysText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{ariaDisabledDaysText}.</div>',
        '<div id="{id}-ariaDisabledDatesText" class="' + Ext.baseCSSPrefix + 'hidden-clip">{ariaDisabledDatesText}.</div>',
        '</div>', {
            firstInitial: function(value) {
                return Ext.ramco.DateTimePicker.prototype.getDayInitial(value);
            },
            isEndOfWeek: function(value) {
                // convert from 1 based index to 0 based
                // by decrementing value once.
                value--;
                var end = value % 7 === 0 && value !== 0;
                return end ? '</tr><tr role="row">' : '';
            },
            renderTodayBtn: function(values, out) {
                Ext.DomHelper.generateMarkup(values.$comp.todayBtn.getRenderTree(), out);
            },
            renderMonthBtn: function(values, out) {
                Ext.DomHelper.generateMarkup(values.$comp.monthBtn.getRenderTree(), out);
            },
            renderTime: function(values, out) {
                //Ext.DomHelper.generateMarkup(values.$comp.timer.getRenderTree(), out);
				Ext.DomHelper.generateMarkup(values.$comp.timer.getRenderTree(), out);
            },
        }
    ],
    beforeRender: function() {
        /*
         * days array for looping through 6 full weeks (6 weeks * 7 days)
         * Note that we explicitly force the size here so the template creates
         * all the appropriate cells.
         */
        var me = this,
            d = new Date(),
            encode = Ext.String.htmlEncode,
            days = new Array(me.numDays),
            today = Ext.Date.format(new Date(), me.format);
		me.callParent();

		var timerVal = Ext.Date.format(d,RamcoRTC.userPreference.timeFormat);//TECH-28102
		
		if (RamcoRTC.settings.isExt2 === true) {		
			me.timer = new Ext.ramco.TimePickerField({   
				id: me.id + '-timepicker-field',
				floating: false,
				width: 200,
				height: 50,
				ownerCt: me,
				ownerLayout: me.getComponentLayout()
			});			
			me.width = 200;
		}
		else {
			me.timer = new Ext.button.Button({
				ui: me.footerButtonUI,
				ownerCt: me,
				ownerLayout: me.getComponentLayout(),
				tooltip: timerVal,
				text: timerVal,
				tooltipType: 'title',
				tabIndex: -1,
				ariaRole: 'presentation',
				handler: me.onShowTime,
				cls: 'time',
				scope: me
			});
		}

    },
    initComponent: function() {
        var me = this,
			prevDateTimeVal = '';

        me.selectedCls = me.baseCls + '-selected';
        me.disabledCellCls = me.baseCls + '-disabled';
        me.prevCls = me.baseCls + '-prevday';
        me.activeCls = me.baseCls + '-active';
        me.cellCls = me.baseCls + '-cell';
        me.nextCls = me.baseCls + '-prevday';
        me.todayCls = me.baseCls + '-today';

		me.showToday = false;			
				
        if (!me.format) {
            me.format = Ext.Date.defaultFormat;
        }
		
        if (!me.dayNames) {
            me.dayNames = Ext.Date.dayNames;
        }
		
        me.dayNames = me.dayNames.slice(me.startDay).concat(me.dayNames.slice(0, me.startDay));
		
		if(me.value)
			prevDateTimeVal = me.value;        
		
        me.callParent();
		me.value = prevDateTimeVal;
        me.value = me.value ? me.value : new Date();
        me.initDisabledDays();
    },
    initEvents: function() {
        var me = this,
            pickerField = me.pickerField,
            eDate = Ext.Date,
            day = eDate.DAY;

        me.callParent();       
		me.timer.finishRender();
		if (RamcoRTC.settings.isExt2 === true)
			me.timer.setValue(me.getValue());
        // If we're part of a date field, don't allow us to focus, the field will
        // handle that. If we are standalone, then allow the default behaviour
        // to occur to receive focus
        if (pickerField) {
            me.el.on('mousedown', me.onMouseDown, me);
        }

        // Month button is pointer interactive only, it should not be allowed to focus.
        me.monthBtn.el.on('mousedown', me.onMouseDown, me);

		if (!RamcoRTC.settings.isExt2) {
			me.timer.el.on('mousedown', me.onMouseDown, me);
		}

        me.prevRepeater = new Ext.util.ClickRepeater(me.prevEl, {
            handler: me.showPrevMonth,
            scope: me,
            mousedownStopEvent: true
        });

        me.nextRepeater = new Ext.util.ClickRepeater(me.nextEl, {
            handler: me.showNextMonth,
            scope: me,
            mousedownStopEvent: true
        });

        //me.keyNav = new Ext.util.KeyNav(me.eventEl, Ext.apply({
		me.keyNav = new Ext.util.KeyNav(Ext.apply({	
            target: me.eventEl,
			scope: me,

            left: function(e) {
                if (e.ctrlKey) {
                    e.preventDefault();
                    me.showPrevMonth();
                } else {
                    me.update(eDate.add(me.activeDate, day, -1));
                }
            },

            right: function(e) {
                if (e.ctrlKey) {
                    e.preventDefault();
                    me.showNextMonth();
                } else {
                    me.update(eDate.add(me.activeDate, day, 1));
                }
            },

            up: function(e) {
                if (e.ctrlKey) {
                    me.showNextYear();
                } else {
                    me.update(eDate.add(me.activeDate, day, -7));
                }
            },

            down: function(e) {
                if (e.ctrlKey) {
                    me.showPrevYear();
                } else {
                    me.update(eDate.add(me.activeDate, day, 7));
                }
            },

            pageUp: function(e) {
                if (e.ctrlKey) {
                    me.showPrevYear();
                } else {
                    me.showPrevMonth();
                }
            },

            pageDown: function(e) {
                if (e.ctrlKey) {
                    me.showNextYear();
                } else {
                    me.showNextMonth();
                }
            },

            tab: function(e) {
                // When the picker is floating and attached to an input field, its
                // 'select' handler will focus the inputEl so when navigation happens
                // it does so as if the input field was focused all the time.
                // This is the desired behavior and we try not to interfere with it
                // in the picker itself, see below.
                me.handleTabKey(e);

                // Allow default behaviour of TAB - it MUST be allowed to navigate.
                return true;
            },

            enter: function(e) {
                me.handleDateClick(e, me.activeCell.firstChild);
            },

            space: function() {
                me.setValue(new Date(me.activeCell.firstChild.dateValue));
                var startValue = me.startValue,
                    value = me.value,
                    pickerValue;

                if (pickerField) {
                    pickerValue = pickerField.getValue();
                    if (pickerValue && startValue && pickerValue.getTime() === value.getTime()) {
                        pickerField.setValue(startValue);
                    } else {
                        pickerField.setValue(value);
                    }
                }
            },

            home: function(e) {
                me.update(eDate.getFirstDateOfMonth(me.activeDate));
            },

            end: function(e) {
                me.update(eDate.getLastDateOfMonth(me.activeDate));
            }
        }, me.keyNavConfig));

        if (me.disabled) {
            me.syncDisabled(true, true);
        }
        me.update(me.value);
		
		if (!RamcoRTC.settings.isExt2) {
			//TECH-28102
			me.timer.setText(Ext.Date.format(me.value, RamcoRTC.userPreference.timeFormat));
			me.timer.setTooltip(Ext.Date.format(me.value, RamcoRTC.userPreference.timeFormat));
		}
    },
    selectToday: function() {
        var me = this,
            btn = me.todayBtn,
            handler = me.handler;

        if (btn && !btn.disabled) {
            me.setValue(new Date());
            me.fireEvent('select', me, me.value);
            if (handler) {
                handler.call(me.scope || me, me, me.value);
            }
            me.onSelect();
        }
        return me;
    },
	selectedUpdate: function(date) {
        var me = this,
            t = +Ext.Date.clearTime(date, true),
            cells = me.cells,
            cls = me.selectedCls,
            c,cLen = cells.getCount(),cell;
			me.eventEl.dom.setAttribute('aria-busy', 'true');
			cell = me.activeCell;
			if (cell) {
				Ext.fly(cell).removeCls(cls);
				cell.setAttribute('aria-selected', false);
			}
			for (c = 0; c < cLen; c++) {
				cell = cells.item(c);

				if (me.textNodes[c].dateValue === t) {
					me.activeCell = cell.dom;
					me.eventEl.dom.setAttribute('aria-activedescendant', cell.dom.id);
					cell.dom.setAttribute('aria-selected', true);
					cell.addCls(cls);
					me.fireEvent('highlightitem', me, cell);
					break;
				}
			}
        
        me.eventEl.dom.removeAttribute('aria-busy');
    },
    fullUpdate: function(date) {
        var me = this,
            cells = me.cells.elements,
            textNodes = me.textNodes,
            disabledCls = me.disabledCellCls,
            eDate = Ext.Date,
            i = 0,
            extraDays = 0,
            newDate = +eDate.clearTime(date, true),
            today = +eDate.clearTime(new Date()),
			 //newDate = date,
            //today = new Date(),
            min = me.minDate ? me.minDate : Number.NEGATIVE_INFINITY,
            max = me.maxDate ? me.maxDate : Number.POSITIVE_INFINITY,
            ddMatch = me.disabledDatesRE,
            ddText = me.disabledDatesText,
            ddays = me.disabledDays ? me.disabledDays.join('') : false,
            ddaysText = me.disabledDaysText,
            format = me.format,
            days = eDate.getDaysInMonth(date),
            firstOfMonth = eDate.getFirstDateOfMonth(date),
            startingPos = firstOfMonth.getDay() - me.startDay,
            previousMonth = eDate.add(date, eDate.MONTH, -1),
            ariaTitleDateFormat = me.ariaTitleDateFormat,
            prevStart, current, disableToday, tempDate, setCellClass, html, cls,
            formatValue, value;

        if (startingPos < 0) {
            startingPos += 7;
        }

        days += startingPos;
        prevStart = eDate.getDaysInMonth(previousMonth) - startingPos;
        current = new Date(previousMonth.getFullYear(), previousMonth.getMonth(), prevStart, me.initHour);

        if (me.showToday) {
            tempDate = new Date();
            disableToday = (tempDate < min || tempDate > max ||
                (ddMatch && format && ddMatch.test(eDate.dateFormat(tempDate, format))) ||
                (ddays && ddays.indexOf(tempDate.getDay()) !== -1));

            me.todayDisabled = disableToday;
            if (!me.disabled) {
                me.todayBtn.setDisabled(disableToday);
            }
        }

        setCellClass = function(cellIndex, cls) {
            var cell = cells[cellIndex],
                describedBy = [];

            // Cells are not rendered with ids
            if (!cell.hasAttribute('id')) {
                cell.setAttribute('id', me.id + '-cell-' + cellIndex);
            }

            // store dateValue number as an expando
            //value = current;
           // cell.firstChild.dateValue = value;
			value = +eDate.clearTime(current, true);
            cell.firstChild.dateValue = value;

            cell.setAttribute('aria-label', eDate.format(current, ariaTitleDateFormat));

            // Here and below we can't use title attribute instead of data-qtip
            // because JAWS will announce title value before cell content
            // which is not what we need. Also we are using aria-describedby attribute
            // and not placing the text in aria-label because some cells may have
            // compound descriptions (like Today and Disabled day).
            cell.removeAttribute('aria-describedby');
            cell.removeAttribute('data-qtip');

            if (value === today) {
                cls += ' ' + me.todayCls;
                describedBy.push(me.id + '-todayText');
            }

            if (value === newDate) {
                me.activeCell = cell;
                me.eventEl.dom.setAttribute('aria-activedescendant', cell.id);
                cell.setAttribute('aria-selected', true);
                cls += ' ' + me.selectedCls;
                me.fireEvent('highlightitem', me, cell);
            } else {
                cell.setAttribute('aria-selected', false);
            }

            if (value < min) {
                cls += ' ' + disabledCls;
                describedBy.push(me.id + '-ariaMinText');
                cell.setAttribute('data-qtip', me.minText);
            } else if (value > max) {
                cls += ' ' + disabledCls;
                describedBy.push(me.id + '-ariaMaxText');
                cell.setAttribute('data-qtip', me.maxText);
            } else if (ddays && ddays.indexOf(current.getDay()) !== -1) {
                cell.setAttribute('data-qtip', ddaysText);
                describedBy.push(me.id + '-ariaDisabledDaysText');
                cls += ' ' + disabledCls;
            } else if (ddMatch && format) {
                formatValue = eDate.dateFormat(current, format);
                if (ddMatch.test(formatValue)) {
                    cell.setAttribute('data-qtip', ddText.replace('%0', formatValue));
                    describedBy.push(me.id + '-ariaDisabledDatesText');
                    cls += ' ' + disabledCls;
                }
            }

            if (describedBy.length) {
                cell.setAttribute('aria-describedby', describedBy.join(' '));
            }

            cell.className = cls + ' ' + me.cellCls;
        };

        me.eventEl.dom.setAttribute('aria-busy', 'true');

        for (; i < me.numDays; ++i) {
            if (i < startingPos) {
                html = (++prevStart);
                cls = me.prevCls;
            } else if (i >= days) {
                html = (++extraDays);
                cls = me.nextCls;
            } else {
                html = i - startingPos + 1;
                cls = me.activeCls;
            }
            textNodes[i].innerHTML = html;
            current.setDate(current.getDate() + 1);
            setCellClass(i, cls);
        }

        me.eventEl.dom.removeAttribute('aria-busy');

        me.monthBtn.setText(Ext.Date.format(date, me.monthYearFormat));
    },
    onShowTime: function() {
        var me = this,
            el = me.el,
            picker;
        if (me.rendered && !me.disabled) {
            picker = me.createTimePicker();
            if (!picker.isVisible()) {
                //picker.setValue(me.getActive());
                picker.setSize(el.getSize());
                // Null out floatParent so that the [-1, -1] position is not made relative to this
                picker.floatParent = null;
                picker.setPosition(-el.getBorderWidth('l'), -el.getBorderWidth('t'));
                if (me.shouldAnimate(false)) {
                    me.runAnimation(false);
                } else {
                    picker.show();
                }
            }
        }
        return me;
    },
    createTimePicker: function() {
        var me = this,
            value = null,
            picker = me.timePicker;

        if (!picker) {
            me.timePicker = picker = new Ext.ramco.TimePickerField({
                renderTo: me.el,
                ownerCmp: me,
                padding: me.padding
            });
			picker.setSize(me.el.getSize());
            if (!me.disableAnim) {
                // hide the element if we're animating to prevent an initial flicker
                picker.el.setStyle('display', 'none');
            }
            picker.hide();
            me.timePicker.on('beforehide', me.doHideTimePicker, me);
        }
        value = me.getValue();
        picker.setValue(value);
        return picker;
    },
    onMouseDown: function(e) {
        var target = Ext.fly(e.target);
        if (!target.up('.time'))
            e.preventDefault();
    },
    doHideTimePicker: function() {
        var me = this,
            timePicker = me.timePicker,
			rawValue,
            value = null;
		//TECH-28102
		rawValue = me.updateTimer(me.getValue());
		me.setValue(rawValue);
		value = Ext.Date.format(me.getValue(), RamcoRTC.userPreference.timeFormat);
		me.timer.setText(value);
		me.timer.setTooltip(value);
    },
    handleDateClick: function(e, t) {
        var me = this,
            value = null,
            handler = me.handler;

        e.stopEvent();

        if (!me.disabled && t.dateValue && !Ext.fly(t.parentNode).hasCls(me.disabledCellCls)) {
            value = me.updateTimer(new Date(t.dateValue));
            me.setValue(value);
            me.fireEvent('select', me, me.value);

            if (handler) {
                handler.call(me.scope || me, me, me.value);
            }
            me.onSelect();
        }
    },
    updateTimer: function(date) {
        var me = this,
            timePicker = me.timePicker || me.createTimePicker(),
            value = null;
        value = timePicker.getRawValue();
		//TECH-28102
        if (value) {
			var hrs = value.h;
			if(RamcoRTC.prefs.TIMEFORMAT == "12-Hour"){
				if(value.h == 12 && value.f == RamcoRTC.prefs.TIMEAM)
					hrs = parseInt(value.h)+ 12;
				else if(value.h < 12 && value.f == RamcoRTC.prefs.TIMEPM )
					hrs = parseInt(value.h)+ 12;
			}
			date.setHours(hrs);
            date.setMinutes(value.m);
            date.setSeconds(value.s);
        }
		
        return date;
    },
    handleTabKey: function(e) {
        var me = this,
            t = me.getSelectedDate(me.activeDate),
            handler = me.handler;

        // The following code is like handleDateClick without the e.stopEvent()
        if (!me.disabled && t.dateValue && !Ext.fly(t.parentNode).hasCls(me.disabledCellCls)) {
            me.setValue(new Date(t.dateValue));
            me.fireEvent('select', me, me.value);
            if (handler) {
                handler.call(me.scope || me, me, me.value);
            }
            me.onSelect();
        }
        // Even if the above condition is not met we have to let the field know
        // that we're tabbing out - that's user action we can do nothing about
        else {
            me.fireEventArgs('tabout', [me]);
        }
    },
    setValue: function(value) {
        // If passed a null value just pass in a new date object.
        var me = this,
			timeValue = '';
		
		me.value = value || new Date();
		
		//TECH-28102
	    timeValue = Ext.Date.format(me.value, RamcoRTC.userPreference.timeFormat);
		
		if (!RamcoRTC.settings.isExt2) {
			me.timer.setText(timeValue);
			me.timer.setTooltip(timeValue);
			return me.update(me.value);
		}
		else {
			me.timer.updateLayout();
		}
		        
    },
	onOkClick: function(picker, value) {
        var me = this,
            month = value[0],
            year = value[1];
			if(!Ext.isEmpty(me.timer))
				tVal = me.timer.getText().split(":");
	        date = new Date(year, month, me.getActive().getDate(),tVal[0],tVal[1],tVal[2]);
 
        if (date.getMonth() !== month) {
            // 'fix' the JS rolling date conversion if needed 
            date = Ext.Date.getLastDateOfMonth(new Date(year, month, 1));
        }
        me.setValue(date);
        me.hideMonthPicker();
    },
	doDestroy: function() {
        var me = this;
		Ext.destroy(me.timePicker,me.timer);
        me.callParent();
    }
});

// Time Picker
//TECH-28102
Ext.define('Ext.ramco.TimePickerField', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.ramcotimepicker',
    value: null,
    floating: true,
    width: 100,
    height: 160,
	cls: 'x-ramco-timepicker',
    style: {
        'background': "#fff",
		'border' :'1px solid #cccccc'
    },
    layout: {
        type: 'table',
        columns: 4,
        tableAttrs: {
            style: {
                width: '100%'
            }
        },
        tdAttrs: {
            style: {
                //width: '33%',
                'text-align': 'center',
                'vertical-align': 'middle'
            }
        }
    },
    items: [{
        xtype: 'ramcolabel',
        visibleLength: 2,
        value: 'HH'
    }, {
        xtype: 'ramcolabel',
        visibleLength: 2,
        value: 'MM'
    }, {
        xtype: 'ramcolabel',
        visibleLength: 2,
		itemId:'secTxt',
        value: 'SS'
    }, 
	{
        xtype: 'ramcolabel',
		hidden:true,
		itemId:'formatsTxt',
        visibleLength: 2,
        value: ''
    }, 
	{
        xtype: 'container',
		itemId: 'hourseContainer',
        layout: {
             type: 'table',
			 columns: 3,
			 tableAttrs: {
				style: {
					width: '100%'
				}
			}
        },
        items: [{
            xtype: 'button',
            ui: 'plain',
            itemId: 'hdown',
			margin:0,
            iconCls: 'x-fa fa-caret-left'
        }, {
            xtype: 'label',
            itemId: 'hours',
            maxValue: 23,
            minValue: 0,
            visibleLength: 2,
            value: 0
        }, {
            xtype: 'button',
            ui: 'plain',
			margin:0,
            itemId: 'hup',
            iconCls: 'x-fa fa-caret-right'
        }]
    }, {
        xtype: 'container',
		itemId: 'minuteContainer',
        layout: {
             type: 'table',
			 columns: 3,
			 tableAttrs: {
				style: {
					width: '100%'
				}
			}
        },
        items: [{
            xtype: 'button',
			margin:0,
            ui: 'plain',
            itemId: 'mdown',
            iconCls: 'x-fa fa-caret-left'
        }, {
            xtype: 'label',
            itemId: 'minutes',
            maxValue: 59,
            minValue: 0,
            visibleLength: 2,
            value: 0
        }, {
            xtype: 'button',
            ui: 'plain',
            itemId: 'mup',
			margin:0,
            iconCls: 'x-fa fa-caret-right'
        }]
    }, {
        xtype: 'container',
		itemId: 'secondsContainer',
        layout: {
             type: 'table',
			 columns: 3,
			 tableAttrs: {
				style: {
					width: '100%'
				}
			}
        },
        items: [{
            xtype: 'button',
            ui: 'plain',
            itemId: 'sdown',
			margin:0,
            iconCls: 'x-fa fa-caret-left'
        }, {
            xtype: 'label',
            itemId: 'seconds',
            maxValue: 59,
            minValue: 0,
            visibleLength: 2,
            value: 0
        }, {
            xtype: 'button',
            ui: 'plain',
			margin:0,
            itemId: 'sup',
            iconCls: 'x-fa fa-caret-right'
        }]
    },
	{
        xtype: 'container',
		itemId: 'ampmContainer',
		hidden:false,
        layout: {
             type: 'table',
			 columns: 3,
			 tableAttrs: {
				style: {
					width: '100%'
				}
			}
        },
        items: [{
            xtype: 'button',
            ui: 'plain',
            itemId: 'fup',
			margin:0,
            iconCls: 'x-fa fa-caret-left'
        }, {
            xtype: 'label',
            itemId: 'formats',
            maxValue: 'PM',
            minValue: 'AM',
            visibleLength: 2
            //value: ''
        }, {
            xtype: 'button',
            ui: 'plain',
			margin:0,
            itemId: 'fdown',
            iconCls: 'x-fa fa-caret-right'
        }]
    }],    
    initComponent: function() {
	var me = this,
		buttons =  [{
			xtype: 'button',
			text: rvw_resources.R102,
			itemId: 'timeok'
		}, 
		{
			xtype: 'button',
			text: rvw_resources.R103,
			itemId: 'timecancel',
			hidden: (RamcoRTC.settings.isExt2 === true)
		}],
		buttonAlign = 'center';
		
		if (RamcoRTC.settings.isExt2 === true) {
			me.rbar = buttons;
			me.height = 40;
		}
		else {
			me.buttons = buttons;
			me.buttonAlign = buttonAlign;
		}		
		
        this.callParent();
        var me = this,
            timeok = me.down('#timeok'),
            timecancel = me.down('#timecancel'),
            hup = me.down('#hup'),
            mup = me.down('#mup'),
            sup = me.down('#sup'),
            hdown = me.down('#hdown'),
            mdown = me.down('#mdown'),
			fdown = me.down('#fdown'),//TECH-28102
			fup = me.down('#fup'),
            sdown = me.down('#sdown');
			me.hours = me.down('#hours');
			me.minutes = me.down('#minutes');
			me.seconds = me.down('#seconds');
			me.formatsTxt = me.down('#formatsTxt');
			me.secTxt = me.down('#secTxt');
			me.formats = me.down('#formats');
			var container = me.formats.up('container');
		if(RamcoRTC.prefs.TIMEFORMAT == "12-Hour"){//TECH-28102
			container.setHidden(false);
			me.formatsTxt.setHidden(false);
			me.hours.maxValue = 12;
			me.hours.minValue = 1;			
		}
		if(RamcoRTC.prefs.TIMEFORMAT == "24-Hour"){
			container.setHidden(true);
			me.formatsTxt.setHidden(true);
			me.hours.maxValue = 23;
			me.hours.minValue = 0;			
		}
		if(RamcoRTC.prefs.TIMESECSTYLE == 'none'){
			me.seconds.setHidden(true);
			sup.setHidden(true);
			sdown.setHidden(true);
			me.secTxt.setHidden(true);
		}
	    me.mon(timeok, {
            click: me.onTimeOkClick,
            scope: me
        });
        me.mon(timecancel, {
            click: me.onTimeCancelClick,
            scope: me
        });
        me.mon(hup, {
            click: me.onButtonClick,
            scope: me
        });
        me.mon(mup, {
            click: me.onButtonClick,
            scope: me
        });
        me.mon(sup, {
            click: me.onButtonClick,
            scope: me
        });
        me.mon(hdown, {
            click: me.onButtonClick,
            scope: me
        });
        me.mon(mdown, {
            click: me.onButtonClick,
            scope: me
        });
        me.mon(sdown, {
            click: me.onButtonClick,
            scope: me
        });
		//TECH-28102
		 me.mon(fdown, {
            click: me.onButtonClick,
            scope: me
        });
		 me.mon(fup, {
            click: me.onButtonClick,
            scope: me
        });
    },
    onButtonClick: function(btn) {
        var me = this;
		//TECH-28102
        switch (btn.itemId) {
            case "hup":
                me.setSpinnerValue(me.hours, true);
                break;
            case "hdown":
                me.setSpinnerValue(me.hours, false);
                break;
            case "mup":
                me.setSpinnerValue(me.minutes, true);
                break;
            case "mdown":
                me.setSpinnerValue(me.minutes, false);
                break;
            case "sup":
                me.setSpinnerValue(me.seconds, true);
                break;
            case "sdown":
                me.setSpinnerValue(me.seconds, false);
                break;
			case "fdown":
                me.setSpinnerValue(me.formats, btn.itemId);
                break;
			case "fup":
                me.setSpinnerValue(me.formats, btn.itemId);
                break;
        }
    },
    setSpinnerValue: function(ctrl, incr) {
        var me = this,
            val = 0;
		 if(ctrl.itemId == "formats"){//TECH-28102
			if(ctrl.text == RamcoRTC.prefs.TIMEAM)
				ctrl.setText(RamcoRTC.prefs.TIMEPM);
			else
				ctrl.setText(RamcoRTC.prefs.TIMEAM);
			return;
		}
        if (incr) {
            //val = ctrl.getValue();
			val = ctrl.text;
            val = parseInt(val, 10);
            if (val < ctrl.maxValue)
                //ctrl.setValue(val + 1);
				ctrl.setText(val + 1);
            else
                //ctrl.setValue(ctrl.minValue);
				ctrl.setText(ctrl.minValue);
        } else {
            //val = ctrl.getValue();
			val = ctrl.text;
            val = parseInt(val, 10);
            if (val > ctrl.minValue)
                //ctrl.setValue(val - 1);
				ctrl.setText(val - 1);
            else
                //ctrl.setValue(ctrl.maxValue);
				ctrl.setText(ctrl.maxValue);
        }
    },
    // @private get time as object,
    getRawValue: function() {
        return {
            // h: this.hours.getValue(),
            // m: this.minutes.getValue(),
            // s: this.seconds.getValue()
			h: this.hours.text,
            m: this.minutes.text,
            s: this.seconds.text,
			f:this.formats.text//TECH-28102
        };
    },

    // private
    setRawValue: function(value) {
        if (this.hours) {
            this.hours.setText(value.h);
            this.minutes.setText(value.m);
            this.seconds.setText(value.s);
			this.formats.setText(value.f);//TECH-28102
        }
    },
    getValueFromDate: function(date) {
		var ampm = null,hrs =null;
		if(RamcoRTC.prefs.TIMEFORMAT == "12-Hour" ){//TECH-28102
			if(date.getHours() > 12 ){
				hrs = date.getHours() - 12;
			}else if(date.getHours() == 0)
				hrs = 12;
			else
				hrs = date.getHours();
			
			if(date.getHours() < 12)
				ampm = RamcoRTC.prefs.TIMEAM;
			else if (date.getHours() >= 12)
				ampm = RamcoRTC.prefs.TIMEPM;
		}
		else
			hrs = date.getHours();
	    if (Ext.isDate(date)) {
			
            return {
                h: hrs,
                m: date.getMinutes(),
                s: date.getSeconds(),
				f: ampm
            };
        }
    },
    // overwrite
    getValue: function() {
        var v = this.getRawValue();
        return Ext.String.leftPad(v.h, 2, '0') + ':' + Ext.String.leftPad(v.m, 2, '0') + ':' +
            Ext.String.leftPad(v.s, 2, '0');
    },
    // overwrite
    setValue: function(value) {
        this.value = Ext.isDate(value) ? Ext.Date.format(value, 'H:i:s') : value;
        if (!this.rendered) {
            return;
        }
        this.setRawValue(this.getValueFromDate(value));
    },
    onTimeOkClick: function(picker, value) {
        var me = this,
            date = new Date(),
            hrs = me.hours.text,
            mins = me.minutes.text,
            secs = me.seconds.text,
			formats = me.formats.text;
		
		if(RamcoRTC.prefs.TIMESECSTYLE == 'none') secs = 0;
		if(RamcoRTC.prefs.TIMEFORMAT == "12-Hour"){//TECH-28102
			if(hrs == 12 && formats == RamcoRTC.prefs.TIMEAM){
				hrs =(parseInt(hrs) + 12);
			}else if(hrs < 12 && formats == RamcoRTC.prefs.TIMEPM )
				hrs =(parseInt(hrs) + 12);
				
		}
		date.setHours(hrs);
        date.setMinutes(mins);
        date.setSeconds(secs);
        me.setValue(date);		
        me.fireEvent('update', date);
		if (RamcoRTC.settings.isExt2 === true) {
			if (me.ownerCt && me.ownerCt.ownerCmp) {
				me.ownerCt.setValue(date);
				me.ownerCt.ownerCmp.setValue(date);
			}
		}
        me.hideTimePicker();
    },
    onTimeCancelClick: function() {
        this.suspendEvents();
        this.hideTimePicker();
        this.resumeEvents();
    },
    hideTimePicker: function() {
        var me = this;
		if (RamcoRTC.settings.isExt2 === true && me.ownerCt) {
			if (me.ownerCt) {
				me.ownerCt.hide();
				me.ownerCt.ownerCmp.isExpanded = !1;
			}
		}
		else {
			if (me && me.isVisible()) {
				me.hide();
				me.ownerCmp.isExpanded = !1;
			}
		}
    }
});

// DateTime Field
Ext.define('Ext.ramco.DateTimeField', {
    extend: 'Ext.form.field.Date',
    alias: 'widget.ramcodatetimefield',
    requires: ['Ext.ramco.DateTimePicker'],
	triggerCls: "tech-calendarntime",
	initComponent: function() {
		var me = this;
		me.callParent();
		me.setDataType("date-time");
		me.altFormats = me.format = me.title = RamcoRTC.userPreference.dateTimeFormat;
		me.formatText = 'Expected date time format '  + RamcoRTC.userPreference.dateTimeFormatText;
		me.invalidText = " is not a valid date time - it must be in the format {1}";
		me.startDay = RamcoRTC.userPreference.firstdayofweek; // TECH-36193
	},

    // overwrite
    createPicker: function() {
        var me = this,
            format = me.getFormat();

        return Ext.create('Ext.ramco.DateTimePicker', {
            ownerCt: me.ownerCt,
            renderTo: document.body,
            floating: true,
            hidden: true,
            format: format,
            focusOnShow: true,
			value: me.getValue(),
            minDate: me.minValue,
            maxDate: me.maxValue,
            disabledDatesRE: me.disabledDatesRE,
            disabledDatesText: me.disabledDatesText,
            disabledDays: me.disabledDays,
            disabledDaysText: me.disabledDaysText,
            showToday: me.showToday,
            startDay: me.startDay,
            listeners: {
                scope: me,
                select: me.onSelect
            },
            keyNavConfig: {
                esc: function() {
                    me.collapse();
                }
            }
        });
    }
});

// Time Field
Ext.define('Ext.ramco.Time', {
    extend: 'Ext.form.field.Date',
    alias: 'widget.ramcotimefield',
    requires: ['Ext.ramco.TimePickerField'],
    format: 'H:i:s',
    altFormats: 'H:i:s|h:i:s A',
	triggerCls: "tech-time",
	initComponent: function() {
		var me = this;
		me.callParent();
		me.setDataType("time");
		me.altFormats = me.format = me.title = RamcoRTC.userPreference.timeFormat;
		me.formatText = 'Expected date time format '  + RamcoRTC.userPreference.timeFormatText;
		me.invalidText = " is not a valid Time - it must be in the format {1}";
		
	},
    convert: function(value) {
        if (value && Ext.isString(value)) {
            var date = Ext.Date.parse(value, this.format);
            if (!date) {
                return null;
            }
            return date;
        }
        return value;
    },
    // overwrite
    createPicker: function() {
        var me = this,
            format = me.getFormat();

        return Ext.create('Ext.ramco.TimePickerField', {
            format: format,
            width: 200,
            height: 85,
            listeners: {
                scope: me,
                update: me.onUpdate
            },
            keyNavConfig: {
                esc: function() {
                    me.collapse();
                }
            }
        });
    },
	/*
    getErrors: function(value) {
        var me = this,
            errors = null;
        if (!value) {
            errors = me.callParent();
            return errors;
        }
        if (value && typeof value == 'string') {
            value = new Date('1900-01-01 ' + value);
        }
        errors = me.callParent(arguments);
        return errors;
    },
	*/
    getRawValue: function() {
        var c = this,
            d = Ext.form.field.Base.prototype.getRawValue.call(this);
        if (d === c.emptyText && c.valueContainsPlaceholder) {
            d = ""
        }
        //return (!Ext.isEmpty(d)) ? '1900-01-01 ' + d : d;
        return d;
    },
    /*rawToValue: function(value) {        
        if (value && typeof value == 'string') {
			if ( value.indexOf(':') >= 1 || value.indexOf(':') >= 3 )
				value = new Date( value.indexOf('1900-01-01') > -1 ? value : '1900-01-01 ' + value );
			else if ( RamcoRTC.settings.defaultZeroTimePadding ) {
				if (value.length == 1)
					value = '0' + value + ':00:00';
				else if (value.length == 2)
					value += ':00:00';
			}
			//else if ( !RamcoRTC.settings.defaultZeroTimePadding && value.charAt(value.length - 1) != ':' ) {
			else if ( !RamcoRTC.settings.defaultZeroTimePadding ) {
				var curTime = new Date(),
					mins = curTime.getMinutes(),
					secs = curTime.getSeconds();
				value += ':' + mins + ':' + secs;
				value = new Date('1900-01-01 ' + value);
			}
        }
        return this.parseDate(value) || value || null;
		
        return this.callParent([value]);
    },*/
    onUpdate: function(data) {
        this.setValue(data);
    }
});
// Date Control
Ext.define('Ext.o.data.field.Date', {
    override: 'Ext.data.field.Date',    
    convert: function(v) {
        if (!v) {
            return null;
        }

        if (v instanceof Date) {
            return v;
        } 
		
        var dateFormat = this.dateReadFormat || this.dateFormat,
            parsed, 
			//altFormat = 'Y-m-d H:i:s',
			altFormat = 'Y-m-d',
			retVal;
		
		if (!dateFormat)
			dateFormat = altFormat;

        if (dateFormat) {
			if(this.ctype == 'hdate' || this.ctype == 'hdate-time' )
				retVal = Ext.Date.parseHijri(v,true);
			else{
				retVal = Ext.Date.parse(v, dateFormat);
				if (Ext.isEmpty(retVal) && dateFormat == altFormat) {
					//v = v + " 00:00:00";//datechange
					retVal = Ext.Date.parse(v, dateFormat);
				}
            }
			return retVal;
        }

        parsed = Date.parse(v);
        return parsed ? new Date(parsed) : null;
    }
});

// Time Control
Ext.define('Ext.data.field.Time', {
    extend: 'Ext.data.field.Date',
    alias: 'data.field.time',
    convert: function(v) {
        if (!v) {
            return null;
        }

        // instanceof check ~10 times faster than Ext.isDate. Values here will not be
        // cross-document objects
        if (v instanceof Date) {
            return v;
        } else if (v.indexOf('1900-01-01') < 0)
            v = '1900-01-01 ' + v;

        var dateFormat = this.dateReadFormat || this.dateFormat,
            parsed, altFormat = 'Y-m-d ' + this.format;
		
		if (!dateFormat)
			dateFormat = altFormat;

        if (dateFormat) {
            return Ext.Date.parse(v, dateFormat);
        }

        parsed = Date.parse(v);
        return parsed ? new Date(parsed) : null;
    }
});

// DateTime Control
Ext.define('Ext.data.field.DateTime', {
    extend: 'Ext.data.field.Date',
    alias: ['data.field.datetime','data.field.date-time'],
    convert: function(v) {
        if (!v) {
            return null;
        }

        // instanceof check ~10 times faster than Ext.isDate. Values here will not be
        // cross-document objects
        if (v instanceof Date) {
            return v;
        } 		
        var dateFormat = this.dateReadFormat || this.dateFormat,
            parsed, altFormat = this.format;
		
		if (!dateFormat)
			dateFormat = altFormat;

        if (dateFormat) {
            return Ext.Date.parse(v, dateFormat);
        }

        parsed = Date.parse(v);
        return parsed ? new Date(parsed) : null;
    }
});

//BadgeButton
Ext.define('Ext.ramco.button.BadgeButton', {
    extend: 'Ext.button.Button',
    alias: 'widget.badgebutton',
    config: {
        badgeText: ''
    },
    cls: Ext.baseCSSPrefix + 'btn-button-badge',
    updateBadgeText: function(text) {
        var me = this,
			language = RamcoRTC.lang || 1;
		// TECH-31556
		//text = (!Ext.isEmpty(text) && text !== '0') ? text : '';
		if (!Ext.isEmpty(text)) {
			text = parseInt(text);
			if (isNaN(text))
				text = '';
		}

        if (me.rendered)
			me.el.set({ 'data-badge': text });

		if (RamcoRTC.settings && RamcoRTC.settings.applicationTitle) {
			// TECH-31556
			if (Ext.isEmpty(text) || (!Ext.isEmpty(text) && text == 0))
				document.title = RamcoRTC.settings.applicationTitle[0][language];
			else
				document.title = '(' + text + ')' + RamcoRTC.settings.applicationTitle[0][language];
		}		
        /*if (Ext.isEmpty(text) && (Ext.isEmpty(RamcoRTC.userInfo.l) || !RamcoRTC.settings.applicationTitle))
            document.title = title;
        else if (!Ext.isEmpty(text) && !Ext.isEmpty(RamcoRTC.userInfo.l) && RamcoRTC.settings.applicationTitle) {
            for (var key in RamcoRTC.settings.applicationTitle[0]) {
                if (key == RamcoRTC.userInfo.l) {
                    document.title = '(' + text + ')' + RamcoRTC.settings.applicationTitle[0][key];
                    break;
                }
            }
        }*/
        favicon.badge(text);
        return me;
    },
    afterRender: function() {
        this.callParent();
        var me = this,
            badgeText = me.getBadgeText();
        me.el.set({
            'data-badge': badgeText
        });
    }
});

// Static Link
Ext.define('Ext.ramco.link.Link', {
    extend: 'Ext.button.Button',
    alias: 'widget.link',
    baseCls: Ext.baseCSSPrefix + 'link',
    _btnWrapCls: Ext.baseCSSPrefix + 'link-wrap',
    _btnCls: Ext.baseCSSPrefix + 'link-button',
    _baseIconCls: Ext.baseCSSPrefix + 'link-icon-el',
    _glyphCls: Ext.baseCSSPrefix + 'link-glyph',
    _innerCls: Ext.baseCSSPrefix + 'link-inner',
    _textCls: Ext.baseCSSPrefix + 'link-text',
    _noTextCls: Ext.baseCSSPrefix + 'link-no-text',
    _hasIconCls: Ext.baseCSSPrefix + 'link-icon',
    _pressedCls: Ext.baseCSSPrefix + 'link-pressed',
    overCls: Ext.baseCSSPrefix + 'link-over',
    _disabledCls: Ext.baseCSSPrefix + 'link-disabled',
    _menuActiveCls: Ext.baseCSSPrefix + 'link-menu-active',
    _arrowElCls: Ext.baseCSSPrefix + 'link-arrow-el',
    _focusCls: Ext.baseCSSPrefix + 'link-focus',
    _arrowFocusCls: Ext.baseCSSPrefix + 'link-arrow-focus',
	afterRender: function() {
        this.callParent();
        var me = this,
            customCls = me.getCustomCls();
        if (customCls && !me.isEndsWith(customCls, 'texticon') && me.isEndsWith(customCls, 'icon')) {
            me.btnEl.addCls(me._noTextCls);
            me.btnInnerEl.hide();
        }

		// TECH-26028
		if(!Ext.isEmpty(me.sTooltip))
			me.el.dom.setAttribute("data-qtip", me.sTooltip);
		
		if(me.lookupViewModel()) {
			me.setBind({
				ctrlConfig: "{" + me.itemId + ".addlProps}"
			});	
		}
    },
    isEndsWith: function(givenStr, subst) {
        var ln = givenStr.length;
        var idx = ln - subst.length;
        return ((givenStr.substr(idx)).toLowerCase() == subst);
    },
	setValueData: function(href) {
        var me = this;
        me.href = href;
    }
});

// DataHyperLink Control
Ext.define('Ext.ramco.field.DataHyperLink', {
    extend: 'Ext.ramco.link.Link',
    alias: 'widget.datahyperlink',
    format: null,
	config: {
    	ctrlConfig: null    
    },
    renderTpl: '<div id="{id}-btnWrap" data-ref="btnWrap" role="presentation" unselectable="on" style="{btnWrapStyle}" ' +
        'class="{btnWrapCls} {btnWrapCls}-{ui} {splitCls}{childElCls}">' +
        '<div id="{id}-btnEl" data-ref="btnEl" role="presentation" unselectable="on" style="{btnElStyle}" ' +
        'class="{btnCls} {btnCls}-{ui} {textCls} {noTextCls} {hasIconCls} ' +
        '{iconAlignCls} {textAlignCls} {btnElAutoHeightCls}{childElCls}">' +
        '<tpl if="iconBeforeText">{[values.$comp.renderIcon(values)]}</tpl>' +
        '<div id="{id}-btnInnerEl" data-ref="btnInnerEl" unselectable="on" ' +
        'class="{innerCls} {innerCls}-{ui}{childElCls}">{text}</div>' +
        '<tpl if="!iconBeforeText">{[values.$comp.renderIcon(values)]}</tpl>' +
        '</div>' +
        '</div>' +
        '{[values.$comp.getAfterMarkup ? values.$comp.getAfterMarkup(values) : ""]}' +
        // if "closable" (tab) add a close element icon
        '<tpl if="closable">' +
        '<div id="{id}-closeEl" data-ref="closeEl" class="{baseCls}-close-btn">' +
        '<tpl if="closeText">' +
        ' {closeText}' +
        '</tpl>' +
        '</div>' +
        '</tpl>' +
        // Split buttons have additional tab stop for the arrow element
        '<tpl if="split">' +
        '<div id="{id}-arrowEl" class="{arrowElCls}" data-ref="arrowEl" ' +
        'role="button" hidefocus="on" unselectable="on"' +
        '<tpl if="tabIndex != null"> tabindex="{tabIndex}"</tpl>' +
        '<tpl foreach="arrowElAttributes"> {$}="{.}"</tpl>' +
        '>{arrowElText}</div>' +
        '</tpl>',
    setValue: function(value) {
        var me = this,
            ilbo = me.up('ilbo'),
            valueJson,
			key,
			returnValue,
            templateID,
            xTpl;
        if (!Ext.isEmpty(value) && Ext.isString(value) && value.indexOf('{') == 0) {
            valueJson = Ext.decode(value, true);
            if (valueJson && ilbo) {
                templateID = valueJson.tplid || me.tplId;
                xTpl = ilbo.getTemplate(templateID, templateID == me.tplId);
                if (xTpl && xTpl.isTemplate) {
                    value = xTpl.apply(valueJson);
                }
				else {
                    //value = "Template not found for " + templateID;
					returnValue = [];
					for(key in valueJson){
						returnValue.push(valueJson[key]);
					}
					value= returnValue.join(" ");
				}
            }
        }
		else if (!Ext.isEmpty(me.controlStyle) && me.controlStyle.toLowerCase() == 'image') {
			var imgSrc = "<img src='resources/images/application/{0}' class='x-field-browse-img' data-qtip='{0}' alt='{0}'/>";
			value = Ext.String.format(imgSrc, value);
		}
		/*else if (me.tplId) {
            xTpl = ilbo.getTemplate(me.tplId,true);
            if (xTpl && xTpl.isTemplate) {
                value = xTpl.apply({});
            }
			else {
				returnValue = [];
				for(key in valueJson){
					returnValue.push(valueJson[key]);	
				}
				value= returnValue.join(" ");
			}
        }*/
		me.suspendLayouts();
		// TECH-32726
		value = purifyDom(value);
        me.setText(value);
		me.value = value;
		me.resumeLayouts();
    },
    setValueData: function(href) {
        var me = this;
        me.href = href;
    },
    getFormat: function(format) {
        return this.format;
    },
    setFormat: function(format) {
        this.format = format;
        this.title = format;
    },
	updateCtrlConfig:function(newValue, oldValue) {
		var me = this;
		if(Ext.isObject(newValue)) {
			if(!Ext.isEmpty(newValue.ft)){
				me.format = newValue.ft;
				me.title = newValue.ft;
			}
			me.stp = newValue.stp;
			me.href = newValue.href;
			if(!Ext.isEmpty(me.stp))
				me.setTooltip(me.stp);
			me.setValue(newValue.value);			
		}
    }
});

// Line Control(Horizontal / Vertical)
Ext.define('Ext.ramco.RamcoLine', {
    extend: 'Ext.Component',
    alias: 'widget.ramcoline',
    vertical: true,
    initComponent: function() {
        var me = this;
        if (me.vertical)
            me.cls = Ext.baseCSSPrefix + 'ramcoline-vertical';
        else
            me.cls = Ext.baseCSSPrefix + 'ramcoline-horizontal';
        this.callParent();
    }
});

//Image Control
Ext.define('Ext.ramco.Image', {
    extend: 'Ext.Component',
    xtype: 'ramcoimage',
    autoEl: 'img',
    baseCls: Ext.baseCSSPrefix + 'img',
    config: {
        dbFileUrl: null,
        saveToDb: false,
        hasLink: false,
        fileUrl: null,
        srcPath: null,
        assView: null,
        mode: null,
        src: null,
		hdnFileId: null,		
		autoFileName: true,
		dView: null
    },
    srcDelBtn: null,
    errSrc: '',
    alt: '',
    title: '',
    imgCls: '',
    maskOnDisable: false,
    initComponent: function() {
        var me = this;
        if (this.glyph) {
            this.autoEl = 'div';
        }
		//TECH-30729
		if(Ext.isEmpty(me.visibleLength) && Ext.isEmpty(me.width))
			me.visibleLength = 0;
        this.callParent();
        if (this.autoEl == 'img') {
            me.onLoad = Ext.Function.bind(me.onLoad, me);
            me.onError = Ext.Function.bind(me.onError, me);
        }
    },
    getAlt: function() {
        return this.alt;
    },
    setAlt: function(alt) {
        var me = this,
            imgEl = me.imgEl;
        me.alt = alt || '';

        if (imgEl) {
            imgEl.dom.alt = alt || '';
        }
    },
    getTitle: function() {
        return this.title;
    },
    setTitle: function(title) {
        var me = this,
            imgEl = me.imgEl;

        me.title = title || '';

        if (imgEl) {
            imgEl.dom.title = title || '';
        }
    },

    getElConfig: function() {
        var me = this,
            autoEl = me.autoEl,
            config = me.callParent(),
            glyphFontFamily = Ext._glyphFontFamily,
            glyph = me.glyph,
            img, glyphParts;

        // It is sometimes helpful (like in a panel header icon) to have the img wrapped
        // by a div. If our autoEl is not 'img' then we just add an img child to the el.
        if (autoEl === 'img' || (Ext.isObject(autoEl) && autoEl.tag === 'img')) {
            img = config;
        } else if (me.glyph) {
            if (typeof glyph === 'string') {
                glyphParts = glyph.split('@');
                glyph = glyphParts[0];
                glyphFontFamily = glyphParts[1] || glyphFontFamily;
            }

            config.html = '&#' + glyph + ';';

            if (glyphFontFamily) {
                config.style = config.style || {};
                config.style.fontFamily = glyphFontFamily;
            }

            // A glyph is a graphic which is not an <img> tag so it should have
            // the corresponding role for Accessibility interface to recognize
            config.role = 'img';
        } else {
            config.cn = [img = {
                tag: 'img',
                id: me.id + '-img'
            }];
        }

        if (img) {
            if (me.imgCls) {
                img.cls = (img.cls ? img.cls + ' ' : '') + me.imgCls;
            }

            // TECH-33683
			if (me.src == null || me.src == undefined)
				img.src = '';
			else
				img.src = me.src; //|| Ext.BLANK_IMAGE_URL;
        }

        if (me.alt) {
            (img || config).alt = me.alt;
        } else {
            // Images that do not have alt attribute can't be properly announced
            // by screen readers. In best case they will be silently skipped;
            // in worst case screen reader will announce data url. Yes, that very long
            // base-64 encoded string. :/
            // That will make the application totally unusable for blind people.
            (img || config).alt = '';

            //<debug>
            Ext.log.warn('For WAI-ARIA compliance, IMG elements SHOULD have an alt attribute.');
            //</debug>
        }

        if (me.title) {
            (img || config).title = me.title;
        }

        return config;
    },

    onRender: function() {
        var me = this,
            autoEl = me.autoEl,
			width = me.width, //TECH-30729
            el;

        me.callParent(arguments);

        el = me.el;

        if (autoEl === 'img' || (Ext.isObject(autoEl) && autoEl.tag === 'img')) {
            me.imgEl = el;
        } else {
            me.imgEl = el.getById(me.id + '-img');
        }
		//TECH-30729
		/* if(me.imgEl){
			if(me.visibleLength == 0){
				me.imgEl.setWidth("100%");
			}else if(!Ext.isEmpty(me.visibleLength)){
				//width   = me.visibleLength * 6.5 + 22;
				//width   = me.visibleLength * RamcoRTC.headerFontSize + 22;
				width   = me.visibleLength * RamcoRTC.headerFontSize + 25;
				me.imgEl.setWidth(width);
			}else if(!Ext.isEmpty(width)){
				me.imgEl.setWidth(width);
			}else{
				me.imgEl.setWidth("100%");
			}
		} */
		//TECH-36636
		if(me.imgEl){
			if(!Ext.isEmpty(width)){
				me.imgEl.setWidth(width);
			}
			else if(me.visibleLength === 0){
				me.imgEl.setWidth("100%");
			}
			else{
				//width   = me.visibleLength * 6.5 + 22;
				width   = me.visibleLength * RamcoRTC.headerFontSize + 22;
				me.imgEl.setWidth(width);
			}
		}
    },

    onDestroy: function() {
        var me = this,
            imgEl = me.imgEl;

        // Only clean up when the img is a child, otherwise it will get handled
        // by the element destruction in the parent        
        if (imgEl && me.el !== imgEl) {
			this.detachListeners();
            imgEl.destroy();
        }
        this.imgEl = null;
        this.callParent();
    },
    applySrc: function(src) {
        return src && Ext.resolveResource(src);
    },
    setOrgSrc: function(src) {
        var me = this,
            imgEl = me.imgEl;
        me.src = encodeURI(src);
        if (imgEl) {
            imgEl.dom.src = src || Ext.BLANK_IMAGE_URL;
        }
    },
    updateSrc: function(src) {
        var me = this,
            ilbo = me.up('ilbo'),
            imgEl = me.imgEl,
            saveToDb = me.getSaveToDb(),
            hasLink = me.getHasLink(),
            itemId = me.getItemId(),
            srcPath = me.getSrcPath(),
            assView = me.getAssView(),
            dbFileUrl = ilbo ? ilbo.dbFileUrl : '',
            fileUrl = ilbo ? ilbo.fileUrl : '',
			dView = me.getDView(),
			mode = me.getMode();
			
		if (saveToDb) {
            src = Ext.String.format(dbFileUrl, itemId, assView, '0', srcPath, itemId, mode, dView);									
        } 
		else {
            src = Ext.String.format(fileUrl, itemId, itemId, '0', srcPath, assView, mode, dView);			
        }
        me.src = encodeURI(src);

        if (imgEl) {
			setTimeout(function(){
				var errorURL = imgEl.dom.getAttribute('errorurl');
				imgEl.dom.src = (errorURL) ? errorURL : (src || Ext.BLANK_IMAGE_URL);
			},100);
        }
        if (typeof me.srcDelBtn == 'string')
            me.srcDelBtn = ilbo.down('#' + me.srcDelBtn);
        if (src) {
            if (!Ext.isEmpty(me.srcDelBtn) && typeof me.srcDelBtn != 'string')
                me.srcDelBtn.show();
        } else {
            if (!Ext.isEmpty(me.srcDelBtn) && typeof me.srcDelBtn != 'string')
                me.srcDelBtn.hide();
        }
    },

    setGlyph: function(glyph) {
        var me = this,
            glyphFontFamily = Ext._glyphFontFamily,
            old = me.glyph,
            el = me.el,
            glyphParts;

        me.glyph = glyph;
        if (me.rendered && glyph !== old) {
            if (typeof glyph === 'string') {
                glyphParts = glyph.split('@');
                glyph = glyphParts[0];
                glyphFontFamily = glyphParts[1] || glyphFontFamily;
            }

            el.dom.innerHTML = '&#' + glyph + ';';
            if (glyphFontFamily) {
                el.setStyle('font-family', glyphFontFamily);
            }
        }
    },
    initEvents: function() {
        var me = this,
            dom = me.imgEl.dom;

        me.callParent();

        if (me.autoEl == 'img') {
            dom.addEventListener('load', me.onLoad, false);
            dom.addEventListener('error', me.onError, false);
        }
    },
    detachListeners: function() {
        var me = this,
            dom = me.imgEl.dom;

        if (dom) {
            dom.removeEventListener('load', this.onLoad, false);
            dom.removeEventListener('error', this.onError, false);
        }
    },
    onLoad: function(e) {},
    onError: function(e) {
        var me = this,
            imgEl = me.imgEl;
        if (imgEl) {
            imgEl.dom.src = this.errSrc || Ext.BLANK_IMAGE_URL;
        }
    }
});
//Captcha 
Ext.define('Ext.ramco.Captcha', {
    extend: 'Ext.Container',
    alias: 'widget.ramcocaptcha',
    userCls: Ext.baseCSSPrefix + 'ramco-captcha',
    pattern: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMAgJsrThgAAAAPSURBVAjXY1i1igEIiCYBDy8KocXZqHwAAAAASUVORK5CYII=',
    dataType: 'number',
    charLength: 4,
    value: '',
    config: {
        format: ''
    },
    layout: {
        type: 'hbox',
        align: 'stretch'
    },
    code: '',
    height: 50,
    initComponent: function() {
        var me = this,
            baseId = me.getItemId();
        me.image = new Ext.Component({
            itemId: baseId + '_img',
            html: '<canvas id="' + baseId + '_canvas" style="width:100%;height:100%"/>',
            flex: 1
        });
        me.button = new Ext.button.Button({
            ui: 'plain',
            scale: 'large',
            handler: me.drawCaptcha,
            itemId: baseId + '_btn',
            scope: me,
            width: 40,
            iconCls: 'x-fa fa-repeat'
        });
        me.items = [me.image, me.button];
        me.callParent();
    },
    afterRender: function() {
        var me = this;
        me.callParent();
        if (!me.initCaptcha) {
            me.initCaptcha = true;
            me.drawCaptcha();
        }
    },
    drawCaptcha: function() {
        var me = this,
            baseId = me.getItemId(),
            _canvas,
            _img,
            _pat,
            _ctx,
            imageData,
            i = 0,
            c,
            mea,
            y = 0,
            y1 = 0,
            x = 0,
            str = "",
            size;
        _canvasEl = me.el.down('canvas');
        _canvas = _canvasEl.dom;
        size = {
            width: _canvas.width,
            height: _canvas.height
        };
        _img = document.createElement('img');
        _img.setAttribute('src', me.pattern);
        _ctx = _canvas.getContext("2d");
        _ctx.clearRect(0, 0, size.width, size.height);
        _ctx.rect(0, 0, size.width, size.height);
        str = me.getChar();
        me.code = str;
        var x = _canvas.width / 2;
        var y = _canvas.height / 2;
        /*_pat = _ctx.createPattern(_img, "repeat");
        x = 1;
        _ctx.fillStyle = _pat;
        _ctx.fill();
        for (; i < str.length; i++) {
            y = (size.height - 36) / 2;
            _ctx.font = "36pt Roboto";
            c = str[i];
            mea = _ctx.measureText(c);
            _ctx.fillStyle = 'black'
            _ctx.strokeStyle = 'black'
            _ctx.lineWidth = 11;
            _ctx.textBaseline = "middle";
            _ctx.fillText(c, x, y);
            x += Math.ceil(mea.width) + 1;
        }*/
        _ctx.font = 'bold 40px sans-serif';
        _ctx.textAlign = 'center';
        _ctx.fillStyle = 'black';
        _ctx.fillText(str, x, y);
    },
    getNumber: function() {
        return Math.ceil(Math.random() * 10);
    },
    getChar: function() {
        var me = this,
            dataType = me.dataType,
            charLength = me.charLength;
        var str = "",
            i = 0,
            min = dataType == "alpha" ? 10 : 0,
            max = dataType == "numeric" ? 10 : 62;
        for (; i++ < charLength;) {
            var r = Math.random() * (max - min) + min << 0;
            str += String.fromCharCode(r += r > 9 ? r < 36 ? 55 : 61 : 48);
        }
        return str;
    },
    getValue: function() {
        return this.code;
    },
    setValue: function() {}
});

// Attach Field
Ext.define('Ext.ramco.field.Browse', {
    extend: 'Ext.form.field.Text',
    alias: 'widget.ramcofileattach',
    inputType: 'button',
    //cls: Ext.baseCSSPrefix + 'ramco-display-attach',
    userCls: Ext.baseCSSPrefix + 'ramco-attach',
    config: {        
        browseIcon: true,
		delIcon: true,
        dbFileUrl: null,
        staticName: null,
        saveToDb: false,
        hasLink: false,
        fileUrl: null,
        srcPath: null,
        assView: null,		
        mode: null,
        srcDelBtn: null,
        dView: null,
        src: null,
		hdnFileId: null,		
		autoFileName: true
    },
    preSubTpl: [
        '<div id="{cmpId}-triggerWrap" data-ref="triggerWrap"',
        ' role="presentation" class="{triggerWrapCls} {triggerWrapCls}-{ui}">',
        '<tpl for="triggers">{[values.renderTrigger(parent)]}</tpl>',
        '<div id={cmpId}-inputWrap data-ref="inputWrap"',
        ' role="presentation" class="{inputWrapCls} {inputWrapCls}-{ui}">'
    ],

    postSubTpl: [
        '</div>', // end inputWrap
        '</div>' // end triggerWrap
    ],

    initComponent: function() {
        var me = this,
            btn = Ext.create('Ext.ramco.Button.FileBrowse', {
                role: 'uipage',
                itemId: 'browseBtn',
                text: '',
                hidden: true,
                uploadFile: true,
                srcCtrl: me.srcCtrl
            });
        me.cls = Ext.baseCSSPrefix + 'ramco-display-attach'
		browseIcon = me.browseIcon;
		if(me.srcPath == "/") {
			me.srcPath = "./";
		}
        if (browseIcon) {
            me.cls = Ext.baseCSSPrefix + 'ramco-file-attach',
                me.btn = btn;
        }
        me.callParent();
    },
    initEvents: function() {
        var me = this,
            inputEl = me.inputEl;
        me.callParent();
        me.el.dom.setAttribute('itemId', me.getItemId());
        if (inputEl) {
            me.mon(inputEl, 'click', me.onClick, me);
        }
    },
    updateBrowseIcon: function(value) {
        var me = this,
            triggers = me.getTriggers()
        trigger = {
            browse: {
                weight: 1,
                handler: 'onBrowseClick',
                scope: me,
                cls: 'x-fa fa-paperclip'
            }
        };
        if (value !== false) {
            if (triggers) {
                triggers.browse = trigger.browse;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
    },
    updateDelIcon: function(value) {
        var me = this,
            triggers = me.getTriggers(),
            trigger = {
                del: {
                    weight: 1,
                    handler: 'onDeleteClick',
					hideOnReadOnly:false,
                    //hidden: true,
					hidden: !value,
                    scope: me,
                    cls: 'x-fa fa-close'
                }
            };
        if (value !== false) {
            if (triggers) {
                triggers.del = trigger.del;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
		//TECH-40020
		//me.deleteFlag = value;
		if(Ext.isEmpty(me.deleteFlag)) {
			me.deleteFlag = value;
		}
    },
    onBrowseClick: function(ctrl, icon, e) {
        var me = this,
            btn = me.btn;
        if (!btn.rendered)
            btn.render(me.el.dom);
        btn.reset();
		//TECH-39940
        //btn.fileInputEl.dom.click();
        btn.on('change', me.onBtnUploadClick, me);
        e.stopPropagation();
		btn.fileInputEl.dom.click();
    },
    onDeleteClick: function(ctrl, trigger, e) {
        var me = this;
        /* Ext.RamcoMsg.confirm(rvw_resources.R253, rvw_resources.R252 + me.rawValue, function(btnId) {
            if (btnId == "ok" || btnId == "yes") {
                //ctrl.fireEvent('deletefile', me, '', -1, me.getSrcPath(), (me.dView || me.assView));
                ctrl.fireEvent('deletefile', me, '', 0, me.getSrcPath(), (me.dView || me.assView));
            }
        }); */
		//ctrl.fireEvent('deletefile', me, '', 0, me.getSrcPath(), (me.dView || me.assView));
		ctrl.fireEvent('deletefile', me, '', 0, me.getSrcPath(), me.assView, me.dView);
        e.stopPropagation();
        e.preventDefault();
    },
    setValue: function(newValue, oldValue) {
        var me = this,
            ilbo = me.up('ilbo'),
            staticName = me.getStaticName(),
            browseIcon = me.browseIcon,
            triggers = me.getTriggers();
        //TECH-40020
        /* if (browseIcon) {
            // TECH-38150
			//if (newValue) {
			if (newValue && me.deleteFlag === true) {	
                newValue = Ext.isEmpty(staticName) ? newValue : staticName;
                triggers.del.show();
            } else {
                triggers.del.hide();
            }
        } else if (newValue)
            newValue = Ext.isEmpty(staticName) ? newValue : staticName; */
		
		triggers.del.hide();
		if (newValue) {
            newValue = Ext.isEmpty(staticName) ? newValue : staticName;
			if (me.deleteFlag === true) {
                triggers.del.show();
            }		
		}
        /*if (typeof me.srcDelBtn == 'string')
            me.srcDelBtn = ilbo.down('#' + me.srcDelBtn);
        if (newValue) {
            if (!Ext.isEmpty(me.srcDelBtn) && typeof me.srcDelBtn != 'string')
                me.srcDelBtn.show();
        } else {
            if (!Ext.isEmpty(me.srcDelBtn) && typeof me.srcDelBtn != 'string')
                me.srcDelBtn.hide();
        }*/
        me.callParent(arguments);
    },
    onClick: function() {
        if (!this.getValue())
            return;
        var me = this,
            src = null,
            ilbo = me.up('ilbo'),
            saveToDb = me.getSaveToDb(),
            hasLink = me.getHasLink(),
            itemId = me.getItemId(),
            view = me.getItemId(),
            srcPath = me.getSrcPath(),
            assView = me.getAssView(),
            mode = me.getMode(),
            dView = me.getDView(),
			hdnFileId = me.getHdnFileId(),			
			autoFileName = me.getAutoFileName(),
            dbFileUrl = ilbo ? ilbo.dbFileUrl : '',
            fileUrl = ilbo ? ilbo.fileUrl : '',
			formItems,
			rowNo = 0;
		if (me.isFormField) {
			formItems = me.ownerCt;
			if (formItems && formItems.gridToForm === true) {
				itemId = formItems.parentId;
				view = me.dataIndex.replace('v', '');
				rowNo = formItems.cr;
			}
		}
		if(me.gridName && !Ext.isEmpty(me.up('questioner'))){
				rowNo = me.rowNo;
				view = me.viewName;
				itemId = me.gridName;
		}
		//TECH-31705
		if(!Ext.isEmpty(me.up('uigridzoom'))){
				rowNo = me.rowNo;
				view = me.itemId.replace('v', '');
				itemId = me.ctrlId;
		}
        if (saveToDb) {
            src = Ext.String.format(dbFileUrl, itemId, assView, rowNo, srcPath, view, mode, dView);									
        }
		else {
            src = Ext.String.format(fileUrl, itemId, view, rowNo, srcPath, assView, mode, dView);			
        }
		if(hdnFileId)
			src += "&RVWRTQS_CONTROL_HIDDENVIEW=" + hdnFileId;		
        window.open(src);
    },
    onBtnUploadClick: function() {
        var me = this,
            fields = null,
            formData = new FormData(),
            formName = null,
            fileInput = null,
            fileExt = '',
			formItems = null,
			file,fileSize;
        formData.srcPath = me.srcPath;
        formData.controlName = me.itemId;
        formData.controlViewName = me.itemId;
		formData.controlRowNo = 0;
		if (me.isFormField) {
			formItems = me.ownerCt;
			if (formItems && formItems.gridToForm === true) {
				formData.controlName = formItems.parentId;
				formData.controlViewName = me.dataIndex.replace('v', '');
				formData.controlRowNo = formItems.cr;
			}
		}
        formData.saveToDb = me.saveToDb;
        formData.assView = me.assView;        
		formData.dView = me.dView;
		if (me.hdnFileId)
			formData.hdnFileId = me.getHdnFileId();
		if (me.autoFileName)
			formData.autoFileName = me.getAutoFileName();
		if(me.gridName && !Ext.isEmpty(me.up('questioner'))){
			formData.srcPath = me.srcPath;
			formData.controlName = me.gridName;
			formData.controlViewName = me.viewName;
			formData.controlRowNo = me.rowNo;
		}
		//TECH-31705
		if(!Ext.isEmpty(me.up('uigridzoom'))){
				formData.controlName = me.ctrlId;
				formData.controlViewName = me.itemId.replace('v', '');
				formData.controlRowNo = me.rowNo;
		}
        fileInput = me.btn.fileInputEl.dom;
		file = (fileInput && fileInput.files.length > 0) ? fileInput.files[0] : null;
		fileSize = (fileInput && file.size) ? file.size : 0;
		
		var ilboView = me.up('ilbo'),
			controller = (ilboView) ? ilboView.getController() : null,
			errorText, fileExtension, fileObj, maxFileSize; // TECH-34521
			
		// TECH-34521
		maxFileSize = (!Ext.isEmpty(me.maxFileSize)) ? me.maxFileSize : (RamcoRTC.settings.fileUploadMaxSize || 2);
		
		if (file && !Ext.isEmpty(me.acceptFormat)) {
			fileObj = (file.name) ? file.name.split('.') : null;
			if (fileObj) {
				fileExtension = fileObj[fileObj.length - 1];				
				if (fileExtension && me.acceptFormat.indexOf(fileExtension) < 0) {
					errorText = Ext.String.format('The allowed file type[s]: {0}', me.acceptFormat);
					Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
					return false;
				}
			}
		}
		
		if (fileSize == 0) {
			errorText = Ext.String.format(rvw_resources.R261, fileSize);
			if(controller)
				controller.taskPending = false;
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			return false;
		}
		// TECH-34521
		else if ( fileSize > maxFileSize * BYTES_PER_CHUNK ) {
			errorText = Ext.String.format(rvw_resources.R262, maxFileSize);
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			if(controller)
				controller.taskPending = false;
			return false;
		}
		else {
			formData.append('file', fileInput.files[0]);
			formData.file = fileInput.files[0];
			me.fireEvent('uploadfile', me, formData);
		}
    },
	doDestroy: function() {
		var me = this,
			inputEl = me.inputEl,
			btn = me.btn;
		if (inputEl) {
			me.mun(inputEl, 'click', me.onClick, me);
		}
		if (btn) {
			btn.un('change', me.onBtnUploadClick, me);
			Ext.destroy(btn);
		}
		me.callParent();
	}
});


// Avn Attach Field
Ext.define('Ext.ramco.field.AvnBrowse', {
    extend: 'Ext.form.field.Text',
    alias: 'widget.ramcoavnfileattach',
    inputType: 'button',
    userCls: Ext.baseCSSPrefix + 'ramco-attach',
    config: {
        browseIcon: true,
		delIcon: true,        
        fileUrl: null,
        srcPath: null,
        assView: null, 
		customData: null,
        src: null		
    },	
    initComponent: function() {
        var me = this,
            btn = Ext.create('Ext.ramco.Button.FileBrowse', {
                role: 'uipage',
                itemId: 'browseBtn',
                text: '',
                hidden: true,
                uploadFile: true,
                srcCtrl: me.srcCtrl
            });
        me.cls = Ext.baseCSSPrefix + 'ramco-display-attach'
		browseIcon = me.browseIcon;
		if(me.srcPath == "/") {
			me.srcPath = "./";
		}
        if (browseIcon) {
            me.cls = Ext.baseCSSPrefix + 'ramco-file-attach',
                me.btn = btn;
        }
        me.callParent();
		var me = this,
			triggers = me.getTriggers()
		trigger = {
			browse: {
				weight: 1,
				handler: 'onBrowseClick',
				scope: me,
				cls: 'x-fa fa-paperclip'
			},
			del: {
				weight: 1,
				handler: 'onDeleteClick',
				hideOnReadOnly:false,				
				scope: me,
				cls: 'x-fa fa-close'
			}
		};
		me.setTriggers(trigger)
    },
    initEvents: function() {
        var me = this,
            inputEl = me.inputEl;
		me.labelEl.setStyle("display", "none");
        me.callParent();
        me.el.dom.setAttribute('itemId', me.getItemId());
        if (inputEl) {
            me.mon(inputEl, 'click', me.onClick, me);
        }
    },
    /*updateBrowseIcon: function(value) {
        var me = this,
            triggers = me.getTriggers()
        trigger = {
            browse: {
                weight: 1,
                handler: 'onBrowseClick',
                scope: me,
                cls: 'x-fa fa-paperclip'
            }
        };
        if (value !== false) {
            if (triggers) {
                triggers.browse = trigger.browse;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
    },
    updateDelIcon: function(value) {
        var me = this,
            triggers = me.getTriggers(),
            trigger = {
                del: {
                    weight: 1,
                    handler: 'onDeleteClick',
					hideOnReadOnly:false,
                    hidden: true,
                    scope: me,
                    cls: 'x-fa fa-close'
                }
            };
        if (value !== false) {
            if (triggers) {
                triggers.del = trigger.del;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
    },*/
    onBrowseClick: function(ctrl, icon, e) {
        var me = this,
            btn = me.btn;
        if (!btn.rendered)
            btn.render(me.el.dom);
		ctrl.fireEvent('avncustomaction', me, RamcoRTC.userInfo.rd);
		e.stopPropagation();
        e.preventDefault();		
    },
    onDeleteClick: function(ctrl, trigger, e) {
        var me = this;        
		//ctrl.fireEvent('deletefile', me, '', 0, me.getSrcPath(), (me.dView || me.assView));
		ctrl.fireEvent('deletefile', me, '', 0, me.getSrcPath(), me.assView, me.dView);
        e.stopPropagation();
        e.preventDefault();
    },
    setValue: function(newValue, oldValue) {
        var me = this,
            ilbo = me.up('ilbo'),
            staticName = '',
            browseIcon = me.browseIcon,
            triggers = me.getTriggers();
        if (browseIcon) {
            if (newValue) {
                newValue = Ext.isEmpty(staticName) ? newValue : staticName;
                //triggers.del.show();
            } else {
                //triggers.del.hide();
            }
        } else if (newValue)
            newValue = Ext.isEmpty(staticName) ? newValue : staticName;
        /*if (typeof me.srcDelBtn == 'string')
            me.srcDelBtn = ilbo.down('#' + me.srcDelBtn);
        if (newValue) {
            if (!Ext.isEmpty(me.srcDelBtn) && typeof me.srcDelBtn != 'string')
                me.srcDelBtn.show();
        } else {
            if (!Ext.isEmpty(me.srcDelBtn) && typeof me.srcDelBtn != 'string')
                me.srcDelBtn.hide();
        }*/
        me.callParent(arguments);
    },
    onClick: function() {
        if (!this.getValue())
            return;
        var me = this,
            src = null,
            ilbo = me.up('ilbo'),
            itemId = me.getItemId(),
            view = me.getItemId(),
			eventName = null,
            srcPath = me.getSrcPath(),            
            fileUrl = ilbo ? ilbo.avnFileDownloadUrl : '';
            src = Ext.String.format(fileUrl, itemId, view, '0', me.ml, this.getValue(), srcPath, eventName, RamcoRTC.sessionToken);
        window.open(src);
    },
	updateCustomData: function(customdata) {
		var me = this;		
		me.avnUploadWin = Ext.create('Ext.ramco.AvnUplodWindow', {			
			scrollable: true,
			closable: true,
			modal: true,
			custData: customdata,
			listeners: {
				uploadClick: me.onBtnAvnUploadClick.bind(me)
			}
		});
		me.avnUploadWin.show();
		me.destSrcPath = me.avnUploadWin.destSrcPath;
		me.overWriteOption = customdata.DEFAULT;
		me.maxFileSize = parseInt(customdata.FileMaxSize, 10);
	},
    onBtnAvnUploadClick: function(avnFileWindow) {
        var me = this,
            fields = null,
            formData = new FormData(),
            formName = null,
            fileInput = null,
            fileExt = '',
			fileCtrl = null,
			fileErrCmp = '',
			file,fileSize;
        formData.srcPath = me.srcPath;
        formData.controlName = me.itemId;
        formData.controlViewName = me.itemId;
		formData.avnFileUplaod = true,        
        formData.controlRowNo = 0;
		formData.ml = me.ml || false;
		formData.maxFileSize = me.maxFileSize;
		formData.overWriteOption = me.overWriteOption;
		formData.destSrcPath = me.destSrcPath;		
		fileCtrl = avnFileWindow.form.getComponent("file-path");
		fileErrCmp = avnFileWindow.form.getComponent("avnuplderrmsg");
		fileInput = fileCtrl.fileInputEl.dom;
		file = (fileInput && fileInput.files.length > 0) ? fileInput.files[0] : null;
		fileSize = (fileInput && file.size) ? file.size : 0;
		fileSize = (fileSize / 1024);
		formData.uploadedFileSize = fileSize;
		
		var ilboView = me.up('ilbo'),
			controller = (ilboView) ? ilboView.getController() : null,
			errorText, fileExtension, fileObj;
		
		if (file && !Ext.isEmpty(me.acceptFormat)) {
			fileObj = (file.name) ? file.name.split('.') : null;
			if (fileObj) {
				fileExtension = fileObj[fileObj.length - 1];				
				if (fileExtension && me.acceptFormat.indexOf(fileExtension) < 0) {
					errorText = Ext.String.format('The allowed file type[s]: {0}', me.acceptFormat);
					Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
					return false;
				}
			}
		}
		
		if (fileSize == 0) {
			errorText = Ext.String.format(rvw_resources.R261, fileSize);
			if(controller)
				controller.taskPending = false;
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			return false;
		}
		else if ( fileSize > me.maxFileSize ) {				
			errorText = Ext.String.format(rvw_resources.R261, (me.maxFileSize));
			if (fileErrCmp) {
				fileErrCmp.setHtml(errorText);
			}
			else {
				Ext.RamcoMsg.alert(rvw_resources.R261, errorText);
			}
			if(controller)
				controller.taskPending = false;
			return false;
		}
		else {
			formData.append('file', fileInput.files[0]);
			formData.file = fileInput.files[0];
			me.fireEvent('uploadfile', me, formData);
		}
    }	
});

//questioner
Ext.define('Ext.Ramco.QuestController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.quesControl',
    config: {
        control: {
            'field[role=ques]': {
                change: 'onChange'
		    }
	}},
   onChange: function(ctrl,value) {
         var me = this,
			view = me.view,qctrl,pctrl,quest = ctrl.itemId.split('_'),
			qctrl = view.store.findRecord('rn',ctrl.config.rno);
			pctrl = view.store.findRecord('rn',ctrl.config.rno-1);
			if(pctrl && (pctrl.data.v24 == 'SQRH' || pctrl.data.v24 == 'SQRHL' )&& value == true){
			prevRad = view.query('radiofield[rno='+ctrl.config.rno+']');
				if(prevRad.length > 0){
					for( i = 0 ; i<prevRad.length;i++){
						if(ctrl.itemId == prevRad[i].itemId)
							continue;
						prevRad[i].setValue(false);
					}		
				}
				//qctrl = pctrl;
			}else if(ctrl.xtype == "radiofield" && value == true){
				radioCheck = view.query('radiofield[name='+quest[1]+'_RT]');
				if(radioCheck.length > 0){
					radioVal = view.query('radiofield[qno='+quest[1]+']');
					for( i = 0 ; i<radioVal.length;i++){
						if(ctrl.itemId == radioVal[i].itemId)
							continue;
						radioVal[i].setValue(false);
					}
				}

			} 
			if(ctrl.xtype == 'datefield')
				value = Ext.util.Format.date(ctrl.getValue(), 'Y-m-d');
			if(ctrl.xtype == 'radiofield' || ctrl.xtype == 'checkbox' )
				qctrl.data['v'+(parseInt(quest[2])*2+2)]=(value == true)?'1':'0';
			else 
				qctrl.data['v26']=value;
			view.store.cr = qctrl.data.rn;
			qctrl.dirty = true;
			if(!qctrl.modified)
				qctrl.modified = {};
			if(ctrl.xtype == 'radiofield' || ctrl.xtype == 'checkbox' )
				val = ('v'+(parseInt(quest[2])*2+2));
			else
				val = 'v26';
			qctrl.modified[val] = value;
			
	}
	
});

Ext.define('Ext.Ramco.Questioner',{
    extend: 'Ext.form.Panel',
	xtype:'questioner',
	layout: 'vbox',
	controller:'quesControl',
	scrollable:true,
	config:{
		visibleData: 15,
		store:null,
		value:null
		},
	dockedItems:{
		dock: 'bottom',
        xtype: 'toolbar',
        itemId: 'bottomBar',
		items: [{
            text:'First',
			itemId: 'firstBtn',
		},{
            text:'Back',
            itemId: 'backBtn',
        },{
			xtype: 'displayfield',
			name: 'Question',
			itemId: 'quesCount',
		},{
           text:'Next',
			itemId: 'nextBtn',
		},{
			text:'Last',
			itemId: 'lastBtn'
		 }]
	},
	initComponent: function() {
		var me = this,
			firstBtn,backBtn,saveBtn,clearBtn,nextBtn,lastBtn;
		me.callParent();
		me.qnoRno = [];
		me.bottomToolBar = me.down("#bottomBar");
		me.currStart=0;
		//me.currEnd = me.visibleData;
		me.storeLength = 0;
		firstBtn = me.bottomToolBar ? me.bottomToolBar.getComponent('firstBtn') : null;
		backBtn = me.bottomToolBar ? me.bottomToolBar.getComponent('backBtn') : null;
		saveBtn = me.bottomToolBar ? me.bottomToolBar.getComponent('saveBtn') : null;
		clearBtn= me.bottomToolBar ? me.bottomToolBar.getComponent('clearBtn') : null;
		nextBtn = me.bottomToolBar ? me.bottomToolBar.getComponent('nextBtn') : null;
		lastBtn= me.bottomToolBar ? me.bottomToolBar.getComponent('lastBtn') : null;
		quesCount = me.bottomToolBar ? me.bottomToolBar.getComponent('quesCount') : null;
			if (firstBtn)
				me.mon(firstBtn, {
					click: me.firstBtnClick,
					scope: me
				});
			if (backBtn)
				me.mon(backBtn, {
					click: me.backBtnClick,
					scope: me
			});
			if (saveBtn)
				me.mon(saveBtn, {
					click: me.saveBtnClick,
					scope: me
			});
			if (clearBtn)
				me.mon(clearBtn, {
					click: me.clearBtnClick,
					scope: me
			});
			if (nextBtn)
				me.mon(nextBtn, {
					click: me.nextBtnClick,
					scope: me
			});
			if (lastBtn)
				me.mon(lastBtn, {
					click: me.lastBtnClick,
					scope: me
			});
					
	},
	updateStore:function(newStore, oldStore){
		var me = this;
		me.store = newStore;
		if(!Ext.isEmpty(me.lastValue))
			me.updateValue(me.lastValue,'');
	},
	updateValue:function(newValue,oldValue){
		var me = this,
			currPage = getCurrentPage(),controller = getMainController(),lastTask = controller.getLastTask(),visibleValue;
		  visibleValue = currPage.getControlData(me.ascCtrl);
		  	me.lastValue = newValue;
		if(me.store && !me.store.isEmptyStore){
			if(!Ext.isEmpty(newValue.store))
				me.store.setData(newValue.store); 
		  	me.vsi = (newValue.vsi < 1) ? 1 : newValue.vsi;
            me.si = newValue.si;
            me.tr = newValue.tr;
            me.store.nsr = parseInt(newValue.nsr, 10);
            me.store.start = me.si;
			me.store.si = me.si;
            me.store.tr = me.tr;
            me.store.vr = newValue.vr || me.store.vr;
            me.store.vsi = me.vsi;
            if (!me.store.cr)
                me.store.cr = me.vsi;
			me.prepareData();
			if(me.quesData.length > 0){
				me.qnoIter();
				// TECH-27753
				if(!Ext.isEmpty(visibleValue) && parseInt(visibleValue) != 0)
					me.setVisibleData(parseInt(visibleValue));
		    	if(Ext.isEmpty(me.currEnd))
			  		me.currEnd = me.visibleData;
		  		if(lastTask && !(lastTask == 'fileupload' || lastTask == 'filedelete'))
		  			me.currStart = me.qnoRno[0];
		  	
				if(typeof me.qnoRno[me.currStart] == 'undefined' || typeof me.qnoRno[me.currEnd] == 'undefined'){
					me.currStart = me.qnoRno[0];
					len = me.qnoRno.length - 1;
					me.currEnd = me.visibleData
				}
				me.removeAll(true);
				me.createComponent();
			}else{
					me.removeAll(true);
			}	
			delete me.lastValue;
		}
	},
	prepareData:function(){
		var me =this,quesArr = [],hasSub,quesData =null,items = me.store.data.items,len = items.length,
					  subConfig = '',prevConfig = '',checkConfig = '',temConfig = '',anscap,ansCls,numArr = [],
					  ansval,attachJson,attachJsonValue,questioncaption;
		for(i = 0 ;i < len; i++){
			quesObj = {};
			if(items[i].data.v24 == 'QC'){
				questioncaption = items[i].data.v1;
				continue;
			}
			if(typeof questioncaption != 'undefined'){
				quesObj['questioncaption'] = questioncaption;
			}
			
			if(items[i].data.v1 != "")
				quesObj['question'] = items[i].data.v1;
			
			if(items[i].data.v53 != "")
				quesObj['sublabel'] = items[i].data.v53;
			//TECH-36961
			
			//(items[i].data.v45 != "")?quesObj['disabled'] = true:quesObj['disabled'] = false;
			quesObj['disabled'] = (items[i].data.v45 != "");
			
			quesObj['mandatory'] = (!Ext.isEmpty(items[i].data.v37))?'true':'false';
			
			quesObj['config'] = items[i].data.v24;
			quesObj['rno'] = items[i].data.rn;
			quesObj['numberCol'] = items[i].data.v23;
				if(items[i].data.v24 == 'SQRH' || items[i].data.v24 == 'SQRHL' || items[i].data.v24 == 'SQT'){
					if(items[i].data.v24 == 'SQRHL')
						subConfig = 'R';
					hasSub = items[i].data.v23;
					prevConfig = items[i].data.v24;
				}
				if(quesArr.length > 0 && (items[i].data.v24 != 'SQRH' && items[i].data.v24 != 'SQRHL' && items[i].data.v24 != 'SQT' ) && (hasSub > 0)){
				    quesObj['subQuestion'] = items[i].data.v2;
						if(prevConfig == 'SQRHL'){
							quesObj['subConfig'] = items[i].data.v24;
							quesObj['config'] = subConfig;
						}
						hasSub--;
				} 
				temConfig = items[i].data;
				if(temConfig.v24  != "SQT" && temConfig.v24 != "SQRH" && temConfig.v24 != "SQRHL"){
					if(i > 0)
						checkConfig = items[i-1].data.v24;
					//checkConfig = (i > 0)?items[i-1].data.v24:'';
					if(checkConfig == "SQT" || checkConfig == "SQRH" || checkConfig== "SQRHL") 
						temConfig = items[i-1].data;
				for(j = 0 ; j < items[i].data.v23 ;j++){
					anscap = 'anscap'+(j+1);
					ansCls = 'ansCls'+(j+1);
					ansval = 'ansval'+(j+1);
					attachJson = 'attachJson'+(j+1);
					attachJsonValue = 'attachJsonValue'+(j+1);
					w = 'v'+(j+66);
					x = 'v'+(j+56);
					if(!Ext.isEmpty(temConfig[w])){
						quesObj[attachJson] = Ext.decode(temConfig[w]);
						quesObj[attachJson].rowNo = temConfig.rn;
						quesObj[attachJson].viewName = (j+56);
						quesObj[attachJsonValue] = temConfig[x];
					}
					u = 'v'+(((j+1)*2)+1);
					v = 'v'+parseInt((((j+1)*2)+1)+1);
					if(temConfig[u]!=""){
						quesObj[anscap]=temConfig[u];
						quesObj[ansCls]=items[i].data.v32;
					}
					if(typeof items[i].data.modified !='undefined' && items[i].data.modified[v] !='undefined')
						quesObj[ansval] = items[i].data.modified[v];
					else if(items[i].data[v]!="")
						quesObj[ansval]=items[i].data[v];
				}
				if(items[i].data.v25 != ""){
					quesObj['textBoxCap'] = items[i].data.v25;
					quesObj['textCls'] = items[i].data.v32;					
					
				}
				if(typeof items[i].data.modified !='undefined' && items[i].data.modified[v26] !='undefined')
					quesObj['textBoxVal'] = items[i].data.modified[v26];
				else if(items[i].data.v26 !="")
					quesObj['textBoxVal']=items[i].data.v26;
				if(typeof items[i].data.modified !='undefined' && items[i].data.modified[v27] !='undefined'){
					if(items[i].data.v27.indexOf('/')>-1){
						arr = items[i].data.v27.split('/');
						quesObj['textBoxType'] = arr[0];
						quesObj['value'] = items[i].data.modified[v26];
					}
					}else if(items[i].data.v27 != ""){
					if(items[i].data.v27.indexOf('/')>-1){
						arr = items[i].data.v27.split('/');
						quesObj['textBoxType'] = arr[0];
						quesObj['value'] = arr[1];
						}else
					   quesObj['textBoxType'] = items[i].data.v27;
					
				}
				
				if(items[i].data.v28 !="")
					quesObj['textBoxDataType'] =items[i].data.v28.toLowerCase();
				if(items[i].data.v30 !="")
					quesObj['captionReq'] = items[i].data.v30;
				if(items[i].data.v31 !="")
					quesObj['captionAlign'] = items[i].data.v31;
				if(items[i].data.v55 != null && items[i].data.v55 != ""){
					numArr = items[i].data.v55.toString().split(',');
					if(numArr.length > 1){
					quesObj['decimalPrecision'] = numArr[1]?numArr[1]:0;
						quesObj['maxLength'] = parseInt(numArr[0])+1;	
					}else{
						quesObj['decimalPrecision'] = 0;
						quesObj['maxLength'] = parseInt(numArr[0]);	
					}
				}
				
			}
			if(items[i].data.v54 !="")
				quesObj['slno'] = items[i].data.v54;	
			 if(quesObj['subQuestion'] || quesObj['question'] || quesObj['questioncaption']){
				 if(!Ext.isEmpty(quesObj['questioncaption']))
					 quesObj['captionCls'] = items[i-1].data.v48;
				 if(!Ext.isEmpty(quesObj['subQuestion']))
					 quesObj['subCls'] = items[i].data.v47;
				 if(!Ext.isEmpty(quesObj['question']))
					 quesObj['quesCls'] = items[i].data.v46;
			 }
			 if(!Ext.isEmpty(items[i].data.v78)){
				quesObj['questionattach'] =  Ext.decode(items[i].data.v78);
				quesObj['fileName'] = items[i].data.v76;
				quesObj['rowNo'] = items[i].data.rn;
			 }
			quesArr.push(quesObj);
		}
		me.quesData = quesArr;
		me.prevData = me.store.data.items;
	},
	qnoIter:function(){
			var me = this,i=0;
				me.qnoRno = [];
			iterEnd = me.storeLength = me.quesData.length;
			for(;i<iterEnd;i++){
			  if(me.quesData[i].question)
					me.qnoRno.push(i)
			}
		
	},
	createComponent:function(){
		var me = this,store =me.store,component,items = [],end,storeData = me.quesData,i,index,iterEnd=me.storeLength,qno =me.currStart,iterEnd;
			i = me.qnoRno[me.currStart];
			end =me.currEnd ;
			for(;i<iterEnd;i++){
				qno++;
				if(qno <= end){
					if((me.qnoRno[qno]-me.qnoRno[qno-1]<=1)||(me.qnoRno[qno-1] == (iterEnd-1)))
						me.createContainer(storeData[i],qno,i+1);
					else
						i = me.createGroupContainer(storeData,i,iterEnd,qno);
				}else
					break;				
			}
			me.quesCount();
		},
	
	createGroupContainer:function(storeData,i,currEnd,qno){
			var me = this,ctrlConfig = {}, sqno = 0,storeconfig = storeData[i],index = i+1,temconfig,
			config ,items = [],itemsArr=[],iter,xtype,tdCount = 0,textitem = [],textCont,column = 1;
			if(typeof storeconfig['questioncaption'] != 'undefined'){
				questionConfig = {};
			questionConfig['xtype'] = 'label';							
			questionConfig['text'] = storeconfig.questioncaption;
			questionConfig['cls'] = storeconfig.captionCls;		
			questionConfig['width'] = '85%';
			items.push(questionConfig);
			}	
			if(storeconfig.slno == null)
				slno = '';
			else
				slno = storeconfig.slno+'. ';	
			ctrlConfig['xtype'] = 'label';							
			ctrlConfig['text'] = slno+storeconfig.question;
			ctrlConfig['cls'] = [];	
			ctrlConfig['cls'].push(storeconfig.quesCls);	
			ctrlConfig['width'] = '85%';
			(storeconfig['mandatory'] == 'true')?(ctrlConfig['cls'].push('questionCls')):(ctrlConfig['style']= 'padding-left:7px');
			items.push(ctrlConfig);	
			if(storeconfig['sublabel']){
				subctrlConfig = {};
				subctrlConfig['xtype'] = 'label';		
				subctrlConfig['padding'] =  '0 0 0 21';
				subctrlConfig['width'] = '85%';
				subctrlConfig['cls'] = storeconfig.subCls;
				subctrlConfig['text'] = storeconfig.sublabel;
				items.push(subctrlConfig);		
			}
			  temconfig = storeData[index];
			(!Ext.isEmpty(storeconfig['slno']))?tdCount++:tdCount=0;
			while(!temconfig.question){
					iter = 1;
					ctrlConfig = {};
					textitem = [];
					if(temconfig.subQuestion){
						sqno++;
						ctrlConfig['xtype'] = 'label';	
						ctrlConfig['style']= {'padding-left':'21px'};		
						ctrlConfig['text'] = temconfig.subQuestion;
						if(temconfig.subQuestion.length > 35)
							ctrlConfig['cls'] = 'questionLabel';
						if(tdCount > 0 && temconfig.config == 'R' && !Ext.isEmpty(temconfig.subQuestion) && temconfig.subQuestion.length < 35)
							ctrlConfig['tdAttrs'] = {"style": { "padding-top": "40px"}}
						else if(tdCount > 0 && temconfig.config == 'R' && !Ext.isEmpty(temconfig.subQuestion) && temconfig.subQuestion.length > 35)
							ctrlConfig['tdAttrs'] = {"style": { "padding-top": "40px","width":"190px"}}
						itemsArr.push(ctrlConfig);	
					}
					config = temconfig.config;
					switch(config){
						case 'C':
							while(iter<=temconfig.numberCol){
									ctrlConfig = me.controlConfigItems(temconfig,'checkbox',qno,index+1,iter);
									itemsArr.push(ctrlConfig);
									iter++
								}
							break;
							
						case 'R':
							while(iter<=temconfig.numberCol){
									/* 	ctrlConfig = me.controlConfigItems(temconfig,'radiofield',qno,index+1,iter);
									if((storeData[index-1].config == 'SQRH'||storeData[index-1].config == 'SQRHL') && Ext.isEmpty(ctrlConfig['label']))
										ctrlConfig['tdAttrs'] = {"style": {"padding-top": "40px"}};
									ctrlConfig['name'] = sqno;
									itemsArr.push(ctrlConfig);
									iter++ */
										ctrlConfig = me.controlConfigItems(temconfig,'radiofield',qno,index+1,iter);
									ctrlConfig['name'] = sqno;
									if(!Ext.isEmpty(ctrlConfig['label'])){
										labelConfig = {};
										labelConfig['text'] = ctrlConfig['label'];
										labelConfig['xtype'] = 'label';
										labelConfig['width'] = '100%';
										labelConfig['margin'] = '0 0 0 20';
										labelConfig['height'] = 40;
										ctrlConfig['fieldLabel'] = '';
										ctrlConfig['label'] = '';
										textCont = Ext.create('Ext.Container',{layout: {type: 'vbox'},width:100,margin:'0 0 0 2',
										items:[labelConfig,ctrlConfig]});
										itemsArr.push(textCont);
										iter++
									}else{
									itemsArr.push(ctrlConfig);
									iter++
									}
								}
								if(temconfig.textBoxType || temconfig.subConfig){
									ctrlConfig = {};
									ctrlConfig['xtype'] = 'label';	
									if(tdCount > 0 && !Ext.isEmpty(temconfig.textBoxCap) && temconfig.textBoxCap.length < 35)
									ctrlConfig['tdAttrs'] = {"style": {"padding-top": "40px"}};
									else if(tdCount > 0 && !Ext.isEmpty(temconfig.textBoxCap) && temconfig.config == 'R' && temconfig.textBoxCap.length > 35)
									ctrlConfig['tdAttrs'] = {"style": {"padding-top": "40px","width":"190px"}}
									tdCount = 0;		
									ctrlConfig['name'] = sqno;									
									if(!Ext.isEmpty(temconfig.textBoxCap) && temconfig.textBoxCap.length > 35)
										ctrlConfig['cls'] = 'questionLabel';
									ctrlConfig['text'] = temconfig.textBoxCap;
									itemsArr.push(ctrlConfig);
									iter++;
								}else
									 tdCount = 0; 
							break;
							
						case 'T':	
							iter++;
							switch(temconfig.textBoxType){
								case 'A':
									xtype = 'textarea';
									break;
								case 'T':
									if(temconfig.textBoxDataType == 'date')	
										xtype = 'datefield'	;
									else if(temconfig.textBoxDataType == 'numeric' || temconfig.textBoxDataType == 'int' )	
										xtype = 'numberfield'	;
									else
										xtype = 'textfield'	;	
									break;
								case 'SLR':		
									xtype = 'sliderfield';
									break;
								case 'S':
									xtype = 'ramcorating';	
									break;
								default:
									xtype = 'textfield'	; 
							};

							ctrlConfig = me.controlConfigItems(temconfig,xtype,qno,index+1,iter);
							if(xtype == 'textarea'){
								ctrlConfig['height'] = '70px';
								ctrlConfig['visibleLength'] = '50';
							}
							if(xtype == 'textfield' || xtype == 'textarea' || xtype == 'numberfield' ){
								ctrlConfig['disabled'] = false;
								ctrlConfig['readOnly'] = storeconfig.disabled;
							}
							ctrlConfig['name'] = qno;
							if(temconfig['textCls'])
								ctrlConfig['cls'].push(temconfig['textCls']);
							ctrlConfig['hideLabel'] = false;
							itemsArr.push(ctrlConfig);
							break;
							
						case 'CT':
							while(iter<=temconfig.numberCol){
									ctrlConfig = me.controlConfigItems(temconfig,'checkbox',qno,index+1,iter);
									ctrlConfig['width'] = 375;
									 if( !Ext.isEmpty(ctrlConfig.boxLabel) && ctrlConfig.boxLabel.length > 300)
										ctrlConfig['height'] = (ctrlConfig.boxLabel.length > 300)?ctrlConfig.boxLabel.length-60:''; 
									textitem.push(ctrlConfig); 
									if(temconfig.textBoxDataType == 'date')	
										xtype = 'datefield'	;
									else if(temconfig.textBoxDataType == 'numeric' || temconfig.textBoxDataType == 'int')	
										xtype = 'numberfield'	;
									else
										xtype = 'textfield'	;	
									ctrlConfig = me.controlConfigItems(temconfig,xtype,qno,(index+1),iter);
									ctrlConfig['hideLabel'] = false;
									ctrlConfig['fieldLabel'] = '';
									labelConfig = {};
									labelConfig['text'] = temconfig.textBoxCap;
									labelConfig['cls'] = temconfig.textCls?temconfig.textCls:'';
									labelConfig['xtype'] = 'label';
									labelConfig['width'] = (!Ext.isEmpty(temconfig.textBoxCap) && temconfig.textBoxCap.length > 140)?300:210;
									textitem.push(labelConfig);		
									ctrlConfig['width'] = 165;
									ctrlConfig['itemId'] = 'questionNo_'+qno+'_'+iter+'_'+(index+1)+'_text';
									if(xtype == 'textfield' || xtype == 'numberfield'){
										ctrlConfig['disabled'] = false;
										ctrlConfig['readOnly'] = temconfig.disabled;
									}
								textitem.push(ctrlConfig);
									iter++
								}
							textCont = Ext.create('Ext.Container',{layout: {type: 'hbox'},defaults:{padding : '5 0 0 20'},items:textitem});
								
							itemsArr.push(textCont);
							break;
							
						case 'RT':
							while(iter<=temconfig.numberCol){
									ctrlConfig = me.controlConfigItems(temconfig,'radiofield',qno,(index+1),iter);
									ctrlConfig['name'] = qno+'_RT';
									ctrlConfig['width'] = 375;
								textitem.push(ctrlConfig);
									if(temconfig.textBoxDataType == 'date')	
										xtype = 'datefield'	;
									else if(temconfig.textBoxDataType == 'numeric' || temconfig.textBoxDataType == 'int')	
										xtype = 'numberfield'	;
									else
										xtype = 'textfield'	;	
									ctrlConfig = me.controlConfigItems(temconfig,xtype,qno,index,iter);
									ctrlConfig['name'] = qno;
									ctrlConfig['hideLabel'] = false;
									ctrlConfig['fieldLabel'] = '';
									labelConfig = {};
									labelConfig['text'] = temconfig.textBoxCap;
									labelConfig['cls'] = temconfig.textCls?temconfig.textCls:'';
									labelConfig['xtype'] = 'label';
									labelConfig['width'] = (!Ext.isEmpty(temconfig.textBoxCap) && temconfig.textBoxCap.length > 140)?300:210;
									textitem.push(labelConfig);		
									ctrlConfig['width'] = 165;
									ctrlConfig['itemId'] = 'questionNo_'+qno+'_'+iter+'_'+(index+1)+'_text';
									if(xtype == 'textfield' || xtype == 'numberfield'){
										ctrlConfig['disabled'] = false;
										ctrlConfig['readOnly'] = temconfig.disabled;
									}
								textitem.push(ctrlConfig);
									iter++
								}
							textCont = Ext.create('Ext.Container',{layout: 'hbox',padding:'2 0 0 3',width:'100%',items:	textitem})
							itemsArr.push(textCont);	
							break;			
						}
					column = column>iter?column:iter;
					if(!temconfig.subQuestion){
						--column
					}
					index++;
					if(index<currEnd)
							temconfig = storeData[index];
					else
						break;	
				}
					if(column > 5 && itemsArr[0].text.length > 35){
				quesCont = Ext.create('Ext.form.Panel',{layout:{type:'ramcotable',columns:column,tdAttrs: {style: {width:'90px'}}},items:itemsArr});
							items.push(quesCont);
				me.add({xtype: 'form',padding: '2 0 0 20',layout:'vbox',scrollable:true,width: '100%',/* disabled:storeconfig.disabled, */items: items});								
					}else{
						
				 quesCont = Ext.create('Ext.form.Panel',{layout:{type:'ramcotable',columns:column},items:itemsArr}) 
							
			items.push(quesCont);
			
				 me.add({xtype: 'form',padding: '2 0 0 20',layout:'vbox',width: '100%',/* disabled:storeconfig.disabled, */items: items});
					}		
		return (index-1);
	},
	createContainer:function(storeconfig,qno,index){
		var me = this,ctrlConfig = {},
			config = storeconfig.config,
			items = [],comp = {},i = 1,xtype,x,fieldVal,fieldcap,textitem = [];
			if(storeconfig.slno == null)
				slno = '';
			else
				slno = storeconfig.slno+'. ';
			if(typeof storeconfig['questioncaption'] != 'undefined'){
				questionConfig = {};
			questionConfig['xtype'] = 'label';							
			questionConfig['cls'] = [];
			questionConfig['cls'].push(storeconfig.captionCls);
			questionConfig['cls'].push('questionContainer');		
			questionConfig['width'] = '85%';
			questionConfig['text'] = storeconfig.questioncaption;
			items.push(questionConfig);
			}
			
			if(storeconfig.question){		
				ctrlConfig['xtype'] = 'label';
				ctrlConfig['text'] = slno+storeconfig.question;
				ctrlConfig['cls'] = [];
				ctrlConfig['cls'].push(storeconfig.quesCls);
				ctrlConfig['cls'].push('questionContainer');				
				ctrlConfig['width'] = '85%';
				(storeconfig['mandatory'] == 'true')?(ctrlConfig['cls'].push('questionCls')):(ctrlConfig['style']= 'padding-left:7px');
				items.push(ctrlConfig);
				ctrlConfig = {}
			}
			if(storeconfig['sublabel']){
				subctrlConfig = {};
				subctrlConfig['xtype'] = 'label';		
				subctrlConfig['padding'] =  '0 0 0 21';
				subctrlConfig['cls'] = [];
				subctrlConfig['cls'].push(storeconfig.subCls);
				subctrlConfig['cls'].push('questionContainer');
				subctrlConfig['width'] = '85%';
				subctrlConfig['text'] = storeconfig.sublabel;
				items.push(subctrlConfig);		
			}
			if(storeconfig['questionattach']){
					imageConfig = {};
					if(config == 'IMV' || config == 'LIV'||config == 'RIV'||config == 'CIV'){
						imageConfig['xtype'] = 'ramcoimageattach';
						imageConfig['width'] = storeconfig.questionattach.width?parseInt(storeconfig.questionattach.width):30;
						imageConfig['height'] = storeconfig.questionattach.Height?parseInt(storeconfig.questionattach.Height):30;
					}
					else{
						imageConfig['xtype'] = 'ramcofileattach';
						imageConfig['width'] = '85%';
					}
					imageConfig['value'] = storeconfig.fileName;
					imageConfig['srcPath'] = storeconfig.questionattach.srcPath;
					imageConfig['gridName'] = me.itemId;
					imageConfig['viewName'] = '76';
					imageConfig['role'] = 'uipage';
					imageConfig['rowNo'] = storeconfig.rowNo;
					imageConfig['browseIcon'] = (storeconfig.questionattach.browseIcon == "true")?true:false;
					imageConfig['delIcon'] = (storeconfig.questionattach.delIcon == "true")?true:false;
					imageConfig['saveToDb'] = (storeconfig.questionattach.saveToDb == "true")?true:false;
					imageConfig['hasLink'] = (storeconfig.questionattach.hasLink == "true")?true:false;
					imageConfig['dView'] = storeconfig.questionattach.dView;
					imageConfig['autoFileName'] = (storeconfig.questionattach.autoFileName == "true")?true:false;
					items.push(imageConfig);
				}
		switch(config){
			case 'C':
				while(i<=storeconfig.numberCol){
						ctrlConfig = me.controlConfigItems(storeconfig,'checkbox',qno,index,i);
						ctrlConfig['role'] = 'ques';
						ctrlConfig['cls'].push('questionContainer');
						ctrlConfig['width'] =  '90%';
						if(!Ext.isEmpty(ctrlConfig.boxLabel) && ctrlConfig.boxLabel.length > 250)
							  ctrlConfig['height'] = ctrlConfig.boxLabel.length-130;
						items.push(ctrlConfig);
						i++
					}
				break;
			case 'R':
				while(i<=storeconfig.numberCol){
					ctrlConfig = me.controlConfigItems(storeconfig,'radiofield',qno,index,i);
					ctrlConfig['name'] = qno;
					ctrlConfig['cls'].push('questionContainer');
					ctrlConfig['width'] =  '90%';
					if(!Ext.isEmpty(ctrlConfig.boxLabel) && ctrlConfig.boxLabel.length > 250)
						   ctrlConfig['height'] = ctrlConfig.boxLabel.length-130;
					items.push(ctrlConfig);
					i++
				}
				break;
				
			case 'T':	
				if(storeconfig.textBoxType == 'A')	
					xtype = 'textarea';
				else if(storeconfig.textBoxType == 'T'){
					if(storeconfig.textBoxDataType == 'date')	
						xtype = 'datefield'	;
					else if(storeconfig.textBoxDataType == 'numeric' || storeconfig.textBoxDataType == 'int')	
						xtype = 'numberfield';
					else
					xtype = 'textfield'	;	}
				else if(storeconfig.textBoxType == 'SLR')
					xtype = 'sliderfield';
				else if(storeconfig.textBoxType == 'S')
					xtype = 'ramcorating';									
				ctrlConfig['value'] = 0;
				ctrlConfig = me.controlConfigItems(storeconfig,xtype,qno,index,i);
				if(xtype == 'textarea'){
					ctrlConfig['height'] = '70px';
					ctrlConfig['visibleLength'] = '50';
				}
				if(xtype == 'textarea' || xtype == 'textfield' || xtype == 'numberfield'){
					ctrlConfig['disabled'] = false;
					ctrlConfig['readOnly'] = storeconfig.disabled;
				}
				ctrlConfig['name'] = qno;
				ctrlConfig['cls'].push('questionContainer');
				if(storeconfig['textCls'])
					ctrlConfig['cls'].push(storeconfig['textCls']);
				ctrlConfig['hideLabel'] = false;
				items.push(ctrlConfig);
				break;
							
			case 'CT':
				while(i<=storeconfig.numberCol){
						ctrlConfig = me.controlConfigItems(storeconfig,'checkbox',qno,index,i);
						textitem.push(ctrlConfig); 
						if(storeconfig.textBoxDataType == 'date')	
							xtype = 'datefield'	;
						else if(storeconfig.textBoxDataType == 'numeric' || storeconfig.textBoxDataType == 'int')	
							xtype = 'numberfield';
						else
						xtype = 'textfield'	;	
					
						ctrlConfig = me.controlConfigItems(storeconfig,xtype,qno,index,i);
						ctrlConfig['hideLabel'] = false;
						ctrlConfig['itemId'] = 'questionNo_'+qno+'_'+i+'_'+index+'_text';
					textitem.push(ctrlConfig);
						i++
					}
					
					textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},items:textitem});
					
				items.push(textCont);
				break;
				
			case 'RT':
				while(i<=storeconfig.numberCol){
						ctrlConfig = me.controlConfigItems(storeconfig,'radiofield',qno,index,i);
						ctrlConfig['name'] = qno;
					textitem.push(ctrlConfig); 
						if(storeconfig.textBoxDataType == 'date')	
							xtype = 'datefield'	;
						else if(storeconfig.textBoxDataType == 'numeric' || storeconfig.textBoxDataType == 'int')	
							xtype = 'numberfield'	;
						else
						xtype = 'textfield'	;	
						ctrlConfig = me.controlConfigItems(storeconfig,xtype,qno,index,i);
						ctrlConfig['name'] = qno;
						ctrlConfig['hideLabel'] = false;
						ctrlConfig['itemId'] = 'questionNo_'+qno+'_'+i+'_'+index+'_text';
					textitem.push(ctrlConfig);
						i++
					}
					textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},width: '100%',items:textitem})
				items.push(textCont);	
				break;
				case'LA':
						while(i<=storeconfig.numberCol){
							textitem = [];
						    ctrlConfig = me.controlConfigItems(storeconfig,'label',qno,index,i);
							ctrlConfig['flex'] = 0.5;
							ctrlConfig['name'] = qno;
							textitem.push(ctrlConfig); 
							ctrlConfig = me.controlConfigItems(storeconfig,'ramcofileattach',qno,index+1,i);
							ctrlConfig['flex'] = 0.5;
							textitem.push(ctrlConfig);
							i++;
							textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},width: '100%',items:textitem})
							items.push(textCont);
						}
				break;
				 case'IMV':
						while(i<=storeconfig.numberCol){
							ctrlConfig = me.controlConfigItems(storeconfig,'ramcoimageattach',qno,index+1,i);
							items.push(ctrlConfig);
							i++
						}
				break;
				 case'AV':
					while(i<=storeconfig.numberCol){
							ctrlConfig = me.controlConfigItems(storeconfig,'ramcofileattach',qno,index+1,i);
							items.push(ctrlConfig);
							i++
						}
				break;
				case 'LI':
					while(i<=storeconfig.numberCol){
								textitem = [];
								ctrlConfig = me.controlConfigItems(storeconfig,'label',qno,index,i);
								ctrlConfig['flex'] = 0.5;
								ctrlConfig['name'] = qno;
								textitem.push(ctrlConfig); 
								ctrlConfig = me.controlConfigItems(storeconfig,'ramcoimageattach',qno,index+1,i);
								ctrlConfig['flex'] = 0.5;
								textitem.push(ctrlConfig);
								i++;
								textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},width: '100%',items:textitem})
								items.push(textCont);
					}
				break;
				case 'LAV':
					while(i<=storeconfig.numberCol){
						       textitem = [];
								ctrlConfig = me.controlConfigItems(storeconfig,'label',qno,index,i);
								ctrlConfig['flex'] = 0.5;
								ctrlConfig['name'] = qno;
								textitem.push(ctrlConfig); 
								ctrlConfig = me.controlConfigItems(storeconfig,'ramcofileattach',qno,index+1,i);
								ctrlConfig['flex'] = 0.5;
								textitem.push(ctrlConfig);
								i++;
								textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},width: '100%',items:textitem})
								items.push(textCont);
					}
				break;					
				case'RAV':
					while(i<=storeconfig.numberCol){
						        textitem = [];
								ctrlConfig = me.controlConfigItems(storeconfig,'radiofield',qno,index,i);
								ctrlConfig['flex'] = 0.5;
								ctrlConfig['name'] = qno;
								textitem.push(ctrlConfig); 
								ctrlConfig = me.controlConfigItems(storeconfig,'ramcofileattach',qno,index+1,i);
								ctrlConfig['flex'] = 0.5;
								textitem.push(ctrlConfig);
								i++;
								textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},width: '100%',items:textitem})
								items.push(textCont);
					}
				break;
				case'CAV':
				case'CA':
				while(i<=storeconfig.numberCol){
					        textitem = [];
							ctrlConfig = me.controlConfigItems(storeconfig,'checkbox',qno,index,i);
							ctrlConfig['flex'] = 0.5;
							ctrlConfig['name'] = qno;
							textitem.push(ctrlConfig); 
							ctrlConfig = me.controlConfigItems(storeconfig,'ramcofileattach',qno,index+1,i);
							ctrlConfig['flex'] = 0.5;
							textitem.push(ctrlConfig);
							i++;
							textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},width: '100%',items:textitem})
							items.push(textCont);
						}
				break;
				case'RIV':
				while(i<=storeconfig.numberCol){
					        textitem = [];
							ctrlConfig = me.controlConfigItems(storeconfig,'radiofield',qno,index,i);
							ctrlConfig['flex'] = 0.5;
							ctrlConfig['name'] = qno;
							textitem.push(ctrlConfig); 
							ctrlConfig = me.controlConfigItems(storeconfig,'ramcoimageattach',qno,index+1,i);
							ctrlConfig['flex'] = 0.5;
							textitem.push(ctrlConfig);
							i++;
							textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},width: '100%',items:textitem})
							items.push(textCont);
						}
				break;
				case'CIV':
				 case'CI':
				while(i<=storeconfig.numberCol){
					        textitem = [];
							ctrlConfig = me.controlConfigItems(storeconfig,'checkbox',qno,index,i);
							ctrlConfig['flex'] = 0.5;
							ctrlConfig['name'] = qno;
							if(ctrlConfig.cls.length == 0)
								delete ctrlConfig.cls;
							textitem.push(ctrlConfig); 
							ctrlConfig = me.controlConfigItems(storeconfig,'ramcoimageattach',qno,index+1,i);
							ctrlConfig['flex'] = 0.5;
							textitem.push(ctrlConfig);
							i++;
							textCont = Ext.create('Ext.Container',{layout: 'hbox',defaults:{padding : '5 0 0 20'},width: '100%',items:textitem})
							items.push(textCont);
						}
				break;			
			}
		contCont = {xtype: 'form',padding: '5 0 0 20',layout:'vbox',width: '100%',itemId:'contCont'+slno/* ,disabled:storeconfig.disabled */,items:items}
		me.add(contCont);
	},
	controlConfigItems: function(storeconfig,xtype,qno,index,iter){
		var ctrlConfig = {},me = this,fieldcap,fieldVal,attachJson,attachJsonValue;
					fieldcap = 'anscap'+iter;
					fieldVal = 'ansval'+iter;
					ctrlConfig['xtype'] = xtype;
					if(storeconfig[fieldVal] == true)
						ctrlConfig['checked'] = true;
					else
						ctrlConfig['checked'] = false;
					
					if(storeconfig['textBoxVal'] && xtype!='radiofield'&& xtype!= 'checkbox'){
						if(xtype  == 'numberfield')
							ctrlConfig['rawValue'] = storeconfig['textBoxVal'];
						else
							ctrlConfig['value'] = storeconfig['textBoxVal'];	
						ctrlConfig['fielLabel'] = storeconfig[fieldcap];
						ctrlConfig['labelWidth'] = '100%';
				}else if(xtype == 'radiofield' || xtype == 'checkbox'){
						if(Ext.isEmpty(storeconfig.subQuestion)){
						 ctrlConfig['boxLabelAlign'] = storeconfig.captionAlign?storeconfig.captionAlign:'left';
						 ctrlConfig['boxLabel'] = 	storeconfig[fieldcap];	
						 ctrlConfig['labelWidth'] = '70%';
						 ctrlConfig['qno'] = qno;
						 
						}else{
							ctrlConfig['fieldLabel'] = storeconfig[fieldcap];
							ctrlConfig['label'] = 	storeconfig[fieldcap];
							ctrlConfig['labelWidth'] = '70%';
							ctrlConfig['style'] = 'padding-left:7px';
							ctrlConfig['qno'] = qno;
							ctrlConfig['labelAlign'] = storeconfig.captionAlign?storeconfig.captionAlign:'left';
						}
						
				}
				if(xtype == 'datefield')
					ctrlConfig['altFormats'] = ctrlConfig['format']= RamcoRTC.userPreference.dateFormat;
					ctrlConfig['padding'] = '2 0 0 20px';
		ctrlConfig['cls'] = [];
		if(storeconfig['ansCls'+iter])
			ctrlConfig['cls'].push(storeconfig['ansCls'+iter]);	
					
					ctrlConfig['role'] = 'ques';
					ctrlConfig['itemId'] = 'questionNo'+'_'+qno+'_'+iter+'_'+index;
					 if(storeconfig.captionAlign == 'right'){
						ctrlConfig['hideLabel'] = true; 
						ctrlConfig['boxLabel'] = storeconfig[fieldcap];
					} 
					if(storeconfig.textBoxType == 'T'){
							if(xtype == 'numberfield'){
								  if(storeconfig['maxLength']){
								   ctrlConfig['maxLength'] = parseInt(storeconfig['maxLength']);
								   ctrlConfig['decimalPrecision'] = parseInt(storeconfig['decimalPrecision']);
								   ctrlConfig['dataPrec'] = parseInt(storeconfig['decimalPrecision']);
								   
								  }
						}
					if(xtype == 'textareafield')
							      ctrlConfig['anchor'] = '100%';
						if(xtype == 'textfield'){
							ctrlConfig['fieldLabel'] = storeconfig.textBoxCap;
							ctrlConfig['labelWidth'] = "100%";
						}
						}
				if(storeconfig.textBoxType == 'SLR' ){
						ctrlConfig['increment'] = 1;
						ctrlConfig['minValue'] = 0;
						ctrlConfig['maxValue'] = storeconfig['value'];
						ctrlConfig['width'] = 200;
				} 
				if(storeconfig.textBoxType == 'S'){
						ctrlConfig['step'] = 1;
						ctrlConfig['minValue'] = 0;
						ctrlConfig['boxType'] = 'star';
						ctrlConfig['maxValue'] = parseInt(storeconfig['value']);
						ctrlConfig['width'] = '100%';
						
					}
					if(xtype == 'ramcofileattach' ||  xtype == 'ramcoimageattach'){
						attachJson = 'attachJson'+iter;
						attachJsonValue = 'attachJsonValue'+iter;
						ctrlConfig['xtype'] = xtype;
						ctrlConfig['value'] = storeconfig[attachJsonValue]?storeconfig[attachJsonValue]:null;
						ctrlConfig['srcPath'] = storeconfig[attachJson]?storeconfig[attachJson].srcPath:null;
						ctrlConfig['gridName'] = me.itemId;
						ctrlConfig['viewName'] = storeconfig[attachJson]?storeconfig[attachJson].viewName:null;
						ctrlConfig['rowNo'] =storeconfig[attachJson]? storeconfig[attachJson].rowNo:null;
						ctrlConfig['role'] = 'uipage';
						ctrlConfig['browseIcon'] = (storeconfig[attachJson] && storeconfig[attachJson].browseIcon == "true")?true:false;
						ctrlConfig['delIcon'] = (storeconfig[attachJson] && storeconfig[attachJson].delIcon == "true") ?true:false;
						ctrlConfig['saveToDb'] = (storeconfig[attachJson]&& storeconfig[attachJson].saveToDb == "true")?true:false;
						ctrlConfig['hasLink'] = (storeconfig[attachJson]&& storeconfig[attachJson].hasLink == "true")?true:false;
						ctrlConfig['dView'] = storeconfig[attachJson]?storeconfig[attachJson].dView:null;
						ctrlConfig['autoFileName'] = (storeconfig[attachJson]&& storeconfig[attachJson].autoFileName == "true")?true:false;
						if(xtype == 'ramcoimageattach'){
							ctrlConfig['height'] = (storeconfig[attachJson]&& storeconfig[attachJson].Height)?parseInt(storeconfig[attachJson].Height):30;
							ctrlConfig['width'] =(storeconfig[attachJson] && storeconfig[attachJson].width)?parseInt(storeconfig[attachJson].width):30;
						}
					}
					ctrlConfig['disabled'] = storeconfig.disabled;
					ctrlConfig['rno'] = storeconfig['rno'];
				return ctrlConfig;
	},
	firstBtnClick:function(){
		if(this.quesData.length == 0)
			return;
		var me = this,
			vr= me.visibleData;
			me.currStart = 0;
			me.currEnd = vr;
			me.prepareData();
			me.removeAll(true);
			me.createComponent();
				
	},
	backBtnClick:function(){
		if(this.quesData.length == 0)
			return;
		var me = this,
			vr= me.visibleData,
			noQues = me.qnoRno.length,
			start = me.currStart;
			if((start-vr)>=0){	
					me.currStart = parseInt(start - vr);
					me.currEnd = start;
					me.prepareData();
					me.removeAll(true);
					me.createComponent();
				}	
	},
	nextBtnClick:function(){
		if(this.quesData.length == 0)
			return;
		var me = this,
			vr= me.visibleData,
			noQues = me.qnoRno.length;
			if(me.currEnd<noQues){	
					me.currStart = me.currEnd;
					me.currEnd = parseInt(me.currStart+vr);
					me.prepareData();
					me.removeAll(true);
					me.createComponent();
				}	
	},
	lastBtnClick:function(){
		if(this.quesData.length == 0)
			return;
		var me = this,
			vr= me.visibleData,
			noQues = me.qnoRno.length,enddif;
			if(noQues%vr>0)
				enddif = noQues%vr;
			else
				enddif =vr;
			me.currStart = parseInt(noQues-enddif);
			me.currEnd = noQues;
			me.prepareData();
			me.removeAll(true);
			me.createComponent();
	},
	quesCount:function(){
		var me = this,
			end = me.currEnd>me.qnoRno.length?me.qnoRno.length:me.currEnd;
			quesCount = me.bottomToolBar ? me.bottomToolBar.getComponent('quesCount') : null;
			quesCount.setValue('<span class="x-QNo(s)">'+(me.currStart+1)+' - '+end+' / '+me.qnoRno.length+' </span>')
	}

});

// Inplace Image Attach Field
Ext.define('Ext.ramco.field.ImgBrowse', {
    //extend: 'Ext.Container',
	extend: 'Ext.form.field.Text',
    alias: 'widget.ramcoimageattach',
	inputType: 'image',
    layout: {
        type: 'hbox',
        align: 'start'
    },
    config: {
        browseIcon: true,
		delIcon: true,        
        dbFileUrl: null,
        saveToDb: false,
        hasLink: false,
        fileUrl: null,
        srcPath: null,
        assView: null,
        mode: null,
        dView: null,
        src: null,
        value: null, // TECH-28698 / KNB-184
		hdnFileId: null,		
		autoFileName: true
    },
	preSubTpl: [
        '<div id="{cmpId}-triggerWrap" data-ref="triggerWrap"',
        ' role="presentation" class="{triggerWrapCls} {triggerWrapCls}-{ui}">',
        '<tpl for="triggers">{[values.renderTrigger(parent)]}</tpl>',
        '<div id={cmpId}-inputWrap data-ref="inputWrap"',
        ' role="presentation" class="{inputWrapCls} {inputWrapCls}-{ui}">'
    ],

    postSubTpl: [
        '</div>', // end inputWrap
        '</div>' // end triggerWrap
    ],
    initComponent: function() {
        var me = this,
            itemId = me.itemId,
            width = parseInt(me.width),
            btn = Ext.create('Ext.ramco.Button.FileBrowse', {
                role: 'uipage',
                itemId: 'browseBtn',
                text: '',
                hidden: true,
                uploadFile: true,
                srcCtrl: me.srcCtrl
            }),
            browseIcon = me.browseIcon;
			// TECH-36262
			if(Ext.isBoolean(me.deleteFlag))
				me.setDelIcon(me.deleteFlag);
        
		/*if (browseIcon)
            me.items = [{
                xtype: 'button',
                handler: 'onBrowseClick',
                width: 24,
                height: 24,
                ui: 'plain',
                scope: me,
                iconCls: 'x-fa fa-paperclip'
            }, {
                xtype: 'button',
                hidden: true,
                itemId: 'delBtn',
                handler: 'onDeleteClick',
                width: 24,
                height: 24,
                ui: 'plain',
                scope: me,
                iconCls: 'x-fa fa-close'
            }, {
                itemId: itemId + '_img',
                xtype: 'ramcoimage'
            }];
        else
            me.items = [{
                itemId: itemId + '_img',
                xtype: 'ramcoimage'
            }];
        */
		
		if(me.srcPath == "/") {
			me.srcPath = "./";
		}
        if (browseIcon) {
            me.cls = Ext.baseCSSPrefix + 'ramco-image-attach',
			me.btn = btn;
        }
		me.callParent();
		/*if (me.rendered) {
			me.img = view.down('#' + itemId + '_img');
			me.delBtn = view.down('#delBtn');
			me.btn = btn;			
			me.img.setSize(width - 28, me.height);
			me.setSize(width + 28, me.height);
		}
		if(me.gridName){
			var controller = getMainController(),
			currHelp = controller.getCurrentHelp() || controller.getCurrentView(),
			questionCtrl = currHelp.down('questioner');
			if(questionCtrl && !Ext.isEmpty(me.value)){
				me.setSrc(me.value);
			}
		}*/
    },
    initEvents: function() {
        /* var me = this,
			div = me.img.el.up('div');
        me.callParent();
		
        div.on('click', me.onClick, me);
        me.el.dom.setAttribute('itemId', me.getItemId());*/
		
	    var me = this,
			inputEl = me.inputEl;
        me.callParent();
        me.el.dom.setAttribute('itemId', me.getItemId());
        if (inputEl) {
			if (!Ext.isEmpty(me.height)) {
				inputEl.setHeight(me.height);
			}
			if (!Ext.isEmpty(me.width)) {
				inputEl.setWidth(me.width);
			}
            me.mon(inputEl, 'click', me.onClick, me);
			if (RamcoRTC.isGProto) {
				inputEl.dom.src = Ext.BLANK_IMAGE_URL;
			}
        }
    },
    updateBrowseIcon: function(value) {
		var me = this,
            triggers = me.getTriggers()
        trigger = {
            browse: {
                weight: 1,
                handler: 'onBrowseClick',
                scope: me,
                cls: 'x-fa fa-paperclip'
            }
        };
        if (value !== false) {
            if (triggers) {
                triggers.browse = trigger.browse;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
	},
	updateDelIcon: function(value) {
        var me = this,
            triggers = me.getTriggers(),
            trigger = {
                del: {
                    weight: 1,
                    handler: 'onDeleteClick',
					hideOnReadOnly:false,
                    hidden: !value,
                    scope: me,
                    cls: 'x-fa fa-close'
                }
            };
        if (value !== false) {
            if (triggers) {
                triggers.del = trigger.del;
                me.setTriggers(triggers);
            } else {
                me.setTriggers(trigger);
            }
        }
		// TECH-36262
		else {
			if(triggers && triggers.del)
				delete triggers.del;
			me.setTriggers(triggers);
		}
    },    
    // TECH-28698 / KNB-184
    onDeleteClick: function(ctrl, elm, e) {
        var me = this;
        /* Ext.RamcoMsg.confirm(rvw_resources.R253, rvw_resources.R252 + me.rawValue, function(btnId) {
            if (btnId == "ok" || btnId == "yes") {
                me.fireEvent('deletefile', me, '', 0, me.getSrcPath(), me.dView);
            }
        }); */
		//me.fireEvent('deletefile', me, '', 0, me.getSrcPath(), me.dView);
		me.fireEvent('deletefile', me, '', 0, me.getSrcPath(), me.assView, me.dView);
        e.stopPropagation();
        e.preventDefault();
    },
    onBrowseClick: function(ctrl, icon, e) {
        var me = this,
            btn = me.btn;
        if (!btn.rendered)
            btn.render(me.el.dom);
        btn.reset();
        //TECH-39940
		//btn.fileInputEl.dom.click();
        btn.on('change', me.onBtnUploadClick, me);
        e.stopPropagation();
		btn.fileInputEl.dom.click();
    },
    onClick: function() {
        if (!this.getValue())
            return;
        var me = this,
            src = null,
            ilbo = me.up('ilbo'),
			uigridzoom = me.up('uigridzoom'),
		    saveToDb = me.getSaveToDb(),
            hasLink = me.getHasLink(),
            itemId = me.getItemId(),
            view = me.getItemId(),
            srcPath = me.getSrcPath(),
            assView = me.getAssView(),
            mode = me.getMode(),
            dView = me.getDView(),
			task = me.task,
			hdnFileId = me.getHdnFileId(),
            dbFileUrl = ilbo ? ilbo.dbFileUrl : '',
            fileUrl = ilbo ? ilbo.fileUrl : '';
			rowNo = 0;
		    if(me.gridName && !Ext.isEmpty(me.up('questioner'))){
				rowNo = me.rowNo;
				view = me.viewName;
				itemId = me.gridName;
			}
			//TECH-31705
			if(!Ext.isEmpty(uigridzoom)){
				rowNo = me.rowNo;
				view = me.itemId.replace('v', '');
				itemId = me.ctrlId;
				if((hasLink && me.preventDownload) || (hasLink === false && saveToDb === false))//AHBG-31996
					return;
				if (task) {
					var sel = uigridzoom.down('#sel'),
					 viewModel = ilbo.getViewModel(),data;
					 if(sel)
						 sel.setValue(1);
					data = viewModel.getSessionData();
					ilbo.fireEvent('mltrans', ilbo, data, task, 'link',itemId,view,0,0);
					return;
				}
			}

        if (saveToDb) {
            src = Ext.String.format(dbFileUrl, itemId, assView, rowNo, srcPath, view, mode, dView);									
        }
		else {
            src = Ext.String.format(fileUrl, itemId, view, rowNo, srcPath, assView, mode, dView);			
        }
		if(hdnFileId)
			src += "&RVWRTQS_CONTROL_HIDDENVIEW=" + hdnFileId;
        window.open(src);
    },
    onBtnUploadClick: function() {
        var me = this,
            fields = null,
            fileInput = null,
            formData = new FormData(),
			file,fileSize;
        formData.srcPath = me.srcPath;
        formData.controlName = me.itemId;
        formData.controlViewName = me.itemId;
        formData.saveToDb = me.saveToDb;
        formData.assView = me.assView;		
		formData.dView = me.dView;
		if (me.hdnFileId)
			formData.hdnFileId = me.getHdnFileId();
		if (me.autoFileName)
			formData.autoFileName = me.getAutoFileName();
        formData.controlRowNo = 0;
        fileInput = me.btn.fileInputEl.dom;
		file = (fileInput && fileInput.files.length > 0) ? fileInput.files[0] : null;
		fileSize = (fileInput && file.size) ? file.size : 0;
		if(me.gridName && !Ext.isEmpty(me.up('questioner'))){
			formData.srcPath = me.srcPath;
			formData.controlName = me.gridName;
			formData.controlViewName = me.viewName;
			formData.controlRowNo = me.rowNo;
		}
		//TECH-31705
		if(!Ext.isEmpty(me.up('uigridzoom'))){
				formData.controlName = me.ctrlId;
				formData.controlViewName = me.itemId.replace('v', '');
				formData.controlRowNo = me.rowNo;
		}
		
		var ilboView = me.up('ilbo'),
			controller = (ilboView) ? ilboView.getController() : null,
			errorText, fileExtension, fileObj, maxFileSize; // TECH-34521
		
		// TECH-34521
		maxFileSize = (!Ext.isEmpty(me.maxFileSize)) ? me.maxFileSize : (RamcoRTC.settings.fileUploadMaxSize || 2);
		
		if (file && !Ext.isEmpty(me.acceptFormat)) {
			fileObj = (file.name) ? file.name.split('.') : null;
			if (fileObj) {
				fileExtension = fileObj[fileObj.length - 1];				
				if (fileExtension && me.acceptFormat.indexOf(fileExtension) < 0) {
					errorText = Ext.String.format('The allowed file type[s]: {0}', me.acceptFormat);
					Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
					return false;
				}
			}
		}
		
		if (fileSize == 0) {
			errorText = Ext.String.format(rvw_resources.R261, fileSize);
			if(controller)
				controller.taskPending = false;
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			return false;
		}
		// TECH-34521
		else if ( fileSize > maxFileSize * BYTES_PER_CHUNK ) {
			errorText = Ext.String.format(rvw_resources.R262, maxFileSize);
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			if(controller)
				controller.taskPending = false;
			return false;
		}
		else {
			formData.append('file', fileInput.files[0]);
			formData.file = fileInput.files[0];
			me.fireEvent('uploadfile', me, formData);
		}
    },
    setSrc: function(value) {
        var me = this,
            height = me.height,
            src = null,
            ilbo = me.up('ilbo'),
			uigridzoom = ilbo.down('uigridzoom'),
            saveToDb = me.getSaveToDb(),
            hasLink = me.getHasLink(),
            itemId = me.getItemId(),
            view = me.getItemId(),
            srcPath = me.getSrcPath(),
            assView = me.getAssView(),
            mode = me.getMode(),
            dView = me.getDView(),
			hdnFileId = me.getHdnFileId(),
            dbFileUrl = ilbo ? ilbo.dbFileUrl : '',
            fileUrl = ilbo ? ilbo.fileUrl : '';
        me.rawValue = value;
		me.value = value;
		rowNo = '0';
		if(me.gridName){
			var controller = getMainController(),
			currHelp = controller.getCurrentHelp() || controller.getCurrentView(),
			dbFileUrl = currHelp.dbFileUrl,
			fileUrl = currHelp.fileUrl;
			view = me.viewName;
			itemId = me.gridName;
			rowNo = me.rowNo;
			
		}
		//TECH-31705
		if(!Ext.isEmpty(uigridzoom)){
			view = me.itemId.replace('v','');
			itemId = me.ctrlId;
			rowNo = me.rowNo;
		}
		

        if (saveToDb) {
            src = Ext.String.format(dbFileUrl, itemId, assView, rowNo, srcPath, view, mode, dView);									
        }
		else {
            src = Ext.String.format(fileUrl, itemId, view, rowNo, srcPath, assView, mode, dView);			
        }
        if (me.delBtn) {
            if (value) {
                me.delBtn.show();
            } else {
                me.delBtn.hide();
            }
        }
        src = value ? src : '';
		//TECH-31705
		if(!Ext.isEmpty(uigridzoom)){
			if(!Ext.isEmpty(value)){
				if(hasLink && !saveToDb)
					src = Ext.String.format(fileUrl, itemId, view, rowNo, srcPath, assView, mode, dView);
				else if(me.linkImage && value.toLowerCase().indexOf(ilbo.ilboConfig.componentName) < 0 && !saveToDb)
					src = "app/classic/" + ilbo.ilboConfig.componentName + "/" + value;
				else if(!me.linkImage && !saveToDb){
					values = value.split("/");
					src = 'app/classic/' + ilbo.ilboConfig.componentName + "/" + 'Images/' + values[values.length - 1];
				}
			}
			else
				src = '';
		}
		if(hdnFileId)
			src += "&RVWRTQS_CONTROL_HIDDENVIEW=" + hdnFileId;
        //me.img.setOrgSrc(src);
		me.setOrgSrc(src);
    },	
	setOrgSrc: function(src) {
		// TECH-28698 / KNB-184 / TECH-29013
		var me = this,
			inputEl = me.inputEl,
			inputElDom = inputEl && inputEl.dom,
			tooltip = me.value || '';
		me.src = encodeURI(src);
		if (!Ext.isEmpty(inputElDom)) {
			inputElDom.src = src || Ext.BLANK_IMAGE_URL;
			inputElDom.setAttribute('data-qtip', tooltip);
			inputElDom.setAttribute('imagefile', true);
		}
    }
});

// Attach Button
Ext.define('Ext.ramco.Button.FileAttach', {
    extend: 'Ext.button.Button',
    alias: 'widget.ramcofileupload',
});

// Access Key Override
Ext.define('Ext.o.button.Button', {
    override: 'Ext.button.Button',
    onRender: function() {
        var me = this,
            addOnclick,
            btn,
            btnListeners,
			toolTip; // TECH-28977 / ANZ-192

        me.callParent(arguments);

        // Set btn as a local variable for easy access
        btn = me.el;

		// TECH-28977 / ANZ-192
		if(!Ext.isEmpty(me.tooltip))
			toolTip = me.tooltip;
		/* else if (!Ext.isEmpty(me.sTooltip))
			toolTip = me.sTooltip; */

        if (!Ext.isEmpty(toolTip)) {
            me.setTooltip(toolTip, true);
        }
        if (me.accesskey) {
            btn.dom.setAttribute('accesskey', me.accesskey);
        }
        // Add the mouse events to the button
        if (me.handleMouseEvents) {
            btnListeners = {
                scope: me,
                mouseover: me.onMouseOver,
                mouseout: me.onMouseOut,
                mousedown: me.onMouseDown,
                contextmenu: me.onContextMenu
            };
            if (me.split) {
                btnListeners.mousemove = me.onMouseMove;
            }
        } else {
            btnListeners = {
                scope: me
            };
        }

        // Touch start events must be preventDefaulted when in disabled state
        if (Ext.supports.Touch) {
            btnListeners.touchstart = me.onTouchStart;
        }

        // Check if it is a repeat button
        if (me.repeat) {
            me.mon(new Ext.util.ClickRepeater(btn, Ext.isObject(me.repeat) ? me.repeat : {}), 'click', me.onRepeatClick, me);
        } else {

            // If the activation event already has a handler, make a note to add the handler later
            if (btnListeners[me.clickEvent]) {
                addOnclick = true;
            } else {
                btnListeners[me.clickEvent] = me.onClick;
            }
        }

        // Add whatever button listeners we need
        me.mon(btn, btnListeners);

        if (me.hasFrameTable()) {
            me.mon(me.frameTable, 'click', me.frameTableListener, me);
        }

        // If the listeners object had an entry for our clickEvent, add a listener now
        if (addOnclick) {
            me.mon(btn, me.clickEvent, me.onClick, me);
        }

        Ext.button.Manager.register(me);
    },
    onContextMenu: function(e) {
        this.fireEvent('contextmenu', this, e);
    }
});
//TECH-34101
Ext.define('Ext.form.o.field.FileButton', {
    override: 'Ext.form.field.FileButton',
    alias: 'widget.filebutton',
	  afterTpl: [
        '<input id="{id}-fileInputEl" data-ref="fileInputEl" class="{childElCls} {inputCls}" ',
            'type="file" size="1" name="{inputName}" unselectable="on" ',
            '<tpl if="accept != null">accept="{accept}"</tpl>',
            '<tpl if="tabIndex != null">tabindex="{tabIndex}"</tpl>',
			'<tpl if="multiple != null">multiple="{multiple}"</tpl>',
        '>'
    ],
	getTemplateArgs: function() {
        var me = this,
            args;
		if(!Ext.isEmpty(RamcoRTC.acceptFileType)){
			me.acceptTypes = "." + RamcoRTC.acceptFileType.replace(/,/g,",.");		 
		}
        args = me.callParent();        
        args.inputCls = me.inputCls;
        args.inputName = me.inputName || me.id;
        args.tabIndex = me.tabIndex != null ? me.tabIndex : null;
        args.accept = me.accept || me.acceptTypes || null;
        args.role = me.ariaRole;
		args.multiple = me.multiple || false;        
        return args;
    }    
});

// Browse Button
Ext.define('Ext.ramco.Button.FileBrowse', {
    extend: 'Ext.form.field.FileButton',
    alias: 'widget.ramcofilebrowse',
	config: {
		hdnFileId: null,		
		autoFileName: true
    },
    getFile: function() {
        var me = this;
        fileInput = me.fileInputEl,
            file = null;
        if (fileInput && fileInput.dom) {
            if (fileInput.dom.files && fileInput.dom.files.length > 0)
                file = fileInput.dom.files[0];
        }
        return file;
    },
	//TECH-34101
	getMultiFile: function() {
        var me = this;
        fileInput = me.fileInputEl,
            file = null;
        if (fileInput && fileInput.dom) {
            if (fileInput.dom.files && fileInput.dom.files.length > 0)
                file = fileInput.dom.files;
        }
        return file;
    }

});

// Thumb Slider
Ext.define('Ext.o.slider.Thumb', {
    override: 'Ext.slider.Thumb',
    getElConfig: function() {
        var me = this,
            slider = me.slider,
            style = {};

        style[slider.vertical ? slider.verticalProp : slider.horizontalProp] = slider.calculateThumbPosition(slider.normalizeValue(me.value)) + '%';
        return {
            style: style,
            id: this.id,
            cls: this.cls,
            role: 'presentation'
        };
    },

    /**
     * @private
     * move the thumb
     */
    move: function(v, animate) {
        var me = this,
            el = me.el,
            slider = me.slider,
            styleProp = slider.vertical ? slider.verticalProp : slider.horizontalProp,
            to,
            from,
            animCfg;

        v += '%';

        if (!animate) {
            el.dom.style[styleProp] = v;
        } else {
            to = {};
            to[styleProp] = v;

            if (!Ext.supports.GetPositionPercentage) {
                from = {};
                from[styleProp] = el.dom.style[styleProp];
            }

            // Animation config
            animCfg = {
                target: el,
                duration: 350,
                from: from,
                to: to,
                scope: me,
                callback: me.onAnimComplete
            };
            if (animate !== true) {
                Ext.apply(animCfg, animate);
            }

            me.anim = new Ext.fx.Anim(animCfg);
        }
    }
});

// GridSlider Control
Ext.define('Ext.ramco.Slider', {
    extend: 'Ext.slider.Single',
    alias: 'widget.ramcoslider',
    verticalProp: 'top',
	userCls: 'x-ramco-slider',
    getTrackpoint: function(xy) {
        var me = this,
            vertical = me.vertical,
            sliderTrack = me.innerEl,
            trackLength, result,
            positionProperty;

        if (vertical) {
            positionProperty = 'top';
            trackLength = sliderTrack.getHeight();
        } else {
            positionProperty = me.horizontalProp;
            trackLength = sliderTrack.getWidth();
        }
        xy = me.transformTrackPoints(sliderTrack.translatePoints(xy));
        result = Ext.Number.constrain(xy[positionProperty], 0, trackLength);
        return result;
        //return vertical ? trackLength - result : result;
    },
    getSubTplData: function(fieldData) {
        var me = this,
            data, ariaAttr;

        data = Ext.apply(me.callParent([fieldData]), {
            $comp: me,
            vertical: me.vertical ? Ext.baseCSSPrefix + 'ramco-slider-vert' : Ext.baseCSSPrefix + 'ramco-slider-horz',
            minValue: me.minValue,
            maxValue: me.maxValue,
            value: me.value,
            tabIdx: me.tabIndex,
            childElCls: ''
        });

        ariaAttr = data.inputElAriaAttributes;

        if (ariaAttr) {
            ariaAttr['aria-orientation'] = me.vertical ? 'vertical' : 'horizontal';
            ariaAttr['aria-valuemin'] = me.minValue;
            ariaAttr['aria-valuemax'] = me.maxValue;
            ariaAttr['aria-valuenow'] = me.value;
        }

        return data;
    }
});
//SliderFieldContainer
Ext.define('Ext.ramco.SliderContainer' , {
		extend: 'Ext.Container',
		alias: 'widget.slidercontainer',
		hideLabel:true,
		endValue:0,
		layout: {
			type: "ramcotable",
			columns: 2,
			tableAttrs: {
			  style: {
				"width": "100%"
			  }
			}
	    },
		config: {
			dataType: 'integer',
			sliderType: 'dynamic',
			sliderBehaviour: 'pointer',
			renderType: 'line',
			vertical: false,
			showValue: true,
			useTips : false,
			step: 10,
			minValue: 0,
			maxValue: 100,			
			value:null
		},		
		initComponent: function() {
			var me = this,
				id = me.getItemId(),
				dataType = me.getDataType(),
				sliderType = me.getSliderType(),
				sliderBehaviour = me.getSliderBehaviour(),
				renderType = me.getRenderType(),
				vertical = me.getVertical(),
				height = me.height || '100%',				
				showValue = me.getShowValue(),
				useTips = me.getUseTips(),
				increment = me.getStep(),
				minValue = me.getMinValue(),
				maxValue = me.getMaxValue();
				me.sliderCtrl = sliderCtrl = Ext.create('Ext.ramco.form.field.Slider',{
						xtype : 'slider',
						itemId : id + '_sldctrl',					
						dataType : dataType,
						sliderType : sliderType,
						sliderBehaviour : sliderBehaviour,
						renderType : renderType,
						vertical : vertical,
						height: height,						
						showValue : showValue,
						useTips : useTips,						
						increment : increment,
						minValue : minValue,
						maxValue : maxValue,
						tdAttrs: {
							style: {
							  width: (vertical) ? "20%" :"90%"
							}
					    }
					});	
				me.sliderCtrlValFld = sliderCtrlValFld = Ext.create('Ext.ramco.LabelView', {
						xtype : "ramcolabel",
						minValue : minValue,
						maxValue : maxValue,
						visibleLength:4,
						height: 20,
						itemId : id + '_sldvalfld',
						tdAttrs: {
							style: {
							  width: (vertical) ? "80%" :"10%"
							}
					    }
				});	
				me.items = [sliderCtrl,sliderCtrlValFld];
				me.width = (vertical) ? 20 : me.width,
				me.callParent();
				me.mon(sliderCtrl, {
					scope:me,
					change:me.onSliderChange,
					changecomplete:me.onChangeComplete,					
				});
				me.mon(sliderCtrlValFld, {
					scope:me,
					change:me.onSliderFieldChange					
				});
		},
		getEndValue: function() {
			return this.endValue;
		},
		setEndValue: function(evalue) {			
			this.endValue = evalue;
		},
		onBoxReady: function() {
			var me = this,
				width = me.getWidth();
			me.sliderCtrl.setWidth(parseInt(width * 0.85));
		},
		updateSliderValue: function (value, eOpts) {
			var me = this ,
				oldVal = me.getEndValue();
			me.sliderCtrlValFld.suspendEvents();
			me.sliderCtrl.suspendEvents();
			me.sliderCtrl.setValue(value);			
			me.sliderCtrlValFld.setValue(value);
			me.setEndValue(value);
			me.sliderCtrl.resumeEvents();
			me.sliderCtrlValFld.resumeEvents();
			me.fireEvent('change', me, value, oldVal, eOpts);
		},
		onChangeComplete: function (slider , newValue , thumb , eOpts) {			
			this.updateSliderValue(newValue, eOpts);			
		},
		onSliderChange: function ( slider , newValue , thumb , eOpts ) {
			this.updateSliderValue(newValue, eOpts);			
		},
		onSliderFieldChange: function (ctrl, newValue, oldValue, eOpts) {
			this.updateSliderValue(newValue, eOpts);			
		},		
		updateValue: function(newValues) {
			var me = this;
			if(me.sliderCtrl) {
				me.sliderCtrlValFld.suspendEvents();
				me.sliderCtrl.suspendEvents();
				me.sliderCtrl.setValue(newValues.value || me.minValue);
				me.sliderCtrlValFld.setValue(newValues.value || me.minValue);
				me.sliderCtrl.resumeEvents();
				me.sliderCtrlValFld.resumeEvents();
			}
		}
});
// Slider Control
Ext.define('Ext.ramco.form.field.Slider', {
    extend: 'Ext.slider.Single',
    alias: 'widget.ramcosliderfield',
	xtype: 'ramcosliderfield',
    verticalProp: 'top',
	cls: Ext.baseCSSPrefix + 'ramcoslider-field',
    getTrackpoint: function(xy) {
        var me = this,
            vertical = me.vertical,
            sliderTrack = me.innerEl,
            trackLength, result,
            positionProperty;

        if (vertical) {
            positionProperty = 'top';
            trackLength = sliderTrack.getHeight();
        } else {
            positionProperty = me.horizontalProp;
            trackLength = sliderTrack.getWidth();
        }
        xy = me.transformTrackPoints(sliderTrack.translatePoints(xy));
        result = Ext.Number.constrain(xy[positionProperty], 0, trackLength);
        return result;
        //return vertical ? trackLength - result : result;
    },
    getSubTplData: function(fieldData) {
        var me = this,
            data, ariaAttr;

        data = Ext.apply(me.callParent([fieldData]), {
            $comp: me,
            vertical: me.vertical ? Ext.baseCSSPrefix + 'slider-vert' : Ext.baseCSSPrefix + 'ramco-slider-horz',
            minValue: me.minValue,
            maxValue: me.maxValue,
            value: me.value,
            tabIdx: me.tabIndex,
            childElCls: ''
        });

        ariaAttr = data.inputElAriaAttributes;

        if (ariaAttr) {
            ariaAttr['aria-orientation'] = me.vertical ? 'vertical' : 'horizontal';
            ariaAttr['aria-valuemin'] = me.minValue;
            ariaAttr['aria-valuemax'] = me.maxValue;
            ariaAttr['aria-valuenow'] = me.value;			
        }
        return data;
    }
});

// Ramco Chart Control
Ext.define('Ext.ramco.Chart', {
	extend: 'Ext.Component',
    alias: 'widget.ramcochart',
	liquidLayout: true,
    bodyPadding: 2,
    ascCtrl: '',
    ascEvent: '',
    config: {
        chartType: 'column2d',
        cls: Ext.baseCSSPrefix + 'chart',
        chart: null,
        dataXml: '',
        chartXml: ''
    },
	childEls: [
        'bodyEl'
    ],
	renderTpl:'<div id="{id}-bodyEl" data-ref="bodyEl"></div>',
    constructor: function() {
        this.callParent(arguments);
        if (!window.FusionCharts) {
            this.setHtml('FusionCharts API is required');
        }
    },
    afterComponentLayout: function(w, h) {
        var me =this;
			me.callParent(arguments);
		//setTimeout(function(){
			me.redraw();
		//},10);
    },
    redraw: function() {
		if (this.isDestroyed)
			return;
        var me = this,
			fc = (window.FusionCharts || {}),
            chart = me.getChart(),
            width, height;
		if (fc && Ext.isEmpty(chart)) {
            me.createChart();
        }
        /*if (fc && chart) {
            width = this.getWidth();
            height = this.getHeight();
            chart.resizeTo(width - 10, height - 10);
        }*/
    },
    /* updateChart: function(chart) {
        var me = this,
            chartType = me.getChartType().toLowerCase(),
            chart = me.getChart();
        if (chart) {
            chart.chartType(chartType);
            me.setChart(chart);
        }
    }, */
    createChart: function() {
		try {
			var me = this,
				width = me.getWidth(),
				height = me.getHeight(),
				chart = me.getChart(),
				id = me.getItemId() + "_chart",
				chartDataString = me.getChartXml(),
				chartType = me.getChartType().toLowerCase();			
			if (chart) {
				chart.chartType(chartType);
				chart.setXMLData(chartDataString);
				chart.resizeTo(width - 10, height - 10);
			} else {
			    if (!Ext.isEmpty(chartDataString)) {
					if(FusionCharts(id))
						FusionCharts(id).dispose();
					chart = new FusionCharts(chartType, id, width, height);
					chart.render(me.bodyEl.dom);
					chart.setXMLData(chartDataString);
					me.setChart(chart);
				}
			}
		}
		catch(ex) {}
    },
    updateChartType: function(newChartType, oldChartType) {
        var me = this;
        if (newChartType) {
            var chart = me.getChart();
			if (chart) {
				chart.chartType(newChartType.toLowerCase());
				//me.setChart(chart);
			}
			
        }
    },
    setValue: function(dataXml) {
        this.setDataXml(dataXml);
    },
    updateDataXml: function(newXml) {
        if (Ext.isEmpty(newXml)) return;
        var me = this,
            chartType = me.getChartType().toLowerCase(),
            chartDataString = null,
            newChartType = chartType,
            chartLink = null,
            chartLinks = null,
            chartLinkData = null,
            chartDataPlotVal = null,
            chartDataPlotLbl = null;
        if (typeof newXml == "string") {
            XmlParser = new DOMParser();
            me.dataXml = XmlParser.parseFromString(newXml, "text/xml");
        } else
            me.dataXml = newXml;

        var chartResult = me.dataXml.querySelector("chartresult") || null,
            chartData, chartTypeNode;
        if (chartResult)
            chartData = chartResult.querySelector("chart");
        else
            chartData = me.dataXml.querySelector("graph");

        if (chartData) {
            chartLinks = chartData.getElementsByTagName("set");
            if (chartLinks && chartLinks.length > 0) {
                for (var j = 0; j < chartLinks.length; j++) {
                    chartLink = chartLinks[j];
                    chartLinkData = chartLink.getAttribute("link") || "";
                    chartDataPlotVal = chartLink.getAttribute("value");
                    chartDataPlotLbl = chartLink.getAttribute("label") || chartLink.getAttribute("name");
                    if (!Ext.isEmpty(me.ascEvent) && !Ext.isEmpty(me.ascCtrl)) {
						chartLinkData = "JavaScript:chartClick('" + me.itemId + "','" + chartDataPlotLbl + "','" + chartDataPlotVal + "','" + chartLinkData.replace("S-", "") + "');";
                        chartLink.setAttribute("link", chartLinkData);
                    } else if (chartLinkData) {
						chartLinkData = "JavaScript:chartClick('" + me.itemId + "','" + chartLinkData.replace("S-", "") +"');";
                        chartLink.setAttribute("link", chartLinkData);
                    }
                }
            }
        }
        if (chartResult)
            chartTypeNode = chartResult.querySelector("charttype");
        else if(chartData)
            chartTypeNode = chartData.getAttribute("charttype");
        if (typeof chartTypeNode == 'string' && !Ext.isEmpty(chartTypeNode)) {
            newChartType = chartTypeNode;
        } else if (chartTypeNode) {
            newChartType = chartTypeNode.textContent;
        }
        if (chartData) {
            chartDataString = me.xml2String(chartData);
        }
        me.setChartXml(chartDataString);
        if (newChartType != chartType) {
            me.setChartType(newChartType);
        }
        var chart = me.getChart();
        if (chart)
            chart.setXMLData(chartDataString);
    },
    xml2String: function(node) {
        if (typeof(XMLSerializer) !== 'undefined') {
            var serializer = new XMLSerializer();
            return serializer.serializeToString(node);
        } else if (node.xml) {
            return node.xml;
        }
    },
    destroy: function() {
        var chart = this.getChart();
        if (chart) {
            chart.dispose();
        }
        this.callParent();
    },
    SetChartClickData: function(taskName, chartDataLabel, chartDataVal, associatedChartCtrl, view) {
        var me = this;
		this.fireEvent('chartdata', taskName, chartDataLabel, chartDataVal, associatedChartCtrl);
    }
});
//TECH-27237 - Changes for open street map
//TECH-28715 - MapMyIndia Implementation in Ext JS6
// Ramco Map Control 
Ext.define('Ext.ramco.Map', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.ramcomap',
    config: {
        iconPath: '',
        dataType: null,
        directionsDisplay: false,
        useMarkerClusterer: false,
        zoom: 12,
        clustererZoom: null,
        clustererSize: null,
        clustererStyle: null,
		dragMarker:false,
        customControls: false,
		createMarkers:false,
        imagePath: '../resources/images/maps/m',
        imageExtension: 'png',
        infoWindowTpl: ['<tpl if="hastoolbar">',
            '<div id="{id}_toolbar" class="infobubble-toolbar">',
            '<div id="{id}_title" class="infobubble-title"><span class="infobubble-title-text" >{title}</span></div>',
            '<div id="{id}_space" style="-webkit-box-flex: 1;"></div>',
            '<tpl if="hasclosable">',
            '<div id="{id}_close" class="x-btn x-btn-plain {closeCls}"></div>',
            '</tpl>',
            '</div>',
            '</tpl>',
            '<div id="{id}_body" class="infobubble-body" style="-webkit-box-flex:1;{bodyStyle}">',
            '<tpl if="hasiframe">',
            '<iframe name="{id}_frame" id="{id}_frame" width="100%" height="100%" style="margin:0px;overflow:hidden;border:0"></iframe>',
            '</tpl>',
            '<tpl if="hasiframe != true">',
            '{body}',
            '</tpl>',
            '</div>',
            '<tpl if="hasbottombar">',
            '<div id="{id}_bottombar" class="infobubble-bottombar">',
            '<div id="{id}_cancel" class="x-btn x-unselectable x-ltr x-btn-default-small" ><span class="x-btn-inner x-btn-inner-default-small" id="{id}_lable_no">{cancelText}</span></div>',
            '<div style="width: 20px;"></div>',
            '<div id="{id}_ok" class="x-btn x-unselectable x-ltr x-btn-default-small"  ><span class="x-btn-inner x-btn-inner-default-small" id="{id}_lable_yes">{okText}</span></div>',
            '</div>',
            '</tpl>',
            '<tpl if="hasfloatbutton">',
            '<div  id="{id}_float" class="{floatCls}" style="border-color:{borderColor};border-width:2px">{floatdata}</div>',
            '</tpl>', {
                compiled: true
            }
        ]
    },
    initComponent: function() {
        this.markers = [];
		this.circles = [];
        this.cluster = {};
        this.direction = {};
        this.cluster["markers"] = [];
        if (this.getCustomControls() === true) {
            this.listControls = this.listControls || [];
            this.listControls.push({
                caption: rvw_resources.R094,
                tooltip: rvw_resources.R134,
                itemId: 'btnhome'
            });
            this.listControls.push({
                caption: 'Back',
                tooltip: rvw_resources.R135,
                itemId: 'btnback'
            });
            this.listControls.push({
                caption: 'Refresh',
                tooltip: rvw_resources.R136,
                itemId: 'btnrefresh'
            });
            if (this.getUseMarkerClusterer())
                this.listControls.push({
                    caption: 'Hide Cluster',
                    tooltip: rvw_resources.R137,
                    itemId: 'btnclustershow'
                });
        }
        this.zoomLevel = [];
        this.zoomLevel.push(this.getZoom());
        this.callParent();
    },
    initMap: function() {
        var me = this;
        if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "hereMap"){//TECH-37671
			var element = me.el,
                mapOptions = {};
			Ext.applyIf(mapOptions, {
					center: new L.LatLng(13.008405, 80.244729),
					zoom: 12,
					follow	: false,
					attributionControl:true,//TECH-28641
					offlineTiles: false
				});
			me.gmap = new L.map(element.dom,mapOptions);
			/*var openStreetUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
				openStreetAttrib = '&copy;OpenStreetMap contributors';
				mapLayer = new L.TileLayer(openStreetUrl, {maxZoom: 18, attribution: openStreetAttrib});*/
			var	mapLayer = new L.tileLayer(RamcoRTC.settings.tileServer.url, RamcoRTC.settings.tileServer.options);//TECH-28641
			me.gmap.setView(mapOptions.center, mapOptions.zoom).addLayer(mapLayer);
			me.gmap.on('click',Ext.bind(me.onMapClick, me));
		}else if(RamcoRTC.settings.mapProvider == "mapMyIndia"){//TECH-28715
				var element = me.el,
					mapOptions = {};
				Ext.applyIf(mapOptions, {
						center: new L.LatLng(13.008405, 80.244729),
						zoomControl: true,
						zoom:12,
						hybrid	: true
					});
				me.gmap = new MapmyIndia.Map(element.dom,mapOptions);
				me.gmap.on('click',Ext.bind(me.onMapClick, me));
				
			
		}else{
		   var gm = (window.google || {}).maps,
            mapOptions = {};
			if (!gm) {
				me.body.setHtml(rvw_resources.R087);
				return null;
			}
			Ext.applyIf(mapOptions, {
				center: new gm.LatLng(13.008405, 80.244729),
				zoom: 12,
				mapTypeId: gm.MapTypeId.ROADMAP,
				zoomControl: true,
				mapTypeControl: true,
				scaleControl: true,
				mapTypeControlOptions: {
					style: gm.MapTypeControlStyle.DROPDOWN_MENU
				},
				zoomControlOptions: {
					style: gm.ZoomControlStyle.SMALL,
					position: gm.ControlPosition.LEFT_CENTER
				}
			});

			me.gmap = new google.maps.Map(this.body.dom, mapOptions);
			me.gmap.addListener('dragend', Ext.bind(me.onBoundsChanged, me));
			me.gmap.addListener('click', Ext.bind(me.onMapClick, me));
		}
    },
    onBoxReady: function() {
        this.callParent(arguments);
        this.initMap();
    },
    afterComponentLayout: function(w, h) {
		var me = this;
		me.callParent(arguments);
        Ext.defer(function() { me.redraw(); } , 10);
    },
    redraw: function() {
        var map = this.gmap;
        if (map && RamcoRTC.settings.mapProvider == "google") {
            google.maps.event.trigger(map, 'resize');
        }
    },
    applyInfoWindowTpl: function(config) {
        return (Ext.isObject(config) && config.isTemplate) ? config : new Ext.XTemplate(config);
    },
    updateUseCurrentLocation: function(useCurrentLocation) {
        this.setGeo(useCurrentLocation);
    },
    updateDirectionsDisplay: function(newValue, OldValue) {
        var me = this,
            gm = (window.google || {}).maps;
        if (newValue === true) {
            if (!me.direction['service']) {
                me.direction['service'] = new gm.DirectionsService();
                me.direction['display'] = new gm.DirectionsRenderer({
                    suppressMarkers: true
                });
            }
        }
    },
    onZoomChange: function() {
        var me = this,
            map = me.gmap;
        me.callParent();
        if (me.zoomLevel[me.zoomLevel.length - 1] != map.getZoom())
            me.zoomLevel.push(map.getZoom());
    },
	zoomToMarkers:function(){
		var me = this,
            map = me.getMap(),
			bound = new L.LatLngBounds();
		for (var i = 0, len = this.markers.length; i < len; i++){
			bound.extend(this.markers[i].getLatLng());
		}
		map.setView(bound.getCenter(), map.getBoundsZoom(bound));
	},
    onBoundsChanged: function() {
        var me = this,
            map = me.gmap,
            zoom = map.getZoom();
        if (me.zoomLevel[me.zoomLevel.length - 1] == zoom) {
            var i = 0,
                bounds = map.getBounds(),
                cluster = {};
            cluster["center"] = map.getCenter();
            cluster["markers"] = [];
            for (i = 0; i < me.markers.length; i++) {
                if (bounds.contains(me.markers[i].getPosition())) {
                    cluster["markers"].push(me.markers[i].data.id)
                }
            }
            var cur = cluster['markers'].sort().join(),
                pre = me.cluster['markers'].sort().join();
            if (cluster['markers'].length != me.cluster['markers'].length || cur != pre) {
                me.cluster = cluster;
                me.fireEvent('clusterselected', me, cluster);
            }
        }
    },
    getJsonValue: function() {
        return this._jsonValue || null;
    },
    setValue: function(value) {
        if (value) {
            var me = this,
                jsonValue = null,
				geoShapes = null;
            if (Ext.isString(value) && value != "") {
                try {
					//value = value.replace(/\t\r\n/g, '');				
                    jsonValue = Ext.decode(value);
                } catch (e) {
                    //throw new Error("Invalid map Data for the control[" + this.id + "].");
					console.log("Invalid map Data for the control[" + this.id + "].");
                }
            } else {
                jsonValue = value;
            }
            me._jsonValue = jsonValue;
			if (jsonValue) {
				if (jsonValue.mapoptions) {
					geoShapes = jsonValue.geoshapes;
					jsonValue = jsonValue.mapoptions;
					me.defaultcircleradius = jsonValue.defaultcircleradius;
					jsonValue.center.latitude = jsonValue.center.lat;
					jsonValue.center.longitude = jsonValue.center.lng;				
					jsonValue.zoom = (jsonValue.zoom) ? jsonValue.zoom : 5;
				}
            var center = jsonValue.center,
                directionsDisplay = me.getDirectionsDisplay(),
                directions = jsonValue.directions ? jsonValue.directions : [],
                directionsLen = directions.length,
                optimizeWaypoints = jsonValue.optimizeWaypoints ? jsonValue.optimizeWaypoints : true,
                provideRouteAlternatives = jsonValue.provideRouteAlternatives ? jsonValue.provideRouteAlternatives : true,
                i = 0,
                marker = me._jsonValue.marker,
                markers = me._jsonValue.markers,
                map = me.gmap,
                useMarkerClusterer = me.getUseMarkerClusterer(),
                gm = (window.google || {}).maps,
                zoom = jsonValue.zoom ? jsonValue.zoom : me.getZoom();
            if (marker) {
                markers = [marker];
            } else if(me._jsonValue && me._jsonValue.dommarkers){//TECH-37671
				markers = me._jsonValue.dommarkers;
            }
            if (useMarkerClusterer !== false) {
                if (me.markerClusterer) {
                    me.markerClusterer.clearMarkers();
                    me.markers.splice(0, me.markers.length);
                } else {
                    if (me.markers && me.markers.length > 0)
                        me.clearAllMarkers();
                }
            } else {
                if (me.markers && me.markers.length > 0)
                    me.clearAllMarkers();
            }
            if (map) {
				//TECH-28715
				if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia" || RamcoRTC.settings.mapProvider == "hereMap"){
					map.setView([center.latitude,center.longitude],zoom);
					me.addMarkers(markers);
					//TECH-37671
					if(RamcoRTC.settings.mapProvider == "hereMap" && me._jsonValue.route){
						me.createRoutes(me._jsonValue.route);
					}
				}else{
					map.setZoom(zoom);
					if (center) {
						var centerPoint = new gm.LatLng(center.latitude, center.longitude);
						map.setCenter(centerPoint);
					}
					if (directionsDisplay && Ext.isArray(directions) && directionsLen > 1) {
						var sdirection = directions[0],
							edirection = directions[directions.length - 1];
						var startPoint = new gm.LatLng(sdirection.latitude, sdirection.longitude);
						var endPoint = new gm.LatLng(edirection.latitude, edirection.longitude);
						var waypoints = [];
						for (i = 1; i < directionsLen - 1; i++) {
							sdirection = directions[i];
							waypoints.push({
								location: new gm.LatLng(sdirection.latitude, sdirection.longitude)
							});
						}
						var request = {
							origin: startPoint,
							destination: endPoint,
							provideRouteAlternatives: provideRouteAlternatives,
							travelMode: google.maps.DirectionsTravelMode.DRIVING
						};
						if (waypoints.length > 0) {
							request.waypoints = waypoints;
							request.optimizeWaypoints = optimizeWaypoints;
						}
						me.direction['service'].route(request, Ext.bind(me.directionsResponse, me));
					} else {
						if (directionsDisplay)
							me.direction['display'].setMap(null);
						me.addMarkers(markers);
						if (useMarkerClusterer)
							me.createMarkerClusterer.apply(me || window);
					}
				}
				if(geoShapes && geoShapes.circles) {
					me.clearAllGeoShapes();
					me.addGeoShapes(geoShapes.circles);
				}
			   
		    }
         }
	  }
    },
    directionsResponse: function(response, status) {
        var me = this,
            useMarkerClusterer = me.getUseMarkerClusterer();
        if (status == google.maps.DirectionsStatus.OK) {
            me.direction['display'].setMap(me.gmap);
            me.direction['display'].setDirections(response);
            if (!useMarkerClusterer && me.markers && me.markers.length > 0)
                me.clearAllMarkers();
            me.addMarkers(markers);
            if (useMarkerClusterer)
                me.createMarkerClusterer.apply(me || window);
        }
    },
    //TECH-37671
	createRoutes:function(routes){
		 var me = this,i;
        if (routes && routes.length > 0) {
            for (i = 0; i < routes.length; i++) {
                me.addWayPoints(routes[i].waypoints);
            }
        }
	},
	addWayPoints:function(waypoints){
		var me = this,waypts = [],k;
		if (waypoints && waypoints.length > 0) {
            for (k = 0; k < waypoints.length; k++) {
                waypts.push(L.latLng(waypoints[k].lat,waypoints[k].lng));
				//me.addMarker(domMarker[k]);
            }
        }
			L.Routing.control({
				  waypoints: waypts,
				  lineOptions : {
						addWaypoints: false
					},
				  router: new L.Routing.Here(RamcoRTC.settings.hereAppId, RamcoRTC.settings.hereAppCode),
				  createMarker: function() { return null; }
				}).addTo(me.gmap);
	},
    createCustomControls: function() {
        var me = this,
            i = 0,
            ctrl;
        if (me.objListControls && me.objListControls.length > 0) {
            for (i = 0; i < me.objListControls.length; i++) {
                google.maps.event.clearInstanceListeners(me.objListControls[i]);
                controls.splice(controls.indexOf(me.objListControls[i]), 1);
            }
            me.objListControls = [];
        }
        if (me.listControls && me.listControls.length > 0) {
            me.objListControls = [];
            var cstBtn, btn, map = me.gmap;
            for (i = 0; i < me.listControls.length; i++) {
                ctrl = me.listControls[i];
                cstBtn = document.createElement('div');
                cstBtn.style.padding = '5px';
                btn = new Ext.Button({
                    itemId: ctrl.itemId,
                    ui: 'confirm-round',
                    text: ctrl.caption,
                    renderTo: cstBtn,
                    handler: Ext.bind(me.cstBtnClick, me)
                });
                map.controls[google.maps.ControlPosition.TOP_CENTER].push(cstBtn);
                me.objListControls.push(cstBtn);
            }
        }
    },
    cstBtnClick: function(btn, e) {
        var me = this,
            zoomLevel = me.zoomLevel[0],
            map = me.gmap,
            id = btn.getItemId();
        if (id == "btnclustershow") {
            var text = btn.getText();
            if (text.indexOf("Hide") > -1) {
                btn.setText("Show Cluster");
                if (me.markerClusterer) {
                    me.markerClusterer.clearMarkers();
                    google.maps.event.clearInstanceListeners(me.markerClusterer);
                    me.markerClusterer = null;
                    me.setUseMarkerClusterer(false);
                }
                me.addMarkers(me._jsonValue.markers);
                var newcluster = {};
                newcluster["center"] = map.getCenter();
                markers = me._jsonValue.markers;
                newcluster["markers"] = [];
                for (i = 0; i < me.markers.length; i++) {
                    newcluster["markers"].push(me.markers[i].data.id)
                }
                me.cluster = newcluster;
            } else {
                btn.setText("Hide Cluster");
                me.clearAllMarkers();
                me.addMarkers(me._jsonValue.markers);
                me.setUseMarkerClusterer(true);
                me.createMarkerClusterer();
            }
            return;
        }
        if (id == "btnback") {
            me.zoomLevel.pop();
            if (me.zoomLevel.length > 1) {
                zoomLevel = me.zoomLevel[me.zoomLevel.length - 1];
            }
            map.setZoom(zoomLevel);
        } else if (id == "btnhome") {
            zoomLevel = me.zoomLevel[0];
            me.zoomLevel = [];
            me.zoomLevel.push(zoomLevel);
            map.setZoom(zoomLevel);
        }
        var i = 0,
            bounds = map.getBounds(),
            cluster = {};
        cluster["center"] = map.getCenter();
        cluster["markers"] = [];
        for (i = 0; i < me.markers.length; i++) {
            if (bounds.contains(me.markers[i].getPosition())) {
                cluster["markers"].push(me.markers[i].data.id)
            }
        }
        var cur = cluster['markers'].sort().join(),
            pre = me.cluster['markers'].sort().join();
        if (cluster['markers'].length != me.cluster['markers'].length || cur != pre) {
            me.cluster = cluster;
            me.fireEvent('clusterselected', me, cluster);
        }
    },
    createMarkerClusterer: function() {
        var me = this,
            markers,
            i = 0,
            newcluster = {},
            map = me.gmap;
        me.markerClusterer = new MarkerClusterer(map, me.markers, {
            maxZoom: me.getClustererZoom(),
            gridSize: me.getClustererSize(),
            imagePath: me.getImagePath(),
            imageExtension: me.getImageExtension(),
            styles: me.getClustererStyle()
        });
        newcluster["center"] = map.getCenter();
        markers = me.markerClusterer.getMarkers();
        newcluster["markers"] = [];
        for (i = 0; i < me.markers.length; i++) {
            newcluster["markers"].push(me.markers[i].data.id)
        }
        me.cluster = newcluster;
        google.maps.event.addListener(me.markerClusterer, "clusterclick", Ext.bind(me.clusterClick, me));
    },
    clusterClick: function(cluster) {
        var me = this,
            newcluster = {};
        newcluster["center"] = cluster.getCenter();
        markers = cluster.getMarkers();
        newcluster["markers"] = [];
        for (i = 0; i < markers.length; i++) {
            newcluster["markers"].push(me.markers[i].data.id)
        }
        var cur = newcluster['markers'].sort().join(),
            pre = me.cluster['markers'].sort().join();
        if (newcluster['markers'].length != me.cluster['markers'].length || cur != pre) {
            me.cluster = newcluster;
            me.fireEvent('clusterselected', me, newcluster);
        }
    },
    setDirection: function(value) {
        var me = this,
            jsonValue;
        if (Ext.isString(value) && value != "") {
            try {
                jsonValue = Ext.decode(value);
            } catch (e) {
                throw new Error("Invalid map Data for the control[" + this.id + "].");
            }
        } else {
            jsonValue = value;
        }
        var directions = jsonValue.directions ? jsonValue.directions : [],
            directionsLen = directions.length,
            optimizeWaypoints = jsonValue.optimizeWaypoints ? jsonValue.optimizeWaypoints : true,
            provideRouteAlternatives = jsonValue.provideRouteAlternatives ? jsonValue.provideRouteAlternatives : true,
            i = 0,
            map = me.gmap,
            useMarkerClusterer = me.getUseMarkerClusterer(),
            gm = (window.google || {}).maps;
        if (map) {
            if (Ext.isArray(directions) && directionsLen > 1) {
                var sdirection = directions[0],
                    edirection = directions[directions.length - 1];
                var startPoint = new gm.LatLng(sdirection.latitude, sdirection.longitude);
                var endPoint = new gm.LatLng(edirection.latitude, edirection.longitude);
                var waypoints = [];
                for (i = 1; i < directionsLen - 1; i++) {
                    sdirection = directions[i];
                    waypoints.push({
                        location: new gm.LatLng(sdirection.latitude, sdirection.longitude)
                    });
                }
                var request = {
                    origin: startPoint,
                    destination: endPoint,
                    provideRouteAlternatives: provideRouteAlternatives,
                    travelMode: google.maps.DirectionsTravelMode.DRIVING
                };
                if (waypoints.length > 0) {
                    request.waypoints = waypoints;
                    request.optimizeWaypoints = optimizeWaypoints;
                }
                me.direction['service'].route(request, Ext.bind(me.directionsResponse, me));
            } else {
                me.direction['display'].setMap(null);
                me.addMarkers(markers);
                if (useMarkerClusterer)
                    me.createMarkerClusterer.apply(me || window);
            }
        }
    },
    clearAllMarkers: function() {
		var me = this,map = me.gmap;
        if (me.markers && me.markers.length > 0) {
            for (i = 0; i < me.markers.length; i++) {
				//TECH-28715
				if((RamcoRTC.settings.mapProvider == "hereMap" || RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia") && map != ""){
					 map.removeLayer(me.markers[i]);
				}else{
					 me.markers[i].setMap(null);
					 google.maps.event.removeListener(me.markers[i].listener);
				}
               
            }
            me.markers.splice(0, me.markers.length);
        }
    },
    addMarkers: function(markers) {
        var me = this;
        if (markers && markers.length > 0) {
            for (i = 0; i < markers.length; i++) {
                me.addMarker(markers[i]);
            }
        }
    },
    addMarker: function(item) {
		var me = this,dragMarker = me.getDragMarker();	
		//TECH-28715		
		if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia"){
				var map = me.gmap,
					mapOptions,
					marker,
					myIcon = new L.icon({
						iconUrl: item.icon?item.icon:'classic/resources/images/marker-icon.png',
						iconSize: [25,41],
						iconAnchor: [12,41],
						popupAnchor:[0,-33]
					});
			mapOptions = {
					icon:myIcon,
					draggable:dragMarker,
					title: item.title,
					item:item
			};
			marker = L.marker([item.latitude, item.longitude],mapOptions);
			/* var popup = new L.ResponsivePopup().setContent(me.getInfoWindowTpl().applyTemplate(configData));
			marker.bindPopup(popup,{closeButton:false}); */
			
			if (Ext.isEmpty(item.icon))
				icon = "";
			item.marker = marker;
			me.markers.push(marker);
			marker.addTo(map);
			
			marker.on('mouseup', Ext.bind(me.onMarkerClick,me,[marker],true));
		}else if(RamcoRTC.settings.mapProvider == "hereMap"){//TECH-37671
			var map = me.gmap,
					mapOptions,
					marker,
					myIcon = new L.icon({
						iconUrl: item.icon?item.icon.imagename:'classic/resources/images/marker-icon.png',
						//iconUrl: 'classic/resources/images/marker-icon.png',
						iconSize: [25,41],
						iconAnchor: [12,41],
						popupAnchor:[0,-33]
					});
			mapOptions = {
					icon:myIcon,
					draggable:dragMarker,
					title: item.title,
					item:item
			};
			marker = L.marker([item.position.lat, item.position.lng],mapOptions);
			/* var popup = new L.ResponsivePopup().setContent(me.getInfoWindowTpl().applyTemplate(configData));
			marker.bindPopup(popup,{closeButton:false}); */
			
			if (Ext.isEmpty(item.icon))
				icon = "";
			item.marker = marker;
			me.markers.push(marker);
			marker.addTo(map);
			
			marker.on('mouseup', Ext.bind(me.onMarkerClick,me,[marker],true));
		}else{
			var icon = me.getIconPath();
			var position = new google.maps.LatLng(item.latitude, item.longitude);
			icon = icon != '' ? icon + "/" + item.icon : item.icon;
			if (Ext.isEmpty(item.icon))
				icon = "";
			var marker = new google.maps.Marker({
			position: position,
			draggable:dragMarker,
			title: item.title,
			id: item.id,
			map: me.gmap
			});
			if (!Ext.isEmpty(icon))
				marker.icon = icon;
			item.marker = marker;
			marker.set('data', item);
			marker.listener = google.maps.event.addListener(marker, 'mouseup', Ext.bind(me.onMarkerClick, me, [marker]));
			me.markers.push(marker);
		}
    },
	addGeoShapes: function(circles) {
		var me = this,
			center = null;		   
		//TECH-28715		
		if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia")    
			me.circleBounds =  new L.latLngBounds();
		else
			me.circleBounds = new google.maps.LatLngBounds();
        if (circles && circles.length > 0) {
            for (i = 0; i < circles.length; i++) {
                me.addCircle(circles[i]);				
            }
        }		
        //me.gmap.fitBounds(me.circleBounds);
	},
	addCircle: function(circle) {
		if (Ext.isString(circle))
			return;
		var me = this,		
			circleRadiusType = null,
			circleRadius = null,
			clickAction = "N",
			pt = null;
		circle.center.lat = parseFloat(circle.center.lat);
		circle.center.lng = parseFloat(circle.center.lng);
		//TECH-28715
		if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia")
			pt = new L.latLng(circle.center.lat, circle.center.lng);	
		else
			pt = new google.maps.LatLng(circle.center.lat, circle.center.lng);
		me.circleBounds.extend(pt);		
		circleRadius = circle.radius;
		if (!Ext.isEmpty(circle.radiustype) && circle.radiustype == "percent") {
			circleRadius = parseInt((me.defaultcircleradius / 100) * parseInt(circle.radius));
			//circleRadius = parseInt((63710 / 100) * parseInt(100));			
		}
		if (!Ext.isEmpty(circle.clickaction) && circle.clickaction.toString().toLowerCase() == "y") {
			clickAction = "Y"
		}
		//TECH-28715
		if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia" ){
			var circleOptions = {
				radius:circle.radius,
				item:circle
			}
			circleMapObject = new L.circle([circle.center.lat,circle.center.lng],circleOptions);
			circleMapObject.on('mouseover', Ext.bind(me.onCircleIn,me,[circleMapObject],true));
			//circleMapObject.on('mouseout', Ext.bind(me.onCircleOut,me,[circleMapObject],true));
			if (clickAction == "Y") {
				circleMapObject.on('click', Ext.bind(me.onCircleClick,me,[circleMapObject],true));
			}
			circle.circle = circleMapObject;
		}else{
			circleMapObject = new google.maps.Circle({
				strokeColor: circle.strokeColor || "#FF0000",
				strokeOpacity: circle.strokeOpacity || 0.8,
				strokeWeight: circle.linewidth,
				fillColor: circle.fillcolor,
				fillOpacity: circle.fillOpacity || 2,
				map: me.gmap,
				center: circle.center,
				radius: circleRadius,
				isCircle: true
			});
			var labelText = circle.radius;
			var myOptions = {
				content: labelText,
				boxStyle: {
				  border: "none",
				  textAlign: "center",
				  fontSize: "10pt",
				  width: "50px"
				},
				disableAutoPan: true,
				pixelOffset: new google.maps.Size(-25, -5),
				position: pt,
				closeBoxURL: "",
				isHidden: false,
				pane: "floatPane",
				enableEventPropagation: true
			  };

			//var ibLabel = new InfoBox(myOptions);
			//ibLabel.open(me.gmap);
			circle.circle = circleMapObject;
			circleMapObject.set('data', circle);
			circleMapObject.listener = google.maps.event.addListener(circleMapObject, 'mouseover', Ext.bind(me.onCircleIn, me, [circleMapObject]));
			circleMapObject.listener = google.maps.event.addListener(circleMapObject, 'mouseout', Ext.bind(me.onCircleOut, me, [circleMapObject]));
			if (clickAction == "Y") {
				circleMapObject.listener = google.maps.event.addListener(circleMapObject, 'click', Ext.bind(me.onCircleClick, me, [circleMapObject]));
			}
		}
        me.circles.push(circleMapObject);
		
	},
	onCircleIn: function(circle) {
		var me = this;
		me.showInfoWindow(circle);
	},
	onCircleOut: function(circle) {
		var me = this;
		if (me.infowindow)
            me.infowindow.close();
	},
	onCircleClick: function(circle) {
		var me = this;			
		me.fireEvent('circleMapClick', me, circle);
	},
	clearAllGeoShapes: function() {
		var me = this;
        if (me.circles && me.circles.length > 0) {
            for (i = 0; i < me.circles.length; i++) {
				//TECH-28715
				if((RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia" )&& me.gmap != ""){
					 me.gmap.removeLayer(me.circles[i]);
				}else{
					me.circles[i].setMap(null);
					google.maps.event.removeListener(me.circles[i].listener);	
				}
            }
            me.circles.splice(0, me.circles.length);
        }
	},	
    onMapClick: function(e) {
        var me = this,
			createMarkers = me.getCreateMarkers(),
			dragMarker = me.getDragMarker();
           
        if (me.infowindow)
            me.closeInfoWindow();
        else{
			if(createMarkers || (dragMarker && me.markers.length == 0))
				me.fireEvent('mapclick', me, e);
		}
            
    },
    onMarkerClick: function(marker) {
        var me = this,data;
		//TECH-28715
		if(RamcoRTC.settings.mapProvider == "hereMap" || RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia")
			 data = marker.target.options.item;
		else
			 data = marker.get('data');
		
		if ((data.isClickable || me.task )) {
				if (me.fireEvent('markerclick', me, marker, data) === false) {
					return;
				}
			}
			//TECH-37671
		if(data && data.isInfo || (RamcoRTC.settings.mapProvider == "hereMap" && data.showinfo))
				me.showInfoWindow(marker);	
    },
    getMarker: function(markerId) {
        var me = this,
            marker = null;
        if (me.markers && me.markers.length > 0) {
            for (i = 0; i < markers.length; i++) {
                if (me.markers[i].id == markerId) {
                    marker = me.markers[i];
                    break;
                }
            }
        }
        return marker;
    },
    showInfoWindow: function(marker) {
        var me = this;
        var data = null;
		//TECH-28715 //TECH-37671
		if(RamcoRTC.settings.mapProvider == "hereMap" || RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "mapMyIndia"){
			data = marker.target.options.item;
		}else{
			if (typeof marker == "object") {
				data = marker.get('data');
			}
			else {
				try {
					marker = me.getMarker(parseInt(marker));
					data = marker.get('data');
				}
				catch (e) {
					data = null;
				}
			}
		}
        if (data == null)
            return;
        var htm = data.html ? data.html.toLowerCase() : null;
        var isShowInfo = data.hasOwnProperty('isShowInfo') ? data.isShowInfo : true;
        if (isShowInfo) {
			if (marker.isCircle === true) {
				me.infowindow = new google.maps.InfoWindow({
					content: data.bubbleinfo.content					
				})
				me.infowindow.isCircle = true;
				me.infowindow.setPosition(marker.center);				
				me.infowindow.open(me.gmap);
            }
            else { 
            var configData = {};
            var height = parseInt(data.height);
            var width = parseInt(data.width);
            if (isNaN(height) || !Ext.isNumber(height))
                height = 200;
            else
                height += 10;
            if (isNaN(width) || !Ext.isNumber(width))
                width = 200;

            if (htm && !Ext.isEmpty(htm) && (htm.indexOf(".htm") > -1 || htm.indexOf(".asp") > -1)) {
                Ext.applyIf(configData, {
                    id: me.id,
                    hastoolbar: false,
                    hasiframe: true,
                    hasbottombar: false,
                    hasfloatbutton: false,
                    src: htm + (data.param ? "?" + data.param : "")
                });
            }
            var isframe = data.isIframe,
                istoolbar = data.isClosable || !Ext.isEmpty(data.titleText),
                hasFloatbutton = !Ext.isEmpty(data.floatText),
                borderColor = data.borderColor ? data.borderColor : 'black';
            if (data.isInfo) {
	                Ext.applyIf(configData, {
	                    id: me.id,
	                    hastoolbar: istoolbar,
	                    hasclosable: data.isClosable,
	                    bodyStyle: istoolbar ? 'border-top: .1em solid;border-top-color:' + borderColor : '',
	                    hasiframe: isframe,
	                    hasbottombar: false,
	                    hasfloatbutton: hasFloatbutton,
	                    floatCls: data.floatCls ? data.floatCls : 'infobubble-floatbutton',
	                    borderColor: borderColor,
	                    floatdata: data.floatText ? data.floatText : '',
	                    src: isframe ? (htm + (data.param ? "?" + data.param : "")) : "",
	                    body: data.body ? data.body : (htm ? htm : data.title),
	                    title: data.titleText,
	                    closeCls: data.closeCls ? data.closeCls : "infobubble-close",
	                    cancelText: '',
	                    okText: ''
	                });
				} 
				else {
					//TECH-37671
					if(RamcoRTC.settings.mapProvider == "hereMap"){
						data.body = data.showinfo;
					}
	                Ext.applyIf(configData, {
	                    id: me.id,
	                    hastoolbar: istoolbar,
	                    hasclosable: data.isClosable,
	                    bodyStyle: istoolbar ? 'border-top: .1em solid;border-top-color:' + borderColor + ';border-bottom: .1em solid;border-bottom-color:' + borderColor : '',
	                    hasiframe: isframe,
	                    hasbottombar: true,
	                    hasfloatbutton: hasFloatbutton,
	                    floatdata: data.floatText ? data.floatText : '',
	                    floatCls: data.floatCls ? data.floatCls : 'infobubble-floatbutton',
	                    borderColor: borderColor,
	                    src: isframe ? (htm + (data.param ? "?" + data.param : "")) : "",
	                    body: data.body ? data.body : (htm ? htm : data.title),
	                    title: data.titleText,
	                    closeCls: data.closeCls ? data.closeCls : "infobubble-close",
	                    cancelText: data.cancelText ? data.cancelText : rvw_resources.R103,
	                    okText: data.okText ? data.okText : rvw_resources.R102
	                });
	            }
	            //TECH-37671
				if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "hereMap"){
					var popup = L.responsivePopup({
					clickHandler:Ext.bind(me.onBubbleClick, me, [data], true)
					},me);
					popup.setContent(me.getInfoWindowTpl().applyTemplate(configData));
					popup = marker.target.bindPopup(popup,{closeButton:false,maxHeight:height,maxWidth:width,minWidth:width,minHeight:height});
				}else if(RamcoRTC.settings.mapProvider == "mapMyIndia"){
					//TECH-28715
					var popup = responsivePopups({clickHandler:Ext.bind(me.onBubbleClick, me, [data], true)},me);
					popup.setContent(me.getInfoWindowTpl().applyTemplate(configData));
					popup = marker.target.bindPopup(popup,{closeButton:false,maxHeight:height,maxWidth:width,minWidth:width,minHeight:height});
				}else{
					if (me.infowindow) {
						me.closeInfoWindow();
					}
					me.infowindow = new InfoBubble({
						disableAutoPan: true,
						hideCloseButton: true,
						backgroundColor: data.backgroundColor ? data.backgroundColor : 'white',
						borderColor: borderColor,
						padding: 5,
						borderRadius: 10,
						borderWidth: data.borderWidth ? data.borderWidth : 1,
						minWidth: width,
						maxWidth: width,
						backgroundClassName: 'infobubble-panel',
						minHeight: height,
						maxHeight: height
					});
					me.infowindow.setContent(me.getInfoWindowTpl().applyTemplate(configData));
					me.infowindow.open(me.gmap, marker);
					google.maps.event.addDomListener(me.infowindow.bubble_, 'mousedown', Ext.bind(me.onBubbleClick, me, [data], true));
					if (isframe)
						google.maps.event.addDomListener(me.infowindow, 'infodomready', Ext.bind(me.onInfoDomReady, me, [configData], true));			       
			}
		 }
      }
    },
    closeInfoWindow: function() {
        var me = this;
        if (me.infowindow) {
            google.maps.event.clearInstanceListeners(me.infowindow);
			if (!me.infowindow.isCircle) {
            google.maps.event.clearInstanceListeners(me.infowindow.bubble_);
            me.infowindow.onRemove();
			}
            me.infowindow.close();
            me.infowindow = null;
            delete me.infowindow;
        }
    },
    onInfoDomReady: function(data) {
        var me = this;
        window.frames[data.id + "_frame"].location.replace(data.src);
    },
    onBubbleClick: function(e, data) {
        var me = this;
        var target = e.target;
        if (target) {
            var targetid = target.id.replace(me.id + "_", "");
            if (!(targetid == "close" || targetid == "cancel" || targetid == "ok" || targetid == "float")) {
                var el = Ext.get(target);
                if (el) {
                    target = el.up("div#" + me.id + "_close");
                    if (!target)
                        target = el.up("div#" + me.id + "_cancel");
                    if (!target)
                        target = el.up("div#" + me.id + "_ok");
                    if (!target)
                        target = el.up("div#" + me.id + "_float");
                }
                if (target)
                    targetid = target.id.replace(me.id + "_", "");
                else
                    return;
            }
        }
        if (target && target.id) {
            switch (targetid) {
                case 'close':
                    me.closeInfoWindow();
                    me.fireEvent('infocloseclick', me, data);
                    break;
                case 'cancel':
                    me.closeInfoWindow();
                    me.fireEvent('infocancelclick', me, data);
                    break;
                case 'ok':
                    me.closeInfoWindow();
                    me.fireEvent('infookclick', me, data);
                    me.fireEvent('markertap', me, data);
                    break;
                case 'float':
                    me.closeInfoWindow();
                    me.fireEvent('infofloatclick', me, data);
                    break;
                default:
            }
        }
    },
    destroy: function() {
        this.clearAllMarkers();
		this.clearAllGeoShapes();
        if (this.infowindow) {
            this.closeInfoWindow();
        }
        if (!this.direction['service']) {
            this.direction['service'] = null;
            this.direction['display'] = null;
        }
        this.callParent();
    },
    highlightmarker: function(deviceId) {
        var me = this,
            index;
        if (me.markers && me.markers.length > 0) {
            for (i = 0; i < me.markers.length; i++) {
                if (me.markers[i].data.deviceid == deviceId) {
                    index = i;
                    break;
                }
            }
        }
        if (Ext.isNumber(index)) {
            me.markers[index].setZIndex(google.maps.Marker.MAX_ZINDEX + 1);
            me.markers[index].setAnimation(google.maps.Animation.BOUNCE);
            Ext.defer(function() {
                me.markers[index].setAnimation(null);
            }, 3000, me);
        }
    }
});

// VerticalData View Control
Ext.define('Ext.ramco.VerticalView', {
    extend: 'Ext.panel.Panel',
    xtype: 'verticalview',
    defaultBindProperty: 'store',
    cls: Ext.baseCSSPrefix + 'verticalview',
    layout: 'fit',
    viewType: 'ramcodataview',
    navigation: true,
    boxType: "1",
    minHeight: 250,
    config: {
        visibleRows: 5,
        first: false,
        last: false,
        prevSet: false,
        nextSet: false,
        select: 0,
        value: null
    },
    initComponent: function() {
        var me = this,
            boxType = me.boxType,
            defaultWidth = 24,
            defaultHeight = 24,
            store, view, viewConfig,
            first = me.getFirst(),
            prevSet = me.getPrevSet(),
            nextSet = me.getNextSet(),
            last = me.getLast(),
            upButtons = ['->'],
            downButtons = ['->'],
            toolbar = [];
        store = me.store = Ext.data.StoreManager.lookup(me.store || 'ext-empty-store');
        store.dataView = true;
        viewConfig = Ext.apply({
            xtype: me.viewType,
            store: me.store,
            displayFields: me.displayFields,
            emptyText: me.emptyText || ''
        }, me.viewConfig);
        me.view = view = Ext.create(viewConfig);
        if (first)
            upButtons.push({
                xtype: 'button',
                itemId: 'moveFirst',
                padding: 2,
                iconCls: 'x-fa fa-angle-double-up',
                handler: me.onFirst.bind(me)
            });
        if (prevSet)
            upButtons.push({
                xtype: 'button',
                itemId: 'movePrev',
                padding: 2,
                iconCls: 'x-fa fa-angle-up',
                handler: me.onMoveToPrev.bind(me)
            });

        if (nextSet)
            downButtons.push({
                xtype: 'button',
                itemId: 'moveNext',
                padding: 2,
                iconCls: 'x-fa fa-angle-down', // TECH-34108
                handler: me.onMoveToNext.bind(me)
            });
        if (last)
            downButtons.push({
                xtype: 'button',
                itemId: 'moveLast',
                padding: 2,
                iconCls: 'x-fa fa-angle-double-down',
                handler: me.onLast.bind(me)
            });

        if (upButtons.length > 1) {
            upButtons.push('->');
            toolbar.push({
                dock: 'top',
                xtype: 'toolbar',
                itemId: 'topSlider',
                defaults: {
                    scale: 'small'
                },
                items: upButtons
            });
        }
        if (downButtons.length > 1) {
            downButtons.push('->');
            toolbar.push({
                dock: 'bottom',
                xtype: 'toolbar',
                itemId: 'bottomSlider',
                defaults: {
                    scale: 'small'
                },
                items: downButtons
            });
        }
        if (toolbar.length > 0) {
            me.dockedItems = toolbar;
        }
        me.items = [view];
        me.mon(me.view, {
            uievent: me.processEvent,
            scope: me
        });
        if (boxType == "1") {
            defaultWidth = 105;
            defaultHeight = 70;
        } else if (boxType == "2") {
            defaultWidth = 160;
            defaultHeight = 80;
        } else if (boxType == "3") {
            defaultWidth = 180;
            defaultHeight = 70;
        } else if (boxType == "4") {
            defaultWidth = 120;
            defaultHeight = 85;
        } else if (boxType == "5") {
            defaultWidth = 310; // TECH-29248 - New Update
            defaultHeight = 140;
        } else if (boxType == "6") {
            defaultWidth = 259;
            defaultHeight = 74;
        } else if (boxType == "7") {
            defaultWidth = 150;
            defaultHeight = 60;
        } else if (boxType == "8") {
            defaultWidth = 240;
            defaultHeight = 40;
        } else if (boxType == "9") {
            defaultWidth = 75;
            defaultHeight = 35;
        } else if (boxType == "10") {
            defaultWidth = 220;
            defaultHeight = 180;
        } else if (boxType == "11") {
            defaultWidth = 120;
            defaultHeight = 40;
        } else if (boxType == "12") {
            defaultWidth = 240;
            defaultHeight = 100;
        } else if (boxType == "13") {
            defaultWidth = 72;
            defaultHeight = 72;
        } else if (boxType == "14") {
			defaultWidth = 200;
			defaultHeight = 32;
		} else if (boxType == "15") {
			defaultWidth = 240;
			defaultHeight = 40;
		} else if (boxType == "16") { // TECH-40001
			defaultWidth = 370;
			defaultHeight = 132;
        } else if (boxType == "17") {
			defaultWidth = 130;
			defaultHeight = 70;
        } else if (boxType == "18") {
			defaultWidth = 240;
			defaultHeight = 132;
        } else if (boxType == "19") {
			defaultWidth = 100;
			defaultHeight = 50;
		} else if (boxType == "20") {
			defaultWidth = 200;
			defaultHeight = 50;
        } else if (boxType == "21") { // TECH-31799
			defaultWidth = 110;
			defaultHeight = 130;
        } else if (boxType == "22") {
			defaultWidth = 225;
			defaultHeight = 75;
        } else if (boxType == "23") {
			defaultWidth = 65;
			defaultHeight = 60;
        }
		
        if (!me.height)
        	me.height = defaultHeight;
		me.itemHeight = defaultHeight;
		me.itemWidth = defaultWidth;
        if (me.wrapCount > 1) {
            me.height = defaultHeight * me.wrapCount;
        }
        //me.width = defaultWidth;
        me.callParent();
    },
	// TECH-33539
	onResize: function(width, height, oldWidth, oldHeight) {
        var me = this;
		me.callParent(arguments);
		if (width != oldWidth && me.tr > -1) {
			me.onLoadView();
		}
	},
    updateSelect: function(newValue) {
		// TECH-27457 - Dataview unnecessary default focus
		if(this.rendered && !Ext.isEmpty(newValue) && parseInt(newValue) > 0) {
			var me = this,
				index = parseInt(newValue, 10),
				view = me.view,
				storeRange = me.store.getRange(), // TECH-34828
				selectIndex;
			if (!me.store || me.store.isEmptyStore) {
				me.index = index || 0;
				return;
			}
			
			// TECH-34828
			
			// selectIndex = (Ext.isNumber(index) && index > 0) ? (index - 1) : 0;
			// view.select(selectIndex, false, true);
			// selectIndex = ((me.store.si || me.store.start) && !Ext.isEmpty(index)) ? (index - (me.store.si || me.store.start)) : null;
			// if (!Ext.isEmpty(selectIndex) && selectIndex >= 0)
				// view.select(selectIndex, false, true);
			selectIndex = storeRange && storeRange.findIndex(function(r){ return r.get('rn') == newValue });
			if (!Ext.isEmpty(selectIndex)) {
				view.select(selectIndex, false, true);
				view.curSelect = selectIndex;
			}			
		}
    },
    setValueOnData: function() {
        var me = this;
        me.updateSelect(me.select);
        if (me.isSort) {
            me.isSort = false;
        } else {
            if (me.sortCol) {
                me.sortCol.setSortState(null);
                delete me.sortCol;
            }
        }
    },
    setStore: function(store) {
        var me = this,
            oldStore = me.store;
        /*me.mon(store, {
            refresh: me.setValueOnData,
            scope: me
        });*/

        if (store && store !== oldStore) {
            me.unbindStore();
            me.bindStore(store);
        }
        if (this.autoLoad && !store.isEmptyStore && !(store.loading || store.isLoaded())) {
            store.load();
        }
    },
    updateValue: function(newValue, oldValue) {
        var me = this,            
			// TECH-29970
			view = me.view,
			nvr = view && view.nvr || me.getVisibleRows(),
			curSelect = view && view.curSelect,
			newVsi = (curSelect) ? ((curSelect + 1) - (curSelect % nvr)) : null;
            visibleRows = me.getVisibleRows();
        if (!me.store || me.store.isEmptyStore) {
            me.value = newValue;
            return;
        }
        if (newValue) {
			// TECH-29970
            //me.vsi = newValue.vsi;
			me.vsi = (newVsi && me.store.vsi == newVsi) ? newVsi : newValue.vsi;
            me.si = newValue.si;
            me.tr = newValue.tr;
			// TECH-29378
			//me.nsi = 0;
			
			// TECH-29970
			if (newVsi)
				me.nsi = newVsi;
			me.store.vsi = me.vsi;
            me.store.nsr = parseInt(newValue.nsr, 10);
            me.store.start = me.si;
            me.store.end = (visibleRows * 3) + (me.si - 1);
            if (me.store.end > me.tr)
                me.store.end = me.tr
            me.store.tr = me.tr;
            me.store.vr = newValue.vr || (visibleRows * 3); //AHBG-26121 
            //me.store.vsi = me.vsi;
            me.store.cr = me.vsi;
			if (!Ext.isEmpty(newValue.columnsValue)) {
				me.columnsValue = newValue.columnsValue;
			}
			if (typeof newValue.store == "undefined")
				newValue.store = [];
			//if (!Ext.isEmpty(newValue.store)) {
				me.store.setData(newValue.store);
				me.store.commitChanges();
				// TECH-34108 / TECH-34237
				view.nvr = -1;
				me.nsi = 0; 
	        //}
			// TECH-33539
			me.onLoadView();
        }
    },
	// TECH-33539
	onLoadView: function() {
		var me = this,
			nodes = null,
			rec = null,
			i = 0,
			defHeight = 0, // TECH-28315
			sel = me.select ? parseInt(me.select, 10) : 0,
			newSel = 0,
			nvr;
		
		if(me.rendered) {			
			defHeight = (me.first || me.prev) ? (defHeight += 30) : defHeight;
			defHeight = (me.last || me.next) ? (defHeight += 30) : defHeight;
			// TECH-28315
			if((nvr = Math.floor((me.height - defHeight) / me.itemHeight, 10)) != me.view.nvr) {
				me.view.nvr  = nvr;
				me.view.nvr = me.view.nvr * me.wrapCount;
				nodes = me.view.getNodes();
				if (me.vsi == 1) {
					if(Ext.isEmpty(me.nsi))
						me.nsi = 0;
					if(Ext.isEmpty(me.store.vsi))
						me.store.vsi = me.vsi;
					if (sel > me.view.nvr) {
						newSel = (sel % me.view.nvr);
						//me.store.vsi = sel - newSel + 1;
					}
					if(sel > me.nsi)
						me.nsi = me.store.vsi - 1;
					for (; i < nodes.length; i++) {
						node = Ext.fly(nodes[i]);
						//if (i >= (me.store.vsi - 1) && i < (me.store.vsi + me.view.nvr - 1))
						  if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
							node.show('display');
						else
							node.hide('display');
					}
				} else {
					i = 0;
					rec = me.store.findRecord('rn', me.store.vsi);
					me.nsi = me.store.indexOf(rec) || 1;
					nodes = me.view.getNodes();
					me.store.vsi = me.vsi;
					// TECH-31663
					if (sel >= me.view.nvr) {
						newSel = (sel % me.view.nvr);
					   // me.store.vsi = sel - newSel + 1;
					}
					for (; i < nodes.length; i++) {
						node = Ext.fly(nodes[i]);
						if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
							node.show('display');
						else
							node.hide('display');
					}
				}
				me.updateSelect(sel);
				// Disabling Navigation Buttons when total rows being shown in screen launch itself
				var toolBarItems = me.dockedItems && me.dockedItems.items,
					toolBarDisabled = (me.tr == 0 || me.view.nvr >= me.tr);
				if (!Ext.isEmpty(toolBarItems) && toolBarItems.length > 0) {
					toolBarItems[0][toolBarDisabled ? "disable" : "enable"]();
					if(toolBarItems[1])
						toolBarItems[1][toolBarDisabled ? "disable" : "enable"]();
				}
			}
		}
	},
    onStoreLoad: Ext.emptyFn,
    bindStore: function(store, initial) {
        var me = this,
            view = me.view;

        if (store) {
            // Bind to store immediately because subsequent processing looks for grid's store property
            me.store = store;

            if (view.store !== store) {
                view.bindStore(store, false);
            }

            me.mon(store, {
                load: me.onStoreLoad,
                scope: me
            });
            me.storeRelayers = me.relayEvents(store, [
                /**
                 * @event filterchange
                 * @inheritdoc Ext.data.Store#filterchange
                 */
                'filterchange',
                /**
                 * @event groupchange
                 * @inheritdoc Ext.data.Store#groupchange
                 */
                'groupchange'
            ]);
        } else {
            me.unbindStore();
        }
    },
    unbindStore: function() {
        var me = this,
            store = me.store,
            view;

        if (store) {
            store.trackStateChanges = false;

            me.store = null;

            me.mun(store, {
                load: me.onStoreLoad,
                scope: me
            });
            if (me.storeRelayers)
                Ext.destroy(me.storeRelayers);

            view = me.view;
            if (view.store) {
                view.bindStore(null);
            }
        }
    },
    processEvent: function(type, view, record, item, rowIndex, e) {
        var me = this;
        if (type == 'click') {
            var el = Ext.fly(e.target),
                elup, vsi, index, mod,
                attributes = el ? el.getAttributes() : {},
                newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
                taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
                linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
                args = [], curView;
				
				curView = me.up('ilbo');
				RamcoRTC.focusCtrl = [];
				RamcoRTC.focusCtrl.push(curView.ilboConfig.ilboName);
				RamcoRTC.focusCtrl.push(me.getItemId());
				RamcoRTC.focusCtrl.push(rowIndex);
				RamcoRTC.focusCtrl.push(0);
				RamcoRTC.lastFocusCtrl[1] = me.getItemId();
				
            if (!taskInfo && el) {
                elup = el.up('div[taskinfo]');
                taskInfo = elup ? elup.getAttribute('taskinfo') : null;
            }
            if (!linkInfo && el) {
                elup = el.up('div[linkinfo]');
                linkInfo = elup ? elup.getAttribute('linkinfo') : null;
            }
            if (!newWindow && el) {
                elup = el.up('div[opennewwindow]');
                newWindow = elup ? elup.getAttribute('opennewwindow') || 'about:blank' : null;
            }
            if (me.task || !Ext.isEmpty(taskInfo) || !Ext.isEmpty(linkInfo)) {
                args = ['uiclick', view, record];
                if (Ext.isEmpty(taskInfo) && Ext.isEmpty(linkInfo))
                    args = args.concat(me.task, me.taskType);
                else if (!Ext.isEmpty(taskInfo))
                    args = args.concat(TaskInfoToObjectArray(taskInfo));
                else {
                    args[0] = 'linkclick';
                    args = args.concat(LinkInfoToObjectArray(linkInfo));
                }
                index = record.get('rn');
                if (index > me.view.nvr) {
                    mod = index % me.view.nvr;
					// TECH-29970
                    //me.store.vsi = index - mod + 1;
					// TECH-31663
					me.view.curSelect = index - 1;
                    me.store.cr = index;
                }
				// TECH-31663
				if (index == 1)
					me.view.curSelect = 0;
				
                me.fireEvent.apply(me, args);
            } else if (newWindow) {
                openNewWindow(newWindow);
                return true;
            }
        }
    },
    processState: function(view) {},
    onFirst: function(btn) {
		 var me = this,
            visibleRows = me.getVisibleRows(),
            store = me.store,
            vsi = me.view.nvr ? (store.vsi - me.view.nvr) : store.vsi,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > me.view.nvr ? vsi - me.view.nvr : vsi - visibleRows,
            end = ((visibleRows * 3) + (start - 1)) > store.tr ? store.tr : ((visibleRows * 3) + (start - 1)),
            nvr = me.view.nvr ? me.view.nvr : 0,
            si, ei, i, nodes, node;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi <= -1)
            return;
        if (!(vsi >= si && vsi <= ei) || ((vsi - nvr) < si && (vsi - nvr) > 0) || (si != 1)) {
			//if(si != 1){
            me.store.start = start = start > 0 ? start : 1;
            me.store.end = end;
            /* if (((vsi - nvr) < si && (vsi - nvr) > 0)) {
                me.store.vsi = 1;
                start = 1;
            } else */
                me.store.vsi = 1;
				start = 1;
			me.store.nsi = me.nsi = 0;
            me.store.changed = true;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        }else{
			if ((store.vsi - me.view.nvr) < 0)
                return;
            i = 0;
            nodes = me.view.getNodes();
            me.store.vsi = 1;
            me.store.nsi = me.nsi = 0;
            //me.nsi = (me.store.nsi - me.view.nvr) > 0 ? (me.store.nsi - me.view.nvr) : 0;
            for (; i < nodes.length; i++) {
                node = Ext.fly(nodes[i]);
                //if (i >= (me.nsi - 1) && i < (me.nsi + me.view.nvr - 1))
                //if (i >= (me.nsi) && i <= (me.nsi + me.view.nvr - 1))
				if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
                    node.show('display');
                else
                    node.hide('display');
            }
			var sel = me.select ? parseInt(me.select, 10) : 0,
				view = me.view;
			if ( me.store.vsi == 1) {
				me.updateSelect(sel);
				//view.select(sel, false, true);
			}
        }
	  
	},
    onMoveToPrev: function() {
        var me = this,
            visibleRows = me.getVisibleRows(),
            store = me.store,
            vsi = (store.vsi - me.view.nvr) > 0 ? (store.vsi - me.view.nvr) : 1,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > me.view.nvr ? vsi - me.view.nvr : vsi - visibleRows,
            end = ((visibleRows * 3) + (start - 1)) > store.tr ? store.tr : ((visibleRows * 3) + (start - 1)),
            nvr = me.view.nvr ? me.view.nvr : 0,
            si, ei, i, nodes, node;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (store.vsi - me.view.nvr <= -1)
            return;
        if (!(store.vsi >= si && store.vsi <= ei) || ((store.vsi - nvr) < si && (store.vsi - nvr) >= 0)) {
            me.store.start = start = start > 0 ? start : 1;
            me.store.end = end;
            if (((vsi - nvr) < si && (vsi - nvr) > 0)) {
                me.store.vsi = vsi;
                start = (vsi - nvr) > 0 ? (vsi - nvr) : 1;
            } else
            me.store.vsi = vsi;
			me.store.si =  (vsi - visibleRows)>0?(vsi - visibleRows):1;
			me.si = (vsi - visibleRows)>0?(vsi - visibleRows):1;
			me.cr = (vsi - visibleRows)>0?(vsi - visibleRows):1;
            me.store.changed = true;
			//me.store.nsi = me.nsi;
            me.nsi = (me.store.nsi - me.view.nvr) > 0 ? (me.store.nsi - me.view.nvr) : 0;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        } else {
            if ((store.vsi - me.view.nvr) < 0)
                return;
            i = 0;
            nodes = me.view.getNodes();
            me.store.vsi = (me.store.vsi - me.view.nvr) > 0 ? (me.store.vsi - me.view.nvr) : 1;
            me.store.nsi = me.nsi;
		    me.nsi = (me.store.nsi - me.view.nvr) > 0 ? (me.store.nsi - me.view.nvr) : 0;
			/* if(si == 1){
				me.store.vsi = 1;
				me.nsi = me.store.nsi = 0;
			} */
            for (; i < nodes.length; i++) {
                node = Ext.fly(nodes[i]);
                //if (i >= (me.nsi - 1) && i < (me.nsi + me.view.nvr - 1))
                //if (i >= (me.nsi) && i <= (me.nsi + me.view.nvr - 1))
				if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
                    node.show('display');
            else
                    node.hide('display');
            }
			// TECH-31663
			/* var sel = me.select ? parseInt(me.select, 10) : 0,
				view = me.view;
			if ( me.store.vsi == 1) {
				me.updateSelect(sel);
				//view.select(sel, false, true);
			} */
        }
    },
    onMoveToNext: function() {
        var me = this,
            visibleRows = me.getVisibleRows(),
            store = me.store,
            vsi = me.view.nvr ? (store.vsi + me.view.nvr) : store.vsi,
            nvr = me.view.nvr ? me.view.nvr : visibleRows,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > nvr ? vsi - nvr : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei, i, nodes, node;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi > store.tr) {
            return;
        }
        //if (vsi + nvr > ei && (!(vsi >= si && vsi <= ei) || ((vsi + nvr) > ei && vsi < store.tr))) {
        if (vsi+nvr  > ei && (!(vsi >= si && vsi <= ei) || ((vsi + nvr) > ei && (((vsi + nvr) <= store.tr) || ((vsi + visibleRows) <= store.tr))))) {
            me.store.start = start;
            me.store.end = end;
            if (((vsi + nvr) > ei && (vsi + nvr) < store.tr)) {
            me.store.vsi = vsi;
                start = me.store.vsi;
            } else
                me.store.vsi = vsi;
			me.store.si = vsi - visibleRows;
			me.si = vsi - visibleRows;
			me.cr = vsi - visibleRows;
            me.store.changed = true;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        } else {
            if ((store.vsi + me.view.nvr) > store.tr)
                return;
            i = 0;
            nodes = me.view.getNodes();
            me.store.vsi = me.store.vsi + me.view.nvr;
            if (me.nsi < nodes.length)
                me.nsi += me.view.nvr;
            else
                me.nsi = 0;
			me.store.nsi = me.nsi;
            for (; i < nodes.length; i++) {
                node = Ext.fly(nodes[i]);
                //if (i >= (me.nsi - 1) && i < (me.nsi + me.view.nvr - 1))
                //if (i >= (me.nsi) && i <= (me.nsi + me.view.nvr - 1))
				if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
                    node.show('display');
                else
                    node.hide('display');
            }
            /*navModel = me.view.getNavigationModel();
            if (store.tr > me.view.nsi)
                navModel.setPosition(me.view.nsi);*/
        }
    },
    onLast: function(btn) {
		var me = this,
            visibleRows = me.getVisibleRows(),
            store = me.store,
            //vsi = store.tr - visibleRows,
			vsi = (store.tr - me.view.nvr) > 0 ?(store.tr - me.view.nvr):store.tr - visibleRows,
            nvr = me.view.nvr ? me.view.nvr : visibleRows,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > nvr ? vsi - nvr : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei, i, nodes, node;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi > store.tr) {
            return;
        }
		if(vsi == 0)
			vsi = 1;
        if (!(vsi >= si && vsi <= ei) || ((vsi + nvr) > ei && vsi < store.tr) || (ei  != store.tr )) {
            me.store.start = start;
            me.store.end = end;
            if (((vsi + nvr) > ei && (vsi + nvr) < store.tr)) {
                me.store.vsi = (store.tr - me.view.nvr)+1;
                start = me.store.vsi;
            } else
                me.store.vsi = (store.tr - me.view.nvr)+1;
            me.store.changed = true;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        }else{
			if ((store.vsi + me.view.nvr) > store.tr)
                return;
            i = 0;
            nodes = me.view.getNodes();
            me.store.vsi = me.store.vsi + me.view.nvr;
        	//me.store.nsi = me.nsi;
			me.store.nsi = me.nsi = nodes.length - me.view.nvr;  
            for (; i < nodes.length; i++) {
                node = Ext.fly(nodes[i]);
				if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
                    node.show('display');
                else
                    node.hide('display');
            }
        }
		
	}
});
//TECH-34101
// Multifile Upload Control
Ext.define('Ext.ramco.MultiFileUpload', {
    extend: 'Ext.panel.Panel',
    xtype: 'multifileupload',
	requires: [
		'Ext.drag.Target',
		'Ext.layout.container.Fit'
	],
    defaultBindProperty: 'store',
    padding: 0,
	scrollable: true,
    cls: Ext.baseCSSPrefix + 'multifileupload',
    layout: {
        type: 'vbox',
        align: 'stretch'
    },
    viewType: 'ramcodataview',    
    config: {                     
        value: null
    },
	//TECH-36481
	curFileSize: 0,
	tplListView: ['<tpl for=".">', '<div class=\"listview\"><div class=\"uplfilename\">{v1}</div><div class=\"uplcloseicon x-fa fa-close fa-close-default\"></div></div>', '</tpl>'],
	//tplThumbView: ['<tpl for=".">', '<div class=\"thumbview\"><div class=\"icon_center\"><img class=\"uplimageclass\" src={imgThumb}></img></div><div class=\"uplfilename\">{v1}</div><div class=\"uplcloseicon x-fa fa-close fa-close-default\"></div></div>', '</tpl>'],	
	tplThumbView: ['<tpl for=".">', '<div class=\"thumbview\"> <div class=\"icon_center\">	<div class=\"uplcloseicon x-fa fa-close fa-close-default\"></div>	<img class=\"uplimageclass\" src={imgThumb}>	<div class=\"uplfilename\">{v1}</div> </img></div></div>', '</tpl>'],
	tplFileView: ['<tpl for=".">', '<div class=\"thumbview\"> <div class=\"icon_center\">	<div class=\"uplcloseicon x-fa fa-close fa-close-default\"></div>	<div class=\"uplfileview fa fa-file-{fileType}-o\">	<div class=\"uplfilename\">{v1}</div> </div></div></div>', '</tpl>'],
    initComponent: function() {
        var me = this,
            boxType = me.boxType,            
            store, view, viewConfig;

		me.tplListView = new Ext.XTemplate(me.tplListView);
		me.tplThumbView = new Ext.XTemplate(me.tplThumbView);
		//TECH-36481
		me.tplFileView = new Ext.XTemplate(me.tplFileView);
		
		me.dockedItems = [
			{
				xtype: 'toolbar',
				itemId: 'uplTopToolbar',
				dock: 'top',
				items: [				
					{
						xtype: 'component',
						itemId: 'lblUplText',
						html: '<div> Add files to the upload queue and click the upload files </div>'
					},
					'->',
					{
						xtype: 'segmentedbutton',
						itemId: 'segUpdBtnGroup',
						allowDepress: true,
						items: [
							{
								itemId: 'btnUplListView',
								xtype: 'button',
								value:'0',
								tooltip: 'List View',								
								iconCls: 'x-fa fa-list',
								handler: me.onUplListView.bind(me)
							},
							{
								itemId: 'btnUplThumbView',
								xtype: 'button',
								value: "1",
								tooltip: 'Thumb View',
								iconCls: 'x-fa fa-picture-o',
								handler: me.onUplThumbView.bind(me)
							}
						]
					}
				]
			},
			{
				xtype: 'toolbar',
				itemId: 'uplBottomToolbar',
				dock: 'bottom',
				items: [															
					{						
						iconCls: 'x-fa fa-paperclip',
						text: 'Add Files',
						xtype: 'ramcofilebrowse',
						role: 'multiupload',						
						multiple: true,
						itemId: 'mBrowseBtn'
					},
					'',
					{
						xtype: 'button',
						iconCls: 'x-fa fa-upload',
						uploadFile: true,
						role: 'multiupload',						
						text: 'Upload Files'
					},
					'->',
					{					
						xtype: 'label',
						itemId: 'mFilePercent',
						text: "0 %"
					},
					'',
					{	
						xtype: 'label',					
						itemId: 'mFileSize',
						text: "0 Kb"
					}
				]
			}
		];		
		
        store = me.store = Ext.data.StoreManager.lookup(me.store || 'ext-empty-store');
        store.dataView = true;
        viewConfig = Ext.apply({
            xtype: me.viewType,
            store: me.store,
            scrollable: false,
            cls: Ext.baseCSSPrefix + 'multifileupload-view x-multifileupload-listview',
            displayFields: me.displayFields,
            focusCls: '',
            emptyText: me.emptyText || ''
        }, me.viewConfig);
        me.view = view = Ext.create(viewConfig);   
		me.view.currentDataView = "listview";
		me.view.uplImageData = [];
        me.items = [view];
        me.mon(me.view, {            
			uievent: me.processEvent,
            scope: me
        });		
        me.callParent();
		var topbar = me.getDockedComponent('uplTopToolbar');
		var segUplBtnGroup = topbar ? topbar.getComponent('segUpdBtnGroup') : null;
		segUplBtnGroup.setValue('0');		
		me.browseBtn = me.down('#mBrowseBtn');
		me.fileSizeBtn = me.down('#mFileSize');
		me.percentLabel = me.down('#mFilePercent');		
    },	
	initEvents: function() {
        var me = this;
        me.callParent();        
		me.mon(me.body, {			
			drop:me.onUplFileDrop,
			scope: me
		});		
    },
	onUplFileDrop: function(argsv) {			
		var me = this,
            view = me.up('ilbo'),            
			file = [],
			valueStore = [],			
			promiseFile = [];
			
		me.store.tr = me.store.tr || 0;
		valueStore = me.value.store;
		
		if (argsv && argsv.event && argsv.event.dataTransfer && argsv.event.dataTransfer.files) {
			file = argsv.event.dataTransfer.files;
		}
		
		me.processFiles(file);		
	},
	
	processFiles: function(fileList) {
		var me = this,
			file = fileList,
			grid = me,
			ilbo = me.up('ilbo'),
			valueStore = [],			
			promiseFile = [],
			acceptTypeValues = '',
			curSize,			
			mainController = getMainController();//TECH-36479
		
		valueStore = me.value.store;
		if (me.browseBtn) {
			acceptTypeValues = me.browseBtn.accept || me.browseBtn.acceptTypes;
		}
		
		//TECH-36479
		if (mainController) {
			mainController.setLastTask("");
		}
		
		if (file && file.length > 0) {
			for (var i=0; i < file.length; i++) {				
				if (file && !Ext.isEmpty(acceptTypeValues)) {
					var fileObj = (file[i].name) ? file[i].name.split('.') : null;
					if (fileObj) {
						fileExtension = fileObj[fileObj.length - 1];				
						if (fileExtension && acceptTypeValues.indexOf(fileExtension) < 0) {
							var errorText = Ext.String.format('The file {0} has invalid file type[s]: {1}', file[i].name, acceptTypeValues);
							Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
							continue;
						}
					}
				}
				var curRecord = grid.createDummyRecord();
				grid.store.tr += 1;
				if (grid.value)
					grid.value.tr = grid.store.tr;
				curRecord.rn = grid.store.cr = grid.store.tr;
				curRecord.v1 = file[i].name;
				curRecord.fileName = file[i].name;
				curRecord.uplTemp = file[i].name;
				curRecord["file"] = file[i];
				me.curFileSize += file[i].size;
				curSize = Math.round(me.curFileSize / 1024);
				if (curSize > 1024)
					curSize = (curSize / 1024).toFixed(2) + "mb";
				else
					curSize = curSize + "kb";
				me.fileSizeBtn.setText(curSize);
				me.percentLabel.setText("");
				promiseFile.push(me.onMultiImageRead(curRecord, file[i], grid));
				valueStore.push(curRecord);
			}
			Promise.all(promiseFile);
			grid.value.store = valueStore;
			grid.setStore(grid.store);
		}
		
		var stLen = grid.store.tr;
		
		if (grid && stLen > 0) {
			for (var s=0; s < stLen; s++) {
				var curRecord = grid.store.getAt(s);
				if (curRecord.get("sel") === false) {
					curRecord.set("sel", true);
				}
				curRecord.modified = null;
			}
			ilbo.fireEvent('trans', ilbo, [], 'tskdummy', 'trans');
		}
	},
	onMultiImageRead: function(curRecord, file, grid) {
		return new Promise(function (resolve, reject) {	
			var reader  = new FileReader();
			reader.onloadend = function () {				
				curRecord.imgThumb = reader.result;
				var imageObj = {};
				imageObj.rn = curRecord.rn;
				imageObj.src = reader.result;
				imageObj.size = curRecord.size = curRecord.file.size;
				grid.view.uplImageData.push(imageObj);
				grid.view.refresh();
				grid.view.uplImageData = grid.view.uplImageData.sort(function compare(a,b) {
				  if (a.rn < b.rn)
					return -1;
				  if (a.rn> b.rn)
					return 1;
				  return 0;
				});
			}
			reader.readAsDataURL(file);
			resolve();
		});
	},
	onUplListView: function(btn) {
		var me = this,
			storeItems = me.store.data.items;
		me.view.el.dom.classList.add("x-multifileupload-listview");
		me.view.el.dom.classList.remove("x-multifileupload-thumbview");
		me.view.currentDataView = "listview";
		me.view.collectData(storeItems, 0);
		me.view.refresh();
	},
	onUplThumbView: function(btn) {
		var me = this,
			storeItems = me.store.data.items;
		me.view.el.dom.classList.add("x-multifileupload-thumbview");
		me.view.el.dom.classList.remove("x-multifileupload-listview");		
		me.view.currentDataView = "thumbview";
		me.view.collectData(storeItems, 0);
		me.view.refresh();
	},
	createDummyRecord: function() {
        var me = this,
            values = {},
			store = me.store,
			lstRc = null,
			gridName = me.itemId;
		store.si = 1,
		store.vsi = 1;			
		newRowNum = parseInt((store.count() + 1), 10);
		len = store.model.fields ? store.model.fields.length : 0;
		for (i = 0; i < len; i++) {
			values[store.model.fields[i].name] = null;			
		}		
		values['sel'] = false;		
		return values;		
	},
	onResize: function(width, height, oldWidth, oldHeight) {
        var me = this;
		me.callParent(arguments);
		if (width != oldWidth && me.tr > -1) {
			me.onLoadView();
		}
	},
    updateSelect: function(newValue) {
		if(this.rendered && !Ext.isEmpty(newValue) && parseInt(newValue) > 0){
	        var me = this,
	            index = parseInt(newValue, 10),
	            view = me.view,
				selectIndex;
	        if (!me.store || me.store.isEmptyStore) {
	            me.index = index || 0;
	            return;
	        }
			selectIndex = (Ext.isNumber(index) && index > 0) ? (index - 1) : 0;
	        view.select(selectIndex, false, true);
			selectIndex = ((me.store.si || me.store.start) && !Ext.isEmpty(index)) ? (index - (me.store.si || me.store.start)) : null;
			if (!Ext.isEmpty(selectIndex) && selectIndex >= 0)
				view.select(selectIndex, false, true);
			view.curSelect = selectIndex;
		}
    },
    setValueOnData: function() {
        var me = this;
        //me.updateSelect(me.select);
        if (me.isSort) {
            me.isSort = false;
        } else {
            if (me.sortCol) {
                me.sortCol.setSortState(null);
                delete me.sortCol;
            }
        }
    },
    setStore: function(store) {
        var me = this,
            oldStore = me.store;
        /*me.mon(store, {
            refresh: me.setValueOnData,
            scope: me
        });*/
        if (store && store !== oldStore) {
            me.unbindStore();
            me.bindStore(store);
        }
        store.dataView = true;
        if (this.autoLoad && !store.isEmptyStore && !(store.loading || store.isLoaded())) {
            store.load();
        }
        if (me.index)
			me.updateSelect(me.index);
				
		if (Ext.isObject(me.value)) {			
			me.updateValue(me.value);
		}
    },
    updateValue: function(newValue, oldValue) {
        var me = this,
			// TECH-29970
			view = me.view,
			//nvr = view && view.nvr || me.getVisibleRows(),
			curSelect = view && view.curSelect,
			newVsi = (curSelect) ? ((curSelect + 1) - (curSelect % nvr)) : null,
			mainController = getMainController();	//TECH-36479		
			//visibleRows = me.getVisibleRows();
		// TECH-27966
		//me.onFirst();

        if (!me.store || me.store.isEmptyStore) {
            me.value = newValue;
            return;
        }
		//TECH-36479
		if (mainController) {
			lastTask = mainController.getLastTask();
		}			
		
        if (newValue) {
			
			if (me.view && me.view.uplImageData && me.view.uplImageData.length > 0) {
				var imgLen = me.view.uplImageData.length,
					imgArray = me.view.uplImageData,
					storeArray = newValue.store;				
				if (storeArray && storeArray.length > 0) {
					for(var im=0; im < imgLen; im++) {
						if (storeArray[im].rn == imgArray[im].rn) {
							storeArray[im].imgThumb = imgArray[im].src;
						}
					}
				}
			}
			
			if (!Ext.isEmpty(newValue.columnsValue)) {
				me.columnsValue = newValue.columnsValue;
			}

			if (typeof me.store.setData == "undefined") {				
				return;
			}
			
			if (typeof newValue.store == "undefined") {
				newValue = {store:[]};
			}
			
			if (newValue.store && newValue.store.length > 0) {
				var valLen = newValue.store.length;							
				for(var v=0; v < valLen; v++) {
					newValue.store[v].uplTemp = newValue.store[v].v1;
				}
			}
			me.store.tr = newValue.tr;
			me.store.vsi = newValue.vsi;
			// TECH-26230
			// if (!Ext.isEmpty(newValue.store)) {
				me.store.setData(newValue.store);
				me.store.commitChanges();
			// }
			// TECH-33539
			me.onLoadView();
			//TECH-36479
			if (lastTask == "fileupload") {
				me.percentLabel.setText("100%");
				Ext.defer(function(){Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R308)},10);
			}
        }
    },	
	onLoadView: function() {
		var me = this,
			i = 0,
			rec = null,
            node = null,
            nodes = null,
            sel = me.select ? parseInt(me.select, 10) : 0,
			newSel = 0,
			nvr;
			
		if(me.rendered) {	
			me.view.refresh();
		}
	},
    onStoreLoad: Ext.emptyFn,
    bindStore: function(store, initial) {
        var me = this,
            view = me.view;

        if (store) {
            // Bind to store immediately because subsequent processing looks for grid's store property
            me.store = store;

            if (view.store !== store) {
                view.bindStore(store, false);
            }

            me.mon(store, {
                load: me.onStoreLoad,
                scope: me
            });
            me.storeRelayers = me.relayEvents(store, [
                /**
                 * @event filterchange
                 * @inheritdoc Ext.data.Store#filterchange
                 */
                'filterchange',
                /**
                 * @event groupchange
                 * @inheritdoc Ext.data.Store#groupchange
                 */
                'groupchange'
            ]);
        } else {
            me.unbindStore();
        }
    },
    unbindStore: function() {
        var me = this,
            store = me.store,
            view;

        if (store) {
            store.trackStateChanges = false;

            me.store = null;

            me.mun(store, {
                load: me.onStoreLoad,
                scope: me
            });
            if (me.storeRelayers)
                Ext.destroy(me.storeRelayers);

            view = me.view;
            if (view.store) {
                view.bindStore(null);
            }
        }
    },
    processEvent: function(type, view, record, item, rowIndex, e) {
        var me = this;
        if (type == 'click') {
            var el = Ext.fly(e.target),
                elup,
                attributes = el ? el.getAttributes() : {},
                newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
                taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
                linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
                args = [], curView,
				ilbo = me.up('ilbo'),
				dbFileUrl = ilbo ? ilbo.dbFileUrl : '',
				fileUrl = ilbo ? ilbo.fileUrl : '',
				formItems,
				rowNo = record.get("rn"),
				src,
				saveToDb = false,
				attachColumn,
				srcPath = "", 				
				mode = "", 
				dView = "",
				assView = "",
				viewName = "",
				controller = ilbo.getController();				
			
			attachColumn = me.columns.find(function(value) {
				if(value.xtype == "fileattachcolumn" && value.dataIndex != "rn" && value.dataIndex != "sel") 
					return value
				}
			);
			
			if (attachColumn) {
				srcPath = attachColumn.srcPath;				
				mode = attachColumn.mode;
				dView = attachColumn.dView;
				saveToDb = attachColumn.saveToDb;
				assView = attachColumn.assView;
				viewName = attachColumn.dataIndex.replace("v", "");
			}
			
			curView = me.up('ilbo');
			RamcoRTC.focusCtrl = [];
			RamcoRTC.focusCtrl.push(curView.ilboConfig.ilboName);
			RamcoRTC.focusCtrl.push(me.getItemId());
			RamcoRTC.focusCtrl.push(rowIndex);
			RamcoRTC.focusCtrl.push(0);
			RamcoRTC.lastFocusCtrl[1] = me.getItemId();
				
            if (!taskInfo && el) {
                elup = el.up('div[taskinfo]');
                taskInfo = elup ? elup.getAttribute('taskinfo') : null;
            }
            if (!linkInfo && el) {
                elup = el.up('div[linkinfo]');
                linkInfo = elup ? elup.getAttribute('linkinfo') : null;
            }
            if (!newWindow && el) {
                elup = el.up('div[opennewwindow]');
                newWindow = elup ? elup.getAttribute('opennewwindow') || 'about:blank' : null;
            }
            if (me.task || !Ext.isEmpty(taskInfo) || !Ext.isEmpty(linkInfo)) {
                args = ['uiclick', view, record];
                if (Ext.isEmpty(taskInfo) && Ext.isEmpty(linkInfo))
                    args = args.concat(me.task, me.taskType);
                else if (!Ext.isEmpty(taskInfo))
                    args = args.concat(TaskInfoToObjectArray(taskInfo));
                else {
                    args[0] = 'linkclick';
                    args = args.concat(LinkInfoToObjectArray(linkInfo));
                }
                me.fireEvent.apply(me, args);
            } 
			else if (newWindow) {
                openNewWindow(newWindow);
                return true;
            }
			else {
				if (el.dom && el.dom.classList && el.dom.classList.contains("uplcloseicon")) {
					if (!Ext.isEmpty(record.data.file)) {
						if (me.value && me.value.store) {
							for (var i =0; i < me.value.store.length; i++) {
							   if (me.value.store[i].rn === record.data.rn) {
								  me.value.store.splice(i,1);
								  me.value.tr -= 1;
								  me.store.tr -= 1;
								  break;
							   }
							}
						}
						if (me.view && me.view.uplImageData && me.view.uplImageData.length > 0) {
							var imgLen = me.view.uplImageData.length,
								imgArray = me.view.uplImageData;						
							for (var im=0; im < imgLen; im++) {
								if (imgArray[im].rn == record.data.rn) {
									imgArray.splice(im, 1);
									break;
								}
							}
						}
						me.store.remove(record);
						return;
					}
					else {
						Ext.RamcoMsg.confirm(rvw_resources.R253, record.data.v1, function(btnId) {
							if (btnId == "ok" || btnId == "yes") {
								//TECH-36299
								if (me.view && me.view.uplImageData && me.view.uplImageData.length > 0) {
									var imgLen = me.view.uplImageData.length,
										imgArray = me.view.uplImageData;						
									for (var im=0; im < imgLen; im++) {
										if (imgArray[im].rn == record.data.rn) {
											var slicedImg = imgArray.splice(im, 1);
											var tim = im;
											for (; tim < imgLen; tim++) {
												if (imgArray[tim]) {
													imgArray[tim].rn = tim + 1;
												}
											}
											break;
										}
									}
								}
								me.curFileSize -= slicedImg[0].size;
								var curSize = Math.round(me.curFileSize / 1024);
								if (curSize > 1024)
									curSize = (curSize / 1024).toFixed(2) + "mb";
								else
									curSize = curSize + "kb";
								me.fileSizeBtn.setText(curSize);
								controller.taskPending = true;
								ilbo.fireEvent('deletefile', ilbo, 'deletefile', 'trans', me.getItemId(), viewName, rowNo, srcPath, assView, dView);
								return;								
							}							
						});	
						return;
					}
				}
				if (Ext.isEmpty(record.data.file)) {
					if (saveToDb) {
						src = Ext.String.format(dbFileUrl, me.getItemId(), assView, rowNo, srcPath, view, mode, dView);									
					}
					else {
						src = Ext.String.format(fileUrl, me.getItemId(), "1", rowNo, "./", "", "true", "");
					}
					//if(hdnFileId)
						//src += "&RVWRTQS_CONTROL_HIDDENVIEW=" + hdnFileId;		
					window.open(src);
				}
			}
		}
    },
    processState: function(view) {},
});

// Horizontal Data View Control
Ext.define('Ext.ramco.HorizontalView', {
    extend: 'Ext.panel.Panel',
    xtype: 'horizontalview',
    defaultBindProperty: 'store',
    padding: 0,
    cls: Ext.baseCSSPrefix + 'horizontalview',
    layout: {
        type: 'vbox',
        align: 'stretch'
    },
    viewType: 'ramcodataview',
    boxType: "1",
    config: {
        visibleRows: 5,
        first: false,
        last: false,
        prev: false,
        next: false,
        select: 0,
        value: null
    },
    initComponent: function() {
        var me = this,
            boxType = me.boxType,
            defaultWidth,
            defaultHeight,
            store, view, viewConfig,
            first = me.getFirst(),
            prevSet = me.getPrev(),
            nextSet = me.getNext(),
            last = me.getLast(),
            leftButtons = [],
            rightButtons = [],
            toolbar = [];
        store = me.store = Ext.data.StoreManager.lookup(me.store || 'ext-empty-store');
        store.dataView = true;
        viewConfig = Ext.apply({
            xtype: me.viewType,
            store: me.store,
            scrollable: false,
            cls: Ext.baseCSSPrefix + 'horizontalview-view',
            displayFields: me.displayFields,
            focusCls: '',
            emptyText: me.emptyText || ''
        }, me.viewConfig);
        me.view = view = Ext.create(viewConfig);
        
        if (boxType == "1") {
            defaultWidth = 105;
            defaultHeight = 70;
        } else if (boxType == "2") {
            defaultWidth = 160;
            defaultHeight = 80;
        } else if (boxType == "3") {
            defaultWidth = 180;
            defaultHeight = 70;
        } else if (boxType == "4") {
            defaultWidth = 120;
            defaultHeight = 85;
        } else if (boxType == "5") {
            defaultWidth = 310; // TECH-29248 - New Update
            defaultHeight = 140;
        } else if (boxType == "6") {
            defaultWidth = 259;
            defaultHeight = 74;
        } else if (boxType == "7") {
            defaultWidth = 150;
            defaultHeight = 60;
        } else if (boxType == "8") {
            defaultWidth = 240;
            defaultHeight = 40;
        } else if (boxType == "9") {
            defaultWidth = 75;
            defaultHeight = 35;
        } else if (boxType == "10") {
            defaultWidth = 220;
            defaultHeight = 180;
        } else if (boxType == "11") {
            defaultWidth = 120;
            defaultHeight = 40;
        } else if (boxType == "12") {
            defaultWidth = 240;
            defaultHeight = 100;
        } else if (boxType == "13") {
            defaultWidth = 72;
            defaultHeight = 72;
        } else if (boxType == "14") {
			defaultWidth = 200;
			defaultHeight = 32;
		} else if (boxType == "15") {
			defaultWidth = 240;
			defaultHeight = 40;
		} else if (boxType == "16") { // TECH-40001
			defaultWidth = 370;
			defaultHeight = 132;
		} else if (boxType == "17") {
			defaultWidth = 130;
			defaultHeight = 70;
        } else if (boxType == "18") {
			defaultWidth = 240;
			defaultHeight = 132;
		} else if (boxType == "19") {
			defaultWidth = 100;
			defaultHeight = 50;
		} else if (boxType == "20") {
			defaultWidth = 200;
			defaultHeight = 50;
		} else if (boxType == "21") { // TECH-31799
			defaultWidth = 110;
			defaultHeight = 130;
        } else if (boxType == "22") {
			defaultWidth = 225;
			defaultHeight = 75;
        } else if (boxType == "23") {
			defaultWidth = 65;
			defaultHeight = 60;
        }

        if (me.wrapCount > 1)
            defaultHeight = (defaultHeight + 10) * me.wrapCount;
        me.height = (defaultHeight + 10);
        me.itemWidth = defaultWidth;
        view.height = (defaultHeight);
        me.items = [view];
        me.mon(me.view, {
            uievent: me.processEvent,
            scope: me
        });

		// AHBG-27323 / MPTU-204
		// if (defaultHeight > 40) {
		leftButtons = ['->'];
		rightButtons = ['->'];
		// }
		if (first)
            leftButtons.push({
                xtype: 'button',
                itemId: 'moveFirst',
                padding: 1,
                iconCls: 'x-fa fa-angle-double-left',
                handler: me.onFirst.bind(me)
            });
        if (prevSet)
            leftButtons.push({
                xtype: 'button',
                itemId: 'movePrev',
                padding: 1,
                iconCls: 'x-fa fa-angle-left',
                handler: me.onMoveToPrev.bind(me)
            });

        if (nextSet)
            rightButtons.push({
                xtype: 'button',
                itemId: 'moveNext',
                padding: 1,
                iconCls: 'x-fa fa-angle-right',
                handler: me.onMoveToNext.bind(me)
            });
        if (last)
            rightButtons.push({
                xtype: 'button',
                itemId: 'moveLast',
                padding: 1,
                iconCls: 'x-fa fa-angle-double-right',
                handler: me.onLast.bind(me)
            });

        if (leftButtons.length > 1) {
			// AHBG-27323 / MPTU-204
			// if (defaultHeight > 40) 
			leftButtons.push('->');
            toolbar.push({
                dock: 'left',
                xtype: 'toolbar',
                itemId: 'leftSlider',
                defaults: {
                    scale: 'small'					
                },
                items: leftButtons
            });
        }
        if (rightButtons.length > 1) {
			// AHBG-27323 / MPTU-204
			// if (defaultHeight > 40) 
			rightButtons.push('->');
            toolbar.push({
                dock: 'right',
                xtype: 'toolbar',
                itemId: 'rightSlider',
                defaults: {
                    scale: 'small'
                },
                items: rightButtons
            });
        }
        if (toolbar.length > 0) {
            me.dockedItems = toolbar;
        }
        me.callParent();
    },
	// TECH-33539
	onResize: function(width, height, oldWidth, oldHeight) {
        var me = this;
		me.callParent(arguments);
		if (width != oldWidth && me.tr > -1) {
			me.onLoadView();
		}
	},
    updateSelect: function(newValue) {
		//if (!isNaN(parseInt(newValue)) || Ext.isNumber(newValue)) {
		// TECH-27457 - Dataview unnecessary default focus
		if(this.rendered && !Ext.isEmpty(newValue) && parseInt(newValue) > 0){
	        var me = this,
	            index = parseInt(newValue, 10),
	            view = me.view,
				storeRange = me.store.getRange(), // TECH-34828
				selectIndex;
	        if (!me.store || me.store.isEmptyStore) {
	            me.index = index || 0;
	            return;
	        }
			// TECH-34828
			
			// selectIndex = (Ext.isNumber(index) && index > 0) ? (index - 1) : 0;
	        // view.select(selectIndex, false, true);
			// selectIndex = ((me.store.si || me.store.start) && !Ext.isEmpty(index)) ? (index - (me.store.si || me.store.start)) : null;
			// if (!Ext.isEmpty(selectIndex) && selectIndex >= 0)
				// view.select(selectIndex, false, true);			
			selectIndex = storeRange && storeRange.findIndex(function(r){ return r.get('rn') == newValue });
			if (!Ext.isEmpty(selectIndex)) {
				view.select(selectIndex, false, true);
				view.curSelect = selectIndex;
			}			
		}
		//}
    },
    setValueOnData: function() {
        var me = this;
        //me.updateSelect(me.select);
        if (me.isSort) {
            me.isSort = false;
        } else {
            if (me.sortCol) {
                me.sortCol.setSortState(null);
                delete me.sortCol;
            }
        }
    },
    setStore: function(store) {
        var me = this,
            oldStore = me.store;
        /*me.mon(store, {
            refresh: me.setValueOnData,
            scope: me
        });*/
        if (store && store !== oldStore) {
            me.unbindStore();
            me.bindStore(store);
        }
        store.dataView = true;
        if (this.autoLoad && !store.isEmptyStore && !(store.loading || store.isLoaded())) {
            store.load();
        }
        if (me.index)
			me.updateSelect(me.index);
		if (Ext.isObject(me.value) && (Ext.isEmpty(me.store.vsi) || Ext.isEmpty(me.store.tr) || Ext.isEmpty(me.store.si)))
			me.updateValue(me.value);
    },
    updateValue: function(newValue, oldValue) {
        var me = this,
			// TECH-29970
			view = me.view,
			nvr = view && view.nvr || me.getVisibleRows(),
			curSelect = view && view.curSelect,
			newVsi = (curSelect) ? ((curSelect + 1) - (curSelect % nvr)) : null,
			visibleRows = me.getVisibleRows();
		// TECH-27966
		//me.onFirst();

        if (!me.store || me.store.isEmptyStore) {
            me.value = newValue;
            return;
        }
        if (newValue) {
			// TECH-29970
			//me.vsi = newValue.vsi;
            me.vsi = (newVsi && me.store.vsi == newVsi) ? newVsi : newValue.vsi;
            me.si = newValue.si;
            me.tr = newValue.tr;
			// TECH-29378
			//me.nsi = 0;
			
			// TECH-29970
			if (newVsi)
				me.nsi = newVsi;
			me.store.vsi = me.vsi;
            me.store.nsr = parseInt(newValue.nsr, 10);
            me.store.start = me.si;
            me.store.end = (visibleRows * 3) + (me.si - 1);
            if (me.store.end > me.tr)
                me.store.end = me.tr
            me.store.tr = me.tr;
            me.store.vr = newValue.vr ||(visibleRows * 3);//AHBG-26121 
            //me.store.vsi = me.vsi;
            me.store.cr = me.vsi;
			if (!Ext.isEmpty(newValue.columnsValue)) {
				me.columnsValue = newValue.columnsValue;
			}

			if (typeof me.store.setData == "undefined") {				
				return;
			}
			
			if (typeof newValue.store == "undefined") {
				newValue = {store:[]};
			}
			// TECH-26230
			// if (!Ext.isEmpty(newValue.store)) {
				me.store.setData(newValue.store);
				me.store.commitChanges();
				// TECH-34108 / TECH-34237
				view.nvr = -1;
				me.nsi = 0;
			// }
			// TECH-33539
			me.onLoadView();
        }
    },
	// TECH-33539
	onLoadView: function() {
		var me = this,
			i = 0,
			rec = null,
            node = null,
            nodes = null,
            sel = me.select ? parseInt(me.select, 10) : 0,
			newSel = 0,
			nvr;
			
		if(me.rendered) {
			if((nvr = Math.floor(me.view.getWidth() / (me.itemWidth + 10))) != me.view.nvr) {
				//if (!me.view.nvr) {
				me.view.nvr  = nvr;
				//me.view.nvr = Math.ceil(me.view.getWidth() / (me.itemWidth + 10));
				me.view.nvr = me.view.nvr * me.wrapCount;
				//}
				nodes = me.view.getNodes();
				if (me.vsi == 1) {
					if(Ext.isEmpty(me.nsi))
					me.nsi = 0;
					if(Ext.isEmpty(me.store.vsi))
						me.store.vsi = me.vsi;
					if (sel > me.view.nvr) {
						newSel = (sel % me.view.nvr);
						//me.store.vsi = sel - newSel + 1;
					}
					if(sel > me.nsi)
						me.nsi = me.store.vsi - 1;
					for (; i < nodes.length; i++) {
						node = Ext.fly(nodes[i]);
						//if (i >= (me.store.vsi - 1) && i < (me.store.vsi + me.view.nvr - 1))
						  if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
							node.show('display');
						else
							node.hide('display');
					}
				} else {
					i = 0;
					rec = me.store.findRecord('rn', me.store.vsi);
					me.nsi = me.store.indexOf(rec) || 1;
					nodes = me.view.getNodes();
					me.store.vsi = me.vsi;
					if (sel > me.view.nvr) {
						newSel = (sel % me.view.nvr);
					   // me.store.vsi = sel - newSel + 1;
					}
					for (; i < nodes.length; i++) {
						node = Ext.fly(nodes[i]);
						if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
							node.show('display');
						else
							node.hide('display');
					}
				}
				//if (!Ext.isEmpty(sel) && Ext.isNumber(sel) && sel != 0)
					me.updateSelect(sel);
				// Disabling Navigation Buttons when total rows being shown in screen launch itself
				var toolBarItems = me.dockedItems && me.dockedItems.items,
					toolBarDisabled = (me.tr == 0 || me.view.nvr >= me.tr);
				if (!Ext.isEmpty(toolBarItems) && toolBarItems.length > 0) {
					toolBarItems[0][toolBarDisabled ? "disable" : "enable"]();
					if(toolBarItems[1])
						toolBarItems[1][toolBarDisabled ? "disable" : "enable"]();
				}
			}
		}
	},
    onStoreLoad: Ext.emptyFn,
    bindStore: function(store, initial) {
        var me = this,
            view = me.view;

        if (store) {
            // Bind to store immediately because subsequent processing looks for grid's store property
            me.store = store;

            if (view.store !== store) {
                view.bindStore(store, false);
            }

            me.mon(store, {
                load: me.onStoreLoad,
                scope: me
            });
            me.storeRelayers = me.relayEvents(store, [
                /**
                 * @event filterchange
                 * @inheritdoc Ext.data.Store#filterchange
                 */
                'filterchange',
                /**
                 * @event groupchange
                 * @inheritdoc Ext.data.Store#groupchange
                 */
                'groupchange'
            ]);
        } else {
            me.unbindStore();
        }
    },
    unbindStore: function() {
        var me = this,
            store = me.store,
            view;

        if (store) {
            store.trackStateChanges = false;

            me.store = null;

            me.mun(store, {
                load: me.onStoreLoad,
                scope: me
            });
            if (me.storeRelayers)
                Ext.destroy(me.storeRelayers);

            view = me.view;
            if (view.store) {
                view.bindStore(null);
            }
        }
    },
    processEvent: function(type, view, record, item, rowIndex, e) {
        var me = this;
        if (type == 'click') {
            var el = Ext.fly(e.target),
                elup, index, mod, // TECH-34108 / TECH-34237
                attributes = el ? el.getAttributes() : {},
                newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
                taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
                linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
                args = [], curView;
				
				curView = me.up('ilbo');
				RamcoRTC.focusCtrl = [];
				RamcoRTC.focusCtrl.push(curView.ilboConfig.ilboName);
				RamcoRTC.focusCtrl.push(me.getItemId());
				RamcoRTC.focusCtrl.push(rowIndex);
				RamcoRTC.focusCtrl.push(0);
				RamcoRTC.lastFocusCtrl[1] = me.getItemId();
				
            if (!taskInfo && el) {
                elup = el.up('div[taskinfo]');
                taskInfo = elup ? elup.getAttribute('taskinfo') : null;
            }
            if (!linkInfo && el) {
                elup = el.up('div[linkinfo]');
                linkInfo = elup ? elup.getAttribute('linkinfo') : null;
            }
            if (!newWindow && el) {
                elup = el.up('div[opennewwindow]');
                newWindow = elup ? elup.getAttribute('opennewwindow') || 'about:blank' : null;
            }
            if (me.task || !Ext.isEmpty(taskInfo) || !Ext.isEmpty(linkInfo)) {
                args = ['uiclick', view, record];
                if (Ext.isEmpty(taskInfo) && Ext.isEmpty(linkInfo))
                    args = args.concat(me.task, me.taskType);
                else if (!Ext.isEmpty(taskInfo))
                    args = args.concat(TaskInfoToObjectArray(taskInfo));
                else {
                    args[0] = 'linkclick';
                    args = args.concat(LinkInfoToObjectArray(linkInfo));
                }
				
				// TECH-34108 / TECH-34237
				index = record.get('rn');
				if (index > me.view.nvr) {
					mod = index % me.view.nvr;
					// TECH-31663
					me.view.curSelect = index - 1;
					me.store.cr = index;
				}
				// TECH-31663
				if (index == 1)
					me.view.curSelect = 0;
				
                me.fireEvent.apply(me, args);
            } else if (newWindow) {
                openNewWindow(newWindow);
                return true;
            }
        }
    },
    processState: function(view) {},
    onFirst: function(btn) {
        var me = this,
            visibleRows = me.getVisibleRows(),
            store = me.store,
            vsi = me.view.nvr ? (store.vsi - me.view.nvr) : store.vsi,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > me.view.nvr ? vsi - me.view.nvr : vsi - visibleRows,
            end = ((visibleRows * 3) + (start - 1)) > store.tr ? store.tr : ((visibleRows * 3) + (start - 1)),
            nvr = me.view.nvr ? me.view.nvr : 0,
            si, ei, i, nodes, node;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi <= -1)
            return;
        if (!(vsi >= si && vsi <= ei) || ((vsi - nvr) < si && (vsi - nvr) > 0) || (si != 1)) {
			//if(si != 1){
            me.store.start = start = start > 0 ? start : 1;
            me.store.end = end;
            /* if (((vsi - nvr) < si && (vsi - nvr) > 0)) {
                me.store.vsi = 1;
                start = 1;
            } else */
                me.store.vsi = 1;
				start = 1;
			me.store.nsi = me.nsi = 0;
            me.store.changed = true;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        }else{
			 if ((store.vsi - me.view.nvr) < 0)
                return;
            i = 0;
            nodes = me.view.getNodes();
            me.store.vsi = 1;
            me.store.nsi = me.nsi = 0;
            //me.nsi = (me.store.nsi - me.view.nvr) > 0 ? (me.store.nsi - me.view.nvr) : 0;
            for (; i < nodes.length; i++) {
                node = Ext.fly(nodes[i]);
                //if (i >= (me.nsi - 1) && i < (me.nsi + me.view.nvr - 1))
                //if (i >= (me.nsi) && i <= (me.nsi + me.view.nvr - 1))
				if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
                    node.show('display');
                else
                    node.hide('display');
            }
			var sel = me.select ? parseInt(me.select, 10) : 0,
				view = me.view;
			if ( me.store.vsi == 1) {
				me.updateSelect(sel);
				//view.select(sel, false, true);
			}
        }
    },
    onMoveToPrev: function() {
        var me = this,
            visibleRows = me.getVisibleRows(),
            store = me.store,
            vsi = (store.vsi - me.view.nvr) > 0 ? (store.vsi - me.view.nvr) : 1,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > me.view.nvr ? vsi - me.view.nvr : vsi - visibleRows,
            end = ((visibleRows * 3) + (start - 1)) > store.tr ? store.tr : ((visibleRows * 3) + (start - 1)),
            nvr = me.view.nvr ? me.view.nvr : 0,
            si, ei, i, nodes, node;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (store.vsi - me.view.nvr <= -1)
            return;
        if (!(store.vsi >= si && store.vsi <= ei) || ((store.vsi - nvr) < si && (store.vsi - nvr) >= 0)) {
            me.store.start = start = start > 0 ? start : 1;
            me.store.end = end;
            if (((vsi - nvr) < si && (vsi - nvr) > 0)) {
                me.store.vsi = vsi;
                start = (vsi - nvr) > 0 ? (vsi - nvr) : 1;
            } else
                me.store.vsi = vsi;
			me.store.si =  (vsi - visibleRows)>0?(vsi - visibleRows):1;
			me.si = (vsi - visibleRows)>0?(vsi - visibleRows):1;
			me.cr = (vsi - visibleRows)>0?(vsi - visibleRows):1;
            me.store.changed = true;
			//me.store.nsi = me.nsi;
            me.nsi = (me.store.nsi - me.view.nvr) > 0 ? (me.store.nsi - me.view.nvr) : 0;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        } else {
            if ((store.vsi - me.view.nvr) < 0)
                return;
            i = 0;
            nodes = me.view.getNodes();
            me.store.vsi = (me.store.vsi - me.view.nvr) > 0 ? (me.store.vsi - me.view.nvr) : 1;
            me.store.nsi = me.nsi;
            me.nsi = (me.store.nsi - me.view.nvr) > 0 ? (me.store.nsi - me.view.nvr) : 0;
			/* if(si == 1){
				me.store.vsi = 1;
				me.nsi = me.store.nsi = 0;
			} */
            for (; i < nodes.length; i++) {
                node = Ext.fly(nodes[i]);
                //if (i >= (me.nsi - 1) && i < (me.nsi + me.view.nvr - 1))
                //if (i >= (me.nsi) && i <= (me.nsi + me.view.nvr - 1))
				if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
                    node.show('display');
                else
                    node.hide('display');
            }
			var sel = me.select ? parseInt(me.select, 10) : 0,
				view = me.view;
			if ( me.store.vsi == 1) {
				me.updateSelect(sel);
				//view.select(sel, false, true);
			}
        }
    },
    onMoveToNext: function() {
        var me = this,
            visibleRows = me.getVisibleRows(),
            store = me.store,
            vsi = me.view.nvr ? (store.vsi + me.view.nvr) : store.vsi,
            nvr = me.view.nvr ? me.view.nvr : visibleRows,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > nvr ? vsi - nvr : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei, i, nodes, node;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi > store.tr) {
            return;
        }
        //if (vsi + nvr > ei && (!(vsi >= si && vsi <= ei) || ((vsi + nvr) > ei && vsi < store.tr))) {
        if (vsi+nvr  > ei && (!(vsi >= si && vsi <= ei) || ((vsi + nvr) > ei && (((vsi + nvr) <= store.tr) || ((vsi + visibleRows) <= store.tr))))) {
            me.store.start = start;
            me.store.end = end;
            if (((vsi + nvr) > ei && (vsi + nvr) < store.tr)) {
                me.store.vsi = vsi;
                start = me.store.vsi;
            } else
                me.store.vsi = vsi;
			me.store.si = vsi - visibleRows;
			me.si = vsi - visibleRows;
			me.cr = vsi - visibleRows;
            me.store.changed = true;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        } else {
            if ((store.vsi + me.view.nvr) > store.tr)
                return;
            i = 0;
            nodes = me.view.getNodes();
            me.store.vsi = me.store.vsi + me.view.nvr;
            if (me.nsi < nodes.length)
                me.nsi += me.view.nvr;
            else
                me.nsi = 0;
			me.store.nsi = me.nsi;
            for (; i < nodes.length; i++) {
                node = Ext.fly(nodes[i]);
                //if (i >= (me.nsi - 1) && i < (me.nsi + me.view.nvr - 1))
                //if (i >= (me.nsi) && i <= (me.nsi + me.view.nvr - 1))
				if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
                    node.show('display');
                else
                    node.hide('display');
            }
        }
    },
    onLast: function(btn) {
        var me = this,
            visibleRows = me.getVisibleRows(),
            store = me.store,
            //vsi = store.tr - visibleRows,
			vsi = (store.tr - me.view.nvr) > 0 ?(store.tr - me.view.nvr):store.tr - visibleRows,
            nvr = me.view.nvr ? me.view.nvr : visibleRows,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > nvr ? vsi - nvr : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei, i, nodes, node;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi > store.tr) {
            return;
        }
		if(vsi == 0)
			vsi = 1;
        if (!(vsi >= si && vsi <= ei) || ((vsi + nvr) > ei && vsi < store.tr) || (ei  != store.tr)) {
            me.store.start = start;
            me.store.end = end;
            if (((vsi + nvr) > ei && (vsi + nvr) < store.tr)) {
                me.store.vsi = (store.tr - me.view.nvr)+1;
                start = me.store.vsi;
            } else
                me.store.vsi = (store.tr - me.view.nvr)+1;
            me.store.changed = true;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        }else{
			if ((store.vsi + me.view.nvr) > store.tr)
                return;
            i = 0;
            nodes = me.view.getNodes();
            me.store.vsi = me.store.vsi + me.view.nvr;
			//me.store.nsi = me.nsi;
			me.store.nsi = me.nsi = nodes.length - me.view.nvr;  
            for (; i < nodes.length; i++) {
                node = Ext.fly(nodes[i]);
				if (i >= (me.nsi) && i < (me.nsi + me.view.nvr))
                    node.show('display');
                else
                    node.hide('display');
            }
        }
    }
});

// Data View Control
Ext.define('Ext.ramco.DataView', {
    extend: 'Ext.view.View',
    alias: 'widget.ramcodataview',
    overItemCls: 'x-dw-item-over',
    itemSelector: 'div.x-list-item-cell',
    config: {
        cardPanelId: null,
        nextCardPanelId: null,
        postHlpTsk: null,
        panelId: null,
        task: null,
        tasktype: null,
        displayFields: null,
        paging: true,
        useSimpleItems: false,
        visibleRows: 5,
        virtualRow: 3,
        totalRows: null,
        currentRow: 0,
        startIndex: 0,
        options: null,
		reqBorder:false,
		rowLines:false,
		columnLines:false,
        virtualStartIndex: 0,
        noOfSelectedRows: 0
    },
    initComponent: function() {
        var me = this,
            i = 0,
            parent = null,
            options = me.getOptions(),
            displayFields = me.getDisplayFields(),
            len = displayFields ? displayFields.length : 0,
            displayField,
            fieldData = '',
			styleClass = '',
			reqBorder = me.getReqBorder(),
			rowLines = me.getRowLines(),
			columnLines = me.getColumnLines(),
            i = 0;
        me.dockedItems = [{
            dock: 'bottom',
            xtype: 'toolbar',
            focusable: false,
            itemId: 'navBar',
            items: []
        }];
        if (me.type == 'stackedlink') {
            if (Ext.isEmpty(options))
                me.addCls(Ext.baseCSSPrefix + "stackedlink-ver");
            else
            me.addCls(Ext.baseCSSPrefix + "stackedlink");
		styleClass += (reqBorder) ? ' x-stackedlink-border':' x-stackedlink-noborder';
		styleClass += (columnLines) ? ' x-stackedlink-colborder ': ' x-stackedlink-nocolborder';
		styleClass += (rowLines) ? ' x-stackedlink-rowborder': ' x-stackedlink-norowborder';
        }
        if (displayFields && displayFields.length > 0) {
            for (; i < len; i++) {
                displayField = displayFields[i];
                if (me.type == 'stackedlink')
					//fieldData += '<div class="x-list-item-cell" style="width:{width}px;" itemIndex="' + displayField + '">{' + displayField + '}</div>';
					fieldData += '<div class="x-list-item-cell '+ styleClass +'" style="width:{width}px;" itemIndex="' + displayField + '">{' + displayField + '}</div>';
                else
                    fieldData += '<div class="x-list-item-cell" itemIndex="' + displayField + '">{' + displayField + '}</div>';
            }
        }
        me.tpl = new Ext.XTemplate('<tpl for=".">',
            fieldData,
            '</tpl>');
        me.callParent();
    },
    initEvents: function() {
        var me = this;

        me.callParent();
        if (me.type == 'stackedlink') {
            me.mon(me.el, {
                scope: me,
                mouseenter: me.onMouseEnter,
                mouseleave: me.onMouseLeave
            });
            me.on('uievent', me.processEvent, me);
            me.on('refresh', me.viewRefresh, me);
        }
    },
    afterRender: function() {
        var me = this;
        me.callParent();
    },
    applyOptions: function(config) {
        var me = this;
        if (me.type == 'stackedlink') {
            if (Ext.isEmpty(config))
                me.addCls(Ext.baseCSSPrefix + "stackedlink-ver");
            else {
                if (Ext.isEmpty(config))
                    me.optionObj = null;
                else if (Ext.isObject(config))
                    me.optionObj = config;
                else if (Ext.isString(config))
                    me.optionObj = Ext.decode(config, true);
                if (me.optionObj)
                    me.addCls(Ext.baseCSSPrefix + "stackedlink-" + (me.optionObj.orientation || me.optionObj.direction || "ver"));
            }
        }
    },
    updateOptions: function(newValue, oldValue) {
        var me = this;
        if (me.type == 'stackedlink') {
            if (Ext.isEmpty(newValue)) {
                me.optionObj = null;
            } else if (Ext.isObject(newValue))
                me.optionObj = newValue;
            else if (Ext.isString(newValue))
                me.optionObj = Ext.decode(newValue, true);
            if (me.optionObj) {
                me.removeCls(Ext.baseCSSPrefix + "stackedlink-ver");
                me.addCls(Ext.baseCSSPrefix + "stackedlink-" + (me.optionObj.orientation || me.optionObj.direction || "ver"));
            }
        }
    },
    viewRefresh: function() {
        var me = this,
            width = me.getSize().width - 10,
            options = me.optionObj,
            navBar = me.navBar,
            count = 0;
        if (me.store && me.store.getCount() > 0) {
            count = me.store.getCount();
            if (options) {
                if (!navBar && options.navigator && (me.container.component.xtype == 'panel' || me.container.component.xtype == 'ramcopanel')) {
                    navBar = me.container.component.addDocked(me.dockedItems);
                    me.navBar = navBar = navBar[0];
                }
                if (options.orientation == 'hor' || options.direction == 'hor') {
                    me.el.setStyle({
                        overflow: 'hidden'
                    });
                    me.setWidth(count * width);
                    var div = Ext.query('.x-list-item-cell', false, me.el),
                        nav = null,
                        slide = new Ext.Slideshow(div);
                    if (navBar) {
                        navBar.add({
                            xtype: 'tbfill'
                        });
                        while (navBar.items.length < (count + 1)) {
                            navBar.add({
                                iconCls: 'x-fa fa-circle',
                                handler: slide.onNavClick,
                                index: navBar.items.length,
                                focusable: false,
                                scope: slide
                            });
                        }
                        navBar.add({
                            xtype: 'tbfill'
                        });
                    }
                    if (slide && navBar) {
                        //slide.navArray = nav = Ext.query('.x-btn', false, navBar.el);
						slide.navArray = nav = navBar.query("button");
					}
					me.slide = slide;
                    slide.init(options, me);
                    return;
                } else if (options.orientation == 'ver' || options.direction == 'ver') {
                    me.el.setStyle({
                        overflow: 'hidden'
                    });
                    me.anim = {
                        target: me.el.dom,
                        easing: 'easeIn',
                        duration: 10000,
                        iterations: Infinity,
                        from: {
                            top: me.getHeight(),
                        },
                        to: {
                            top: -(me.el.dom.scrollHeight * 2.5)
                        }
                    };
                }
            } else {
                me.anim = null;
            }
			
			if(options && options.type == 'static')
				me.anim = null
			
            if (me.animFrame) {
                Ext.destroy(me.animFrame);
                me.animFrame = null;
            }
            if (me.anim)
                me.animFrame = new Ext.fx.Anim(me.anim);
        }
    },
    onMouseEnter: function() {
        var me = this;
        if (me.animFrame)
            me.animFrame.paused = true;
        if (me.slide)
            me.slide.stopAuto();
    },
    onMouseLeave: function() {
        var me = this;
        if (me.animFrame)
            me.animFrame.paused = false;
        if (me.slide)
            me.slide.auto();
    },
    moveToRow: function(newValue) {
        var me = this,
            visibleRows = me.getVisibleRows(),
            vsi = me.getCurrentRow(),
            store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > visibleRows ? vsi - visibleRows : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (start != si) {
            me.store.start = start;
            me.store.end = end;
            me.store.vsi = vsi;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        }
    },
    moveToPrev: function() {
        var me = this,
            visibleRows = me.getVisibleRows(),
            vsi = me.getCurrentRow(),
            store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > visibleRows ? vsi - visibleRows : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (start != si) {
            me.store.start = start;
            me.store.end = end;
            me.store.vsi = vsi;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        }
    },
    moveToNext: function() {
        var me = this,
            visibleRows = me.getVisibleRows(),
            vsi = me.getCurrentRow(),
            store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = vsi > visibleRows ? vsi - visibleRows : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (start != si) {
            me.store.start = start;
            me.store.end = end;
            me.store.vsi = vsi;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        }
    },
    getRawFormat: function(type, value) {
        var ret = value;
        switch (type) {
            case 'hdate':
                ret = Ext.util.Format.date(value, 'B-Q-R');
                break;
            case 'hdate-time':
                ret = Ext.util.Format.date(value, 'B-Q-R H:i:s');
                break;
            case 'htime':
                ret = Ext.util.Format.date(value, 'H:i:s');
                break;
            case 'date':
                ret = Ext.util.Format.date(value, 'Y-m-d');
                break;
			//TECH-26776 / APSH-93
			case 'datetime':
            case 'date-time':
                ret = Ext.util.Format.date(value, 'Y-m-d H:i:s');
                break;
            case 'time':
                ret = Ext.util.Format.date(value, 'H:i:s');
                break;
            default:
        }
        return ret;
    },
    processEvent: function(type, view, record, item, rowIndex, e) {
        var me = this;
        if (type == 'click') {
            var el = Ext.fly(e.target),
                elup,
                attributes = el ? el.getAttributes() : {},
                newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
                taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
                linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
                url = record.get('url'),
                store = me.store,
                args = [];
            if (!taskInfo && el) {
                elup = el.up('div[taskinfo]');
                taskInfo = elup ? elup.getAttribute('taskinfo') : null;
            }
            if (!linkInfo && el) {
                elup = el.up('div[linkinfo]');
                linkInfo = elup ? elup.getAttribute('linkinfo') : null;
            }
            if (!newWindow && el) {
                elup = el.up('div[opennewwindow]');
                newWindow = elup ? elup.getAttribute('opennewwindow') || 'about:blank' : null;
            }
            if (me.task || !Ext.isEmpty(taskInfo) || !Ext.isEmpty(linkInfo)) {
                args = ['uiclick', view, record];
                if (Ext.isEmpty(taskInfo) && Ext.isEmpty(linkInfo))
                    args = args.concat(me.task, me.taskType);
                else if (!Ext.isEmpty(taskInfo))
                    args = args.concat(TaskInfoToObjectArray(taskInfo));
                else {
                    args[0] = 'linkclick';
                    args = args.concat(LinkInfoToObjectArray(linkInfo));
                }
                store.cr = (rowIndex + 1);
                if (url) {
                    openNewWindow(url);
                    return true;
                } else
                    me.fireEvent.apply(me, args);
            } else if (newWindow) {
                openNewWindow(newWindow);
                return true;
            } else if (record.get("lt") == "2") {
                openNewWindow(record.get("url"));
                return true;
            }
        }
    },
    prepareData: function(data, index, record) {
        var me = this,
            displayFields = me.getDisplayFields(),
            len = displayFields ? displayFields.length : 0,
            splittedPlaceHolder = [],
            placeHolders,
            i = 0,
            obj = 0,
            value,
			key,
			returnValue,
            associatedData, attr, hasCopied,
			ilbo = me.up('ilbo');//TECH-34101
        if (record) {
            associatedData = record.getAssociatedData();
            for (attr in associatedData) {
                if (associatedData.hasOwnProperty(attr)) {
                    // This would be better done in collectData, however
                    // we only need to copy the data object if we have any associations,
                    // so we optimize it by only copying if we must.
                    // We do this so we don't mutate the underlying record.data
                    if (!hasCopied) {
                        data = Ext.Object.chain(data);
                        hasCopied = true;
                    }
                    data[attr] = associatedData[attr];
                }
            }
			//TECH-34101
			if (me && me.currentDataView) {
				//TECH-36481
				var fileExtn = record.data.v1.substring(record.data.v1.lastIndexOf('.') + 1),
					imgExtn = ["jpg", "jpeg", "gif", "png", "tiff"],
					wordExtn = ["docx", "doc"],
					excelExtn = ["xls", "xlsm", "xlsx"],
					pdfExtn = ["pdf"];
								
				if (wordExtn.indexOf(fileExtn) > -1) {
					record.data.fileType = "word";
				}
				else if (excelExtn.indexOf(fileExtn) > -1) {
					record.data.fileType = "excel";
				}
				else if (pdfExtn.indexOf(fileExtn) > -1) {
					record.data.fileType = "pdf";
				}
				else {
					record.data.fileType = "text";
				}
				if (me.currentDataView == "listview") {
					xTpl = me.ownerCt.tplListView;
				}
				else {
					xTpl = me.ownerCt.tplThumbView;
					//TECH-36481
					if (imgExtn.indexOf(fileExtn) > -1) {
						xTpl = me.ownerCt.tplThumbView;
					}
					else {
						xTpl = me.ownerCt.tplFileView;
					}
				}				
				
				if (xTpl && xTpl.isTemplate) {
					data["uplTemp"] = xTpl.apply(record.data);
				}				
			}
			else {
	            if (displayFields && displayFields.length > 0) {
					var ilbo = me.up('ilbo'),
						valueJson = {},
						templateID,
						fieldName,
						isHTML = RegExp.prototype.test.bind(/(<([^>]+)>)/i),
						srcTpl,
						xTpl;
	                for (; i < len; i++) {
	                    value = record.get(displayFields[i]);
	                    if (!Ext.isEmpty(value) && Ext.isString(value)){
							if(value.indexOf('{') == 0) {
								valueJson = Ext.decode(value, true);
								if (valueJson && ilbo) {
									templateID = valueJson.tplid || me.tplId;
									//xTpl = ilbo.getTemplate(templateID,templateID == me.tplId);
									srcTpl = ilbo.getTemplate(templateID,templateID == me.tplId);
									xTpl = new Ext.XTemplate(srcTpl.html);
									if (xTpl && xTpl.isTemplate) {
										if (xTpl.html.indexOf('#*#') != -1) {
											xTpl.html.replace(/\{(.*?)\}/g, function(g0, g1) {
												splittedPlaceHolder.push(g1);
											})
										} else if (xTpl.img) {
											var hView = me.up('horizontalview'),
												viewModel = ilbo.getViewModel(),
												viewData = viewModel.getData(),
												srcPath = '../document/ei',
												fileUrl = null,
												plhName = xTpl.plhName,
												assview = xTpl.assview,
												srcPath = xTpl.srcPath;
											fileUrl = Ext.String.format(viewData.fileUrl, hView.itemId, xTpl.assview, record.data.rn, xTpl.srcPath);
											valueJson[xTpl.plhName] = fileUrl;
										}
										if (splittedPlaceHolder.length > 0) {
											obj = 0;
											for (; obj < splittedPlaceHolder.length; obj++) {
												placeHolders = splittedPlaceHolder[obj];
												if (placeHolders.indexOf('#*#') != -1) {
													var hView = me.up('horizontalview'),
														plhwithType = placeHolders.split('#*#'),
														plhName = plhwithType[0],
														plhType = plhwithType[1],
														assview = plhwithType[2];
													xTpl.html = xTpl.html.replace("{" + placeHolders + "}", "{" + plhName + "}");
													switch (plhType) {
														case "img":
															var viewModel = ilbo.getViewModel(),
																viewData = viewModel.getData(),
																srcPath = '../document/ei',
																fileUrl = null;
															xTpl.img = true;
															xTpl.plhName = plhName;
															xTpl.assview = assview;
															xTpl.srcPath = srcPath;
															fileUrl = Ext.String.format(viewData.fileUrl, hView.itemId, assview, record.data.rn, srcPath);
															if (!Ext.isEmpty(assview) && hView.columns && hView.columns.length > 0) {
																for (var hc=0; hc < hView.columns.length; hc++) {
																	var curHColumn = hView.columns[hc];
																	if (curHColumn.name === assview) {
																		assColumn = curHColumn;
																		break;
																	}
																}														
																if (assColumn) {
																	srcPath = assColumn.srcPath || "";
																	saveToDb = assColumn.saveToDb || false;
																	dView = assColumn.dView;
																	mode = assColumn.mode;
																	if (saveToDb) {
																		fileUrl = Ext.String.format(viewData.dbFileUrl, hView.itemId, dView, record.data.rn, srcPath, assview, mode);
																	}
																}
															}
														}
														valueJson[plhName] = fileUrl;
														break;
												}
											}
										}
									}
									value = xTpl.apply(valueJson);
								} 
								else {
									//value = "Template not found for " + templateID;
									returnValue = [];
									for(key in valueJson){
										returnValue.push(valueJson[key]);	
									}
									value= returnValue.join(" ");
								}
								if (!data['width'])
									data['width'] = me.getSize().width - 15;
								data[displayFields[i]] = value;
							}
							else{
								templateID = value;
								if(!isHTML(value)) {
									// TECH-29453
									if (me.type == 'stackedlink' && templateID.indexOf('{') != 0) {
										data[displayFields[i]] = value;
									}
									else {
										xTpl = ilbo.getTemplate(templateID,templateID == me.tplId);
										if (xTpl && xTpl.isTemplate) {
											data[displayFields[i]] = xTpl.apply(me.setPref(record.data));										
										}
									}
									if (!data['width'])
										data['width'] = me.getSize().width - 15;
								}
							}
	                    }
	                }
	            }
	        }
		}	
        return data;
    },
	setPref: function(value) {
        var me = this,
            val = null,
            decSep, digGrp,
            dataType = null,
            format = null,
            num,
			returnVal = {}, 
			replaceVal = '',
			dateVal,
			format,
			field,
            fields = me.ownerCt.columnsValue;
        for (var itm in fields) {
            field = fields[itm];
			val = value[itm];
			replaceVal = itm.replace('v', '');
            returnVal[replaceVal] = val;
            switch (field.dt) {
                case "date":
                    format = RamcoRTC.userPreference.dateFormat;
					//dateVal = Ext.Date.parse(val + ' 00:00:00',  "Y-m-d H:i:s");
					dateVal = Ext.Date.parse(val,  "Y-m-d");//datechange
					returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
					break;
                case "date-time":
                    format = RamcoRTC.userPreference.dateTimeFormat;
					dateVal = Ext.Date.parse(val, "Y-m-d H:i:s");
                    returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
                    break;
                case "time":
                    format = RamcoRTC.userPreference.timeFormat;                    
					dateVal = Ext.Date.parse('1900-01-01 ' + val, "Y-m-d H:i:s");
					returnVal[replaceVal] = Ext.util.Format.date(dateVal, format);
                    break;
                case "float":
                case "double":
                case "numeric":
                case "int":
                case "integer":
                case "long":
                    returnVal[replaceVal] = me.formatNumeric(val, field.prec);
                    break;
				default:
                    returnVal[replaceVal] = val;
                    break;
            }
        }
        return returnVal;
    },
	formatNumeric: function(value, dataType) {
		if(Ext.isEmpty(value))
			return "";			
        var tempNum = '999999999999999999',
			n1, n2, num, num1,num2;
        dataType = dataType ? parseInt(dataType, 10) : 0;
        if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "no grouping") {
            format = '9.' + tempNum.substring(0, dataType)
        } else {
            format = '9,9.' + tempNum.substring(0, dataType)
        }
        Ext.util.Format.thousandSeparator = RamcoRTC.userPreference.numgroupsymbol;
        Ext.util.Format.decimalSeparator = RamcoRTC.userPreference.decimalseparator;
		 var numGroupStyle = RamcoRTC.userPreference.numgroupstyle.toLowerCase();
		if (!Ext.isEmpty(numGroupStyle) && numGroupStyle != 'no grouping') {//TECH-33327
			num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
			if (numGroupStyle == "lakh based")
				n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			else if (numGroupStyle == "million based")
				n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			
			num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
		}else{
			if (dataType == null || dataType == 0){
				num = Ext.util.Format.number(value, "0");
			}
			else{
				num = Ext.util.Format.number(value, format);
			}
		}
        /* if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "lakh based") {
            num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
            n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        }else if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "million based") {//TECH-33327
         	num2 = (value) ? parseFloat(value) : 0;
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
	       // n1 = n1[0].replace(/(?<!\.)(\d)(?=(\d{3})+(\.|$))/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
	        n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        } else {
			if (dataType == null || dataType == 0)
				num = Ext.util.Format.number(value, "0");
			else
				num = Ext.util.Format.number(value, format);
        } */
        var neg = false;
		if(Ext.isNumber(num))//TECH-33327
			num = num.toString();
        if (num.indexOf('-') != -1)
            neg = true;
        if (neg) {
            var numNegStyle = RamcoRTC.userPreference.numnegativestle;
            switch (numNegStyle) {
                case "(1.1)":
                    num = "(" + num.replace("-", "") + ")";
                    break;

                case "- 1.1":
                    num = num.replace("-", "- ");
                    break;

                case "1.1-":
                    num = num.replace("-", "") + "-";
                    break;

                case "1.1 -":
                    num = num.replace("-", "") + " -";
                    break;

                case "()1.1":
                    num = "()" + num.replace("-", "");
                    break;

                case "(-)1.1":
                    num = "(-)" + num.replace("-", "");
                    break;
                default:
                    num = "-" + num.replace("-", "");
                    break;
            }
        }
        return num;
    },
    processItemEvent: function(record, item, rowIndex, e) {
        var me = this,
            self = me.self,
			store = me.store.data.items.length > 0 ? me.store.data.items:'',
            map = self.EventMap,
			rn = (record && record.data)?record.data.rn:'',
			qtipValue = null,
			displayFields = me.getDisplayFields(),
            type = e.type;
			for(i = 0 ; i<displayFields.length;i++){
			// AHBG-24256
			// qtipValue = !Ext.isEmpty(store)?store[rn-1].data[displayFields[i]+'-stp']:'';
				qtipValue = !Ext.isEmpty(store)?store[rowIndex].data[displayFields[i]+'-stp']:'';
				if(!Ext.isEmpty(qtipValue) && !item.hasAttribute('data-qtip')){
					item.setAttribute('data-qtip',qtipValue);
				}	
			}
        if (Ext.isIE && type === 'mouseup' && !e.within(me.el)) {
            return false;
        }
        me.fireEvent('uievent', type, me, record, item, rowIndex, e);
    },
    beforeDestroy: function() {
        var me = this;
        if (me.type == 'stackedlink') {
            if (me.animFrame)
                me.animFrame.end();
            else if (me.slide) {
                me.slide.stopAuto();
				Ext.destroy(me.slide);
				me.slide = null;
				delete me.slide;				
			}
        }
        return me.callParent(arguments);
    },
	// AHBG-24719
	onContainerClick: function(e) {
		return false;
	},
});
// Slide Show
Ext.Slideshow = function(divArray) {

    // Persist the div array.
    this.divArray = divArray;

    this.navArray = [];

    // Internal vars
    this.numSlides = this.divArray.length;

    this.current = 0;

    if (this.current >= this.numSlides) {
        this.current = this.numSlides - 1;
    }

    this.last = false;
    this.interval = false;
};

Ext.apply(Ext.Slideshow.prototype, {

    // Initialisation method.
    init: function(options, ctrl) {
        this.ctrl = ctrl;
        this.options = options;
        this.time = parseInt(options.speed, 10) + 1000;
        this.gotoSlide(this.current);
        this.auto();
    },

    // This is a "toy" version of "bind".
    bind: function(object, method) {
        return function() {
            method.call(object);
        };
    },

    // Set up automatic slideshow.
    auto: function(time) {
        this.interval = window.setInterval(this.bind(this, this.next), this.time);
    },

    // Stop automatic slideshow.
    stopAuto: function() {
        if (this.interval) {
            window.clearInterval(this.interval);
            this.interval = false;
        }
    },

    // navigation Click
    onNavClick: function(tool, e) {
        if (tool.hasCls('x-active-item'))
            return;
        else {
            this.gotoSlide(tool.index);
        }
    },

    // Go to next slide.
    next: function() {
        this.gotoSlide(this.current + 1);
    },

    // Go to specific slide.            
    gotoSlide: function(index) {
        var oldSlide, newSlide, oldTool, newTool, dir;


        var div = Ext.query('.x-list-item-cell', false, this.ctrl.el);
        this.divArray = div;

        if (index < 0) {
            index = this.numSlides - 1;
        }

        if (index >= this.numSlides) {
            index = 0;
        }

        if (index === this.current) {
            return;
        }

        // get slide elements
        oldSlide = this.divArray[this.current];
        newSlide = this.divArray[index];

        oldTool = this.navArray[this.current];
        newTool = this.navArray[index];

        dir = (this.direction == 'right') ? 'r' : 'l';

        oldSlide.slideOut(dir, {
            duration: 500,
            useDisplay: true,
            scope: this
        });
        if (oldTool)
            oldTool.removeCls('x-active-item');

        newSlide.fadeIn({
            easing: 'easeIn',
            duration: 500
        });
        if (newTool)
            newTool.addCls('x-active-item');

        this.last = this.current;
        this.current = index;
    }
});

//Radio Group
Ext.define('Ext.ramco.RadioGroup', {
    extend: 'Ext.form.RadioGroup',
    xtype: 'ramcoradio',
	initComponent:function(){
		var me =this,
			vLen = me.visibleLength;
		if (!Ext.isEmpty(vLen) && vLen != 0)
			me.setWidth(vLen * 12);
		if(me.items && me.items.length>0){
			for(var i=0;i<me.items.length;i++){
				me.items[i].role ="uipage";
			}
		}
		me.callParent();
    }, 
    setValue: function(value) {
		// TECH-27651
        var me = this,
            data = {},
            itemId = me.getItemId(),
			items = (me.items && me.items.length > 0) ? me.items.items : null,
			i = 0, curItem;
		
		if (Ext.isEmpty(value) && !Ext.isEmpty(items)) {
			for (; i < items.length; i++) {
				curItem = items[i];
				if (curItem){
					curItem.suspendEvents();
					curItem.setValue(false);
					curItem.resumeEvents();
				}
			}
			// TECH-27824
			me.lastValue = "";
		}		
        data[itemId] = value;
        arguments[0] = data;
        return me.callParent(arguments);
    }

});

// Carousel Panel
Ext.define('Ext.ramco.SliderPanel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.ramcosliderpanel',
    userCls: Ext.baseCSSPrefix + 'ramcosliderpanel',
    bodyPadding: '10 0 10 0',
    currentIndex: 1,
    /*layout: {
        type: "hbox",
        align: "stretch"
    },*/
	layout: 'fit',
    config: {
        styleHtmlContent: true,
        itemWidth: 400,
        itemHeight: 410
    },
    defaults: {
        border: true,
        scrollable: true,
        itemType: 'ramcoslider-child',
        userCls: Ext.baseCSSPrefix + 'ramcoslider-child',
        margin: '0 10 0 0',
        bodyPadding: '0 5',
        width: 400,
        height: 410
    },
    dockedItems: [{
        dock: 'left',
        xtype: 'toolbar',
        itemId: 'leftSlider',
        items: [
            '->', {
                xtype: 'button',
                itemId: 'slideprev',
                iconCls: 'x-fa fa-caret-left'
            },
            '->'
        ]
    }, {
        dock: 'right',
        xtype: 'toolbar',
        itemId: 'rightSlider',
        items: [
            '->', {
                xtype: 'button',
                itemId: 'slidenext',
                iconCls: 'x-fa fa-caret-right'
            },
            '->'
        ]
    }],
    initComponent: function() {
        var me = this,
            itemHeight = me.getItemHeight(),
            itemWidth = me.getItemWidth();
        me.defaults.height = itemHeight;
        me.defaults.width = itemWidth;
        var i = 0,
            count = 0,
            len = me.items.length;			
        for (; i < len; i++) {
            itm = me.items[i];
			itm.parentId = me.itemId;
			if((itm.layout.type == "ramcotable" || itm.layout.type == "table" ) && itm.layout.tableAttrs && itm.layout.tableAttrs.style)
				itm.layout.tableAttrs.style["table-layout"] ="fixed";
			itm.style = {"float":"left"};
            itm.isSlider = true;
			//itm.hidden=true;
        }
		/*me.plugins = [{
			ptype: 'lazyitems',
			items: me.items
		}];
		me.items=null;
		delete me.items;*/
        me.callParent();
        var slidePrev = me.down('#slideprev'),
            slideNext = me.down('#slidenext');
        me.slidePrev = slidePrev;
        me.slideNext = slideNext;
		if(RamcoRTC.ldir && RamcoRTC.ldir == "rtl"){
			me.slideNext.setIconCls('x-fa fa-caret-left'); 
			me.slidePrev.setIconCls('x-fa fa-caret-right');
		}
        me.mon(slidePrev, {
            click: me.showPrev,
            scope: me
        });
        me.mon(slideNext, {
            click: me.showNext,
            scope: me
        });
        me.setHeight(itemHeight + 20);
    },
	/*isLayoutRoot:function(){
		return true;
	},*/
    onBoxReady: function() {
        var me = this,
            itemWidth = me.getItemWidth(),
            i = 0,
			cnt = 0,
            length =  me.items.length,
            width = me.body.getWidth();
        me.callParent();
        if (Ext.isString(itemWidth)) {
            if (itemWidth.indexOf('%') > 0)
                itemWidth = parseFloat(itemWidth.replace('%', '')) / 100 * width;
            else if (itemWidth.toLowerCase().indexOf('px') > 0)
                itemWidth = parseFloat(itemWidth.replace('%', ''));
        }
        count = parseInt(width / itemWidth);
        itemWidth = itemWidth + ((width - ((count * 10) + (count * itemWidth))) / count);
        me.targetEl = me.body.down("div[data-ref=targetEl]");
        me.setItemWidth(itemWidth);
        me.defaults.width = itemWidth;
		i =0;
		me.suspendLayouts();
		for (; i < length; i++) {
			itm = me.items.getAt(i);			

			itm.setWidth(itemWidth);

			if(cnt == 0)
				me.startIndex = cnt;
			if(!itm.hidden)
				cnt++			
			if(cnt <= count)
				me.endIndex = i;
        }
		
		me.resumeLayouts();
        me.showCurrentItem();
    },
	addRemains: function() {
        var me = this;
        return new Ext.Promise(function(resolve, reject) {
           var itmLen = me.allItems.length,
			   i = me.endIndex;
		   for (; i < itmLen; i++) {
				itm = me.allItems[i];			
				me.allItems[i] = me.add(me.allItems[i]);
		   }
		   resolve();
        });
    },
    getVisibleCount: function() {
        var me = this,
            i = 0,
            count = 0,
            len = me.items.length;
			//len = me.allItems.length;
        for (; i < len; i++) {
            itm = me.items.getAt(i);
			//itm = me.allItems[i];
            if (!itm.hidden)
                count++;
        }
        return count;
    },
    showPrev: function() {
        var me = this,
            visibleCount = me.getVisibleCount(),
            count = 0,
            itemWidth = me.getItemWidth(),
            width = me.body.getWidth();
        count = parseInt(width / itemWidth);
        if (visibleCount - count > 0)
            me.currentIndex--;
        if (me.currentIndex <= 1) {
            me.slidePrev.disable();
        } else {
            me.slidePrev.enable();
        }
        me.slideNext.enable();
        me.lastPos = me.lastPos - parseFloat((itemWidth + 10) * count);
        if (me.lastPos < 0)
            me.lastPos = 0;
		if(RamcoRTC.ldir && RamcoRTC.ldir == "rtl"){
			me.targetEl.animate({
				duration: 500,
				to: {
					right: -me.lastPos
				}
			});
		}
		else{
        me.targetEl.animate({
            duration: 500,
            to: {
                left: -me.lastPos
            }
        });
		}
    },
    showNext: function() {
        var me = this,
            visibleCount = me.getVisibleCount(),
            count = cnt = 0,
            itemWidth = me.getItemWidth(),
            width = me.body.getWidth();
        count = parseInt(width / itemWidth);
        if (visibleCount - (me.currentIndex * count) > 0)
            me.currentIndex++;
        me.slideNext.enable();
        if ((visibleCount - me.currentIndex * count) <= 0) {
            me.slideNext.disable();
        }
        me.slidePrev.enable();
        me.lastPos = me.lastPos + parseFloat((itemWidth + 10) * count);
		if(RamcoRTC.ldir && RamcoRTC.ldir == "rtl"){
			me.targetEl.animate({
				duration: 500,
				to: {
					right: -me.lastPos
				}
			});
		}
		else{
	        me.targetEl.animate({
	            duration: 500,
	            to: {
	                left: -me.lastPos
	            }
	        });
		}
    },
    showCurrentItem: function() {
        var me = this,
            i = 0,
            count = 0,
            totalItem = 0,
            visibleCount = me.getVisibleCount(),
            itm = null,
            cnt = null,
            length = me.items.length,
            itemWidth = me.getItemWidth(),
            width = me.body.getWidth();
        count = parseInt(width / itemWidth);
        me.currentIndex = 1;
        me.slidePrev.disable();
        if ((visibleCount - count) > 0) {
            me.slideNext.enable();
        } else {
            //me.slideNext.enable();
			me.slideNext.disable();
        }
        if (me.lastPos != 0) {
            me.lastPos = 0;
            me.targetEl.animate({
                duration: 500,
                to: {
                    left: -me.lastPos
                }
            });
        }
        me.lastPos = 0;
    },
    processState: function(childs) {
        var me = this,
            itm,
            i = 0,
			curCmp = null,
            len = Ext.isArray(childs) ? childs.length : 0;
        if (len > 0) {
			me.suspendLayouts();
            for (; i < len; i++) {
                itm = childs[i];                
				curCmp = me.getComponent(itm.id);
                if (curCmp && itm.visible) {
					curCmp.suspendLayouts();
					curCmp.suspendLayout = true;
					if(curCmp.isHidden()) {
						if(itm.visible == 'y')
							curCmp.show();
					}
					else { 
						if(itm.visible == 'n') 
							curCmp.hide();
					}
					curCmp.suspendLayout = false;
					curCmp.resumeLayouts();
                }
            }
			me.resumeLayouts();
			if(me.rendered)
				me.showCurrentItem();
        }
    },
    hideChilds: function(childs) {
        var me = this,
            i = 0,
            cPanelName = '',
            itm,
            cPanels = childs ? childs.split(',') : [],
            length = cPanels.length;
        if (length > 0) {
            for (; i < length; i++) {
                cPanelName = cPanels[i].toLowerCase().replace('span_section_[mainscreen]_', '');
                itm = me.getComponent(cPanelName);
                if (itm) {
                    itm.slideHide = false;
                    itm.hide();
                }
            }
        }
        me.showCurrentItem();
    }
});

Ext.define('Ext.Ramco.TreeModel', {
    extend: 'Ext.selection.TreeModel',
	alias: 'selection.ramcotreemodel',
	onNavigate: function(e) {
        // Enforce the ignoreRightMouseSelection setting. 
        // Enforce presence of a record. 
        // Enforce selection upon click, not mousedown. 
        if (!e.record || this.vetoSelection(e.keyEvent)) {
            return;
        }
 
        this.onBeforeNavigate(e);
 
        var me = this,
            keyEvent = e.keyEvent,
            // ctrlKey may be set on the event if we want to treat it like a ctrlKey so 
            // we don't mutate the original event object 
            ctrlKey = keyEvent.ctrlKey || e.ctrlKey,
            recIdx = e.recordIndex,
            record = e.record,
            lastFocused = e.previousRecord,
            isSelected = me.isSelected(record),
            from = (me.selectionStart && me.isSelected(e.previousRecord)) ? me.selectionStart : (me.selectionStart = e.previousRecord),
            fromIdx = e.previousRecordIndex,
            key = keyEvent.getCharCode(),
            isSpace = key === keyEvent.SPACE,
            changedRec = e.record !== e.previousRecord,
            direction = key === keyEvent.UP || key === keyEvent.PAGE_UP || key === keyEvent.HOME || (key === keyEvent.LEFT && changedRec) ? 'up' : (key === keyEvent.DOWN || key === keyEvent.PAGE_DOWN || key === keyEvent.END || (key === keyEvent.RIGHT && changedRec) ? 'down' : null);
			var grid = me.view.ownerGrid,
				segTrbtn = grid.getSegTreeBtnGroup(),
				segTrBtnVal = segTrbtn.value,
				pNode,
				node,
				chNode,
				curNode,
				chlen, 
				c = 0,
				s = 0,
				selectedItems,
				selectedCnt,
				curItem,
				selModel = null,
				treeStore = null,
				checked,
				cellDown = null,
				showToolbar = false;
		if (typeof grid.validDrop != "undefined") {
			delete grid.validDrop;
			return;
		}
		showToolbar = grid.getShowToolbar();
		//TECH-38081
		//if (showToolbar === false)
			//return;
		if(segTrBtnVal == 1 || segTrBtnVal == 3) {
			node = grid.store.getNodeById(record.data.id);
			record = node.firstChild;
		}
		if (record.get('sel') === false)
			checked = true;
		else
			checked = false;
		if (Ext.isEmpty(segTrBtnVal)) {									
			if (grid) {
				treeStore = grid.getStore();
				selModel = grid.getSelectionModel();								
			}
			/*if (treeStore) {
			   selModel.deselectAll();
			   Ext.Object.eachValue(treeStore.byIdMap, function(node) {
					if (node) {
						node.set('sel', 'false');		
						node.set('keyDown', false);
					}
				});
			}*/
			pNode = node = grid.store.getNodeById(record.data.id);				
			cellDown = pNode.get('cellDown') || false;
			
			if (e.column.dataIndex == "sel") {
				pNode.set('sel', checked);
			}
			if(cellDown) {
				me.doSelect(pNode, true, true);
				pNode.set('cellDown', false);
			}
			else  {
				me.deselect(pNode, true);							
				pNode.set('cellDown', true);
			}
			if (e.column && e.column.xtype != "ramcogridcheck")
				return;
		}
        switch (me.selectionMode) {
            case 'MULTI':
                me.setSelectionStart(e.selectionStart);
 
                if (key === keyEvent.A && ctrlKey) {
                    // Listening to endUpdate on the Collection will be more efficient 
                    me.selected.beginUpdate();
                    me.selectRange(0, me.store.getCount() - 1);
                    me.selected.endUpdate();
                }
				else if (ctrlKey) {					
					if(!Ext.isEmpty(segTrBtnVal))
					{
						if(segTrBtnVal == 1 || segTrBtnVal == 3) {
							record = record.parentNode;
						}
						pNode = node = grid.store.getNodeById(record.data.id);				
						if(segTrBtnVal != 0) {
							node = grid.store.getNodeById(record.data.id);
							chlen = node.childNodes.length;
							for(; c < chlen; c++) {
								chNode = node.childNodes[c];
								curNode = node
								if(segTrBtnVal == 1 || segTrBtnVal == 3) 
									curNode = chNode;								
							}
							node.eachChild(function(n) {
								n.parentNode.cascadeBy(
									function(n)
									{									
										n.set('sel', checked);
										if (checked)
											me.doSelect(n, true, true);
										else
											me.deselect(n, true);
										if (checked === false)
											n.set('keyDown', false);										
									}
								);
							});
						}
						if(segTrBtnVal == 1 || segTrBtnVal == 3) {
							pNode.set('sel', 'false');
							me.deselect(pNode, true);
						}
						else if (segTrBtnVal == 0 || segTrBtnVal == 2 || segTrBtnVal == 4) {
							pNode.set('sel', checked);							
							if(checked)
								me.doSelect(pNode, true, true);							
							else  {
								me.deselect(pNode, true);
								pNode.set('keyDown', false);
							}
						}
					}
                }
                else if (isSpace) {
                    // SHIFT+SPACE, select range 
                    if (keyEvent.shiftKey) {
                        me.selectRange(from, record, ctrlKey);
                    } else {						
						if(!Ext.isEmpty(segTrBtnVal))
						{
							if(segTrBtnVal == 1 || segTrBtnVal == 3) {
								record = record.parentNode;
							}
							pNode = node = grid.store.getNodeById(record.data.id);				
							if(segTrBtnVal != 0) {
								node = grid.store.getNodeById(record.data.id);
								chlen = node.childNodes.length;
								for(; c < chlen; c++) {
									chNode = node.childNodes[c];
									curNode = node
									if(segTrBtnVal == 1 || segTrBtnVal == 3) 
										curNode = chNode;								
								}
								node.eachChild(function(n) {
									n.parentNode.cascadeBy(
										function(n)
										{									
											n.set('sel', checked);
											if (checked)
												me.doSelect(n, true, true);
											else
												me.deselect(n, true);
											if (checked === false)
												n.set('keyDown', false);										
										}
									);
								});
							}
							if(segTrBtnVal == 1 || segTrBtnVal == 3) {
								pNode.set('sel', 'false');
								me.deselect(pNode, true);
							}
							else if (segTrBtnVal == 0 || segTrBtnVal == 2 || segTrBtnVal == 4) {
								pNode.set('sel', checked);							
								if(checked)
									me.doSelect(pNode, true, true);							
								else  {
									me.deselect(pNode, true);
									pNode.set('keyDown', false);
								}
							}
						}
                        /*// SPACE pressed on a selected item: deselect. 
                        if (isSelected) {
                            if (me.allowDeselect) {
                                me.doDeselect(record);
                            }
                        }
                        // SPACE on an unselected item: select it 
                        // keyEvent.ctrlKey means "keep existing" 
                        else {
                            me.doSelect(record, ctrlKey);
                        }*/
                    }
                }
 
                // SHIFT-navigate selects intervening rows from the last selected (or last focused) item and target item 
                else if (keyEvent.shiftKey && from) {
 
                    // If we are heading back TOWARDS the start rec - deselect skipped range... 
                    if (direction === 'up' && fromIdx <= recIdx) {
                        me.deselectRange(lastFocused, recIdx + 1);
                    }
                    else if (direction === 'down' && fromIdx >= recIdx) {
                        me.deselectRange(lastFocused, recIdx - 1);
                    }
 
                    // If we are heading AWAY from start point, or no CTRL key, so just select the range and let the CTRL control "keepExisting"... 
                    else if (from !== record) {
                        me.selectRange(from, record, ctrlKey);
                    }
                    me.lastSelected = record;
                }
 
                else if (key) {
					if (key != 40 && key != 39 && key != 38 && key != 37) {
						if (!ctrlKey) {
							me.doSelect(record, false);
						}
					}
                } 
				else {
					selectedItems = me.getSelected();
					selectedCnt = selectedItems.length;
					if(!Ext.isEmpty(segTrBtnVal)) {
						for (s =0; s < selectedCnt; s++) {
							curItem = selectedItems.getAt(s);
							curItem.set('sel', false);						
							curItem.set('keyDown', false);											
						}
						me.deselectAll();
					}
					if(!Ext.isEmpty(segTrBtnVal) && checked === true)
					{
						if(segTrBtnVal == 1 || segTrBtnVal == 3) {
							record = record.parentNode;
						}
						pNode = node = grid.store.getNodeById(record.data.id);				
						if(segTrBtnVal != 0) {
							node = grid.store.getNodeById(record.data.id);
							chlen = node.childNodes.length;
							/*for(; c < chlen; c++) {
								chNode = node.childNodes[c];
								curNode = node
								if(segTrBtnVal == 1 || segTrBtnVal == 3) 
									curNode = chNode;								
							}*/
							node.eachChild(function(n) {
								n.parentNode.cascadeBy(
									function(n)
									{									
										n.set('sel', checked);
										if (checked)
											me.doSelect(n, true, true);
										else {
											me.deselect(n, true);
											n.set('keyDown', false);
										}										
									}
								);
							});
						}
						if(segTrBtnVal == 1 || segTrBtnVal == 3) {
							pNode.set('sel', 'false');
							me.deselect(pNode, true);
						}
						else if (segTrBtnVal == 0 || segTrBtnVal == 2 || segTrBtnVal == 4) {
							pNode.set('sel', checked);							
							if(checked)
								me.doSelect(pNode, true, true);							
							else  {
								me.deselect(pNode, true);
								pNode.set('keyDown', false);
							}
						}
					}                    
					else if(checked === true)
					{						
						pNode = node = grid.store.getNodeById(record.data.id);						
						pNode.set('sel', checked);							
						if(checked)
							me.doSelect(pNode, true, true);
						else  {
							me.deselect(pNode, true);							
						}
					}
                }
                break;
            case 'SIMPLE':
                if (key === keyEvent.A && ctrlKey) {
                    // Listening to endUpdate on the Collection will be more efficient 
                    me.selected.beginUpdate();
                    me.selectRange(0, me.store.getCount() - 1);
                    me.selected.endUpdate();
                } else if (isSelected) {
                    me.doDeselect(record);
                } else {
                    me.doSelect(record, true);
                }
                break;
            case 'SINGLE':
                // CTRL-navigation does not select 
                if (!ctrlKey) {
                    // Arrow movement 
                    if (direction) {
                        me.doSelect(record, false);
                    }
                    // Space or click 
                    else if (isSpace || !key) {
                        me.selectWithEvent(record, keyEvent);
                    }
                }
        }
 
        // selectionStart is a start point for shift/mousedown to create a range from. 
        // If the mousedowned record was not already selected, then it becomes the 
        // start of any range created from now on. 
        // If we drop to no records selected, then there is no range start any more. 
        if (!keyEvent.shiftKey && !me.destroyed && me.isSelected(record)) {
            me.selectionStart = record;
            me.selectionStartIdx = recIdx;
        }
    }
});

Ext.define('Ext.ramco.tree.Column', {
    extend: 'Ext.tree.Column',	
    alias: 'widget.ramcotreecolumn', 
	config: {		
        dataType: 'string',
        mandatory: false,
        format: null,
        maxLength: 10,
        tooltip: null,
        titleAlign: 'left',
		hasTemplate: false,
		allowWrap: false
	},
	initComponent: function() {		
         var me = this,
			grid = null; //TECH-32778
		me.callParent();
		if (!me.rendererScope) {
            me.rendererScope = me.scope;
        }
		//TECH-32778
		grid = me.up('tablepanel');
		if (grid && grid.columnLines === false)
            me.addCls(Ext.baseCSSPrefix + 'column-header-noborder');
	},
	beforeRender: function() {
        var me = this,
            editor = me.editor,
            value = '',
            width,
            grid = me.up('ramcogrid'),
            len = me.visibleLength || 10;
        grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));
        if (!me.visibleLength)
            width = me.width;
        if (!width)
            width = len * ((RamcoRTC.settings.isExt2 == true) ? 12 : 11); // TECH-35619 / TECH-35707
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}		
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
        if (grid.rowHeight)
            me.cstStyle = 'height:' + grid.rowHeight + 'px;';

        if (me.forceFit || grid.columnFit)
            width = len;

        if (editor && (editor.xtype == 'combo' || editor.xtype == 'datefield' || editor.xtype == 'ramcodatetimefield' || editor.xtype == 'ramcotimefield'))
            width += 25;
        else if (RamcoRTC.settings.isExt2 != true && !me.forceFit && !grid.columnFit) // TECH-35619 / TECH-35707
            width += 10;
        if (me.dataIndex == 'rn' || me.dataIndex == 'sel')
            width = 40;
       
		if (me.helpIcon) {
			if (me.forceFit || grid.columnFit)
				width += 2;
			else
				width += 20;
		}
		if (me.mandatory){
			if (me.forceFit || grid.columnFit)
				width += 1;
			else 
				width += 4;
		}

        me.setWidth(width);
        me.callParent();
    },
	defaultRenderer: function(value, metaData, record, rowIdx, colIdx, dataSource, view) {
        var me = this,
            xTpl = null,
			key,
			returnValue = value,
            tmpTpl = me.tpl,
			hasTempalte = me.getHasTemplate(),
			dataType = me.getDataType(),
            format = me.getFormat(),            
            qtip = '', 
			colCls = '',
            editor = me.editor,
			sm = null,
			grid = null,
			dataqTip,
			dateCls,
			style,
			cellId;
		grid = me.up('ramcogrid');
		grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}	
		cellId = grid.itemId + "_cell_col" + me.dataIndex + "_row" + record.get("rn");
		
		/* TECH-39807 For help icon in header to be static upon hover*/
		if(RamcoRTC.settings.isExt2 == true && me.helpIcon && me.titleEl)
		{
		    me.titleEl.addCls("x-column-header-helpIcon")
		}
		
        if (!Ext.isEmpty(value) && Ext.isString(value) && value.indexOf('{') == 0) {
            var ilbo = me.up('ilbo'),
                splittedPlaceHolder = [],
                valueJson = Ext.decode(value, true),
                templateID;
            if (valueJson && ilbo) {
                templateID = valueJson.tplid || me.tplId;
                xTpl = ilbo.getTemplate(templateID,templateID==me.tplId);
            }
			
			var qTip, qTipObj, qTipTpl, qTipVal;
			if (metaData && metaData.column.dataIndex != "rn" && metaData.column.dataIndex != "sel") {
				qTipObj = record.data[metaData.column.dataIndex + "-stp"];
				if(!Ext.isEmpty(qTipObj)) {
					if (qTipObj.indexOf('{') < 0) {
						qTipTpl = 'inline';
						qTipVal = qTipObj;
					}
					else {
						qTipTpl = Ext.decode(qTipObj, true) || {};
						templateID = qTipTpl.tplid;
						if (qTipTpl && templateID) {
							qTip = ilbo.getTemplate(templateID,true);
							if (qTip)
								qTipVal = qTip.apply(qTipTpl);
						}
					}
				}
            }
            if (xTpl && xTpl.isTemplate) {
                if (xTpl.html.indexOf('#*#') != -1) {
                    xTpl.html.replace(/\{(.*?)\}/g, function(g0, g1) {
                        splittedPlaceHolder.push(g1);
                    })
                } else if (xTpl.img) {
                    var gView = me.up('ramcogrid'),
                        viewModel = ilbo.getViewModel(),
                        viewData = viewModel.getData(),
                        srcPath = '../document/ei',
                        fileUrl = null,
                        plhName = xTpl.plhName,
                        assview = xTpl.assview,
                        srcPath = xTpl.srcPath;
                    fileUrl = Ext.String.format(viewData.fileUrl, gView.itemId, xTpl.assview, record.data.rn, xTpl.srcPath);
                    valueJson[xTpl.plhName] = fileUrl;
                }
                if (splittedPlaceHolder.length > 0) {
                    obj = 0;
                    for (; obj < splittedPlaceHolder.length; obj++) {
                        placeHolders = splittedPlaceHolder[obj];
                        if (placeHolders.indexOf('#*#') != -1) {
                            var gView = me.up('ramcogrid'),
                                plhwithType = placeHolders.split('#*#'),
                                plhName = plhwithType[0],
                                plhType = plhwithType[1],
                                assview = plhwithType[2];
                            xTpl.html = xTpl.html.replace("{" + placeHolders + "}", "{" + plhName + "}");
                            switch (plhType) {
                                case "img":
                                    var viewModel = ilbo.getViewModel(),
                                        viewData = viewModel.getData(),
                                        srcPath = '../document/ei',
                                        fileUrl = null;
                                    xTpl.img = true;
                                    xTpl.plhName = plhName;
                                    xTpl.assview = assview;
                                    xTpl.srcPath = srcPath;
                                    fileUrl = Ext.String.format(viewData.fileUrl, gView.itemId, assview, record.data.rn, srcPath);
                                    valueJson[plhName] = fileUrl;
                                    break;
                            }
                        }
                    }
                }
				if (!Ext.isEmpty(qTipVal)) {
					var retVal = xTpl.apply(valueJson),
						noBorder = false; // Should comprise on user's request
					if (qTipTpl != 'inline') {
						qTipVal = Ext.util.Format.htmlEncode(qTipVal)
					}
					if (noBorder)
						return '<div id="'+ cellId +'" data-qtip="' +  qTipVal + '" data-qclass="x-tip-noborder">' + retVal + '</div>';
					else
						return '<div id="'+ cellId +'" data-qtip="' +  qTipVal + '">' + retVal + '</div>';
				}
				else
					return xTpl.apply(valueJson);
            } else {
                returnValue = [];
				for(key in valueJson){
					returnValue.push(valueJson[key]);	
				}
				return returnValue.join(" ");
            }
        } 
		else if (tmpTpl) {
			return tmpTpl.apply(record.data);            
        }
		else if (hasTempalte == true) {
			try {
				var ilbo = me.up('ilbo'),xTpl;
				xTpl = ilbo.getTemplate(value,true);
				if (xTpl && xTpl.isTemplate) {
					var splittedPlaceHolder = [],
					valueJson = Ext.decode(value, true),
					templateID, 
					tempArr = {}, tempStr, col, dataType, dataIndex, dataVal, assTpl = [];
					tempStr = xTpl.html;
					tempStr.replace(/\{(.*?)\}/g, function(g0,g1){splittedPlaceHolder.push(g1);});
					
					for (var k = 0; grid && k < splittedPlaceHolder.length; k++) {
						dataIndex = 'v' + splittedPlaceHolder[k];
						col = grid.getColumnById(dataIndex);
						
						if (!dataIndex || !col)
							continue;
						
						dataType = col.dataType;
						dataVal = record.data[dataIndex];
						assTpl.push({index: splittedPlaceHolder[k], dt: dataType, val: dataVal, col: col});
						
						switch (dataType && dataType.toLowerCase()) {
							case "date":
								format = RamcoRTC.userPreference.dateFormat;
								if (new Date(dataVal) != 'Invalid Date')
									dataVal = Ext.util.Format.date(dataVal, format);
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
							case "date-time":
								format = RamcoRTC.userPreference.dateTimeFormat;
								dataVal = Ext.util.Format.date(dataVal, format);
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
							case "time":
								format = RamcoRTC.userPreference.timeFormat;
								dataVal = Ext.util.Format.date('1900-01-01 ' + dataVal, format);
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
							case "float":
							case "double":
							case "numeric":
							case "int":
							case "integer":
							case "long":
								format = col.getFormat();
								dataVal = col.formatNumeric(dataVal, format);
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
							default:
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
						}					
					}
					me.assTpl = assTpl;
					return xTpl.apply(tempArr);
				}
				else {
		            if (me.task) {
		                if (Ext.isEmpty(value)) {
		                    me['removeCls'](Ext.baseCSSPrefix + 'column-ramcolink');
		                } else {
		                    me['addCls'](Ext.baseCSSPrefix + 'column-ramcolink');
		                }
		            }
					return value;
				}				
			}
			catch(ex) {}
        }
		else {
			if (!format) {
				if ((dataType == 'date' || me.xtype == 'datefield') && !(editor && editor.plugins)) {
					me.setFormat(RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat);
				} else if (dataType == 'date-time' || me.xtype == 'ramcodatetimefield') {
					me.setFormat(RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat);
				} else if (dataType == 'time' || me.xtype == 'ramcotimefield') {
					me.setFormat(RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat);
				}
				format = me.getFormat();
			}
			if(me.hasMasking){
				var rep,val,req,regRep,regCol,value,
					dataString = Ext.encode(record.data),
					data =  {};
				 data = Ext.decode(dataString,true);
				 regRep = me.regRep;
				 regCol = me.regCol;
				 rep = record.get(regRep);
				 val = record.get(regCol);
				 try{
					req = new RegExp(val, 'g');
				 }catch(e){
					 req = new RegExp(".", 'g');
				 }			 
				 value = data[me.dataIndex];			 
				 if(!Ext.isEmpty(record.get(me.dataCol)) && value.indexOf(rep) > 0)
					value = record.get(me.dataCol);
				 if(Ext.isEmpty(value)){
					 value = "";
				 }			 
				 if (!Ext.isEmpty(rep) && value.indexOf(rep) < 0){
					returnValue = data[me.dataIndex] = value.replace(req,rep);
					record.set(me.dataCol, value);
					record.set(me.dataIndex, returnValue);
				 }
				 else {
					returnValue = value;
					if (Ext.isEmpty(record.get(me.dataCol)))
						record.set(me.dataCol, value);
				 }
			}
			if (me.dataIndex != "rn" && me.dataIndex != "sel" && !Ext.isEmpty(grid.rsColumnsValue)) {
				if (!Ext.isEmpty(grid.rsColumnsValue[me.dataIndex]))
					sm = grid.rsColumnsValue[me.dataIndex].sm;
			}
			if (Ext.isDate(value)) {
				dateVal = value;
			}
			else {
				if ( dataType == 'date') {
					//dateVal = Ext.Date.parse(value + ' 00:00:00',  "Y-m-d H:i:s");
					dateVal = Ext.Date.parse(value,  "Y-m-d");//datechange
				}
				if (dataType == 'time') {
					dateVal = Ext.Date.parse('1900-01-01 ' + value, "Y-m-d H:i:s");
				}
				if (dataType == 'date-time') {
					dateVal = Ext.Date.parse(value, "Y-m-d H:i:s");
				}
			}
			if (Ext.isEmpty(sm) || sm.toLowerCase() === "n") {
				switch (dataType) {
					case "date":
					case "date-time":
						if (editor && editor.plugins && !RamcoRTC.settings.isNepali)
								format = 'B-Q-R';
							//returnValue = Ext.util.Format.date(value, format);
							returnValue = Ext.util.Format.date(dateVal, format);
						break;
					case "time":
							//returnValue = Ext.util.Format.date(value, format);
							returnValue = Ext.util.Format.date(dateVal, format);
						break;
					case "float":
					case "double":
					case "numeric":
					case "int":
					case "integer":
					case "long":
						returnValue = me.formatNumeric(value, format);
						break;
					default:
				}
			}
			if (metaData && metaData.column.dataIndex != "rn" && metaData.column.dataIndex != "sel") {
				qtip = record.data[metaData.column.dataIndex + "-stp"];
				colCls = record.data[metaData.column.dataIndex + "-css"];
				if (!Ext.isEmpty(colCls)){
					if(Ext.isEmpty(metaData.tdCls))
						metaData.tdCls = colCls;
					else
						metaData.tdCls += colCls;
				}
			}
			if (me.allowWrap) {
				metaData.tdCls += " x-tree-cell-wrap-text";
			}			
			qtip = Ext.isEmpty(qtip) ? returnValue : qtip;
			dataqTip = Ext.util.Format.stripTags(qtip),
			dateCls = 'x-date';
			// TECH-35584
			var style = '';
			if (editor) {
				if (Ext.isEmpty(returnValue))
					returnValue = '';				
				if (editor.xtype == 'combofield') {
					if (Ext.isEmpty(returnValue))
						returnValue = '';
					returnValue = '<div id="'+ cellId +'" class="x-combo" data-qtip="' + dataqTip + '">' + returnValue + '</div>';
				}				
				else if (editor.xtype == 'ramcolistedit') {
					if (Ext.isEmpty(returnValue))
						returnValue = '';
					returnValue = '<div id="'+ cellId +'" class="tech-list_edit-a" data-qtip="' + dataqTip + '">' + returnValue + '</div>';
				}
				else if (editor.xtype == 'datefield' || editor.xtype == 'ramcodatetimefield' || editor.xtype == 'ramcotimefield') {
					if (Ext.isEmpty(returnValue))
						returnValue = '';
					if (editor.xtype == 'ramcodatetimefield') 
						dateCls = 'tech-calendarntime-a'
					else if (editor.xtype == 'ramcotimefield') 
						dateCls = 'tech-time-a'
					returnValue = '<div id="'+ cellId +'" class='+ dateCls +' data-qtip="' + dataqTip + '">' + returnValue + '</div>';
				} 
				else if(editor.xtype == 'textareafield') {

					if (grid.rowHeight)
						style = 'height:' + grid.rowHeight + 'px;overflow: auto';
					/*if(metaData && metaData.column && metaData.column.headerWrap)
						style += ' overflow: auto';
					else
						style += ' white-space: nowrap;';
					*/
			 
					if (Ext.isEmpty(dataqTip)) {
						returnValue = '<pre id="'+ cellId +'" style="' + style + '">' + returnValue + '</pre>';
					} 
					else {						
						returnValue = formatGridColValue('pre', style, dataqTip, returnValue, null, cellId);
					}
				}
				else if(editor.xtype == 'textfield') {				
					returnValue = formatGridColValue('div', style, dataqTip, returnValue, null, cellId);
				}
				// TECH-32942
				if (editor.inputType == 'password' || editor.inputType == 'ramcopassword') {
					if (!Ext.isEmpty(value))					
						returnValue = "*****";
					else
						returnValue = "";
				}
			} 
			else {
				if (Ext.isEmpty(returnValue))
					returnValue = '';
				if (grid.rowHeight)
					style = 'height:' + grid.rowHeight + 'px;';
				/*if(metaData && metaData.column && metaData.column.headerWrap)
					style += ' overflow: auto';
				else
					style += ' white-space: nowrap;';*/
				// TECH-35584
				style += ' white-space: nowrap;';
				if (Ext.isEmpty(dataqTip)) {
					returnValue = '<pre id="'+ cellId +'" style="' + style + '">' + returnValue + '</pre>';
				} 
				else {					
					returnValue = formatGridColValue('pre', style, dataqTip, returnValue, null, cellId);
				}
			}
			return returnValue;
		}
    },
	processEvent: function(type, view, cell, recordIndex, cellIndex, e, record, row) {
        var me = this,
            ilbo = me.up('ilbo'),
			key = e.getKey(),
            ret;
		me.isTriggerClick = false;	// TECH-37897
		// TECH-32876
		if (type == 'click' && me.stateEnabled == false)
			return false; // TECH-33453
		if (me.stateEnabled == false)
			return true; // TECH-33453
        if (me.xtype == 'attachcolumn' || me.xtype == 'deletecolumn')
            return;
        if (type == 'click') {
			// TECH-37897
			try {
				me.isTriggerClick = e.getX() > ((e.target.getBoundingClientRect().x + e.target.offsetWidth) - 20);
			}
			catch(ex) {}
            if ((me.xtype == 'linkcolumn' || me.xtype == 'ramcotemplatecolumn') && Ext.isEmpty(record.get(me.dataIndex)))
                return;
            var grid = me.up('ramcogrid'),
                insertFlag = false,
                column;
            if (!grid) {
                grid = me.up('ramcotreegrid');
            }			
			if (!grid) {
				grid = me.up('ramcoddtgrid');				
			}
			if (!grid) {
				grid = me.up('ramcorstreegrid');
			}
			if (!grid) {
				grid = me.up('ramcoexpgrid');
			}
			if (grid) {
				if (Ext.isFunction(grid.getInsertFlag))
					insertFlag = grid.getInsertFlag();
            }
            //column = grid.getColumnById(cell.dataset.columnid);
            me.fireEvent('ctrlfocus', grid.itemId || grid.parentId, me.dataIndex.replace('v', ''), record.get('rn'));
			if (grid && grid.xtype == "ramcotreegrid") 
			{
				if(me.ascCtrl && ilbo){
					ilbo.setControlData(me.ascCtrl,me.ascCtrl,0, record.data.parentId + "~" + record.data.id);
				}
			}
			if (grid && grid.xtype == "ramcorstreegrid") 
			{
				var checked,
					selModel = null,
					navModel = null,
					segTrbtn = null,
					segTrBtnVal = null,
					node = null,
					pNode = null,
					chlen, 
					c = 0, 
					chRecord,
					chNode = null,
					curNode = null;
				selModel = grid.getSelectionModel();
				navModel = grid.getNavigationModel();
				segTrbtn = grid.getSegTreeBtnGroup();
				segTrBtnVal = segTrbtn.value;
				selectedRecords = selModel.getSelected();				
				selectedRecLen = selectedRecords.length;
				if (record.get('sel') === false)
					checked = true;
				else
					checked = false;
				/*if (Ext.isEmpty(record.keyDown) || record.keyDown === false){
					checked = true;
					record.keyDown = true;
				}
				else {
					checked = false;
					record.keyDown = false;
				}*/				
				/*
				if (checked) {
					selModel.doMultiSelect(record, true);
					//selModel.select(record, true);
				}
				else {
					selModel.doDeselect(record, false);
				}
				if (selectedRecLen > 0 && e.ctrlKey === false && !record.get('sel'))
					return false;*/
				/*if(!Ext.isEmpty(segTrBtnVal))
				{
					pNode = node = grid.store.getNodeById(record.data.id);				
					if(segTrBtnVal != 0) {
						node = grid.store.getNodeById(record.data.id);
						chlen = node.childNodes.length;
						for(; c < chlen; c++) {
							chNode = node.childNodes[c];
							curNode = node
							if(segTrBtnVal == 1 || segTrBtnVal == 3) 
								curNode = chNode;
							/*if(checked)								
								selModel.doMultiSelect(curNode, true);
							else								
								selModel.doDeselect(curNode, false);*/
						/*}
						node.eachChild(function(n) {
							n.parentNode.cascadeBy(
								function(n)
								{									
									n.set('sel', checked);
									if (checked === false)
										n.set('keyDown', false);										
								}
							);
						});
					}
					if(segTrBtnVal == 1 || segTrBtnVal == 3) {
						//selModel.doDeselect(pNode, false);						
						pNode.set('sel', 'false');
					}
					else if(segTrBtnVal == 0 || segTrBtnVal == 2) {						
						//selModel.doMultiSelect(pNode, checked);
						pNode.set('sel', 'true')
					}
					if(checked == false) {
						pNode.set('sel', 'false');
						pNode.set('keyDown', false);
						//selModel.deselectAll();
					}
				}*/
			}
            if (ilbo && ilbo.callout && ilbo.callout.onGridCellClick) {
                try {
                    ilbo.callout.onGridCellClick.apply(ilbo || window, [grid, record.get("rn"), me]);
                }
				catch (e) {
                    console.log("Error in Callout Js." + e);
                }
            }
			if (me.xtype == 'ramcotreecolumn') {
				var el = Ext.fly(e.target),
					elup,
					attributes = el ? el.getAttributes() : {},
					newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
					taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
					linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,                
					selModel = null,
					isModal = me.isModal,
					childWidth = me.childWidth,
					childHeight = me.childHeight,
					args = [];
					
				selModel = grid.getSelectionModel();
				if (!taskInfo && el) {
					elup = el.up('div[taskinfo]');
					taskInfo = elup ? elup.getAttribute('taskinfo') : null;
				}
				if (!linkInfo && el) {
					elup = el.up('div[linkinfo]');
					linkInfo = elup ? elup.getAttribute('linkinfo') : null;
				}
				if (!newWindow && el) {
					elup = el.up('div[opennewwindow]');
					newWindow = elup ? elup.getAttribute('opennewwindow') || 'about:blank' : null;
				}
				if (me.linkevent && me.linkevent != 'tskstddummy') {
					me.task = me.linkevent;
					me.taskType = 'link';
				}
				//TECH-40238
				if(ilbo) {
					ilbo.callBackStatusError = undefined;
				}
				if (newWindow) {
					openNewWindow(newWindow);
					return true;
				} 
				else if (!Ext.isEmpty(taskInfo) || !Ext.isEmpty(linkInfo)) {
					args = ['uiclick', grid, record];
					if (!Ext.isEmpty(taskInfo))
						args = args.concat(TaskInfoToObjectArray(taskInfo));
					else {
						args = args.concat(LinkInfoToObjectArray(linkInfo));
						args[0] = 'linkclick';
					}
					while (args.length < 10) {
						args[args.length] = null;
					}
					if (isModal) {
						args[4] = 'modal';
						if (!args[6] && childWidth) {
							args[6] = childWidth;
							args[7] = childHeight;
						}
						args[8] = true;
					}
					args[5] = args[5] || me.name;
					if (selModel)
						selModel.deselectAll(true);
					// TECH-36008
					grid.store.changed = true;
					grid.processEvtargs = args;
					grid.fireEvent.apply(grid, args);
					return;
				}
				
				if (e.getTarget(view.expanderSelector, record) && record.isExpandable()) {
				if(!record.isExpanded()) {
					record.set('ex', "1");					
				}
				else {
					record.set('ex', "0");					
				}
				grid.getNavigationModel().setPosition(e.position);
				/* if(false) {
					me.fireEvent('itemexpand', grid, record, recordIndex, cell);
					return false;
				} */
			}
				else {
					if (me.taskType == 'link' && me.task) {
						var view = me.up('ilbo');
						if (view) {
							var gridId = grid.getItemId(),
								viewId = recordIndex;
								//data = view.getSessionData();
							//TECH-34475	
							grid.onClearDataSelection(grid.store);	
							grid.view.refresh();
							record.set('sel', true);
							if (grid.store) {
								grid.store.cr = record.get("_rn");
							}	
							view.fireEvent('mltrans', view, [], me.task, me.taskType, gridId, viewId || '1', 0, 0);
							//view.fireEvent('trans', grid, record, recordIndex, cell);
						}
					}
				}
			}
		}
    }
});

// Grid Column
Ext.define('Ext.ramco.grid.Column', {
    extend: 'Ext.grid.column.Column',
    alias: 'widget.ramcogridcolumn',
    xtype: 'ramcogridcolumn',
    helpIcon: false,
    helpTask: null,
    helpTaskType: null,
    uiTask: null,
    uiTaskType: null,
    linkTask: null,
    linkTaskType: null,
    shrinkWrap: 0,
    btsynonym: '',
    config: {
        dataType: 'string',
        mandatory: false,
        format: null,
        maxLength: 10,
        tooltip: null,
		align:"",
        titleAlign: 'left'
    },
	//TECH-33654
	//'titleEl', 'triggerEl', 'textEl', 'textContainerEl', 'textInnerEl', 'helpEl', 'checkEl','deleteEl'
    childEls: [		
        'titleEl', 'triggerEl', 'textEl', 'textContainerEl', 'textInnerEl', 'helpEl', 'checkEl','deleteEl', 'mandatoryEl', 'sortInnerEl'
    ],
    titleCls: Ext.baseCSSPrefix + 'column-header-align-',
    mandatoryCls: Ext.baseCSSPrefix + 'column-header-mandatory',
	displayOnlyCls: Ext.baseCSSPrefix + 'column-header-displayonly',
    actionCls: Ext.baseCSSPrefix + 'column-header-action',
    wrapCls: Ext.baseCSSPrefix + 'column-header-wrap',
    tdCls: Ext.baseCSSPrefix + 'column-ramcocolumn',
    renderTpl: [
        //'<div id="{id}-titleEl" data-ref="titleEl" role="presentation" style="height:{header.height};"',
        '<div id="{id}-titleEl" data-ref="titleEl" role="presentation"',
			'{tipMarkup}class="', Ext.baseCSSPrefix, 'column-header-inner<tpl if="!$comp.isContainer"> ', Ext.baseCSSPrefix, 'leaf-column-header</tpl>',
			'<tpl if="empty"> ', Ext.baseCSSPrefix, 'column-header-inner-empty</tpl>">',
			'<div id="{id}-textContainerEl" data-ref="textContainerEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-text-container">',
				//TECH-33654
				/*'<tpl if="hasHelp">',
					'<div id="{id}-helpEl" data-ref="helpEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-help',
					'{childElCls}"></div>',
				'</tpl>',*/
				//'<div role="presentation" class="', Ext.baseCSSPrefix, 'column-header-text-wrapper {mandatoryCls} {actionCls}">',
				'<div role="presentation" class="', Ext.baseCSSPrefix, 'column-header-text-wrapper {actionCls}">',					
					'<div id="{id}-textEl" data-ref="textEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-text {titleCls}',
						'{childElCls}">',
						'<tpl if="hasHelp">',
							'<div id="{id}-helpEl" data-ref="helpEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-help',
							'{childElCls}"></div>',
						'</tpl>',
						'<tpl if="hasMandatory">',
							'<div id="{id}-mandatoryEl" data-ref="mandatoryEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-mandatory {mandatoryCls}"> </div>',
						'</tpl>',
						'<tpl if="isCheck">',
							'<div id="{id}-checkEl" data-ref="checkEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-check x-column-header-unchecked',
								'{childElCls}"></div>',
						'</tpl>',
						'<tpl if="isDelete">',
							'<div id="{id}-deleteEl" data-ref="deleteEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-fa-trash-o',
							'{childElCls}"></div>',
						'</tpl>',
						'<div id="{id}-textInnerEl" data-ref="textInnerEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-text-inner {displayOnlyCls}">{text}</div>',
						'<tpl if="hasHelp2">',
							'<div id="{id}-helpEl" data-ref="helpEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-help',
							'{childElCls}"></div>',
						'</tpl>',
						'<div id="{id}-sortInnerEl" data-ref="sortInnerEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-sort"></div>',						
					'</div>',			
				'</div>',		
			'</div>',		
			'<tpl if="!menuDisabled">',
				'<div id="{id}-triggerEl" data-ref="triggerEl" role="presentation" class="', Ext.baseCSSPrefix, 'column-header-trigger',
				'{childElCls}" style="{triggerStyle}"></div>',
			'</tpl>',
        '</div>',
        '{%this.renderContainer(out,values)%}'
    ],
    initComponent: function() {
        var me = this,
            grid = null,
            editor = me.editor;
		//TECH-39926
		me.innerCls = "";	
        if (me.tdCls)
            me.tdCls += ' ' + Ext.baseCSSPrefix + me.name;
        else
            me.tdCls = Ext.baseCSSPrefix + me.name;
		if (Ext.isEmpty(me.editor) && me.xtype == "ramcogridcolumn") {			
			me.tdCls = me.tdCls + " x-column-cell-displayonly ";			
		}
		if(me.xtype == "ramcotemplatecolumn" && me.task)//TECH-30073
			me.tdCls += " "+ Ext.baseCSSPrefix + 'column-ramcolink';
        if (me.name == 'rn' || me.name == 'sel' || me.name == 'delete') {
            me.sortable = false;
            if (me.name == 'sel')
                me.isCheck = true;
			if(me.name == 'delete')
				me.isDelete = true;
        }
		// TECH-39427
		if (!me.initVisibleState)
			me.initVisibleState = (me.hidden == true || me.isHidden()) ? false : true;
		//TECH-32884
		if (me.xtype == "ramcogridcheck")
			me.align = 'center';
		else if (me.xtype != "ramcogridcheck" && (me.dataType == 'integer' || me.dataType == 'numeric' || me.dataType == 'int' || me.dataType == 'float' || me.dataType == 'long' || me.dataType == 'double')) {
			if((Ext.browser.is.IE || Ext.browser.is.Edge))
				me.align = 'right';
			else
				me.align = 'end';
			//TECH-39926
			me.innerCls = "x-grid-cell-number-align ";
		}
		else {			
			// AHBG-31904
		
        if (Ext.isEmpty(me.align)) {
				if((Ext.browser.is.IE || Ext.browser.is.Edge))
					me.align = 'left';
				else
					me.align = 'start';
			}
			else {
				if((Ext.browser.is.IE || Ext.browser.is.Edge)) {
					if (me.align == "start")
						me.align = 'left';
					else if (me.align == "end") {
						me.align = 'right';
						//TECH-39926
						me.innerCls = "x-grid-cell-number-align ";
					}
				}
				else {
					if (me.align == "left")
						me.align = 'start';
					else if (me.align == "right") {
						me.align = 'end';
						//TECH-39926
						me.innerCls = "x-grid-cell-number-align ";
					}
				}
			}
		}
		
        /* if (Ext.isEmpty(me.align)) {
			if (me.xtype != "ramcogridcheck" && (me.dataType == 'integer' || me.dataType == 'numeric' || me.dataType == 'int' || me.dataType == 'float' || me.dataType == 'long' || me.dataType == 'double'))
				me.align = 'end';
			else if (me.xtype == "ramcogridcheck")
				me.align = 'center';
			else
				me.align = 'start';
        }else{//TECH-32884
			if (me.xtype != "ramcogridcheck" && (me.dataType == 'integer' || me.dataType == 'numeric' || me.dataType == 'int' || me.dataType == 'float' || me.dataType == 'long' || me.dataType == 'double'))
				me.align = 'end';
			else if (me.xtype == "ramcogridcheck")
				me.align = 'center';
			else{
				if (me.align == "left"){
					me.align = 'start';
				}else if (me.align == "right"){
					me.align = 'end';
				}
			}
		} */
		//TECH-39926
		//me.innerCls = "";
		if (me.editor && me.editor.xtype == "textarea")
            me.innerCls = "x-grid-cellinner-textarea ";
		if (!Ext.isEmpty(me.customCls) && !Ext.isEmpty(me.iconCls))
            me.innerCls += me.customCls + ' ' + me.iconCls;
        else if (!Ext.isEmpty(me.customCls) && Ext.isEmpty(me.iconCls))
            me.innerCls += me.customCls;
        else if (Ext.isEmpty(me.customCls) && !Ext.isEmpty(me.iconCls))
            me.innerCls += me.iconCls;
        me.callParent();
        grid = me.up('tablepanel');
		if (grid && grid.xtype != "ramcoexpgrid")
			me.setSorter(new Ext.util.Sorter());
        if (grid && grid.columnLines === false)
            me.addCls(Ext.baseCSSPrefix + 'column-header-noborder');
    },
    initRenderData: function() {
        var me = this,
            tipMarkup = '',
			displayOnlyCls = me.displayOnlyCls,
            hasHelp = me.helpIcon && !RamcoRTC.settings.isExt2,
			hasHelp2 = me.helpIcon && RamcoRTC.settings.isExt2,
            mandatory = me.mandatory,
            wrap = me.headerWrap,
            actionCls = (me.task || me.uiTask) ? me.actionCls : '',
            mandatoryCls = mandatory ? me.mandatoryCls : '',
            wrapCls = wrap ? me.wrapCls : '',
            tip = me.tooltip || me.text,
            checked = (me.dataIndex == 'sel') ? true : false,
            grid = me.up('tablepanel'),
            header = {}
        titleAlign = me.getTitleAlign(),
            titleCls = me.titleCls + (titleAlign ? titleAlign : 'left'),
            text = me.text,
            attr = me.tooltipType === 'qtip' ? 'data-qtip' : 'title';
        if (me.dataIndex != 'sel' && me.isCheck)
            checked = true;

        if (!Ext.isEmpty(tip)) {
            tipMarkup = attr + '="' + tip + '" ';
        }
		if (RamcoRTC.settings.isExt2 == true) {
			if (Ext.isEmpty(me.editor)) {
				displayOnlyCls = displayOnlyCls; 
			}
			else {
				displayOnlyCls = "";
			}
		}
		//AHBG-31926
		//else {
		if (Ext.isEmpty(me.editor) && me.xtype == "ramcogridcolumn") {
			mandatoryCls = displayOnlyCls; 
			mandatory = false;
		}        
		//}
		if (mandatory && !Ext.isEmpty(me.uiTask)) {
			mandatoryCls += "-ui";
		}
		else if(Ext.isEmpty(actionCls) && !Ext.isEmpty(me.uiTask)) {
			mandatoryCls = actionCls;
		}
		if (me.xtype == "linkcolumn" || me.xtype == "linkimagecolumn" || (Ext.isEmpty(me.editor) && !Ext.isEmpty(me.uiTask))) {
			actionCls = "";
		}
        return Ext.applyIf(me.callParent(arguments), {
            text: text,
            header: header,
            empty: text === '&#160;' || text === ' ' || text === '',
            menuDisabled: me.menuDisabled,
            hasHelp: hasHelp,
			hasHelp2: hasHelp2,
            isCheck: checked,
			hasMandatory: mandatory,//TECH-33654
			isDelete:me.isDelete,
            actionCls: actionCls,
            mandatoryCls: mandatoryCls,
			displayOnlyCls: displayOnlyCls,
            titleCls: titleCls + ' ' + wrapCls,
            tipMarkup: tipMarkup,
            triggerStyle: this.getTriggerVisible() ? 'display:block' : ''
        });
    },
    processEvent: function(type, view, cell, recordIndex, cellIndex, e, record, row) {
        var me = this,
            ilbo = me.up('ilbo'),
			key = e.getKey(),
			editor = me.config.editor,
            ret;
		me.isTriggerClick = false;	// TECH-37897
		// TECH-32876
		if (type == 'click' && me.stateEnabled == false)
			return false; // TECH-33453
		if (me.stateEnabled == false)
			return true; // TECH-33453
        if (me.xtype == 'attachcolumn' || me.xtype == 'deletecolumn')
            return;
        if (type == 'click') {
			// TECH-37897
			try {
				me.isTriggerClick = e.getX() > ((e.target.getBoundingClientRect().x + e.target.offsetWidth) - 20);
			}
			catch(ex) {}
            if ((me.xtype == 'linkcolumn' || me.xtype == 'ramcotemplatecolumn') && Ext.isEmpty(record.get(me.dataIndex)))
                return;
            var grid = me.up('ramcogrid'),
                insertFlag = false,
                column;
            if (!grid) {
                grid = me.up('ramcotreegrid');
            } 
			
			if (!grid) {
				grid = me.up('ramcoddtgrid');
			}						
			if (!grid) {
				grid = me.up('ramcorstreegrid');
			}
			if (!grid) {
				grid = me.up('ramcoexpgrid');
			}
			if (!grid) {						
				grid = me.up('ramcorslistview')
			}	
			if (grid) {
				if (Ext.isFunction(grid.getInsertFlag))
                	insertFlag = grid.getInsertFlag();
            }
            //column = grid.getColumnById(cell.dataset.columnid);
			if (grid.xtype == "ramcorstreegrid" && !Ext.isEmpty(me.editor) && grid.allowLeafEdit) {
				if (record && record.data && !record.data.leaf) {
					return false;
				}
			}
			if (grid.xtype == "ramcorslistview") {
				return false;
			}
			grid.col = cell.cellIndex;
			grid.currentCell = cell;
            me.fireEvent('ctrlfocus', grid.itemId || grid.parentId, me.dataIndex.replace('v', ''), record.get('rn'));
            if (ilbo && ilbo.callout && ilbo.callout.onGridCellClick) {
                try {
                    ilbo.callout.onGridCellClick.apply(ilbo || window, [grid, record.get("rn"), me]);
                } catch (e) {
                    console.log("Error in Callout Js." + e);
                }
            }

            var el = Ext.fly(e.target),
                elup,
                attributes = el ? el.getAttributes() : {},
                newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
                taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
                linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
                //grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid')),
				//selModel = grid.getSelectionModel(),
				selModel = null,
                isModal = me.isModal,
                childWidth = me.childWidth,
                childHeight = me.childHeight,
                args = [];
			grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));
			if (!grid) {
				grid = me.up('ramcorstreegrid');
			}			
			if (!grid) {
				grid = me.up('ramcoexpgrid');
			}
			selModel = grid.getSelectionModel();
            if (!taskInfo && el) {
                elup = el.up('div[taskinfo]');
                taskInfo = elup ? elup.getAttribute('taskinfo') : null;
            }
            if (!linkInfo && el) {
                elup = el.up('div[linkinfo]');
                linkInfo = elup ? elup.getAttribute('linkinfo') : null;
            }
            if (!newWindow && el) {
                elup = el.up('div[opennewwindow]');
                newWindow = elup ? elup.getAttribute('opennewwindow') || 'about:blank' : null;
            }
            if (me.linkevent && me.linkevent != 'tskstddummy') {
                me.task = me.linkevent;
                me.taskType = 'link';
            }
			if (me.popupClose) {
				ilbo.popupClose = me.popupClose;
			}
			if (me.modalClose) {
				ilbo.modalClose = me.modalClose;
			}
            if (newWindow) {
                openNewWindow(newWindow);
                return true;
            } else if (me.task || !Ext.isEmpty(taskInfo) || !Ext.isEmpty(linkInfo)) {
                args = ['uiclick', grid, record];
                if (Ext.isEmpty(taskInfo) && Ext.isEmpty(linkInfo))
                    args = args.concat(me.task, me.taskType);
                else if (!Ext.isEmpty(taskInfo))
                    args = args.concat(TaskInfoToObjectArray(taskInfo));
                else {
                    args = args.concat(LinkInfoToObjectArray(linkInfo));
                    args[0] = 'linkclick';
                }
                while (args.length < 10) {
                    args[args.length] = null;
                }
                if (isModal) {
                    args[4] = 'modal';
                    if (!args[6] && childWidth) {
                        args[6] = childWidth;
                        args[7] = childHeight;
                    }
                    args[8] = true;
                }
                args[5] = args[5] || me.name;
                if (selModel)
                    selModel.deselectAll(true);
				// TECH-36008
				grid.store.changed = true;
				grid.processEvtargs = args;
                grid.fireEvent.apply(grid, args);
            } else {
                if (me.dataName == 'rn') {
                    //if (!insertFlag)
                       // return true;
                    args = ['rnclick', grid, record, recordIndex];
					grid.processEvtargs = args;
                    ret = grid.fireEvent.apply(grid, args);
                } else if (me.xtype == "imagecolumn" && me.hasLink) {//TECH-31705
					if (Ext.isEmpty(me.preventDownload) || me.preventDownload == false) {
						if (el.dom.tagName == "IMG")
							src = el.getAttribute("src");
						else {
							elup = el.down('img');
							if (elup) {
								src = elup.getAttribute("src");
							}
						}
						if (!Ext.isEmpty(src)) {
							openWindow(src);
						}
					}
                    return true;
                } else
                    ret = me.callParent(arguments);
            }
        }
		else if (type == 'keydown' && key === e.SPACE && !editor) {
			if (record) {
				var rSel = record.get('sel');
				if (rSel) {
					record.set('sel', false)
				}
				else {
					record.set('sel', true)
				}
			}
		}
		else if (type == 'dblclick') {
            var grid = me.up('ramcogrid'),
                args = [];
            grid = grid ? grid : me.up('ramcotreegrid');
			if(!grid)
				grid = me.up('ramcorstreegrid');
			if (!grid) {
				grid = me.up('ramcoexpgrid');
			}
			if (!grid) {
				grid = me.up('ramcosearchgrid');
			}
            args = ['dblclick', grid, record, recordIndex];
			// TECH-36008
			grid.store.changed = true;
			grid.processEvtargs = args;
            ret = grid.fireEvent.apply(grid, args);
        } else
            ret = me.callParent(arguments);
        return ret;
    },
    onTitleElClick: function(e, t, sortOnClick) {
        var me = this,
            isCheck = me.isCheck,
            hasHelp = me.helpIcon,
            isDelete = me.isDelete,
            hasBreak = false,
            activeHeader,
            prevSibling;

        // Tap on the resize zone triggers the menu
        if (e.pointerType === 'touch') {
            prevSibling = me.previousSibling(':not([hidden])');

            // Tap on right edge, activate this header
            if (!me.menuDisabled && me.isAtEndEdge(e, parseInt(me.triggerEl.getStyle('width'), 10))) {
                if (!me.menuDisabled) {
                    activeHeader = me;
                }
            }

            // Tap on left edge, activate previous header
            else if (prevSibling && !prevSibling.menuDisabled && me.isAtStartEdge(e)) {
                activeHeader = prevSibling;
            }
        } else {
            // Firefox doesn't check the current target in a within check.
            // Therefore we check the target directly and then within (ancestors)
            activeHeader = me.triggerEl && (e.target === me.triggerEl.dom || t === me.triggerEl || e.within(me.triggerEl)) ? me : null;
        }
        if (isCheck) {
            if (!activeHeader && me.checkEl && e.target === me.checkEl.dom) {
                me.handleCheck();
                hasBreak = true;
            }
        }
        if (!hasBreak && hasHelp) {
            if (!activeHeader && me.helpEl && e.target === me.helpEl.dom) {
                me.handleHelp();
                hasBreak = true;
            }
        }
		if (isDelete) {
			if (!activeHeader && me.deleteEl && e.target === me.deleteEl.dom) {
                me.handleDelete();
                hasBreak = true;
            }
		}
        // If it's not a click on the trigger or extreme edges. Or if we are called from a key handler, sort this column.
        if (!hasBreak && sortOnClick !== false && (!activeHeader && !me.isAtStartEdge(e) && !me.isAtEndEdge(e) || e.getKey())) {
            me.toggleSortState();
        }
        return activeHeader;
    },
    handleHelp: function() {
        var me = this,		
            grid = me.up('ramcogrid');
		//TECH-30684	
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		if (grid.xtype == "ramcoexpgrid")
			grid = grid.parentMl;
		
        grid.fireEvent('help', grid, me);
    },
	setFilter: function(bValue) {
		var me = this;
		if(bValue) {
			if(!me.hasCls("x-column-filter")) {
				me.addCls("x-column-filter");
			}
		}
		else {
			me.removeCls("x-column-filter");
		}
	},
	handleDelete: function() {
		var _me = this,
            _grid = _me.up('ramcogrid'),
			store = _grid.getStore();
		
		if (store.nsr == 0) {
			Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R289);
			return;
		}
		
		Ext.RamcoMsg.confirm(rvw_resources.R253, rvw_resources.R254, function(btnId, controller) {
			var me = this,
				grid = me.up('ramcogrid'),
				view = me.up('ilbo'),
				viewModel = view.getViewModel(),
				controller = view.getController(),
				store = grid.getStore(),
				gridId = grid.getItemId(),
				task = (gridId == 'mlmessageml') ? 'ezwmainscdeletatr' : '';
				
			if (btnId == "ok" || btnId == "yes")
				view.fireEvent('mltrans', view, {}, task, 'trans', gridId, '1', 0, 0);
			else {
				/* REMOVE SELECTION -  */
				var rec = store.findRecord('sel', true);
				while (rec) {
					rec.set('sel', false);
					rec = store.findRecord('sel', true);
				}
				controller.taskPending = false;
			}
		}, this);
    },
    handleCheck: function() {
        var me = this,
            grid = me.up('ramcogrid');
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		if (!grid) {
			grid = me.up('ramcosearchgrid');
		}		
        if (me.checkEl.hasCls('x-column-header-checked')) {
            me.checkEl.removeCls('x-column-header-checked');
            me.checkEl.addCls('x-column-header-unchecked');
            grid.fireEvent('selectall', grid, me, false);
        } else {
            me.checkEl.removeCls('x-column-header-unchecked');
            me.checkEl.addCls('x-column-header-checked');
            grid.fireEvent('selectall', grid, me, true);
        }
    },
    sort: function(direction) {
        var me = this,
            grid = me.up('ramcogrid'),
            sorter = me.getSorter();
        grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));

		// TECH-28159 / TECH-26959
		if(direction == undefined) {
			direction = me.sortState ? me.sortState == "ASC" ? "DESC" : "ASC" : "ASC";
		}
		me.asc = direction == "ASC" ? "0" : "1";
		me.desc = direction == "DESC" ? "0" : "1";
		//TECH-40068
		//if(grid.multiSortData && grid.multiSortData.length > 0) {
		if(grid && grid.multiSortData && grid.multiSortData.length > 0) {
			Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R303);
			return false;
		}

		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}		
		if (!grid) {
			grid = me.up('ramcoexpgrid');			
			grid = grid.parentMl;
		}
        me.callParent();
		//TECH-30053
		me.fireEvent('ctrlfocus', grid.itemId, me.name, grid.store.vsi || 1);
        if (!direction)
            if (sorter)
                direction = sorter.getDirection();
        if (direction) {
            grid.sortCol = me;
            grid.isSort = true;
            grid.fireEvent('sort', grid, me, direction == "ASC" ? 0 : 1);
        }
    },
    updateMandatory: function(mandatory, oldmandatory) {
		var me = this;
        if (oldmandatory) {
            this.removeCls(Ext.baseCSSPrefix + 'column-header-mandatory');
        }
		//AHBG-31926
		if (!Ext.isEmpty(me.editor)) {
	        if (mandatory) {
	            this.addCls(Ext.baseCSSPrefix + 'column-header-mandatory');
	        }
		}
    },
    beforeRender: function() {
        var me = this,
            editor = me.editor,
            value = '',
            width,
            grid = me.up('ramcogrid'),
            len = me.visibleLength || 10;
        grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));		
		// TECH-35534 / TECH-35642 / TECH-35619 / TECH-35651
		if (Ext.isEmpty(me.cellWidth)) {
	        if (!me.visibleLength)
	            width = me.width;
	        if (!width)
	            width = len * ((RamcoRTC.settings.isExt2 == true) ? 12 : 11); // TECH-35619 / TECH-35707
			//if (!grid)
	            //grid = me.up('ramcotreegrid');
			if (!grid) {
				grid = me.up('ramcorstreegrid');
			}
			if (!grid) {
				grid = me.up('ramcoexpgrid');
			}		
			if (!grid) {
				grid = me.up('ramcosearchgrid');
			}				
	        if (grid.rowHeight)
	            me.cstStyle = 'height:' + grid.rowHeight + 'px;';
	
	        if (me.forceFit || grid.columnFit)
	            width = len;
	
	        if (editor && (editor.xtype == 'combo' || editor.xtype == 'datefield' || editor.xtype == 'ramcodatetimefield' || editor.xtype == 'ramcotimefield'))
	            width += 25;
	        else if (RamcoRTC.settings.isExt2 != true && !me.forceFit && !grid.columnFit) // TECH-35619 / TECH-35707
	            width += 10;
	        if (me.dataIndex == 'rn' || me.dataIndex == 'sel')
	            width = 40;
	
			if (me.helpIcon) {
				if (me.forceFit || grid.columnFit)
					width += 2;
				else
					width += 20;
			}
			if (me.mandatory){
				if (me.forceFit || grid.columnFit)
					width += 1;
				else 
					width += 4;
			}
	
	        me.setWidth(width);
		}
		//TECH-38013
		if(me.xtype == 'ramcogridcheck' && me.text == '&nbsp;' &&  me.dataIndex != 'sel'){
			me.setText('');
		}
        me.callParent();
    },
    defaultRenderer: function(value, metaData, record, rowIdx, colIdx, dataSource, view) {
        var me = this,
            //grid = me.ownerCt.grid,
            grid = me.up('ramcogrid'),
            dataType = me.getDataType(),
            format = me.getFormat(),
            returnValue = value,
            qtip = '', colCls = '',
            editor = me.editor,
			sm = null,
			cellId;
			
        grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		if (!grid) {
			grid = me.up('ramcosearchgrid');
		}
		cellId = grid.itemId + "_cell_col" + me.dataIndex + "_row" + record.get("rn");
		
		/* TECH-39807 For help icon in header to be static upon hover*/
		if(RamcoRTC.settings.isExt2 == true && me.helpIcon && me.titleEl)
		{
		    me.titleEl.addCls("x-column-header-helpIcon")
		}
		
        if (!format) {
            if ((dataType == 'date' || me.xtype == 'datefield') && !(editor && editor.plugins)) {
                me.setFormat(RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat);
            } else if (dataType == 'date-time' || me.xtype == 'ramcodatetimefield') {
                me.setFormat(RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat);
            } else if (dataType == 'time' || me.xtype == 'ramcotimefield') {
                me.setFormat(RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat);
            }
            format = me.getFormat();
        }
		if(me.hasMasking){
			var rep,val,req,regRep,regCol,value,
				dataString = Ext.encode(record.data),
				data =  {};
			 data = Ext.decode(dataString,true);
			 regRep = me.regRep;
			 regCol = me.regCol;
			 rep = record.get(regRep);
			 val = record.get(regCol);
			 try{
				req = new RegExp(val, 'g');
			 }catch(e){
				 req = new RegExp(".", 'g');
			 }			 
			 value = data[me.dataIndex];			 
			 if(!Ext.isEmpty(record.get(me.dataCol)) && value.indexOf(rep) > 0)
				value = record.get(me.dataCol);
			 if(Ext.isEmpty(value)){
				 value = "";
			 }			 
			 if (!Ext.isEmpty(rep) && value.indexOf(rep) < 0){
				returnValue = data[me.dataIndex] = value.replace(req,rep);
				//record.set(me.dataCol, value);
				//record.set(me.dataIndex, returnValue);
				data[me.dataCol] = value;
				data[me.dataIndex] = returnValue;
			 }
			 else {
				returnValue = value;
				if (Ext.isEmpty(record.get(me.dataCol)))
					//record.set(me.dataCol, value);
					data[me.dataCol] = value;	
			 }
		}
		if (me.dataIndex != "rn" && me.dataIndex != "sel" && !Ext.isEmpty(grid.rsColumnsValue)) {
			if (!Ext.isEmpty(grid.rsColumnsValue[me.dataIndex]))
				sm = grid.rsColumnsValue[me.dataIndex].sm;
		}
		if (Ext.isDate(value))
			dateVal = value;
		else {
			if ( dataType == 'date') {
				// TECH-28318
				//if (!Ext.isEmpty(value) && value.indexOf('00:00:00') < 0)
					//value = value + ' 00:00:00';
				//dateVal = Ext.Date.parse(value + ' 00:00:00',  "Y-m-d H:i:s");
				dateVal = Ext.Date.parse(value,  "Y-m-d");//datechange
			}
			if (dataType == 'time') {
				dateVal = Ext.Date.parse('1900-01-01 ' + value, "Y-m-d H:i:s");
			}
			if (dataType == 'date-time') {
				dateVal = Ext.Date.parse(value, "Y-m-d H:i:s");
			}
		}
		if (Ext.isEmpty(sm) || sm.toLowerCase() === "n") {
			switch (dataType) {
				case "date":
				case "date-time":
                if (editor && editor.plugins && !RamcoRTC.settings.isNepali)
						format = 'B-Q-R';
					//returnValue = Ext.util.Format.date(value, format);
                	returnValue = Ext.util.Format.date(dateVal, format);
					break;
				case "time":
					//returnValue = Ext.util.Format.date(value, format);
                	returnValue = Ext.util.Format.date(dateVal, format);
					break;
				case "float":
				case "double":
				case "numeric":
				case "int":
				case "integer":
				case "long":
					returnValue = me.formatNumeric(value, format);
					break;
				default:
			}
		}
        if (metaData && metaData.column.dataIndex != "rn" && metaData.column.dataIndex != "sel") {
            qtip = record.data[metaData.column.dataIndex + "-stp"];
			colCls = record.data[metaData.column.dataIndex + "-css"];
			if (!Ext.isEmpty(colCls)){
				if(Ext.isEmpty(metaData.tdCls))
					metaData.tdCls = colCls;
				else
					metaData.tdCls += colCls;
			}
		}

		// TECH-27261
        // qtip = Ext.isEmpty(qtip) ? returnValue : qtip;

		if(Ext.isEmpty(qtip)) 
			qtip = returnValue;
		else {
			var qTipObj, qTipTpl, qTipVal;
			if(!Ext.isEmpty(qtip) && Ext.isString(qtip) && qtip.indexOf('{') ==0){//TECH-29269
				qTipTpl = Ext.decode(qtip, true);
				var templateId = qTipTpl.tplid;
				var ilbo = me.up('ilbo');
				if(qTipTpl && templateId) {
					qTipObj = ilbo.getTemplate(templateId, true);
					if(qTipObj) {
						qTipVal = qTipObj.apply(qTipTpl);
						qTipVal = Ext.util.Format.htmlEncode(qTipVal);
						return '<div id="'+ cellId +'" data-qtip="' + qTipVal + '" data-qclass="x-tip-noborder">'+ value +'</div>'
					}
				}
			}
		}
		
        var dataqTip = Ext.util.Format.stripTags(qtip),
			dateCls = 'x-date',
			style = ''; // TECH-35584
        if (editor) {
            if (Ext.isEmpty(returnValue))
                returnValue = '';
            //if (editor.xtype == 'combofield' || (editor.xtype == 'ramcolistedit' && !me.customListEdit)) {
			// TECH-28266
			if (editor.xtype == 'combofield') {
				var view = me.up('ilbo'),
					viewModel = view.getViewModel(),
					editColStore,
					colRecord;
				if (viewModel.storeInfo) {
					//TECH-30390
					//editColStore = viewModel.storeInfo[grid.itemId + "_" + me.dataIndex + "_store"], colRecord;					
					if (grid && grid.parentMl) {
						editColStore = viewModel.storeInfo[grid.parentMl.itemId + "_" + me.dataIndex + "_store"];
					}
					else {
						editColStore = viewModel.storeInfo[grid.itemId + "_" + me.dataIndex + "_store"];
					}
					//if ((grid && !grid.zoomWindow) || (grid.zoomWindow && !grid.zoomWindow.isVisible())) // TECH-30546 / QA-151
					editColStore.clearFilter();//TECH-29725
					colRecord = editColStore.findRecord((editor.displayField || 'text'), returnValue);
				}
				
				// TECH-28318, TECH-28266
				if (Ext.isEmpty(returnValue) || (dataType != 'date' && dataType != 'time' && dataType != 'date-time' && Ext.isEmpty(colRecord)))
                    returnValue = '';
                returnValue = '<div id="'+ cellId +'" class="x-combo" data-qtip="' + dataqTip + '">' + returnValue + '</div>';
            }
			//else if (editor.xtype == 'ramcolistedit' && !me.customListEdit) {
			else if (editor.xtype == 'ramcolistedit') {
				if (Ext.isEmpty(returnValue))
                    returnValue = '';
                returnValue = '<div id="'+ cellId +'" class="tech-list_edit-a" data-qtip="' + dataqTip + '">' + returnValue + '</div>';
			}
			else if (editor.xtype == 'datefield' || editor.xtype == 'ramcodatetimefield' || editor.xtype == 'ramcotimefield') {
				if (Ext.isEmpty(returnValue))
                    returnValue = '';
				if (editor.xtype == 'ramcodatetimefield') 
					dateCls = 'tech-calendarntime-a'
				else if (editor.xtype == 'ramcotimefield') 
					dateCls = 'tech-time-a'
                returnValue = '<div id="'+ cellId +'" class='+ dateCls +' data-qtip="' + dataqTip + '">' + returnValue + '</div>';
            } 
			else if(editor.xtype == 'textareafield') {

				if (grid.rowHeight)
					style = 'height:' + grid.rowHeight + 'px;overflow: auto';
				/* if(metaData && metaData.column && metaData.column.headerWrap)
					style += ' overflow: auto';
				else
					style += ' white-space: nowrap;'; */
         
				if (Ext.isEmpty(dataqTip)) {
					returnValue = '<pre id="'+ cellId +'" style="' + style + '">' + returnValue + '</pre>';
				} 
				else {
					//returnValue = '<pre style="' + style + '" data-qtip="' + dataqTip + '">' + returnValue + '</pre>';
					returnValue = formatGridColValue('pre', style, dataqTip, returnValue, null, cellId);
				}
            }
			else if(editor.xtype == 'textfield') {				
				returnValue = formatGridColValue('div', style, dataqTip, returnValue, null, cellId);
			}
            // TECH-32942
			if (editor.inputType == 'password' || editor.inputType == 'ramcopassword') {
				if (!Ext.isEmpty(value))					
					returnValue = "*****";
				else
					returnValue = "";
			}
        } else {
            if (Ext.isEmpty(returnValue))
                returnValue = '';

            // TECH-38124
			if (grid.rowHeight && !Ext.isEmpty(metaData))
                metaData.style = 'height:' + parseInt(grid.rowHeight - 2,10) + 'px;';
			/*if(metaData && metaData.column && metaData.column.headerWrap)
				style += ' overflow: auto';
			else
				style += ' white-space: nowrap;';
			*/
			// TECH-35584
			//style += ' white-space: nowrap;';

            if (Ext.isEmpty(dataqTip)) {
                returnValue = '<pre id="'+ cellId +'" style="' + style + '">' + returnValue + '</pre>';
            } else {
                //returnValue = '<pre style="' + style + '" data-qtip="' + dataqTip + '">' + returnValue + '</pre>';
				returnValue = formatGridColValue('pre', style, dataqTip, returnValue, null, cellId, false);
            }
        }
        return returnValue;
    },
	// TECH-30280
	formatNumber: function(value, prec) {
		try {
			var me = this,
				thousandSep = Ext.util.Format.thousandSeparator,
				decSep = Ext.util.Format.decimalSeparator,
				tempValue = "00000000000000000000",
				splitVal = [], valueObj = value, decObj = "0", returnVal;
			
			if (!Ext.isEmpty(value))
				value = value.toString();
			
			if (value.indexOf(decSep) >= 0) {
				splitVal = value.split(decSep);
				if (splitVal && splitVal.length > 1) {
					valueObj = splitVal[0];
					decObj = splitVal[1];
				}
			}
			
			splitVal = String(valueObj).replace(new RegExp('[/' + thousandSep + "]", 'g'), "");
			if (!Ext.isEmpty(decObj)) {
				if(String(decObj).length < prec)
					decObj = decObj + tempValue.substring(0, prec - String(decObj).length);
				decObj = decObj.substring(0,prec);
			}
			else
				valueObj = value;
			
			if(valueObj != "" && valueObj.length == 1 && valueObj == "-")
				valueObj = valueObj + 0;
			//TECH-32220
			if(prec > 0)
				returnVal =   valueObj + decSep + decObj;
			else if(prec  == 0)
				returnVal =   valueObj;
			//returnVal =   valueObj + decSep + decObj;
			
			var tmpv = parseInt(returnVal, 10);
			if(isNaN(tmpv))
				returnVal = "";
			
			return returnVal;
		}
		catch(ex) {}		
	},
    formatNumeric: function(value, dataType) {
		if(Ext.isEmpty(value))
			return "";
        var tempNum = '999999999999999999',
			n1, n2, num, num1,num2;
        dataType = dataType ? parseInt(dataType, 10) : 0;
        if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "no grouping") {
            format = '9.' + tempNum.substring(0, dataType)
        } else {
            format = '9,9.' + tempNum.substring(0, dataType)
        }
        Ext.util.Format.thousandSeparator = RamcoRTC.userPreference.numgroupsymbol;
        Ext.util.Format.decimalSeparator = RamcoRTC.userPreference.decimalseparator;
		var numGroupStyle = RamcoRTC.userPreference.numgroupstyle.toLowerCase();
		if (!Ext.isEmpty(numGroupStyle) && numGroupStyle != 'no grouping') {//TECH-33327
			num2 = (value) ? parseFloat(value) : 0;
         	num2 = parseFloat(this.formatNumber(num2, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
			if (numGroupStyle == "lakh based")
				n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			else if (numGroupStyle == "million based")
				n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			
			num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
		}else{
			if (dataType == null || dataType == 0) {
				// TECH-30280
				num = this.formatNumber(value, 0);
				/* if (!Ext.isEmpty(num))//TECH-33327
					num = Ext.util.Format.number(num, "0"); */
			}
			else {
				// TECH-30280
				num = this.formatNumber(value, dataType);
				/* if (!Ext.isEmpty(num))//TECH-33327
					num = Ext.util.Format.number(num, format); */
			}
		}
		
        /*if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "lakh based") {
            num2 = (value) ? parseFloat(value) : 0;
			// TECH-30280
			num2 = parseFloat(this.formatNumber(num2, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
            n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        } else if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "million based") {//TECH-33327
			num2 = (value) ? parseFloat(value) : 0;
         	num2 = parseFloat(this.formatNumber(num2, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
	       // n1 = n1[0].replace(/(?<!\.)(\d)(?=(\d{3})+(\.|$))/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
	        n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        } else {
			if (dataType == null || dataType == 0) {
				// TECH-30280
				num = this.formatNumber(value, 0);
				// if (!Ext.isEmpty(num))//TECH-33327
				//	num = Ext.util.Format.number(num, "0"); 
			}
			else {
				// TECH-30280
				num = this.formatNumber(value, dataType);
				// if (!Ext.isEmpty(num))//TECH-33327
				//	num = Ext.util.Format.number(num, format); 
			}
        }*/
        var neg = false;
		if(Ext.isNumber(num))//TECH-33327
			num = num.toString();
        if (num.indexOf('-') != -1)
            neg = true;
        if (neg) {
            var numNegStyle = RamcoRTC.userPreference.numnegativestle;
            switch (numNegStyle) {
                case "(1.1)":
                    num = "(" + num.replace("-", "") + ")";
                    break;

                case "- 1.1":
                    num = num.replace("-", "- ");
                    break;

                case "1.1-":
                    num = num.replace("-", "") + "-";
                    break;

                case "1.1 -":
                    num = num.replace("-", "") + " -";
                    break;

                case "()1.1":
                    num = "()" + num.replace("-", "");
                    break;

                case "(-)1.1":
                    num = "(-)" + num.replace("-", "");
                    break;
                default:
                    num = "-" + num.replace("-", "");
                    break;
            }
        }
        return num;
    },
    getEditor: function(record) {
        var me = this,
            grid = me.up('ramcogrid');
		if(!grid)
			grid = me.up('ramcorstreegrid');
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		if (me.disabled == true)
			return;
        if (me.editor) {
            me.editor.format = me.getFormat();
			me.editor.role = 'gridrole';
			me.editor.allowBlank = true;
			var newValue = me.editor.format,
				numLen = me.maxLength - newValue;
			if (newValue)
				me.editor.decimalPrecision = newValue;
			
			var tempNumber = "99999999999999999999999999999999999999999999999999",
				decSep = RamcoRTC.userPreference.decimalseparator,
				minValue = "-" + tempNumber.substring(0, me.maxLength),
				maxValue = tempNumber.substring(0, me.maxLength);
			if (newValue > 0) {
				minValue = "-" + tempNumber.substring(0, numLen) + decSep + tempNumber.substring(0, newValue);
				maxValue = tempNumber.substring(0, numLen) + decSep + tempNumber.substring(0, newValue);
			}
			me.editor.minValue = minValue;
			me.editor.maxValue = maxValue;
			me.editor.maxLength = me.maxLength;
			// TECH-35136
			//me.editor.maxLength = (me.editor.xtype != "numberfield") ? me.maxLength : me.maxLength + 1;			
			
			//me.editor.maxLength = (!Ext.isEmpty(me.editor.format)) ? me.maxLength - me.editor.format : me.maxLength;			
            me.editor.value = record.get(me.dataIndex);
			if (me.hasMasking === true) {
				me.editor.value = record.get(me.dataCol);
			}
            // TECH-36388 / TECH-35611
            if (!Ext.isEmpty(me.uiTask) && (me.editor.xtype == "combofield" || me.editor.xtype == "datefield" || me.editor.xtype == "ramcotimefield" || me.editor.xtype == "ramcodatetimefield")) {
				me.editor.listeners = {
					select:me.onSelect.bind(me)
				};	
			}			
            if (me.editor.xtype == 'textarea') {
                me.editor.height = grid.rowHeight;
            }
            me.editor.width = me.width;
			if (!Ext.isEmpty(me.uiTask)) {
				if (me.editor.cls)
					me.editor.cls += ' x-field-ui';
				else
					me.editor.cls = 'x-field-ui';
			}
        }
        return me.editor;
    },
    onKeyPress: function(field, evt, eOpts) {
        var me = this,
            value = field.getValue(),
            fields = field.getListView(),
            search = field.searchView,
            grid = me.up('ramcogrid');
        grid.activeListField = field;
        grid.fireEvent('listdata', grid, me, value, fields, search);
    },
    onListSelect: function(combo, record, eOpts) {
        /*var me = this,
            grid = me.up('ramcogrid');
        if (me.uiTask) {
            //grid.fireEvent('listselect', grid, record);
            combo.ownerCt.context.record.set(me.dataIndex, combo.getValue());
            combo.ownerCt.editingPlugin.completeEdit();
            grid.fireEvent('listselect', me, grid, record);
        }*/
    },
    onSpecialkey: function(field, evt, eOpts) {
        var me = this,
            grid = me.up('ramcogrid');
        if (evt && me.uiTask && evt.getKey() == evt.ENTER) {
            field.ownerCt.context.record.set(me.dataIndex, field.getValue());
            field.ownerCt.editingPlugin.completeEdit();
            grid.fireEvent('enter', grid, me);
        }
        /* CREATING DUMMY ROW ON KEY ARROW DOWN */
        else if (evt && evt.getKey() == 40 && field.getValue() != "" && grid.cr == grid.tr)
            grid.createDummyRecord();
    },
    onSelect: function(combo, record, eOpts) {
        var me = this,
            grid = me.up('ramcogrid'),
			grdRecord = null;
        if (me.uiTask) {
			 if(combo && combo.completeEdit)
			 	combo.completeEdit();
			 if(combo && combo.ownerCt && combo.ownerCt.completeEdit)
			 	combo.ownerCt.completeEdit();
			try {
				
					// TECH-28194
					var gridRecord = combo.ownerCt.context.record;
					gridRecord.dirty = true;
				// TECH-37776
				gridRecord.set("isNew",false);
				if(!gridRecord.modified) 
						gridRecord.modified = [];
						gridRecord.modified[me.dataIndex] = true;
					grid.edited=false;
				/*
				if(me.record) {
					me.record.set(me.dataIndex, combo.getValue());
					me.record.set('isNew', false);
					delete me.record;
				}
				else {
					grdRecord = combo.ownerCt.context.record;
					grdRecord.set(me.dataIndex, combo.getValue());
					grdRecord.set('isNew', false);
				}*/
				// TECH-30946
				grid.lastEvent = "cmbSelect";
				grid.fireEvent('cmbselect', grid, me);
			}
			catch(e){ }
        }
    }
});

// Check Box
Ext.define('Ext.ramco.grid.Check', {
    extend: 'Ext.ramco.grid.Column',
    alias: 'widget.ramcogridcheck',
    align: 'center',
    ignoreExport: true,
    stopSelection: true,
    tdCls: Ext.baseCSSPrefix + 'grid-cell-checkcolumn',
    innerCls: Ext.baseCSSPrefix + 'grid-cell-inner-checkcolumn',
    clickTargetName: 'el',
    defaultFilterType: 'boolean',
    isCheck: false,
    constructor: function() {
        this.scope = this;
		this.isCheck = (RamcoRTC.settings.isExt2 == true) ? true : false;
        this.callParent(arguments);
    },
    processEvent: function(type, view, cell, recordIndex, cellIndex, e, record, row) {
        var me = this,
            key = type === 'keydown' && e.getKey(),
            mousedown = type === 'click',
            fType = record.getField(me.dataIndex).type,
            disabled = me.disabled,
            ret,
            checked,
			navModel,
			grid = me.up('ramcorstreegrid');
		// TECH-32876
		if (type == 'click' && me.stateEnabled == false)
			return false; // TECH-33453
		if (me.stateEnabled == false)
			return true; // TECH-33453
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		if (!grid) {
			grid = me.up('ramcogrid');
		}
		if (!grid) {
			grid = me.up('ramcosearchgrid');
		}
		if (mousedown || key === e.SPACE) {
			//TECH-35608
			if (grid && grid.xtype == "ramcorstreegrid" && grid.getShowToolbar()) {
				navModel = grid.getNavigationModel();
				navModel.record=record;
				navModel.fireNavigateEvent(e);
				return false;
			}
		}
        // Flag event to tell SelectionModel not to process it.
        e.stopSelection = !key && me.stopSelection;

        if (!disabled && (mousedown || (key === e.ENTER || key === e.SPACE))) {
			//TECH-30255
			me.fireEvent('ctrlfocus', grid.itemId || grid.parentId, me.dataIndex, record.get('rn'));
			fType = record.getField(me.dataIndex).type;
            if (me.dataIndex == 'sel') {
                checked = !me.isRecordChecked(record);
            } else {
                if (fType == 'string')
                    checked = !((me.isRecordChecked(record) == '1') ? true : false);
                else if (fType == 'int' || fType == 'float' || fType == 'number')
                    checked = !((me.isRecordChecked(record) == 1) ? true : false);
                else
                    checked = !me.isRecordChecked(record);
            }

            // Allow apps to hook beforecheckchange
            if (me.fireEvent('beforecheckchange', me, recordIndex, checked) !== false) {
                me.setRecordCheck(record, checked, cell, row, e);
                me.fireEvent('checkchange', me, recordIndex, checked);

                // Do not allow focus to follow from this mousedown unless the grid is already in actionable mode
                if (mousedown && !me.getView().actionableMode) {
                    e.preventDefault();
                }
            }
			if(!Ext.isEmpty(me.task))
            	ret = me.callParent(arguments);
        } else {
            ret = me.callParent(arguments);
        }
        return ret;
    },
    onEnable: function() {
        this.callParent(arguments);
        this._setDisabled(false);
    },
    onDisable: function() {
        this._setDisabled(true);
    },
    _setDisabled: function(disabled) {
        var me = this,
            cls = me.disabledCls,
            items;

        items = me.up('tablepanel').el.select(me.getCellSelector());
        if (disabled) {
            items.addCls(cls);
        } else {
            items.removeCls(cls);
        }
    },

    defaultRenderer: function(value, metaData, record, rowIdx, colIdx, dataSource, view) {
        var me = this,
            type = metaData.column.dataType || record.getField(me.dataIndex).type,
            cssPrefix = Ext.baseCSSPrefix,
            cls = cssPrefix + 'grid-checkcolumn',
			qtip = '', colCls = '',
			cellId,
			grid;
		
		grid = me.up('ramcogrid');		
		grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		if (!grid) {
			grid = me.up('ramcosearchgrid');
		}
		//TECH-35790
		if (grid.rowHeight)
			me.cstStyle = 'height:' + grid.rowHeight + 'px;';
		
		cellId = grid.itemId + "_cell_col" + me.dataIndex + "_row" + record.get("rn");	
		if (metaData && metaData.column.dataIndex != "rn" && metaData.column.dataIndex != "sel") {
            qtip = record.data[metaData.column.dataIndex + "-stp"];
			colCls = record.data[metaData.column.dataIndex + "-css"];
			if (!Ext.isEmpty(colCls)){
				if(Ext.isEmpty(metaData.tdCls))
					metaData.tdCls = colCls;
				else
					metaData.tdCls += colCls;
			}
		}

        if (this.disabled) {
            metaData.tdCls += ' ' + this.disabledCls;
        }
        if (me.dataIndex != 'sel') {
            if (type == 'string' || type == 'char')
                value = (value == "1") ? true : false;
            //TECH-32462
			//else if (type == 'int' || type == 'float' || type == 'number')
			else if (type == 'int' || type == 'float' || type == 'number' || type == "integer" || type == "numeric")
                value = (value == 1) ? true : false;
        }
        if (value) {
            cls += ' ' + cssPrefix + 'grid-checkcolumn-checked';
        }
        return '<div id="'+ cellId +'" class="' + cls + '" role="button"></div>';
		/*if (me.dataIndex == 'sel')
			return '<div class="' + cls + '" role="button"></div>';
		else
			return '<div class="' + cls + '" role="button" tabIndex="0"></div>';*/
    },

    isRecordChecked: function(record) {
        var prop = this.property;
        if (prop) {
            return record[prop];
        }
        return record.get(this.dataIndex);
    },

    setRecordCheck: function(record, checked, cell, row, e) {
        var me = this,
            type = record.getField(me.dataIndex).type,
            prop = me.property,
            gridSelRow,
			selModel = null,
			navModel = null,
			segTrbtn = null,
			segTrBtnVal = null,
			node = null,
			pNode = null,
			chlen, 
			c = 0, 
			chRecord,
			curNode = null,
            grid = me.up('ramcogrid');

		if (!grid)
			grid = me.up('ramcorstreegrid');
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		if (!grid) {
			grid = me.up('ramcosearchgrid');
		}
        if (record.get('isNew') && me.dataIndex === 'sel' && (grid && grid.xtype != "ramcorstreegrid"))
            return;
        if (prop) {
            record[prop] = checked;
            me.updater(cell, checked);
        } else {
            if (me.dataIndex == 'sel') {
                record.set(me.dataIndex, checked);
            } else {
                if (type == 'string')
                    record.set(me.dataIndex, checked ? "1" : "0");
                else if (type == 'int' || type == 'float' || type == 'number')
                    record.set(me.dataIndex, checked ? 1 : 0);
                else
                    record.set(me.dataIndex, checked);
            }
        }
        if (me.dataIndex == 'sel') {
            if (checked) {
                //record.store.nsr++;
				grid.store.nsr++;
            } else {
                //record.store.nsr--;
				grid.store.nsr--;
            }
        }
		if(grid.xtype == "ramcorstreegrid") {			
			selModel = grid.getSelectionModel();
			navModel = grid.getNavigationModel();
			segTrbtn = grid.getSegTreeBtnGroup();
			segTrBtnVal = segTrbtn.value;
			/*if (selectedRecLen > 0 && e.ctrlKey === false) {
				record.set(me.dataIndex, false);
				return false;
			}
			if (checked) {
				//selModel.doSelect(record, true);
				selModel.doMultiSelect(record, true)
			}
			else {
				selModel.doDeselect(record, true);
			}*/						
			if(!Ext.isEmpty(segTrBtnVal)) {
				pNode = node = grid.store.getNodeById(record.data.id);				
				if(segTrBtnVal != 0) {
					node = grid.store.getNodeById(record.data.id);
					chlen = node.childNodes.length;
					for(; c < chlen; c++) {
						chNode = node.childNodes[c];
						curNode = node
						if(segTrBtnVal == 1 || segTrBtnVal == 3) 
							curNode = chNode;
						if(checked)
							//selModel.doSelect(chNode, checked);
							selModel.doMultiSelect(curNode, checked);
						else
							//selModel.doDeselect(chNode, true);		
							selModel.doMultiSelect(curNode, false);
					}
					node.eachChild(function(n) {
						n.parentNode.cascadeBy(
							function(n)
							{									
								n.set('sel', checked);
							}
						);
					});
				}
				if(segTrBtnVal == 1 || segTrBtnVal == 3) {
					selModel.doDeselect(pNode, false);
					//selModel.doMultiSelect(pNode, checked)
					pNode.set('sel', 'false');
					//selModel.doDeselect(record, true);
				}
				else if(segTrBtnVal == 0 || segTrBtnVal == 2) {
					//selModel.doSelect(pNode, checked);
					selModel.doMultiSelect(pNode, checked)					
					//selModel.doSelect(record, checked);
				}
				if(checked == false) {
					pNode.set('sel', 'false');
					selModel.deselectAll();
				}
			}
		}
		//if(grid.xtype == "ramcorstreegrid")
			//return;
        gridSelRow = grid.down('#gridSelRow');
        if (gridSelRow)
            //gridSelRow.setValue(record.store.nsr + " Selected");
			gridSelRow.setValue(grid.store.nsr + " Selected");		
        //if (record.store.nsr == record.store.tr) {
		if (!me.checkEl)
			return;
		if (grid.store.nsr == grid.store.tr) {	
            me.checkEl.removeCls('x-column-header-unchecked');
            me.checkEl.addCls('x-column-header-checked');
        } else {
            if (me.checkEl && me.checkEl.hasCls('x-column-header-checked')) {
                me.checkEl.removeCls('x-column-header-checked');
                me.checkEl.addCls('x-column-header-unchecked');
            }
        }
    },

    updater: function(cell, value) {
        cell = Ext.fly(cell);
		if(cell){
	        value = (value == null) ? false : value;
	        var bValue = false;
	        if (Ext.isBoolean(value))
	            bValue = value;
	        else if (Ext.isNumber(value))
	            bValue = (value == 1);
	        else
	            bValue = (value == '1') || (value.toLowerCase() == 'true');
	        cell[this.disabled ? 'addCls' : 'removeCls'](this.disabledCls);
	        Ext.fly(cell.down(this.getView().innerSelector, true).firstChild)[bValue ? 'addCls' : 'removeCls'](Ext.baseCSSPrefix + 'grid-checkcolumn-checked');
		}
        //cell[bValue ? 'addCls' : 'removeCls'](Ext.baseCSSPrefix + 'grid-checkcolumn-checked');
    }
});

// Grid Template Column
Ext.define('Ext.ramco.grid.Template', {
    extend: 'Ext.ramco.grid.Column',
    xtype: 'ramcotemplatecolumn',
    tdCls: Ext.baseCSSPrefix + 'column-template',
    focusCls: '',
    config: {
        tplId: 'default',
        tpl: null
    },

    applyTpl: function(tpl) {
        if (Ext.isPrimitive(tpl) || !tpl.compile) {
            tpl = new Ext.XTemplate(tpl);
        }
        return tpl;
    },
	//TECH-35913
	initComponent: function() {
        var me = this;
		if (me.text === "&nbsp;") {
			me.text = "";
		}
		me.callParent();
	},

    defaultRenderer: function(value, metaData, record, rowIdx, colIdx, dataSource, view) {
        var me = this,
            xTpl = null,
			key,
			qtip = '', colCls = '',
			qTipObj, qTipTpl, qTipVal,
			returnValue,
            tmpTpl = me.tpl;
        if (metaData && metaData.column.dataIndex != "rn" && metaData.column.dataIndex != "sel") {
			qTipObj = record.data[metaData.column.dataIndex + "-stp"];
			if(!Ext.isEmpty(qTipObj)) {
				if (qTipObj.indexOf('{') < 0) {
					qTipTpl = 'inline';
					qTipVal = qTipObj;
				}
				else {
					var ilbo = me.up('ilbo');
					qTipTpl = Ext.decode(qTipObj, true) || {};
					var templateID = qTipTpl.tplid;
					if (qTipTpl && templateID) {
						qTip = ilbo.getTemplate(templateID,true);
						if (qTip)
							qTipVal = qTip.apply(qTipTpl);
					}
				}
			}
			colCls = record.data[metaData.column.dataIndex + "-css"];
			if (!Ext.isEmpty(colCls)){
				if(Ext.isEmpty(metaData.tdCls))
					metaData.tdCls = colCls;
				else
					metaData.tdCls += colCls;
			}
		}
        if (!Ext.isEmpty(value) && Ext.isString(value) && value.indexOf('{') == 0) {
            var ilbo = me.up('ilbo'),
                splittedPlaceHolder = [],
                valueJson = Ext.decode(value, true),
                templateID;
            if (valueJson && ilbo) {
                templateID = valueJson.tplid || me.tplId;
                xTpl = ilbo.getTemplate(templateID,templateID==me.tplId);
            }
			
			/* var qTip, qTipObj, qTipTpl, qTipVal;
			if (metaData && metaData.column.dataIndex != "rn" && metaData.column.dataIndex != "sel") {
				qTipObj = record.data[metaData.column.dataIndex + "-stp"];
				if(!Ext.isEmpty(qTipObj)) {
					if (qTipObj.indexOf('{') < 0) {
						qTipTpl = 'inline';
						qTipVal = qTipObj;
					}
					else {
						qTipTpl = Ext.decode(qTipObj, true) || {};
						templateID = qTipTpl.tplid;
						if (qTipTpl && templateID) {
							qTip = ilbo.getTemplate(templateID,true);
							if (qTip)
								qTipVal = qTip.apply(qTipTpl);
						}
					}
				}
            } */
            if (xTpl && xTpl.isTemplate) {
                if (xTpl.html.indexOf('#*#') != -1) {
                    xTpl.html.replace(/\{(.*?)\}/g, function(g0, g1) {
                        splittedPlaceHolder.push(g1);
                    })
                } else if (xTpl.img) {
                    var gView = me.up('ramcogrid'),
                        viewModel = ilbo.getViewModel(),
                        viewData = viewModel.getData(),
                        srcPath = '../document/ei',
                        fileUrl = null,
                        plhName = xTpl.plhName,
                        assview = xTpl.assview,
                        srcPath = xTpl.srcPath;
                    fileUrl = Ext.String.format(viewData.fileUrl, gView.itemId, xTpl.assview, record.data.rn, xTpl.srcPath);
                    valueJson[xTpl.plhName] = fileUrl;
                }
                if (splittedPlaceHolder.length > 0) {
                    obj = 0;
                    for (; obj < splittedPlaceHolder.length; obj++) {
                        placeHolders = splittedPlaceHolder[obj];
                        if (placeHolders.indexOf('#*#') != -1) {
                            var gView = me.up('ramcogrid'),
                                plhwithType = placeHolders.split('#*#'),
                                plhName = plhwithType[0],
                                plhType = plhwithType[1],
                                assview = plhwithType[2];
                            xTpl.html = xTpl.html.replace("{" + placeHolders + "}", "{" + plhName + "}");
                            switch (plhType) {
                                case "img":
                                    var viewModel = ilbo.getViewModel(),
                                        viewData = viewModel.getData(),
                                        srcPath = '../document/ei',
                                        fileUrl = null;
                                    xTpl.img = true;
                                    xTpl.plhName = plhName;
                                    xTpl.assview = assview;
                                    xTpl.srcPath = srcPath;
                                    fileUrl = Ext.String.format(viewData.fileUrl, gView.itemId, assview, record.data.rn, srcPath);
                                    valueJson[plhName] = fileUrl;
                                    break;
                            }
                        }
                    }
                }
				if (!Ext.isEmpty(qTipVal)) {
					var retVal = xTpl.apply(valueJson),
						noBorder = false; // Should comprise on user's request
					if (qTipTpl != 'inline') {
						qTipVal = Ext.util.Format.htmlEncode(qTipVal)
					}
					if (noBorder)
						return '<div data-qtip="' +  qTipVal + '" data-qclass="x-tip-noborder">' + retVal + '</div>';
					else
						return '<div data-qtip="' +  qTipVal + '">' + retVal + '</div>';
				}
				else
					return xTpl.apply(valueJson);
            } else {
                returnValue = [];
				for(key in valueJson){
					returnValue.push(valueJson[key]);	
				}
				return returnValue.join(" ");
            }
        } 
		else if (tmpTpl) {
			if(me.hasMasking){
				var rep,val,req,regRep,regCol,value,
					dataString = Ext.encode(record.data),
					data =  {};
				 data = Ext.decode(dataString,true);
				 regRep = me.regRep;
				 regCol = me.regCol;
				 rep = record.get(regRep);
                 val = record.get(regCol);
				 try{
					req = new RegExp(val, 'g');
				 }catch(e){
					 req = new RegExp(".", 'g');
				 }
				 value = data[me.dataIndex];
				 if(Ext.isEmpty(value)){
					 value = "";
				 }
				 data[me.dataIndex] = value.replace(req,rep);
				 return tmpTpl.apply(data);
			}
			else
				return tmpTpl.apply(record.data);
            
        } else {
			try {
				var ilbo = me.up('ilbo'),xTpl;
				xTpl = ilbo.getTemplate(value,true);
				if (xTpl && xTpl.isTemplate) {
					var splittedPlaceHolder = [],
						valueJson = Ext.decode(value, true),
						templateID, 
						format = me.getFormat(),
						grid = me.up('ramcogrid'),
						tempArr = {}, tempStr, col, dataType, dataIndex, dataVal, assTpl = [];
					if (!grid) 
						grid = me.up('ramcoexpgrid');					
					if (!grid) {
						grid = me.up('ramcotreegrid');
					}
					if (!grid) {
						grid = me.up('ramcorstreegrid');
					}
					tempStr = xTpl.html;
					tempStr.replace(/\{(.*?)\}/g, function(g0,g1){splittedPlaceHolder.push(g1);});
					
					for (var k = 0; grid && k < splittedPlaceHolder.length; k++) {
						dataIndex = 'v' + splittedPlaceHolder[k];
						col = grid.getColumnById(dataIndex);
						
						if (!dataIndex || !col)
							continue;
						
						dataType = col.dataType;
						dataVal = record.data[dataIndex];
						assTpl.push({index: splittedPlaceHolder[k], dt: dataType, val: dataVal, col: col});
						
						switch (dataType.toLowerCase()) {
							case "date":
								format = RamcoRTC.userPreference.dateFormat;
								if (new Date(dataVal) != 'Invalid Date')
									dataVal = Ext.util.Format.date(dataVal, format);
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
							case "date-time":
								format = RamcoRTC.userPreference.dateTimeFormat;
								dataVal = Ext.util.Format.date(dataVal, format);
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
							case "time":
								format = RamcoRTC.userPreference.timeFormat;
								dataVal = Ext.util.Format.date('1900-01-01 ' + dataVal, format);
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
							case "float":
							case "double":
							case "numeric":
							case "int":
							case "integer":
							case "long":
								format = col.getFormat();
								dataVal = col.formatNumeric(dataVal, format);
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
							default:
								tempArr[splittedPlaceHolder[k]] = dataVal;
								break;
						}					
					}
					me.assTpl = assTpl;
					//TECH-36394
					/* var qTip, qTipObj, qTipTpl, qTipVal;
					if (metaData && metaData.column.dataIndex != "rn" && metaData.column.dataIndex != "sel") {
						qTipObj = record.data[metaData.column.dataIndex + "-stp"];
						if(!Ext.isEmpty(qTipObj)) {
							if (qTipObj.indexOf('{') < 0) {
								qTipTpl = 'inline';
								qTipVal = qTipObj;
							}
							else {
								qTipTpl = Ext.decode(qTipObj, true) || {};
								templateID = qTipTpl.tplid;
								if (qTipTpl && templateID) {
									qTip = ilbo.getTemplate(templateID,true);
									if (qTip)
										qTipVal = qTip.apply(qTipTpl);
								}
							}
						}
					} */
					if (!Ext.isEmpty(qTipVal)) {
						var retVal = xTpl.apply(tempArr),
							noBorder = false; // Should comprise on user's request
						if (qTipTpl != 'inline') {
							qTipVal = Ext.util.Format.htmlEncode(qTipVal)
						}
						if (noBorder)
							return '<div data-qtip="' +  qTipVal + '" data-qclass="x-tip-noborder">' + retVal + '</div>';
						else
							return '<div data-qtip="' +  qTipVal + '">' + retVal + '</div>';
					}
					else
					return xTpl.apply(tempArr);
				}
				else {
		            /* if (me.task) {//TECH-30073
		                if (Ext.isEmpty(value)) {
		                    me['removeCls'](Ext.baseCSSPrefix + 'column-ramcolink');
		                } else {
		                    me['addCls'](Ext.baseCSSPrefix + 'column-ramcolink');
		                }
		            } */
					return me.callParent(arguments);
				}				
			}
			catch(ex) {}
        }
    },

    updater: function(cell, value,record,view) {
		var me=this;
        cell = Ext.fly(cell);

        cell[this.disabled ? 'addCls' : 'removeCls'](this.disabledCls);
		if(me.hasMasking){
			var rep,val,req,regRep,regCol,value,
				dataString = Ext.encode(record.data),
				data =  {},
				tmpTpl = me.tpl;
			 data = Ext.decode(dataString,true);
			 regRep = me.regRep;
			 regCol = me.regCol;
			 rep = record.get(regRep);
			 val = record.get(regCol);
			 try{
				req = new RegExp(val, 'g');
			 }catch(e){
				 req = new RegExp(".", 'g');
			 }
			 value = data[me.dataIndex];
			 if(Ext.isEmpty(value)){
				 value = "";
			 }
			 data[me.dataIndex] = value.replace(req,rep);
			 value =  tmpTpl.apply(data);
			 var inner = Ext.get(cell).first();
			 if(inner)
				 inner.setHtml(value);
		}
		
        //cell.innerHTML = value;
    }
});

// Grid Link Column
Ext.define('Ext.ramco.grid.Link', {
    extend: 'Ext.ramco.grid.Column',

    xtype: 'linkcolumn',
    tdCls: Ext.baseCSSPrefix + 'column-ramcolink',
    config: {
        dataType: 'link',
        tpl: null
    },

    applyTpl: function(tpl) {
        if (Ext.isPrimitive(tpl) || !tpl.compile) {
            tpl = new Ext.XTemplate(tpl);
        }
        return tpl;
    },

    defaultRenderer: function(value, metaData, record, rowIdx, colIdx, dataSource, view) {
        var me = this,
			key,
			returnValue,
            xTpl = null,
			dIdx = me.dataIndex,
			dataType = me.getDataType(),
			format = me.getFormat(),
			qtip, colCls, dataqTip, style = '';
		 if (metaData && dIdx != "rn" && dIdx != "sel") {
            qtip = record.data[dIdx + "-stp"];
			colCls = record.data[dIdx + "-css"];
			if (!Ext.isEmpty(colCls)) {
				if(Ext.isEmpty(metaData.tdCls))
					metaData.tdCls = colCls;
				else
					metaData.tdCls += colCls;
			}
		}
		
		/* DYNAMIC TOOLTIP HANDLING - HOLD FOR PURPOSE - NEED TO KNOW DOM (PRE tag causing color change) */
		
        /* qtip = !Ext.isEmpty(qtip) ? qtip : null;		
		if(me.headerWrap)
			style += ' overflow: auto';
		else
			style += ' white-space: nowrap;';

		if (Ext.isEmpty(qtip)) {
			returnValue = '<pre style="' + style + '">' + value + '</pre>';
		} else {
			dataqTip = Ext.util.Format.stripTags(qtip);
			returnValue = formatGridColValue('pre', style, dataqTip, value);
		} */
		// TECH-35659
		value = !Ext.isEmpty(value) ? value : "";
		
		// TECH-31669
		switch(dataType)
		{
			case "float":
            case "double":
            case "numeric":
            case "int":
            case "integer":
            case "long":
                returnValue = me.formatNumeric(value, format);
				break;
			default:
				returnValue = value;
				break;
		}
		
		/* DYNAMIC TOOLTIP HANDLING - HOLD FOR PURPOSE - NEED TO KNOW DOM (PRE tag causing color change) */
		//TECH-34390 /LH-417 /ANZ-318
        qtip = !Ext.isEmpty(qtip) ? qtip : returnValue;		
		if(me.headerWrap)
			style += ' overflow: auto';
		else
			style += ' white-space: nowrap;';
		//TECH-34390 /LH-417 /ANZ-318
		if (!Ext.isEmpty(qtip)) {
			dataqTip = Ext.util.Format.stripTags(qtip);
			returnValue = formatGridColValue('pre', style, dataqTip, returnValue);
		}else{
			// TECH-35252
			//returnValue = '<pre style="' + style + '">' + value + '</pre>';
			returnValue = '<pre style="' + style + '">' + returnValue + '</pre>';
		}
		
        if (!Ext.isEmpty(value) && Ext.isString(value) && value.indexOf('{') == 0) {
            var ilbo = me.up('ilbo'),
                valueJson = Ext.decode(value, true),
                templateID;
            if (valueJson && ilbo) {
                templateID = valueJson.tplid || me.tplId;
                xTpl = ilbo.getTemplate(templateID,templateID==me.tplId);
                if (Ext.isEmpty(xTpl))
                    xTpl = me.getTpl()
                if (xTpl && xTpl.isTemplate) {
                    return xTpl.apply(valueJson);
                } else {
					returnValue = [];
					for(key in valueJson){
						returnValue.push(valueJson[key]);	
					}
					value = returnValue.join(" ");					
                    //value = "Template not found for " + templateID;
                }
            }
			return value;
        }
        //return (returnValue) ? returnValue : value;
        return returnValue;//TECH-34390 /LH-417 /ANZ-318
    },
	// TECH-31669
	formatNumber: function(value, prec) {
		try {
			var me = this,
				thousandSep = Ext.util.Format.thousandSeparator,
				decSep = Ext.util.Format.decimalSeparator,
				tempValue = "00000000000000000000",
				splitVal = [], valueObj = value, decObj = "0", returnVal;
			
			if (!Ext.isEmpty(value))
				value = value.toString();
			
			if (value.indexOf(decSep) >= 0) {
				splitVal = value.split(decSep);
				if (splitVal && splitVal.length > 1) {
					valueObj = splitVal[0];
					decObj = splitVal[1];
				}
			}
			
			splitVal = String(valueObj).replace(new RegExp('[/' + thousandSep + "]", 'g'), "");
			if (!Ext.isEmpty(decObj)) {
				if(String(decObj).length < prec)
					decObj = decObj + tempValue.substring(0, prec - String(decObj).length);
				decObj = decObj.substring(0,prec);
			}
			else
				valueObj = value;
			
			if(valueObj != "" && valueObj.length == 1 && valueObj == "-")
				valueObj = valueObj + 0;
			//TECH-32220
			if(prec > 0)
				returnVal =   valueObj + decSep + decObj;
			else if(prec  == 0)
				returnVal =   valueObj;
			//returnVal =   valueObj + decSep + decObj;
			
			var tmpv = parseInt(returnVal, 10);
			if(isNaN(tmpv))
				returnVal = "";
			
			return returnVal;
		}
		catch(ex) {}		
	},
	// TECH-31669
	formatNumeric: function(value, dataType) {
		if(Ext.isEmpty(value))
			return "";			
        var tempNum = '999999999999999999',
			n1, n2, num, num1,num2;
        dataType = dataType ? parseInt(dataType, 10) : 0;
        if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "no grouping") {
            format = '9.' + tempNum.substring(0, dataType)
        } else {
            format = '9,9.' + tempNum.substring(0, dataType)
        }
        Ext.util.Format.thousandSeparator = RamcoRTC.userPreference.numgroupsymbol;
        Ext.util.Format.decimalSeparator = RamcoRTC.userPreference.decimalseparator;
		var numGroupStyle = RamcoRTC.userPreference.numgroupstyle.toLowerCase();
		if (!Ext.isEmpty(numGroupStyle) && numGroupStyle != 'no grouping') {//TECH-33327
			num2 = (value) ? parseFloat(value) : 0;
         	num2 = parseFloat(this.formatNumber(num2, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
			if (numGroupStyle == "lakh based")
				n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			else if (numGroupStyle == "million based")
				n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
			
			num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
		}else{
			if (dataType == null || dataType == 0){
				//TECH-32220
				num = this.formatNumber(value, 0);
				/*if (!Ext.isEmpty(num))//TECH-33327
					num = Ext.util.Format.number(num, "0");*/
			}
			else{
				//TECH-32220
				num = this.formatNumber(value,dataType);
            	/* if (!Ext.isEmpty(num))//TECH-33327
					num = Ext.util.Format.number(num, format); */
			}
		}
        /*if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "lakh based") {
            num2 = (value) ? parseFloat(value) : 0;
			num2 = parseFloat(this.formatNumber(num2, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
            n1 = n1[0].replace(/(\d)(?=(\d\d)+\d$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        }else if (RamcoRTC.userPreference.numgroupstyle.toLowerCase() == "million based") {//TECH-33327
			num2 = (value) ? parseFloat(value) : 0;
         	num2 = parseFloat(this.formatNumber(num2, dataType));
            num1 = num2.toFixed(dataType);
            n1 = num1.split('.');
            n2 = n1[1] || null;
	       // n1 = n1[0].replace(/(?<!\.)(\d)(?=(\d{3})+(\.|$))/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
	        n1 = n1[0].replace(/(\d)(?=(\d{3})+$)/g, "$1" + RamcoRTC.userPreference.numgroupsymbol);
            num = n2 ? n1 + RamcoRTC.userPreference.decimalseparator + n2 : n1;
        }
		else {
			if (dataType == null || dataType == 0) {
				num = this.formatNumber(value, 0);
				// if (!Ext.isEmpty(num))//TECH-33327
				//	num = Ext.util.Format.number(num, "0");
			}
			else {
				num = this.formatNumber(value, dataType);
				// if (!Ext.isEmpty(num))
				//	num = Ext.util.Format.number(num, format); 
			}
        }*/
        var neg = false;
		if(Ext.isNumber(num))//TECH-33327
			num = num.toString();
        if (num.indexOf('-') != -1)
            neg = true;
        if (neg) {
            var numNegStyle = RamcoRTC.userPreference.numnegativestle;
            switch (numNegStyle) {
                case "(1.1)":
                    num = "(" + num.replace("-", "") + ")";
                    break;

                case "- 1.1":
                    num = num.replace("-", "- ");
                    break;

                case "1.1-":
                    num = num.replace("-", "") + "-";
                    break;

                case "1.1 -":
                    num = num.replace("-", "") + " -";
                    break;

                case "()1.1":
                    num = "()" + num.replace("-", "");
                    break;

                case "(-)1.1":
                    num = "(-)" + num.replace("-", "");
                    break;
                default:
                    num = "-" + num.replace("-", "");
                    break;
            }
        }
        return num;
    },
});

// Grid Link Image Column
Ext.define('Ext.ramco.grid.LinkImage', {
    extend: 'Ext.ramco.grid.Column',

    xtype: 'linkimagecolumn',
    tdCls: Ext.baseCSSPrefix + 'column-ramcolinkimage',
    config: {
        dataType: 'link'
    },

    defaultRenderer: function(value, metaData, record, rowIdx, colIdx, dataSource, view) {
        var me = this,
            ilbo = me.up('ilbo'),
            componentName = ilbo && ilbo.ilboConfig ? ilbo.ilboConfig.componentName : '';
        if (!Ext.isEmpty(value)) {
            value = value.replace('../../../', '');
            if (value.toLowerCase().indexOf(componentName) < 0)
                value = "app/classic/" + componentName + "/" + value;
            value = '<img class="x-grid-cell-image" src="' + value + '"></img>';
        }
        return value;
    }
});

// Grid Action Column
Ext.define('Ext.ramco.grid.Action', {
    extend: 'Ext.ramco.grid.Column',
    alias: ['widget.ramcoactioncolumn'], // TECH-34273
    alternateClassName: 'Ext.grid.ActionColumn',
    tdCls: Ext.baseCSSPrefix + 'column-actioncolumn',
    stopSelection: true,
    actionIdRe: new RegExp(Ext.baseCSSPrefix + 'action-col-(\\d+)'),
    altText: '',
    menuText: '<i>Actions</i>',
    ignoreExport: true,
    sortable: false,
    innerCls: Ext.baseCSSPrefix + 'grid-cell-inner-action-col',
    actionIconCls: Ext.baseCSSPrefix + 'action-col-icon',
    constructor: function(config) {
        var me = this,
            cfg = Ext.apply({}, config),
            items = cfg.items || me.items || [me],
			iconCls = cfg.iconCls,
            hasGetClass,
            i,
            len;

        me.origRenderer = cfg.renderer || me.renderer;
        me.origScope = cfg.scope || me.scope;

        me.renderer = me.scope = cfg.renderer = cfg.scope = null;
        cfg.items = null;
		cfg.iconCls = null;
        me.callParent([cfg]);
		
		// TECH-34273
		
		//if (cfg.xtype === 'attachcolumn' && items.length > 0) {		
        
        for (i = 0, len = items.length; i < len; ++i) {
			// TECH-34273
			if (Ext.isEmpty(items[i].iconCls))
				items[i].iconCls = iconCls;
            if (items[i].getClass) {
                hasGetClass = true;
            }
        }
		
		me.items = items;

        // Also need to check for getClass, since it changes how the cell renders
        if (me.origRenderer || hasGetClass) {
            me.hasCustomRenderer = true;
        }
    },

    initComponent: function() {
        var me = this;
        me.callParent();
        if (me.sortable && !me.dataIndex) {
            me.sortable = false;
        }
    },

    defaultRenderer: function(v, cellValues, record, rowIdx, colIdx, store, view) {
        var me = this,
            scope = me.origScope || me,
            items = me.items,
            len = items.length,
            i, item, ret, disabled, tooltip, altText, icon;
        ret = Ext.isFunction(me.origRenderer) ? me.origRenderer.apply(scope, arguments) || '' : '';

        cellValues.tdCls += ' ' + Ext.baseCSSPrefix + 'action-col-cell';
        for (i = 0; i < len; i++) {
            item = items[i];
            icon = item.icon;

            disabled = item.disabled || (item.isDisabled ? item.isDisabled.call(item.scope || scope, view, rowIdx, colIdx, item, record) : false);
            tooltip = disabled ? null : (item.tooltip || (item.getTip ? item.getTip.apply(item.scope || scope, arguments) : null));
            altText = item.getAltText ? item.getAltText.apply(item.scope || scope, arguments) : item.altText || me.altText;

            // Only process the item action setup once.
            if (!item.hasActionConfiguration) {
                // Apply our documented default to all items
                item.stopSelection = me.stopSelection;
                item.disable = Ext.Function.bind(me.disableAction, me, [i], 0);
                item.enable = Ext.Function.bind(me.enableAction, me, [i], 0);
                item.hasActionConfiguration = true;
            }

            ret += '<' + (icon ? 'img' : 'div') + ' tabIndex="0" role="button"' + (icon ? (' alt="' + altText + '" src="' + item.icon + '"') : '') +
                ' class="' + me.actionIconCls + ' ' + Ext.baseCSSPrefix + 'action-col-' + String(i) + ' ' +
                (disabled ? me.disabledCls + ' ' : ' ') +
                (Ext.isFunction(item.getClass) ? item.getClass.apply(item.scope || scope, arguments) : (item.iconCls || me.iconCls || '')) + '"' +
                (tooltip ? ' data-qtip="' + tooltip + '"' : '') + (icon ? '/>' : '></div>');
        }
        return ret;
    },

    updater: function(cell, value, record, view, dataSource) {
        var cellValues = {};
        Ext.fly(cell).addCls(cellValues.tdCls).down(this.getView().innerSelector, true).innerHTML = this.defaultRenderer(value, cellValues, record, null, null, dataSource, view);
    },

    enableAction: function(index, silent) {
        var me = this;

        if (!index) {
            index = 0;
        } else if (!Ext.isNumber(index)) {
            index = Ext.Array.indexOf(me.items, index);
        }
        me.items[index].disabled = false;
        me.up('tablepanel').el.select('.' + Ext.baseCSSPrefix + 'action-col-' + index).removeCls(me.disabledCls);
        if (!silent) {
            me.fireEvent('enable', me);
        }
    },

    disableAction: function(index, silent) {
        var me = this;

        if (!index) {
            index = 0;
        } else if (!Ext.isNumber(index)) {
            index = Ext.Array.indexOf(me.items, index);
        }
        me.items[index].disabled = true;
        me.up('tablepanel').el.select('.' + Ext.baseCSSPrefix + 'action-col-' + index).addCls(me.disabledCls);
        if (!silent) {
            me.fireEvent('disable', me);
        }
    },

    beforeDestroy: function() {
        this.renderer = this.items = null;
        return this.callParent(arguments);
    },
    doDestroy: function() {
        // Action column items property is an array, unlike the normal Container's MixedCollection.
        // If we don't null it here, parent doDestroy() can blow up.
        this.renderer = this.items = null;

        return this.callParent();
    },
    processEvent: function(type, view, cell, recordIndex, cellIndex, e, record, row) {
        var me = this,
            target = e.getTarget(),
            key = type === 'keydown' && e.getKey(),
            match,
            item,
            disabled,
            cellFly = Ext.fly(cell);

        // Flag event to tell SelectionModel not to process it.
        e.stopSelection = !key && me.stopSelection;
        if (key && (target === cell || !cellFly.contains(target))) {
            target = cellFly.query('.' + me.actionIconCls, true);
            if (target.length === 1) {
                target = target[0];
            } else {
                return;
            }
        }

        // NOTE: The statement below tests the truthiness of an assignment.
        if (target && (match = target.className.match(me.actionIdRe))) {
            item = me.items[parseInt(match[1], 10)];
            disabled = item.disabled || (item.isDisabled ? item.isDisabled.call(item.scope || me.origScope || me, view, recordIndex, cellIndex, item, record) : false);
            if (item && !disabled) {

                // Do not allow focus to follow from this mousedown unless the grid is already in actionable mode
                if (type === 'mousedown' && !me.getView().actionableMode) {
                    e.preventDefault();
                } else if (type === 'click' || (key === e.ENTER || key === e.SPACE)) {
                    Ext.callback(item.handler || me.handler, item.scope || me.origScope, [view, recordIndex, cellIndex, item, e, record, row], undefined, me);

                    // If the handler moved focus outside of the view, do not allow this event to propagate
                    // to cause any navigation.
                    if (!view.el.contains(Ext.Element.getActiveElement())) {
                        return false;
                    }
                }
            }
        }

        return me.callParent(arguments);
    },

    cascade: function(fn, scope) {
        fn.call(scope || this, this);
    },
    getRefItems: function() {
        return [];
    },

    privates: {
        getFocusables: function() {
            return [];
        },
        shouldUpdateCell: function() {
            return 2;
        }
    }
});

// Grid File Attach
Ext.define('Ext.ramco.grid.FileAttach', {
    extend: 'Ext.ramco.grid.Action',
    xtype: 'fileattachcolumn',
    tdCls: Ext.baseCSSPrefix + 'column-fileattachcolumn',
    browseIcon: true,
    dView: null,
    config: {
        dbFileUrl: null,
        saveToDb: false,
        hasLink: false,
        staticName: null,
        format: '',
        fileUrl: null,
        srcPath: null,
        assView: null,
        mode: null,
        dView: null,
        src: null,
		hdnFileId: null,		
		autoFileName: true
    },
    items: [{
        iconCls: 'x-fa fa-paperclip',
        tooltip: 'Attach',
		//TECH-32573        
		//handler: function(grid, rowIndex, colIndex, attach, e, rec, row) {
		handler: function(view, rowIndex, colIndex, attach, e, rec, row, cell) {
            var me = this,
                btn = me.btn;
            //me.rowIndex = rowIndex;
            me.rowIndex = rec.get('rn');
            me.colIndex = colIndex;
			//TECH-32573
			if (cell) {
				view.ownerGrid.col = cell.cellIndex;
			}
            if (!btn.rendered)
                btn.render(me.el.dom);
            btn.reset();
			// TECH-26919 - MPTU-42
			rec.dirty = true; // TECH-32997
			btn.on('change', me.onBtnUploadClick, me);
            e.stopPropagation();
            btn.fileInputEl.dom.click();
        }
    }, {
        iconCls: 'x-fa fa-close',
        itemId: 'btnDelete',
        tooltip: rvw_resources.R138,
        hidden: true,
        handler: function(grid, rowIndex, colIndex) {
            // TECH-32997
			var me = this,
				rec = arguments[5],
				rowIndex = rec && rec.get('rn');
				rowIndex = rowIndex - 1;
            me.deleteFile(grid, rowIndex, colIndex);
        }
    }],
    initComponent: function() {
        var me = this,
            btn = Ext.create('Ext.ramco.Button.FileBrowse', {
                role: 'uipage',
                itemId: 'browseBtn',
                text: '',
                hidden: true,
                uploadFile: true,
                srcCtrl: me.srcCtrl
            });
        me.btn = btn;
		if(me.srcPath == "/") {
			me.srcPath = "./";
		}
        me.callParent();
    },
    onChange: function(btn, e, value) {
        var me = this,
            grid = me.up('ramcogrid');
        if (grid)
            grid.fireEvent('attach', btn, e, value);
    },
    defaultRenderer: function(v, cellValues, record, rowIdx, colIdx, store, view) {
        var me = this,
            staticName = me.getStaticName(),
            scope = me.origScope || me,
            items = me.items,
            style = '',
            len = items.length,
            i, item, ret, disabled, tooltip, altText, icon,
			//TECH-30433
			//grid = me.up('ramcogrid');
			//deleteCtrl = grid.down('[xtype=deletecolumn]');
			grid = null,
			deleteCtrl = null;
		//TECH-30433
		grid = me.up('ramcogrid');	
		if (!grid) {
			grid = me.up('ramcotreegrid');
		}			
		if (!grid) {
			grid = me.up('ramcoddtgrid');				
		}
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		deleteCtrl = grid.down('[xtype=deletecolumn]');
        ret = Ext.isFunction(me.origRenderer) ? me.origRenderer.apply(scope, arguments) || '' : '';
        v = Ext.isEmpty(v) ? '' : v;
        v = Ext.isEmpty(staticName) ? v : staticName;
        if (deleteCtrl) {
            if (!Ext.isEmpty(v) && me.getSrcPath()) {
                deleteCtrl.items[0].hidden = false;
                deleteCtrl.setSrcPath(me.getSrcPath());
            } else
                deleteCtrl.items[0].hidden = true;
        }

        cellValues.tdCls += ' ' + Ext.baseCSSPrefix + 'action-col-cell';
        if (me.browseIcon) {
            for (i = 0; i < len; i++) {
                item = items[i];
                icon = item.icon;

                disabled = item.disabled || (item.isDisabled ? item.isDisabled.call(item.scope || scope, view, rowIdx, colIdx, item, record) : false);
                tooltip = disabled ? null : (item.tooltip || (item.getTip ? item.getTip.apply(item.scope || scope, arguments) : null));
                altText = item.getAltText ? item.getAltText.apply(item.scope || scope, arguments) : item.altText || me.altText;

                if (!item.hasActionConfiguration) {
                    item.stopSelection = me.stopSelection;
                    item.disable = Ext.Function.bind(me.disableAction, me, [i], 0);
                    item.enable = Ext.Function.bind(me.enableAction, me, [i], 0);
                    item.hasActionConfiguration = true;
                }
                style = '';
                if (i == 1 && !v)
				    style = ' style="display:none;" ';
                ret += '<' + (icon ? 'img' : 'div') + ' tabIndex="0" role="button"' + style + (icon ? (' alt="' + altText + '" src="' + item.icon + '"') : '') +
                    ' class="' + me.actionIconCls + ' ' + Ext.baseCSSPrefix + 'action-col-' + String(i) + ' ' +
                    (disabled ? me.disabledCls + ' ' : ' ') +
                    (Ext.isFunction(item.getClass) ? item.getClass.apply(item.scope || scope, arguments) : (item.iconCls || me.iconCls || '')) + '"' +
                    (tooltip ? ' data-qtip="' + tooltip + '"' : '') + (icon ? '/>' : '></div>');
            }
        }
        if (!Ext.isEmpty(v) && Ext.isString(v) && v.indexOf('{') == 0) {
            var ilbo = me.up('ilbo'),
                valueJson = Ext.decode(v, true),
                templateID;
            if (valueJson && ilbo) {
                templateID = valueJson.tplid || me.tplId;
                xTpl = ilbo.getTemplate(templateID);
                if (Ext.isEmpty(xTpl))
                    xTpl = me.getTpl()
                if (xTpl && xTpl.isTemplate) {
                    v = xTpl.apply(valueJson);
                } else {
                    v = "Template not found for " + templateID;
                }
            }
            ret = v;
        } else
            ret += "<div role='download' class='x-download'>" + v + "</div>";
        return ret;
    },
    processEvent: function(type, view, cell, recordIndex, cellIndex, e, record, row) {
        var me = this,
            target = e.getTarget(),
            key = type === 'keydown' && e.getKey(),
            match,
            item,
            disabled,
            cellFly = Ext.fly(cell);

        // Flag event to tell SelectionModel not to process it.
        e.stopSelection = !key && me.stopSelection;

        // If the target was not within a cell (ie it's a keydown event from the View), then
        // IF there's only one action icon, action it. If there is more than one, the user must
        // invoke actionable mode to navigate into the cell.
        if (key && (target === cell || !cellFly.contains(target))) {
            target = cellFly.query('.' + me.actionIconCls, true);
            if (target.length === 1) {
                target = target[0];
            } else {
                return;
            }
        }
        if (type === 'click') {
            var el = Ext.fly(e.target),
				elup,
                div = el ? el.down('div') : null,
                attributes = el ? el.getAttributes() : {},
                newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null,
                taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
                linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
                args = [];
                download = el ? el.getAttribute('role') : null;
            if (download == 'download') {
                e.preventDefault();
				//TECH-30668				
                //me.downloadFile(record.get('rn'));
				me.downloadFile(record);
                return true;
            }
            if (!taskInfo && el) {
                elup = el.up('div[taskinfo]') || el.down('div[taskinfo]');
                taskInfo = elup ? elup.getAttribute('taskinfo') : null;
            }            
            if (taskInfo) {                
                args = args.concat(TaskInfoToObjectArray(taskInfo));
				//TECH-30668				
				//me.downloadFile(record.get('rn'), args);                
				me.downloadFile(record, args);
                return true;
            }
        }
		//TECH-32573
		if (cell) {
            me.col = cell.cellIndex;
        }
        // NOTE: The statement below tests the truthiness of an assignment.
        if (target && (match = target.className.match(me.actionIdRe))) {
            item = me.items[parseInt(match[1], 10)];
            disabled = item.disabled || (item.isDisabled ? item.isDisabled.call(item.scope || me.origScope || me, view, recordIndex, cellIndex, item, record) : false);
            if (item && !disabled) {

                // Do not allow focus to follow from this mousedown unless the grid is already in actionable mode
                if (type === 'mousedown' && !me.getView().actionableMode) {
                    e.preventDefault();
                }
				//TECH-32573 
				else if (type === 'click' || (key === e.ENTER || key === e.SPACE)) {
                    //Ext.callback(item.handler || me.handler, item.scope || me.origScope, [view, recordIndex, cellIndex, item, e, record, row], undefined, me);
					Ext.callback(item.handler || me.handler, item.scope || me.origScope, [view, recordIndex, cellIndex, item, e, record, row, cell], undefined, me);

                    // If the handler moved focus outside of the view, do not allow this event to propagate
                    // to cause any navigation.
                    if (!view.el.contains(Ext.Element.getActiveElement())) {
                        return false;
                    }
                }
            }
        }

        //return me.callParent(arguments);
    },
	//TECH-30668				
    //downloadFile: function(row, args) {
	downloadFile: function(record, args) {	
        var me = this,
            src = null
        ilbo = me.up('ilbo'),
            grid = me.up('ramcogrid'),
			//TECH-30433
            //grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid')),			
            saveToDb = me.getSaveToDb(),
            hasLink = me.getHasLink(),
			//TECH-30433
            //itemId = grid.getItemId(),
			itemId = null,
            view = me.name || me.getItemId(),
            srcPath = me.getSrcPath(),
            assView = me.getAssView(),
			hdnFileId = me.getHdnFileId(),			
            mode = me.getMode(),
            dView = me.getDView(),
            dbFileUrl = ilbo ? ilbo.dbFileUrl : '',
            fileUrl = ilbo ? ilbo.fileUrl : '',
			fileName = ''; //TECH-33654
			
		//TECH-30433	
		if (!grid) {
			grid = me.up('ramcotreegrid');
		}			
		if (!grid) {
			grid = me.up('ramcoddtgrid');				
		}
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		itemId = grid.getItemId();
		if(args && args[1] == "browsedownload") {
			view = args[9];
		}
		//TECH-30668				
		if (grid.xtype == "ramcorstreegrid")
			row = record.get("in");
		else
			row = record.get("rn");
		
		//TECH-33654
		if (!Ext.isEmpty(assView)) {
			fileName = record.get(assView);
		}
		if (Ext.isEmpty(fileName)) {
			fileName = record.get("v" + view);
		}
		
        if (saveToDb) {
            src = Ext.String.format(dbFileUrl, itemId, assView, (row), srcPath, view);
        } else {
            //src = Ext.String.format(fileUrl, itemId, view, (row + 1), srcPath, dView, mode);
			src = Ext.String.format(fileUrl, itemId, view, (row), srcPath, assView, mode);
        }
		if(hdnFileId)
			src += "&RVWRTQS_CONTROL_HIDDENVIEW=" + hdnFileId;
		//window.open(src);
		//TECH-33654
		//openWindow(src);
		if (!Ext.isEmpty(fileName)) {
			openWindow(src);
		}
    },
    onBtnUploadClick: function() {
        var me = this,
            grid = me.up('ramcogrid'),
            fields = null,
            formData = new FormData(),
			file,fileSize;
        grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));
        formData.srcPath = me.getSrcPath();
        formData.controlName = grid.itemId;
        formData.controlViewName = me.name || me.itemId;
		formData.saveToDb = me.saveToDb;
        formData.assView = me.assView;
        //formData.controlRowNo = me.rowIndex + 1;
        formData.controlRowNo = me.rowIndex;
		if (me.hdnFileId)
			formData.hdnFileId = me.getHdnFileId();
		if (me.autoFileName)
			formData.autoFileName = me.getAutoFileName();
        fileInput = me.btn.fileInputEl.dom;
		file = (fileInput && fileInput.files.length > 0) ? fileInput.files[0] : null;
		fileSize = (fileInput && file.size) ? file.size : 0;
		//TECH-32573
		me.fireEvent('ctrlfocus', grid.itemId || grid.parentId, me.dataIndex.replace('v', ''),  me.rowIndex);
		var ilboView = me.up('ilbo'),
			controller = (ilboView) ? ilboView.getController() : null,
			errorText, fileExtension, fileObj, maxFileSize; // TECH-34521
			
		// TECH-34521
		maxFileSize = (!Ext.isEmpty(me.maxFileSize)) ? me.maxFileSize : (RamcoRTC.settings.fileUploadMaxSize || 2);
		
		if (file && !Ext.isEmpty(me.acceptFormat)) {
			fileObj = (file.name) ? file.name.split('.') : null;
			if (fileObj) {
				fileExtension = fileObj[fileObj.length - 1];				
				if (fileExtension && me.acceptFormat.indexOf(fileExtension) < 0) {
					errorText = Ext.String.format('The allowed file type[s]: {0}', me.acceptFormat);
					Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
					return false;
				}
			}
		}
		
		if (fileSize == 0) {
			errorText = Ext.String.format(rvw_resources.R261, fileSize);
			if(controller)
				controller.taskPending = false;
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			return false;
		}
		// TECH-34521
		else if ( fileSize > maxFileSize * BYTES_PER_CHUNK ) {
			errorText = Ext.String.format(rvw_resources.R262, maxFileSize);
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			if(controller)
				controller.taskPending = false;
			return false;
		}
		else {
			formData.append('file', fileInput.files[0]);
			formData.file = fileInput.files[0];
			grid.fireEvent('uploadfile', grid, formData, '', me);
		}
    },
    deleteFile: function(grid, rowIndex, colIndex) {
        var me = this,
            grid = me.up('ramcogrid');
        grid.fireEvent('deletefile', me, grid, rowIndex, me.getSrcPath(), me.dView);
    },
    applySrcPath: function(srcPath) {
        return srcPath.replace('..\\', '');
    },
	destroy:function(){
		var me = this,			
			btn = me.btn;		
		if (btn) {
			btn.un('change', me.onBtnUploadClick, me);
			Ext.destroy(btn);
		}
		me.callParent();
    }
});

// Grid Attach
Ext.define('Ext.ramco.grid.Attach', {
    extend: 'Ext.ramco.grid.Action',
    xtype: 'attachcolumn',
    tdCls: Ext.baseCSSPrefix + 'column-attachcolumn',
    config: {
        srcPath: null,
        srcCtrl: null,
        format: '',
        btn: true,
        hasLink: true
    },
    items: [{
        xtype: 'filebutton',
        iconCls: 'x-fa fa-copy',
        tooltip: rvw_resources.R139,
        handler: function(grid, rowIndex, colIndex) {
            var me = this,
                btn = me.btn;
            btn.rowIndex = rowIndex;
            btn.colIndex = colIndex;
            if (!btn.rendered)
                btn.render(me.el.dom);
            //TECH-39940
			//btn.fileInputEl.dom.click();
            btn.on('change', me.onChange, me);
            btn.fileInputEl.dom.click();
        }
    }],
    initComponent: function() {
        var me = this,
            btn = Ext.create('Ext.ramco.Button.FileBrowse', {
                role: 'uipage',
                itemId: 'browseBtn',
                text: '',
                hidden: true,
                uploadFile: true,
                srcCtrl: me.srcCtrl
            });
        me.btn = btn;
        me.callParent();
    },
    onChange: function(btn, e, value) {
        var me = this,
            grid = me.up('ramcogrid');
        if (grid)
            grid.fireEvent('attach', btn, e, value);
    },
    applySrcPath: function(srcPath) {
        return srcPath.replace('..\\', '');
    },
	destroy:function(){
		var me =this;
		if (btn) {
			btn.un('change', me.onChange, me);
			Ext.destroy(btn);
		}
		me.callParent();
    }
});
//  Attachcontrol
Ext.define('Ext.ramco.grid.AttachColumn', {
    extend: 'Ext.ramco.grid.Action',
    xtype: 'attachcolumn',
    tdCls: Ext.baseCSSPrefix + 'column-fileattachcolumn',
    browseIcon: true,
    dView: null,
    config: {
        dbFileUrl: null,
        saveToDb: false,
        hasLink: false,
        staticName: null,
        format: '',
        fileUrl: null,
        srcPath: null,
        assView: null,
        mode: null,
        dView: null,
        src: null,
		autoFileName: true //TECH-30745
    },
    items: [{
        iconCls: 'x-fa fa-paperclip',
        tooltip: rvw_resources.R061,
        handler: function(grid, rowIndex, colIndex, attach, e, rec) {
            var me = this,
                btn = me.btn;
            //me.rowIndex = rowIndex;
            me.rowIndex = rec.get('rn');
            me.colIndex = colIndex;
            if (!btn.rendered)
                btn.render(me.el.dom);
            btn.reset();
            btn.fileInputEl.dom.click();
            btn.on('change', me.onBtnUploadClick, me);
            e.stopPropagation();
        }
    }],
    initComponent: function() {
        var me = this,
            btn = Ext.create('Ext.ramco.Button.FileBrowse', {
                role: 'uipage',
                itemId: 'browseBtn',
                text: '',
                hidden: true,
                uploadFile: true,
                srcCtrl: me.srcCtrl
            });
        me.btn = btn;
		if(me.srcPath == "/") {
			me.srcPath = "./";
		}
        me.callParent();
    },
    onBtnUploadClick: function() {
        var me = this,
            grid = me.up('ramcogrid'),
            grid = grid ? grid : me.up('ramcotreegrid'),
            fields = null,
			assCol = null,
            formData = new FormData(),
			file,fileSize;
        fileCtrl = grid.down('[xtype=fileattachcolumn]');
        if (fileCtrl)
            formData.srcPath = fileCtrl.getSrcPath();
        else
            formData.srcPath = me.getSrcPath();
        formData.controlName = grid.itemId;
        if (me.xtype == 'attachcolumn') {
            //formData.controlViewName = parseInt(me.name) + 1;
            formData.controlViewName = parseInt(me.assView) || (parseInt(me.name) + 1);
			assCol = grid.getColumnById("v" + formData.controlViewName);
			formData.saveToDb = assCol.saveToDb;
			formData.assView = assCol.assView;
			formData.srcPath = assCol.getSrcPath();
		}
        else {
            formData.controlViewName = me.name || me.itemId;
        	formData.srcPath = me.srcPath;
			formData.controlName = grid.itemId;
        	formData.controlViewName = me.itemId;
        	formData.saveToDb = me.saveToDb;
        	formData.assView = me.assView;
		}
		//TECH-30745
		formData.autoFileName = me.getAutoFileName();
        //formData.controlRowNo = me.rowIndex + 1;
        formData.controlRowNo = me.rowIndex;
		if (me.hdnFileId)
			formData.hdnFileId = me.getHdnFileId();
		if (me.autoFileName)
			formData.autoFileName = me.getAutoFileName();
        fileInput = me.btn.fileInputEl.dom;
		file = (fileInput && fileInput.files.length > 0) ? fileInput.files[0] : null;
		fileSize = (fileInput && file.size) ? file.size : 0;
		
		var ilboView = me.up('ilbo'),
			controller = (ilboView) ? ilboView.getController() : null,
			errorText, fileExtension, fileObj, maxFileSize; // TECH-34521
			
		// TECH-34521
		maxFileSize = (!Ext.isEmpty(me.maxFileSize)) ? me.maxFileSize : (RamcoRTC.settings.fileUploadMaxSize || 2);
		
		if (file && !Ext.isEmpty(me.acceptFormat)) {
			fileObj = (file.name) ? file.name.split('.') : null;
			if (fileObj) {
				fileExtension = fileObj[fileObj.length - 1];				
				if (fileExtension && me.acceptFormat.indexOf(fileExtension) < 0) {
					errorText = Ext.String.format('The allowed file type[s]: {0}', me.acceptFormat);
					Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
					return false;
				}
			}
		}
		
		if (fileSize == 0) {
			errorText = Ext.String.format(rvw_resources.R261, fileSize);
			if(controller)
				controller.taskPending = false;
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			return false;
		}
		// TECH-34521
		else if ( fileSize > maxFileSize * BYTES_PER_CHUNK ) {
			errorText = Ext.String.format(rvw_resources.R262, maxFileSize);
			Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
			if(controller)
				controller.taskPending = false;
			return false;
		}
		else {
	        formData.append('file', fileInput.files[0]);
	        formData.file = fileInput.files[0];
	        grid.fireEvent('uploadfile', grid, formData, '', me);
		}
    },
    applySrcPath: function(srcPath) {
        return srcPath.replace('..\\', '');
    },
	destroy:function(){
		var me =this,
			btn = me.btn;
		if (btn) {
			btn.un('change', me.onBtnUploadClick, me);
			Ext.destroy(btn);
		}
		me.callParent();
    }
});


// Filecontrol
/*Ext.define('Ext.ramco.grid.FileControl', {
    extend: 'Ext.ramco.grid.Action',
    xtype: 'filecontrol',
    tdCls: Ext.baseCSSPrefix + 'column-fileattachcolumn',
    browseIcon: true,
    dView: null,
    config: {
        dbFileUrl: null,
        saveToDb: false,
        hasLink: false,
        staticName: null,
        format: '',
        fileUrl: null,
        srcPath: null,
        assView: null,
        mode: null,
        dView: null,
        src: null
    },
    defaultRenderer: function (v, cellValues, record, rowIdx, colIdx, store, view) {
        var me = this,
            staticName = me.getStaticName(),
            scope = me.origScope || me,
            items = me.items,
            style = '',
            len = items.length,
            i, item, ret, disabled, tooltip, altText, icon,
			grid=me.up('ramcogrid');
			deleteCtrl = grid.down('[xtype=deletecontrol]');
			
			
        ret = Ext.isFunction(me.origRenderer) ? me.origRenderer.apply(scope, arguments) || '' : '';
        v = Ext.isEmpty(v) ? '' : v;
        v = Ext.isEmpty(staticName) ? v : staticName;
		if(deleteCtrl){
				if(!Ext.isEmpty(v) && me.getSrcPath()){
			     deleteCtrl.items[0].hidden = false;
			     deleteCtrl.setSrcPath(me.getSrcPath());
				}
			    else
			     deleteCtrl.items[0].hidden = true;
		}
			
		
        cellValues.tdCls += ' ' + Ext.baseCSSPrefix + 'action-col-cell';
        if (me.browseIcon) {
            for (i = 0; i < len; i++) {
                item = items[i];
                icon = item.icon;

                disabled = item.disabled || (item.isDisabled ? item.isDisabled.call(item.scope || scope, view, rowIdx, colIdx, item, record) : false);
                tooltip = disabled ? null : (item.tooltip || (item.getTip ? item.getTip.apply(item.scope || scope, arguments) : null));
                altText = item.getAltText ? item.getAltText.apply(item.scope || scope, arguments) : item.altText || me.altText;

                if (!item.hasActionConfiguration) {
                    item.stopSelection = me.stopSelection;
                    item.disable = Ext.Function.bind(me.disableAction, me, [i], 0);
                    item.enable = Ext.Function.bind(me.enableAction, me, [i], 0);
                    item.hasActionConfiguration = true;
                }
                style = '';
                if (i == 1 && !v)
                    style = ' style="display:none;" ';
                ret += '<' + (icon ? 'img' : 'div') + ' tabIndex="0" role="button"' + style + (icon ? (' alt="' + altText + '" src="' + item.icon + '"') : '') +
                    ' class="' + me.actionIconCls + ' ' + Ext.baseCSSPrefix + 'action-col-' + String(i) + ' ' +
                    (disabled ? me.disabledCls + ' ' : ' ') +
                    (Ext.isFunction(item.getClass) ? item.getClass.apply(item.scope || scope, arguments) : (item.iconCls || me.iconCls || '')) + '"' +
                    (tooltip ? ' data-qtip="' + tooltip + '"' : '') + (icon ? '/>' : '></div>');
            }
        }
        ret += "<div role='download' class='x-download'>" + v + "</div>";
        return ret;
    },
    processEvent: function (type, view, cell, recordIndex, cellIndex, e, record, row) {
        var me = this,
            target = e.getTarget(),
            key = type === 'keydown' && e.getKey(),
            match,
            item,
            disabled,
            cellFly = Ext.fly(cell);

        // Flag event to tell SelectionModel not to process it.
        e.stopSelection = !key && me.stopSelection;

        // If the target was not within a cell (ie it's a keydown event from the View), then
        // IF there's only one action icon, action it. If there is more than one, the user must
        // invoke actionable mode to navigate into the cell.
        if (key && (target === cell || !cellFly.contains(target))) {
            target = cellFly.query('.' + me.actionIconCls, true);
            if (target.length === 1) {
                target = target[0];
            }
            else {
                return;
            }
        }
        if (type === 'click') {
            var el = Ext.fly(e.target),
                download = el ? el.getAttribute('role') : null;
            if (download == 'download') {
                e.preventDefault();
                me.downloadFile(recordIndex);
                return true;
            }
        }
        // NOTE: The statement below tests the truthiness of an assignment.
        if (target && (match = target.className.match(me.actionIdRe))) {
            item = me.items[parseInt(match[1], 10)];
            disabled = item.disabled || (item.isDisabled ? item.isDisabled.call(item.scope || me.origScope || me, view, recordIndex, cellIndex, item, record) : false);
            if (item && !disabled) {

                // Do not allow focus to follow from this mousedown unless the grid is already in actionable mode
                if (type === 'mousedown' && !me.getView().actionableMode) {
                    e.preventDefault();
                }

                else if (type === 'click' || (key === e.ENTER || key === e.SPACE)) {
                    Ext.callback(item.handler || me.handler, item.scope || me.origScope, [view, recordIndex, cellIndex, item, e, record, row], undefined, me);

                    // If the handler moved focus outside of the view, do not allow this event to propagate
                    // to cause any navigation.
                    if (!view.el.contains(Ext.Element.getActiveElement())) {
                        return false;
                    }
                }
            }
        }

        //return me.callParent(arguments);
    },
    downloadFile: function (row) {
        var me = this,
            src = null
        ilbo = me.up('ilbo'),
            grid = me.up('ramcogrid'),
            saveToDb = me.getSaveToDb(),
            hasLink = me.getHasLink(),
            itemId = grid.getItemId(),
            view = me.name || me.getItemId(),
            srcPath = me.getSrcPath(),
            assView = me.getAssView(),
            mode = me.getMode(),
            dView = me.getDView(),
            dbFileUrl = ilbo ? ilbo.dbFileUrl : '',
            fileUrl = ilbo ? ilbo.fileUrl : '';

        if (saveToDb) {
            src = Ext.String.format(dbFileUrl, itemId, assView, (row + 1), srcPath, view);
        }
        else {
            src = Ext.String.format(fileUrl, itemId, view, (row + 1), srcPath, dView, mode);
        }
        window.open(src);
    },
    applySrcPath: function (srcPath) {
        return srcPath.replace('..\\', '');
    }
});
*/

// Deletecontrol
Ext.define('Ext.ramco.grid.DeleteColumn', {
    extend: 'Ext.ramco.grid.Action',
    xtype: 'deletecolumn',
    tdCls: Ext.baseCSSPrefix + 'column-fileattachcolumn',
    browseIcon: true,
    dView: null,
    config: {
        dbFileUrl: null,
        saveToDb: false,
        hasLink: false,
        staticName: null,
        format: '',
        fileUrl: null,
        srcPath: null,
        assView: null,
        mode: null,
        dView: null,
        src: null
    },
    items: [{
        iconCls: 'x-fa fa-close',
        itemId: 'btnDelete',
        tooltip: rvw_resources.R138,
        hidden: true,
        handler: function(grid, rowIndex, colIndex) {
            var me = this;
            me.deleteFile(grid, rowIndex, colIndex);
        }
    }],
    defaultRenderer: function(v, cellValues, record, rowIdx, colIdx, store, view) {
        var me = this,
            staticName = me.getStaticName(),
            scope = me.origScope || me,
            items = me.items,
            style = '',
            len = items.length,
            i, item, ret, disabled, tooltip, altText, icon;

        ret = Ext.isFunction(me.origRenderer) ? me.origRenderer.apply(scope, arguments) || '' : '';
        v = Ext.isEmpty(v) ? '' : v;
        v = Ext.isEmpty(staticName) ? v : staticName;

        cellValues.tdCls += ' ' + Ext.baseCSSPrefix + 'action-col-cell';
        if (me.browseIcon) {
            for (i = 0; i < len; i++) {
                item = items[i];
                icon = item.icon;

                disabled = item.disabled || (item.isDisabled ? item.isDisabled.call(item.scope || scope, view, rowIdx, colIdx, item, record) : false);
                tooltip = disabled ? null : (item.tooltip || (item.getTip ? item.getTip.apply(item.scope || scope, arguments) : null));
                altText = item.getAltText ? item.getAltText.apply(item.scope || scope, arguments) : item.altText || me.altText;

                if (!item.hasActionConfiguration) {
                    item.stopSelection = me.stopSelection;
                    item.disable = Ext.Function.bind(me.disableAction, me, [i], 0);
                    item.enable = Ext.Function.bind(me.enableAction, me, [i], 0);
                    item.hasActionConfiguration = true;
                }
                style = '';
                if (item.hidden == true && !v)
                    style = ' style="display:none;" ';
                ret += '<' + (icon ? 'img' : 'div') + ' tabIndex="0" role="button"' + style + (icon ? (' alt="' + altText + '" src="' + item.icon + '"') : '') +
                    ' class="' + me.actionIconCls + ' ' + Ext.baseCSSPrefix + 'action-col-' + String(i) + ' ' +
                    (disabled ? me.disabledCls + ' ' : ' ') +
                    (Ext.isFunction(item.getClass) ? item.getClass.apply(item.scope || scope, arguments) : (item.iconCls || me.iconCls || '')) + '"' +
                    (tooltip ? ' data-qtip="' + tooltip + '"' : '') + (icon ? '/>' : '></div>');
            }
        }
        ret += "<div role='download' class='x-download'>" + v + "</div>";
        return ret;
    },
    deleteFile: function(grid, rowIndex, colIndex) {
        var me = this,
            grid = me.up('ramcogrid');
        grid.fireEvent('deletefile', me, grid, rowIndex, me.getSrcPath(), me.dView);
    },
    applySrcPath: function(srcPath) {
        return srcPath.replace('..\\', '');
    }
});

// Grid Image Column
Ext.define('Ext.ramco.grid.Image', {
    extend: 'Ext.ramco.grid.Column',
    tdCls: Ext.baseCSSPrefix + 'column-image',
    xtype: 'imagecolumn',
    tpl: '<img class="browse-img"  data-qtip="{qtip}" style="{style}" oldsrc="{oldsrc}" src="{value}"/>', // TECH-32314
    //tpl: '<img class="browse-img" style="width:{width}px;height:{height}px" src="{value}"/>',
    //tpl: '<div class="browse-img" style="background-image:url(\'{value}\')"></div>',

    config: {
        srcPath: null,
        assView: null,
        saveToDb: false,
        hasLink: null,
    },

    initComponent: function() {
        var me = this;
        me.tpl = (!Ext.isPrimitive(me.tpl) && me.tpl.compile) ? me.tpl : new Ext.XTemplate(me.tpl);
        me.callParent();

    },
    defaultRenderer: function(value, metaData, record, rowIdx, colIdx, dataSource, view) {
        var me = this,
            ilbo = me.up('ilbo'),
            rn = record.get('rn'),
			grid = null,
            //grid = me.up('ramcogrid'),
            //grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid')),			
            width = (me.rendered && me.getWidth()) || me.width, // TECH-39497
            //height = grid.rowHeight,
            //itemId = grid ? grid.getItemId() : '',
			height = null,
			itemId = null,
            viewId = me.name,
			qtipValue = value?value:'',
            saveToDb = me.getSaveToDb(),
            hasLink = me.getHasLink(),
            srcPath = me.getSrcPath(),
            assView = me.getAssView(),
            dbFileUrl = ilbo ? ilbo.dbFileUrl : '',
            fileUrl = ilbo ? ilbo.fileUrl : '',
			styleStr = '', 
			colCls, // TECH-35412
			values,
			oldSrc = '', // TECH-32314
			mode = me.mode,
			dView = me.dView;
		grid = me.up('ramcogrid');
		grid = grid ? grid : (me.up('ramcotreegrid') ? me.up('ramcotreegrid') : me.up('ramcoddtgrid'));
		if (!grid) {
			grid = me.up('ramcorstreegrid');
			rn = record.get('in'); //TECH-34281 //CSGH-274
		}		
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}
		// TECH-35412
		if (metaData && metaData.column.dataIndex != "rn" && metaData.column.dataIndex != "sel") {
			colCls = record.data[metaData.column.dataIndex + "-css"];
			if (!Ext.isEmpty(colCls)){
				if(Ext.isEmpty(metaData.tdCls))
					metaData.tdCls = colCls;
				else
					metaData.tdCls += colCls;
			}
		}
		height = grid.rowHeight,
        itemId = grid ? grid.getItemId() : '';
        if (Ext.isEmpty(height))
            height = 24;
        if (saveToDb) {
            //value = Ext.String.format(dbFileUrl, itemId, assView, rn, srcPath, viewId);
			value = Ext.String.format(dbFileUrl, itemId, assView, rn, srcPath, viewId, mode, dView);									
        } 
		else if (hasLink) {
            value = Ext.String.format(fileUrl, itemId, viewId, rn, srcPath);
        } 
		else {
			if (!Ext.isEmpty(value)) {
				values = value.split("/");
				// TECH-32314
				oldSrc = values[values.length - 1];
            	value = 'app/classic/' + ilbo.ilboConfig.componentName + "/" + 'Images/' + oldSrc;
        	}
			else
				value = '';
		}
		if (hasLink || saveToDb)
			//AHBG-31793	
			//styleStr = 'width: ' + (width - 8) + 'px; height: ' + (height - 6) + 'px';
			styleStr = 'max-width: ' + (width - 8) + 'px; max-height: ' + (height - 6) + 'px';
		else
			 styleStr = 'width: auto;height: auto;'; 
		
		return this.tpl.apply({ value: value, style: styleStr, qtip:qtipValue, oldsrc: oldSrc}); // TECH-32314
		
        /* return this.tpl.apply({
            value: value,
            width: width - 8,
            height: height - 6
        }); */
    }
});
Ext.define('Ext.grid.column.Widget', {
    extend: 'Ext.ramco.grid.Column',
    //alias: 'widget.ramcowidgetcolumn',
    xtype: 'ramcowidgetcolumn',
    tdCls: Ext.baseCSSPrefix + 'column-widget',
    config: {
        /**
         * @cfg defaultWidgetUI
         * A map of xtype to {@link Ext.Component#ui} names to use when using Components in this column.
         *
         * Currently {@link Ext.Button Button} and all subclasses of {@link Ext.form.field.Text TextField} default
         * to using `ui: "default"` when in a WidgetColumn except for in the "classic" theme, when they use ui "grid-cell".
         */
        defaultWidgetUI: {}
    },

    ignoreExport: true,

    /**
     * @cfg
     * @inheritdoc
     */
    sortable: false,

    /**
     * @cfg {Object} renderer
     * @hide
     */

    /**
     * @cfg {Object} scope
     * @hide
     */

    /**
     * @cfg {Object} widget
     * A config object containing an {@link Ext.Component#cfg-xtype xtype}.
     *
     * This is used to create the widgets or components which are rendered into the cells of this column.
     *
     * This column's {@link #dataIndex} is used to update the widget/component's {@link Ext.Component#defaultBindProperty defaultBindProperty}.
     *
     * The widget will be decorated with 2 methods:
     * `getWidgetRecord` - Returns the {@link Ext.data.Model record} the widget is associated with.
     * `getWidgetColumn` - Returns the {@link Ext.grid.column.Widget column} the widget
     * was associated with.
     */

    /**
     * @cfg {Function/String} onWidgetAttach
     * A function that will be called when a widget is attached to a record. This may be useful for
     * doing any post-processing.
     *
     *     Ext.create({
     *         xtype: 'grid',
     *         title: 'Student progress report',
     *         width: 250,
     *         renderTo: Ext.getBody(),
     *         disableSelection: true,
     *         store: {
     *             fields: ['name', 'isHonorStudent'],
     *             data: [{
     *                 name: 'Finn',
     *                 isHonorStudent: true
     *             }, {
     *                 name: 'Jake',
     *                 isHonorStudent: false
     *             }]
     *         },
     *         columns: [{
     *             text: 'Name',
     *             dataIndex: 'name',
     *             flex: 1
     *         }, {
     *             xtype: 'widgetcolumn',
     *             text: 'Honor Roll',
     *             dataIndex: 'isHonorStudent',
     *             width: 150,
     *             widget: {
     *                 xtype: 'button',
     *                 handler: function() {
     *                     // print certificate handler
     *                 }
     *             },
     *             // called when the widget is initially instantiated
     *             // on the widget column
     *             onWidgetAttach: function(col, widget, rec) {
     *                 widget.setText('Print Certificate');
     *                 widget.setDisabled(!rec.get('isHonorStudent'));
     *             }
     *         }]
     *     });
     *
     * @param {Ext.grid.column.Column} column The column.
     * @param {Ext.Component/Ext.Widget} widget The {@link #widget} rendered to each cell.
     * @param {Ext.data.Model} record The record used with the current widget (cell).
     * @controllable
     */
    onWidgetAttach: null,

    preventUpdate: true,

    /**
     * @cfg {Boolean} [stopSelection=true]
     * Prevent grid selection upon click on the widget.
     */
    stopSelection: true,

    initComponent: function() {
        var me = this,
            widget;

        me.callParent(arguments);

        widget = me.widget;
        //<debug>
        if (!widget || widget.isComponent) {
            Ext.raise('column.Widget requires a widget configuration.');
        }
        //</debug>
        me.widget = widget = Ext.apply({}, widget);

        // Apply the default UI for the xtype which is going to feature in this column.
        if (!widget.ui) {
            widget.ui = me.getDefaultWidgetUI()[widget.xtype] || 'default';
        }
        me.isFixedSize = Ext.isNumber(widget.width);
    },

    processEvent: function(type, view, cell, recordIndex, cellIndex, e, record, row) {
        var target;

        if (this.stopSelection && type === 'click') {
            // Grab the target that matches the cell inner selector. If we have a target, then,
            // that means we either clicked on the inner part or the widget inside us. If 
            // target === e.target, then it was on the cell, so it's ok. Otherwise, inside so
            // prevent the selection from happening
            target = e.getTarget(view.innerSelector);
            if (target && target !== e.target) {
                e.stopSelection = true;
            }
        }
    },

    beforeRender: function() {
        var me = this,
            tdCls = me.tdCls,
            widget;

        me.listenerScopeFn = function(defaultScope) {
            if (defaultScope === 'this') {
                return this;
            }
            return me.resolveListenerScope(defaultScope);
        };

        me.liveWidgets = {};
        me.cachedStyles = {};
        me.freeWidgetStack = [widget = me.getFreeWidget()];

        tdCls = tdCls ? tdCls + ' ' : '';
        me.tdCls = tdCls + widget.getTdCls();
        me.setupViewListeners(me.getView());
        me.callParent();
    },

    afterRender: function() {
        var view = this.getView();

        this.callParent();
        // View already ready, means we were added later so go and set up our widgets, but if the grid
        // is reconfiguring, then the column will be rendered & the view will be ready, so wait until
        // the reconfigure forces a refresh
        if (view && view.viewReady && !view.ownerGrid.reconfiguring) {
            this.onViewRefresh(view, view.getViewRange());
        }
    },

    // Cell must be left blank
    defaultRenderer: Ext.emptyFn,

    updater: function(cell, value, record) {
        this.updateWidget(record);
    },

    onResize: function(newWidth) {
        var me = this,
            liveWidgets = me.liveWidgets,
            view = me.getView(),
            id, cell;

        if (!me.isFixedSize && me.rendered && view && view.viewReady) {
            cell = view.getEl().down(me.getCellInnerSelector());
            if (cell) {
                // Subtract innerCell padding width
                newWidth -= parseInt(me.getCachedStyle(cell, 'padding-left'), 10) + parseInt(me.getCachedStyle(cell, 'padding-right'), 10);

                for (id in liveWidgets) {
                    liveWidgets[id].setWidth(newWidth);
                }
            }
        }
    },

    onAdded: function() {
        var me = this,
            view;

        me.callParent(arguments);

        view = me.getView();

        // If we are being added to a rendered HeaderContainer
        if (view) {
            me.setupViewListeners(view);

            if (view && view.viewReady && me.rendered && view.getEl().down(me.getCellSelector())) {
                // If the view is ready, it means we're already rendered.
                // At this point the view may refresh "soon", however we don't have
                // a way of knowing that the view is pending a refresh, so we need
                // to ensure the widgets get hooked up correctly here
                me.onViewRefresh(view, view.getViewRange());
            }
        }
    },

    onRemoved: function(isDestroying) {
        var me = this,
            liveWidgets = me.liveWidgets,
            viewListeners = me.viewListeners,
            id;

        if (me.rendered) {
            me.viewListeners = viewListeners && Ext.destroy(viewListeners);

            // If we are being removed, we have to move all widget elements into the detached body
            if (!isDestroying) {
                for (id in liveWidgets) {
                    liveWidgets[id].detachFromBody();
                }
            }
        }
        me.callParent(arguments);
    },

    onDestroy: function() {
        var me = this,
            oldWidgetMap = me.liveWidgets,
            freeWidgetStack = me.freeWidgetStack,
            id, widget, i, len;

        if (me.rendered) {
            for (id in oldWidgetMap) {
                widget = oldWidgetMap[id];
                widget.$widgetRecord = widget.$widgetColumn = null;
                delete widget.getWidgetRecord;
                delete widget.getWidgetColumn;
                widget.destroy();
            }

            for (i = 0, len = freeWidgetStack.length; i < len; ++i) {
                freeWidgetStack[i].destroy();
            }
        }

        me.freeWidgetStack = me.liveWidgets = null;

        me.callParent();
    },

    getWidget: function(record) {
        var liveWidgets = this.liveWidgets,
            widget;

        if (record && liveWidgets) {
            widget = liveWidgets[record.internalId];
        }
        return widget || null;
    },

    privates: {
        getCachedStyle: function(el, style) {
            var cachedStyles = this.cachedStyles;
            return cachedStyles[style] || (cachedStyles[style] = Ext.fly(el).getStyle(style));
        },

        getFreeWidget: function() {
            var me = this,
                result = me.freeWidgetStack ? me.freeWidgetStack.pop() : null;

            if (!result) {
                result = Ext.widget(me.widget);

                result.resolveListenerScope = me.listenerScopeFn;
                result.getWidgetRecord = me.widgetRecordDecorator;
                result.getWidgetColumn = me.widgetColumnDecorator;
                result.dataIndex = me.dataIndex;
                result.measurer = me;
                result.ownerCmp = me.getView();
                // The ownerCmp of the widget is the encapsulating view, which means it will be considered
                // as a layout child, but it isn't really, we always need the layout on the
                // component to run if asked.
                result.isLayoutChild = me.returnFalse;
            }
            return result;
        },

        onBeforeRefresh: function() {
            var liveWidgets = this.liveWidgets,
                id;

            // Because of a memory leak bug in IE 8, we need to handle the dom node here before
            // it is destroyed.
            // See EXTJS-14874.
            for (id in liveWidgets) {
                liveWidgets[id].detachFromBody();
            }
        },

        onItemAdd: function(records, index, items) {
            var me = this,
                view = me.getView(),
                hasAttach = !!me.onWidgetAttach,
                dataIndex = me.dataIndex,
                isFixedSize = me.isFixedSize,
                len = records.length,
                i,
                record,
                row,
                cell,
                widget,
                el,
                focusEl,
                width;

            // Loop through all records added, ensuring that our corresponding cell in each item
            // has a Widget of the correct type in it, and is updated with the correct value from the record.
            if (me.isVisible(true)) {
                for (i = 0; i < len; i++) {
                    record = records[i];
                    if (record.isNonData) {
                        continue;
                    }

                    row = view.getRowFromItem(items[i]);

                    // May be a placeholder with no data row
                    if (row) {
                        cell = row.cells[me.getVisibleIndex()].firstChild;
                        if (!isFixedSize && !width) {
                            width = me.lastBox.width - parseInt(me.getCachedStyle(cell, 'padding-left'), 10) - parseInt(me.getCachedStyle(cell, 'padding-right'), 10);
                        }

                        widget = me.liveWidgets[record.internalId] = me.getFreeWidget();
                        widget.$widgetColumn = me;
                        widget.$widgetRecord = record;

                        // Render/move a widget into the new row
                        Ext.fly(cell).empty();

                        // Call the appropriate setter with this column's data field
                        if (widget.defaultBindProperty && dataIndex) {
                            widget.setConfig(widget.defaultBindProperty, record.get(dataIndex));
                        }

                        el = widget.el || widget.element;
                        if (el) {
                            cell.appendChild(el.dom);
                            if (!isFixedSize) {
                                widget.setWidth(width);
                            }
                            widget.reattachToBody();
                        } else {
                            if (!isFixedSize) {
                                widget.width = width;
                            }
                            widget.render(cell);
                        }

                        // We have to run the callback *after* reattaching the Widget
                        // back to the document body. Otherwise widget's layout may fail
                        // because there are no dimensions to measure when the callback is fired!
                        if (hasAttach) {
                            Ext.callback(me.onWidgetAttach, me.scope, [me, widget, record], 0, me);
                        }

                        // If the widget has a focusEl, ensure that its tabbability status is synched
                        // with the view's navigable/actionable state.
                        focusEl = widget.getFocusEl();

                        if (focusEl) {
                            if (view.actionableMode) {
                                if (!focusEl.isTabbable()) {
                                    focusEl.restoreTabbableState();
                                }
                            } else {
                                if (focusEl.isTabbable()) {
                                    focusEl.saveTabbableState();
                                }
                            }
                        }
                    }
                }
            }
        },

        onItemRemove: function(records, index, items) {
            var me = this,
                liveWidgets = me.liveWidgets,
                widget, item, id, len, i, focusEl;

            if (me.rendered) {

                // Single item or Array. items are DOM nodes; we use them to get
                // record ids because records array may not be passed here
                items = Ext.Array.from(items);
                len = items.length;

                for (i = 0; i < len; i++) {
                    item = items[i];

                    // If there was a record ID (collapsed placeholder will no longer be 
                    // accessible)... return ousted widget to free stack, and move its element 
                    // to the detached body
                    id = item.getAttribute('data-recordId');
                    if (id && (widget = liveWidgets[id])) {
                        delete liveWidgets[id];
                        me.freeWidgetStack.unshift(widget);
                        widget.$widgetRecord = widget.$widgetColumn = null;

                        // Focusables in a grid must not be tabbable by default when they get put back in.
                        focusEl = widget.getFocusEl();
                        if (focusEl) {
                            // Widgets are reused so we must reset their tabbable state
                            // regardless of their visibility.
                            // For example, when removing rows in IE8 we're attaching
                            // the nodes to a document-fragment which itself is invisible,
                            // so isTabbable() returns false. Next time when we're reusing
                            // this widget it will be attached to the document with its
                            // tabbable state unreset, which might lead to undesired results.
                            if (focusEl.isTabbable(true)) {
                                focusEl.saveTabbableState({
                                    includeHidden: true
                                });
                            }

                            // Some browsers do not deliver a focus change upon DOM removal.
                            // Force the issue here.
                            focusEl.blur();
                        }

                        widget.detachFromBody();
                    }
                }
            }
        },

        onItemUpdate: function(record, recordIndex, oldItemDom) {
            this.updateWidget(record);
        },

        onViewRefresh: function(view, records) {
            var me = this,
                rows = view.all,
                hasAttach = !!me.onWidgetAttach,
                oldWidgetMap = me.liveWidgets,
                dataIndex = me.dataIndex,
                isFixedSize = me.isFixedSize,
                cell, widget, el, width, recordId,
                itemIndex, recordIndex, record, id, lastBox, dom;

            if (me.isVisible(true)) {
                me.liveWidgets = {};
                Ext.suspendLayouts();
                for (itemIndex = rows.startIndex, recordIndex = 0; itemIndex <= rows.endIndex; itemIndex++, recordIndex++) {
                    record = records[recordIndex];
                    if (record.isNonData) {
                        continue;
                    }

                    recordId = record.internalId;
                    cell = view.getRow(rows.item(itemIndex)).cells[me.getVisibleIndex()].firstChild;

                    // Attempt to reuse the existing widget for this record.
                    widget = me.liveWidgets[recordId] = oldWidgetMap[recordId] || me.getFreeWidget();
                    widget.$widgetRecord = record;
                    widget.$widgetColumn = me;
                    delete oldWidgetMap[recordId];

                    lastBox = me.lastBox;
                    if (lastBox && !isFixedSize && width === undefined) {
                        width = lastBox.width - parseInt(me.getCachedStyle(cell, 'padding-left'), 10) - parseInt(me.getCachedStyle(cell, 'padding-right'), 10);
                    }

                    // Call the appropriate setter with this column's data field
                    if (widget.defaultBindProperty && dataIndex) {
                        widget.setConfig(widget.defaultBindProperty, records[recordIndex].get(dataIndex));
                    }

                    el = widget.el || widget.element;
                    if (el) {
                        dom = el.dom;
                        if (dom.parentNode !== cell) {
                            Ext.fly(cell).empty();
                            cell.appendChild(el.dom);
                        }
                        if (!isFixedSize) {
                            widget.setWidth(width);
                        }
                        widget.reattachToBody();
                    } else {
                        if (!isFixedSize) {
                            widget.width = width;
                        }
                        Ext.fly(cell).empty();
                        widget.render(cell);
                    }

                    // We have to run the callback *after* reattaching the Widget
                    // back to the document body. Otherwise widget's layout may fail
                    // because there are no dimensions to measure when the callback is fired!
                    if (hasAttach) {
                        Ext.callback(me.onWidgetAttach, me.scope, [me, widget, record], 0, me);
                    }
                }

                Ext.resumeLayouts(true);

                // Free any unused widgets from the old live map.
                // Move them into detachedBody.
                for (id in oldWidgetMap) {
                    widget = oldWidgetMap[id];
                    widget.$widgetRecord = widget.$widgetColumn = null;
                    me.freeWidgetStack.unshift(widget);
                    widget.detachFromBody();
                }
            }
        },

        returnFalse: function() {
            return false;
        },

        setupViewListeners: function(view) {
            var me = this;

            me.viewListeners = view.on({
                refresh: me.onViewRefresh,
                itemupdate: me.onItemUpdate,
                itemadd: me.onItemAdd,
                itemremove: me.onItemRemove,
                scope: me,
                destroyable: true
            });

            if (Ext.isIE8) {
                view.on('beforerefresh', me.onBeforeRefresh, me);
            }
        },

        updateWidget: function(record) {
            var dataIndex = this.dataIndex,
                widget;

            if (this.rendered) {
                widget = this.liveWidgets[record.internalId];
                // Call the appropriate setter with this column's data field
                if (widget && widget.defaultBindProperty && dataIndex) {
                    widget.setConfig(widget.defaultBindProperty, record.get(dataIndex));
                }
            }
        },

        widgetRecordDecorator: function() {
            return this.$widgetRecord;
        },

        widgetColumnDecorator: function() {
            return this.$widgetColumn;
        }
    }
})
//Grid SuperSegment Column
Ext.define('Ext.ramco.grid.SuperSegment', {
    extend: 'Ext.ramco.grid.Column',
    xtype: 'ramcosupersegmentcolumn',
    tdCls: Ext.baseCSSPrefix + 'column-supersegment',
    delimiter: ':',
    configColumn: '',

    defaultRenderer: function(value, metaData, record, rowIdx, colIdx, dataSource, view) {
        var me = this,
            configData = null,
            data = [],
            colValue = "",
            config = record.get(me.configColumn);
        if (!Ext.isEmpty(config)) {
            configData = Ext.decode(config, true)
            if (!Ext.isEmpty(configData)) {
                len = configData.length;
                i = 0;
                for (; i < len; i++) {
                    colValue = record.get("v" + configData[i].v);
                    if (!Ext.isEmpty(colValue))
                        data.push(colValue);
                }
            }
        }
        return data.join(me.delimiter);
    },
    getEditor: function(record) {
        var me = this,
            grid = me.up('ramcogrid');
        if (me.editor) {
            me.editor.record = record;
        }
        return me.editor;
    },

    updater: function(cell, value, record, view) {
        var me = this,
            configData = null,
            data = [],
            colValue = "",
            config = record.get(me.configColumn);
        if (!Ext.isEmpty(config)) {
            configData = Ext.decode(config, true)
            if (!Ext.isEmpty(configData)) {
                len = configData.length;
                i = 0;
                for (; i < len; i++) {
                    colValue = record.get("v" + configData[i].v);
                    if (!Ext.isEmpty(colValue))
                        data.push(colValue);
                }
            }
        }
        cell = Ext.fly(cell);
        cell = Ext.fly(cell.down(view.innerSelector))
        cell.setHtml(data.join(me.delimiter));
    }
});

//SuperSegment Controller
Ext.define('Ext.ramco.SuperSegmentController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.ramcosupersegmentCnt',
    config: {
        control: {
            'ramcolistedit[role=ssctrl]': {
                listdata: 'onListData',
                select: 'onSelect'
            },
        }
    },
    onListData: function(field, view, value, fields, search) {
        var me = this,
            view = me.getView();
        view.fireEvent('listdata', field, view, value, fields, search);
    },
    onSelect: function(combo, record, eOpts) {}
});

//SuperSegment Editor
Ext.define('Ext.ramco.SuperSegment', {
    extend: 'Ext.form.Panel',
    xtype: 'ramcosupersegment',
    style: {
        'background-color': '#fff',
        'border': '1px solid #ccc'
    },
    layout: 'column',
    columnConfig: [],
    configView: null,
    record: null,
    defaults: {
        columnWidth: '100%',
        labelAlign: 'top',
        labelSeparator: '',
    },
    mixins: [
        'Ext.form.field.Field'
    ],
    controller: 'ramcosupersegmentCnt',
    initComponent: function() {
        var me = this;
        if (me.items) {
            me.items.push({
                itemId: "nullItem",
                name: "nullItem",
                xtype: "ramcolabel",
                value: "",
                hidden: true
            });
        }
        me.callParent();
        me.prepare();
    },
    prepare: function(record) {
        var me = this,
            configView = me.configView,
            panel = me.getForm(),
            fields = panel.getFields().items,
            itemsId = [],
            data = null,
            nullItem = me.getComponent("nullItem"),
            config;
        if (record)
            me.record = record;
        if (configView && me.record) {
            panel.loadRecord(me.record);
            config = me.record.get(configView);
            if (!Ext.isEmpty(config)) {
                data = Ext.decode(config, true)
            }
            me.columnConfig = data;
            var len = fields ? fields.length : 0,
                i = 0,
                j = 0;
            for (; i < len; i++) {
                fields[i].hide();
                itemsId.push(fields[i].name);
            }

            if (!Ext.isEmpty(data)) {
                len = data.length;
                i = 0;
                for (; i < len; i++) {
                    j = itemsId.indexOf("v" + data[i].v);
                    if (j > -1) {
                        fields[j].setEmptyText(data[i].c);
                        fields[j].show();
                    }
                }
            } else {
                if (nullItem)
                    nullItem.show();
            }
        } else {
            if (nullItem)
                nullItem.show();
        }
        return true;
    },
    updateRecord: function(record) {
        var me = this,
            panel = me.getForm();
        panel.updateRecord(record);
        //record.commit();
    },
    getValue: function() {

    },
    setValue: function() {

    }
});

// Table View Override
Ext.define('Ext.o.view.Table', {
    override: 'Ext.view.Table',
    renderRow: function(record, rowIdx, out) {
        var me = this,
            isMetadataRecord = rowIdx === -1,
            selModel = me.selectionModel,
            rowValues = me.rowValues,
            itemClasses = rowValues.itemClasses,
            rowClasses = rowValues.rowClasses,
            itemCls = me.itemCls,
            cls,
            rowTpl = me.rowTpl;

        // Define the rowAttr object now. We don't want to do it in the treeview treeRowTpl because anything
        // this is processed in a deferred callback (such as deferring initial view refresh in gridview) could
        // poke rowAttr that are then shared in tableview.rowTpl. See EXTJSIV-9341.
        //
        // For example, the following shows the shared ref between a treeview's rowTpl nextTpl and the superclass
        // tableview.rowTpl:
        //
        //      tree.view.rowTpl.nextTpl === grid.view.rowTpl
        //
        rowValues.rowAttr = {};
        rowValues.rowAttr['height'] = me.rowHeight || 21;

        // Set up mandatory properties on rowValues
        rowValues.record = record;
        rowValues.recordId = record.internalId;

        // recordIndex is index in true store (NOT the data source - possibly a GroupStore)
        rowValues.recordIndex = me.store.indexOf(record);

        // rowIndex is the row number in the view.
        rowValues.rowIndex = rowIdx;
        rowValues.rowId = me.getRowId(record);
        rowValues.itemCls = rowValues.rowCls = '';
        if (!rowValues.columns) {
            rowValues.columns = me.ownerCt.getVisibleColumnManager().getColumns();
        }

        itemClasses.length = rowClasses.length = 0;

        // If it's a metadata record such as a summary record.
        // So do not decorate it with the regular CSS.
        // The Feature which renders it must know how to decorate it.
        if (!isMetadataRecord) {
            itemClasses[0] = itemCls;

            if (!me.ownerCt.disableSelection && selModel.isRowSelected) {
                // Selection class goes on the outermost row, so it goes into itemClasses
                if (selModel.isRowSelected(record)) {
                    itemClasses.push(me.selectedItemCls);
                }
            }

            if (me.stripeRows && rowIdx % 2 !== 0) {
                itemClasses.push(me.altRowCls);
            }

            if (me.getRowClass) {
                cls = me.getRowClass(record, rowIdx, null, me.dataSource);
                if (cls) {
                    rowClasses.push(cls);
                }
            }
        }
		if (me.ownerGrid && me.ownerGrid.xtype == "ramcorstreegrid"){
			if (record.get("sel") === true) {
				itemClasses.push(me.selectedItemCls);
			}
		}
        if (out) {
            rowTpl.applyOut(rowValues, out, me.tableValues);
        } else {
            return rowTpl.apply(rowValues, me.tableValues);
        }
    },
    renderCell: function(column, record, recordIndex, rowIndex, columnIndex, out) {
        var me = this,
            fullIndex,
            selModel = me.selectionModel,
            cellValues = me.cellValues,
            classes = cellValues.classes,
            fieldValue = record.data[column.dataIndex],
            cellTpl = me.cellTpl,
            value, clsInsertPoint,
            lastFocused = me.navigationModel.getPosition(),
			cellId,
			grid;
			
		grid = me.up('ramcogrid');
		if (!grid) {
			grid = me.up('ramcotreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoddtgrid');
		}		
		if (!grid) {
			grid = me.up('ramcorstreegrid');
		}
		if (!grid) {
			grid = me.up('ramcoexpgrid');
		}	

        cellValues.record = record;
        cellValues.column = column;
        cellValues.recordIndex = recordIndex;
        cellValues.rowIndex = rowIndex;
        cellValues.columnIndex = cellValues.cellIndex = columnIndex;
        cellValues.align = column.align;
        cellValues.innerCls = column.innerCls;
        cellValues.tdCls = cellValues.tdStyle = cellValues.tdAttr = "";
        cellValues.style = column.cstStyle ? column.cstStyle : "";
        cellValues.unselectableAttr = me.enableTextSelection ? '' : 'unselectable="on"';
		
		if (column.xtype == "linkcolumn" || column.xtype == "ramcotemplatecolumn") {
			cellId = grid.itemId + "_cell_col" + column.dataIndex + "_row" + record.get("rn");
			cellValues.unselectableAttr += " id = " + cellId;
		}

        // Begin setup of classes to add to cell
        classes[1] = column.getCellId();

        // On IE8, array[len] = 'foo' is twice as fast as array.push('foo')
        // So keep an insertion point and use assignment to help IE!
        clsInsertPoint = 2;

        if (column.renderer && column.renderer.call) {
            fullIndex = me.ownerCt.columnManager.getHeaderIndex(column);
            value = column.renderer.call(column.usingDefaultRenderer ? column : column.scope || me.ownerCt, fieldValue, cellValues, record, recordIndex, fullIndex, me.dataSource, me);
            if (cellValues.css) {
                // This warning attribute is used by the compat layer
                // TODO: remove when compat layer becomes deprecated
                record.cssWarning = true;
                cellValues.tdCls += ' ' + cellValues.css;
                cellValues.css = null;
            }

            // Add any tdCls which was added to the cellValues by the renderer.
            if (cellValues.tdCls) {
                classes[clsInsertPoint++] = cellValues.tdCls;
            }
        } else {
            value = fieldValue;
        }

        cellValues.value = (value == null || value === '') ? column.emptyCellText : value;

        if (column.tdCls) {
            classes[clsInsertPoint++] = column.tdCls;
        }
		// TECH-32876		
		if (column.stateEnabled == false) {
			classes[clsInsertPoint++] = 'x-grid-cell-disabled';
			//TECH-35011
			if (RamcoRTC.settings.gridDisableColor === true) {
				classes[clsInsertPoint++] = 'x-grid-cell-disabled customdisabled';
			}
			if (column.titleEl) {
				column.titleEl.addCls("x-grid-cell-header-disabled");
			}
		}		
		//TECH-39953
		if (column.stateEnabled == true) {
			if (column.titleEl) {
				column.titleEl.removeCls("x-grid-cell-header-disabled");
			}
		}
        if (me.markDirty && record.dirty && record.isModified(column.dataIndex)) {
            classes[clsInsertPoint++] = me.dirtyCls;
        }
        if (column.isFirstVisible) {
            classes[clsInsertPoint++] = me.firstCls;
        }
        if (column.isLastVisible) {
            classes[clsInsertPoint++] = me.lastCls;
        }
        if (!me.enableTextSelection) {
            classes[clsInsertPoint++] = me.unselectableCls;
        }
        if (selModel && (selModel.isCellModel || selModel.isSpreadsheetModel) && selModel.isCellSelected(me, recordIndex, column)) {
            classes[clsInsertPoint++] = me.selectedCellCls;
        }
        if (lastFocused && lastFocused.record.id === record.id && lastFocused.column === column) {
            classes[clsInsertPoint++] = me.focusedItemCls;
        }

		// TECH-31669
		if(column.disabled === true && (column.xtype == 'ramcogridcheck' || column.xtype == 'linkcolumn'))
			classes[clsInsertPoint++] = "x-item-disabled";

        // Chop back array to only what we've set
        classes.length = clsInsertPoint;

        cellValues.tdCls = classes.join(' ');

        cellTpl.applyOut(cellValues, out);

        // Dereference objects since cellValues is a persistent var in the XTemplate's scope chain
        cellValues.column = cellValues.record = null;
    },
    refreshSize: function() {
        var me = this,
            type = me.ownerGrid.xtype,
			rowBdyHeight = 0,
			expRowHeight = 0,
            bodySelector = me.getBodySelector();
		me.grid.suspendLayouts();			
		me.grid.view.suspendLayouts();
        me.callParent(arguments);
		me.grid.view.resumeLayouts();
		me.grid.resumeLayouts();
		if(type == 'ramcogrid' && me.ownerGrid.showRowExpander === true)
			return;		
        if (type == 'ramcogrid' && me.el) {
            var newNoOfRows = me.ownerGrid.getVisibleRows() * 3;
            if (me.ownerGrid.lastEvent != 'onlast' && me.ownerGrid.lastEvent != 'onprev' && me.ownerGrid.lastEvent != 'onfirst')
                me.el.down(bodySelector).setHeight(me.rowHeight * newNoOfRows + (newNoOfRows + 1));
        }
    }/*,
	getViewRange: function() {
		var me = this;			
        return this.dataSource.getRange()
    }*/
});
Ext.define('Ext.grid.o.locking.Lockable', {
    override: 'Ext.grid.locking.Lockable',
    injectLockable: function() {
        var me = this;
        me.callParent();
		//TECH-34623
		//if((this.ownerGrid && this.ownerGrid.xtype !== "ramcopivot" && this.ownerGrid.xtype !== "ganttpanel" && this.ownerGrid.xtype !== "ramcorstreegrid" && this.ownerGrid.xtype !== "ramcotreegrid" && this.ownerGrid.xtype !== "ramcoexpgrid") || (this.ownerGrid.showRowExpander === true)) {
		if((this.ownerGrid && this.ownerGrid.xtype == "ramcogrid") || (this.ownerGrid.showRowExpander === true)) {
        	me.scrollable.setY(false);
        	me.scrollable.setX(false);
		}
    },
	syncLockableLayout: function() {
        var b = this;
        //if (b.store.getCount() && !b.afterLayoutListener) {
		if (!b.afterLayoutListener) {
            b.afterLayoutListener = Ext.on({
                afterlayout: b.doSyncLockableLayout,
                scope: b,
                single: true
            })
        }
    },
    doSyncLockableLayout: function() {
		if(this.ownerGrid && (this.ownerGrid.xtype == "ramcogrid" || this.ownerGrid.xtype == "ramcoddtgrid")){
			var N = this, R = N.isCollapsingOrExpanding, T = N.lockedGrid, V = N.normalGrid, U, X, ag, L, Y, af, J, G, aa, ab, M, W, ad, ac, Z, I, P, S, F, H, Q, ae, K, O;
			N.afterLayoutListener = null;
			if (R) {
				if (R === 2) {
					N.on("expand", "doSyncLockableLayout", N, {
						single: true
					})
				}
				return
			}
			if (T && V) {
				Q = T.isVisible(true) && !T.collapsed;
				ae = V.isVisible(true);
				U = T.view.el;
				X = V.view.el;
				ag = U.dom;
				L = X.dom;
				K = N.scrollBody.dom;
				Y = Q ? T.body.getRegion(true) : new Ext.util.Region(0, 0, 0, 0);
				af = ae ? V.body.getRegion(true) : new Ext.util.Region(0, 0, 0, 0);
				J = Ext.getScrollbarSize();
				G = J.width;
				aa = J.height;
				ab = ae ? af.width : 0;
				M = Q ? Y.width : 0;
				W = Q ? af.x - Y.x : 0;
				ac = (V.headerCt.tooNarrow || T.headerCt.tooNarrow) ? aa : 0;
				Z = af.height || Y.height;
				I = Z;
				P = N.lockedScrollbar;
				S = N.normalScrollbar;
				F = N.scrollbarVisibleCls;
				if (ac) {
					U.setStyle("margin-bottom", -aa + "px");
					X.setStyle("margin-bottom", -aa + "px");
					I -= aa;
					if (Q && T.view.body.dom) {
						N.lockedScrollbarScroller.setSize({
							x: T.headerCt.getTableWidth()
						})
					}
					if (V.view.body.dom) {
						N.normalScrollbarScroller.setSize({
							x: V.headerCt.getTableWidth()
						})
					}
				}
				N.scrollBody.setHeight(I);
				U.dom.style.height = X.dom.style.height = "";
				H = (N.scrollable.getSize().y + ac);
				V.view.stretchHeight(H);
				T.view.stretchHeight(H);
				ad = G && K.scrollHeight > K.clientHeight;
				if (ad && ab) {
					//ab -= G;
					X.setStyle("width", ab + "px")
				}
				P.toggleCls(F, Q && !!ac);
				S.toggleCls(F, !!ac);
				N.normalScrollbarClipper.toggleCls(N.scrollbarClipperCls + "-floated", !!N.normalGrid.floatedFromCollapse);
				N.normalScrollbar.toggleCls(N.scrollbarCls + "-floated", !!N.normalGrid.floatedFromCollapse);
				N.lockedScrollbarClipper.toggleCls(N.scrollbarClipperCls + "-floated", !!N.lockedGrid.floatedFromCollapse);
				N.lockedScrollbar.toggleCls(N.scrollbarCls + "-floated", !!N.lockedGrid.floatedFromCollapse);
				P.setSize(N.lockedScrollbarClipper.dom.offsetWidth, aa);
				S.setSize(ab, aa);
				N.setNormalScrollerX(W);
				if (Q && ae) {
					O = Y.union(af)
				} else {
					if (Q) {
						O = Y
					} else {
						O = af
					}
				}
				N.scrollContainer.setBox(O);
				N.onSyncLockableLayout(ad, O.width);
				N.getScrollable().scrollTo(N.lastScrollPos)
			}
		}	
		else {
			this.callParent();		
			return;
		}
	}
});
// Expanded Grid Control 
Ext.define('Ext.ramco.ExpGridPanel', {
    extend: 'Ext.grid.Panel',
    alias: 'widget.ramcoexpgrid',
    selModel: 'cellmodel',
    col: 0,
    enableLocking: true,
	columnLines:true,
    bufferedRenderer: true,
	enableColumnHide: false, // TECH-40820
	enablePaging:true,
    lastValue: {},
	expanderCnt: 0,
    config: {
        insertFlag: false,
        deleteFlag: false,
        showRowNumber: true,
        showSelection: true,
        showHeader: true,
        showToolbar: true,
        showScrollBar: false,
        showNoRows: true,
        showDefault: false,
		showFilter: false,
        cutFlag: true,
        copyFlag: true,
        exportExcelFlag: true,
		reportFlag:true,
		pdfFlag:true,
		htmlFlag:true,
        exportCsvFlag: true,
		importFlag :true,
		personalizeFlag :true,
        chartFlag: true,
        navigationOnly: false,
        personalization: {},
        reqBorder: true,
        visibleRows: 5,
        rowHeight: 18,
        value: null,
        stripeRows: true,
        forceFit: false,
        autoHeight: false,
        searchFlag: true,
		showRowExpander: false,		
		rowExpConfig:null
    },
    initComponent: function() {
        var me = this,
			mainClr = getMainController(),
			rowHeight = me.getRowHeight(),
			height = 0,
            newNoOfRows = me.getVisibleRows(),
            stripeRows = me.getStripeRows(),
            insertFlag = me.getInsertFlag(),
            deleteFlag = me.getDeleteFlag(),
            showRowNumber = me.getShowRowNumber(),
            showSelection = me.getShowSelection(),
            header = me.getShowHeader(),
            showToolbar = me.getShowToolbar(),
            showNoRows = me.getShowNoRows(),
            cutFlag = me.getCutFlag(),
            copyFlag = me.getCopyFlag(),
            exportExcelFlag = me.getExportExcelFlag(),
 			exportCsvFlag = me.getExportCsvFlag(),
            pdfFlag = me.getPdfFlag(),
			reportFlag = me.getReportFlag(),
			htmlFlag = me.getHtmlFlag(),
            exportCsvFlag = me.getExportCsvFlag(),
			importFlag = me.getImportFlag(),
			personalizeFlag = me.getPersonalizeFlag(),
            chartFlag = me.getChartFlag(),
            navigationOnly = me.getNavigationOnly(),
            showDefault = me.getShowDefault(),
			showFilter = me.getShowFilter(),
            reqBorder = me.getReqBorder(),
            forceFit = me.getForceFit(),
			modifiedFlag = false,
            searchFlag = me.getSearchFlag(),
			showRowExpander = me.getShowRowExpander();
			lastTskType = mainClr.getLastTaskType();
		// me.plugins = [{
			// ptype: 'bufferedrenderer',
			// viewSize: 50
		// }];	
        me.dockedItems = [{
            dock: 'top',
            xtype: 'toolbar',
            itemId: 'gridToolbar',
            overflowHandler: 'scroller',
            defaults: {
                scale: 'small',
                padding: 0
            },
            items: [
				{
					xtype: 'pagingtoolbar',
					userCls: 'x-paging-tbr',
					store: me.store.id,
					displayInfo: true,
					listeners: {
						beforechange: me.onPngTbrBeforeChange,
						change: me.onPngTbrChange,
						scope:me
					}					
				},				
				{
                    itemId: 'btnFirst',
                    xtype: 'button',
					hidden: true,
                    iconCls: 'x-fa fa-backward',
                    tooltip: rvw_resources.R140
                }, {
                    itemId: 'btnPrev',
                    xtype: 'button',
					hidden: true,
                    iconCls: 'x-fa fa-caret-left',
                    tooltip: rvw_resources.R141
                }, {
                    itemId: 'rowNav',
                    xtype: 'numberfield',
					hidden: true,
                    visibleLength: 2,
                    minValue: 1,
                    maxValue: 1
                }, {
                    itemId: 'dspRow',
					hidden: true,
                    xtype: 'component',
					tpl: '{v}'                    
                }, {
                    itemId: 'btnNext',
					hidden: true,
                    xtype: 'button',
                    iconCls: 'x-fa fa-caret-right',
                    tooltip: rvw_resources.R143
                }, {
                    itemId: 'btnLast',
					hidden: true,
                    xtype: 'button',
                    iconCls: 'x-fa fa-forward',
                    tooltip: rvw_resources.R144
                }, {
                    xtype: 'ramcolabel',
                    itemId: 'gridSelRow',
                    hidden: !RamcoRTC.settings.ShowSelectedRows || lastTskType != 'help'
                }, {
                    itemId: 'btnInsert',
                    xtype: 'button',
                    //hidden: navigationOnly || !insertFlag || !showToolbar,
					hidden: !insertFlag, //TECH-39835
                    iconCls: 'x-fa fa-plus',
                    tooltip: rvw_resources.R145
                }, {
                    itemId: 'btnDelete',
                    xtype: 'button',
                    //hidden: navigationOnly || !deleteFlag,
                    iconCls: 'x-fa fa-minus',
					hidden: !deleteFlag, //TECH-39835
                    tooltip: rvw_resources.R146
                }, {
                    itemId: 'btnCut',
                    xtype: 'button',
                    hidden: navigationOnly || !cutFlag,
                    iconCls: 'x-fa fa-cut',
                    tooltip: rvw_resources.R147
                }, {
                    itemId: 'btnCopy',
                    xtype: 'button',
                    hidden: navigationOnly || !copyFlag,
                    iconCls: 'x-fa fa-copy',
                    tooltip: rvw_resources.R148
                }, {
                    itemId: 'btnColumnDefault',
                    xtype: 'button',
                    hidden: !showDefault,
                    iconCls: 'x-fa fa-cog',
                    tooltip: rvw_resources.R245
                }, {
                    itemId: 'btnClearDefault',
                    xtype: 'button',
                    hidden: !showDefault,
                    iconCls: 'tech-ClearDefault_ic',
                    tooltip: rvw_resources.R246
                }, {
                    itemId: 'btnColumnFilter',
                    xtype: 'button',
                    hidden: !RamcoRTC.settings.enableColumnFilter,
                    iconCls: 'tech-Filter_ic',
                    tooltip: rvw_resources.R291
                }, {
                    itemId: 'btnClearFilter',
                    xtype: 'button',
                    hidden: !RamcoRTC.settings.enableColumnFilter,
                    iconCls: 'tech-ClearFilter_ic',
                    tooltip: rvw_resources.R292
                }, {
                    itemId: 'menuImport',
                    xtype: 'button',
                    hidden: navigationOnly || !insertFlag,
                    iconCls: 'x-fa fa-download',
                    menu: [{
                        text: rvw_resources.R026,
                        itemId: 'btnImpExcel',
                        tooltip: rvw_resources.R149,
                        iconCls: 'x-fa fa-file-excel-o'
                    }, {
                        text: rvw_resources.R161,
                        hidden: true,
                        tooltip: rvw_resources.R150,
                        itemId: 'btnImpOffice',
                        iconCls: 'x-fa fa-file-excel-o'
                    }]
                }, {
                    itemId: 'btnExport',
                    xtype: 'button',
                    hidden: navigationOnly || (!exportExcelFlag && !pdfFlag && !htmlFlag && !exportCsvFlag && !reportFlag && !chartFlag),
                    iconCls: 'x-fa fa-upload',
                    menu: [{
                        text: rvw_resources.R162,
                        itemId: 'btnExpExcel',
                        hidden: !exportExcelFlag,
                        tooltip: rvw_resources.R151,
                        iconCls: 'x-fa fa-file-excel-o'
                    }, {
                        text: rvw_resources.R163,
                        itemId: 'btnExpOffice',
                        hidden: true,
                        tooltip: rvw_resources.R152,
                        iconCls: 'x-fa fa-file-excel-o'
                    }, {
                        text: rvw_resources.R164,
                        itemId: 'btnExpPdf',
						hidden: !pdfFlag,
                        tooltip: rvw_resources.R153,
                        iconCls: 'x-fa fa-file-pdf-o'
                    }, {
                        text: rvw_resources.R165,
                        itemId: 'btnExpHtml',
						hidden: !htmlFlag,
                        tooltip: rvw_resources.R154,
                        iconCls: 'x-fa fa-html5'
                    }, {
                        text: rvw_resources.R166,
                        itemId: 'btnExpCsv',
                        hidden: !exportCsvFlag,
                        tooltip: rvw_resources.R155,
                        iconCls: 'x-fa fa-file-excel-o'
                    }, {
                        text: rvw_resources.R021,
                        itemId: 'btnExpReport',
						hidden: !reportFlag,
                        tooltip: rvw_resources.R156,
                      //  iconCls: 'x-fa fa-wpforms'
                        iconCls: 'tech-report' //TECH-25040
                    }, {
                        text: rvw_resources.R027,
                        itemId: 'btnExpChart',
						hidden: !chartFlag,
                        tooltip: rvw_resources.R027,
                        iconCls: 'x-fa fa-bar-chart '
                    }]
                },
                '-',
                '->',                
				{
                    itemId: 'tBarGrpBtn',
                    xtype: 'button',
					hidden:true,//TECH-28696 / TECH-29031
                   // hidden: navigationOnly || !personalizeFlag,
                    iconCls: 'x-toolbar-more-icon',
                    menu: [{
                        text: rvw_resources.R157,
                        itemId: 'savePers',
                        hidden: navigationOnly,
                        tooltip: rvw_resources.R157,
                        iconCls: 'x-fa fa-thumb-tack'
                    }, {
                        text: rvw_resources.R158,
                        itemId: 'removePers',
                        hidden: navigationOnly,
                        tooltip: rvw_resources.R158,
                        iconCls: 'x-fa fa-thumb-tack-left'
                    }, {
                        text: rvw_resources.R159,
                        itemId: 'columnChooser',
                      //  hidden: navigationOnly,
                        hidden: (RamcoRTC.settings.showColumnChooser === false),//TECH-30249
                        tooltip: rvw_resources.R159,
                        iconCls: 'x-fa fa-columns'
                    }, {
                        text: rvw_resources.R302,
                        itemId: 'multiSort',
                        //hidden: (RamcoRTC.settings.enableMultiSort) ? false : true,
                        hidden: (!RamcoRTC.userInfo.hasmsort),
                        tooltip: rvw_resources.R302,
                        iconCls: 'tech-Sort_ic'
                    }, {
                        text: rvw_resources.R303,
                        itemId: 'clearMultiSort',
                        //hidden: (RamcoRTC.settings.enableMultiSort) ? false : true,
                        hidden: (!RamcoRTC.userInfo.hasmsort),
                        tooltip: rvw_resources.R303,
                        iconCls: 'tech-ClearSort_ic'
                    }]
                }, {
                    xtype: 'combobox',
                    itemId: 'fieldList',
                    hidden: !searchFlag || navigationOnly,
                    store: {
                        fields: ['vid', 'name'],
                        proxy: {
                            type: 'memory',
                            reader: 'array'
                        }
                    },
                    queryMode: 'local',
                    displayField: 'name',
                    valueField: 'vid',
                    grow: true,
                    growToLongestValue: true,
                    forceSelection: true,
					//TECH-31386
					matchFieldWidth: false,
					listConfig:{
						minWidth: 120
					}
                }, {
                    xtype: 'textfield',
                    itemId: 'fieldSearch',
                    hidden: !searchFlag || navigationOnly,
                    emptyText: rvw_resources.R170,
                    searchIcon: true,
                    role: 'uipage'
                }
            ]
        }, {
            dock: 'right',
            xtype: 'container',
            itemId: 'gridScroller',
            padding: 0,
            margin: 0,
            width: 17,
            focusable: true,
			hidden:true,
            defaults: {
                padding: 0,
                margin: 0
            },
            layout: {
                type: 'vbox',
                align: 'stretchmax',
                vertical: true,
                stretchMaxPartner: 'gridSlider'
            },
            items: [{
                width: 17,
                xtype: 'component',
                itemId: 'headerSpace',
                cls: 'x-headerSpace',
                height: 17
            }, {
                width: 17,
                xtype: 'button',
                itemId: 'btnUp',
                iconCls: 'x-fa fa-caret-up',
                ui: 'plain',
                cls: 'x-scr-scrollBtn x-scrollBtn-top',
                height: 17
            }, {
                itemId: 'gridSlider',
                xtype: 'ramcoslider',
                width: 17,
                flex: 1,
                vertical: true,
                value: 1,
                increment: 1,
                minValue: 1,
                maxValue: 1,
            }, {
                width: 17,
                xtype: 'button',
                itemId: 'btnDown',
                iconCls: 'x-fa fa-caret-down',
                cls: 'x-scrollBtn x-scrollBtn-bottom',
                ui: 'plain',
                height: 17
            }, {
                width: 17,
                xtype: 'component',
                itemId: 'bottomSpace',
                cls: 'x-bottomSpace',
                height: 17,
                hidden: true
            }]
        }];
		var hasEditor =false;
		// TECH-40278
		//if ( !insertFlag ) {
			var i =0,
				len = me.columns.length;
			for ( ; i < len; i++ ) {
				if ( me.columns[i].editor ) {
					hasEditor = true;
					break;
				}
			}
		//}
		
		if (insertFlag || hasEditor) {
			if(!me.plugins) {
				me.plugins = [];
			}
            me.plugins.push({
                ptype: 'cellediting',
				id:'gridCellEdit',
                clicksToEdit: 1
            });
        }		
        if (!showRowNumber && me.columns.length > 2) {
            me.columns[0].hidden = true;
        }
        if (!showSelection && me.columns.length > 2) {
            me.columns[1].hidden = true;
        }
        me.hideHeaders = !header;
        // me.LockedViewConfig = {
            // stripeRows: stripeRows,
            // scrollable: {
                // x: 'auto',
                // y: false
            // }
		// };
        // me.normalViewConfig = {
            // deferEmptyText: false,
            // emptyText: showNoRows ? rvw_resources.R033 : '',
            // stripeRows: stripeRows,
            // scrollable: {
                // x: 'auto',
                // y: 'scroll'
            // }
		// };
		// me.viewConfig = Ext.applyIf(me.viewConfig || {}, {
            // deferEmptyText: false,
            // //emptyText: showNoRows ? rvw_resources.R033 : '',
            // stripeRows: stripeRows,
            // scrollable: {
                // x: 'auto',
                // y: 'scroll'
            // }
		// });
        //me.leadingBufferZone = 50;
        //me.trailingBufferZone = 50;
        if (reqBorder) {
            me.cls = Ext.baseCSSPrefix + 'grid-border';
            //me.viewConfig['cls'] = Ext.baseCSSPrefix + 'grid-border';
        }
		rowHeight += (RamcoRTC.settings.isExt2 == true) ? 2 : 4;
        //me.setRowHeight(rowHeight);        
		me.callParent();		
		var deleteFlag = me.getDeleteFlag(),
            view = me.getView(),
            width = 0,
            scrollbar = me.getDockedComponent('gridScroller'),
            showScrollBar = me.getShowScrollBar(),
            searchFlag = me.getSearchFlag(),
            gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null,
            headerSpace = scrollbar ? scrollbar.getComponent('headerSpace') : null,
            bottomSpace = scrollbar ? scrollbar.getComponent('bottomSpace') : null,
            btnUp = scrollbar ? scrollbar.getComponent('btnUp') : null,
            btnDown = scrollbar ? scrollbar.getComponent('btnDown') : null,
            topbar = me.getDockedComponent('gridToolbar'),
            btnFirst = topbar ? topbar.getComponent('btnFirst') : null,
            btnPrev = topbar ? topbar.getComponent('btnPrev') : null,
            btnNext = topbar ? topbar.getComponent('btnNext') : null,
            btnLast = topbar ? topbar.getComponent('btnLast') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            dspSelRow = topbar ? topbar.getComponent('gridSelRow') : null,
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            fieldSearch = topbar ? topbar.getComponent('fieldSearch') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            deleteBtn = topbar ? topbar.getComponent('btnDelete') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            btnColumnDefault = topbar ? topbar.getComponent('btnColumnDefault') : null,
            btnClearDefault = topbar ? topbar.getComponent('btnClearDefault') : null,
			btnColumnFilter = topbar ? topbar.getComponent('btnColumnFilter') : null,
            btnClearFilter = topbar ? topbar.getComponent('btnClearFilter') : null,
			groupingBtn = topbar ? topbar.getComponent('tBarGrpBtn') : null,			
			btnSave = groupingBtn ? groupingBtn.menu.items.getByKey('savePers') : null,
            btnRemove = groupingBtn ? groupingBtn.menu.items.getByKey('removePers') : null,
            btnChoose = groupingBtn ? groupingBtn.menu.items.getByKey('columnChooser') : null,
			btnMultiSort = groupingBtn ? groupingBtn.menu.items.getByKey('multiSort') : null,
			btnClearMultiSort = groupingBtn ? groupingBtn.menu.items.getByKey('clearMultiSort') : null,
			columns = me.getVisibleColumnManager().getColumns(),
            lHeaderCt,
            nHeaderCt,
			impExcel, expExcel, expPdf, expCsv, expHtml, btnExpReport, btnExpChart, menuImport, btnExport;
			
			if (RamcoRTC.settings.isExt2 == true) {
				/* impExcel = topbar ? topbar.getComponent('btnImpExcel') : null;
				expExcel = topbar ? topbar.getComponent('btnExpExcel') : null;
				expPdf = topbar ? topbar.getComponent('btnExpPdf') : null;
				expCsv = topbar ? topbar.getComponent('btnExpCsv') : null;
				expHtml = topbar ? topbar.getComponent('btnExpHtml') : null;
				btnExpReport = topbar ? topbar.getComponent('btnExpReport') : null;
				btnExpChart = topbar ? topbar.getComponent('btnExpChart') : null;
				btnSave = topbar ? topbar.getComponent('savePers') : null;
				btnRemove = topbar ? topbar.getComponent('removePers') : null;
				btnChoose = topbar ? topbar.getComponent('columnChooser') : null;
				btnMultiSort = topbar ? topbar.getComponent('multiSort') : null;
				btnClearMultiSort = topbar ? topbar.getComponent('clearMultiSort') : null; */
				//TECH-39027
				menuImport = topbar ? topbar.getComponent('menuImport') : null;
				btnExport = topbar ? topbar.getComponent('btnExport') : null;			
				impExcel = menuImport ? menuImport.menu.items.getByKey('btnImpExcel') : null;
				expExcel = btnExport ? btnExport.menu.items.getByKey('btnExpExcel') : null;
				expPdf = btnExport ? btnExport.menu.items.getByKey('btnExpPdf') : null;
				expCsv = btnExport ? btnExport.menu.items.getByKey('btnExpCsv') : null;
				expHtml = btnExport ? btnExport.menu.items.getByKey('btnExpHtml') : null;
				btnExpReport = btnExport ? btnExport.menu.items.getByKey('btnExpReport') : null;
				btnExpChart = btnExport ? btnExport.menu.items.getByKey('btnExpChart') : null;
			}
			else {
				menuImport = topbar ? topbar.getComponent('menuImport') : null;
				btnExport = topbar ? topbar.getComponent('btnExport') : null;			
				impExcel = menuImport ? menuImport.menu.items.getByKey('btnImpExcel') : null;
				expExcel = btnExport ? btnExport.menu.items.getByKey('btnExpExcel') : null;
				expPdf = btnExport ? btnExport.menu.items.getByKey('btnExpPdf') : null;
				expCsv = btnExport ? btnExport.menu.items.getByKey('btnExpCsv') : null;
				expHtml = btnExport ? btnExport.menu.items.getByKey('btnExpHtml') : null;
				btnExpReport = btnExport ? btnExport.menu.items.getByKey('btnExpReport') : null;
				btnExpChart = btnExport ? btnExport.menu.items.getByKey('btnExpChart') : null;
			}
        height = me.getGridHeight(newNoOfRows);
        me.col = 0;
        fieldList.suspendLayouts();			
		fieldSearch.suspendLayouts();			
        /*if (!searchFlag) {
            fieldList.hide();
			fieldSearch.hide();
        } else {
            fieldList.show();
			fieldSearch.show();
		}
		fieldSearch.resumeLayouts();
		fieldList.resumeLayouts();	*/		
        if (gridSlider) {
            me.mon(gridSlider, {
                changecomplete: me.onGridSliderChange,
                scope: me
            });
        }
		if(rowNav) {
			me.mon(rowNav, {
				specialkey:me.onRowNumSet,
				scope:me
			});
		}
        if (btnFirst)
            me.mon(btnFirst, {
                click: me.onBtnFirst,
                scope: me
            });
        if (btnPrev)
            me.mon(btnPrev, {
                click: me.onBtnPrev,
                scope: me
            });
        if (btnNext)
            me.mon(btnNext, {
                click: me.onBtnNext,
                scope: me
            });
        if (btnExpReport)
            me.mon(btnExpReport, {
                click: me.onBtnExpReport,
                scope: me
            });
        if (btnExpChart)
            me.mon(btnExpChart, {
                click: me.onBtnExpChart,
                scope: me
            });
        if (btnLast)
            me.mon(btnLast, {
                click: me.onBtnLast,
                scope: me
            });

        if (btnUp)
            me.mon(btnUp, {
                click: me.onBtnUp,
                scope: me
            });
        if (btnDown)
            me.mon(btnDown, {
                click: me.onBtnDown,
                scope: me
            });

        // Toolbar event Handler
        if (insertBtn)
            me.mon(insertBtn, {
                click: me.onInsert,
                scope: me
            });
        if (deleteBtn)
            me.mon(deleteBtn, {
                click: me.onDelete,
                scope: me
            });
        if (btnCut)
            me.mon(btnCut, {
                click: me.onCutAppendRow,
                scope: me
            });
        if (btnCopy)
            me.mon(btnCopy, {
                click: me.onCopyAppendRow,
                scope: me
            });
        if (btnColumnDefault) {
            me.mon(btnColumnDefault, {
                click: me.onColumnDefault,
                scope: me
            });
        }
        if (btnClearDefault) {
            me.mon(btnClearDefault, {
                click: me.onColumnClearDefault,
                scope: me
            });
        }
		if (btnColumnFilter) {
            me.mon(btnColumnFilter, {
                click: me.onColumnFilter,
                scope: me
            });
        }
        if (btnClearFilter) {
            me.mon(btnClearFilter, {
                click: me.onColumnClearFilter,
                scope: me
            });
        }
		if (impExcel) {
            me.mon(impExcel, {
                click: me.onImportExcel,
                scope: me
            });
            if (!impExcel.isHidden()) {
                me.importWindow = Ext.create('Ext.ramco.Import', {
                    height: 200,
                    width: 400,
                    scrollable: true,
                    hidden: true,
                    modal: true
                });
                me.importWindow.BtnImport.on('click', me.onBtnImportClick, me);
				me.importWindow.BtnValidate.on('click', me.onBtnValidateClick, me);
            }
        }
        if (expExcel)
            me.mon(expExcel, {
                click: me.onshowExcel,
                scope: me
            });
        if (expPdf)
            me.mon(expPdf, {
                click: me.onshowPDF,
                scope: me
            });
        if (expCsv) {
            me.mon(expCsv, {
                click: me.onshowCSV,
                scope: me
            });
        }
        if (expHtml)
            me.mon(expHtml, {
                click: me.onViewall,
                scope: me
            });
        if (btnSave)
            me.mon(btnSave, {
                click: me.onSavePers,
                scope: me
            });
        if (btnRemove)
            me.mon(btnRemove, {
                click: me.onRemovePers,
                scope: me
            });
        if (btnChoose)
            me.mon(btnChoose, {
                click: me.onColumnChoose,
                scope: me
            });		
		if (btnMultiSort)
			me.mon(btnMultiSort, {click: me.onMultiSort,scope: me});
		if (btnClearMultiSort)
			me.mon(btnClearMultiSort, {click: me.onClearMultiSort,scope: me});
			me.mon(me, {
				scope: me,
				columnresize: me.onGridColumnResize,
				columnmove: me.onGridColumnMove
			});
        if (me.view) {
            me.mon(me.view, {
                scope: me,
                focuschange: me.updateGridSlider,
                cellkeydown: me.onCellKeyDown,
                beforecellkeydown: me.onBeforeCellKeyDown,
				expandbody: me.onExpandBody,
				expandcompleted: me.onExpandBody,
				collapsebody:me.onCollapsebody
            });
        }
        if (me.lockable)
            headerCt = view.normalView.getHeaderCt();
        else
            headerCt = view.getHeaderCt();
        me.mon(headerCt, {
            resize: me.onResizeHeader,
            scope: me
        });
		me.mon(me, {
			beforeedit: me.onBeforeEdit,
			validateedit:me.onValidateedit,
			scope:me
		});
		if (!header) {
            if (headerSpace)
                headerSpace.hide();
            if (me.lockable) {
                headerCt = view.lockedView.getHeaderCt();
                headerCt.setHeight(0)
                headerCt.hiddenHeaders = true;
                headerCt = view.normalView.getHeaderCt();
                headerCt.setHeight(0)
                headerCt.hiddenHeaders = true;
            } else {
                headerCt = view.getHeaderCt()
                headerCt.setHeight(0)
                headerCt.hiddenHeaders = true;
            }
        }
        if (height > 0) {
            me.setHeight(height);
        }
        if (topbar) {
            topbar[showToolbar ? 'show' : 'hide']();
        }
        if (!showRowNumber && !showSelection) {
            if (me.lockable) {
                view.lockedView.addCls('noborder');
            } else {
                view.addCls('noborder');
            }
        }
        if (reqBorder === false) {
            if (me.lockable) {
                view.lockedGrid.addCls('noborder');
                view.normalGrid.addCls('noborder');
                view.ownerGrid.addCls('noborder');
            } else {
                me.addCls('noborder');
            }
        }
        if (me.lockable) {
            view.normalGrid.view.rowHeight = rowHeight;
            view.lockedGrid.view.rowHeight = rowHeight;
            view.lockedGrid.rowHeight = rowHeight;
            view.normalGrid.rowHeight = rowHeight;
            //view.normalGrid.view.onAfter('resize', me.onViewResize, me);
        } else {
            view.rowHeight = rowHeight;
           // view.onAfter('resize', me.onViewResize, me);
        }
        if (fieldList && columns) {
            var flag = true,
                data = [{
                    vid: 'v0',
                    name: rvw_resources.R007
                }];
			if (columns && columns.length > 0) {	
				var len = columns.length,
					i = 0,
					element = null;
				for(; i < len; i++) {
					element = columns[i];	
					//columns.forEach(function(element, index, array) {
                if (!(element.dataIndex == 'rn' || element.dataIndex == 'sel' || element.xtype == "ramcotemplatecolumn" || element.xtype == "imagecolumn" || element.xtype == "fileattachcolumn" || element.xtype == "attachcolumn" || element.xtype == "deletecolumn")) {
                    if (element.hidden != true) {
                        data.push({
                            vid: element.dataIndex,
                            name: element.text || ''
                        });
                    }
                    //if (element.hidden != true && (element.editor || element.xtype == 'attachcolumn') && insertFlag && !navigationOnly) {
					if (element.hidden != true && (element.editor || element.xtype == 'attachcolumn' || element.xtype == 'ramcogridcheck') && !navigationOnly) {
                        //insertFlag = true;
						modifiedFlag = true;
                        if (element.xtype == 'attachcolumn')
                            flag = false;
                        me.setInsertFlag(insertFlag);
                    }
                }
				}
			//);
			}
			if (flag && !showToolbar && insertFlag)
				insertFlag = insertFlag;
            else if (flag && !showToolbar && insertFlag && !navigationOnly)
                insertFlag = showToolbar;
            else if (flag && insertFlag && navigationOnly)
                insertFlag = false;
            me.setInsertFlag(insertFlag);
            fieldList.getStore().setData(data);
            fieldList.setValue('v0');
        }
        /*if (deleteFlag && showSelection)
            deleteBtn.show();
        //else
           // deleteBtn.hide();
		if (insertFlag) {
            insertBtn.show();
            if (cutFlag) {
            	btnCut.show();
			}
			if (copyFlag) {
            	btnCopy.show();
			}
		}
		else {
            insertBtn.hide();
            if (flag && !insertFlag)
                me.setInsertFlag(false);
            btnCut.hide();
            btnCopy.hide();
		}*/
		
		if(!showToolbar)
			me.setInsertFlag(false);
		// AHBG-31969
		//importFlag = insertFlag;
		// TECH-40278
		if (importFlag && !hasEditor) {
			importFlag = false;
		}
		
		if (RamcoRTC.settings.isExt2 == true) {
			if (impExcel) {
			if (modifiedFlag && importFlag) {
					impExcel.show();
					} 
					else {
					impExcel.hide();
				}
			}
		}
		else {			
			if (modifiedFlag && importFlag) {
				menuImport.show();
			} else {
				menuImport.hide();
			}
			/*if(!exportExcelFlag && !pdfFlag && !htmlFlag && !exportCsvFlag && !reportFlag && !chartFlag) {
				btnExport.hide();
			}
			else {
				btnExport.show();
			}*/
		}
    },
	onPngTbrBeforeChange: function(pagtbr, page, eOpts) {
		var me = this;
			store = me.store;
			store.proxy.lastAction = "read";
			store.sync();
	},
	onPngTbrChange: function(pagtbr, page, eOpts) {
		var me = this;
		if(me.lastEvent == "stinsert") {
			me.createDummyRecord();
			me.lastEvent = "";
		}
	},
	onBeforeEdit: function(editor, context, eOpts) {
		var me = this,
			record = context.record,
			column = context.column,
			colEditor = column.editor,
			editors = editor.editors,
			cellEditor = editors ? editors.getByKey(context.field) : null,
			field = cellEditor ? cellEditor.field : null;
			editor.grid.edited = true;
		if (field && field.xtype == "combofield") {
			field.clearLocalFilter();
		}	
		if (field && field.xtype == "ramcosupersegment") {
			return field.prepare(record);
		} 
		else if (editor && editor.xtype == "ramcosupersegment") {
			editor.record = record;
		}
	},
	onValidateedit: function(editor, context, eOpts) {
		var me = this,
			record = context.record,
			column = context.column,
			colEditor = column.editor,
			editors = editor.editors,
			ilbo = me.up('ilbo'),
			cellEditor = editors ? editors.getByKey(context.field) : null,
			field = cellEditor ? cellEditor.field : null;
		if(!Ext.isEmpty(field) && !field.isValid()) {
			context.cancel = false;
			return false;
		}
		delete context.cancel;
		if(field) {
			//TECH-38989 
			if (ilbo && ilbo.callout && ilbo.callout.onGridEditOnBlur) {
	            try {
	                ilbo.callout.onGridEditOnBlur.apply(ilbo || window, [me, column, field,record]);
	            }
				catch (e) {
	                console.log("Error in Callout Js." + e);
	            }
	        }
			if (column.hasMasking === true) {
				record.set(column.dataCol, field.getValue());
			}
			if (field && field.xtype == "ramcosupersegment") {
				field.updateRecord(record);
			}
			if (field.hasEnter && column.customListEdit === true) {
				field.hasEnter = false;
				record.dirty = true;
				if(!record.modified) {
					record.modified = [];
					record.modified[column.dataIndex] = true;
				}
				if(field.listSelection) {
					field.ownerCt.completeEdit();
					field.grid.fireEvent('customlistselect', field, field.listSelection);
					field.listSelection = null;
					delete field.listSelection;
				}			
				return false;
			}
			if (field.hasEnter && column.uiTask) {            			
				field.hasEnter = false;
				record.dirty = true;
				if(!record.modified) {
					record.modified = [];
					record.modified[column.dataIndex] = true;
				}			
				if(field.listSelection) {
					me.fireEvent('listselect', field, field.listSelection);
					field.listSelection = null;
					delete field.listSelection;
				}
				else {
					Ext.defer(function(){me.fireEvent('enter', me, column, record)},10);
				}
			}
		}
		return true;
	},	
	getGridHeight: function(newNoOfRows) {
		return;
		/* var me = this,
			rowHeight = me.getRowHeight(),
			showToolbar = me.getShowToolbar(),
			header = me.getShowHeader(),
			view = me.view,
			expConfig = me.rowExpConfig,
			expRowHeight = 0,
			headerHeight = 0,
			height = 0;
		if (newNoOfRows == 0)
			newNoOfRows++;
		height = (newNoOfRows * (rowHeight + 1));
		if (me.rendered) {
			if (header) {
				var headerCt;
				if (me.lockable)
					headerCt = view.normalView.getHeaderCt();
				else
					headerCt = view.getHeaderCt();
				headerHeight = headerCt.getHeight();
				if (headerHeight == 0)
					headerHeight = me.oldheaderHeight;
				height += headerHeight;
			}
			var nGridView = view.normalGrid ? view.normalView : view;
			if (nGridView.rendered && nGridView.el.dom.scrollWidth > nGridView.el.dom.clientWidth)
				height += Ext.getScrollbarSize().height;
		}
		if (showToolbar != false)
			height += 26;
		if (expConfig && expConfig.height) {
			expRowHeight = parseInt(me.expanderCnt * expConfig.height);
			height += expRowHeight;
		}
		return height; */
	},
	onGridSliderChange: function(slider, newValue, thumb, eOpts) {
        var me = this,
            view = me.getView(),
            visibleRows = me.getVisibleRows(),
            cr = newValue,
            tr = me.tr,
            store = me.store,
            lastRow = store.count(),
            insertFlag = me.getInsertFlag(),
            last = insertFlag ? 2 : 1,
            lastRecord = lastRow > 0 ? store.getAt(lastRow - last) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = newValue > visibleRows ? newValue - visibleRows : 1,
            end = (visibleRows * 3) + (start - 1),
			rowHeight = parseInt(me.rowHeight + 1),
            si, ei;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		if(slider.sliderNav == 'down')
			me.lastEvent = 'onnext';
		else if(slider.sliderNav == 'up')
			me.lastEvent = 'onprev';
        if (!(cr >= si && cr <= ei)) {
            me.store.start = start;
            me.store.end = end;
            me.store.cr = cr;
            me.store.vsi = cr;
            me.store.changed = true;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        } else {
            me.store.cr = cr;
            me.cr = cr;
			me.gridFocus(me.col, cr);			
        }
    },
	onGridColumnResize: function(ct, column, width, eOpts) {
        var me = this,            
            lastDataWi,
            data = me.getPersonalization() || [];
        if (me) {
            if (!data[column.dataIndex]) {
                data[column.dataIndex] = {
                    wi: (width - column.cellWidth),
                    pa: true
                };
            } else {
                data[column.dataIndex].wi = (width - column.cellWidth);
                data[column.dataIndex].pa = true;
            }
            column.piWidth = width;
            me.setPersonalization(data);
        }        
    },
    onGridColumnMove: function(ct, column, fromIdx, toIdx, eOpts) {
        if (!Ext.isEmpty(fromIdx) && !Ext.isEmpty(toIdx)) {
            var me = this,
                //grid = column.up('ramcogrid'),
                data = me.getPersonalization();
            if (me) {
                data.seqChanged = true;
                me.setPersonalization(data);
            }
        }
    },
    updateGridSlider: function(sel, prevRecord, record) {
        if (this.updating)
            return;
        var me = this,
            rowNav = me.down('#rowNav');
        gridSlider = me.down('#gridSlider');
        if (gridSlider && record) {
            gridSlider.suspendEvents();
            me.cr = record.get('rn')
            me.store.cr = me.cr;
            gridSlider.setValue(me.cr);
            gridSlider.resumeEvents();
        }
    },
    updateSliderPosition: function(recNo, zoom) {
        if (this.updating)
            return;
        var me = this,
            gridSlider = me.down('#gridSlider'),
            zoomSlider = zoom ? zoom.down('#zoomSlider') : null,
            vr = null,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null;
        if (gridSlider) {
            me.cr = recNo;
            me.store.cr = me.cr;
            vr = (recNo + (me.store.vr / 3)) > me.tr ? me.tr : (recNo + (me.store.vr / 3) - 1);
            if (!zoomSlider)
                gridSlider.suspendEvents();
            gridSlider.setValue(recNo, null, true);
            if (zoomSlider)
                zoomSlider.setValue(recNo, null, true);
            if (rowNav)
                rowNav.setValue(recNo);
            if (dspRow) {
                //dspRow.setHtml('- ' + vr + '/' + me.tr);
				dspRow.update({v:'- ' + parseInt(vr) + '/' + (me.tr)});
			}
            if (!zoomSlider)
                gridSlider.resumeEvents();
        }
    },
    onBeforeCellKeyDown: function(view, td, cellIndex, record, trD, rowIndex, e, eOpts) {
		return;
		/*if(this.editingPlugin && this.editingPlugin.editing)
			return;
        var me = this,
            view = me.getView(),
            nav = me.getNavigationModel(),
            pos = nav ? nav.getPosition() : null,
            visibleRows = me.getVisibleRows(),
            selModel = view.getSelectionModel(),
            vsi = (e.keyCode == 33) ? me.store.vsi : me.cr,
            tr = me.tr,
            keyCode = e.keyCode,
            store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            si, ei, len = 0,
            val, vm, column, hasBreak = false,
            normalGrid = me.normalGrid.getView(),
            lockingPartner = normalGrid.lockingPartner && normalGrid.lockingPartner.grid.isVisible() ? normalGrid.lockingPartner : null,
            columns = me.getVisibleColumnManager().getColumns(),
            trDom = Ext.fly(trD),
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
			lokgr = me.getScrollable(),
			normalScroller = null,			
            rowNav = topbar ? topbar.getComponent('rowNav') : null;
        if (trDom)
            var trDBox = trDom.getBox();
        var viewBox = view.el.getBox();
		normalScroller = lokgr.getNormalScroller();
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (keyCode && keyCode > 32 && keyCode < 41) {
            switch (keyCode) {
				case 37: //"LEFT",
					var leftEle;
					leftEle = nav.move("left", e);
                    if (pos && pos.isFirstColumn && pos.isFirstColumn()) {
                        if (lockingPartner) {
							if(!pos.column.locked) {								
								if (leftEle) {
									nav.setPosition(leftEle, null, e);
								}
								return;
							}
							else
								columns = lockingPartner.getVisibleColumnManager().getColumns();
						}
                        me.col = columns[columns.length - 1];                    
						vsi = vsi - 1;
						start = vsi > visibleRows ? vsi - visibleRows : 1;
						end = (visibleRows * 3) + (start - 1);
						if ((vsi >= si && vsi <= ei) && viewBox.top == trDBox.top) {
							lokgr.scrollBy(0, -(me.rowHeight + 1));
							lokgr.trackingScrollTop -= (me.rowHeight + 1);
							nav.setPosition(leftEle, null, e);
							selModel.select({
								row: leftEle.rowIdx,
								column: leftEle.colIdx - 1
							});
							normalScroller.trackingScrollTop = lokgr.trackingScrollTop;							
							//me.updateRowPostion(vsi, nav, selModel);
							me.updateRowNavigation(vsi);
							//me.store.vsi = vsi;
							return false;
						}
						if (vsi > 0 && !(vsi >= si && vsi <= ei)) {
							me.store.start = start;
							me.store.end = end;
							me.store.vsi = vsi;
							me.store.changed = true;
							me.lastEvent = 'onnext';
							me.fireEvent('movetorow', me, start, end, me.store.vsi, 'up');
							return false;
						}
					}
                    break;
                case 38: //"UP",
                    vsi = vsi - 1;
                    start = vsi > visibleRows ? vsi - visibleRows : 1;
                    end = (visibleRows * 3) + (start - 1);
                    if ((vsi >= si && vsi <= ei) && viewBox.top == trDBox.top) {
                        lokgr.scrollBy(0, -(me.rowHeight + 1));
						lokgr.trackingScrollTop -= (me.rowHeight + 1);
						normalScroller.trackingScrollTop = lokgr.trackingScrollTop;
                        //me.updateRowPostion(vsi, nav, selModel);
						me.updateRowPostion(vsi, nav, selModel, cellIndex);
                        me.updateRowNavigation(vsi);
						//me.store.vsi = vsi;
                        return false;
                    }
                    if (vsi > 0 && !(vsi >= si && vsi <= ei)) {
                        me.store.start = start;
                        me.store.end = end;
                        me.store.vsi = vsi;
                        me.store.changed = true;
                        me.lastEvent = 'onnext';
                        me.fireEvent('movetorow', me, start, end, me.store.vsi, 'up');
						return false;
                    }
                    break;
				case 39: //"RIGHT",
					var rightEle;
                    vsi = vsi + 1;
					start = vsi > visibleRows ? vsi - visibleRows : 1;
                    end = (visibleRows * 3) + (start - 1);
                    if ((vsi >= si && vsi <= ei) && (trDBox.top + 1) >= (viewBox.bottom - me.rowHeight) && trDBox.top <= viewBox.bottom) {
						if (pos && pos.isLastColumn && pos.isLastColumn() && !pos.column.locked) {
							me.col = 0;							
							lokgr.scrollBy(0, (me.rowHeight + 1));
							lokgr.trackingScrollTop += (me.rowHeight + 1);
							normalScroller.trackingScrollTop = lokgr.trackingScrollTop;
							normalScroller.trackingScrollLeft = 0;
							//me.updateRowPostion(vsi, nav, selModel);
							rightEle = nav.move("right", e);
							if (rightEle) {
								nav.setPosition(rightEle, null, e);
								selModel.select({
									row: rightEle.rowIdx,
									column: rightEle.colIdx - 1
								});
							}
							me.updateRowNavigation(vsi, 'down');							
							return false;
						}
                    }
                    if (vsi <= tr && !(vsi >= si && vsi <= ei)) {
                        me.store.start = start;
                        me.store.end = end;
                        me.store.vsi = vsi;
                        me.store.changed = true;
                        me.lastEvent = 'onnext';
                        me.fireEvent('movetorow', me, start, end, me.store.vsi, 'down');
						return false;
                    }
                    break;
                case 40:
                    vsi = vsi + 1;
                    start = vsi > visibleRows ? vsi - visibleRows : 1;
                    end = (visibleRows * 3) + (start - 1);
                    if ((vsi >= si && vsi <= ei) && (trDBox.top + 1) >= (viewBox.bottom - me.rowHeight) && trDBox.top <= viewBox.bottom) {
                        lokgr.scrollBy(0, (me.rowHeight + 1));
						lokgr.trackingScrollTop += (me.rowHeight + 1);
						normalScroller.trackingScrollTop = lokgr.trackingScrollTop;
                        me.updateRowPostion(vsi, nav, selModel, cellIndex);
                        me.updateRowNavigation(vsi, 'down');
						//me.store.vsi = vsi;
                        return false;
                    }
                    if (vsi <= tr && !(vsi >= si && vsi <= ei)) {
                        me.store.start = start;
                        me.store.end = end;
                        me.store.vsi = vsi;
                        me.store.changed = true;
                        me.lastEvent = 'onnext';
                        me.fireEvent('movetorow', me, start, end, me.store.vsi, 'down');
						return false;
                    }
                    break;
            }
        }
		*/
    },
    updateRowPostion: function(vsi, navModel, selModel) {
        var me = this,
            rowIndex = -1,
            record = me.store.findRecord('rn', vsi);
        if (record)
            rowIndex = me.store.indexOf(record);
        if (rowIndex > -1) {
            navModel.setPosition(rowIndex, me.col, navModel.cell);
            navModel.focusPosition(navModel.getPosition());			
        }
    },
    updateRowNavigation: function(vsi, keyNav) {
        var me = this,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
			inFlag = me.insertFlag,
			store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
			totRow = me.tr,
			vr;						
			//totRow = (me.insertFlag && keyNav != "insert") ? me.tr - 1 : me.tr,
			if (lastRecord && lastRecord.get('isNew')) {
				totRow = me.tr - 1;
			}
            //vr = (vsi + (me.store.vr / 3)) > me.tr ? me.tr : (vsi + (me.store.vr / 3) - 1);
			vr = (vsi + (me.visibleRows)) > totRow ? totRow : (vsi + (me.visibleRows) - 1);
        if (rowNav && dspRow) {
			dspRow.suspendLayouts();
            if (keyNav && keyNav == 'down') {
                rowNav.setValue((vsi - me.visibleRows) + 1);
                //dspRow.setHtml('- ' + vsi + '/' + (totRow));
				dspRow.update({v:'- ' + parseInt(vsi) + '/' + (totRow)});
            }
			else if (keyNav && keyNav == 'last') {
                rowNav.setValue((vsi - me.visibleRows) + 1);
                //dspRow.setHtml('- ' + vsi + '/' + (totRow));
				dspRow.update({v:'- ' + parseInt(vsi) + '/' + (totRow)});
            }
			else if (keyNav && (keyNav == 'onnext' || keyNav == 'onprev')) {
				rowNav.setValue(vsi);
                //dspRow.setHtml('- ' + vr + '/' + (totRow));
				dspRow.update({v:'- ' + parseInt(vr) + '/' + (totRow)});
            }
			else {
                rowNav.setValue(vsi);
                //dspRow.setHtml('- ' + vr + '/' + (totRow));
				dspRow.update({v:'- ' + parseInt(vr) + '/' + (totRow)});
            }
			if(vsi < 1) {
				rowNav.hide();
				//dspRow.setHtml(rvw_resources.R033);
				dspRow.update({v:rvw_resources.R033});
			}
			dspRow.resumeLayouts();
			if(rowNav.isHidden())
				rowNav.show();
        }
        return false;
    },
    onCellKeyDown: function(view, td, cellIndex, record, tr, rowIndex, e, eOpts) {
		return;
       /*  var me = this,
            view = me.getView(),
            nav = me.getNavigationModel(),
            pos = nav ? nav.getPosition() : null,
            visibleRows = me.getVisibleRows(),
            vsi = (e.keyCode == 33) ? me.store.vsi : me.cr,
            tr = me.tr,
            keyCode = e.keyCode,
            store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            si,
            ei,
            len = 0,
            val,
            vm,
            column,
            hasBreak = false,
            normalGrid = me.normalGrid.getView(),
            lockingPartner = normalGrid.lockingPartner && normalGrid.lockingPartner.grid.isVisible() ? normalGrid.lockingPartner : null,
            columns = me.getVisibleColumnManager().getColumns();
        if (keyCode == 113) {
			if (td) {
				var cellIdx = td.getAttribute('data-columnid');
				val = record.get(cellIdx);
				if (!val) {
					vm = me.getVisibleColumnManager();
					if (me.getShowSelection())
						len++;
					if (me.getShowRowNumber())
						len++;
					column = vm.getHeaderAtIndex(cellIndex + len);
					if (column && column.editor)
						return;
					val = record.get(column.dataIndex);
				}
			}
			
            ellipse = Ext.create('Ext.ramco.Ellipse', {
                scrollable: false,
                hidden: true,
                modal: true
            });
            if (RamcoRTC.settings.ellipseSize) {
				var userWinWidth = parseInt(RamcoRTC.settings.ellipseSize.width, 10),
					userWinHeight = parseInt(RamcoRTC.settings.ellipseSize.height, 10);
                if (userWinWidth > 0) {
					ellipse.maxWidth = (userWinWidth > 500) ? userWinWidth : 500;
                    ellipse.setWidth(userWinWidth);
                    ellipse.ellipseText.setWidth(userWinWidth - 20);
                }
                if (userWinHeight > 0) {
                    ellipse.setHeight(userWinHeight);
                    ellipse.ellipseText.setHeight(userWinHeight >= 110 ? userWinHeight - 50 : 60);
                }
            }
			if (ellipse) {
				if (!me.readOnly && me.xtype != 'ramcolabel' && me.xtype != 'label')
					ellipse.ellipseText.setReadOnly(false);
                var gridObj = me.ownerCt.grid,
					selPos;
                if (gridObj) {
                    selPos = gridObj.getSelectionModel().getCurrentPosition();
                    if (selPos && selPos.columnHeader)
                        ellipse.title = selPos.columnHeader.text;
					ellipse.ellipseText.setReadOnly(true);
                    ellipse.showBy(Ext.fly(me.ownerCt.context.cell));
                } else {
					var ilbo = me.up('ilbo'),
						ilboHeight = ilbo.getSize().height,						
						tdObj = Ext.fly(td),
						tdObjY = tdObj.getXY()[1];
						
					selPos = me.getSelectionModel().getCurrentPosition();
                     if (selPos && selPos.columnHeader) {
						 if (selPos.columnHeader.xtype == 'ramcogridcheck')
							 return;
                        ellipse.title = selPos.columnHeader.text;
						ellipse.ellipseText.setReadOnly(true);
						if (ilboHeight - tdObjY > userWinHeight)
							ellipse.showBy(td, 'tl-bl');
						else {
							ellipse.show();
							ellipse.center();
						}
					}
					else {
						var cellObj = me.getColumnById(cellIdx);
						if (!Ext.isEmpty(cellObj) && cellObj.xtype == 'ramcogridcheck')
							return;
                }
                }
				* ellipse.body.setHeight(ellipse.body.getHeight() + 20);
				ellipse.setHeight((ellipse.getHeight() < 120) ? ellipse.getHeight() + 20 : 120);
				ellipse.setWidth(ellipse.getWidth() + 20); *
				ellipse.ascCtrl = me;
            	ellipse.ellipseText.setValue(val);				
				ellipse.ellipseText.focus(true);
            }
            return true;
        }
        if (vsi + 1 >= tr || vsi - 1 <= 0)
            return;
        // TECH-32997
		* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } *
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (pos) {
            me.col = pos.colIdx;
        }
        if (keyCode && keyCode > 32 && keyCode < 41) {
            switch (keyCode) {
                case 33: //"PAGE_UP",
                    vsi = vsi - visibleRows;
                    if (vsi <= 0)
                        vsi = 1;
                    break;
                case 34: //"PAGE_DOWN",
                    vsi = vsi + visibleRows;
                    if (vsi > tr)
                        vsi = tr;
                    break;
                case 35: //"END",
                    if (e.ctrlKey) {
                        vsi = tr;
                        me.col = columns[columns.length - 1];
                    } else
                        hasBreak = true;
                    break;
                case 36: //"HOME",
                    if (e.ctrlKey) {
                        vsi = 1;
                        if (lockingPartner)
                            columns = lockingPartner.getVisibleColumnManager().getColumns();
                        me.col = columns[0];
                    } else
                        hasBreak = true;
                    break;
                case 37: //"LEFT",
                    if (pos && pos.isFirstColumn && pos.isFirstColumn()) {
                        if (lockingPartner)
                            columns = lockingPartner.getVisibleColumnManager().getColumns();
                        me.col = columns[columns.length - 1];
                    } else
                        hasBreak = true;
                    vsi = vsi - 1;
                    break;
                case 38: //"UP",
                    vsi = vsi - 1;
                    break;
                case 39: //"RIGHT",
                    if (pos && pos.isLastColumn && pos.isLastColumn())
                        me.col = 0;
                    else
                        hasBreak = true;
                    vsi = vsi + 1;
                    break;
                case 40: //"DOWN"
                    vsi = vsi + 1;
                    break;
            }
            if (hasBreak)
                return
            start = vsi > visibleRows ? vsi - visibleRows : 1;
            end = (visibleRows * 3) + (start - 1);
            if (!(vsi >= si && vsi <= ei)) {
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.lastEvent = 'onnext';
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            }
        } */
    },
    createDummyRecord: function() {
        var me = this,
            values = {},
			store = me.store,
			lstRc = null,
			gridName = me.itemId.replace("-expanded", '');
		newRowNum = parseInt((store.totalCount + 1), 10);
		len = store.model.fields ? store.model.fields.length : 0;
		for (i = 0; i < len; i++) {				
			values[store.model.fields[i].name] = null;
		}
		values['rn'] = newRowNum;
		values['isNew'] = true;
		values['id'] = gridName + "_" + newRowNum;		
		lstRc = store.insert(newRowNum, values);	
		//TECH-30629	
		//lstRc.save();
		//store.sync();
	},
    onPrevClick:function(){
		var me =this,
			sel = me.getSelectionModel(),
			visibleRows = me.getVisibleRows(),
			cr = sel.selection.rowIdx,
			tr = me.tr,
			store = me.store,
			lastRow = store.count(),
			lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
			start,			
			si,
            ei,
			fField;
		if (cr >= tr)
            return;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		cr = cr - 1;
		start = cr > visibleRows ? cr - visibleRows : 1;
		end = (visibleRows * 3) + (start - 1);
		if (cr < 0) {
			me.store.start = start;
			me.store.end = end;
			me.store.vsi = cr;
			me.store.changed = true;
			me.lastEvent = 'onprev';
			me.fireEvent('movetorow', me, start, end, me.store.vsi);
		} 
		else {
			sel.select({
				row: cr,
				column: 0
			});
		}
		if(me.formItems && me.formItems.items.length > 0) {
			fField = me.formItems.items.getAt(0);
			if (fField) {
				fField.focus(10);
			}
		}
	},
	onNextClick:function(){
		var me = this,
			sel = me.getSelectionModel(),
			visibleRows = me.getVisibleRows(),
			cr = sel.selection.rowIdx,
			tr = me.tr,
			store = me.store,
			lastRow = store.count(),
			lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
			start,
			si,
            ei,
			fField;
		if (cr >= tr)
            return;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		cr = cr + 1;
		start = cr > visibleRows ? cr - visibleRows : 1;
		end = (visibleRows * 3) + (start - 1);
		if(cr < tr) {
			if (!(cr >= si && cr <= ei)) {
				me.store.start = start;
				me.store.end = end;
				me.store.vsi = cr;
				me.store.changed = true;
				me.lastEvent = 'onnext';
				me.fireEvent('movetorow', me, start, end, me.store.vsi);
			}
			else {
				sel.select({
					row: cr,
					column: 0
				});
			}
		}
		if(me.formItems && me.formItems.items.length > 0) {
			fField = me.formItems.items.getAt(0);
			if (fField) {
				fField.focus(10);
			}
		}
	},    
	onRowNumSet: function(field, evt, eOpts) {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
			num = parseInt(field.getValue()) || 0,
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = num ? store.getAt(num - 1) : store.getAt(0),
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            row,
            si,
            ei,
            offset,
            vsi = num;
		if(evt.keyCode == evt.ENTER) {
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
			//if (vsi < tr) {
			if (rowNav.getValue() < tr) {			
            store.vsi = vsi;
            if (store.vsi > tr)
                store.vsi = tr;
            start = vsi;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onnext';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.cr = (start - vr);
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
            }
        }
		}
    },
	onBtnFirst: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            row,
            si,
            ei,
            offset,
            vsi = store.vsi;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi != 1 && tr > 0) {
            store.vsi = vsi = 1;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onfirst';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
				store.changed = true;
            }
        }
    },
    onBtnPrev: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            record = null,
            index = null,
            row,
            si,
            ei,
            offset,
            vsi = store.vsi;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		vsi = rowNav.getValue();
        if (vsi != 1 && tr > 0) {
            vsi = vsi - vr;
            store.vsi = vsi;
            if (store.vsi <= 0)
                store.vsi = vsi = 1;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onprev';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.si = si;
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
				store.changed = true;
            }
        }
    },
    onBtnNext: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            row,
            si,
            ei,
            offset,
            vsi = store.vsi;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        vsi = rowNav.getValue() + vr;
        if (vsi - 1 < tr) {
            store.vsi = vsi;
            if (store.vsi > tr)
                store.vsi = tr;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onnext';
            if (!(vsi >= si && (vsi + vr - 1) <= ei)) {
                me.store.si = si;
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
				store.changed = true;
            }
        }
    },
    onBtnLast: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            row,
            si,
            ei,
            offset,
            vsi = store.vsi;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        vsi = tr - vr + 1;
        //TECH-32075
		//if (vsi != 1 && tr > 0) {
		if (vsi > 0 && vsi != 1 && tr > 0) {		
            store.vsi = vsi;
            if (store.vsi <= 0)
                store.vsi = 1;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onlast';
            if (!(vsi >= si && vsi <= ei) || ei != tr) {
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
				store.changed = true;
            }
        }
    },
    onBtnUp: function() {
        var me = this,
            scrollbar = me.getDockedComponent('gridScroller'),
            gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null;
        if (gridSlider) {
			gridSlider.sliderNav = 'up';
			me.onBtnPrev();            
        }
    },
    onBtnDown: function() {
        var me = this,
            scrollbar = me.getDockedComponent('gridScroller'),
			gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null;
        if (gridSlider) {
			 gridSlider.sliderNav = 'down';
			 me.onBtnNext();            
        }
    },
    onInboxBtnPrev: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,            
            si,
            ei,
            vsi = store.vsi;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi != 0 && tr > 0) {
            //vsi = vsi - vr;
            store.vsi = vsi;
            if (store.vsi <= 0)
                store.vsi = vsi = 1;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onprev';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.si = si;
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
            }
        }
    },
	onInboxBtnNext: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            si, ei, 
			vsi = store.vsi;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        //vsi = vsi + vr;        
        if (vsi - 1 < tr) {
            store.vsi = vsi;
            if (store.vsi > tr)
                store.vsi = tr;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onnext';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.si = si;
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
            }
        }
    },    	
	onInsert: function(btn, e, obj) {        
		var me = this,
			currPage = me.store.currentPage,
			totPage = Math.ceil((this.store.totalCount / this.store.pageSize));		
		if (currPage ==	totPage) {
			this.createDummyRecord();
		}
		else {
			this.lastEvent = "stinsert";
			this.store.loadPage(Math.ceil((this.store.totalCount / this.store.pageSize)));			
		}
    },
    onDelete: function(btn, e, obj) {        
		var selection = this.store.queryRecords('sel', true);
		if (selection) {
			this.store.remove(selection);
		}
		this.store.sync();
		this.store.reload();
    },
	deleteAll: function() {
        var me = this,
            callBack = me.selectAllCallback.bind(me);
        me.fireEvent('selectall', me, null, true, callBack);
    },    
    onCopyAppendRow: function(grid, isZoom) {
        var selection = this.store.queryRecords('sel', true);
		this.store.proxy.lastAction = "copyappend";
		this.store.sync();
		//this.store.reload();
    },
	onCutAppendRow: function(grid, isZoom) {
        var selection = this.store.queryRecords('sel', true);
		this.store.proxy.lastAction = "cutappend";
		this.store.sync();
		//this.store.reload();
    },    
    onColumnDefault: function(btn, e, obj) {
		var me = this;
        me.parentMl.onColumnDefault()
    },
    onColumnClearDefault: function(btn, e, obj) {
		var me = this;
        me.parentMl.onColumnClearDefault();
    },
	onColumnFilter: function(btn, e, obj) {
		var me = this;
        me.parentMl.onColumnFilter();
    },	
    onColumnClearFilter: function(btn, e, obj) {
		var me = this;
        me.parentMl.onColumnClearFilter();
    },    
    onshowPDF: function(btn, e, obj) {
        var me = this;
		me.parentMl.onshowPDF();
    },
    onshowCSV: function(btn, e, obj) {
        var me = this;		
		me.parentMl.onshowCSV();
    },
    onshowExcel: function(btn, e, obj) {
		var me = this;
		me.parentMl.onshowExcel();
    },
    onViewall: function(btn, e, obj) {
		var me = this;
		me.parentMl.onViewall();        
    },
	onBtnExpReport: function() {
		var me = this;			
		me.parentMl.onBtnExpReport();
    },
    onBtnExpChart: function() {
		var me = this;        
		me.parentMl.onBtnExpChart();
    },
	onImportExcel: function() {		
		var me = this;
		me.parentMl.onImportExcel();
    },
	onBtnValidateClick: function(btn, eOpts) {
		var me = this,
            fields = null,
            formData = new FormData(),
            impWindow = me.importWindow;
        fields = impWindow.form.getForm().getFields();
		if(fields && fields.items && fields.items.length > 0) {
			var len = fields.items.length,
				i = 0,
				element = null;
			for(; i < len; i++) {
				element = fields.items[i];
				element.clearOnSubmit = false;
				formData.append(element.getItemId(), element.getValue());
				// TECH-30180
				//if (typeof element.extractFileInput == 'function') {
				// TECH-32997 / LBC-445
				if (element.button && element.button.fileInputEl) {
					//element.clearOnSubmit = true;
					// Import Format - Settings based
					//var fileInput = element.extractFileInput(),
					var fileInput = element.button.fileInputEl.dom,
						j = 0, fileName, fileExtension, fileObj, errorText, acceptFormat = (!Ext.isEmpty(RamcoRTC.settings.importAcceptFormats)) ? RamcoRTC.settings.importAcceptFormats : ["csv", "txt", "xlsm"];
					if (fileInput) {
						for (; j < fileInput.files.length; j++) {
							//formData.append('file', fileInput.files[j]);
							fileObj = fileInput.files[j];
							if (fileObj) {
								fileName = (fileObj.name) ? fileObj.name.split('.') : null;
								if (fileName) {
									fileExtension = fileName[fileName.length - 1];				
									if (fileExtension && acceptFormat.indexOf(fileExtension) < 0) {
										errorText = Ext.String.format('Invalid file to import. Allowed file types are: "<b>{0}</b>"', acceptFormat);
										Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
										return false;
									}
								}
								formData.append('file', fileInput.files[j]);
							}
						}
					}
				}
			}
		}
		//);
        me.fireEvent('validatefile', me, formData);
		btn.setDisabled(true);
	},
    onBtnImportClick: function() {
        var me = this,
            fields = null,
            formData = new FormData(),
            impWindow = me.importWindow;
        fields = impWindow.form.getForm().getFields();
		if(fields && fields.items && fields.items.length > 0) {
			var len = fields.items.length,
					  i = 0,
					  element = null;
			for(; i < len; i++) {
				element = fields.items[i];
				//fields.items.forEach(function(element, index, array) {
            formData.append(element.getItemId(), element.getValue());
			// TECH-30180
            //if (typeof element.extractFileInput == 'function') {
			// TECH-32997 / LBC-445
			if (element.button && element.button.fileInputEl) {
				element.clearOnSubmit = true;
				// Import Format - Settings based
                //var fileInput = element.extractFileInput(),
				var fileInput = element.button.fileInputEl.dom,
					j = 0, fileName, fileExtension, fileObj, errorText, acceptFormat = (!Ext.isEmpty(RamcoRTC.settings.importAcceptFormats)) ? RamcoRTC.settings.importAcceptFormats : ["csv", "txt", "xlsm"];
                if (fileInput) {
                    for (; j < fileInput.files.length; j++) {
							//formData.append('file', fileInput.files[j]);
							fileObj = fileInput.files[j];
							if (fileObj) {
								fileName = (fileObj.name) ? fileObj.name.split('.') : null;
								if (fileName) {
									fileExtension = fileName[fileName.length - 1];				
									if (fileExtension && acceptFormat.indexOf(fileExtension) < 0) {
										errorText = Ext.String.format('Invalid file to import. Allowed file types are: "<b>{0}</b>"', acceptFormat);
										Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
										return false;
									}
								}
								formData.append('file', fileInput.files[j]);
							}
						}
					}
				}
			}
		}
		//);
		if (impWindow && impWindow.file && (impWindow.file.indexOf(".csv") > -1 || impWindow.file.indexOf(".txt") > -1))		
			me.fireEvent('importcsv', me, formData);
		else
			me.fireEvent('importexcel', me, formData);
    },
    getGridExportData: function(type, id, act, ilbo) {
        var me = this,
			parGrid = me.parentMl,
			colMandatory = "true"; // AHBG-27164

		if (parGrid) {
			var columns = parGrid.getColumns(),
				column, columnValue, xmlData, width,
				data = parGrid.getValue(), encodedText;
				data.columnsValue = parGrid.rsColumnsValue;		
			if (type == 'pdf') {
				//xmlData = '<gd ac="' + act + '" ic="' + ilbo + '" tc="">';
				//xmlData += '<c n="' + id + '" c="" ct="RSGrid" sl="true" st="0" ><vi>';
				xw = new XMLWriter('UTF-8');
				xw.writeStartDocument();
				xw.writeStartElement('gd');
					xw.writeAttributeString("ac", act);
					xw.writeAttributeString("ic", ilbo);
					xw.writeAttributeString("tc", "");
				xw.writeStartElement('c');
					xw.writeAttributeString("n", id);
					xw.writeAttributeString("c", "");
					xw.writeAttributeString("ct", "RSGrid");
					xw.writeAttributeString("sl", "true");
					xw.writeAttributeString("st",  "0");					
				xw.writeStartElement('vi');
				for (key in columns) {
					column = columns[key];
					width = (column.width > column.minWidth) ? column.width : column.minWidth;
					columnValue = data.columnsValue[column.dataIndex];
					if (column.xtype == "ramcotemplatecolumn" || column.xtype == "fileattachcolumn" || column.xtype == "attachcolumn" || column.xtype == "deletecolumn" || column.xtype == "imagecolumn" || column.hidden == true)
						continue;
					if (column && columnValue) {
						encodedText = Ext.htmlEncode(column.text) || column.text;
						//xmlData += '<vw n="' + column.name + '" vt="' + columnValue.vt + '" ht="' + encodedText + '" dt="' + columnValue.dt + '" ml="' + column.maxLength + '" dl="" w="' + width + '"/>'
						xw.writeStartElement('vw');
							xw.writeAttributeString("n", column.name);
							xw.writeAttributeString("vt", columnValue.vt);
							xw.writeAttributeString("ht", encodedText);
							xw.writeAttributeString("dt", columnValue.dt);
							xw.writeAttributeString("ml",  column.maxLength);
							xw.writeAttributeString("dl", (columnValue.dt == "numeric")?column.format:"");//TECH-29515
							xw.writeAttributeString("w", width);							
						xw.writeEndElement();
					}
				}
				//xmlData += '</vi></c></gd>';
				xw.writeEndElement();
				xw.writeEndElement();
				xw.writeEndElement();
				xmlData = xw.flush();
				xw.close();
			} 
			else {
				//xmlData = '<trqi><vi df="'+ parGrid.deleteFlag +'">';
				xw = new XMLWriter('UTF-8');
				xw.writeStartDocument();
				xw.writeStartElement('trqi');
				xw.writeStartElement('vi');
					xw.writeAttributeString("df", parGrid.deleteFlag);
				for (key in columns) {
					column = columns[key];
					width = (column.width > column.minWidth) ? column.width : column.minWidth;
					columnValue = data.columnsValue[column.dataIndex];
					if (column.xtype == "ramcotemplatecolumn" || column.xtype == "fileattachcolumn" || column.xtype == "attachcolumn" || column.xtype == "deletecolumn" || column.xtype == "imagecolumn" || column.hidden == true)
						continue;
					if (column && columnValue) {
						encodedText = Ext.htmlEncode(column.text) || column.text;
						//xmlData += '<vw n="' + column.name + '" vt="' + columnValue.vt + '" c="' + encodedText + '" dt="' + columnValue.dt + '" ml="' + column.maxLength + '" dl="" w="' + width + '" h="auto" m="true"/>'
						xw.writeStartElement('vw');
							xw.writeAttributeString("n", column.name);
							xw.writeAttributeString("vt", columnValue.vt);
							xw.writeAttributeString("c", encodedText);
							xw.writeAttributeString("dt", columnValue.dt);
							xw.writeAttributeString("ml",  column.maxLength);
							xw.writeAttributeString("dl", (columnValue.dt == "numeric")?column.format:"");//TECH-29515
							xw.writeAttributeString("w", width);
							xw.writeAttributeString("h", "auto");
							// AHBG-27164
							// xw.writeAttributeString("m", "true");
							colMandatory = (column.mandatory?"true":"false");
							xw.writeAttributeString("m", colMandatory);
							
							/* TECH-32817 / TECH-32371 - List Edit & Sync View - Export Excel Handling */
							var editor = column.editor,
								lvsArray = editor && editor.columns,
								lvsVal = [];
							// TECH-40133
							if (column.customListEdit != true && editor && editor.xtype == 'ramcolistedit') {
								for (var m = 0; m < lvsArray.length; m++) {
									lvsVal.push(lvsArray[m].itemId);
								}
								xw.writeAttributeString("lvs", lvsVal.join(';'));
								xw.writeAttributeString("sc", editor.searchView);
								xw.writeAttributeString("sd", editor.mappedView.join(';'));
								xw.writeAttributeString("dc", editor.mapCtrl.join(';'));
							}
						xw.writeEndElement();							
					}
				}
				//xmlData += '</vi></trqi>';
				xw.writeEndElement();
				xw.writeEndElement();
				xmlData = xw.flush();
				xw.close();			
			}
		}
        return xmlData;		
    },
    onSavePers: function() {
        var me = this,
            data = me.getPersonalization(),
            column;
        for (key in data) {
            if (key.indexOf('v') == 0) {
                if (data[key].pa == true) {
                    column = me.getColumnById(key);
                    // TECH-37120 / LSBE-27
                    //data[key].wi = column.piWidth - column.cellWidth;
					// TECH-38215
					if (!column.oldWidth)
						column.oldWidth = column.cellWidth;
                    data[key].wi = Math.ceil(column.piWidth - column.cellWidth);
                    column.cellWidth = column.piWidth;
                }
            }
        }
        me.fireEvent('savepers', me, data);
        for (key in data) {
            if (key.indexOf('v') == 0) {
                data[key].pa = false;
            }
        }
        me.setPersonalization(data);
    },
    onRemovePers: function() {
        this.fireEvent('removepers', this);
    },
    onColumnChoose: function() {
        this.fireEvent('colchoose', this);
    },
	onMultiSort: function() {
        if (this.taskPending)
            return;
        var me = this,
            gridId = me.getItemId(),
			cols = me.getColumns(),
			colArray = [],
			sortColArray = [],
			gridCtrlViews, data;
			
		for (var j = 0; j < cols.length; j++) {
			if (cols[j].dataIndex != 'rn' && cols[j].dataIndex != 'sel' && !cols[j].hidden) {
				colArray.push({'view': cols[j].dataIndex,'colname' : cols[j].text, 'asc' : '0', 'desc' : '1'});
			}
		}
		
		if (RamcoRTC.lastFocusCtrl && RamcoRTC.lastFocusCtrl[1] == gridId && RamcoRTC.lastFocusCtrl[2]) {
			gridCtrlViews = RamcoRTC.lastFocusCtrl[2];
			for (var k = 0; k < gridCtrlViews.length; k++) {
				for (var m = 0; m < colArray.length; m++) {
					if ('v' + gridCtrlViews[k].view == colArray[m].view) {
						data = colArray.splice(m,1);
						sortColArray = sortColArray.concat(data);
						break;
					}
				}
			}
		}
		var gridCtrl = me;
		
		if (me.multiSortWindow) {
			me.multiSortWindow.setGridColumns(gridCtrl, colArray, sortColArray);
			/* me.multiSortWindow.destroy();
			me.multiSortWindow = null;
			delete me.multiSortWindow; */
		}
		else {
		
			// TECH-34273
			me.multiSortWindow = Ext.create('Ext.ramco.Multisort', {
				itemId: gridId + '_multisort',
				colGridColumns: colArray,
				gridObj: gridCtrl,
				sortGridColumns: sortColArray,			
				parentGridId: gridId
			});
			
			me.multiSortWindow.show();
		}
    },
	onClearMultiSort: function() {
        var me = this,
			gridId = me.getItemId(),
			data = me.multiSortData,
			view = me.up('ilbo'),
			controller = (view) ? view.getController() : null;
		if (controller && controller.taskPending == false && data) {
			for (var j = 0; j < data.length; j++)
				data[j].so = '-1';	
			view.fireEvent('multisort', view, 'tskstdsort', 'multisort', gridId, data);
			me.multiSortData = null;
			delete me.multiSortData;
			//RamcoRTC.lastFocusCtrl = null;
		}
    },  
    processViews: function(views, hcols) {
    	try {
			var me = this,
				len = 0,
				colWidth = 0,
				colArr = [], index = 0, j = 0, column,
				colObj, columns = me.getColumns(),
				colunmManager = me.getColumnManager();
				
			if (views) {
				len = views.length;
				for (; j < len; j++) {
					colObj = views[j];
					column = colunmManager.getHeaderByDataIndex(colObj.id);
					if (column) {
						if (!Ext.isEmpty(colObj.text))
							column.setText(colObj.text);
						if (!Ext.isEmpty(colObj.width)) {
							colWidth = column.getWidth() + parseInt(colObj.width)
							column.setWidth(colWidth);
							column.viewProcessed = true;
						}
					}
				}
			}
			else if (hcols) {
				len = hcols.length;
				for (; j < len; j++) {
					column = colunmManager.getHeaderByDataIndex(hcols[j]);
					if (column)
						column.hide();
				}
			}
		}
		catch(ex) {}
    },
    processOrder: function(views,values) {
        var me = this,
			len = 0,
            colArr = [],
            index = 0,
            i = 0,
            gridValue = values?values:me.getValue(),
            columnConfig = gridValue && gridValue.columnsValue ? gridValue.columnsValue:null,
            columns = me.initialConfig.columns,
            column, colCfg,
            colManager = me.getColumnManager(),
			colObj = [], objArr = [], viewColArray;
        if (colManager.getHeaderByDataIndex('rn')) {
            index = colManager.getHeaderIndex(colManager.getHeaderByDataIndex('rn'))
            colArr.push(columns[index]);
        }
        if (colManager.getHeaderByDataIndex('sel')) {
            index = colManager.getHeaderIndex(colManager.getHeaderByDataIndex('sel'))
            colArr.push(columns[index]);
        }
		len = columns.length;
		viewColArray = views.join(',');
		for (var j=0; j < len; j++) {
			if (columns[j].dataIndex != 'sel' && columns[j].dataIndex != 'rn' && viewColArray.indexOf(columns[j].dataIndex) < 0 && !columns[j].hidden)
				objArr.push(columns[j].dataIndex);
		}
		if (objArr.length > 0)
			views = views.concat(objArr);		
		viewColArray = views.join(',');
		len = views.length;
        for (; i < len; i++) {
			index = me.getAllColumnIndex(views[i]);
			column = columns[index];
			if (!column)
				continue;
			if ((column.dataIndex != 'sel' && column.dataIndex != 'rn') && viewColArray.indexOf(column.dataIndex) < 0) {
				if (!column.hidden) {
					colObj.push(column);
					continue;
				}
			}
			else {
				if(columnConfig){
					colCfg = columnConfig[column.itemId];
					if(colCfg) {
						column.locked = false;
						column.format = colCfg.ft;
						if (!Ext.isEmpty(colCfg.css))
							column.style = colCfg.css;
						if (!Ext.isEmpty(colCfg.scc))
							column.text = colCfg.scc;
					}
					colArr.push(column);
				}
			}
        }		
		if (colObj && colObj.length > 0)
			colArr = colArr.concat(colObj);
        me.setColumns(colArr);
    },
    processState: function(views) {
        var me = this,
            topbar = me.getDockedComponent('gridToolbar'),
            scrollbar = me.getDockedComponent('gridScroller'),
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            colunmManager = me.getColumnManager(),
            columns = colunmManager.getColumns(),
            showScrollBar = me.getShowScrollBar(),
            insertFlag = me.getInsertFlag(),
            newNoOfRows = me.getVisibleRows(),
            element1,
            gridView,
            column,
            oColumn,
            width = 0,
            colWidth = 0,
            forceFit = me.columnFit,
            nGridView,
			vP='',
            persData = [];
        view = me.getView();
        me.coldef = false;
        nGridView = view.normalGrid ? view.normalGrid.view : view;        
        var gridSearchData = [{
            vid: 'v0',
            name: rvw_resources.R007
        }];
        me.suspendEvents();
        for (element1 in views) {
            gridView = views[element1];
			vP = me.getAllColumnIndex(gridView.id);
			if (!persData[gridView.id]) {
                persData[gridView.id] = {
                    vid:gridView.id,
					p: vP,
                    wi: gridView.width,
                    pa: false,
                    ch:true
                };
            }
            column = colunmManager.getHeaderByDataIndex(gridView.id);
            if (gridView.coldefactive == "true")
                me.coldef = true;
            if (column) {
                if (gridView.text) {
                    column.setText(gridView.text);
                }
				// TECH-32964 - PFP-60
				if(column.initialConfig && column.initialConfig.hidden)
					column.isStateHidden = true;
                if (!Ext.isEmpty(gridView.visible)) {
                    // TECH-35534 / TECH-35642 / TECH-35619 / TECH-35651
                    if (gridView.visible == 'n' && column.isVisible()) {
                        column.hide();
                    }
                    if (gridView.visible == 'y' && column.isHidden()) {
                        column.show();
                    }
					//TECH-28696 / TECH-29031
					// TECH-32964 - PFP-60
					if (Ext.isEmpty(gridView.st) || gridView.st == '0' || gridView.st == '2') {
						if(gridView.visible == "y")
							column.isStateHidden = false;
						else
							column.isStateHidden = true;
                    }
                    //UPDATING GRID SEARCH COMBO - ON PERFORMING COLUMN CHOOSER OPTION //
                    if (!(column.dataIndex == 'rn' || column.dataIndex == 'sel') && column.hidden != true) {
                        gridSearchData.push({
                            vid: column.dataIndex,
                            name: column.text || ''
                        });
                    }
					if(me.formFields) {
						var fField = '';													
						fField = me.formItems.getComponent(column.dataName)								
						if(fField) {
							if (gridView.visible == 'n') {
								fField.hide();
							}
							else {
								fField.show();
							}
						}
					}
                }
				/*if (gridView.enable == 'y')
					column.enable();
				else if(gridView.enable == 'n')
					column.disable();*/
				if (gridView.enable == 'y')
					column.stateEnabled = true;
				else if(gridView.enable == 'n')
					column.stateEnabled = false;
                if (!Ext.isEmpty(gridView.width) && column.rendered) {
                    if (!column.oldWidth)
                        colWidth = column.oldWidth = column.getWidth();
                    else
                        colWidth = column.oldWidth;
                    gridView.width = parseInt(gridView.width);
                    if (!isNaN(gridView.width) && !column.viewProcessed) {
                        column.setWidth(colWidth + gridView.width);
                        column.hasPer = true;
                        column.cellWidth = (colWidth + gridView.width);
                    }
                }
                if (!Ext.isEmpty(gridView.choose)) {
                    if (gridView.choose == '0')
                        column.hide();
                    else
                        column.show();
                }
            }
        }
        me.resumeEvents();
        me.setPersonalization(persData);
        if (nGridView.rendered) {
            me.onViewResize(nGridView);
        }
        // UPDATING GRID SEARCH COMBO - ON PERFORMING COLUMN CHOOSER OPTION //
        if (gridSearchData.length > 1) {
            fieldList.getStore().setData(gridSearchData);
            fieldList.setValue('v0');
        }
        if (me.coldef) {
            me.dummyRec = views;
        }
        //me.setPersonalization(null);
    },
	fillSearchData: function() {
		var me = this;
	},
    doSearch: function(value, ctrl) {
        var me = this,
            searchCombo = null,
            searchBy = null,
            searchText = null,
            searchValue = null,
            store = me.getStore(),            
			totPage = 0,
			currPage = store.currentPage,
			pageSize = store.getPageSize(),
			startIndex = ((currPage - 1) * pageSize) + 1,
            record = null;
		store.proxy.lastAction = 'gridsearch';
        if (me.showToolbar) {
            me.searchCombo = searchCombo = me.down('#fieldList');
            if (searchCombo) {
                me.searchBy = searchBy = searchCombo.getValue() || 'v0';//TECH-29580
            }
            me.searchText = searchText = me.down('#fieldSearch');
            if (searchText) {
                me.searchValue = searchValue = searchText.getValue();//TECH-29580
            }
            if (!Ext.isEmpty(searchBy) && !Ext.isEmpty(searchValue)) {
                if (searchBy == "v0") {
                    var row = 0,
                        col = 0,
                        colName = undefined,
                        colValue = undefined,
                        isFound = false,
                        recordCount = store.getCount(),
                        lockedColumns = me.lockedGrid.getColumns(),
                        normalColumns = me.normalGrid.getColumns(),
                        columnsLen = lockedColumns.length + normalColumns.length,
                        column = null;
                    if (me.lastSearch && me.lastSearch.text != searchValue)
                        delete me.lastEvent;
                    if (Ext.isEmpty(me.searchIndex)) {
                        record = store.findRecord('rn', startIndex, 0);
                        if (record)
                            me.searchIndex = store.indexOf(record);
                        else
                            me.searchIndex = 0;
                        me.searchColIndex = 2;
                    }
                    row = me.searchIndex;
                    col = me.searchColIndex;
                    for (; row < recordCount; row++) {
                        if (col == columnsLen) {
                            col = 0;
                            row++;
                        }
                        record = store.getAt(row);
                        if (record) {
                            for (; col < columnsLen; col++) {
                                if (col < lockedColumns.length)
                                    column = lockedColumns[col];
                                else
                                    column = normalColumns[col - lockedColumns.length];
                                if (column.isHidden())
                                    continue;
                                me.searchColIndex = col + 1;
                                colName = column.dataIndex;
                                colValue = record.get(colName);
                                if(column.dataType == "date")//TECH-29580
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat)	
								else if(column.dataType == "date-time")
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat)
								else if(column.dataType == "time")
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat)	
								else
									colValue = me.getRawFormat(column.dataType, colValue);
                                if (me.compare(colValue, searchValue)) {
                                    isFound = true;
                                    break;
                                }
                            }
                        }
                        if (isFound) {
                            me.searchIndex = row;
                            break;
                        } else {
                            col = 2;
                        }
                    }
                    if (isFound) {
                        record = store.getAt(me.searchIndex);
                        me.scrollToRecord(me.searchIndex, record, colName, searchValue);
                        delete me.lastEvent;
                    } else if (!isFound && me.lastEvent == 'gridsearch') {
                        me.onNoSearchData(me);
                    } else {
                        record = store.getAt(store.getCount() - 1);
						currPage = store.currentPage,
						totPage = Math.ceil((this.store.totalCount / this.store.pageSize));		
                        if (totPage > currPage) {
                            store.changed = true;
							currPage++;
                            me.lastEvent = 'gridsearch';							
							/*operation = store.proxy.createOperation('read', {
								start : 25 * currPage,
								limit : 25
						    });
							store.proxy.doRequest(operation, me.fillSearchData, me);*/
							//store.loadPage(currPage);
							store.proxy.searchValue = searchValue;
							store.proxy.searchIndex = searchBy.replace('v', '');
							store.flushSearchLoad();
                            //me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, me.afterGridSearch.bind(me));
                        } else if (me.lastSearch) {
                            Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R256, function(btnId) {
                                if (btnId == "ok" || btnId == "yes") {
                                    me.lastEvent = 'gridsearch';
                                    me.searchIndex = 0;
                                    me.searchColIndex = 0;
                                    //me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, false);
                                    me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, me.afterGridSearch.bind(me));
                                }
                                me.lastSearch = null;
                                delete me.lastSearch;
                            });
                        } else
                            me.onNoSearchData(me);
                    }
                } else {
                    if (Ext.isEmpty(me.searchIndex)) {
                        var recs = store.findRecord('rn', startIndex, 0);//TECH-29907
                        if (recs)
                            me.searchIndex = store.indexOf(recs);
                        else
                            me.searchIndex = 0;
                    } else
                        me.searchIndex++;
					var colDataType = me.getColumnById(me.searchBy);
					//TECH-29580
					if(colDataType.dataType == "date" || colDataType.dataType == "date-time" || colDataType.dataType == "time" || colDataType.dataType == "hdate" || colDataType.dataType == "hdate-time" || colDataType.dataType == "htime"){
						var storeIdx =  store.findBy(function(rec,Id){
							var recData = rec.get(me.searchBy),
								recField = me.getColumnById(me.searchBy),
								colVal; //= Ext.util.Format.date(recData,RamcoRTC.userPreference.dateFormat);
							if(recField.dataType == "date")
								colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat);
							else if(recField.dataType == "date-time") 
								colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat);
							else if(recField.dataType == "time")
								colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat);
							else if(recField.dataType == "hdate")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							else if(recField.dataType == "hdate-time")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							else if(recField.dataType == "htime")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							if(colVal == me.searchValue)
								return true;
						},me,me.searchIndex);
					}
					if(storeIdx > 0){
						record = store.getAt(storeIdx);
					}
					if(Ext.isEmpty(record))
                    	record = store.findRecord(searchBy, searchValue, me.searchIndex, true);
                    if (record) {
                        me.searchIndex = store.indexOf(record);
                        me.scrollToRecord(me.searchIndex, record, searchBy, searchValue);
                    } else if (!record && me.lastEvent == 'gridsearch') {
                        me.onNoSearchData(me);
                    } else {
                        record = store.getAt(store.getCount() - 1);
                        me.searchIndex = 0;
                        if (store.tr > record.get('rn')) {
                            store.vsi = record.get('rn');
                            store.changed = true;
                            me.lastEvent = 'gridsearch';
                            me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue);
                        } else if (me.lastSearch) {
                            me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, false);
                            me.lastSearch = null;
                            delete me.lastSearch;
                        } else
                            me.onNoSearchData(me);
                    }
                }
            }
        }
        return true;
    },
    afterGridSearch: function() {
        var me = this;
        me.searchIndex = null;
        me.doSearch();
    },
    scrollToRecord: function(index, rec, searchBy, searchText) {
        var me = this,
            store = me.store;
        if (searchBy) {
            me.lastSearch = {
                text: searchText,
                row: index,
                col: searchBy
            };
            me.setSearched(index, searchBy, rec);
        }
    },
    scrollToRecPostion: function(record, animate, overscroll, columnX, lastEvent) {
        var me = this,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            rowHeight = me.rowHeight,
            topbar = me.getDockedComponent('gridToolbar'),
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowVal = rowNav.getValue(),
            vr = me.store.vr / 3,
            record = me.store.findRecord('rn', rowVal),
            index = me.store.indexOf(record),
            x = normalView ? normalView.getScrollY() : 0,
            row = normalView.getRow(record),
            sTop = row ? row.parentElement.parentElement.offsetTop : (x + height - rowHeight + 5);
        if (normalView) {
            switch (lastEvent) {
                case 'onfirst':
                    normalView.setScrollY(0);
                    break;
                case 'onprev':
                    normalView.setScrollY(sTop);
                    break;
                case 'onnext':
                    normalView.setScrollY(sTop);
                    break;
                case 'onlast':
                    normalView.setScrollY(x + height + rowHeight);
                    break;
                default:
                    if (me.store.vsi > 0)
                        normalView.setScrollY(sTop);
                    else
                        normalView.setScrollY(0);
            }
        }
    },
    setSearched: function(index, colName, rec) {
        var me = this,
            store = me.getStore(),
            nav = me.getNavigationModel(),
            selModel = me.getSelectionModel(),
            columns = me.getColumns(),
            srchCmb = me.down('#fieldSearch'),
            rowNo = rec.get('rn'),
            column = null,
            scroller = null,
            viewRegion = null,
            lockViewRegion = null,
            cellRegion = null,
            inRange = true,
            lockInRange = false,
            colIndex = 0;
        column = Ext.ComponentQuery.query('{dataIndex == "' + colName + '"}', columns);
        if (column && column.length > 0) {
            colIndex = me.getColumnIndex(colName);
            column = me.getColumnById(colName);
            if (nav) {
                nav.cell = me.getCell(colName.replace('v', ''), rowNo);
                if (nav.cell) {
                    nav.cell = new Ext.dom.Fly(nav.cell);
                    scroller = nav.view.getScrollable();
                    lockViewRegion = nav.view.lockingPartner.getViewRegion();
                    viewRegion = nav.view.getViewRegion();
                    //cellRegion = nav.cell.dom.getViewRegion();
					try {
						cellRegion = nav.cell.getViewRegion();
					}
					catch(ex) {
						cellRegion = nav.cell.dom.getViewRegion();
					}
                    lockInRange = lockViewRegion.contains(cellRegion);
                    if (!lockInRange)
                        inRange = viewRegion.contains(cellRegion);
                    if (!inRange) {
                        me.onBtnNext();
                    }
                    store.cr = rec.get('rn');
                    if (lockInRange) {
                        nav.position.setAll(nav.view.lockingPartner, index, colIndex, rec, column);
                        selModel = nav.view.lockingPartner.getSelectionModel();
                    } else
                        nav.position.setAll(nav.view, index, colIndex, rec, column);
                    lcelctxt = new Ext.grid.CellContext(nav.position.view);
                    var fcell = lcelctxt.setPosition(colIndex, rowNo);
                    fcell.record = nav.position.record;
                    fcell.rowIdx = nav.position.rowIdx;
                    fcell.column = column;
                    nav.focusPosition(nav.position);
                    // Maintain lastFocused in the view so that on non-specific focus of the View, we can focus the view's correct descendant. 
                    nav.view.lastFocused = nav.lastFocused = nav.position.clone();
                    // Use explicit scrolling rather than relying on the browser's focus behaviour. 
                    // Scroll on focus overscrolls. scrollIntoView scrolls exatly correctly. 
                    //
                    //if (scroller) {
                        //scroller.scrollIntoView(nav.cell.dom);
                    //}
					var topbar = me.getDockedComponent('gridToolbar'),
						rowNav;
					if (topbar) {
						rowNav = topbar.getComponent('rowNav');
						if (rowNav)
							rowNav.setValue(me.store.cr);
					}					
                    if (selModel) {
                        selModel.select(fcell);
                    }
                }
                Ext.defer(function() {
                    srchCmb.focus();
                }, 50);
            }
        }
    },
    compare: function(value, cValue) {
        var objType = typeof value;
        if (objType == "string") {
            return value.toLowerCase().indexOf(cValue.toLowerCase()) > -1;
        }
        return false;
    },
    getViewValue: function(viewName, row) {
        var me = this,
            record,
            data;
        record = me.store.findRecord('rn', row);
        if (record) {
            data = record.get('v' + viewName)
        }
        return data;
    },
    getCell: function(viewName, row) {
        var me = this,
            column = me.getColumnById('v' + viewName),
            view = me.getView(),
            record,
            td,
            cell;
        if (viewName == 'sel' || viewName == 'rn')
            return null;
        if (column) {
            if (column.locked) {
                view = view.lockedView;
            } else {
                view = view.normalView ? view.normalView : view;
            }
            record = me.store.findRecord('rn', row);
            if (view && record && column) {
                cell = view.getCell(record, column);
            }
        }
        return cell;
    },
    getColumnById: function(name) {
        var me = this,
            columns = me.getColumns(),
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        return column;
    },
    getColumnIndex: function(name) {
        var me = this,
            columns = me.getVisibleColumnManager().getColumns(),
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        //return (i - 2);
        return (i);
    },
	getAllColumnIndex: function(name) {
        var me = this,
            //columns = me.getColumns(),
            columns = me.initialConfig.columns,
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        //return (i - 2);
		return (i);
    },
    onNoSearchData: function(grid) {
        // TECH-40327
        //Ext.Msg.alert('', rvw_resources.R036, Ext.emptyFn, undefined, 'error');
		Ext.RamcoMsg.alert('', rvw_resources.R036, Ext.emptyFn, undefined, 'error');
        grid.searchIndex = 0;
        grid.searchColIndex = 0;
		var ilbo = this.up("ilbo");
		if(ilbo)
			ilbo.callBackStatusError = true;
    },
    // setValueOnData: function() {
        // var me = this;
        // if (me.lastValue && !Ext.isEmpty(me.lastValue.vr))
            // me.updateValue(me.lastValue);
        // else if (me.value)
            // me.updateValue(me.value);
        // if (me.isSort) {
            // me.isSort = false;
        // } else {
            // if (me.sortCol) {
                // me.sortCol.setSortState(null);
                // delete me.sortCol;
            // }
        // }        
    // },
    // onDataUpdate: function(store, record, operation, modField, details, eOpts) {
        // var me = this;
        // if (record.data.isNew == true && modField && modField[0] != 'sel') {
            // if (me.edited) {
                // record.data.isNew = false;
                // // DUMMY ROW CREATION FOR LAST ROW UPDATE //
                // if (me.tr < me.si + (me.visibleRows * 3) - 1)
                    // me.createDummyRecord();
				// else
					// me.updateRowNavigation(me.tr, 'last');
            // }
        // }
    // },
    // setStore: function(store) {
        // var me = this;
        // me.mon(store, {
            // //refresh: me.setValueOnData,
            // update: me.onDataUpdate,
            // scope: me
        // });
        // me.reconfigure(store);
        // me.setValueOnData();
        // if (me.autoLoad && !store.isEmptyStore && !(store.loading || store.isLoaded())) {
            // store.load();
        // }
    // },
    onResizeHeader: function(view, width, height, oldWidth, oldHeight, eOpts) {
        if (height != oldHeight) {
            var me = this,
                gridHeight = me.getHeight(),
                view = me.getView(),
                header = me.getShowHeader(),
                scrollbar = me.getDockedComponent('gridScroller'),
                headerSpace = scrollbar ? scrollbar.getComponent('headerSpace') : null,
                bottomSpace = scrollbar ? scrollbar.getComponent('bottomSpace') : null,
                nGridView = view.normalGrid ? view.normalView.el : view.el;
            if (header) {
                if (headerSpace) {
                    headerSpace.setStyle({
                        'lineHeight': (height) + 'px'
                    });
                    headerSpace.setHeight(height);
                }
                if (me.oldheaderHeight) {
                    gridHeight = gridHeight + height - me.oldheaderHeight;
                } else {
                    gridHeight = gridHeight + height;
                }
                me.oldheaderHeight = height;
            }
            if (nGridView.dom.scrollWidth > nGridView.dom.clientWidth) {
                bottomSpace.show();
                if (!me.hasScroll) {
                    gridHeight += Ext.getScrollbarSize().height;
                    me.hasScroll = true;
                }
            } else {
                bottomSpace.hide();
                if (me.hasScroll) {
                    gridHeight -= Ext.getScrollbarSize().height;
                    me.hasScroll = null;
                    delete me.hasScroll;
                }
            }
			me.suspendLayouts();
            me.setHeight(gridHeight);
			me.resumeLayouts();
        } else {
            return;
        }
    },
    onViewResize: function(view, width, height, oldWidth, oldHeight, eOpts) {
        var me = this,
            topbar = me.getDockedComponent('gridToolbar'),
            scrollbar = me.getDockedComponent('gridScroller'),
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            columns,
            totalCols,
            showScrollBar = me.getShowScrollBar(),
            insertFlag = me.getInsertFlag(),
            newNoOfRows = me.getVisibleRows(),
            autoHeight = me.getAutoHeight(),
            element1,
            gridView,
            column,
            oColumn,
            width = 0,
            colWidth = 0,
            forceFit = me.columnFit,
            nGridView,
			gridWidth = 0,
            box;
        //view = view ? view : me.getView();
        view = view ? view : me.normalGrid.getView();

		if (me.rendered === false)
			return;
		nGridView = view.normalGrid ? view.normalGrid.view : view;
		gridWidth = me.getWidth();
        //width = view.getWidth();		
		width = nGridView.getWidth();
        //columns = view.ownerCt.getVisibleColumns();
		columns = nGridView.ownerCt.getVisibleColumns();
        totalCols = 0;
		if(gridWidth == width) {
			if(scrollbar && scrollbar.isVisible()) {
				width = width - scrollbar.getWidth();
			}
		}
        if (fieldList && columns) {
            var colWidth = 0,
                hasForceFit = false,
                oWidth = 0;
			if (columns && columns.length > 0) {	
				var len = columns.length,
					i = 0,
					element = null;
				for(; i < len; i++) {
					element = columns[i];
					//columns.forEach(function(element, index, array) {
                if (!(element.dataIndex == 'rn' || element.dataIndex == 'sel')) {
                    if (element.hidden != true && element.rendered) {
                        if (element.hasPer) {
                            colWidth += element.getWidth();
                            //colWidth += element.width;
                        } else {
                            if (element.oldWidth)
                                colWidth += element.oldWidth;
                            else
                                colWidth += element.getWidth();
                        }
                        if (element.forceFit)
                            hasForceFit = true;
						else
							hasForceFit = false;
                        totalCols++;
                    }
                }
                if (element.hidden != true && element.editor) {
                    insertFlag = true;
                }
				}
			}
			//);
            if (width >= colWidth && colWidth > 0) {
                if (hasForceFit)
                    forceFit = true;
                var i = 0,
                    cWidth = (width - colWidth),
                    len = columns.length,
                    newWidth = 0,
                    col = 0,
                    aWidth = parseFloat((cWidth / colWidth), 10),
                    rWidth = cWidth - (aWidth * colWidth);
                for (; i < len; i++) {
                    column = columns[i];
                    if (column.rendered) {
                        me.suspendEvents();
						me.suspendLayouts();
                        col++;
                        if (forceFit) {
                            if (!column.oldWidth)
                                column.oldWidth = column.getWidth();
                            newWidth = parseInt(column.oldWidth * aWidth, 10);
                            rWidth += (column.oldWidth * aWidth) - newWidth;
                            if (col == totalCols)
                                newWidth += rWidth;
                            if (column.hasPer) {
                                column.setWidth(column.width + newWidth);
                            } else
                                column.setWidth(column.oldWidth + newWidth);
                        } else {
                            if (col == totalCols) {
								// TECH-38195 / TECH-38215
								// TECH-38611
                                if (!column.oldWidth)
                                    column.oldWidth = column.getWidth();								
                                if (column.hasPer) {
                                    column.setWidth(cWidth + column.width);
                                } else {
                                    column.setWidth(cWidth + column.oldWidth);
                                }
								//column.setWidth(cWidth + column.getWidth());
                            } else {
                                if (column.hasPer) {
                                    column.setWidth(column.width);
                                } else if (column.oldWidth) {
                                    column.setWidth(column.oldWidth);
                                } else {
                                    column.oldWidth = column.getWidth();
                                }
                            }
                        }
						me.resumeLayouts();
                        me.resumeEvents();
                    }
                }
            }
        }
		//if (hasForceFit && nGridView.rendered)
		if (nGridView.rendered)
			nGridView.updateLayout();
        if (view.rendered) {
            var gridHeight = me.getGridHeight(newNoOfRows);
            if (autoHeight && me.tr < newNoOfRows)
                gridHeight = me.getGridHeight(parseInt(me.tr));
            if (gridHeight > 0) {
                me.suspendLayouts();        
                me.setHeight(gridHeight);
				me.resumeLayouts();        
            }
        }
    },
    getRawFormat: function(type, value) {
        var ret = value;
        if (Ext.isEmpty(value))
            return value;
        switch (type) {
            case 'hdate':
                ret = Ext.util.Format.date(value, 'B-Q-R');
                break;
            case 'hdate-time':
                ret = Ext.util.Format.date(value, 'B-Q-R G:i:s');
                break;
            case 'htime':
                ret = Ext.util.Format.date(value, 'G:i:s');
                break;
            case 'date':
                ret = Ext.util.Format.date(value, 'Y-m-d');
                break;
            case 'date-time':
                ret = Ext.util.Format.date(value, 'Y-m-d G:i:s');
                break;
            case 'time':
                ret = Ext.util.Format.date(value, 'G:i:s');
                break;
            default:
        }
        return ret;
    },
	onExpandBody: function(rowNode , record , expandRow , eOpts) {
		var me = this,
			height = me.getHeight(),
			topRow = null,
			botRow = null,
			visbleRows = this.getVisibleRows();
		record.set('ex', '1');
		me.expanderCnt++;
		height = me.getGridHeight(visbleRows);		
	},
	onCollapsebody: function(rowNode , record , expandRow , eOpts) {
		var me =this;
		record.set('ex', '0')
		me.expanderCnt--;
		console.log(record.get('ex'));		
	},
	doMlAvnFileDownload: function() {
		var me = this,
			src = null,
            ilbo = me.up('ilbo'),
            itemId = me.getItemId(),            
            srcPath = '',
			eventName = null,
			view = null,
			fileName = '',
			row = me.store.cr,
            fileUrl = ilbo ? ilbo.avnFileDownloadUrl : '',
			args = me.processEvtargs;
			if (args) {
				view = args[5];
				fileName = args[2].get("v" + view);
				eventName = args[3];
			}
            src = Ext.String.format(fileUrl, itemId, view, row, true, fileName, srcPath, eventName, RamcoRTC.sessionToken);
        window.open(src, "Mywindow","height=350,left=200,menubar=no,location=no,resizable=no,scrollbars=no,status=yes,top = 50, width=500");
	},
    doDestroy: function() {
        var me = this,
            view = me.getView(),
            scrollbar = me.getDockedComponent('gridScroller'),
            showScrollBar = me.getShowScrollBar(),
            gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null,
            headerSpace = scrollbar ? scrollbar.getComponent('headerSpace') : null,
            bottomSpace = scrollbar ? scrollbar.getComponent('bottomSpace') : null,
            btnUp = scrollbar ? scrollbar.getComponent('btnUp') : null,
            btnDown = scrollbar ? scrollbar.getComponent('btnDown') : null,
            topbar = me.getDockedComponent('gridToolbar'),
            btnFirst = topbar ? topbar.getComponent('btnFirst') : null,
            btnPrev = topbar ? topbar.getComponent('btnPrev') : null,
            btnNext = topbar ? topbar.getComponent('btnNext') : null,
            btnLast = topbar ? topbar.getComponent('btnLast') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            deleteBtn = topbar ? topbar.getComponent('btnDelete') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
			groupingBtn = topbar ? topbar.getComponent('tBarGrpBtn') : null,
			btnSave = groupingBtn ? groupingBtn.menu.items.getByKey('savePers') : null,
            btnRemove = groupingBtn ? groupingBtn.menu.items.getByKey('removePers') : null,
            btnChoose = groupingBtn ? groupingBtn.menu.items.getByKey('columnChooser') : null,
			btnMultiSort = groupingBtn ? groupingBtn.menu.items.getByKey('multiSort') : null,
            btnClearMultiSort = groupingBtn ? groupingBtn.menu.items.getByKey('clearMultiSort') : null,
            lHeaderCt,
            nHeaderCt,
			impExcel,expExcel,expPdf,expHtml,menuImport,btnExport;
			
			if (RamcoRTC.settings.isExt2 == true) {
				impExcel = topbar ? topbar.getComponent('btnImpExcel') : null;
				expExcel = topbar ? topbar.getComponent('btnExpExcel') : null;
				expPdf = topbar ? topbar.getComponent('btnExpPdf') : null;
				expHtml = topbar ? topbar.getComponent('btnExpHtml') : null;
				btnSave = topbar ? topbar.getComponent('savePers') : null;
				btnRemove = topbar ? topbar.getComponent('removePers') : null;
				btnChoose = topbar ? topbar.getComponent('columnChooser') : null;
				btnMultiSort = topbar ? topbar.getComponent('multiSort') : null;
				btnClearMultiSort = topbar ? topbar.getComponent('clearMultiSort') : null;
			}
			else {
				menuImport = topbar ? topbar.getComponent('menuImport') : null;
				btnExport = topbar ? topbar.getComponent('btnExport') : null;				
				impExcel = menuImport ? menuImport.menu.items.getByKey('btnImpExcel') : null;
				expExcel = btnExport ? btnExport.menu.items.getByKey('btnExpExcel') : null;
				expPdf = btnExport ? btnExport.menu.items.getByKey('btnExpPdf') : null;
				expHtml = btnExport ? btnExport.menu.items.getByKey('btnExpHtml') : null;
			}
            
        if (gridSlider) {
            me.mun(gridSlider, {
                changecomplete: me.onGridSliderChange,
                scope: me
            });
        }
        if (btnFirst)
            me.mun(btnFirst, {
                click: me.onBtnFirst,
                scope: me
            });
        if (btnPrev)
            me.mun(btnPrev, {
                click: me.onBtnPrev,
                scope: me
            });
        if (btnNext)
            me.mun(btnNext, {
                click: me.onBtnNext,
                scope: me
            });
        if (btnLast)
            me.mun(btnLast, {
                click: me.onBtnLast,
                scope: me
            });

        if (btnUp)
            me.mun(btnUp, {
                click: me.onBtnUp,
                scope: me
            });
        if (btnDown)
            me.mun(btnDown, {
                click: me.onBtnDown,
                scope: me
            });

        // Toolbar event Handler
        if (insertBtn)
            me.mun(insertBtn, {
                click: me.onInsert,
                scope: me
            });
        if (deleteBtn)
            me.mun(deleteBtn, {
                click: me.onDelete,
                scope: me
            });
        if (btnCut)
            me.mun(btnCut, {
                click: me.onCutAppendRow,
                scope: me
            });
        if (btnCopy)
            me.mun(btnCopy, {
                click: me.onCopyAppendRow,
                scope: me
            });
		if (btnMultiSort) {
			me.mun(btnMultiSort, { click: me.onMultiSort, scope: me });
			if (me.multiSortWindow) {
				Ext.destroy(me.multiSortWindow);
                me.multiSortWindow = null;
                delete me.multiSortWindow;
			}
		}
		if (btnClearMultiSort) {
			me.mun(btnClearMultiSort, { click: me.onClearMultiSort, scope: me });
		}
        if (impExcel) {
            me.mun(impExcel, {
                click: me.onImportExcel,
                scope: me
            });
            if (me.importWindow && me.importWindow.BtnImport) {
                me.importWindow.BtnImport.un('click', me.onBtnImportClick, me);
                Ext.destroy(me.importWindow)
                me.importWindow = null;
                delete me.importWindow;
            }
        }
        if (expExcel)
            me.mun(expExcel, {
                click: me.onshowExcel,
                scope: me
            });
        if (expPdf)
            me.mun(expPdf, {
                click: me.onshowPDF,
                scope: me
            });
        if (expHtml)
            me.mun(expHtml, {
                click: me.onViewall,
                scope: me
            });
        if (btnSave)
            me.mun(btnSave, {
                click: me.onSavePers,
                scope: me
            });
        if (btnRemove)
            me.mun(btnRemove, {
                click: me.onRemovePers,
                scope: me
            });
        if (btnChoose)
            me.mun(btnChoose, {
                click: me.onColumnChoose,
                scope: me
            });		
        if (me.view) {
            me.mun(me.view, {
                scope: me,
                focuschange: me.updateGridSlider,
                cellkeydown: me.onCellKeyDown
            });
        }
        /*var store = me.getStore();
        if (store) {
            me.mun(store, {
                refresh: me.setValueOnData,
                update: me.onDataUpdate,
                scope: me
            });
        }*/
        me.callParent();
    }
});

// Grid Control
Ext.define('Ext.ramco.GridPanel', {
    extend: 'Ext.grid.Panel',
    alias: 'widget.ramcogrid',
    selModel: 'cellmodel',
    col: 0,
    enableLocking: true,
    bufferedRenderer: false, // TECH-35619 / TECH-35707
    lastValue: {},
	expanderCnt: 0,
	enableColumnHide: false, // TECH-40820
	formCollapseDir:'right',
	formCollapsible:false,
	formCollapse:false,
    config: {
        insertFlag: false,
        deleteFlag: false,
        showRowNumber: true,
        showSelection: true,
        showHeader: true,
        showToolbar: true,
        showScrollBar: false,
        showNoRows: true,
        showDefault: false,
		showFilter: false,
        cutFlag: true,
        copyFlag: true,
        exportExcelFlag: true,
		reportFlag:true,
		pdfFlag:true,
		htmlFlag:true,
        exportCsvFlag: true,
		importFlag :true,
		personalizeFlag :true,
        chartFlag: true,
        navigationOnly: false,
        personalization: {},
        reqBorder: true,
        visibleRows: 5,
        rowHeight: 18,
        value: null,
        stripeRows: true,
        forceFit: false,
        autoHeight: false,
        searchFlag: true,
		showRowExpander: false,		
		rowExpConfig:null,
		paginationBar: true
    },
    initComponent: function() {
        var me = this,
			mainClr = getMainController(),
			rowHeight = me.getRowHeight(),
			height = 0,
            newNoOfRows = me.getVisibleRows(),
            stripeRows = me.getStripeRows(),
            insertFlag = me.getInsertFlag(),
            deleteFlag = me.getDeleteFlag(),
            showRowNumber = me.getShowRowNumber(),
            showSelection = me.getShowSelection(),
            header = me.getShowHeader(),
            showToolbar = me.getShowToolbar(),
            showNoRows = me.getShowNoRows(),
            cutFlag = me.getCutFlag(),
            copyFlag = me.getCopyFlag(),
            exportExcelFlag = me.getExportExcelFlag(),
 			exportCsvFlag = me.getExportCsvFlag(),
            pdfFlag = me.getPdfFlag(),
			reportFlag = me.getReportFlag(),
			htmlFlag = me.getHtmlFlag(),
            exportCsvFlag = me.getExportCsvFlag(),
			importFlag = me.getImportFlag(),
			personalizeFlag = me.getPersonalizeFlag(),
            chartFlag = me.getChartFlag(),
            navigationOnly = me.getNavigationOnly(),
            showDefault = me.getShowDefault(),
			showFilter = me.getShowFilter(),
            reqBorder = me.getReqBorder(),
            forceFit = me.getForceFit(),
			modifiedFlag = false,
            searchFlag = me.getSearchFlag(),
			showRowExpander = me.getShowRowExpander(),
			lastTskType = mainClr.getLastTaskType(),
			grdToolbarItems = null;			
		if(RamcoRTC.settings.isExt2 == true){
			grdToolbarItems = [{
						itemId: 'btnFirst',
						xtype: 'button',
						iconCls: 'x-fa fa-backward',
						tooltip: rvw_resources.R140
					}, {
						itemId: 'btnPrev',
						xtype: 'button',
						iconCls: 'x-fa fa-caret-left',
						tooltip: rvw_resources.R141
					}, {
						itemId: 'rowNav',
						xtype: 'numberfield',
						style: {
							'top': 1,
						},
						visibleLength: 3,
						minValue: 1,
						maxValue: 1,
						width: 30,
						hidden: true
					}, {
						itemId: 'dspRow',
						xtype: 'component',
						tpl: '{v}'
					}, {
						itemId: 'btnNext',
						xtype: 'button',
						iconCls: 'x-fa fa-caret-right',
						tooltip: rvw_resources.R143
					}, {
						itemId: 'btnLast',
						xtype: 'button',
						iconCls: 'x-fa fa-forward',
						tooltip: rvw_resources.R144
					}, 
					'-',
					{
						xtype: 'ramcolabel',
						itemId: 'gridSelRow',
						hidden: !RamcoRTC.settings.ShowSelectedRows || lastTskType != 'help'
					}, {
						itemId: 'btnInsert',
						xtype: 'button',
						hidden: navigationOnly || !insertFlag || !showToolbar,
						iconCls: 'x-fa fa-plus',
						tooltip: rvw_resources.R145
					}, {
						itemId: 'btnDelete',
						xtype: 'button',
						hidden: navigationOnly || !deleteFlag,
						iconCls: 'x-fa fa-minus',
						tooltip: rvw_resources.R146
					}, {
						itemId: 'btnCopy',
						xtype: 'button',
						hidden: navigationOnly || !copyFlag,
						iconCls: 'tech-copy',
						tooltip: rvw_resources.R148
					}, {
						itemId: 'btnCut',
						xtype: 'button',
						hidden: navigationOnly || !cutFlag,
						iconCls: 'x-fa fa-cut',
						tooltip: rvw_resources.R147
					},{
						itemId: 'btnColumnDefault',
						xtype: 'button',
						hidden: !showDefault,
						iconCls: 'x-fa fa-cog',
						tooltip: rvw_resources.R245
					}, {
						itemId: 'btnClearDefault',
						xtype: 'button',
						hidden: !showDefault,
						iconCls: 'tech-ClearDefault_ic',
						tooltip: rvw_resources.R246,
						cls:'x-clr-default'					
					}, {
						itemId: 'btnColumnFilter',
						xtype: 'button',
						hidden: !RamcoRTC.settings.enableColumnFilter,
						iconCls: 'tech-Filter_ic',
						tooltip: rvw_resources.R291,
						cls:'x-clm-filter'
					}, {
						itemId: 'btnClearFilter',
						xtype: 'button',
						hidden: !RamcoRTC.settings.enableColumnFilter,
						iconCls: 'tech-ClearFilter_ic',
						tooltip: rvw_resources.R292,
						cls:'x-clm-clrfilter'
					}, 
					'-',
					'->',
					'-',
					{					
						itemId: 'btnExpPdf',
						hidden: !pdfFlag,
						tooltip: rvw_resources.R153,
						iconCls: 'tech-adobe'
					}, 
					{					
						itemId: 'btnExpReport',
						hidden: !reportFlag,
						tooltip: rvw_resources.R156,					
						iconCls: 'tech-charts'
					}, 
					{					
						itemId: 'btnExpHtml',
						hidden: !htmlFlag,
						tooltip: rvw_resources.R154,
						iconCls: 'tech-html'
					}, 						
					{					
						itemId: 'btnExpExcel',
						hidden: !exportExcelFlag,
						tooltip: rvw_resources.R151,
						iconCls: 'x-fa fa-file-excel-o'
					},
					{					
						itemId: 'btnExpCsv',
						hidden: !exportCsvFlag,
						tooltip: rvw_resources.R155,
						iconCls: 'tech-csv'
					},
					{					
						itemId: 'btnExpOffice',
						hidden: true,
						tooltip: rvw_resources.R152,
						iconCls: 'x-fa fa-file-excel-o'
					}, 
					{					
						itemId: 'btnImpExcel',
						tooltip: rvw_resources.R149,
						iconCls: 'tech-import_data'
					},
					{					
						hidden: true,
						tooltip: rvw_resources.R150,
						itemId: 'btnImpOffice',
						iconCls: 'tech-import_data'
					},
					{					
						itemId: 'btnExpChart',
						hidden: !chartFlag,
						tooltip: rvw_resources.R027,
						iconCls: 'tech-chart'
					},	
					'-',					
					{
						itemId: 'btnMlExpand',
						xtype: 'button',
						iconCls: 'x-fa fa-arrows-alt',
						tooltip: 'Expand ML',
						hidden: !RamcoRTC.settings.enableFullGrid
					},					
					{					
						itemId: 'savePers',
						hidden: navigationOnly,
						tooltip: rvw_resources.R157,
						iconCls: 'x-fa fa-thumb-tack'
					}, 
					{					
						itemId: 'removePers',
						hidden: navigationOnly,
						tooltip: rvw_resources.R158,
						iconCls: 'x-fa fa-thumb-tack-left'
					}, 
					{					
						itemId: 'columnChooser',					
						hidden: (RamcoRTC.settings.showColumnChooser === false),//TECH-30249
						tooltip: rvw_resources.R159,
						iconCls: 'tech-column_chooser'
					}, 
					{					
						itemId: 'multiSort',					
						hidden: (!RamcoRTC.userInfo.hasmsort),
						tooltip: rvw_resources.R302,
						iconCls: 'tech-Sort_ic'
					}, 
					{					
						itemId: 'clearMultiSort',					
						hidden: (!RamcoRTC.userInfo.hasmsort),
						tooltip: rvw_resources.R303,
						disabled: true, // AHBG-31969
						iconCls: 'tech-ClearSort_ic'
					},	
					'-',					
					{
						xtype: 'combobox',
						itemId: 'fieldList',
						hidden: !searchFlag || navigationOnly,
						store: {
							fields: ['vid', 'name'],
							proxy: {
								type: 'memory',
								reader: 'array'
							}
						},
						queryMode: 'local',
						displayField: 'name',
						valueField: 'vid',
						grow: true,
						//editable:false,
						growToLongestValue: true,
						forceSelection: true,
						//TECH-31386
						matchFieldWidth: false,
						listConfig:{
							minWidth: 120
						}
					}, 
					{
						xtype: 'textfield',
						itemId: 'fieldSearch',
						hidden: !searchFlag || navigationOnly,
						emptyText: rvw_resources.R170,
						searchIcon: true,
						role: 'uipage'
					}			
				];
        }
		else
		{
			grdToolbarItems = [{
                    itemId: 'btnFirst',
                    xtype: 'button',
                    iconCls: 'x-fa fa-backward',
                    tooltip: rvw_resources.R140,
					hidden: !me.paginationBar
                }, {
                    itemId: 'btnPrev',
                    xtype: 'button',
                    iconCls: 'x-fa fa-caret-left',
                    tooltip: rvw_resources.R141,
					hidden: !me.paginationBar
                }, {
                    itemId: 'rowNav',
                    xtype: 'numberfield',
                    visibleLength: 2,
                    minValue: 1,
                    maxValue: 1,
                    hidden: true
                }, {
                    itemId: 'dspRow',
                    xtype: 'component',
					tpl: '{v}',
					hidden: !me.paginationBar
                    //html: rvw_resources.R142
                }, {
                    itemId: 'btnNext',
                    xtype: 'button',

                    iconCls: 'x-fa fa-caret-right',
                    tooltip: rvw_resources.R143,
					hidden: !me.paginationBar
                }, {
                    itemId: 'btnLast',
                    xtype: 'button',
                    iconCls: 'x-fa fa-forward',
                    tooltip: rvw_resources.R144,
					hidden: !me.paginationBar
                }, {
                    xtype: 'ramcolabel',
                    itemId: 'gridSelRow',
                    hidden: !RamcoRTC.settings.ShowSelectedRows || lastTskType != 'help'
                }, {
                    itemId: 'btnInsert',
                    xtype: 'button',
                    hidden: navigationOnly || !insertFlag || !showToolbar,
                    iconCls: 'x-fa fa-plus',
                    tooltip: rvw_resources.R145
                }, {
                    itemId: 'btnDelete',
                    xtype: 'button',
                    hidden: navigationOnly || !deleteFlag,
                    iconCls: 'x-fa fa-minus',
                    tooltip: rvw_resources.R146
                }, {
                    itemId: 'btnCut',
                    xtype: 'button',
                    hidden: navigationOnly || !cutFlag,
                    iconCls: 'x-fa fa-cut',
                    tooltip: rvw_resources.R147
                }, {
                    itemId: 'btnCopy',
                    xtype: 'button',
                    hidden: navigationOnly || !copyFlag,
                    iconCls: 'x-fa fa-copy',
                    tooltip: rvw_resources.R148
                }, {
                    itemId: 'btnColumnDefault',
                    xtype: 'button',
                    hidden: !showDefault,
                    iconCls: 'x-fa fa-cog',
                    tooltip: rvw_resources.R245
                }, {
                    itemId: 'btnClearDefault',
                    xtype: 'button',
                    hidden: !showDefault,
                    iconCls: 'tech-ClearDefault_ic',
                    tooltip: rvw_resources.R246,
					cls:'x-clr-default'					
                }, {
                    itemId: 'btnColumnFilter',
                    xtype: 'button',
                    hidden: !RamcoRTC.settings.enableColumnFilter,
                    iconCls: 'tech-Filter_ic',
                    tooltip: rvw_resources.R291,
					cls:'x-clm-filter'
                }, {
                    itemId: 'btnClearFilter',
                    xtype: 'button',
                    hidden: !RamcoRTC.settings.enableColumnFilter,
                    iconCls: 'tech-ClearFilter_ic',
                    tooltip: rvw_resources.R292,
					cls:'x-clm-clrfilter'
                }, {
                    itemId: 'menuImport',
                    xtype: 'button',
                    hidden: navigationOnly || !insertFlag,
                    iconCls: 'x-fa fa-download',
                    menu: [{
                        text: rvw_resources.R026,
                        itemId: 'btnImpExcel',
                        tooltip: rvw_resources.R149,
                        iconCls: 'x-fa fa-file-excel-o'
                    }, {
                        text: rvw_resources.R161,
                        hidden: true,
                        tooltip: rvw_resources.R150,
                        itemId: 'btnImpOffice',
                        iconCls: 'x-fa fa-file-excel-o'
                    }]
                }, {
                    itemId: 'btnExport',
                    xtype: 'button',                    
                    iconCls: 'x-fa fa-upload',
					hidden: navigationOnly || (!exportExcelFlag && !pdfFlag && !htmlFlag && !exportCsvFlag && !reportFlag && !chartFlag),
                    menu: [{
                        text: rvw_resources.R162,
                        itemId: 'btnExpExcel',
                        hidden: !exportExcelFlag,
                        tooltip: rvw_resources.R151,
                        iconCls: 'x-fa fa-file-excel-o'
                    }, {
                        text: rvw_resources.R163,
                        itemId: 'btnExpOffice',
                        hidden: true,
                        tooltip: rvw_resources.R152,
                        iconCls: 'x-fa fa-file-excel-o'
                    }, {
                        text: rvw_resources.R164,
                        itemId: 'btnExpPdf',
						hidden: !pdfFlag,
                        tooltip: rvw_resources.R153,
                        iconCls: 'x-fa fa-file-pdf-o'
                    }, {
                        text: rvw_resources.R165,
                        itemId: 'btnExpHtml',
						hidden: !htmlFlag,
                        tooltip: rvw_resources.R154,
                        iconCls: 'x-fa fa-html5'
                    }, {
                        text: rvw_resources.R166,
                        itemId: 'btnExpCsv',
                        hidden: !exportCsvFlag,
                        tooltip: rvw_resources.R155,
                        iconCls: 'x-fa fa-file-excel-o'
                    }, {
                        text: rvw_resources.R021,
                        itemId: 'btnExpReport',
						hidden: !reportFlag,
                        tooltip: rvw_resources.R156,
                        //iconCls: 'x-fa fa-wpforms'
                        iconCls: 'tech-report'//TECH-25040
                    }, {
                        text: rvw_resources.R027,
                        itemId: 'btnExpChart',
						hidden: !chartFlag,
                        tooltip: rvw_resources.R027,
                        iconCls: 'x-fa fa-bar-chart '
                    }]
                },
                //'-',
                '->',
                //'-',
				{
					itemId: 'btnMlExpand',
					xtype: 'button',
					iconCls: 'x-fa fa-arrows-alt',
					tooltip: 'Expand ML',
					hidden: !RamcoRTC.settings.enableFullGrid
				},
				{
                    itemId: 'tBarGrpBtn',
                    xtype: 'button',
                    hidden: navigationOnly || !personalizeFlag,
                    iconCls: 'x-toolbar-more-icon',
                    menu: [{
                        text: rvw_resources.R157,
                        itemId: 'savePers',
                        hidden: navigationOnly,
                        tooltip: rvw_resources.R157,
                        iconCls: 'x-fa fa-thumb-tack'
                    }, {
                        text: rvw_resources.R158,
                        itemId: 'removePers',
                        hidden: navigationOnly,
                        tooltip: rvw_resources.R158,
                        iconCls: 'x-fa fa-thumb-tack-left'
                    }, {
                        text: rvw_resources.R159,
                        itemId: 'columnChooser',
                        //hidden: navigationOnly,
                        hidden: (RamcoRTC.settings.showColumnChooser === false),//TECH-30249
                        tooltip: rvw_resources.R159,
                        iconCls: 'x-fa fa-columns'
                    }, {
                        text: rvw_resources.R302,
                        itemId: 'multiSort',
                        //hidden: (RamcoRTC.settings.enableMultiSort) ? false : true,
                        hidden: (!RamcoRTC.userInfo.hasmsort),
                        tooltip: rvw_resources.R302,
                        iconCls: 'tech-Sort_ic'
                    }, {
                        text: rvw_resources.R303,
                        itemId: 'clearMultiSort',
                        //hidden: (RamcoRTC.settings.enableMultiSort) ? false : true,
                        hidden: (!RamcoRTC.userInfo.hasmsort),
                        tooltip: rvw_resources.R303,
                        iconCls: 'tech-ClearSort_ic'
                    }]
                }, {
                    xtype: 'combobox',
                    itemId: 'fieldList',
                    hidden: !searchFlag || navigationOnly,
                    store: {
                        fields: ['vid', 'name'],
                        proxy: {
                            type: 'memory',
                            reader: 'array'
                        }
                    },
                    queryMode: 'local',
                    displayField: 'name',
                    valueField: 'vid',
                    grow: true,
					//editable:false,
                    growToLongestValue: true,
                    forceSelection: true,
					//TECH-31386
					matchFieldWidth: false,
					listConfig:{
						minWidth: 120
					}
                }, 
				{
                    xtype: 'textfield',
                    itemId: 'fieldSearch',
                    hidden: !searchFlag || navigationOnly,
                    emptyText: rvw_resources.R170,
                    searchIcon: true,
                    role: 'uipage'
                }
			]
		}
		me.dockedItems = [{
            dock: 'top',
            xtype: 'toolbar',
            itemId: 'gridToolbar',
            overflowHandler: 'scroller',
            defaults: {
                scale: 'small',
                padding: 0,
				margin: '0 3'
            },
            items: grdToolbarItems
        }, {
            dock: 'right',
            xtype: 'container',
            itemId: 'gridScroller',
            padding: 0,
            margin: 0,
            width: 17,
            focusable: true,
			hidden:true,
            defaults: {
                padding: 0,
                margin: 0
            },
            layout: {
                type: 'vbox',
                align: 'stretchmax',
                vertical: true,
                stretchMaxPartner: 'gridSlider'
            },
            items: [{
                width: 17,
                xtype: 'component',
                itemId: 'headerSpace',
                cls: 'x-headerSpace',
                height: 17
            }, {
                width: 17,
                xtype: 'button',
                itemId: 'btnUp',
                iconCls: 'x-fa fa-caret-up',
                ui: 'plain',
                cls: 'x-scr-scrollBtn x-scrollBtn-top',
                height: 17
            }, {
                itemId: 'gridSlider',
                xtype: 'ramcoslider',
                width: 17,
                flex: 1,
                vertical: true,
                value: 1,
                increment: 1,
                minValue: 1,
                maxValue: 1,
            }, {
                width: 17,
                xtype: 'button',
                itemId: 'btnDown',
                iconCls: 'x-fa fa-caret-down',
                cls: 'x-scrollBtn x-scrollBtn-bottom',
                ui: 'plain',
                height: 17
            }, {
                width: 17,
                xtype: 'component',
                itemId: 'bottomSpace',
                cls: 'x-bottomSpace',
                height: 17,
                hidden: true
            }]
        }];
		/**/
		if(me.gridToForm) {
			me.formItems = Ext.create('Ext.form.Panel',{
				itemId: me.itemId + "_FormFields",
				width: me.formFieldWidth,
				userCls: 'x-grid-2-form glance-x', //TECH-36832
				defaultType: "textfield",
				scrollable: true,
				bodyPadding:5,
				buttonAlign : "center",
				collapseDirection: me.formCollapseDir,
				collapsible: me.formCollapsible,
				collapsed: me.formCollapse,
				defaults: {
					width: me.ctrlWidth
				},				
				fieldDefaults: {
					labelAlign: me.labelAlign,
					labelWidth: me.labelWidth
				},
				bind:{
					title:'Current Row : {'+ me.itemId +'f.rn}'
				},
				layout: {
					type: 'table',
					columns:me.formFieldColumns,
					tableAttrs: {
						style: {
							width: 'calc(100% - 15px)'
						}
					}
				},
				items: me.formFields,
				buttons:[{
					text:"",
					iconCls: 'x-fa fa-caret-left',
					handler: me.onPrevClick.bind(me)
				},{
					text:"",
					iconCls: 'x-fa fa-caret-right',
					handler: me.onNextClick.bind(me)
				}]
			});
			me.formItems.ownerCmp = this;
			me.formItems.parentId = me.itemId;
			me.formItems.gridToForm = true;
		}		
        /* GRID MODIFIED - ONLY */
		var hasEditor =false;
		// TECH-40278
		//if ( !insertFlag ) {
			var i =0,
				len = me.columns.length;
			for ( ; i < len; i++ ) {
				if ( me.columns[i].editor ) {
					hasEditor = true;
					break;
				}
			}
		//}
		
		if (insertFlag || hasEditor) {
			if(!me.plugins) {
				me.plugins = [];
			}
            me.plugins.push({
                ptype: 'cellediting',
				id:'gridCellEdit',
                clicksToEdit: 1
            });
        }
		if(showRowExpander) {
			if(!me.plugins) {
				me.plugins = [];
			}
			me.bufferedRenderer = true;
			me.plugins.push({
				ptype: 'rowexpander',
				rowBodyTpl :'<div class="x-rowtpl-tmp"> </div>'
				/*
				rowBodyTpl : new Ext.XTemplate (
					'<p><b>Employee Name :</b> {v2}</p>',
					'<p><b>Department :</b> {v4}</p>',
					'<p><b>Designation :</b> {v5}</p>'
				)
				*/
			});						
        }
        if (!showRowNumber && me.columns.length > 2) {
            me.columns[0].hidden = true;
        }
        if (!showSelection && me.columns.length > 2) {
            me.columns[1].hidden = true;
        }
        me.hideHeaders = !header;
        me.LockedViewConfig = {
			stripeRows: stripeRows,
			scrollable: {
				x: 'auto',
				y: false
			}
		};
		me.normalViewConfig = {
			deferEmptyText: false,
			emptyText: showNoRows ? rvw_resources.R033 : '',
			stripeRows: stripeRows,
			scrollable: {
				x: 'auto',
				y: false
			}
		};
		
		me.viewConfig = Ext.applyIf(me.viewConfig || {}, {
			deferEmptyText: false,
			enableTextSelection:true,
			//emptyText: showNoRows ? rvw_resources.R033 : '',
			stripeRows: stripeRows,
			scrollable: {
				x: 'auto',
				y: false
			},
			//TECH-39926
			getRowClass: me.getRowClass.bind(me)
		});
			
        //me.leadingBufferZone = newNoOfRows;
        //me.trailingBufferZone = newNoOfRows;
		me.leadingBufferZone = 3;
        me.trailingBufferZone = 5;
		
        if (reqBorder) {
            me.cls = Ext.baseCSSPrefix + 'grid-border';
            me.viewConfig['cls'] = Ext.baseCSSPrefix + 'grid-border';
        }
		rowHeight += (RamcoRTC.settings.isExt2 == true) ? 2 : 4;
        me.setRowHeight(rowHeight);
        //me.minHeight = (newNoOfRows + 1 )* rowHeight + 20;
        me.callParent();
		if(me.gridToForm) {
			me.add(me.formItems);
		}
        var deleteFlag = me.getDeleteFlag(),
            view = me.getView(),
            width = 0,
            scrollbar = me.getDockedComponent('gridScroller'),
            showScrollBar = me.getShowScrollBar(),
            searchFlag = me.getSearchFlag(),
            gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null,
            headerSpace = scrollbar ? scrollbar.getComponent('headerSpace') : null,
            bottomSpace = scrollbar ? scrollbar.getComponent('bottomSpace') : null,
            btnUp = scrollbar ? scrollbar.getComponent('btnUp') : null,
            btnDown = scrollbar ? scrollbar.getComponent('btnDown') : null,
            topbar = me.getDockedComponent('gridToolbar'),
            btnFirst = topbar ? topbar.getComponent('btnFirst') : null,
            btnPrev = topbar ? topbar.getComponent('btnPrev') : null,
            btnNext = topbar ? topbar.getComponent('btnNext') : null,
            btnLast = topbar ? topbar.getComponent('btnLast') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            dspSelRow = topbar ? topbar.getComponent('gridSelRow') : null,
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            fieldSearch = topbar ? topbar.getComponent('fieldSearch') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            deleteBtn = topbar ? topbar.getComponent('btnDelete') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            btnColumnDefault = topbar ? topbar.getComponent('btnColumnDefault') : null,
            btnClearDefault = topbar ? topbar.getComponent('btnClearDefault') : null,
			btnColumnFilter = topbar ? topbar.getComponent('btnColumnFilter') : null,
            btnClearFilter = topbar ? topbar.getComponent('btnClearFilter') : null,
			btnMlExpand = topbar ? topbar.getComponent('btnMlExpand') : null,
            menuImport = topbar ? topbar.getComponent('menuImport') : null,
            btnExport = topbar ? topbar.getComponent('btnExport') : null,
            groupingBtn = topbar ? topbar.getComponent('tBarGrpBtn') : null,
			btnSave = groupingBtn ? groupingBtn.menu.items.getByKey('savePers') : null,
            btnRemove = groupingBtn ? groupingBtn.menu.items.getByKey('removePers') : null,
            btnChoose = groupingBtn ? groupingBtn.menu.items.getByKey('columnChooser') : null,
			btnMultiSort = groupingBtn ? groupingBtn.menu.items.getByKey('multiSort') : null,
			btnClearMultiSort = groupingBtn ? groupingBtn.menu.items.getByKey('clearMultiSort') : null,
            columns = me.getVisibleColumnManager().getColumns(),
            lHeaderCt,
            nHeaderCt,			
			impExcel,expExcel,expPdf,expHtml,menuImport,btnExport,expCsv,btnExpReport,btnExpChart;
			
			if (RamcoRTC.settings.isExt2 == true) {
				impExcel = topbar ? topbar.getComponent('btnImpExcel') : null;
				expExcel = topbar ? topbar.getComponent('btnExpExcel') : null;
				expPdf = topbar ? topbar.getComponent('btnExpPdf') : null;
				expCsv = topbar ? topbar.getComponent('btnExpCsv') : null,
				expHtml = topbar ? topbar.getComponent('btnExpHtml') : null;
				btnExpReport = topbar ? topbar.getComponent('btnExpReport') : null;
				btnExpChart = topbar ? topbar.getComponent('btnExpChart') : null;
				btnSave = topbar ? topbar.getComponent('savePers') : null;
				btnRemove = topbar ? topbar.getComponent('removePers') : null;
				btnChoose = topbar ? topbar.getComponent('columnChooser') : null;
				btnMultiSort = topbar ? topbar.getComponent('multiSort') : null;
				btnClearMultiSort = topbar ? topbar.getComponent('clearMultiSort') : null;
			}
			else {
				menuImport = topbar ? topbar.getComponent('menuImport') : null;
				btnExport = topbar ? topbar.getComponent('btnExport') : null;				
				impExcel = menuImport ? menuImport.menu.items.getByKey('btnImpExcel') : null;
				expExcel = btnExport ? btnExport.menu.items.getByKey('btnExpExcel') : null;
				expCsv = btnExport ? btnExport.menu.items.getByKey('btnExpCsv') : null;
				expPdf = btnExport ? btnExport.menu.items.getByKey('btnExpPdf') : null;
				expHtml = btnExport ? btnExport.menu.items.getByKey('btnExpHtml') : null;
				btnExpReport = btnExport ? btnExport.menu.items.getByKey('btnExpReport') : null;
				btnExpChart = btnExport ? btnExport.menu.items.getByKey('btnExpChart') : null;
			}			
            
        height = me.getGridHeight(newNoOfRows);
        me.col = 0;
        //if (scrollbar && (showScrollBar || !showToolbar)) {
        /*if (scrollbar && showScrollBar) {
            scrollbar.show();
        } else
            scrollbar.hide();*/		
		if(showRowExpander) {
			if (scrollbar && showScrollBar)
				scrollbar.show();
		}
		if (!searchFlag) {
            fieldList.hide();
			fieldSearch.hide();
        } else {
            fieldList.show();
			fieldSearch.show();
		}
		/*if (!searchFlag) {
            fieldSearch.hide();
        } else
            fieldSearch.show();*/
        if (gridSlider) {
            me.mon(gridSlider, {
                changecomplete: me.onGridSliderChange,
                scope: me
            });
        }
		if(rowNav) {
			me.mon(rowNav, {
				specialkey:me.onRowNumSet,
				scope:me
			});
		}
        if (btnFirst)
            me.mon(btnFirst, {
                click: me.onBtnFirst,
                scope: me
            });
        if (btnPrev)
            me.mon(btnPrev, {
                click: me.onBtnPrev,
                scope: me
            });
        if (btnNext)
            me.mon(btnNext, {
                click: me.onBtnNext,
                scope: me
            });
        if (btnExpReport)
            me.mon(btnExpReport, {
                click: me.onBtnExpReport,
                scope: me
            });
        if (btnExpChart)
            me.mon(btnExpChart, {
                click: me.onBtnExpChart,
                scope: me
            });
        if (btnLast)
            me.mon(btnLast, {
                click: me.onBtnLast,
                scope: me
            });

        if (btnUp)
            me.mon(btnUp, {
                click: me.onBtnUp,
                scope: me
            });
        if (btnDown)
            me.mon(btnDown, {
                click: me.onBtnDown,
                scope: me
            });

        // Toolbar event Handler
        if (insertBtn)
            me.mon(insertBtn, {
                click: me.onInsert,
                scope: me
            });
        if (deleteBtn)
            me.mon(deleteBtn, {
                click: me.onDelete,
                scope: me
            });
        if (btnCut)
            me.mon(btnCut, {
                click: me.onCutAppendRow,
                scope: me
            });
        if (btnCopy)
            me.mon(btnCopy, {
                click: me.onCopyAppendRow,
                scope: me
            });
        if (btnColumnDefault) {
            me.mon(btnColumnDefault, {
                click: me.onColumnDefault,
                scope: me
            });
        }
        if (btnClearDefault) {
            me.mon(btnClearDefault, {
                click: me.onColumnClearDefault,
                scope: me
            });
        }
		if (btnColumnFilter) {
            me.mon(btnColumnFilter, {
                click: me.onColumnFilter,
                scope: me
            });
        }
        if (btnClearFilter) {
            me.mon(btnClearFilter, {
                click: me.onColumnClearFilter,
                scope: me
            });
        }
		if (btnMlExpand) {
			me.mon(btnMlExpand, {
                click: me.onMlExpand,
                scope: me
            });
		}
		//TECH-30255
		if (groupingBtn) {
			me.mon(groupingBtn, {
                click: me.onGroupingBtn,
                scope: me
            });
		}
		if (btnExport) {
			me.mon(btnExport, {
                click: me.onbtnExportBtn,
                scope: me
            });
		}
        if (impExcel) {
            me.mon(impExcel, {
                click: me.onImportExcel,
                scope: me
            });
            if (!impExcel.isHidden()) {
                me.importWindow = Ext.create('Ext.ramco.Import', {
                    height: 200,
                    width: 400,
                    scrollable: true,
                    hidden: true,
                    modal: true
                });
                me.importWindow.BtnImport.on('click', me.onBtnImportClick, me);
				me.importWindow.BtnValidate.on('click', me.onBtnValidateClick, me);
            }
        }
        if (expExcel)
            me.mon(expExcel, {
                click: me.onshowExcel,
                scope: me
            });
        if (expPdf)
            me.mon(expPdf, {
                click: me.onshowPDF,
                scope: me
            });
        if (expCsv) {
            me.mon(expCsv, {
                click: me.onshowCSV,
                scope: me
            });
        }
        if (expHtml)
            me.mon(expHtml, {
                click: me.onViewall,
                scope: me
            });
        if (btnSave)
            me.mon(btnSave, {
                click: me.onSavePers,
                scope: me
            });
        if (btnRemove)
            me.mon(btnRemove, {
                click: me.onRemovePers,
                scope: me
            });
        if (btnChoose)
            me.mon(btnChoose, {
                click: me.onColumnChoose,
                scope: me
            });
			
		if (btnMultiSort)
			me.mon(btnMultiSort, {click: me.onMultiSort,scope: me});
		if (btnClearMultiSort)
			me.mon(btnClearMultiSort, {click: me.onClearMultiSort,scope: me});
		
        me.mon(me, {
            scope: me,
            columnresize: me.onGridColumnResize,
            columnmove: me.onGridColumnMove,
			focusleave:me.onFocusleave
        });

        if (me.view) {
            me.mon(me.view, {
                scope: me,
                focuschange: me.updateGridSlider,
                cellkeydown: me.onCellKeyDown,
                beforecellkeydown: me.onBeforeCellKeyDown,
				beforecellclick:me.onBeforeCellClick,
				expandbody: me.onExpandBody,
				expandcompleted: me.onExpandBody,
				collapsebody:me.onCollapsebody
            });
        }
        if (me.lockable){
			headerCt = view.lockedView.getHeaderCt();
			headerCt.focusableContainer = false;
            headerCt = view.normalView.getHeaderCt();
			headerCt.focusableContainer = false;
		}
        else{
            headerCt = view.getHeaderCt();
			headerCt.focusableContainer = false;
		}

        me.mon(headerCt, {
            resize: me.onResizeHeader,
            scope: me
        });
		me.mon(me, {
			beforeedit: me.onBeforeEdit,
			canceledit: me.onCancelEdit,
			validateedit:me.onValidateedit,
			scope:me
		});
		if(me.gridToForm) {
			me.mon(me, {
				selectionchange: me.onSelectionChange,
				scope:me
			});
		}
        // if (!header) {
            // if (headerSpace)
                // headerSpace.hide();
            // if (me.lockable) {
                // headerCt = view.lockedView.getHeaderCt();
                // headerCt.setHeight(0)
                // headerCt.hiddenHeaders = true;
                // headerCt = view.normalView.getHeaderCt();
                // headerCt.setHeight(0)
                // headerCt.hiddenHeaders = true;
            // } else {
                // headerCt = view.getHeaderCt()
                // headerCt.setHeight(0)
                // headerCt.hiddenHeaders = true;
            // }
        // }
        if (height > 0) {
            me.setHeight(height);
        }
        if (topbar) {
            topbar[showToolbar ? 'show' : 'hide']();
        }
        if (!showRowNumber && !showSelection) {
            if (me.lockable) {
                view.lockedView.addCls('noborder');
            } else {
                view.addCls('noborder');
            }
        }
        if (reqBorder === false) {
            if (me.lockable) {
                view.lockedGrid.addCls('noborder');
                view.normalGrid.addCls('noborder');
                view.ownerGrid.addCls('noborder');
            } else {
                me.addCls('noborder');
            }
        }
        if (me.lockable) {
            view.normalGrid.view.rowHeight = rowHeight;
            view.lockedGrid.view.rowHeight = rowHeight;
            view.lockedGrid.rowHeight = rowHeight;
            view.normalGrid.rowHeight = rowHeight;
            view.normalGrid.view.onAfter('resize', me.onViewResize, me);
        } else {
            view.rowHeight = rowHeight;
            view.onAfter('resize', me.onViewResize, me);
        }
        var hasHeaderWrap = true,
			headerWrapHeight = 25;
        if (fieldList && columns) {
            var flag = true,
                data = [{
                    vid: 'v0',
                    name: rvw_resources.R007
                }];			
			if (columns && columns.length > 0) {
				var len = columns.length,
					i = 0,
					element = null;
				for(; i < len; i++) {
					element = columns[i];
					if (!(element.dataIndex == 'rn' || element.dataIndex == 'sel') && element.headerWrap === true) {
						hasHeaderWrap = false;
					}
					//columns.forEach(function(element, index, array) {
					// TECH-32380
					if (element.hidden != true) {
						if (!(element.dataIndex == 'rn' || element.dataIndex == 'sel' || element.xtype == "ramcotemplatecolumn" || element.xtype == "imagecolumn" || element.xtype == "fileattachcolumn" || element.xtype == "attachcolumn" || element.xtype == "deletecolumn")) {
							data.push({
								vid: element.dataIndex,
								name: element.text || ''
							});
						}
						if ((element.editor || element.xtype == 'attachcolumn' || element.xtype == 'ramcogridcheck') && !navigationOnly) {
							//insertFlag = true;
							modifiedFlag = true;
							if (element.xtype == 'attachcolumn')
								flag = true;
							me.setInsertFlag(insertFlag);
						}
					}
				}
			//);
			}
			if (flag && !showToolbar && insertFlag)
				insertFlag = insertFlag;
            else if (flag && !showToolbar && insertFlag && !navigationOnly)
                insertFlag = showToolbar;
            else if (flag && insertFlag && navigationOnly)
                insertFlag = false;
            me.setInsertFlag(insertFlag);
            fieldList.getStore().setData(data);
            fieldList.setValue('v0');
        }
		if (!hasHeaderWrap) {
			headerWrapHeight = 0;
		}
		if (!header) {
            if (headerSpace)
                headerSpace.hide(); 
			headerWrapHeight = 0;	
        }
		if (!header || hasHeaderWrap) {					
			if (me.lockable) {
				headerCt = view.lockedView.getHeaderCt();
				headerCt.setHeight(headerWrapHeight)
				headerCt.hiddenHeaders = true;
				headerCt = view.normalView.getHeaderCt();
				headerCt.setHeight(headerWrapHeight)
				headerCt.hiddenHeaders = true;
			} 
			else {
				headerCt = view.getHeaderCt()
				headerCt.setHeight(headerWrapHeight)
				headerCt.hiddenHeaders = true;
			}
		}
        if (deleteFlag && showSelection)
            deleteBtn.show();
        else
            deleteBtn.hide();
		if (insertFlag) {
            insertBtn.show();
            if (cutFlag) {
				btnCut.show();
			}
			if (copyFlag) {
				btnCopy.show();
			}
		}
		else {
            insertBtn.hide();
            if (flag && !insertFlag)
                me.setInsertFlag(false);
            btnCut.hide();
            btnCopy.hide();
		}
		
		// TECH-32380
		if(!showToolbar && !flag)
			me.setInsertFlag(false);
		// AHBG-31969
		//importFlag = insertFlag;
		// TECH-40278
		if (importFlag && !hasEditor) {
			importFlag = false;
		}
		
		if(importFlag && !me.paginationBar)
			importFlag = me.paginationBar;
		if (RamcoRTC.settings.isExt2 == true) {			
			if (modifiedFlag && importFlag) {
				impExcel.show();
			} else {
				impExcel.hide();
			}				
		}
		else {
			// TECH-28119
			if (modifiedFlag && importFlag) {
				menuImport.show();
			} else {
				menuImport.hide();
			}
			/*if(!exportExcelFlag && !pdfFlag && !htmlFlag && !exportCsvFlag && !reportFlag && !chartFlag) {
				btnExport.hide();
			}
			else {
				btnExport.show();
			}*/
		}

    },
	//TECH-39926
	getRowClass: function(record, rowIndex, rowParams, store) {
		var me = this;
		return (!Ext.isEmpty(record.data.rowClass)) ? record.data.rowClass : "";
	},
	initEvents: function() {
		var me =this;
		 if (me.el)
            me.mon(me.el, {
                keyup: me.onRamcoGridKeyUp,
                scope: me
		});
	},
	onRamcoGridKeyUp: function(e, ctrl) {
		var me = this,
            shiftKey = null,
			ctrlKey = null,
            evt = e.getKey(),
            grid = me,
            map,
			gridToolbar,menuImport,btnFirst,btnPrev,btnNext,btnLast,btnInsert,btnDelete,
			btnCut,btnCopy,btnImpExcel,btnExpPdf,btnExpCsv,btnExpHtml,btnExpExcel;
			
        if (e.target && (e.target.nodeName == "INPUT" || e.target.nodeName == "TEXTAREA" ))
            return;
        gridToolbar = grid.getComponent('gridToolbar');
        menuImport = gridToolbar.getComponent('menuImport');
        btnFirst = gridToolbar.getComponent('btnFirst');
        btnPrev = gridToolbar.getComponent('btnPrev');
        btnNext = gridToolbar.getComponent('btnNext');
        btnLast = gridToolbar.getComponent('btnLast');
        btnInsert = gridToolbar.getComponent('btnInsert');
        btnDelete = gridToolbar.getComponent('btnDelete');
        btnCut = gridToolbar.getComponent('btnCut');
        btnCopy = gridToolbar.getComponent('btnCopy');
		if (RamcoRTC.settings.isExt2 == true) {
			btnImpExcel = gridToolbar.getComponent('btnImpExcel')
			btnExpPdf = gridToolbar.getComponent('btnExpPdf');
			btnExpCsv = gridToolbar.getComponent('btnExpCsv'); // TECH-29986
			btnExpHtml = gridToolbar.getComponent('btnExpHtml');
			btnExpExcel = gridToolbar.getComponent('btnExpExcel');
		}
		else {
			btnExport = gridToolbar.getComponent('btnExport');
			btnExpPdf = btnExport.menu.items.getByKey('btnExpPdf');
			btnExpCsv = btnExport.menu.items.getByKey('btnExpCsv'); // TECH-29986
			btnExpHtml = btnExport.menu.items.getByKey('btnExpHtml');
			btnExpExcel = btnExport.menu.items.getByKey('btnExpExcel');
			btnImpExcel = menuImport.menu.items.getByKey('btnImpExcel');
		}		

        if (e.shiftKey)
            shiftKey = 16;
        if (e.ctrlKey)
            ctrlKey = 17;
        if (evt == "80")
            map = shiftKey + parseInt(evt);
		else if (evt == "86") // TECH-29986
            map = shiftKey + parseInt(evt);
        else if (evt == "69")
            map = shiftKey + parseInt(evt);
        else if (evt == "72")
            map = shiftKey + parseInt(evt);
        else if (evt == "45")
            map = shiftKey + parseInt(evt);
        else if (evt == "46")
            map = shiftKey + parseInt(evt);
        else if (evt == "89" || evt == "118")
            map = ctrlKey + parseInt(evt);
        else if (evt == "88" || evt == "119")
            map = ctrlKey + parseInt(evt);
        else if (evt == "73")
            map = shiftKey + parseInt(evt);

        if (map == "96" && btnExpPdf) {
            grid.fireEvent('exportpdf', grid);
        } else if (map == "102" && btnExpCsv) { 
            grid.fireEvent('exportcsv', grid);
        } else if (map == "85" && btnExpExcel) {
            grid.fireEvent('exportexcel', grid);
        } else if (map == "88" && btnExpHtml) {
            grid.fireEvent('exporthtml', grid);
        } else if (map == "61" && btnInsert) {
            grid.onInsert('', e);
        } else if (map == "62" && btnDelete) {
            grid.fireEvent('deleterow', grid);		
		} else if ((map == "105" || map == "136") && btnCut) {
            grid.fireEvent('cutappend', grid);        
		} else if ((map == "106" || map == "135") && btnCopy) {
            grid.fireEvent('copyappend', grid);
        } else if (map == "89" && btnImpExcel) {
            grid.onImportExcel();
            if (!btnImpExcel.isHidden() && Ext.isEmpty(grid.importWindow)) {
                grid.importWindow = Ext.create('Ext.ramco.Import', {
                    height: 200,
                    width: 400,
                    scrollable: true,
                    hidden: true,
                    modal: true
                });
                grid.importWindow.BtnImport.on('click', grid.onBtnImportClick, grid);
            }
        } else if (evt == "36" && btnFirst) {
            grid.onBtnFirst();
        } else if (evt == "33" && btnPrev) {
            grid.onBtnPrev();
        } else if (evt == "34" && btnNext) {
            grid.onBtnNext();
        } else if (evt == "35" && btnLast) {
            grid.onBtnLast();
        }
	},
    onBeforeEdit: function(editor, context, eOpts) {
        var me = this,
			ilbo = me.up('ilbo'),
            record = context.record,
            column = context.column,
            colEditor = column.editor,
            editors = editor.editors,
            cellEditor = editors ? editors.getByKey(context.field) : null,
            field = cellEditor ? cellEditor.field : null,
			lastEditMode=false;
		if(editor.grid.edited === false)
			editor.grid.edited = true;
		else
			lastEditMode=true;
		if (field && field.xtype == "combofield") {
			field.clearLocalFilter();
		}	
        if (field && field.xtype == "ramcosupersegment") {
            return field.prepare(record);
        } 
		else if (editor && editor.xtype == "ramcosupersegment") {
            editor.record = record;
        }
		if(!Ext.isEmpty(column.onFocusTask) && !lastEditMode){
			record.dirty = true;
			record.set("isNew",false);
			if(!record.modified) 
				record.modified = [];
				record.modified[column.dataIndex] = true;
				me.lastEvent = "focusenter";
			Ext.defer(function(){
				record.store.cr = record.get("rn");
				me.fireEvent('focusenter', me, column,record);
			},10);
			return false;
		}
		if(ilbo.pendingEvent){
			var dataColumnid =  column.dataIndex || "0"
			me.fireEvent('ctrlfocus', me.itemId , dataColumnid.replace('v', ''), record.get('rn'));
			ilbo.pendingEvent.call();
			ilbo.pendingEvent=null;
			return false;
		}
    },
	onCancelEdit:function(){
		this.edited=false;
	},
    onValidateedit: function(editor, context, eOpts) {
        var me = this,
            record = context.record,
            column = context.column,
            colEditor = column.editor,
            editors = editor.editors,
			ilbo = me.up('ilbo'),
            cellEditor = editors ? editors.getByKey(context.field) : null,
            field = cellEditor ? cellEditor.field : null,
			fieldVal; // TECH-29356
		if(!Ext.isEmpty(field) && !field.isValid()) {
			context.cancel = false;
			return false;
		}
		delete context.cancel;
		if (field) {
			//TECH-38989 
			if (ilbo && ilbo.callout && ilbo.callout.onGridEditOnBlur) {
			    try {
			        ilbo.callout.onGridEditOnBlur.apply(ilbo || window, [me, column, field,record]);
			    }
				catch (e) {
			        console.log("Error in Callout Js." + e);
			    }
			}
			// TECH-29356
			fieldVal = field.getValue();
			//TECH-32076
			if (!Ext.isEmpty(fieldVal) && (field.xtype == 'textfield' || field.xtype == 'textarea' || field.xtype == 'textareafield')){
				fieldVal = purifyDom(fieldVal);
				field.setValue(fieldVal);
			}
			/*if (!Ext.isEmpty(fieldVal) && RamcoRTC.settings.purifyText != false) {
				fieldVal = DOMPurify.sanitize(fieldVal);
				// Vulnerability only for text field
				if (field.xtype == 'textfield' || field.xtype == 'textarea' || field.xtype == 'textareafield')
					field.setValue(fieldVal);
			}
			if (field.xtype == "ramcosupersegment") {
				field.updateRecord(record);
			}*/
			if (column.hasMasking === true ) {
				if (record.get(column.dataCol) != fieldVal) {
					record.set(column.dataCol, fieldVal);				
				}
				else {
					if (!Ext.isEmpty(record.modified)) {
						record.modified[column.dataIndex] = null;
						delete record.modified[column.dataIndex];
					}
				}
			}
			/*if (field.xtype == "ramcolistedit") {
				if (Ext.isEmpty(field.listSelection)) {
					field.setValue(null);
				}
				else {
					field.setValue(field.listSelection.get(field.searchView));
				}
			}*/
			// if(field && field.xtype == "ramcolistedit") {
				// me.field.collapse();		
				// me.field.context.grid.fireEvent('listselect', me.field.context.column, me.field.context.grid, me.field.getSelectedRecord());
			// }
			//if (field.hasEnter && (column.task || field.xtype == "ramcolistedit")) {            			
			if (field.hasEnter && column.customListEdit === true) {
				field.hasEnter = false;
				record.dirty = true;
				if(!record.modified) {
					record.modified = [];
					record.modified[column.dataIndex] = true;
				}
				if(field.listSelection) {
					field.ownerCt.completeEdit();
					field.grid.fireEvent('customlistselect', field, field.listSelection);
					field.listSelection = null;
					delete field.listSelection;
				}			
				return false;
			}
			if (field.hasEnter) {
				field.hasEnter = false;
				if(column.uiTask) {
					record.dirty = true;
					if(!record.modified) {
						record.modified = [];
						record.modified[column.dataIndex] = true;
					}			
					if(field.xtype == "ramcolistedit" && field.listSelection) {
						me.fireEvent('listselect', field, field.listSelection);
						field.listSelection = null;
						delete field.listSelection;
					}
					else {
						Ext.defer(function(){me.fireEvent('enter', me, column, record)},10);
					}
				}
				else {
					if(field.xtype == "ramcolistedit" && field.listSelection) {
						me.fireEvent('listselect', field, field.listSelection);
						field.listSelection = null;
						delete field.listSelection;
					}
				}
			}
			if(!Ext.isEmpty(column.leaveFocusTask)){
				var rn = record.get("rn");
				record.dirty = true;
				// TECH-41241
				record.set(column.dataIndex, field.getValue());
				record.set("isNew",false);
				if(!record.modified) 
					record.modified = [];
				record.modified[column.dataIndex] = true;
				ilbo.pendingEvent = function(){
					me.store.cr = rn;
					me.lastEvent = "focusleave";
					me.editing = true;
					me.fireEvent('focusleave', me, column,record);
				};
			}
		}
        return true;
    },
	onSelectionChange: function(grid, selected, eOpts ) {
		var me = this,
			formViewModel = null;
		//formViewModel = (me.formItems) ? me.formItems.getViewModel() : formViewModel;
		if(me.formItems && selected.length > 0) {
			//formViewModel.set('currentrow', selected[0]);
			var ilbo = me.up("ilbo"),
				viewModel = ilbo?ilbo.getViewModel():null;
			if(viewModel){
				grid.store.cr = selected[0].get("rn");
				me.formItems.cr = selected[0].get("rn");
				viewModel.set(me.getItemId()+ "f",selected[0])
				viewModel.notify();
			}
		}
	},
    getGridHeight: function(newNoOfRows) {
        var me = this,
            rowHeight = me.getRowHeight(),
            showToolbar = me.getShowToolbar(),
            header = me.getShowHeader(),
			reqBorder = me.getReqBorder(),
            view = me.view,
			expConfig = me.rowExpConfig,
			expRowHeight = 0,
            headerHeight = 0,
            height = 0;
        if (newNoOfRows == 0)
            newNoOfRows++;
        //height = (newNoOfRows * (rowHeight + 1));
        height = (newNoOfRows * (rowHeight + ((me.rowLines) ? 1 : 0))); //+ ((reqBorder) ? 1 : 0);
        if (me.rendered) {
            if (header) {
                var headerCt;
                if (me.lockable)
                    headerCt = view.normalView.getHeaderCt();
                else
                    headerCt = view.getHeaderCt();
                headerHeight = headerCt.getHeight();
                if (headerHeight == 0)
                    headerHeight = me.oldheaderHeight;
                height += headerHeight;
            }
            var nGridView = view.normalGrid ? view.normalView : view;
            if (nGridView.rendered && nGridView.el.dom.scrollWidth > nGridView.el.dom.clientWidth)
                height += Ext.getScrollbarSize().height;
        }
        if (showToolbar != false)
            height += 26;
        return height;
    },
    hasLockedColumns: function(columns) {
        var i,
            len,
            column;

        // Fully instantiated HeaderContainer
        if (columns.isRootHeader) {
            columns = columns.items.items;
        }
        // Config object with items
        else if (Ext.isObject(columns)) {
            columns = columns.items;
        }
        for (i = 0, len = columns.length; i < len; i++) {
            column = columns[i];
            if (!column.processed && column.locked && !column.hidden) {
                return true;
            }
        }
    },
    getUpdatedSequence: function() {
        var me = this,
            columns = me.getColumns(),
            column, colArr = [];
        for (key in columns) {
            column = columns[key];
            if (column && column.dataIndex != 'rn' && column.dataIndex != 'sel') {
                colArr.push(column.dataIndex.replace('v', ''));
            }
        }
        return colArr;
    },
	// TECH-34273
	applyGridMultiSort: function(views, sortState) {
		var me = this,
			gridId = me.getItemId(),
			processItemId, gridHeaderItem,
			sortOrder, k = 0,
			ilbo = me.up('ilbo'),
			ilboName = ilbo && ilbo.ilboConfig && ilbo.ilboConfig.ilboName,
			mainController = getMainController(),
			workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
		for (; k < views.length; k++) {
			processItemId = 'v' + views[k].view;
			gridHeaderItem = me.getColumnById(processItemId);
			if (gridHeaderItem) {
				sortOrder = views[k].so;				
				if (sortOrder != -1 && sortState !== 'clear') {
					gridHeaderItem.addCls((sortOrder == '0') ? 'grid-Ascending_ic' : 'grid-Descending_ic');
					gridHeaderItem.removeCls((sortOrder == '0') ? 'grid-Descending_ic' : 'grid-Ascending_ic');
				}
				else {
					if (gridHeaderItem.hasCls('grid-Ascending_ic'))
						gridHeaderItem.removeCls('grid-Ascending_ic')
					else if (gridHeaderItem.hasCls('grid-Descending_ic'))
						gridHeaderItem.removeCls('grid-Descending_ic')
				}
			}
		}
		
		if (sortState !== 'clear') {
			if(!mainController.multiSortGridData[workArea])
				mainController.multiSortGridData[workArea] = []
			if(!mainController.multiSortGridData[workArea][ilboName])
				mainController.multiSortGridData[workArea][ilboName] = []
			mainController.multiSortGridData[workArea][ilboName][gridId] = [gridId, views];
		}
	},
    updateValue: function(newValue, oldValue) {
        var me = this,
            view = me.getView(),
            visibleRows = me.getVisibleRows(),
            //checkHeader = me.down('ramcogridcheck'),
            checkHeader = null,
            _checkHeader = me.query('ramcogridcheck'),
            vr = null,
            autoHeight = me.getAutoHeight(),
            insertFlag = me.getInsertFlag(),
            showToolbar = me.getShowToolbar(),
            showScrollBar = me.getShowScrollBar(),
            topbar = me.getDockedComponent('gridToolbar'),
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            dspSelRow = topbar ? topbar.getComponent('gridSelRow') : null,
            scrollbar = me.getDockedComponent('gridScroller'),
            gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null,
			lockr = me.getScrollable(),			
			curRowIndex = null,
			splitIndex,
			ilbo = me.up('ilbo'),
            viewModel = ilbo.getViewModel(),
            nGridView = view.normalGrid ? view.normalGrid.view : view,
			//TECH-35031
			mainController = getMainController(),
			lastTask = '';
		if(lockr)
			lockr.trackingScrollTop = 0;
		if (Ext.isEmpty(me.store.prec))
			me.store.prec = {};
        if (!me.store || me.store.isEmptyStore) {
            me.lastValue = newValue;
            if (!me.columnInit && newValue.columnsValue) {
                var columns = me.getColumns(),
                    column, columnValue;
                for (key in columns) {
                    column = columns[key];
                    if (column) {
                        columnValue = newValue.columnsValue[column.dataIndex];
                        if (columnValue) {
                            column.setFormat(columnValue['ft']);
							me.store.prec[column.dataIndex] = columnValue['ft'];
                        }
                    }
                }
                me.columnInit = true;
            }
            return;
        }
        if (newValue) {
            delete me.lastValue;
            if (newValue.columns) {
                me.rsColumns = newValue.columns || [];
                me.rsColumnsValue = newValue.columnsValue || [];
                if (newValue.columnsValue) {
                    var columns = me.getColumns(),
                        column, columnValue;
                    for (key in columns) {
                        column = columns[key];
                        if (column) {
                            columnValue = newValue.columnsValue[column.dataIndex];
                            if (columnValue) {
                                column.setFormat(columnValue['ft']);
								me.store.prec[column.dataIndex] = columnValue['ft'];
								if (columnValue['scc'])
									column.setText(columnValue['scc']);     
								if(columnValue.store) {
									if (RamcoRTC.isGProto) {
										column.editor.store = columnValue.store;
										column.editor.store.isEmptyStore = false;
										columnValue.store = null;
										delete columnValue.store;
									}
									else {
										colStore = viewModel.storeInfo[me.itemId + "_" + column.dataIndex + "_store"];
										if(colStore) {
											colStore.loadData(columnValue.store);
											colStore.commitChanges();
											columnValue.store = null;
											delete columnValue.store;
										}
									}
	                            }
	                        }
	                    }
	                }
	            }
            }
			 /*  if(newValue && newValue.store.length > 0){
				var hijriColumns = me.getColumns(),hijriDate,columnIdx,columnId;
				for(key in hijriColumns){
					columnIdx = hijriColumns[key].config;
					if((columnIdx.name !="rn" || columnIdx.name !="sel") && columnIdx.editor && columnIdx.editor.plugins){
						columnId = columnIdx.itemId;	
						for(newValueKey in newValue.store){
							if(columnId){
								hijriDate = newValue.store[newValueKey][columnId];
								if(!Ext.isEmpty(hijriDate)){
									newValue.store[newValueKey][columnId] = Ext.Date.parseHijri(hijriDate,true);
								}
							}
						}
					}
				}
			}  */
			//TECH-30053
			if(me.vsi != newValue.vsi && RamcoRTC.focusCtrl && RamcoRTC.focusCtrl[1])
			{
				if(RamcoRTC.focusCtrl[1] == me.config.itemId)
					RamcoRTC.focusCtrl[2] = newValue.vsi;
			}
            me.vsi = (newValue.vsi < 1) ? 1 : newValue.vsi;
            me.si = newValue.si;
            me.tr = newValue.tr;
            me.store.nsr = parseInt(newValue.nsr, 10);
            me.store.start = me.si;
            me.store.si = me.si;
            me.store.end = (visibleRows * 3) + (me.si - 1);
            if (me.store.end > me.tr)
                me.store.end = me.tr
            me.store.tr = me.tr;
            me.store.vr = newValue.vr || me.store.vr;
            vr = (me.vsi + (me.store.vr / 3)) >= me.tr ? me.tr : (me.vsi + (me.store.vr / 3) - 1);
            me.store.vsi = me.vsi;
			//TECH-30053 
			// TECH-28674
			/*if(RamcoRTC.focusCtrl && RamcoRTC.focusCtrl[1])
			{
				if(RamcoRTC.focusCtrl[1] == me.config.itemId)
					RamcoRTC.focusCtrl[2] = me.store.vsi;
			}*/
            //if (!me.store.cr)
                //me.store.cr = me.vsi;
			//lockr.scrollTo(0,0);
			//if(Ext.isEmpty(me.coldef) || me.coldef == false) {
			me.store.setData(newValue.store);
			me.store.commitChanges();
			//}
			if (me.isMlExpand === true) {			
				ilbo.mlExpandWin.expGrid.store.reload();
			}
			//TECH-36970
			 if(!Ext.isEmpty(me.zoomWindow) && !me.zoomWindow.isHidden()){
				 //	me.zoomWindow.bindDataToControl(me.store.getAt(me.zoomWindow.index));
				me.zoomWindow.bindDataToControl(me.store.findRecord('rn', me.zoomWindow.index));
			} 
			curRowIndex = parseInt((me.vsi - me.si) / me.visibleRows) * me.visibleRows
			//if(!isNaN(curRowIndex))
				//lockr.scrollTo(0, parseInt(me.rowHeight + 1) * curRowIndex);
            if (newValue.sci) {
				if (Ext.isEmpty(me.lastSearch)) {
					me.lastSearch = {}
				}
				
				// TECH-28121
				if(newValue.sci.srr == -999 && newValue.sci.scol == -999)
				{
					me.onNoSearchData(me);
				}
				else
				{
					me.lastSearch.text = newValue.sci.sp;
					me.lastSearch.row = newValue.sci.srr;
					me.lastSearch.col = newValue.sci.scol;
				}
			}
			else {
				me.lastSearch = null;
				me.searchIndex = null;
			}
			if (gridSlider) {
				topbar.suspendLayouts();
                if (newValue.tr && newValue.vsi) {
                    gridSlider.suspendEvents();                    
					gridSlider.setMaxValue(me.tr);
                    gridSlider.setValue(me.vsi);
                    rowNav.suspendLayouts();					
					rowNav.setMaxValue(me.tr);
                    rowNav.setValue(me.vsi);
					rowNav.show();
                    rowNav.resumeLayouts();
					dspRow.suspendLayouts();
					dspRow.update({v:'- ' + vr + '/' + me.tr});
                    //dspRow.setHtml('- ' + vr + '/' + me.tr);
					dspRow.resumeLayouts();
					gridSlider.resumeEvents();
                } else {
					rowNav.suspendLayouts();
					rowNav.hide();
					rowNav.resumeLayouts();
                    //dspRow.setHtml(rvw_resources.R033);
					dspRow.suspendLayouts();
					dspRow.update({v:rvw_resources.R033});
                    dspSelRow.setValue(parseInt(me.store.nsr, 10) + " Selected");
					dspRow.resumeLayouts();
                }
				topbar.resumeLayouts();
                if (autoHeight) {
                    me.suspendEvents();
                    if (newValue.tr < visibleRows) {
                        me.setHeight(me.getGridHeight(parseInt(newValue.tr)));
                    } else {
                        me.setHeight(me.getGridHeight(visibleRows));
                    }
                    me.resumeEvents();
                }
                if (scrollbar && !showToolbar) {
					scrollbar.suspendLayouts();					
                    //if (newValue.tr > visibleRows && showScrollBar)
					if (newValue.tr > visibleRows)
                        scrollbar.show();
                    else
                        scrollbar.hide();
					scrollbar.resumeLayouts();
					me.onViewResize();
                }
            }
			for (var l = 0; l < _checkHeader.length; l++) {
				checkHeader = _checkHeader[l];
				if (checkHeader.dataIndex == 'sel') {
		            if (newValue.nsr > 0 && newValue.nsr == newValue.tr) {
		                checkHeader.checkEl.removeCls('x-column-header-unchecked');
		                checkHeader.checkEl.addCls('x-column-header-checked');
		            } 
					else {
		                if (checkHeader && checkHeader.checkEl && checkHeader.checkEl.hasCls('x-column-header-checked')) {
		                    checkHeader.checkEl.removeCls('x-column-header-checked');
		                    checkHeader.checkEl.addCls('x-column-header-unchecked');
		                }
		            }
				}
				else {
					if (checkHeader.isCheck) {
						var storeItems = me.store.data.items, gridCheck = true;
						for ( var  j = 0; storeItems && j < storeItems.length; j++ ) {
							if (storeItems[j].data[checkHeader.dataIndex] != '1') {
								gridCheck = false;
								break;
							}
						}
						//TECH-35690
						//if (newValue.tr == 0 || !gridCheck && checkHeader.checkEl) {						
						if (newValue.tr == 0) {
							if (!gridCheck && checkHeader.checkEl) {
								checkHeader.checkEl.removeCls('x-column-header-checked');
								checkHeader.checkEl.addCls('x-column-header-unchecked');
							}
						}
					}
				}
			}

            /* if (newValue.columnsValue) {
                var columns = me.getColumns(),
                    column, columnValue;
                for (key in columns) {

                    column = columns[key];
                    if (column) {
                        columnValue = newValue.columnsValue[column.dataIndex];
                        if (columnValue) {
                            column.setFormat(columnValue['ft']);
                            if (columnValue['scc'])
                                column.setText(columnValue['scc'])
                        }
                    }
                }
                me.columnInit = true;
            } */
            //me.taskid = Ext.defer(me.setCurrentRow.bind(me), 200);
            me.setCurrentRow();
			if (!Ext.isIE) {
	            me.view.lockedView.refreshView();
	            me.view.normalView.refreshView();
			}
			lastTask = mainController.getLastTask(); //TECH-35031
			//Ext.defer(function(){
				if(!isNaN(curRowIndex) && lockr.getNormalScroller()) {
					// TECH-XXXXX
					//lockr.scrollTo(0, parseInt(me.rowHeight + 1) * curRowIndex);
					//lockr.trackingScrollTop = parseInt(me.rowHeight + 1) * curRowIndex;
					var normalScr = lockr.getNormalScroller();
					normalScr.scrollTo(normalScr.trackingScrollLeft, parseInt(me.rowHeight + 1) * curRowIndex);
					normalScr.trackingScrollTop = parseInt(me.rowHeight + 1) * curRowIndex;
					//TECH-34390 /LH-417 /ANZ-318
					var storeIdx  = me.store.getAt(0),rn = storeIdx && storeIdx.get('rn') ;
					//TECH-35031					
					//if(me.vsi > 1 && (rn != me.vsi) && Ext.isEmpty(me.lastEvent))
					if(me.vsi > 1 && (rn != me.vsi) && Ext.isEmpty(me.lastEvent) && lastTask == "tskstdscreeninit")
						me.lastEvent = "onfirst";
					
				}
			//},50,me);
        }
        if (me.zoomWindow) {
            me.zoomWindow.processLastAction();
        }
		//TECH-36491
		//if (Ext.isEmpty(me.lastEvent) && me.sortCol && lastTask != "tskstdsort") {
		if (Ext.isEmpty(me.lastEvent) && me.sortCol && me.sortCol.rendered && lastTask != "tskstdsort") {
			me.sortCol.setSortState(null);
			me.isSort = false;
		}
		if (!me.paginationBar) {
			rowNav.hide();
		}
        /*if (nGridView.rendered) {
            me.onViewResize(nGridView);
        }*/
    },
	//TECH-31148
	clearGridSelection: function(grid) {
		if(grid) {
			var selModel = grid.getSelectionModel();			
			if(selModel)
				selModel.clearSelections();			
			var selectedCls = grid.view.selectedCellCls,
				tds = grid.body && grid.body.query("td."+ selectedCls);
			for(td in tds){
				tds[td].classList.remove(selectedCls);
			}			
		}
	},
    gridFocus: function(cellView, CRow) {
        var me = this,
            view = me.getView(),
            keyNav = RamcoRTC.focusCtrl[4],
            rowHeight = parseInt(me.rowHeight + 1),
            nav = me.getNavigationModel(),
            sel = me.getSelectionModel(),
            lokgr = me.getScrollable(),
			topbar = me.getDockedComponent('gridToolbar'),
			rowNav = topbar ? topbar.getComponent('rowNav') : null,
            //record = me.store.findRecord('rn', CRow),
			visibleRows = me.getVisibleRows(),
			vsiRecords,
			vsiRecord,
            rowIndex = -1,
			editCol = null,
            row, curRowIndex,
			column = null; //TECH-31387
		/*
		if(me.lastEvent == 'insert')
			record = me.store.findRecord('rn', CRow - 1);
		else
		*/
			record = me.store.findRecord('rn', CRow);
        if (record)
            rowIndex = me.store.indexOf(record);
        if (rowIndex > -1)
            row = view.getRow(rowIndex);
        row = view.getRow(rowIndex);
        if (me.lastEvent == 'onnext' || me.lastEvent == 'onprev' || me.lastEvent == 'onfirst' || me.lastEvent == 'onlast' || me.lastEvent == 'insert' || me.lastEvent == 'onSearch') {
			//TECH-35031			
			//TECH-34885
			//lokgr.scrollTo(lokgr.trackingScrollLeft || 0, (rowHeight * 0));
			//TECH-33759 
			if (!Ext.isIE) {
				me.updateLayout();
			}
            if (keyNav == 'down') {
                lokgr.scrollTo(0, rowHeight);
                me.updateRowNavigation(CRow, keyNav);
            } 
			else {
                curRowIndex = rowIndex;
				if(curRowIndex < 1) {
					if(me.tr > 0)
						//CRow = 1;
						CRow = (record && record.get("rn")) || 1;
				}
                if (me.lastEvent == 'insert') {
					//curRowIndex = parseInt((rowIndex) / me.visibleRows) * me.visibleRows;
					CRow = parseInt((me.tr - 1) / me.visibleRows) * me.visibleRows + 1;
					//TECH-28858
					me.store.vsi = CRow;
					if(me.tr > rowNav.getValue() + me.visibleRows - 1) {
						//CRow = parseInt((me.tr - 1) / me.visibleRows) * me.visibleRows + 1;
						curRowIndex = parseInt((rowIndex) / me.visibleRows) * me.visibleRows;
						lokgr.scrollTo(0, (rowHeight * curRowIndex));
						lokgr.trackingScrollTop = rowHeight * curRowIndex;						
                    }
					editCol = me.getVisibleFirstEditorColumn();					
                }
				else {
					//TECH-29873
					if (me.lastEvent == 'onSearch') {
						if((curRowIndex % visibleRows) == 0){
							lokgr.scrollTo(lokgr.trackingScrollLeft || 0, (rowHeight * curRowIndex));
							lokgr.trackingScrollTop = rowHeight * curRowIndex;
						}
						else {
							var pageSet = Math.floor(curRowIndex / visibleRows),
								range = pageSet * visibleRows;
							vsiRecords = me.store.getRange(range,range);
							if(vsiRecords && vsiRecords.length>0){
								vsiRecord = vsiRecords[0];
								CRow = vsiRecord.get("rn");
								me.store.vsi = CRow;
							}
							if (lokgr.trackingScrollTop != rowHeight * range) {
								lokgr.scrollTo(lokgr.trackingScrollLeft || 0, (rowHeight * range));
								lokgr.trackingScrollTop = rowHeight * range;
							}
						}
					}
					else {
						//TECH-34885
						lokgr.scrollTo(lokgr.trackingScrollLeft || 0, (rowHeight * curRowIndex));
						lokgr.trackingScrollTop = rowHeight * curRowIndex;
						// var pageSet = Math.floor(curRowIndex / visibleRows),
							// range = pageSet * visibleRows;
							// vsiRecords = me.store.getRange(range,range);
						// if (vsiRecords && vsiRecords.length > 0) {
							// vsiRecord = vsiRecords[0];
							// var cVsi = vsiRecord.get("rn");
							// CRow = parseInt(CRow);
							// me.store.vsi = cVsi;								
							// lokgr.scrollTo(lokgr.trackingScrollLeft || 0, (rowHeight * range));
						//lokgr.trackingScrollTop = rowHeight * curRowIndex;
							// CRow = cVsi;
						// }
					}
				}
                me.updateRowNavigation(CRow, me.lastEvent);
				me.lastEvent = '';
            }
        }
		// TECH-30946
		if (Ext.isEmpty(editCol) && (me.lastEvent == "cmbSelect" || me.lastEvent == "focusleave" || me.lastEvent == "focusenter" ) && !Ext.isEmpty(cellView)) {
            //TECH-31387
			//me.lastEvent == "";			
			me.lastEvent = "";
			var getColumn = me.getColumnById("v" + cellView);
            if (getColumn){
                if(typeof getColumn.editor == "object") {
                    editCol = getColumn;
                }
            }
        }
		if(editCol) {
			me.col = editCol.getVisibleIndex();
			nav.view = (editCol.isLocked()) ? me.view.lockedView : me.view.normalView;			
			
			if(nav.lastFocused)
				nav.lastFocused.view = nav.view;
			if(sel)
				sel.view = nav.view;
			me.clearGridSelection(me);
			nav.setPosition(rowIndex, editCol);
			//TECH-31387
			column = editCol;
		}
		else {
			//TECH-31148
			var lcelctxt = new Ext.grid.CellContext(nav.position.view);
			var fcell = lcelctxt.setPosition(rowIndex,me.col);
			//TECH-31365, TECH-31363
			var columnManager,
				columns;
			if(nav.position.view) {
				columnManager = nav.position.view.getVisibleColumnManager();
				columns = columnManager.getColumns();
			}
			fcell.record = record;
			fcell.rowIdx = rowIndex;
			//var columns =  me.getColumns(),
			//column = columns&&columns.length >= me.col?columns[me.col]:null;
			if (Ext.isEmpty(columns)) {
				columns =  me.getVisibleColumns();
			}
			column = columns && columns.length >= me.col ? columns[me.col] : null;
			fcell.column = column;
			if (sel) {
				//TECH-31148
				//var lcelctxt = new Ext.grid.CellContext(nav.position.view);
				//var fcell = lcelctxt.setPosition(me.col, rowIndex);
				//fcell.record = nav.position.record || record;
				//fcell.rowIdx = nav.position.rowIdx || rowIndex;
				//var columns =  me.getColumns(),
					//column = columns&&columns.length >= me.col?columns[me.col]:null;
				//fcell.column = column;
				//sel.select(fcell);
				/*sel.select({
					row: rowIndex,
					column: me.col
				});*/
				sel.clearSelections();
				me.clearGridSelection(me);			
				var colCollection,
					colIndex = me.col;
				if (column) {
					nav.view = (column.isLocked()) ? me.view.lockedView : me.view.normalView;						
					if(nav.lastFocused)
						nav.lastFocused.view = nav.view;				
					sel.view = nav.view;
					colCollection = (column.isLocked()) ? me.lockedGrid.getVisibleColumns() : me.normalGrid.getVisibleColumns();				
					colIndex = colCollection.indexOf(column);
				}
				sel.select({
					row: rowIndex,
					//column: me.col
					column: colIndex
				});
				//TECH-36063
				if (fcell) {
					sel.onCellSelect(fcell, true);
				}
			}
        }
        if (row) {
            if (nav) {
				if (!Ext.isIE) {
					me.updateLayout(); //IMU-250 / TECH-28910
				}
				//TECH-31148
				//nav.focusPosition(nav.position);
				//if(Ext.isEmpty(nav.position)){
					//nav.setPosition(rowIndex, me.col, nav.cell);
					nav.setPosition(rowIndex, column);	
		            nav.focusPosition(nav.getPosition());
		        //}
		    }
        }
		if(me.edited || editCol) {
			var grdPlug = me.getPlugin('gridCellEdit');
			if(Ext.isEmpty(nav.position) || Ext.isEmpty(nav.getPosition())){
				nav.setPosition(rowIndex, me.col);
			}
			if (!me.zoomWindow || (me.zoomWindow && !me.zoomWindow.isVisible())) // TECH-30546 / QA-151
				grdPlug.startEditByPosition(nav.getPosition());			
		}		
    },
	getVisibleFirstEditorColumn: function() {
		var me = this,
			columns = me.getVisibleColumns(),
			colLen = columns.length,
			curCol = null,
			c =0;
		for(; c < colLen; c++) {
			curCol = columns[c];
			// TECH-33857
			if(!curCol.isHidden() && curCol.stateEnabled != false) {
				if(typeof curCol.editor == "object")
					return curCol;
			}
		}
		return null;
    },
    setCurrentRow: function() {
        if (!this.view)
            return;
        var me = this,
            view = me.getView(),
            plugins = me.plugins,
            cellPlugin = plugins ? plugins[0] : null,
            colIndex = 0,
            lastEvent = me.lastEvent,
            editableCols = Ext.ComponentQuery.query('{editor}', me.columns),
            insertFlag = me.getInsertFlag();
        if (me.taskid) {
            clearTimeout(me.taskid);
            delete me.taskid;
        }
        //if (insertFlag && (me.tr <= 0 || me.tr <= me.store.end + 1)) {
		if (insertFlag && (me.tr < me.si + (me.visibleRows * 3) - 1) && (me.lastEvent != 'onfirst' && me.lastEvent != 'onlast')) {
            me.createDummyRecord();
        }
		if(me.gridToForm) {
			var sel = me.getSelectionModel();
			sel.select({
				row: 0,
				column: 0
			});
		}
        /*
        if (me.tr > 0 && me.vsi > 0) {
            if (view) {
                var nav = me.getNavigationModel(),
                    sel = me.getSelectionModel(),
                    record = me.store.findRecord('rn', me.vsi),
                    rowIndex = -1,
                    row;
                if (lastEvent == 'insert') {
                    record = me.store.findRecord('rn', (me.tr));
                    if (!record)
                        record = me.store.findRecord('rn', me.vsi);
                } else if (lastEvent == 'gridsearch') {
                    me.searchIndex = null;
                    Ext.defer(me.doSearch.bind(me), 200);
                }
                if (record)
                    rowIndex = me.store.indexOf(record);
                if (rowIndex > -1)
                    row = view.getRow(rowIndex);
                if (row && sel) {
                    me.scrollToRecPostion(record, true, false, '', lastEvent);
                    if (lastEvent == 'insert') {
                        if (editableCols.length > 0) {
                            colIndex = me.columns.indexOf(editableCols[0]);
                        }
                        if (cellPlugin)
                            cellPlugin.startEdit(rowIndex, colIndex);
                    }
                }
            }
        } else {
            if (lastEvent == 'insert') {
                if (editableCols.length > 0) {
                    colIndex = me.columns.indexOf(editableCols[0]);
                }
                if (cellPlugin)
                    cellPlugin.startEdit(0, colIndex);
            } else if (lastEvent == 'gridsearch') {
                me.searchIndex = null;
                delete this.lastEvent;
                me.doSearch();
            }
        }
        if (lastEvent != 'gridsearch')
            delete this.lastEvent;
		*/
    },
    onGridSliderChange: function(slider, newValue, thumb, eOpts) {
        var me = this,
            view = me.getView(),
            visibleRows = me.getVisibleRows(),
            cr = newValue,
            tr = me.tr,
            store = me.store,
            lastRow = store.count(),
            insertFlag = me.getInsertFlag(),
            last = insertFlag ? 2 : 1,
            lastRecord = lastRow > 0 ? store.getAt(lastRow - last) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = newValue > visibleRows ? newValue - visibleRows : 1,
            end = (visibleRows * 3) + (start - 1),
            rowHeight = parseInt(me.rowHeight + 1),
            si, ei;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		
		if (newValue > slider.value)
			slider.sliderNav = "down";
		else
			slider.sliderNav = "up";
		
        if (slider.sliderNav == 'down')
            me.lastEvent = 'onnext';
        else if (slider.sliderNav == 'up')
            me.lastEvent = 'onprev';
        if (!(cr >= si && cr <= ei)) {
            me.store.start = start;
            me.store.end = end;
            me.store.cr = cr;
            me.store.vsi = cr;
            me.store.changed = true;
            me.fireEvent('movetorow', me, start, end, me.store.vsi);
        } else {
            me.store.cr = cr;
            me.cr = cr;
			if (!me.zoomWindow || (me.zoomWindow && !me.zoomWindow.isVisible()))
            me.gridFocus(me.col, cr);
        }
    },
    onGridColumnResize: function(ct, column, width, eOpts) {
        //if (!Ext.isEmpty(column) && !Ext.isEmpty(column.cellWidth)) {
        //if (width - column.cellWidth == 0 || Math.abs(width - column.cellWidth) < 5)
        // return;
        var me = this,
            //grid = column.up('ramcogrid'),
            lastDataWi,
            data = me.getPersonalization() || [];
        if (me) {
            if (!data[column.dataIndex]) {
                data[column.dataIndex] = {
                    wi: (width - column.cellWidth),
                    pa: true
                };
            } else {
                data[column.dataIndex].wi = (width - column.cellWidth);
                data[column.dataIndex].pa = true;
            }
            column.piWidth = width;
            //else
            //  data[column.dataIndex].wi = (width - column.cellWidth);
            me.setPersonalization(data);
        }
        //}
    },
    onGridColumnMove: function(ct, column, fromIdx, toIdx, eOpts) {
        if (!Ext.isEmpty(fromIdx) && !Ext.isEmpty(toIdx)) {
            var me = this,
                //grid = column.up('ramcogrid'),
                data = me.getPersonalization();
            if (me) {
                data.seqChanged = true;
                me.setPersonalization(data);
            }
        }
    },
	onFocusleave:function(grid, event, eOpts){
		var me=this,
			ilbo=me.up('ilbo'),
			pendingEvent = ilbo.pendingEvent;
		if(ilbo.pendingEvent){
			ilbo.pendingEvent=null;
			//pendingEvent.call();
		}
	},
    updateGridSlider: function(sel, prevRecord, record) {
        if (this.updating)
            return;
        var me = this,
            rowNav = me.down('#rowNav');
        gridSlider = me.down('#gridSlider');
        if (gridSlider && record) {
            gridSlider.suspendEvents();
            me.cr = record.get('rn')
            me.store.cr = me.cr;
            gridSlider.setValue(me.cr);
            gridSlider.resumeEvents();
        }
    },
    updateSliderPosition: function(recNo, zoom) {
        if (this.updating)
            return;
        var me = this,
            gridSlider = me.down('#gridSlider'),
            zoomSlider = zoom ? zoom.down('#zoomSlider') : null,
            vr = null,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null;
        if (gridSlider) {
            me.cr = recNo;
            me.store.cr = me.cr;
            vr = (recNo + (me.store.vr / 3)) > me.tr ? me.tr : (recNo + (me.store.vr / 3) - 1);
            if (!zoomSlider && !RamcoRTC.settings.isExt2)//TECH-36970
                gridSlider.suspendEvents();
            gridSlider.setValue(recNo, null, true);
            if (zoomSlider)
                zoomSlider.setValue(recNo, null, true);
            if (rowNav)
                rowNav.setValue(recNo);
            if (dspRow) {
                //dspRow.setHtml('- ' + vr + '/' + me.tr);
				dspRow.update({v:'- ' + parseInt(vr) + '/' + (me.tr)});
			}
            if (!zoomSlider)
                gridSlider.resumeEvents();
        }
    },
    onBeforeCellKeyDown: function(view, td, cellIndex, record, trD, rowIndex, e, eOpts) {
        var me = this,
            visibleRows = me.getVisibleRows(),
			nav = me.getNavigationModel(),
            vsi = (e.keyCode == 33) ? me.store.vsi : me.cr,
            tr = me.tr,
            keyCode = e.keyCode,
            store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            si, ei, len = 0,
            val, vm, column, hasBreak = false,
            trDom = Ext.fly(trD),
			viewBox = me.view.el.getBox(),
			trDBox;
			
        if (trDom)
            trDBox = trDom.getBox();
        
		if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		
		if(me.editingPlugin && me.editingPlugin.editing)
		{
			// TECH-28355
			if (me.editingPlugin.activeEditor &&  me.editingPlugin.activeEditor.field) {
				//var editorXtypes = ["combofield", "datefield", "ramcodatetimefield", "ramcotimefield", "ramcolistedit"];
				var editorXtypes = ["combofield", "ramcolistedit"];
				var fieldXtype = me.editingPlugin.activeEditor.field.xtype;
				if (editorXtypes.indexOf(fieldXtype) > -1) {
					return;
				}
			}
			
			if(e.keyCode == 40 || e.keyCode == 38){
				var col = cellIndex;
				if(view.isNormalView){
					try{
					var columns = me.lockedGrid.getVisibleColumnManager().getColumns();
					var normalViewColumns = me.normalGrid.getVisibleColumnManager().getColumns();
					if(columns)
						col += columns.length;
					}catch(e){
					}
				}
				if(e.keyCode == 40){
					if(view.isNormalView && !Ext.isEmpty(normalViewColumns[cellIndex])) {
						nav.setPosition(rowIndex, normalViewColumns[cellIndex]);
					}
					vsi =  si + rowIndex + 1;
					start = vsi > visibleRows ? vsi - visibleRows : 1;
					end = (visibleRows * 3) + (start - 1);
					if (vsi >= (si + (visibleRows * 3))) {
						me.editingPlugin.completeEdit();
						me.editingPlugin.startEditByPosition({row:rowIndex+2, column:col});	
						me.store.start = start;
						me.store.end = end;
						me.store.vsi = vsi;
						me.store.changed = true;
						me.lastEvent = 'onnext';
						me.fireEvent('movetorow', me, start, end, me.store.vsi, 'down');
						return false;
					}else{
						me.editingPlugin.completeEdit();
						if(vsi >= si + visibleRows)
							me.updateRowNavigation(vsi, "down");
						me.editingPlugin.startEditByPosition({row:rowIndex+1, column:col});	
					}
				}
				if(e.keyCode == 38 && si + rowIndex > 1){
					if(view.isNormalView && !Ext.isEmpty(normalViewColumns[cellIndex])) {
						nav.setPosition(rowIndex, normalViewColumns[cellIndex]);
					}
					vsi = si + rowIndex - 1;
					start = vsi > visibleRows ? vsi - visibleRows : 1;
					end = (visibleRows * 3) + (start - 1);
					if (vsi > 0 && !(vsi >= si && vsi <= ei)) {
						me.store.start = start;
						me.store.end = end;
						me.store.vsi = vsi;
						me.store.changed = true;
						me.lastEvent = 'onnext';
						me.fireEvent('movetorow', me, start, end, me.store.vsi, 'up');
						return false;
					}
					else{
						me.editingPlugin.completeEdit();
						me.editingPlugin.startEditByPosition({row:rowIndex-1, column:col});
						if(viewBox.top == trDBox.top)
							me.updateRowNavigation(vsi, "up");
					}
				}
			}
			return
		}
        var view = me.getView(),
            nav = me.getNavigationModel(),
            pos = nav ? nav.getPosition() : null,
            selModel = view.getSelectionModel(),
            normalGrid = me.normalGrid.getView(),
            lockingPartner = normalGrid.lockingPartner && normalGrid.lockingPartner.grid.isVisible() ? normalGrid.lockingPartner : null,
            columns = me.getVisibleColumnManager().getColumns(),
			lokgr = me.getScrollable(),
			normalScroller = null;
        if (trDom)
            trDBox = trDom.getBox();
        viewBox = view.el.getBox();
		normalScroller = lokgr.getNormalScroller();
        if (keyCode && keyCode > 32 && keyCode < 41) {
            switch (keyCode) {
				case 37: //"LEFT",
					var leftEle;
					leftEle = nav.move("left", e);
                    if (pos && pos.isFirstColumn && pos.isFirstColumn()) {
                        /* if (lockingPartner) {
							if(!pos.column.locked) {								
								if (leftEle) {
									nav.setPosition(leftEle, null, e);
								}
								return;
							} */
							//else
								columns = lockingPartner.getVisibleColumnManager().getColumns();
						//}
                        me.col = columns[columns.length - 1];                    
						vsi = vsi - 1;
						start = vsi > visibleRows ? vsi - visibleRows : 1;
						end = (visibleRows * 3) + (start - 1);
						if ((vsi >= si && vsi <= ei) && viewBox.top == trDBox.top) {
							lokgr.scrollBy(0, -(me.rowHeight + 1));
							lokgr.trackingScrollTop -= (me.rowHeight + 1);
							nav.setPosition(leftEle, null, e);
							selModel.select({
								row: leftEle.rowIdx,
								column: leftEle.colIdx - 1
							});
							normalScroller.trackingScrollTop = lokgr.trackingScrollTop;							
							//me.updateRowPostion(vsi, nav, selModel);
							me.updateRowNavigation(vsi);
							//me.store.vsi = vsi;
							return false;
						}
						if (vsi > 0 && !(vsi >= si && vsi <= ei)) {
							me.store.start = start;
							me.store.end = end;
							me.store.vsi = vsi;
							me.store.changed = true;
							me.lastEvent = 'onnext';
							me.fireEvent('movetorow', me, start, end, me.store.vsi, 'up');
							return false;
						}
					}
                    break;
                case 38: //"UP",
                    vsi = vsi - 1;
                    start = vsi > visibleRows ? vsi - visibleRows : 1;
                    end = (visibleRows * 3) + (start - 1);
                    if ((vsi >= si && vsi <= ei) && viewBox.top == trDBox.top) {
                        lokgr.scrollBy(0, -(me.rowHeight + 1));
						lokgr.trackingScrollTop -= (me.rowHeight + 1);
						normalScroller.trackingScrollTop = lokgr.trackingScrollTop;
                        //me.updateRowPostion(vsi, nav, selModel);
						me.updateRowPostion(vsi, nav, selModel, cellIndex);
                        me.updateRowNavigation(vsi);
						//me.store.vsi = vsi;
                        return false;
                    }
                    if (vsi > 0 && !(vsi >= si && vsi <= ei)) {
                        me.store.start = start;
                        me.store.end = end;
                        me.store.vsi = vsi;
                        me.store.changed = true;
                        me.lastEvent = 'onnext';
                        me.fireEvent('movetorow', me, start, end, me.store.vsi, 'up');
						return false;
                    }
                    break;
				case 39: //"RIGHT",
					var rightEle;
                    vsi = vsi + 1;
					start = vsi > visibleRows ? vsi - visibleRows : 1;
                    end = (visibleRows * 3) + (start - 1);
                    if ((vsi >= si && vsi <= ei) && (trDBox.top + 1) >= (viewBox.bottom - me.rowHeight) && trDBox.top <= viewBox.bottom) {
						if (pos && pos.isLastColumn && pos.isLastColumn() && !pos.column.locked) {
							me.col = 0;							
							lokgr.scrollBy(0, (me.rowHeight + 1));
							lokgr.trackingScrollTop += (me.rowHeight + 1);
							normalScroller.trackingScrollTop = lokgr.trackingScrollTop;
							normalScroller.trackingScrollLeft = 0;
							//me.updateRowPostion(vsi, nav, selModel);
							rightEle = nav.move("right", e);
							if (rightEle) {
								nav.setPosition(rightEle, null, e);
								selModel.select({
									row: rightEle.rowIdx,
									column: rightEle.colIdx - 1
								});
							}
							me.updateRowNavigation(vsi, 'down');							
							return false;
						}
                    }
                    if (vsi <= tr && !(vsi >= si && vsi <= ei)) {
                        me.store.start = start;
                        me.store.end = end;
                        me.store.vsi = vsi;
                        me.store.changed = true;
                        me.lastEvent = 'onnext';
                        me.fireEvent('movetorow', me, start, end, me.store.vsi, 'down');
						return false;
                    }
                    break;
                case 40:
                    vsi = vsi + 1;
                    start = vsi > visibleRows ? vsi - visibleRows : 1;
                    end = (visibleRows * 3) + (start - 1);
                    if ((vsi >= si && vsi <= ei) && (trDBox.top + 1) >= (viewBox.bottom - me.rowHeight) && trDBox.top <= viewBox.bottom) {
                        lokgr.scrollBy(0, (me.rowHeight + 1));
						lokgr.trackingScrollTop += (me.rowHeight + 1);
						normalScroller.trackingScrollTop = lokgr.trackingScrollTop;
                        me.updateRowPostion(vsi, nav, selModel, cellIndex);
                        me.updateRowNavigation(vsi, 'down');
						//me.store.vsi = vsi;
                        return false;
                    }
                    if (vsi <= tr && !(vsi >= si && vsi <= ei)) {
                        me.store.start = start;
                        me.store.end = end;
                        me.store.vsi = vsi;
                        me.store.changed = true;
                        me.lastEvent = 'onnext';
                        me.fireEvent('movetorow', me, start, end, me.store.vsi, 'down');
						return false;
                    }
                    break;
            }
        }
    },
	onBeforeCellClick:function(view, td, cellIndex, record, tr, rowIndex, e, eOpts ) {
		var me=this,
			ilbo = me.up('ilbo');
		if(ilbo.pendingEvent){
			var dataColumnid = tr.getAttribute("data-columnid") || "0"
			me.fireEvent('ctrlfocus', me.itemId , dataColumnid.replace('v', ''), record.get('rn'));
			ilbo.pendingEvent.call();
			ilbo.pendingEvent =null;
			return false;
		}
	},
    updateRowPostion: function(vsi, navModel, selModel) {
        var me = this,
            rowIndex = -1,
            record = me.store.findRecord('rn', vsi);
        if (record)
            rowIndex = me.store.indexOf(record);
        if (rowIndex > -1) {
            navModel.setPosition(rowIndex, me.col, navModel.cell);
            navModel.focusPosition(navModel.getPosition());
			/*if (selModel) {
                selModel.select({
                    row: rowIndex,
					column: cellIndex || me.col
                });
			}*/
        }
    },
    updateRowNavigation: function(vsi, keyNav) {
        var me = this,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
			inFlag = me.insertFlag,
			store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
			totRow = me.tr,
			_vsi = parseInt(vsi,10),
			vr;						
			//totRow = (me.insertFlag && keyNav != "insert") ? me.tr - 1 : me.tr,
			if (lastRecord && lastRecord.get('isNew')) {
				totRow = me.tr - 1;
			}
            //vr = (vsi + (me.store.vr / 3)) > me.tr ? me.tr : (vsi + (me.store.vr / 3) - 1);
			vr = (vsi + (me.visibleRows)) > totRow ? totRow : (vsi + (me.visibleRows) - 1);
        if (rowNav && dspRow) {
			dspRow.suspendLayouts();
			me.vsi = vsi;
			//TECH-37261
			me.store.vsi = vsi;
            if (keyNav && keyNav == 'down') {
                rowNav.setValue((vsi - me.visibleRows) + 1);
                //dspRow.setHtml('- ' + vsi + '/' + (totRow));
				dspRow.update({v:'- ' + (_vsi > totRow?totRow:_vsi) + '/' + (totRow)});
            }
			else if (keyNav && keyNav == 'last') {
                rowNav.setValue((vsi - me.visibleRows) + 1);
                //dspRow.setHtml('- ' + vsi + '/' + (totRow));
				dspRow.update({v:'- ' +(_vsi > totRow?totRow:_vsi) + '/' + (totRow)});
            }
			else if (keyNav && (keyNav == 'onnext' || keyNav == 'onprev')) {
				rowNav.setValue(vsi);
                //dspRow.setHtml('- ' + vr + '/' + (totRow));
				dspRow.update({v:'- ' + parseInt(vr) + '/' + (totRow)});
            }
			else if (keyNav && (keyNav == 'insert')) {
				rowNav.setValue(vsi);                
				dspRow.update({v:'- ' + parseInt(vr + 1) + '/' + (totRow + 1)});
            }
			// AHBG-27296
			else if(!Ext.isEmpty(me.zoomWindow) && !me.zoomWindow.isHidden() && keyNav == 'onlast') {
				rowNav.setValue((vsi - me.visibleRows) + 1);
				dspRow.update({v:'- ' +(_vsi > totRow?totRow:_vsi) + '/' + (totRow)});
			}
			else {
                rowNav.setValue(vsi);
                //dspRow.setHtml('- ' + vr + '/' + (totRow));
				dspRow.update({v:'- ' + parseInt(vr) + '/' + (totRow)});
            }
			if(vsi < 1) {
				rowNav.hide();
				//dspRow.setHtml(rvw_resources.R033);
				dspRow.update({v:rvw_resources.R033});
			}
			dspRow.resumeLayouts();
			if(rowNav.isHidden())
				rowNav.show();
        }
        return false;
    },
    onCellKeyDown: function(view, td, cellIndex, record, tr, rowIndex, e, eOpts) {
		if(this.editingPlugin && this.editingPlugin.editing)
			return;        
        var me = this,
            view = me.getView(),
            nav = me.getNavigationModel(),
            pos = nav ? nav.getPosition() : null,
            visibleRows = me.getVisibleRows(),
            vsi = (e.keyCode == 33) ? me.store.vsi : me.cr,
            tr = me.tr,
            keyCode = e.keyCode,
            store = me.store,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            si,
            ei,
            len = 0,
            val,
            vm,
            ellipse,
            column,
            hasBreak = false,
            normalGrid = me.normalGrid.getView(),
            lockingPartner = normalGrid.lockingPartner && normalGrid.lockingPartner.grid.isVisible() ? normalGrid.lockingPartner : null,
            columns = me.getVisibleColumnManager().getColumns();
        if (keyCode == 113) {
			if (td) {
				var cellIdx = td.getAttribute('data-columnid');
				val = record.get(cellIdx);
				if (!val) {
					vm = me.getVisibleColumnManager();
					if (me.getShowSelection())
						len++;
					if (me.getShowRowNumber())
						len++;
					column = vm.getHeaderAtIndex(cellIndex + len);
					if (column && column.editor)
						return;
					val = record.get(column.dataIndex);
				}
			}
			
            ellipse = Ext.create('Ext.ramco.Ellipse', {
                scrollable: false,
                hidden: true,
                modal: true
            });
            if (RamcoRTC.settings.ellipseSize && Object.keys(RamcoRTC.settings.ellipseSize).length > 0 && parseInt(RamcoRTC.settings.ellipseSize.height) > 0 && parseInt(RamcoRTC.settings.ellipseSize.width) > 0) {//AHBG-26068
				var userWinWidth = parseInt(RamcoRTC.settings.ellipseSize.width, 10),
					userWinHeight = parseInt(RamcoRTC.settings.ellipseSize.height, 10);
                if (userWinWidth > 0) {
					ellipse.maxWidth = (userWinWidth > 500) ? userWinWidth : 500;
                    ellipse.setWidth(userWinWidth);
                    ellipse.ellipseText.setWidth(userWinWidth - 20);
                }
                if (userWinHeight > 0) {
                    ellipse.setHeight(userWinHeight);
                    ellipse.ellipseText.setHeight(userWinHeight >= 110 ? userWinHeight - 50 : 60);
                }
            }
			if (ellipse) {
				if (!me.readOnly && me.xtype != 'ramcolabel' && me.xtype != 'label')
					ellipse.ellipseText.setReadOnly(false);
                var gridObj = me.ownerCt.grid,
					selPos;
                if (gridObj) {
                    selPos = gridObj.getSelectionModel().getCurrentPosition();
                    if (selPos && selPos.columnHeader)
                        ellipse.title = selPos.columnHeader.text;
					ellipse.ellipseText.setReadOnly(true);
                    ellipse.showBy(Ext.fly(me.ownerCt.context.cell));
                } else {
					var ilbo = me.up('ilbo'),
						ilboHeight = ilbo.getSize().height,						
						tdObj = Ext.fly(td),
						tdObjY = tdObj.getXY()[1];
						
					selPos = me.getSelectionModel().getCurrentPosition();
                     if (selPos && selPos.columnHeader) {
						 if (selPos.columnHeader.xtype == 'ramcogridcheck')
							 return;
                        ellipse.title = selPos.columnHeader.text;
						ellipse.ellipseText.setReadOnly(true);
						if (ilboHeight - tdObjY > userWinHeight)
							ellipse.showBy(td, 'tl-bl');
						else {
							ellipse.show();
							ellipse.center();
						}
					}
					else {
						var cellObj = me.getColumnById(cellIdx);
						if (!Ext.isEmpty(cellObj) && cellObj.xtype == 'ramcogridcheck')
							return;
					}
                }
				/* ellipse.body.setHeight(ellipse.body.getHeight() + 20);
				ellipse.setHeight((ellipse.getHeight() < 120) ? ellipse.getHeight() + 20 : 120);
				ellipse.setWidth(ellipse.getWidth() + 20); */
				ellipse.ascCtrl = me;
            	ellipse.ellipseText.setValue(val);				
				ellipse.ellipseText.focus(true);
            }
            return true;
        }
        if (vsi + 1 >= tr || vsi - 1 <= 0)
            return;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (pos) {
            me.col = pos.colIdx;
        }
        if (keyCode && keyCode > 32 && keyCode < 41) {
            switch (keyCode) {
                case 33: //"PAGE_UP",
                    vsi = vsi - visibleRows;
                    if (vsi <= 0)
                        vsi = 1;
                    break;
                case 34: //"PAGE_DOWN",
                    vsi = vsi + visibleRows;
                    if (vsi > tr)
                        vsi = tr;
                    break;
                case 35: //"END",
                    if (e.ctrlKey) {
                        vsi = tr;
                        me.col = columns[columns.length - 1];
                    } else
                        hasBreak = true;
                    break;
                case 36: //"HOME",
                    if (e.ctrlKey) {
                        vsi = 1;
                        if (lockingPartner)
                            columns = lockingPartner.getVisibleColumnManager().getColumns();
                        me.col = columns[0];
                    } else
                        hasBreak = true;
                    break;
                case 37: //"LEFT",
                    if (pos && pos.isFirstColumn && pos.isFirstColumn()) {
                        if (lockingPartner)
                            columns = lockingPartner.getVisibleColumnManager().getColumns();
                        me.col = columns[columns.length - 1];
                    } else
                        hasBreak = true;
                    vsi = vsi - 1;
                    break;
                case 38: //"UP",
                    vsi = vsi - 1;
                    break;
                case 39: //"RIGHT",
                    if (pos && pos.isLastColumn && pos.isLastColumn())
                        me.col = 0;
                    else
                        hasBreak = true;
                    vsi = vsi + 1;
                    break;
                case 40: //"DOWN"
                    vsi = vsi + 1;
                    break;
            }
            if (hasBreak)
                return
            start = vsi > visibleRows ? vsi - visibleRows : 1;
            end = (visibleRows * 3) + (start - 1);
            if (!(vsi >= si && vsi <= ei)) {
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.lastEvent = 'onnext';
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            }
        }
    },
    createDummyRecord: function() {
        var me = this,
            item = null,
            name = null,
            val = null,
			coln = null,
            visibleRows = me.getVisibleRows(),
            autoHeight = me.getAutoHeight(),
            insertFlag = me.getInsertFlag(),
            values = {},
            value = me.rsColumnsValue || me.value.columnsValue || me.lastValue.columnsValue,
            topbar = me.getDockedComponent('gridToolbar'),
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            len = me.store.getRange(),
            colLen = me.getColumns().length,
            column = me.getColumns(),
			scrollbar = me.getDockedComponent('gridScroller'),
			showToolbar = me.getShowToolbar(),
            showScrollBar = me.getShowScrollBar(),
			gridSlider = me.down('#gridSlider'),
            storeAdd = true,
            vr = null;
		//TECH-33701
        if (me.coldef || !Ext.isEmpty(me.dummyRec)) {
            if (me.edited || me.store.getCount() == 0)
                me.tr++;
            me.store.tr = me.tr;
           // vr = (me.vsi + (me.visibleRows / 3)) >= me.tr ? (me.tr - 1) : (me.vsi + (me.visibleRows / 3) - 1);
            values['rn'] = me.tr;
            values['isNew'] = true;
            if (me.dummyRec) {
                //values['coldef'] = true;
                for (item in me.dummyRec) {
                    item = me.dummyRec[item];
					if (item.coldefactive == "false")
						continue;
                    name = item.id;
                    val = item.coldefval || '';
                    if (name)
                        values[name] = val;

                }
                for (coln in value) {
                	if(value[coln].v && Ext.isEmpty(values[coln]))
				      values[coln] = value[coln].v;
				}
                for (i = 0; i < len.length; i++) {
                    if (len[i].data.isNew) {
                        //len[i].data.coldef = true;
                        for (j = 0; j < colLen; j++) {
                            //if (column[j].dataIndex == 'rn' || column[j].dataIndex == 'sel')
                              //  continue;
                            if (!Ext.isEmpty(value[column[j].dataIndex]))
                                len[i].set(column[j].dataIndex, values[column[j].dataIndex]);
                        }
                        storeAdd = false;
                    }
                }
            }
			//TECH-33701
            if (storeAdd &&  Ext.isEmpty(me.colClear)) {
                for (k = 0; k < len.length; k++) {
                    if (len[k].data.rn == values['rn']) {
                        //me.store.remove(len[k]);
                        values.rn = parseInt(values.rn) + 1;
						me.store.tr = me.tr++;
						
                        //storeAdd = true;
                        me.store.add([values]);
                        me.edited = false;

                    }
                }
            }
            rowNav.setMaxValue(me.tr);
            rowNav.setValue(me.vsi);
			rowNav.suspendLayouts();
			dspRow.suspendLayouts();
            if (me.tr > 1) {
				vr = me.tr - 1;
                rowNav.show();
                //dspRow.setHtml('- ' + vr + '/' + (me.tr - 1));
				dspRow.update({v:'- ' + parseInt(vr) + '/' + (me.tr - 1)});
            }
			dspRow.resumeLayouts();
			rowNav.resumeLayouts();
            if (me.edited || me.store.getCount() == 0) {
                me.store.add([values]);
                me.edited = false;
            }
        } 
		else {
            me.tr++;
			me.store.tr = me.tr;
			if(rowNav.getValue() + me.visibleRows > me.tr)
				me.vsi = parseInt((me.tr - 1) / me.visibleRows) * me.visibleRows + 1;
			//vr = (me.vsi + (me.store.vr / 3)) >= me.tr ? (me.tr - 1) : (me.vsi + (me.store.vr / 3) - 1);
			vr = me.vsi + me.visibleRows - 1;
			if(vr > me.tr - 2)
				vr = me.tr - 1;
			values['rn'] = me.tr;
            values['isNew'] = true;
            if (value) {
                for (item in value) {
                    item = value[item];
                    name = item.n;
                    val = item.v || '';
                    if (name)
                        values[name] = val;
                }
            }
            rowNav.suspendLayouts();
            rowNav.setMaxValue(me.tr);
            rowNav.setValue(me.vsi);
            if (me.tr > 1) {
                rowNav.show();
				//dspRow.suspendLayouts();
                //dspRow.setHtml('- ' + parseInt(vr) + '/' + (me.tr - 1));
				dspRow.update({v:'- ' + parseInt(vr) + '/' + (me.tr - 1)});
				//dspRow.resumeLayouts();     
            }
			rowNav.resumeLayouts();
            me.store.add([values]);

			if(me.lastEvent == "insert") // AHBG-25665
				me.gridFocus(me.col, me.tr);
        }
        if (autoHeight) {
            me.suspendEvents();
			me.suspendLayouts();
            if (me.tr < visibleRows) {
                me.setHeight(me.getGridHeight(parseInt(me.tr) + (insertFlag ? 1 : 0)));
            } else {
                me.setHeight(me.getGridHeight(visibleRows));
            }
			me.resumeLayouts();
            me.resumeEvents();
        }
		if (scrollbar && !showToolbar) {
			gridSlider.suspendEvents();
			gridSlider.setMaxValue(me.tr);
			gridSlider.setValue(me.vsi);
			rowNav.setMaxValue(me.tr);
			rowNav.setValue(me.vsi);
			gridSlider.resumeEvents();
			scrollbar.suspendLayouts();
			if (me.tr > visibleRows)
				scrollbar.show();
			else
				scrollbar.hide();
			scrollbar.resumeLayouts();
		}
		if (!me.paginationBar) {
			rowNav.hide();
		}
    },
    onPrevClick:function(){
		var me =this,
			sel = me.getSelectionModel(),
			visibleRows = me.getVisibleRows(),
			cr = sel.selection.rowIdx,
			tr = me.tr,
			store = me.store,
			lastRow = store.count(),
			lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
			start,			
			si,
            ei,
			fField;
		if (cr >= tr)
            return;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		cr = cr - 1;
		start = cr > visibleRows ? cr - visibleRows : 1;
		end = (visibleRows * 3) + (start - 1);
		if (cr < 0) {
			me.store.start = start;
			me.store.end = end;
			me.store.vsi = cr;
			me.store.changed = true;
			me.lastEvent = 'onprev';
			me.fireEvent('movetorow', me, start, end, me.store.vsi);
		} 
		else {
			sel.select({
				row: cr,
				column: 0
			});
		}
		if(me.formItems && me.formItems.items.length > 0) {
			fField = me.formItems.items.getAt(0);
			if (fField) {
				fField.focus(10);
			}
		}
	},
	onNextClick:function(){
		var me = this,
			sel = me.getSelectionModel(),
			visibleRows = me.getVisibleRows(),
			cr = sel.selection.rowIdx,
			tr = me.tr,
			store = me.store,
			lastRow = store.count(),
			lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
			start,
			si,
            ei,
			fField;
		if (cr >= tr)
            return;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		cr = cr + 1;
		start = cr > visibleRows ? cr - visibleRows : 1;
		end = (visibleRows * 3) + (start - 1);
		if(cr < tr) {
			if (!(cr >= si && cr <= ei)) {
				me.store.start = start;
				me.store.end = end;
				me.store.vsi = cr;
				me.store.changed = true;
				me.lastEvent = 'onnext';
				me.fireEvent('movetorow', me, start, end, me.store.vsi);
			}
			else {
				sel.select({
					row: cr,
					column: 0
				});
			}
		}
		if(me.formItems && me.formItems.items.length > 0) {
			fField = me.formItems.items.getAt(0);
			if (fField) {
				fField.focus(10);
			}
		}
	},
    onBtnFirst: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            row,
            si,
            ei,
            offset,
            vsi = store.vsi;
		me.fireEvent('ctrlfocus', me.itemId, 0, 0);	
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi != 1 && tr > 0) {
            store.vsi = vsi = 1;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onfirst';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
				store.changed = true;
            }
        }
    },
    onBtnPrev: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            record = null,
            index = null,
            row,
            si,
            ei,
            offset,
            vsi = store.vsi;
		me.fireEvent('ctrlfocus', me.itemId, 0, 0);	
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		vsi = rowNav.getValue();
        if (vsi != 1 && tr > 0) {
            vsi = vsi - vr;
            store.vsi = vsi;
            if (store.vsi <= 0)
                store.vsi = vsi = 1;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onprev';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.si = si;
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
				store.changed = true;
            }
        }
    },
    onRowNumSet: function(field, evt, eOpts) {
		if(evt.keyCode == evt.ENTER) {
			this.onMoveRowNum(parseInt(field.getValue()) || 0, evt, eOpts);
		}
	},
	onMoveRowNum: function(num, evt, eOpts) {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
			//num = parseInt(field.getValue()) || 0,
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            //TECH-29873
			//firstRecord = num ? store.getAt(num - 1) : store.getAt(0),
			firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            row,
            si,
            ei,
            offset,
            vsi = num;
		if(evt && evt.keyCode == evt.ENTER) {
			// TECH-32997
			/* if (lastRecord && lastRecord.get('isNew')) {
				if (lastRow > 1)
					lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
				else
					lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
			} */
			if (firstRecord && lastRecord) {
				si = firstRecord.get('rn');
				ei = lastRecord.get('rn');
			}
				//if (vsi < tr) {
			//TECH-29873		
			//if (rowNav.getValue() < tr) {
			if (rowNav.getValue() <= tr) {
				store.vsi = vsi;
				if (store.vsi > tr)
					store.vsi = tr;
				start = vsi;
				end = (vr * 3) + (start - 1);
				//TECH-29873
				if (Math.floor((ei - si) / vr) > 1) {
					ei -=vr;
				}
				me.lastEvent = 'onnext';
				if (!(vsi >= si && vsi <= ei)) {
					me.store.start = start;
					me.store.end = end;
					me.store.vsi = vsi;
					me.store.cr = (start - vr);
					me.store.changed = true;
					me.fireEvent('movetorow', me, start, end, me.store.vsi);
				} 
				else {
					me.gridFocus(me.col, store.vsi);
				}
			}
		}    
    },
	onInboxBtnPrev: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,            
            si,
            ei,
            vsi = store.vsi;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (vsi != 0 && tr > 0) {
            //vsi = vsi - vr;
            store.vsi = vsi;
            if (store.vsi <= 0)
                store.vsi = vsi = 1;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onprev';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.si = si;
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
            }
        }
    },
	onInboxBtnNext: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            si, ei, 
			vsi = store.vsi;
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        //vsi = vsi + vr;        
        if (vsi - 1 < tr) {
            store.vsi = vsi;
            if (store.vsi > tr)
                store.vsi = tr;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onnext';
            if (!(vsi >= si && vsi <= ei)) {
                me.store.si = si;
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
            }
        }
    },
    onBtnNext: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            row,
            si,
            ei,
            offset,
            vsi = store.vsi;
		me.fireEvent('ctrlfocus', me.itemId, 0, 0);	
		// TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        vsi = rowNav.getValue() + vr;
        if (vsi - 1 < tr) {
            store.vsi = vsi;
            if (store.vsi > tr)
                store.vsi = tr;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onnext';
            if (!(vsi >= si && (vsi + vr - 1) <= ei) && Ext.isEmpty(lastRecord.data.isNew)) {
                me.store.si = si;
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
				store.changed = true;
            }
        }
    },
    onBtnLast: function() {
        var me = this,
            store = me.getStore(),
            vr = me.getVisibleRows(),
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            topbar = me.getDockedComponent('gridToolbar'),
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowHeight = me.rowHeight,
            sel = me.getSelectionModel(),
            row,
            si,
            ei,
            offset,
            vsi = store.vsi;
		me.fireEvent('ctrlfocus', me.itemId, 0, 0);	
        // TECH-32997
		/* if (lastRecord && lastRecord.get('isNew')) {
            if (lastRow > 1)
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 2) : null;
            else
                lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null;
        } */
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        vsi = tr - vr + 1;
        //TECH-32075
		//if (vsi != 1 && tr > 0) {
		if (vsi > 0 && vsi != 1 && tr > 0) {
            store.vsi = vsi;
            if (store.vsi <= 0)
                store.vsi = 1;
            start = vsi > vr ? vsi - vr : 1;
            end = (vr * 3) + (start - 1);
            me.lastEvent = 'onlast';
            if (!(vsi >= si && vsi <= ei) || ei != tr) {
                me.store.start = start;
                me.store.end = end;
                me.store.vsi = vsi;
                me.store.changed = true;
                me.fireEvent('movetorow', me, start, end, me.store.vsi);
            } else {
                me.gridFocus(me.col, store.vsi);
				store.changed = true;
            }
        }
    },
    onBtnUp: function() {
        var me = this,
            scrollbar = me.getDockedComponent('gridScroller'),
            //visibleRows = me.getVisibleRows(),
			//gridToolbar = me.getDockedComponent('gridToolbar'),
			//rowNav = gridToolbar.getComponent('rowNav'),
            gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null;
		if (gridSlider) {
			gridSlider.sliderNav = 'up';
			me.onBtnPrev();
            /*var value = gridSlider.getValue(),
                min = gridSlider.minValue;
            if (value != min) {
				value = rowNav.getValue()-visibleRows;*/
                /* if (value > min + visibleRows) {
                    value = value - visibleRows;
                } else {
                    value = min;
                } */
                /*gridSlider.sliderNav = 'up';
                gridSlider.setValue(value, false, true);
            }*/
        }
    },
    onBtnDown: function() {
        var me = this,
            scrollbar = me.getDockedComponent('gridScroller'),
			//gridToolbar = me.getDockedComponent('gridToolbar'),
			//rowNav = gridToolbar.getComponent('rowNav'),
            //visibleRows = me.getVisibleRows(),
            gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null;
		if (gridSlider) {
			 gridSlider.sliderNav = 'down';
			 me.onBtnNext();
            /*var value = gridSlider.getValue(),
                max = gridSlider.maxValue;
            if (value != max) {
				 value = rowNav.getValue()+visibleRows;*/
                /*  if (value < (max - visibleRows)) {
                    value = value + visibleRows;
                } else {
                    value = max;
                } */
                /*gridSlider.sliderNav = 'down';
                gridSlider.setValue(value, false, true);*/
        }
    },
    onInsert: function(btn, e, obj) {
        var me = this,
            store = me.store,
            record = store.getAt(store.getCount() - 1),
            //cr = store.tr + 1,
			cr = null,
            tr = store.tr,
			view = me.up('ilbo'),
            visibleRows = me.getVisibleRows(),
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            //start = cr > visibleRows ? cr - visibleRows : 1,
			start = null,
            //end = (visibleRows * 3) + (start - 1),
			end = null,
			topbar = me.getDockedComponent('gridToolbar'),
			rowNav = topbar ? topbar.getComponent('rowNav') : null,
            si, ei, vsi;
        me.lastEvent = 'insert';
		vsi = rowNav.getValue();
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (record.get('isNew')) {
			//if (e && e.shiftKey === true)
				//record.set('isNew', false);
            //me.onBtnNext();
			//me.tr++;
            me.gridFocus(me.col, me.tr);
        } else {
			cr = store.tr + 1;
			start = cr > visibleRows ? cr - visibleRows : 1;
			end = (visibleRows * 3) + (start - 1);
            if (!(cr >= si && cr <= ei)) {
                me.store.start = me.tr - (me.visibleRows * 3) + 1;
                me.store.end = me.tr;
                me.store.cr = me.tr + 1;
                //me.store.vsi = me.store.cr - (me.visibleRows - 1);
				//AHBG-25665
				//me.store.vsi = me.store.cr;
				me.store.vsi = me.store.cr - (me.tr % me.visibleRows);
                me.store.changed = true;
				var insertCallBack = function() {
					var newRec = null;
					this.taskPending = true;
					// AHBG-25802
					// this.createDummyRecord();
					newRec = this.store.getAt(this.store.getCount() - 1);
					newRec.data.isNew = false;
					this.fireEvent('insert',this);
					return;
				};
				view.callBack = insertCallBack.bind(me);				
                view.fireEvent('trans', view, [], 'tskdummy', 'trans');
				//me.fireEvent('movetorow', me, start, end, me.store.vsi);
				//me.fireEvent('insert', me, start, end, me.store.vsi);
				//this.fireEvent('insert',this);
            } else {
                this.createDummyRecord();
                me.setCurrentRow();
            }
        }
        //this.fireEvent('insert',this);
    },
    onDelete: function(btn, e, obj) {		
        this.fireEvent('deleterow', this);
    },
    deleteAll: function() {
        var me = this,
            callBack = me.selectAllCallback.bind(me);
        me.fireEvent('selectall', me, null, true, callBack);
    },
    selectAllCallback: function() {
        this.fireEvent('deleterow', this);
    },
    onCutAppendRow: function(btn, e, obj) {		
        this.fireEvent('cutappend', this);
    },
    onBtnExpReport: function() {		
        this.fireEvent('exportreport', this);
    },
    onBtnExpChart: function() {		
        this.fireEvent('exportchart', this);
    },
    onCopyAppendRow: function(btn, e, obj) {		
        this.fireEvent('copyappend', this);
    },
    onColumnDefault: function(btn, e, obj) {		
        this.fireEvent('columndefault', this);
    },
    onColumnClearDefault: function(btn, e, obj) {		
        this.fireEvent('columncleardefault', this);
    },
	onColumnFilter: function(btn, e, obj) {		
        this.fireEvent('columnfilter', this);
    },
	onMlExpand: function(btn, e, obj) {
		this.isMlExpand = true;		
		this.fireEvent('mlExpand', this);
	},	
	onGroupingBtn: function(btn, e, obj) {		
		this.fireEvent('ctrlfocus', this.itemId, 0, 0);
	},
	onbtnExportBtn: function(btn, e, obj) {
		this.fireEvent('ctrlfocus', this.itemId, 0, 0);
	},
    onColumnClearFilter: function(btn, e, obj) {		
		this.fireEvent('columnclearfilter', this);
    },
    onshowPDF: function(btn, e, obj) {
        this.fireEvent('exportpdf', this);
    },
    onshowCSV: function(btn, e, obj) {
        this.fireEvent('exportcsv', this);
    },
    onshowExcel: function(btn, e, obj) {		
        this.fireEvent('exportexcel', this);
    },
    onViewall: function(btn, e, obj) {
        this.fireEvent('exporthtml', this);
    },
    onSavePers: function() {
        var me = this,
            data = me.getPersonalization(),
            column;
        for (key in data) {
            if (key.indexOf('v') == 0) {
                if (data[key].pa == true) {
                    column = me.getColumnById(key);
                    // TECH-37120 / LSBE-27
                    //data[key].wi = column.piWidth - column.cellWidth;
					// TECH-38215
					if (!column.oldWidth)
						column.oldWidth = column.cellWidth;
                    data[key].wi = Math.ceil(column.piWidth - column.cellWidth);
                    column.cellWidth = column.piWidth;
                }
            }
        }
        me.fireEvent('savepers', me, data);
        for (key in data) {
            if (key.indexOf('v') == 0) {
                data[key].pa = false;
            }
        }
        me.setPersonalization(data);
    },
    onRemovePers: function() {
        this.fireEvent('removepers', this);
    },
    onColumnChoose: function() {
        this.fireEvent('colchoose', this);
    },
	onMultiSort: function() {
        if (this.taskPending)
            return;
        var me = this,
            gridId = me.getItemId(),
			cols = me.getColumns(),
			colArray = [],
			sortColArray = [],
			view = me.up('ilbo'), // TECH-29531
			gridCtrlViews, data, workArea, ilbo = view.ilboConfig.ilboName, // TECH-28159 / TECH-26959 // TECH-29531
			controller; // TECH-29276
			
		for (var j = 0; j < cols.length; j++) {
			if (cols[j].dataIndex != 'rn' && cols[j].dataIndex != 'sel' && !cols[j].hidden) {
				// TECH-28159 / TECH-26959
				// colArray.push({'view': cols[j].dataIndex,'colname' : cols[j].text, 'asc' : '0', 'desc' : '1'});
				colArray.push({'view': cols[j].dataIndex,'colname' : cols[j].text, 'asc' : cols[j].asc !== undefined ? cols[j].asc == "1" ? cols[j].asc : "0" : "0", 'desc' : cols[j].desc !== undefined ? cols[j].desc == "1" ? cols[j].desc : "0" : "1"});
			}
		}
		
		// TECH-28159 / TECH-26959
		/*if (RamcoRTC.lastFocusCtrl && RamcoRTC.lastFocusCtrl[1] == gridId && RamcoRTC.lastFocusCtrl[2]) {
			gridCtrlViews = RamcoRTC.lastFocusCtrl[2];
			for (var k = 0; k < gridCtrlViews.length; k++) {
				for (var m = 0; m < colArray.length; m++) {
					if ('v' + gridCtrlViews[k].view == colArray[m].view) {
						data = colArray.splice(m,1);
						sortColArray = sortColArray.concat(data);
						break;
					}
				}
			}
		}*/

		// TECH-28159 / TECH-26959
		workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
		// TECH-29531
		// ilbo =  getCurrentPage().ilboConfig.ilboName;
		// TECH-29276
		controller = getMainController();
		// if (RamcoRTC.multiSortGridData && RamcoRTC.multiSortGridData[workArea] && RamcoRTC.multiSortGridData[workArea][ilbo] && RamcoRTC.multiSortGridData[workArea][ilbo][gridId]) {
		//	gridCtrlViews = RamcoRTC.multiSortGridData[workArea][ilbo][gridId][1];
		if(controller && controller.multiSortGridData && controller.multiSortGridData[workArea] && controller.multiSortGridData[workArea][ilbo] && controller.multiSortGridData[workArea][ilbo][gridId]) {
			gridCtrlViews = controller.multiSortGridData[workArea][ilbo][gridId][1];
			for (var k = 0; k < gridCtrlViews.length; k++) {
				for (var m = 0; m < colArray.length; m++) {
					if ('v' + gridCtrlViews[k].view == colArray[m].view) {
						if(gridCtrlViews[k].so == "0") {
							colArray[m].asc = "0"; colArray[m].desc = "1";
						} else {
							colArray[m].desc = "0"; colArray[m].asc = "1";
						}
						data = colArray.splice(m,1);
						sortColArray = sortColArray.concat(data);
						break;
					}
				}
			}
		}
		
		// TECH-34273
		var gridCtrl = me;
		if (me.multiSortWindow) {
			me.multiSortWindow.setGridColumns(gridCtrl, colArray, sortColArray);
			/* me.multiSortWindow.destroy();
			me.multiSortWindow = null;
			delete me.multiSortWindow; */
		}
		else {
		
			// TECH-34273
			me.multiSortWindow = Ext.create('Ext.ramco.Multisort', {
				itemId: gridId + '_multisort',
				colGridColumns: colArray,
				gridObj: gridCtrl,
				sortGridColumns: sortColArray,			
				parentGridId: gridId
			});
			
			me.multiSortWindow.show();
		}
    },
	onClearMultiSort: function() {
        var me = this,
			gridId = me.getItemId(),
			// TECH-28159 / TECH-26959
			//data = me.multiSortData,
			workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default",
			// ilbo =  getCurrentPage().ilboConfig.ilboName, // TECH-29531
			// TECH-29276
			mainController = getMainController(),
			view = me.up('ilbo'),
			ilbo =  view.ilboConfig.ilboName, // TECH-29531
			//data = (RamcoRTC.multiSortGridData[workArea] && RamcoRTC.multiSortGridData[workArea][ilbo] && RamcoRTC.multiSortGridData[workArea][ilbo][gridId]) ? RamcoRTC.multiSortGridData[workArea][ilbo][gridId][1] : null,
			data = (mainController && mainController.multiSortGridData && mainController.multiSortGridData[workArea] && mainController.multiSortGridData[workArea][ilbo] && mainController.multiSortGridData[workArea][ilbo][gridId]) ? mainController.multiSortGridData[workArea][ilbo][gridId][1] : null,
			controller = (view) ? view.getController() : null;
		if (controller && controller.taskPending == false && data) {
			for (var j = 0; j < data.length; j++)
				data[j].so = '-1';
			// TECH-28159 / TECH-26959
			// view.fireEvent('multisort', view, 'tskstdsort', 'multisort', gridId, data);
			view.fireEvent('multisort', view, 'tskstdsort', 'multisort', gridId, data, 'clear');
			me.multiSortData = null;
			delete me.multiSortData;
			//RamcoRTC.lastFocusCtrl = null;
		}
		// AHBG-31969
		var toolbar =  me.getDockedComponent('gridToolbar'),
			multiSortObj = toolbar && toolbar.getComponent('clearMultiSort');
		if (multiSortObj)
			multiSortObj.setDisabled(true);
    },
    onImportExcel: function() {
		var me = this;
		me.fireEvent('ctrlfocus', me.itemId, 0, 0);
		me.importWindow = Ext.create('Ext.ramco.Import', {
			height: 200,
			width: 400,
			scrollable: true,
			hidden: true,
			modal: true
		});
		me.importWindow.BtnImport.on('click', me.onBtnImportClick, me);
		me.importWindow.BtnValidate.on('click', me.onBtnValidateClick, me);		
        this.importWindow.show();
        this.importWindow.showMessage('');
    },
	onBtnValidateClick: function(btn, eOpts) {
		var me = this,
            fields = null,
            formData = new FormData(),
            impWindow = me.importWindow;
        fields = impWindow.form.getForm().getFields();
		if(fields && fields.items && fields.items.length > 0) {
			var len = fields.items.length,
				i = 0,
				element = null;
			for(; i < len; i++) {
				element = fields.items[i];
				element.clearOnSubmit = false;
				formData.append(element.getItemId(), element.getValue());
				// TECH-30180
				//if (typeof element.extractFileInput == 'function') {
				// TECH-32997 / LBC-445
				if (element.button && element.button.fileInputEl) {
					//element.clearOnSubmit = true;
					// Import Format - Settings based
					//var fileInput = element.extractFileInput(),
					var fileInput = element.button.fileInputEl.dom,
						j = 0, fileName, fileExtension, fileObj, errorText, acceptFormat = (!Ext.isEmpty(RamcoRTC.settings.importAcceptFormats)) ? RamcoRTC.settings.importAcceptFormats : ["csv", "txt", "xlsm"];
					if (fileInput) {
						for (; j < fileInput.files.length; j++) {
							//formData.append('file', fileInput.files[j]);
							fileObj = fileInput.files[j];
							if (fileObj) {
								fileName = (fileObj.name) ? fileObj.name.split('.') : null;
								if (fileName) {
									fileExtension = fileName[fileName.length - 1];				
									if (fileExtension && acceptFormat.indexOf(fileExtension) < 0) {
										errorText = Ext.String.format('Invalid file to import. Allowed file types are: "<b>{0}</b>"', acceptFormat);
										Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
										return false;
									}
								}
								formData.append('file', fileInput.files[j]);
							}
						}
					}
				}
			}
		}
		//);
        me.fireEvent('validatefile', me, formData);
		btn.setDisabled(true);
	},
    onBtnImportClick: function() {
        var me = this,
            fields = null,
			view = me.up('ilbo'),
			formDataObj = {},
            formData = new FormData(),
            impWindow = me.importWindow;
        fields = impWindow.form.getForm().getFields();
		if(fields && fields.items && fields.items.length > 0) {
			var len = fields.items.length,
				i = 0,
				element = null;
			for(; i < len; i++) {
				element = fields.items[i];
				//fields.items.forEach(function(element, index, array) {
				//formData.append(element.getItemId(), element.getValue());
				formDataObj[element.getItemId()] = element.getValue();
				// TECH-30180
				//if (typeof element.extractFileInput == 'function') {
				// TECH-32997 / LBC-445
				if (element.button && element.button.fileInputEl) {
					element.clearOnSubmit = true;
					// Import Format - Settings based
					//var fileInput = element.extractFileInput(),
					var fileInput = element.button.fileInputEl.dom,
						j = 0, fileName, fileExtension, fileObj, errorText, acceptFormat = (!Ext.isEmpty(RamcoRTC.settings.importAcceptFormats)) ? RamcoRTC.settings.importAcceptFormats : ["csv", "txt", "xlsm"];
					if (fileInput) {
						for (; j < fileInput.files.length; j++) {
							//formData.append('file', fileInput.files[j]);
							fileObj = fileInput.files[j];
							if (fileObj) {
								fileName = (fileObj.name) ? fileObj.name.split('.') : null;
								if (fileName) {
									fileExtension = fileName[fileName.length - 1];				
									if (fileExtension && acceptFormat.indexOf(fileExtension) < 0) {
										errorText = Ext.String.format('Invalid file to import. Allowed file types are: "<b>{0}</b>"', acceptFormat);
										Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
										return false;
									}
								}								
								formDataObj['file'] = fileInput.files[j];
							}
						}
					}
				}
			}
		}
		//);
		
		// TECH-30180
		if (!Ext.isEmpty(formDataObj['file'])) {
			if (impWindow && impWindow.file && (impWindow.file.indexOf(".csv") > -1 || impWindow.file.indexOf(".txt") > -1))		
				me.fireEvent('importcsv', me, formDataObj);
			else
				me.fireEvent('importexcel', me, formDataObj);
			if (me.isMlExpand === true) {
				view.mlExpandWin.expGrid.store.reload();
			}
		}
    },
    getGridExportData: function(type, id, act, ilbo, exptype) {
        var me = this,
            columns = me.getColumns(),
            column, columnValue, xmlData, width, colMandatory = "true", // AHBG-27164
            data = me.getValue(), encodedText, expheadertext, panelObj; // AHBG-31972
		
		// AHBG-31972
		if (!Ext.isEmpty(exptype)) {
			panelObj = me.up('ramcopanel');
			if (panelObj && panelObj.title) {
				if (exptype == 'pdf' || exptype == 'html')
					expheadertext = 'Search Results';
				else if (exptype == 'report' || exptype == 'chart')
					expheadertext = panelObj.title;
			}
		}
        data.columnsValue = me.rsColumnsValue;
        if (type == 'pdf') {
            //xmlData = '<gd ac="' + act + '" ic="' + ilbo + '" tc="">';
			//xmlData += '<c n="' + id + '" c="" ct="RSGrid" sl="true" st="0" ><vi>';
			xw = new XMLWriter('UTF-8');
			xw.writeStartDocument();
			xw.writeStartElement('gd');
				xw.writeAttributeString("ac", act);
				xw.writeAttributeString("ic", ilbo);
				xw.writeAttributeString("tc", "");
			xw.writeStartElement('c');
				xw.writeAttributeString("n", id);
				xw.writeAttributeString("c", expheadertext); // AHBG-31972
				xw.writeAttributeString("ct", "RSGrid");
				xw.writeAttributeString("sl", "true");
				xw.writeAttributeString("st",  "0");					
			xw.writeStartElement('vi');
            for (key in columns) {
                column = columns[key];
                width = (column.width > column.minWidth) ? column.width : column.minWidth;
                columnValue = data.columnsValue[column.dataIndex];
                if (column.xtype == "ramcotemplatecolumn" || column.xtype == "fileattachcolumn" || column.xtype == "attachcolumn" || column.xtype == "deletecolumn" || column.xtype == "imagecolumn" || column.hidden == true)
                    continue;
                if (column && columnValue) {
					encodedText = Ext.htmlEncode(column.text) || column.text;
                    //xmlData += '<vw n="' + column.name + '" vt="' + columnValue.vt + '" ht="' + encodedText + '" dt="' + columnValue.dt + '" ml="' + column.maxLength + '" dl="" w="' + width + '"/>'
					xw.writeStartElement('vw');
						xw.writeAttributeString("n", column.name);
						xw.writeAttributeString("vt", columnValue.vt);
						xw.writeAttributeString("ht", encodedText);
						xw.writeAttributeString("dt", columnValue.dt);
						xw.writeAttributeString("ml",  column.maxLength);
						xw.writeAttributeString("dl", (columnValue.dt == "numeric")?column.format:"");//TECH-29515
						xw.writeAttributeString("w", width);							
					xw.writeEndElement();
                }
            }
            //xmlData += '</vi></c></gd>';
			xw.writeEndElement();
			xw.writeEndElement();
			xw.writeEndElement();
			xmlData = xw.flush();
			xw.close();		
        } else {
			//xmlData = '<trqi><vi df="'+ me.deleteFlag +'">';
			xw = new XMLWriter('UTF-8');
			xw.writeStartDocument();
			xw.writeStartElement('trqi');
			xw.writeStartElement('vi');
				xw.writeAttributeString("df", me.deleteFlag);			           
            for (key in columns) {
                column = columns[key];
                width = (column.width > column.minWidth) ? column.width : column.minWidth;
                columnValue = data.columnsValue[column.dataIndex];
				// TECH-39330
				if (column.xtype == "ramcotemplatecolumn" || column.xtype == "fileattachcolumn" || column.xtype == "attachcolumn" || column.xtype == "deletecolumn" || column.xtype == "imagecolumn" || column.hidden == true)
	                continue;
				if (column && columnValue) {
					encodedText = Ext.htmlEncode(column.text) || column.text;
					//xmlData += '<vw n="' + column.name + '" vt="' + columnValue.vt + '" c="' + encodedText + '" dt="' + columnValue.dt + '" ml="' + column.maxLength + '" dl="" w="' + width + '" h="auto" m="true"/>'
					xw.writeStartElement('vw');
					xw.writeAttributeString("n", column.name);
					xw.writeAttributeString("vt", columnValue.vt);
					xw.writeAttributeString("c", encodedText);
					xw.writeAttributeString("dt", columnValue.dt);
					xw.writeAttributeString("ml",  column.maxLength);
					xw.writeAttributeString("dl", (columnValue.dt == "numeric")?column.format:"");//TECH-29515
					xw.writeAttributeString("w", width);
					xw.writeAttributeString("h", "auto");
					// AHBG-27164
					// xw.writeAttributeString("m", "true");
					colMandatory = (column.mandatory?"true":"false");
					xw.writeAttributeString("m", colMandatory);
					/* TECH-32817 / TECH-32371 - List Edit & Sync View - Export Excel Handling */
					var editor = column.editor,
						lvsArray = editor && editor.columns,
						lvsVal = [];
					// TECH-40133
					if (column.customListEdit != true && editor && editor.xtype == 'ramcolistedit') {
						for (var m = 0; m < lvsArray.length; m++) {
							lvsVal.push(lvsArray[m].itemId);
						}
						xw.writeAttributeString("lvs", lvsVal.join(';'));
						xw.writeAttributeString("sc", editor.searchView);
						xw.writeAttributeString("sd", editor.mappedView.join(';'));
						xw.writeAttributeString("dc", editor.mapCtrl.join(';'));
					}
					xw.writeEndElement();
				}
            }
			//xmlData += '</vi></trqi>';
			xw.writeEndElement();
			xw.writeEndElement();
			xmlData = xw.flush();
			xw.close();			
        }
        return xmlData;
    },
    processViews: function(views, hcols) {
    	try {
			var me = this,
				len = 0,
				colWidth = 0,
				colArr = [], index = 0, j = 0, column,
				colObj, columns = me.getColumns(),
				colunmManager = me.getColumnManager();
				
			if (views) {
				len = views.length;
				for (; j < len; j++) {
					colObj = views[j];
					column = colunmManager.getHeaderByDataIndex(colObj.id);
					if (column) {
						if (!Ext.isEmpty(colObj.text))
							column.setText(colObj.text);
						if (!Ext.isEmpty(colObj.width)) {
							colWidth = column.getWidth() + parseInt(colObj.width)
							column.setWidth(colWidth);
							column.viewProcessed = true;
						}
					}
				}
			}
			else if (hcols) {
				len = hcols.length;
				for (; j < len; j++) {
					column = colunmManager.getHeaderByDataIndex(hcols[j]);
					if (column){
						column.hide();
						column.isStateHidden = true;//TECH-28696 / TECH-29031
					}
				}
			}
		}
		catch(ex) {}
    },
    processOrder: function(views,values) {
        var me = this,
			len = 0,
            colArr = [],
            index = 0,
            i = 0,
            gridValue = values?values:me.getValue(),
            columnConfig = gridValue && gridValue.columnsValue ? gridValue.columnsValue:null,
            columns = me.initialConfig.columns,
            column, colCfg,
            colManager = me.getColumnManager(),
			colObj = [], objArr = [], viewColArray;
        if (colManager.getHeaderByDataIndex('rn')) {
            index = colManager.getHeaderIndex(colManager.getHeaderByDataIndex('rn'))
            colArr.push(columns[index]);
        }
        if (colManager.getHeaderByDataIndex('sel')) {
            index = colManager.getHeaderIndex(colManager.getHeaderByDataIndex('sel'))
            colArr.push(columns[index]);
        }
		len = columns.length;
		viewColArray = views.join(',');
		// TECH-35534 / TECH-35642 / TECH-35619 / TECH-35651
		var colCell, colCellWidth, j = 0;		
		for (; j < len; j++) {
			colCell = colManager.getHeaderByDataIndex(columns[j].dataIndex);
			if (!Ext.isEmpty(colCell)) {
				if (colCell.cellWidth) {
					colCellWidth = colCell.cellWidth;
					//columns[j].width = columns[j].cellWidth = colCellWidth;
					columns[j].width = columns[j].cellWidth = colCellWidth;//TECH-38101 / PTP-183
						// TECH-38195 / TECH-38215
						if (colCell.oldWidth)
							columns[j].oldWidth = colCell.oldWidth;
						delete colCell.cellWidth;
						//if(colCell[j] && colCell[j].cellWidth)
					//delete columns[j].cellWidth;
				}
				// TECH-35928
				if (colCell.hidden == true || colCell.isStateHidden == true)
					columns[j].hidden = true;
				// TECH-39427
				if (!Ext.isEmpty(colCell.initVisibleState))
					columns[j].initVisibleState = colCell.initVisibleState;
			}
		}
		
		for (j = 0; j < len; j++) {
			if (columns[j].dataIndex != 'sel' && columns[j].dataIndex != 'rn' && viewColArray.indexOf(columns[j].dataIndex) < 0 && !columns[j].hidden) {				
				objArr.push(columns[j].dataIndex);
			}
		}
		if (objArr.length > 0)
			views = views.concat(objArr);		
		viewColArray = views.join(',');
		len = views.length;
        for (; i < len; i++) {
			index = me.getAllColumnIndex(views[i]);
			column = columns[index];
			if (!column)
				continue;
			if ((column.dataIndex != 'sel' && column.dataIndex != 'rn') && viewColArray.indexOf(column.dataIndex) < 0) {
				if (!column.hidden) {
					colObj.push(column);
					continue;
				}
			}
			else {
				if(columnConfig){
					// TECH-35928
					//if (!column.hidden) {
					colCfg = columnConfig[column.itemId];
					if(colCfg) {
						column.locked = false;
						column.format = colCfg.ft;
						if (!Ext.isEmpty(colCfg.css))
							column.style = colCfg.css;
						if (!Ext.isEmpty(colCfg.scc))
							column.text = colCfg.scc;
					}
					colArr.push(column);
					//}
				}
			}
        }		
		if (colObj && colObj.length > 0)
			colArr = colArr.concat(colObj);
        me.setColumns(colArr);
    },
    processState: function(views) {
        var me = this,
            topbar = me.getDockedComponent('gridToolbar'),
            scrollbar = me.getDockedComponent('gridScroller'),
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            colunmManager = me.getColumnManager(),
            showScrollBar = me.getShowScrollBar(),
            insertFlag = me.getInsertFlag(),
            newNoOfRows = me.getVisibleRows(),
            element1,
            gridView,
            column,
            oColumn,
            width = 0,
            colWidth = 0,
            forceFit = me.columnFit,
            nGridView,
			vP='',
            persData = [];
        view = me.getView();
        me.coldef = false;
        nGridView = view.normalGrid ? view.normalGrid.view : view;
        me.suspendEvents();
        for (element1 in views) {
            gridView = views[element1];
			vP = me.getAllColumnIndex(gridView.id);
			/* persData.push({
				vid:gridView.id,
				p: vP,
				wi: gridView.width,
				pa: false,
				ch:true
			}); */
            if (!persData[gridView.id]) {
                persData[gridView.id] = {
                    vid:gridView.id,
					p: vP,
                    wi: gridView.width,
                    pa: false,
                    ch:true
                };
            }
            column = colunmManager.getHeaderByDataIndex(gridView.id);
            if (gridView.coldefactive == "true")
                me.coldef = true;
            if (column) {
                if (gridView.text) {
                    column.setText(gridView.text);
                }
				// TECH-32964 - PFP-60
				if(column.initialConfig && column.initialConfig.hidden)
					column.isStateHidden = true;
                if (!Ext.isEmpty(gridView.visible)) {
					// TECH-35534 / TECH-35642 / TECH-35619 / TECH-35651
                    if (gridView.visible == 'n' && column.isVisible()) {
                        column.hide();
                    }
                    if (gridView.visible == 'y' && column.isHidden()) {
                        column.show();
                    }
					//TECH-28696 / TECH-29031
					// TECH-32964 - PFP-60
					if (Ext.isEmpty(gridView.st) || gridView.st == '0' || gridView.st == '2') {
						if(gridView.visible == "y")
							column.isStateHidden = false;
						else
							column.isStateHidden = true;
                    }
					if(me.formFields) {
						var fField = '';													
						fField = me.formItems.getComponent(column.dataName)								
						if(fField) {
							if (gridView.visible == 'n') {
								fField.hide();
							}
							else {
								fField.show();
							}
						}
					}
                }
				// TECH-32876				
				/* if (gridView.enable == 'y')
					column.enable();
				else if(gridView.enable == 'n')
					column.disable(); */				
				if (gridView.enable == 'y')
					column.stateEnabled = true;
				else if(gridView.enable == 'n')
					column.stateEnabled = false;
				
                if (!Ext.isEmpty(gridView.width) && column.rendered) {
                    if (!column.oldWidth)
                        colWidth = column.oldWidth = column.getWidth();
                    else
                        colWidth = column.oldWidth;
                    gridView.width = parseInt(gridView.width);
                    if (!isNaN(gridView.width) && !column.viewProcessed) {
                        column.setWidth(colWidth + gridView.width);
                        column.hasPer = true;
                        column.cellWidth = (colWidth + gridView.width);
                    }
                }
                if (!Ext.isEmpty(gridView.choose)) {
                    if (gridView.choose == '0')
                        column.hide();
                    else
                        column.show();
                }
            }
        }
        me.resumeEvents();
        me.setPersonalization(persData);
        if (nGridView.rendered) {
            me.onViewResize(nGridView);
        }
        /* UPDATING GRID SEARCH COMBO - ON PERFORMING COLUMN CHOOSER OPTION */
		//TECH-30033
		var cols = me.getVisibleColumnManager().getColumns(),
			gridSearchData = [{ vid: 'v0', name: rvw_resources.R007 }],
			selVal = fieldList.getValue(), found =  false;
		if (!Ext.isEmpty(cols)) {
			for (var k = 0; k < cols.length; k++) {
				if (!(cols[k].dataIndex == 'rn' || cols[k].dataIndex == 'sel')) {
					if (!found && selVal == cols[k].dataIndex) {
						selVal = cols[k].dataIndex;
						found = true;
					}
					gridSearchData.push({
						vid: cols[k].dataIndex,
						name: cols[k].text || ''
					});
				}
			}
			if (gridSearchData.length > 1) {
				if (!found)
					selVal = 'v0';
				fieldList.getStore().setData(gridSearchData);
				fieldList.setValue(selVal);
	        }
		}
		
        if (me.coldef) {
            me.dummyRec = views;
        }
        //me.setPersonalization(null);
    },
    doSearch: function(value, ctrl) {
        var me = this,
            searchCombo = null,
            searchBy = null,
            searchText = null,
            searchValue = null,
            store = me.getStore(),
            startIndex = store.vsi,
            record = null;

        if (me.showToolbar) {
            me.searchCombo = searchCombo = me.down('#fieldList');
            if (searchCombo) {
                me.searchBy = searchBy = searchCombo.getValue() || 'v0';//TECH-29580
            }
            me.searchText = searchText = me.down('#fieldSearch');
            if (searchText) {
                me.searchValue = searchValue = searchText.getValue();//TECH-29580
            }
            if (!Ext.isEmpty(searchBy) && !Ext.isEmpty(searchValue)) {
                if (searchBy == "v0") {
                    var row = 0,
                        col = 0,
                        colName = undefined,
                        colValue = undefined,
                        isFound = false,
                        recordCount = store.getCount(),
                        lockedColumns = me.lockedGrid.getColumns(),
                        normalColumns = me.normalGrid.getColumns(),
                        columnsLen = lockedColumns.length + normalColumns.length,
                        column = null;
						//TECH-30033
                    /* if (me.lastSearch && me.lastSearch.text != searchValue)
                        delete me.lastEvent; */
                    if (Ext.isEmpty(me.searchIndex)) {
                        record = store.findRecord('rn', startIndex, 0);
                        if (record)
                            me.searchIndex = store.indexOf(record);
                        else
                            me.searchIndex = 0;
                        me.searchColIndex = 2;
                    }
                    row = me.searchIndex;
                    col = me.searchColIndex;
                    for (; row < recordCount; row++) {
                        if (col == columnsLen) {
                            col = 0;
                            row++;
                        }
                        record = store.getAt(row);
                        if (record) {
                            for (; col < columnsLen; col++) {
                                if (col < lockedColumns.length)
                                    column = lockedColumns[col];
                                else
                                    column = normalColumns[col - lockedColumns.length];
                                if (column.isHidden())
                                    continue;
                                me.searchColIndex = col + 1;
                                colName = column.dataIndex;
                                colValue = record.get(colName);
								//TECH-31353
								if(typeof colValue == "number") {
									colValue = column.formatNumber(colValue, column.format);
									colValue = colValue.toString();
									if (me.compare(colValue, searchValue)) {
										isFound = true;
										break;
									}
									else if(me.compare(column.formatNumeric(colValue, column.format), searchValue)) {
										isFound = true;
										break;
									}
								}
							    if(column.dataType == "date")//TECH-29580
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat)	
								else if(column.dataType == "date-time")
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat)
								else if(column.dataType == "time")
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat)	
								else
									colValue = me.getRawFormat(column.dataType, colValue);
								
                                if (me.compare(colValue, searchValue)) {
                                    isFound = true;
                                    break;
                                }
                            }
                        }
                        if (isFound) {
                            me.searchIndex = row;
                            break;
                        } else {
                            col = 2;
                        }
                    }
                    if (isFound) {
                        record = store.getAt(me.searchIndex);
                        me.scrollToRecord(me.searchIndex, record, colName, searchValue);
                        delete me.lastEvent;
                    } else if (!isFound && me.lastEvent == 'gridsearch') {
                        me.onNoSearchData(me);
                    } else {
                        record = store.getAt(store.getCount() - 1);
                        if (record && store.tr >= record.get('rn')) {//TECH-30033
							// TECH-28121
                            // store.vsi = record.get('rn');
                            // store.changed = true;
                            me.lastEvent = 'gridsearch';
                            me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, me.afterGridSearch.bind(me));
                        }else
                            me.onNoSearchData(me);
						/* else if (me.lastSearch) {
                            Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R256, function(btnId) {
                                if (btnId == "ok" || btnId == "yes") {
                                    me.lastEvent = 'gridsearch';
                                    me.searchIndex = 0;
                                    me.searchColIndex = 0;
                                    //me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, false);
                                    me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, me.afterGridSearch.bind(me));
                                }
                                me.lastSearch = null;
                                delete me.lastSearch;
                            });
                        } */ 
                    }
                } else {
                    if (Ext.isEmpty(me.searchIndex)) {
                        var recs = store.findRecord('rn', startIndex, 0);//TECH-29907
                        if (recs)
                            me.searchIndex = store.indexOf(recs);
                        else
                            me.searchIndex = 0;
                    } else
                        me.searchIndex++;
						
                    var colDataType = me.getColumnById(me.searchBy);
					//TECH-29580
					if(colDataType.dataType == "date" || colDataType.dataType == "date-time" || colDataType.dataType == "time" || colDataType.dataType == "hdate" || colDataType.dataType == "hdate-time" || colDataType.dataType == "htime"){
						var storeIdx =  store.findBy(function(rec,Id){
							var recData = rec.get(me.searchBy),
								recField = me.getColumnById(me.searchBy),
								colVal; //= Ext.util.Format.date(recData,RamcoRTC.userPreference.dateFormat);
							if(recField.dataType == "date")
								colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat);
							else if(recField.dataType == "date-time") 
								colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateFormat);
							else if(recField.dataType == "time")
								colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.dateFormat);
							else if(recField.dataType == "hdate")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							else if(recField.dataType == "hdate-time")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							else if(recField.dataType == "htime")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							if(colVal == me.searchValue)
								return true;
						},me,me.searchIndex);
					}
					if(storeIdx > 0){
						record = store.getAt(storeIdx);
					}
					if(Ext.isEmpty(record))
						record = store.findRecord(searchBy, searchValue, me.searchIndex, true);
                    if (record) {
                        me.searchIndex = store.indexOf(record);
                        me.scrollToRecord(me.searchIndex, record, searchBy, searchValue);
                    } else if (!record && me.lastEvent == 'gridsearch') {
                        me.onNoSearchData(me);
                    } else {
                        record = store.getAt(store.getCount() - 1);
                        me.searchIndex = 0;
                        if (store.tr >= record.get('rn')) {//TECH-30033
							// TECH-28121
                            // store.vsi = record.get('rn');
                            // store.changed = true;
                            me.lastEvent = 'gridsearch';
                            me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, me.afterGridSearch.bind(me));
                        } else
                            me.onNoSearchData(me);
						/*  else if (me.lastSearch) {
							Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R256, function(btnId) {
                                if (btnId == "ok" || btnId == "yes") {
                                    me.lastEvent = 'gridsearch';
                                    me.searchIndex = 0;
                                    me.searchColIndex = 0;
                                    //me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, false);
                                    me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, me.afterGridSearch.bind(me));
                                }
                            	me.lastSearch = null;
                            	delete me.lastSearch;
                            });
							//me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, false);
                            //me.lastSearch = null;
                            //delete me.lastSearch;
                        } */
                    }
                }
            }
        }
        return true;
    },
    afterGridSearch: function() {
        var me = this;
        me.searchIndex = null;
        me.doSearch();
    },
    scrollToRecord: function(index, rec, searchBy, searchText) {
        var me = this,
            store = me.store;
        if (searchBy) {
            me.lastSearch = {
                text: searchText,
                row: index,
                col: searchBy
            };
            me.setSearched(index, searchBy, rec);
        }
    },
    scrollToRecPostion: function(record, animate, overscroll, columnX, lastEvent) {
        var me = this,
            view = me.getView(),
            normalView = view.normalView || view,
            height = normalView ? normalView.getHeight() : 0,
            rowHeight = me.rowHeight,
            topbar = me.getDockedComponent('gridToolbar'),
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            rowVal = rowNav.getValue(),
            vr = me.store.vr / 3,
            record = me.store.findRecord('rn', rowVal),
            index = me.store.indexOf(record),
            x = normalView ? normalView.getScrollY() : 0,
            row = normalView.getRow(record),
            sTop = row ? row.parentElement.parentElement.offsetTop : (x + height - rowHeight + 5);
        if (normalView) {
            switch (lastEvent) {
                case 'onfirst':
                    normalView.setScrollY(0);
                    break;
                case 'onprev':
                    normalView.setScrollY(sTop);
                    break;
                case 'onnext':
                    normalView.setScrollY(sTop);
                    break;
                case 'onlast':
                    normalView.setScrollY(x + height + rowHeight);
                    break;
                default:
                    if (me.store.vsi > 0)
                        normalView.setScrollY(sTop);
                    else
                        normalView.setScrollY(0);
            }
        }
    },
    setSearched: function(index, colName, rec) {
        var me = this,
            store = me.getStore(),
            nav = me.getNavigationModel(),
            selModel = me.getSelectionModel(),
            columns = me.getColumns(),
            srchCmb = me.down('#fieldSearch'),
            rowNo = rec.get('rn'),
            column = null,
            scroller = null,
			scrollRegion=null,
            viewRegion = null,
            lockViewRegion = null,
            cellRegion = null,
            inRange = true,
            lockInRange = false,
			cellDom,
            colIndex = 0;
        column = Ext.ComponentQuery.query('{dataIndex == "' + colName + '"}', columns);
        if (column && column.length > 0) {
            colIndex = me.getColumnIndex(colName);
            column = me.getColumnById(colName);
            if (nav) {
                nav.cell = me.getCell(colName.replace('v', ''), rowNo);
                if (nav.cell) {
                    cellDom = new Ext.dom.Fly(nav.cell);
                    scroller = nav.view.getScrollable();
					scrollRegion = me.scrollBody.getRegion();
					viewRegion = me.view.normalView.body.getRegion();
					lockViewRegion = me.view.lockedView.body.getRegion();
                    //lockViewRegion = nav.view.lockingPartner.getViewRegion();
                    //viewRegion = nav.view.getViewRegion();
                    //cellRegion = nav.cell.dom.getViewRegion();					
					try {
						cellRegion = cellDom.getViewRegion();
					}
					catch(ex) {
						cellRegion = cellDom.dom.getViewRegion();
					}
					if(column.locked || column.autoLocked){
                    	lockInRange = lockViewRegion.contains(cellRegion);
						//TECH-31365, TECH-31363
						nav.view = me.view.lockedView;
					}
					else{
						inRange = viewRegion.contains(cellRegion);
						//TECH-31365, TECH-31363
						nav.view = me.view.normalView;
					}
					//TECH-31365, TECH-31363
					columns = nav.view.getGridColumns();
					if (columns) {
						colIndex = columns.indexOf(column);
					}					
                    //if (!lockInRange)
                        //inRange = viewRegion.contains(cellRegion);
					//scroller.ensureVisible(nav.cell);
                    if (!lockInRange && !inRange) {
						return;
                        //me.onBtnNext();
						/*nav.cell = me.getCell(colName.replace('v', ''), rowNo);
						cellDom = new Ext.dom.Fly(nav.cell);
						// TECH-27233 / MPTU-48
						//cellRegion = nav.cell.dom.getViewRegion();
						cellRegion = cellDom.getViewRegion();
						inRange = scrollRegion.contains(cellRegion);
						if (!inRange) {
							me.onBtnNext();
						}
						*/
                    }
					//TECH-31148
					nav.cell = cellDom;
                    store.cr = rec.get('rn');
					//TECH-31365, TECH-31363
                    /*if (lockInRange) {
                        nav.position.setAll(nav.view.lockingPartner, index, colIndex, rec, column);
                        selModel = nav.view.lockingPartner.getSelectionModel();
                    } 
					else
                        nav.position.setAll(nav.view, index, colIndex, rec, column);*/					
					nav.position.setAll(nav.view, index, colIndex, rec, column);
					/*
                    lcelctxt = new Ext.grid.CellContext(nav.position.view);
                    var fcell = lcelctxt.setPosition(colIndex, rowNo);
                    fcell.record = nav.position.record;
                    fcell.rowIdx = nav.position.rowIdx;
                    fcell.column = column;
                    //nav.focusPosition(nav.position);
                    // Maintain lastFocused in the view so that on non-specific focus of the View, we can focus the view's correct descendant. 
                    nav.view.lastFocused = nav.lastFocused = nav.position.clone();
                    // Use explicit scrolling rather than relying on the browser's focus behaviour. 
                    // Scroll on focus overscrolls. scrollIntoView scrolls exatly correctly. 
					if (scroller && nav && nav.cell) {
						//scroller.scrollIntoView(nav.cell.dom,'top');
						scroller.ensureVisible(nav.cell,{align:{x:'start',y:'start'},highlight :true});
					}
					var topbar = me.getDockedComponent('gridToolbar'),
						rowNav;
					if (topbar) {
						rowNav = topbar.getComponent('rowNav');
						if (rowNav)
							rowNav.setValue(me.store.vsi);
					}					
                    if (selModel) {
                        selModel.select(fcell);
                    }
					*/
					me.col = colIndex;
					me.lastEvent = "onSearch";
					me.gridFocus(null,rec.get('rn'));
                }
                Ext.defer(function() {
                    srchCmb.focus();
                }, 50);
            }
        }
    },
    compare: function(value, cValue) {
        var objType = typeof value;
        if (objType == "string") {
            return value.toLowerCase().indexOf(cValue.toLowerCase()) > -1;
        }
        return false;
    },
    getViewValue: function(viewName, row) {
        var me = this,
            record,
            data;
        record = me.store.findRecord('rn', row);
        if (record) {
            data = record.get('v' + viewName)
        }
        return data;
    },
    getCell: function(viewName, row) {
        var me = this,
            column = me.getColumnById('v' + viewName),
            view = me.getView(),
            record,
            td,
            cell;
        if (viewName == 'sel' || viewName == 'rn')
            return null;
        if (column) {
            if (column.locked) {
                view = view.lockedView;
            } else {
                view = view.normalView ? view.normalView : view;
            }
            record = me.store.findRecord('rn', row);
            if (view && record && column) {
                cell = view.getCell(record, column);
            }
        }
        return cell;
    },
    getColumnById: function(name) {
        var me = this,
            columns = me.getColumns(),
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        return column;
    },
    getColumnIndex: function(name) {
        var me = this,
            columns = me.getVisibleColumnManager().getColumns(),
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        //return (i - 2);
        return (i);
    },
	getAllColumnIndex: function(name) {
        var me = this,
            //columns = me.getColumns(),
            columns = me.initialConfig.columns,
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        //return (i - 2);
		return (i);
    },
    onNoSearchData: function(grid) {
        // TECH-40327
        //Ext.Msg.alert('', rvw_resources.R036, Ext.emptyFn, undefined, 'error');
		Ext.RamcoMsg.alert('', rvw_resources.R036, Ext.emptyFn, undefined, 'error');
        grid.searchIndex = 0;
        grid.searchColIndex = 0;
		var ilbo = this.up("ilbo");
		if(ilbo)
			ilbo.callBackStatusError = true;
    },
    setValueOnData: function() {
        var me = this;
        if (me.lastValue && !Ext.isEmpty(me.lastValue.vr))
            me.updateValue(me.lastValue);
        else if (me.value)
            me.updateValue(me.value);
        if (me.isSort) {
            me.isSort = false;
        } else {
            if (me.sortCol) {
                me.sortCol.setSortState(null);
                delete me.sortCol;
            }
        }
        /*me.mun(me.store, {
            refresh: me.setValueOnData
        });*/
    },
    onDataUpdate: function(store, record, operation, modField, details, eOpts) {
        var me = this;
        if (record.data.isNew == true && modField && modField[0] != 'sel') {
            if (me.edited) {
                record.data.isNew = false;
                /* DUMMY ROW CREATION FOR LAST ROW UPDATE */
                if (me.tr < me.si + (me.visibleRows * 3) - 1)
                    me.createDummyRecord();
				else
					me.updateRowNavigation(me.tr, 'last');
            }
        }
    },
    setStore: function(store) {
        var me = this;
        me.mon(store, {
            //refresh: me.setValueOnData,
            update: me.onDataUpdate,
            scope: me
        });
        me.reconfigure(store);
        me.setValueOnData();
        if (me.autoLoad && !store.isEmptyStore && !(store.loading || store.isLoaded())) {
            store.load();
        }
    },
	/* afterRender: function() {
        var me = this;
        me.callParent();
    },*/
    onResizeHeader: function(view, width, height, oldWidth, oldHeight, eOpts) {
        if (height != oldHeight) {
            var me = this,
                gridHeight = me.getHeight(),
                view = me.getView(),
                header = me.getShowHeader(),
                scrollbar = me.getDockedComponent('gridScroller'),
                headerSpace = scrollbar ? scrollbar.getComponent('headerSpace') : null,
                bottomSpace = scrollbar ? scrollbar.getComponent('bottomSpace') : null,
                nGridView = view.normalGrid ? view.normalView.el : view.el;
            if (header) {
                if (headerSpace) {
                    headerSpace.setStyle({
                        'lineHeight': (height) + 'px'
                    });
                    headerSpace.setHeight(height);
                }
                if (me.oldheaderHeight) {
                    gridHeight = gridHeight + height - me.oldheaderHeight;
                } else {
                    gridHeight = gridHeight + height;
                }
                me.oldheaderHeight = height;
            }
            if (nGridView.dom.scrollWidth > nGridView.dom.clientWidth) {
                bottomSpace.show();
                if (!me.hasScroll) {
                    gridHeight += Ext.getScrollbarSize().height;
                    me.hasScroll = true;
                }
            } else {
                bottomSpace.hide();
                if (me.hasScroll) {
                    gridHeight -= Ext.getScrollbarSize().height;
                    me.hasScroll = null;
                    delete me.hasScroll;
                }
            }
            me.suspendLayouts();
            me.setHeight(gridHeight);
			me.resumeLayouts();
        } else {
            return;
        }
    },
    onViewResize: function(view, width, height, oldWidth, oldHeight, eOpts) {
        var me = this,
            topbar = me.getDockedComponent('gridToolbar'),
            scrollbar = me.getDockedComponent('gridScroller'),
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            columns,
            totalCols,
            showScrollBar = me.getShowScrollBar(),
            insertFlag = me.getInsertFlag(),
            newNoOfRows = me.getVisibleRows(),
            autoHeight = me.getAutoHeight(),
            element1,
            gridView,
            column,
            oColumn,
            width = 0,
            colWidth = 0,
            forceFit = me.columnFit,
            nGridView,
			gridWidth = 0,
            box;
        //view = view ? view : me.getView();
        view = view ? view : me.normalGrid.getView();

		if (me.rendered === false)
			return;
		nGridView = view.normalGrid ? view.normalGrid.view : view;
		gridWidth = me.getWidth();
        //width = view.getWidth();		
		width = nGridView.getWidth();
        //columns = view.ownerCt.getVisibleColumns();
		columns = nGridView.ownerCt.getVisibleColumns();
        totalCols = 0;
		if(gridWidth == width) {
			if(scrollbar && scrollbar.isVisible()) {
				width = width - scrollbar.getWidth();
			}
		}
        if (fieldList && columns) {
            var colWidth = 0,
                hasForceFit = false,
                oWidth = 0;
			if (columns && columns.length > 0) {	
				var len = columns.length,
					i = 0,
					element = null;
				for(; i < len; i++) {
					element = columns[i];
					//columns.forEach(function(element, index, array) {
                if (!(element.dataIndex == 'rn' || element.dataIndex == 'sel')) {
                    if (element.hidden != true && element.rendered) {
                        if (element.hasPer) {
							// TECH-35619 / TECH-35707
							if (!Ext.isEmpty(element.cellWidth))
								colWidth += element.cellWidth;
							else
                            	colWidth += element.getWidth();
                            //colWidth += element.width;
                        } else {
                            if (element.oldWidth)
                                colWidth += element.oldWidth;
                            else
                                colWidth += element.getWidth();
                        }
                        if (element.forceFit)
                            hasForceFit = true;
						else
							hasForceFit = false;
                        totalCols++;
                    }
                }
                if (element.hidden != true && element.editor) {
                    insertFlag = true;
                }
				}
			}
			//);
            if (width >= colWidth && colWidth > 0) {
                if (hasForceFit)
                    forceFit = true;
                var i = 0,
                    cWidth = (width - colWidth),
                    len = columns.length,
                    newWidth = 0,
                    col = 0,
                    aWidth = parseFloat((cWidth / colWidth), 10),
                    rWidth = cWidth - (aWidth * colWidth);
                for (; i < len; i++) {
                    column = columns[i];
                    if (column.rendered) {
                        me.suspendEvents();
						me.suspendLayouts();
						column.suspendEvents();
						column.suspendLayouts();
                        col++;
                        if (forceFit) {
                            if (!column.oldWidth)
                                column.oldWidth = column.getWidth();
                            newWidth = parseInt(column.oldWidth * aWidth, 10);
                            rWidth += (column.oldWidth * aWidth) - newWidth;
                            if (col == totalCols)
                                newWidth += rWidth;
                            if (column.hasPer) {
                                column.setWidth(column.width + newWidth);
                            } else
                                column.setWidth(column.oldWidth + newWidth);
                        } else {
                            if (col == totalCols) {
								// TECH-38195 / TECH-38215
								// TECH-38611
                                if (!column.oldWidth)
                                    column.oldWidth = column.getWidth();								
                                if (column.hasPer) {
                                    column.setWidth(cWidth + column.width);
                                } else {
                                    column.setWidth(cWidth + column.oldWidth);
                                }
								//column.setWidth(cWidth + column.getWidth());
                            } else {
                                if (column.hasPer) {
                                    column.setWidth(column.width);
                                } else if (column.oldWidth) {
                                    column.setWidth(column.oldWidth);
                                } else {
                                    column.oldWidth = column.getWidth();
                                }
                            }
                        }
						column.resumeLayouts();
                        column.resumeEvents();
						me.resumeLayouts();
                        me.resumeEvents();
                    }
                }
            }
        }
		//if (hasForceFit && nGridView.rendered)
		if (nGridView.rendered)
			nGridView.updateLayout();
        if (view.rendered) {
            var gridHeight = me.getGridHeight(newNoOfRows);
            if (autoHeight && me.tr < newNoOfRows)
                gridHeight = me.getGridHeight(parseInt(me.tr));
            if (gridHeight > 0) {
                me.suspendLayouts();        
                me.setHeight(gridHeight);
				me.resumeLayouts();        
            }
        }
    },
    getRawFormat: function(type, value) {
        var ret = value;
        if (Ext.isEmpty(value))
            return value;
        switch (type) {
            case 'hdate':
                ret = Ext.util.Format.date(value, 'B-Q-R');
                break;
            case 'hdate-time':
                ret = Ext.util.Format.date(value, 'B-Q-R G:i:s');
                break;
            case 'htime':
                ret = Ext.util.Format.date(value, 'G:i:s');
                break;
            case 'date':
                ret = Ext.util.Format.date(value, 'Y-m-d');
                break;
            case 'date-time':
                ret = Ext.util.Format.date(value, 'Y-m-d G:i:s');
                break;
            case 'time':
                ret = Ext.util.Format.date(value, 'G:i:s');
                break;
            default:
        }
        return ret;
    },
	onExpandBody: function(rowNode , record , expandRow , eOpts) {
		var me = this,
			height = me.getHeight(),
			topRow = null,
			botRow = null,
			visbleRows = this.getVisibleRows();
		record.set('ex', '1');
		me.expanderCnt++;
		height = me.getGridHeight(visbleRows);
		/*var t = me.normalGrid.getBox().top;
		var b = me.normalGrid.getBox().bottom;		
		Ext.each(me.normalGrid.view.getNodes(), function (node) {
			var table =  Ext.fly(node);
			if (!topRow && table.getTop() >= t && table.getBottom() <= b) {
				topRow = me.normalGrid.view.getRecord(node).data.rn;console.log('t - ' + topRow);
			}
			if (table.getTop() >= t && table.getBottom() <= b) {			
				botRow = me.normalGrid.view.getRecord(node).data.rn;console.log('b - ' + botRow);
			}
		});*/		
	},
	onCollapsebody: function(rowNode , record , expandRow , eOpts) {
		var me =this;
		record.set('ex', '0')
		me.expanderCnt--;
		console.log(record.get('ex'));		
	},
	doMlAvnFileDownload: function() {
		var me = this,
			src = null,
            ilbo = me.up('ilbo'),
            itemId = me.getItemId(),            
            srcPath = '',
			eventName = null,
			view = null,
			fileName = '',
			row = me.store.cr,
            fileUrl = ilbo ? ilbo.avnFileDownloadUrl : '',
			args = me.processEvtargs;
			if (args) {
				view = args[5];
				fileName = args[2].get("v" + view);
				eventName = args[3];
			}
            src = Ext.String.format(fileUrl, itemId, view, row, true, fileName, srcPath, eventName, RamcoRTC.sessionToken);
        window.open(src, "Mywindow","height=350,left=200,menubar=no,location=no,resizable=no,scrollbars=no,status=yes,top = 50, width=500");
	},
    doDestroy: function() {
        var me = this,
            view = me.getView(),
            scrollbar = me.getDockedComponent('gridScroller'),
            showScrollBar = me.getShowScrollBar(),
            gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null,
            headerSpace = scrollbar ? scrollbar.getComponent('headerSpace') : null,
            bottomSpace = scrollbar ? scrollbar.getComponent('bottomSpace') : null,
            btnUp = scrollbar ? scrollbar.getComponent('btnUp') : null,
            btnDown = scrollbar ? scrollbar.getComponent('btnDown') : null,
            topbar = me.getDockedComponent('gridToolbar'),
            btnFirst = topbar ? topbar.getComponent('btnFirst') : null,
            btnPrev = topbar ? topbar.getComponent('btnPrev') : null,
            btnNext = topbar ? topbar.getComponent('btnNext') : null,
            btnLast = topbar ? topbar.getComponent('btnLast') : null,
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            deleteBtn = topbar ? topbar.getComponent('btnDelete') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            menuImport = topbar ? topbar.getComponent('menuImport') : null,
            btnExport = topbar ? topbar.getComponent('btnExport') : null,
            groupingBtn = topbar ? topbar.getComponent('tBarGrpBtn') : null,
			btnSave = groupingBtn ? groupingBtn.menu.items.getByKey('savePers') : null,
            btnRemove = groupingBtn ? groupingBtn.menu.items.getByKey('removePers') : null,
            btnChoose = groupingBtn ? groupingBtn.menu.items.getByKey('columnChooser') : null,
			btnMultiSort = groupingBtn ? groupingBtn.menu.items.getByKey('multiSort') : null,
            btnClearMultiSort = groupingBtn ? groupingBtn.menu.items.getByKey('clearMultiSort') : null,
            lHeaderCt,
            nHeaderCt,
			impExcel,expExcel,expPdf,expHtml;
			
			if (RamcoRTC.settings.isExt2 == true) {												
				impExcel = topbar ? topbar.getComponent('btnImpExcel') : null;
				expExcel = topbar ? topbar.getComponent('btnExpExcel') : null;
				expPdf = topbar ? topbar.getComponent('btnExpPdf') : null;
				expHtml = topbar ? topbar.getComponent('btnExpHtml') : null;
				btnSave = topbar ? topbar.getComponent('savePers') : null;
				btnRemove = topbar ? topbar.getComponent('removePers') : null;
				btnChoose = topbar ? topbar.getComponent('columnChooser') : null;
				btnMultiSort = topbar ? topbar.getComponent('multiSort') : null;
				btnClearMultiSort = topbar ? topbar.getComponent('clearMultiSort') : null;
			}
			else {
				impExcel = menuImport ? menuImport.menu.items.getByKey('btnImpExcel') : null;
				expExcel = btnExport ? btnExport.menu.items.getByKey('btnExpExcel') : null;
				expPdf = btnExport ? btnExport.menu.items.getByKey('btnExpPdf') : null;
				expHtml = btnExport ? btnExport.menu.items.getByKey('btnExpHtml') : null;
			}
            
        if (gridSlider) {
            me.mun(gridSlider, {
                changecomplete: me.onGridSliderChange,
                scope: me
            });
        }
        if (btnFirst)
            me.mun(btnFirst, {
                click: me.onBtnFirst,
                scope: me
            });
        if (btnPrev)
            me.mun(btnPrev, {
                click: me.onBtnPrev,
                scope: me
            });
        if (btnNext)
            me.mun(btnNext, {
                click: me.onBtnNext,
                scope: me
            });
        if (btnLast)
            me.mun(btnLast, {
                click: me.onBtnLast,
                scope: me
            });

        if (btnUp)
            me.mun(btnUp, {
                click: me.onBtnUp,
                scope: me
            });
        if (btnDown)
            me.mun(btnDown, {
                click: me.onBtnDown,
                scope: me
            });

        // Toolbar event Handler
        if (insertBtn)
            me.mun(insertBtn, {
                click: me.onInsert,
                scope: me
            });
        if (deleteBtn)
            me.mun(deleteBtn, {
                click: me.onDelete,
                scope: me
            });
        if (btnCut)
            me.mun(btnCut, {
                click: me.onCutAppendRow,
                scope: me
            });
        if (btnCopy)
            me.mun(btnCopy, {
                click: me.onCopyAppendRow,
                scope: me
            });
		
		if (btnMultiSort) {
			me.mun(btnMultiSort, { click: me.onMultiSort, scope: me });
			if (me.multiSortWindow) {
				Ext.destroy(me.multiSortWindow);
                me.multiSortWindow = null;
                delete me.multiSortWindow;
			}
		}
		if (btnClearMultiSort) {
			me.mun(btnClearMultiSort, { click: me.onClearMultiSort, scope: me });
		}
        if (impExcel) {
            me.mun(impExcel, {
                click: me.onImportExcel,
                scope: me
            });
            if (me.importWindow && me.importWindow.BtnImport) {
                me.importWindow.BtnImport.un('click', me.onBtnImportClick, me);
                Ext.destroy(me.importWindow)
                me.importWindow = null;
                delete me.importWindow;
            }
        }
        if (expExcel)
            me.mun(expExcel, {
                click: me.onshowExcel,
                scope: me
            });
        if (expPdf)
            me.mun(expPdf, {
                click: me.onshowPDF,
                scope: me
            });
        if (expHtml)
            me.mun(expHtml, {
                click: me.onViewall,
                scope: me
            });
        if (btnSave)
            me.mun(btnSave, {
                click: me.onSavePers,
                scope: me
            });
        if (btnRemove)
            me.mun(btnRemove, {
                click: me.onRemovePers,
                scope: me
            });
        if (btnChoose)
            me.mun(btnChoose, {
                click: me.onColumnChoose,
                scope: me
            });
		/*
		if (btnMultiSort)
			me.mun(btnMultiSort, {click: me.onMultiSort,scope: me});
		if (btnClearMultiSort)
			me.mun(btnClearMultiSort, {click: me.onClearMultiSort,scope: me});
		*/
        if (me.view) {
            me.mun(me.view, {
                scope: me,
                focuschange: me.updateGridSlider,
                cellkeydown: me.onCellKeyDown
            });
        }
        var store = me.getStore();
        if (store) {
            me.mun(store, {
                refresh: me.setValueOnData,
                update: me.onDataUpdate,
                scope: me
            });
        }
        me.callParent();
    }
});

Ext.define('Ext.grid.o.header.Container', {
	override:'Ext.grid.header.Container',	
	 getMenu: function() {
        var me = this,
            grid = me.view && me.view.ownerGrid;
 
        if (!me.menu) {
            me.menu = new Ext.menu.Menu({
                hideOnParentHide: false,  // Persists when owning ColumnHeader is hidden
                items: me.getMenuItems(),
				userCls: 'x-grid-menu',
                listeners: {
                    beforeshow: me.beforeMenuShow,
                    hide: me.onMenuHide,
                    scope: me
                },
            });
            me.fireEvent('menucreate', me, me.menu);
            if (grid) {
                grid.fireEvent('headermenucreate', grid, me.menu, me);
            }
        } 
        return me.menu;
    }	
});

Ext.define('Ext.grid.o.plugin.RowExpander', {
	override:'Ext.grid.plugin.RowExpander',	
	/*
	init: function() {
		var me = this;		
		me.callParent(me.grid);
		me.mun(me, {
			expandbody : onExpandBody,
			collapsebody : onCollapseBody,
			scope:me
		});
	},*/
	toggleRow: function(rowIdx, record) {
        var me = this,
            view = me.normalView || me.view,
            fireView = view,
            rowNode = view.getNode(rowIdx),
            normalRow = Ext.fly(rowNode),
            lockedRow,
            nextBd = normalRow.down(me.rowBodyTrSelector, true),
            wasCollapsed = normalRow.hasCls(me.rowCollapsedCls),
            addOrRemoveCls = wasCollapsed ? 'removeCls' : 'addCls',
            ownerLockable = me.grid.lockable && me.grid,
			topRow = null,
			botRow = null,			
            componentLayoutCounter;
 
        normalRow[addOrRemoveCls](me.rowCollapsedCls);
        Ext.fly(nextBd)[addOrRemoveCls](me.rowBodyHiddenCls);
        me.recordsExpanded[record.internalId] = wasCollapsed;
 
        Ext.suspendLayouts();
        if (ownerLockable) {
            componentLayoutCounter = ownerLockable.componentLayoutCounter;            
            fireView = ownerLockable.getView();
            if (me.lockedGrid.isVisible()) {
                view = me.lockedView;
                view.lockingPartner.updateLayout();
                lockedRow = Ext.fly(view.getNode(rowIdx));
                if (lockedRow) {
                    lockedRow[addOrRemoveCls](me.rowCollapsedCls);
                    nextBd = lockedRow.down(me.rowBodyTrSelector, true);
                    Ext.fly(nextBd)[addOrRemoveCls](me.rowBodyHiddenCls);
                }
            }
            ownerLockable.syncRowHeightOnNextLayout = true;
        }
        fireView.fireEvent(wasCollapsed ? 'expandbody' : 'collapsebody', rowNode, record, nextBd);
        view.refreshSize(true);
        Ext.resumeLayouts(true);
		//fireView.fireEvent(wasCollapsed ? 'expandcompleted' : 'collapsecompleted', rowNode, record, nextBd);
        if (me.scrollIntoViewOnExpand && wasCollapsed) {
            me.grid.ensureVisible(rowIdx);
        }
		var t = me.normalGrid.getBox().top;
		var b = me.normalGrid.getBox().bottom;		
		var misc = 0;
		Ext.each(me.normalGrid.view.getNodes(), function (node) {
			var table =  Ext.fly(node);
			var nodeRecord = me.normalGrid.view.getRecord(node).data;
			if (nodeRecord.ex == "1")
				misc = 120;
			else
				misc = 22;
			if (!topRow && (table.getTop() + misc) >= t && table.getBottom() <= b) {
				topRow = nodeRecord.rn;console.log('t - ' + topRow);
			}
			if (table.getTop() >= t && table.getBottom() <= b) {			
				botRow = nodeRecord.rn;console.log('b - ' + botRow);
			}
		});
    },	
	getRowBodyFeatureData: function(record, idx, rowValues) {
        var me = this,
			rowExCfg = me.grid.ownerCt.rowExpConfig,
			ilbo = ilbo = me.grid.up('ilbo'),
			xTpl = null,
			tplVal = '',
			tmpValue = '', tempid,
			value = record.get(rowExCfg.tplcolumn);
		if (!Ext.isEmpty(rowExCfg)) {
			if(this.lockableScope == "normal") {
				if (Ext.isString(value) && (value.indexOf('{') == 0 || value.indexOf('[') == 0)) {
					tmpValue = value ? Ext.decode(value, true) : '';
					tempid = tmpValue ? tmpValue.tplid : rowExCfg.tplId;
					if (tempid) {
						xTpl = ilbo.getTemplate(tempid);
						if (xTpl && xTpl.isTemplate)
							value = xTpl.apply(tmpValue);
					}
				}
				else if (!Ext.isEmpty(value) && Ext.isString(value)) {
					xTpl = ilbo.getTemplate(value);
					tplVal = xTpl.apply(record.data);
				}
				else {
					xTpl = ilbo.getTemplate(rowExCfg.deftpl);
					tplVal = xTpl.apply(record.data);
				}
			}
			me.self.prototype.setupRowData.apply(me, arguments); 
			rowValues.rowBody = me.getRowBodyContents(rowValues);
			rowValues.rowBody = tplVal;
			rowValues.rowBodyCls = me.recordsExpanded[record.internalId] ? '' : me.rowBodyHiddenCls;
		}
    }
	/*
	onExpandBody: function(rowNode , record , expandRow , eOpts) {
		console.log('RowExpand');
	},
	onCollapseBody: function(rowNode , record , expandRow , eOpts) {
		console.log('RowCollapse');
	}*/	
});

//TECH-31148
//Ext.grid.NavigationModel.override({   
Ext.define('Ext.grid.o.NavigationModel', {
	override: 'Ext.grid.NavigationModel',
	initKeyNav: function (view) {
        var me = this,
            nav;
        // We will have two keyNavs if we are the navigation model for a lockable assembly
        if (!me.keyNav) {
            me.keyNav = [];
            me.position = new Ext.grid.CellContext(view);
        }
        // Drive the KeyNav off the View's itemkeydown event so that beforeitemkeydown listeners may veto.
        // By default KeyNav uses defaultEventAction: 'stopEvent', and this is required for movement keys
        // which by default affect scrolling.
        nav = new Ext.util.KeyNav({
            target: view,
            ignoreInputFields: true,
            // Must use the same event that form fields use to detect keystrokes.
            // keypress happens *after* keydown, but the framework must see key events in bubble sequence order
            // So a field in actionable mode must see its key event before this nav model.
            eventName: Ext.supports.SpecialKeyDownRepeat ? 'itemkeydown' : 'itemkeypress',
            defaultEventAction: 'stopEvent',
            processEvent: me.processViewEvent,
            up: me.onKeyUp,
            down: me.onKeyDown,
            right: me.onKeyRight,
            left: me.onKeyLeft,
            pageDown: me.onKeyPageDown,
            pageUp: me.onKeyPageUp,
            home: me.onKeyHome,
            end: me.onKeyEnd,
            space: me.onKeySpace,
            enter: me.onKeyEnter,
            esc: me.onKeyEsc,
            113: {
                // Actionable mode is triggered by F2 key with no modifiers
                ctrl: false,
                shift: false,
                alt: false,
                handler: me.onKeyF2
            },
            tab: me.onKeyTab,
            A: {
                ctrl: true,
                // Need a separate function because we don't want the key
                // events passed on to selectAll (causes event suppression).
                handler: me.onSelectAllKeyPress
            },
            scope: me
        });
        me.keyNav.push(nav);
        me.onKeyNavCreate(nav);
    },
	onKeyUp: function(keyEvent) {
        var newRecord = keyEvent.view.walkRecs(keyEvent.record, -1),
            pos = this.getPosition();
        
        if (newRecord && pos) {
            pos.setRow(newRecord);
 
            // If no cell at the current column, move towards row start 
            if (!pos.getCell(true)) {
                pos.navigate(-1);
            }
            this.setPosition(pos, null, keyEvent);
        }
    },
	onKeyDown: function(keyEvent) {
        // If we are in the middle of an animated node expand, jump to next sibling. 
        // The first child record is in a temp animation DIV and will be removed, so will blur. 
        var newRecord = keyEvent.record.isExpandingOrCollapsing ? null : keyEvent.view.walkRecs(keyEvent.record, 1),
            pos = this.getPosition();
 
        if (newRecord && pos) {
            pos.setRow(newRecord);
 
            // If no cell at the current column, move towards row start 
            if (!pos.getCell(true)) {
                pos.navigate(-1);
            }
            this.setPosition(pos, null, keyEvent);
        }
    },
    onContainerMouseDown: function (view, mousedownEvent) {
        var me = this,
            context = new Ext.grid.CellContext(view),
            lastFocused, position;
        me.callParent([
            view,
            mousedownEvent
        ]);
        lastFocused = view.lastFocused;
        position = (view.actionableMode && view.actionPosition) || lastFocused;
        if (!position || lastFocused === 'scrollbar') {
            return;
        }
        context.setPosition(position.record, position.column);
        mousedownEvent.position = context;
        me.attachClosestCell(mousedownEvent);
        // If we are not already on that position, set position there.
        if (!me.position.isEqual(context)) {
            me.setPosition(context, null, mousedownEvent);
        }
    },
    onCellMouseDown: function (view, cell, cellIndex, record, row, recordIndex, mousedownEvent) {
        var targetComponent = Ext.Component.fromElement(mousedownEvent.target, cell),
            actionableEl = mousedownEvent.getTarget(this.isFocusableEl, cell),
            ac;
        // If actionable mode, and                   
        //  (mousedown on a tabbable, or anywhere in the ownership tree of an inner active component),                   
        // we should just keep the action position synchronized.
        // The tabbable element will be part of actionability.               
        // If the mousedown was NOT on some focusable object, we need to exit actionable mode.
        if (view.actionableMode) {
            // If mousedown is on a focusable element, or in the component tree of the active component (which is NOT this)
            if (!actionableEl) {
                actionableEl = (ac = Ext.ComponentManager.getActiveComponent()) && ac !== view && ac.owns(mousedownEvent);
            }
            if (actionableEl) {
                // Keep actionPosition synched
                view.setActionableMode(true, mousedownEvent.position);
            } else // Not on anything actionable, then exit actionable mode
            {
                view.setActionableMode(false, mousedownEvent.position);
            }
            return;
        }
        // If the event is a touchstart, leave it until the click to focus.
        // Mousedowns may have a focusing effect.
        if (mousedownEvent.pointerType !== 'touch') {
            if (mousedownEvent.position.column.cellFocusable !== false) {
                if (actionableEl) {
                    // So that the impending onFocusEnter does not
                    // process the event and delegate focus. We
                    // control that here. This means disabling tabbability.
                    if (!view.containsFocus) {
                        view.containsFocus = true;
                        view.toggleChildrenTabbability(false);
                    }
                    if (view.setActionableMode(true, mousedownEvent.position) !== false) {
                        actionableEl.focus();
                    }
                } else {
                    cell.focus();
                }
                if (mousedownEvent.button === 2) {
                    this.fireNavigateEvent(mousedownEvent);
                }
                // If mousedowning on a focusable Component.
               // After having set the position according to the mousedown, we then
                // enter actionable mode and focus the component just as if the user
                // Had navigated here and pressed F2.
                if (targetComponent && targetComponent.isFocusable && targetComponent.isFocusable()) {
                    view.setActionableMode(true, mousedownEvent.position);
                    // Focus the targeted Component
                    targetComponent.focus();
                }
            } else {
                mousedownEvent.preventDefault(true);
            }
        }
		//mousedownEvent.preventDefault(true);
    },
	//TECH-31148
	onKeyPageDown: function(keyEvent) {},
	onKeyPageUp: function(keyEvent) {},
    onKeyHome: function(keyEvent) {},
    onKeyEnd: function(keyEvent) {}
});

Ext.define('Ext.ramco.DDTGridPanel', {
    extend: 'Ext.ramco.GridPanel',
    alias: 'widget.ramcoddtgrid'    
});

// RSTree Control
Ext.define('Ext.ramco.RSTreePanel', {
    extend: 'Ext.tree.Panel',
    alias: 'widget.ramcorstreepanel',
	rootVisible: false,	
	searchDataLength: 0,
	selectedCount: 0,
	config: {
		value: null
	},
    initComponent: function() {
		this.dockedItems =  [{
        dock: 'top',
        xtype: 'toolbar',
        itemId: 'tblTree',		
        defaults: {
            scale: 'small',
            padding: 2
        },
        overflowHandler: 'scroller',
        items: [{
            iconCls: 'x-fa fa-plus-square-o',
            itemId: 'expandall',
            tooltip: rvw_resources.R167
        }, {
            iconCls: 'x-fa fa-minus-square-o',
            itemId: 'collapseall',
				tooltip: rvw_resources.R168
        }, {
            iconCls: 'x-btn-icon',
            hidden: true,
				tooltip: rvw_resources.R169
        }, {
            xtype: 'textfield',
            itemId: 'treesearch',
            width: 150,
            emptyText: rvw_resources.R196,
			triggers: {
				clear: {
					cls: 'x-form-clear-trigger',
					handler: function () {
						var treeCtrl = this.ownerCt.ownerCt;
						this.setValue('');
						treeCtrl.selectedCount = 0;
						treeCtrl.searchDataLength = 0;
						this.clearTreeHightLight();
					}
				}
			},
			listeners: {
				change: this.onTreeSearchChange
			}
            //searchIcon: true
        }, 
		//'->',
		{
            iconCls: 'x-fa fa-search',
            hidden: false,
			itemId: 'itreesearch',
			tooltip: rvw_resources.R170
        }, {
            iconCls: 'x-fa fa-filter',
            itemId: 'filter',
			tooltip: rvw_resources.R172
        }, {
            iconCls: 'x-fa fa-search-plus',
			itemId: 'treesearchopt',
            hidden: false,
			tooltip: rvw_resources.R171
			}]
		}];
        this.callParent();
        var me = this,
            topbar = me.getDockedComponent('tblTree'),
            expand = topbar ? topbar.getComponent('expandall') : null,
            collapse = topbar ? topbar.getComponent('collapseall') : null,
            filter = topbar ? topbar.getComponent('filter') : null,			
            treesearch = topbar ? topbar.getComponent('itreesearch') : null,
			treesearchopt = topbar ? topbar.getComponent('treesearchopt') : null,
			searchTriggers;		
		me.search = topbar ? topbar.getComponent('treesearch') : null;
		searchTriggers = me.search.getTriggers();
		if(searchTriggers && searchTriggers.clear)
			searchTriggers.clear.hide();
        if (expand)
            me.mon(expand, {
                click: me.onExpandClick,
                scope: me
            });
        if (collapse)
            me.mon(collapse, {
                click: me.onCollapseClick,
                scope: me
            });
		if (treesearch) 	
			me.mon(treesearch, {
                click: me.onTreeSearchClick,
                scope: me
            });
        if (filter)
            me.mon(filter, {
                click: me.onFilterClick,
                scope: me
            });
		if(treesearchopt)
			me.mon(treesearchopt, {
                click: me.onTreeSearchOpt,
                scope: me
            });
    },
	clearTreeHightLight: function() {
		var me = this
			treeStore = me.getStore();
		Ext.Object.eachValue(treeStore.byIdMap, function(node) {
			if (node) {
				node.removeCls("x-tree-search-item");
			}
			if (me.searchDataLength == me.selectedCount) {
				node.data.sel = false;
			}
		});
	},
	onTreeSearchChange: function() {
		var value = '';
		this.changed = true;		
		value = this.value;
		if(this.triggers && this.triggers.clear) {
			if(Ext.isEmpty(value)) {
				this.triggers.clear.hide();
			}
			else {
				this.triggers.clear.show();
			}
		}
	},
	updateValue: function(newValue, oldValue) {
		var me = this,
			tbrHideOrder = null,
			tbrItemSeq = null,
			topbar = me.getDockedComponent('tblTree'),
			toolBarItems = null,
			tbrHideArr = [],
			itemLen = 0;
		if (newValue && newValue.rData) {
			tbrHideOrder = newValue.rData.hideTbrSeq;
			tbrHideArr = (tbrHideOrder) ? tbrHideOrder.split(":") : "";
			itemLen = tbrHideArr.length;
			if (topbar && itemLen > 0) {
				toolBarItems = topbar.items.items;
				for (t=0; t<itemLen; t++) {
					//toolBarItems[tbrHideArr[t]].hidden = true;
					toolBarItems[tbrHideArr[t]].hide();
				}
			}
		}
		if (newValue && newValue.store) {
			me.store.setRoot(newValue.store);
		}
    },
    onExpandClick: function(btn) {
        var me = this;
        if (!me.expandAllTask)
            me.expandAll();
        else {
            me.fireEvent('treeexpand', me, me.expandAllTask);
        }
    },
    onCollapseClick: function() {
        this.collapseAll();
    },
	onTreeSearchClick: function() {
		var me = this,			
			searchTxt = me.search.getValue();
		if (Ext.isEmpty(searchTxt)) {
			Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R294)
		}
		//if(me.search.changed && me.lastSearchText != searchTxt) {
			me.fireEvent('treesearch', me, searchTxt);
			me.lastSearchText = searchTxt;
			me.changed = false;
		//}
	},
    onFilterClick: function(btn) {
        var me = this,
            filter = null,
            filtertask = me.filterTask,
            triggerCtrlName = me.triggerCtrl,
            triggerValue = '', regex,
            searchValue = me.search.getValue(),
			treeStore = me.store;
        if (filtertask)
            me.fireEvent('treefilter', me, me.expandAllTask);
        else {
            if (me.getCollapsed()) {
                me.expandAll();
                return;
            }
			var filterFn = function(node) {
				var children = node.childNodes,
					len = children && children.length,
					visible = v.test(node.get('text')),
					i;

				// If the current node does NOT match the search condition
				// specified by the user...
				if (!visible) {

					// Check to see if any of the child nodes of this node
					// match the search condition.  If they do then we will
					// mark the current node as visible as well.
					for (i = 0; i < len; i++) {
						if (children[i].isLeaf()) {
							//visible = children[i].get('visible');
							visible = v.test(children[i].get('text'));
						} else {
							visible = filterFn(children[i]);
						}
						if (visible) {
							break;
						}
					}

				} else { // Current node matches the search condition...

					// Force all of its child nodes to be visible as well so
					// that the user is able to select an example to display.
					for (i = 0; i < len; i++) {
						children[i].set('visible', true);
					}

				}
				return visible;
			},v;
			if (searchValue.length < 1) {
				treeStore.clearFilter();
			} 
			else {
				v = new RegExp(searchValue, 'i');
				treeStore.getFilters().replaceAll({
					filterFn: filterFn
				});
			}
        }
    },
    onTreeSearchOpt: function(btn) {
		var me = this;
		if (!me.treeSearchWin) {
			me.treeSearchWin = Ext.create('Ext.ramco.TreeSearchWindow', {
				scrollable: true,
				closable: true,
				modal: true,
				width: 400
			});
		}		
		me.treeSearchWin.showBy(btn, "tl-bl?");
		me.treeSearchWin.tree = me;
		me.treeSearchWin.focus();
	}, 
	/*beforeLayout: function() {
        var me = this,
            el = me.getEl(),
            td = el ? el.up('td') : null;
        if (td) {
            me.setHeight(td.getHeight());
        }
        me.callParent();
    },*/
	setStore: function(store) {
        var me = this;
        		 
        store = me.applyStore(store);
 
        // If there is no rootnode defined, then create one. 
        if (!store.getRoot()) {
            store.setRoot({});
        }
		
        // Store must have the same idea about root visibility as us BEFORE callParent binds it. 
        store.setRootVisible(me.rootVisible);
 
        if (me.enableLocking) {
            me.reconfigure(store);
        } 
		else {
            if (me.view) {
                me.view.setRootNode(store.getRootNode());
            }
            me.bindStore(store);
        }
		me.mon(store, {            
            update: me.onDataUpdate,
            scope: me
        });
    },
	onClearDataSelection: function(store) {
        var me = this;
        Ext.Object.eachValue(store.byIdMap, function(node) {
			if (node.data.sel) {
				node.data.sel = "false";
				node.removeCls("x-tree-item-selected");
			}
		});
    },
	onDataUpdate: function(store, record, operation, modField, details, eOpts) {
        var me = this;		
        Ext.Object.eachValue(store.byIdMap, function(node) {			
			if (node.data.sel == "true" || node.data.sel == true) {
				node.addCls("x-tree-item-selected");
			}
		});
    }
});

// Tree Control
Ext.define('Ext.ramco.TreePanel', {
    extend: 'Ext.tree.Panel',
    alias: 'widget.ramcotreepanel',
	searchDataLength: 0,
	selectedCount: 0,
	config: {
		value: null
	},
    initComponent: function() {
		this.dockedItems =  [{
        dock: 'top',
        xtype: 'toolbar',
        itemId: 'tblTree',		
		layout:{
			type:"hbox",
			align:"stretch"
		},
        defaults: {
            scale: 'small',
			padding:0
        },
        overflowHandler: 'scroller',
        items: [{
            iconCls: 'x-fa fa-plus-square-o',
            itemId: 'expandall',
            tooltip: rvw_resources.R167
        }, {
            iconCls: 'x-fa fa-minus-square-o',
            itemId: 'collapseall',
				tooltip: rvw_resources.R168
        }, {
            iconCls: 'x-btn-icon',
            hidden: true,
				tooltip: rvw_resources.R169
        }, {
            xtype: 'textfield',
            itemId: 'treesearch',
			minWidth: 100,
			//flex:4,
            emptyText: rvw_resources.R196,
			triggers: {
				clear: {
					cls: 'x-form-clear-trigger',
					handler: function () {
						var treeCtrl = this.ownerCt.ownerCt;
						this.setValue('');
						treeCtrl.selectedCount = 0;
						treeCtrl.searchDataLength = 0;
						this.clearTreeHightLight();
					}
				}
			},
			listeners: {
				change: this.onTreeSearchChange
			}
            //searchIcon: true
        }, 
		//'->',
		{
            iconCls: 'x-fa fa-search',
            hidden: false,
			itemId: 'itreesearch',
			tooltip: rvw_resources.R170
        }, {
            iconCls: 'x-fa fa-filter',
            itemId: 'filter',
			tooltip: rvw_resources.R172
        }, {
            iconCls: 'x-fa fa-search-plus',
			itemId: 'treesearchopt',
            hidden: false,
			tooltip: rvw_resources.R171
			}]
		}];
        this.callParent();
        var me = this,
            topbar = me.getDockedComponent('tblTree'),
            expand = topbar ? topbar.getComponent('expandall') : null,
            collapse = topbar ? topbar.getComponent('collapseall') : null,
            filter = topbar ? topbar.getComponent('filter') : null,			
            treesearch = topbar ? topbar.getComponent('itreesearch') : null,
			treesearchopt = topbar ? topbar.getComponent('treesearchopt') : null,
			searchTriggers;		
		me.search = topbar ? topbar.getComponent('treesearch') : null;
		searchTriggers = me.search.getTriggers();
		//TECH-38754
		me.titlePosition = (RamcoRTC.settings.isExt2 == true) ? 2 : 0;
		if(searchTriggers && searchTriggers.clear)
			searchTriggers.clear.hide();
        if (expand)
            me.mon(expand, {
                click: me.onExpandClick,
                scope: me
            });
        if (collapse)
            me.mon(collapse, {
                click: me.onCollapseClick,
                scope: me
            });
		if (treesearch) 	
			me.mon(treesearch, {
                click: me.onTreeSearchClick,
                scope: me
            });
        if (filter)
            me.mon(filter, {
                click: me.onFilterClick,
                scope: me
            });
		if(treesearchopt)
			me.mon(treesearchopt, {
                click: me.onTreeSearchOpt,
                scope: me
            });
    },
	clearTreeHightLight: function() {
		var me = this
			treeStore = me.getStore();
		Ext.Object.eachValue(treeStore.byIdMap, function(node) {
			if (node) {
				node.removeCls("x-tree-search-item");
			}
			if (me.searchDataLength == me.selectedCount) {
				node.data.sel = false;
			}
		});
	},
	onTreeSearchChange: function() {
		var value = '';
		this.changed = true;		
		value = this.value;
		if(this.triggers && this.triggers.clear) {
			if(Ext.isEmpty(value)) {
				this.triggers.clear.hide();
			}
			else {
				this.triggers.clear.show();
			}
		}
	},
	updateValue: function(newValue, oldValue) {
		var me = this,
			tbrHideOrder = null,
			tbrItemSeq = null,
			topbar = me.getDockedComponent('tblTree'),
			toolBarItems = null,
			tbrHideArr = [],
			itemLen = 0;
		if (newValue && newValue.rData) {
			tbrHideOrder = newValue.rData.hideTbrSeq;
			tbrHideArr = (tbrHideOrder) ? tbrHideOrder.split(":") : "";
			itemLen = tbrHideArr.length;
			if (topbar && itemLen > 0) {
				toolBarItems = topbar.items.items;
				for (t=0; t<itemLen; t++) {
					//toolBarItems[tbrHideArr[t]].hidden = true;
					toolBarItems[tbrHideArr[t]].hide();
				}
			}
		}
    },
    onExpandClick: function(btn) {
        var me = this;
        if (!me.expandAllTask)
            me.expandAll();
        else {
            me.fireEvent('treeexpand', me, me.expandAllTask);
        }
    },
    onCollapseClick: function() {
        this.collapseAll();
    },
	onTreeSearchClick: function() {
		var me = this,			
			searchTxt = me.search.getValue();
		if (Ext.isEmpty(searchTxt)) {
			Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R294)
		}
		//if(me.search.changed && me.lastSearchText != searchTxt) {
			me.fireEvent('treesearch', me, searchTxt);
			me.lastSearchText = searchTxt;
			me.changed = false;
		//}
	},
    onFilterClick: function(btn) {
        var me = this,
            filter = null,
            filtertask = me.filterTask,
            triggerCtrlName = me.triggerCtrl,
            triggerValue = '', regex,
            searchValue = me.search.getValue(),
			treeStore = me.store;
        if (filtertask)
            me.fireEvent('treefilter', me, me.expandAllTask);
        else {
            if (me.getCollapsed()) {
                me.expandAll();
                return;
            }
			var filterFn = function(node) {
				var children = node.childNodes,
					len = children && children.length,
					visible = v.test(node.get('text')),
					i;

				// If the current node does NOT match the search condition
				// specified by the user...
				if (!visible) {

					// Check to see if any of the child nodes of this node
					// match the search condition.  If they do then we will
					// mark the current node as visible as well.
					for (i = 0; i < len; i++) {
						if (children[i].isLeaf()) {
							//visible = children[i].get('visible');
							visible = v.test(children[i].get('text'));
						} else {
							visible = filterFn(children[i]);
						}
						if (visible) {
							break;
						}
					}

				} else { // Current node matches the search condition...

					// Force all of its child nodes to be visible as well so
					// that the user is able to select an example to display.
					for (i = 0; i < len; i++) {
						children[i].set('visible', true);
					}

				}
				return visible;
			},v;
			if (searchValue.length < 1) {
				treeStore.clearFilter();
			} 
			else {
				v = new RegExp(searchValue, 'i');
				treeStore.getFilters().replaceAll({
					filterFn: filterFn
				});
			}
        }
    },
    onTreeSearchOpt: function(btn) {
		var me = this;
		if (!me.treeSearchWin) {
			me.treeSearchWin = Ext.create('Ext.ramco.TreeSearchWindow', {
				scrollable: true,
				closable: true,
				modal: true,
				width: 400
			});
		}		
		me.treeSearchWin.showBy(btn, "tl-bl?");
		me.treeSearchWin.tree = me;
		me.treeSearchWin.focus();
	},/*
	beforeLayout: function() {
        var me = this,
            el = me.getEl(),
            td = el ? el.up('td') : null;
        if (td) {
            me.setHeight(td.getHeight());
        }
        me.callParent();
    } */
	setStore: function(store) {
        var me = this;
        		 
        store = me.applyStore(store);
 
        // If there is no rootnode defined, then create one. 
        if (!store.getRoot()) {
            store.setRoot({});
        }
		
        // Store must have the same idea about root visibility as us BEFORE callParent binds it. 
        store.setRootVisible(me.rootVisible);
 
        if (me.enableLocking) {
            me.reconfigure(store);
        } 
		else {
            if (me.view) {
                me.view.setRootNode(store.getRootNode());
            }
            me.bindStore(store);
        }
		me.mon(store, {            
            update: me.onDataUpdate,
            scope: me
        });
    },
	onClearDataSelection: function(store) {
        var me = this;
        Ext.Object.eachValue(store.byIdMap, function(node) {
			if (node.data.sel) {
				node.data.sel = "false";
				node.removeCls("x-tree-item-selected");
			}
		});
    },
	onDataUpdate: function(store, record, operation, modField, details, eOpts) {
        var me = this;		
        Ext.Object.eachValue(store.byIdMap, function(node) {			
			if (node.data.sel == "true" || node.data.sel == true) {
				node.addCls("x-tree-item-selected");
			}
		});
    }
});

//TreeGrid
Ext.define('Ext.ramco.TreeGridPanel', {
    extend: 'Ext.tree.Panel',
    alias: 'widget.ramcotreegrid',
    initComponent: function() {
		var me = this;
		me.dockedItems = [{
        dock: 'top',
        xtype: 'toolbar',
        itemId: 'gridToolbar',
        //defaultButtonUI : 'grid-toolbar',
        overflowHandler: 'scroller',
        defaults: {
            scale: 'small',
            padding: 0
        },
        items: [

            {
                itemId: 'btnFirst',
                xtype: 'button',
                iconCls: 'x-fa fa-backward'
            }, {
                itemId: 'btnPrev',
                xtype: 'button',
                iconCls: 'x-fa fa-caret-left'
            }, {
                itemId: 'rowNav',
                xtype: 'numberfield',
                visibleLength: 1,
                minValue: 1,
                maxValue: 1,
                hidden: true
            }, {
                itemId: 'dspRow',
                xtype: 'component',
                html: rvw_resources.R142,
				// AHBG-24044
				tpl: '{v}'
            }, {
                itemId: 'btnNext',
                xtype: 'button',
                iconCls: 'x-fa fa-caret-right'
            }, {
                itemId: 'btnLast',
                xtype: 'button',
                iconCls: 'x-fa fa-forward'
            }, {
                itemId: 'btnInsert',
                xtype: 'button',
                iconCls: 'x-fa fa-plus'
            }, {
                itemId: 'btnDelete',
                xtype: 'button',
                iconCls: 'x-fa fa-minus'
            }, {
                itemId: 'btnCut',
                xtype: 'button',
                iconCls: 'x-fa fa-cut'
            }, {
                itemId: 'btnCopy',
                xtype: 'button',
                iconCls: 'x-fa fa-copy'
            }, {
                itemId: 'menuImport',
                xtype: 'button',
                iconCls: 'x-fa fa-download',
                menu: [{
                    text: rvw_resources.R026,
                    itemId: 'btnImpExcel',
                    iconCls: 'x-fa fa-file-excel-o'
                }, {
                    text: rvw_resources.R161,
                    hidden: true,
                    itemId: 'btnImpOffice',
                    iconCls: 'x-fa fa-file-excel-o'
                }]
            }, {
                itemId: 'btnExport',
                xtype: 'button',
                iconCls: 'x-fa fa-upload',
                menu: [{
                    text: rvw_resources.R162,
                    itemId: 'btnExpExcel',
                    iconCls: 'x-fa fa-file-excel-o'
                }, {
                    text: rvw_resources.R163,
                    itemId: 'btnExpOffice',
                    hidden: true,
                    iconCls: 'x-fa fa-file-excel-o'
                }, {
                    text: rvw_resources.R164,
                    itemId: 'btnExpPdf',
                    iconCls: 'x-fa fa-file-pdf-o'
                }, {
                    text: rvw_resources.R165,
                    itemId: 'btnExpHtml',
                    iconCls: 'x-fa fa-html5'
                }]
            },
            '-',
            '->',
            '-', {
                xtype: 'combobox',
                itemId: 'fieldList',
                store: {
                    fields: ['vid', 'name'],
                    proxy: {
                        type: 'memory',
                        reader: 'array'
                    }
                },
                queryMode: 'local',
                displayField: 'name',
                valueField: 'vid',
                grow: true,
                growToLongestValue: true,
                forceSelection: true,
				//TECH-31386
				matchFieldWidth: false,
				listConfig:{
					minWidth: 120
				}
            }, {
                xtype: 'textfield',
                itemId: 'fieldSearch',
                emptyText: rvw_resources.R170,
                searchIcon: true,
                role: 'uipage'
            }
        ]
    }, {
        dock: 'right',
        xtype: 'container',
        itemId: 'gridScroller',
        hidden: true,
        width: 17,
        focusable: true,
        layout: {
            type: 'vbox',
            align: 'stretchmax',
            vertical: true,
            pack: 'center',
            stretchMaxPartner: 'gridSlider'
        },
        items: [{
            width: 17,
            xtype: 'component',
            itemId: 'headerSpace',
            cls: 'x-headerSpace',
            height: 24
        }, {
            width: 17,
            xtype: 'button',
            itemId: 'btnUp',
            iconCls: 'x-fa fa-caret-up',
            ui: 'plain',
            cls: 'x-scrollBtn',
            height: 17
        }, {
            itemId: 'gridSlider',
            xtype: 'ramcoslider',
            width: 17,
            margin: 0,
            padding: 0,
            flex: 1,
            vertical: true,
            value: 1,
            increment: 1,
            minValue: 1,
            maxValue: 1,
        }, {
            width: 17,
            xtype: 'button',
            itemId: 'btnDown',
            iconCls: 'x-fa fa-caret-down',
            cls: 'x-scrollBtn',
            ui: 'plain',
            height: 17
        }]
    }],
        me.callParent();
        var topbar = me.getDockedComponent('tblTree'),
            expand = topbar ? topbar.getComponent('expandall') : null,
            collapse = topbar ? topbar.getComponent('collapseall') : null,
            filter = topbar ? topbar.getComponent('filter') : null,
            treesearch = me.search = topbar ? topbar.getComponent('treesearch') : null;
		//TECH-38754
		me.titlePosition = (RamcoRTC.settings.isExt2 == true) ? 2 : 0;	
        if (expand)
            me.mon(expand, {
                click: me.onExpandClick,
                scope: me
            });
        if (collapse)
            me.mon(collapse, {
                click: me.onCollapseClick,
                scope: me
            });
        if (filter)
            me.mon(filter, {
                click: me.onFilterClick,
                scope: me
            });
		//TECH-28711	
		me.mon(me,{
			itemExpand: me.onTreeGridNodeExpand,
			scope: me
		});	
    },
	onClearDataSelection: function(store) {},
	//TECH-28711
	onTreeGridNodeExpand: function(record, eOpts) {
		var me = this,
			view = me.getView(),
			ilbo = view.up('ilbo'),
			ilboConfig,
			element;
		
		ilboConfig = ilbo.ilboConfig;
		element = me;
		
		if (record.data.expanded && record.data.loaded) {
			return false;
		}
		else if (me.view.rendered) {
			ilbo.fireEvent('treegridexpand', me, record, eOpts);									
		}
	},
    processState: function(views) {},
    getColumnById: function(name) {
        var me = this,
            columns = me.getColumns(),
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        return column;
    }
});

Ext.define('Ext.Ramco.tree.plugin.TreeViewDragDrop', {
    extend: 'Ext.tree.plugin.TreeViewDragDrop',
    alias: 'plugin.ramcotreeviewdragdrop',
	onViewRender: function(view) {
        var me = this,
            ownerGrid = view.ownerCt.ownerGrid || view.ownerCt,
            scrollEl;
 
        ownerGrid.relayEvents(view, ['beforedrop', 'drop']);
        
        if (me.enableDrag) {
            if (me.containerScroll) {
                scrollEl = view.getEl();
            }
            me.dragZone = new Ext.tree.ViewDragZone(Ext.apply({
                view: view,
                ddGroup: me.dragGroup || me.ddGroup,
                dragText: me.dragText,
                displayField: me.displayField,
                repairHighlightColor: me.nodeHighlightColor,
                repairHighlight: me.nodeHighlightOnRepair,
                scrollEl: scrollEl,
				beforeInvalidDrop: me.beforeInvalidDrop
            }, me.dragZone));
        }
 
        if (me.enableDrop) {
            me.dropZone = new Ext.tree.ViewDropZone(Ext.apply({
                view: view,
                ddGroup: me.dropGroup || me.ddGroup,
                allowContainerDrops: me.allowContainerDrops,
                appendOnly: me.appendOnly,
                allowParentInserts: me.allowParentInserts,
                expandDelay: me.expandDelay,
                dropHighlightColor: me.nodeHighlightColor,
                dropHighlight: me.nodeHighlightOnDrop,
                sortOnDrop: me.sortOnDrop,
                containerScroll: me.containerScroll
            }, me.dropZone));
        }
    },
	beforeInvalidDrop: function(d, e, g) {
		var me = this,
            ownerGrid = d.view.ownerCt.ownerGrid || d.view.ownerCt;
			ownerGrid.validDrop = false;
        return true;
    }	
});

// TECH-32588 - Setting Empty Text for Empty / Null - Tree Column Value
Ext.define('Ext.data.o.TreeStore', {
	override: 'Ext.data.TreeStore',
	config: {        
        defaultRootText: ''
    }
});

//TreeGrid
Ext.define('Ext.ramco.RSTreeGridPanel', {
    extend: 'Ext.tree.Panel',
    alias: 'widget.ramcorstreegrid',
	rootVisible:false,	
	reserveScrollbar: true,
	enableCtxMenu: true,
	enableTreeDD: true,
	//TECH-39636
	bufferedRenderer: false,
	userCls: 'x-ramco-treegrid',
	//split:true,
	selModel:
	{
		//type: 'rowmodel',
		type: 'ramcotreemodel',
		mode: "MULTI",
		ignoreRightMouseSelection: true
	},
	config:{
		insertFlag: true,
        deleteFlag: true,
		backFlag: true,
		//bufferedGrid: false,
		expandFlag: true,
		collapseFlag: true,
		filterFlag: true,		
		exportFlag: true,
        importFlag: true,
		downloadFlag: true,
		uploadFlag: true,
		segTreeBtnGroup: null,
		copyParentFlag: true,
		copyChildFlag: true,
		copyParentChildFlag: true,
		cutChildFlag: true,
		cutParentChildFlag: true,
		mlExpFlag: true,
		pasteFlag: true,		
        showRowNumber: true,
        showSelection: true,
        showHeader: true,
        showToolbar: true,
        showScrollBar: false,
        showNoRows: false,
        showDefault: false,        
        reqBorder: true,
        visibleRows: 5,
        rowHeight: 18,
        value: null,
        stripeRows: true,
        forceFit: false,
        autoHeight: false,		
        searchFlag: true,
		personalization: {},
		columnLines: true //TECH-32778
	},
	/*plugins: {ptype: 'cellediting', clicksToEdit: 1, id: 'gridCellEdit'},	
	  viewConfig: {		
		plugins:
			{
				ptype: 'treeviewdragdrop',
				ddGroup: 'two-trees-drag-drop',
				appendOnly: true,
				sortOnDrop: true,
				containerScroll: true,
				allowContainerDrops: true				
			}
	},*/
    initComponent: function() {
		var me = this,
			newNoOfRows = me.getVisibleRows(),
            stripeRows = me.getStripeRows(),
            insertFlag = me.getInsertFlag(),
            deleteFlag = me.getDeleteFlag(),			
			backFlag = me.getBackFlag(),
			//bufferedGrid = me.getBufferedGrid() || false,
			filterFlag = me.getFilterFlag(),
			exportFlag = me.getExportFlag(),
			importFlag = me.getImportFlag(),
			mlExpFlag = me.getMlExpFlag(),
			downloadFlag = me.getDownloadFlag(),
			uploadFlag = me.getUploadFlag(),
			copyParentFlag = me.getCopyParentFlag(),
			copyChildFlag = me.getCopyChildFlag(),
			copyParentChildFlag = me.getCopyParentChildFlag(),
			cutChildFlag = me.getCutChildFlag(),
			cutParentChildFlag = me.getCutParentChildFlag(),
			pasteFlag = me.getPasteFlag(),
            showRowNumber = me.getShowRowNumber(),
            showSelection = me.getShowSelection(),
            header = me.getShowHeader(),
            showToolbar = me.getShowToolbar(),
            showNoRows = me.getShowNoRows(),
            showDefault = me.getShowDefault(),
            reqBorder = me.getReqBorder(),
            forceFit = me.getForceFit(),
            searchFlag = me.getSearchFlag(),
			columnLines = me.getColumnLines(); //TECH-32778
			//TECH-38754
		me.titlePosition = (RamcoRTC.settings.isExt2 == true) ? 2 : 0;
		me.dockedItems = [{
        dock: 'top',
        xtype: 'toolbar',
        itemId: 'rsTreeToolbar',		
        //defaultButtonUI : 'grid-toolbar',
        overflowHandler: 'scroller',
        defaults: {
            scale: 'small',
            padding: 0
        },
        items: [
            {
				itemId: 'rowNav',
				xtype: 'numberfield',
				visibleLength: 2,
				minValue: 1,
				maxValue: 1,
				hidden: true
			},{
				itemId: 'dspRow',
				xtype: 'component',					
				html: rvw_resources.R142,
				hidden: true
			}, 
			{
                itemId: 'btnInsert',
                xtype: 'button',
				tooltip: rvw_resources.R264,
                iconCls: 'x-fa fa-plus',
				hidden: !insertFlag
            }, {
                itemId: 'btnDelete',
                xtype: 'button',
				tooltip: rvw_resources.R265,
                iconCls: 'x-fa fa-minus',
				hidden: !deleteFlag
            }, {
                itemId: 'btnBack',
                xtype: 'button',
				hidden: true,
                iconCls: 'x-fa fa-reply'
				}, 
				'-',
				{
					itemId: 'btnExapnd',
					xtype: 'button',	
					tooltip: rvw_resources.R304,
					iconCls: 'tech-expand'
            }, {
					itemId: 'btnCollapse',
					xtype: 'button',
					tooltip: rvw_resources.R305,
					iconCls: 'tech-collapse'                
				},						
				{
                itemId: 'btnFilter',
                xtype: 'button',
				hidden: true,
                iconCls: 'x-fa fa-filter'
            },{
                itemId: 'btnExpExcel',
                xtype: 'button',
					hidden: true,
				tooltip: rvw_resources.R266,
                iconCls: 'x-fa fa-expand'                
            },
			,{
                itemId: 'btnImpExcel',
                xtype: 'button',
					hidden: true,
				tooltip: rvw_resources.R267,
                iconCls: 'x-fa fa-compress'
            },			
			'-',
			{
				itemId: 'btnDownload',
				xtype: 'button',
				hidden: true,
				tooltip: rvw_resources.R266,				
				iconCls: 'x-fa fa-download'                
			},
			{
				itemId: 'btnUpload',
				xtype: 'button',
				hidden: true,
				tooltip: rvw_resources.R267,				
				iconCls: 'x-fa fa-upload'                
			},
				//'-',
			{
			xtype: 'segmentedbutton',
			itemId: 'segTreeBtnGroup',
			allowDepress: true,
			items: [
				{
					itemId: 'btnCopyParent',
					xtype: 'button',
					value:'0',
					tooltip: rvw_resources.R268,
					iconCls: 'tech-copy_parent'                
				},{
					itemId: 'btnCopyChild',
					xtype: 'button',
					value:'1',
					tooltip: rvw_resources.R269,
					iconCls: 'tech-copy_child'                
				},{
					itemId: 'btnCopyParentChild',
					xtype: 'button',
					value:'2',
					tooltip: rvw_resources.R270,
					iconCls: 'tech-copy_parentchild'                
				},{
					itemId: 'btnCutChild',
					xtype: 'button',
					value:'3',
					tooltip: rvw_resources.R271,
					iconCls: 'tech-move_child'                
				},{
					itemId: 'btnCutParentChild',
					xtype: 'button',
					value:'4',
					tooltip: rvw_resources.R272,
					iconCls: 'tech-move_parentchild'                
				}
			],
			listeners: {
				  toggle: function(container, button, pressed) {
						var treeGrid = this.ownerCt.ownerCt,
							selModel = null,
							treeStore = null;								
						if (treeGrid) {
							treeStore = treeGrid.getStore();
							selModel = treeGrid.getSelectionModel();								
						}
						if (treeStore) {
						   selModel.deselectAll();
						   Ext.Object.eachValue(treeStore.byIdMap, function(node) {
								if (node) {
									node.set('sel', 'false');		
									node.set('keyDown', false);
								}
							});
						}
				  	}
			 	}
			},
			'->',			
            '-',
			{
					itemId: 'btnTreeMlExpand',
                xtype: 'button',
					iconCls: 'x-fa fa-arrows-alt',
					tooltip: 'Expand Tree Grid'
					//hidden: !RamcoRTC.settings.enableFullGrid
            },
				'-', 
			{
                xtype: 'combobox',
                itemId: 'fieldList',
                store: {
                    fields: ['vid', 'name'],
                    proxy: {
                        type: 'memory',
                        reader: 'array'
                    }
                },
                queryMode: 'local',
                displayField: 'name',
                valueField: 'vid',
                grow: true,
                growToLongestValue: true,
                forceSelection: true,
				//TECH-31386
				matchFieldWidth: false,
				listConfig:{
					minWidth: 120
				}
            }, {
                xtype: 'textfield',
                itemId: 'fieldSearch',
                emptyText: rvw_resources.R170,
                searchIcon: true,
                role: 'uipage'
            }
        ]
    }, 
	{
        dock: 'right',
        xtype: 'container',
        itemId: 'gridScroller',
        hidden: true,
        width: 17,
        focusable: true,
        layout: {
            type: 'vbox',
            align: 'stretchmax',
            vertical: true,
            pack: 'center',
            stretchMaxPartner: 'gridSlider'
        },
        items: [{
            width: 17,
            xtype: 'component',
            itemId: 'headerSpace',
            cls: 'x-headerSpace',
            height: 24
        }, {
            width: 17,
            xtype: 'button',
            itemId: 'btnUp',
            iconCls: 'x-fa fa-caret-up',
            ui: 'plain',
            cls: 'x-scrollBtn',
            height: 17
        }, {
            itemId: 'gridSlider',
            xtype: 'ramcoslider',
            width: 17,
            margin: 0,
            padding: 0,
            flex: 1,
            vertical: true,
            value: 1,
            increment: 1,
            minValue: 1,
            maxValue: 1,
        }, {
            width: 17,
            xtype: 'button',
            itemId: 'btnDown',
            iconCls: 'x-fa fa-caret-down',
            cls: 'x-scrollBtn',
            ui: 'plain',
            height: 17
        }]
		}];
    	if (me.enableTreeDD === true) {
    	
			me.lockedViewConfig = {
				stripeRows: stripeRows,			
				plugins:
				{
					ptype: 'ramcotreeviewdragdrop',
					ddGroup: 'two-trees-drag-drop',
					appendOnly: true,
					sortOnDrop: true,
					containerScroll: true,
					allowContainerDrops: true				
				}
			};
			me.normalViewConfig = {
				stripeRows: stripeRows,			
				plugins:
				{
					ptype: 'ramcotreeviewdragdrop',
					ddGroup: 'two-trees-drag-drop',
					appendOnly: true,
					sortOnDrop: true,
					containerScroll: true,
					allowContainerDrops: true				
				}
			};
			
			me.contextMenu =  [
					{
						itemId: 'ctxCopyParent',					
						value:'0',
						text: rvw_resources.R268,						
						iconCls: 'tech-copy_parent'                
					},{
						itemId: 'ctxCopyChild',					
						value:'1',
						text: rvw_resources.R269,
						iconCls: 'tech-copy_child'                
					},{
						itemId: 'ctxCopyParentChild',					
						value:'2',
						text: rvw_resources.R270,
						iconCls: 'tech-copy_parentchild'                
					},{
						itemId: 'ctxCutChild',					
						value:'3',
						text: rvw_resources.R271,
						iconCls: 'tech-move_child'                
					},{
						itemId: 'ctxCutParentChild',					
						value:'4',
						text: rvw_resources.R272,
						iconCls: 'tech-move_parentchild'                
					}
			];
			me.selModel = {
				type: 'ramcotreemodel',
				mode: "MULTI",
				ignoreRightMouseSelection: true
			};
		}
		me.plugins = [{ptype: 'cellediting', clicksToEdit: 1, id: 'gridCellEdit'}];
		if (!showRowNumber && me.columns.length > 2) {
            me.columns[0].hidden = true;
        }
        if (!showSelection && me.columns.length > 2) {
            me.columns[1].hidden = true;
        }
        me.hideHeaders = !header;	
		me.normalViewConfig = {
			scrollable: {
                x: 'auto',
                y: true
            }
		};
		if (reqBorder) {
            me.cls = Ext.baseCSSPrefix + 'grid-border';            
        }
		me.callParent();
		var view = me.getView(),
            topbar = me.getDockedComponent('rsTreeToolbar'),
			rowNav = topbar ? topbar.getComponent('rowNav') : null,
            dspRow = topbar ? topbar.getComponent('dspRow') : null,            
			insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            deleteBtn = topbar ? topbar.getComponent('btnDelete') : null,
			btnExapnd = topbar ? topbar.getComponent('btnExapnd') : null,
			btnCollapse = topbar ? topbar.getComponent('btnCollapse') : null,			
			btnDownload = topbar ? topbar.getComponent('btnDownload') : null,
			btnUpload = topbar ? topbar.getComponent('btnUpload') : null,
			segTreeBtnGroup = topbar ? topbar.getComponent('segTreeBtnGroup') : null,
			btnCopyParent = topbar ? topbar.getComponent('btnCopyParent') : null,
			btnCopyChild = topbar ? topbar.getComponent('btnCopyChild') : null,
			btnCopyParentChild = topbar ? topbar.getComponent('btnCopyParentChild') : null,
			btnCutChild = topbar ? topbar.getComponent('btnCutChild') : null,
			btnCutParentChild = topbar ? topbar.getComponent('btnCutParentChild') : null,
			btnTreeMlExpand = topbar ? topbar.getComponent('btnTreeMlExpand') : null,
			fieldList = topbar ? topbar.getComponent('fieldList') : null,
            fieldSearch = topbar ? topbar.getComponent('fieldSearch') : null,
			height = 0,
			columns = me.getVisibleColumnManager().getColumns(),            
			
			rowHeight = me.getRowHeight();
			rowHeight += 4;
		me.setRowHeight(rowHeight);
		me.setSegTreeBtnGroup(segTreeBtnGroup);
		if (me.enableTreeDD === true) {
			segTreeBtnGroup.setValue('4');
		}
		else {
			segTreeBtnGroup.hide();
		}
		height = me.getTreeGridHeight(newNoOfRows);
		if (btnTreeMlExpand && mlExpFlag === false)
			btnTreeMlExpand.hide();
		if (me.enableCtxMenu === true) {
			me.mon(me,{
				itemcontextmenu: me.onTreeGridContextmenu,
				scope: me
			});
		}
		if (topbar) {
            topbar[showToolbar ? 'show' : 'hide']();
        }
		if (!searchFlag) {
            fieldList.hide();
			fieldSearch.hide();
        } 
		else {
            fieldList.show();
			fieldSearch.show();
		}
		if (fieldList && columns) {
            var flag = true,
                data = [{
                    vid: 'v0',
                    name: rvw_resources.R007
                }];
            columns.forEach(function(element, index, array) {
                if (!(element.dataIndex == 'rn' || element.dataIndex == 'sel' || element.xtype == "ramcotemplatecolumn" || element.xtype == "imagecolumn" || element.xtype == "fileattachcolumn" || element.xtype == "attachcolumn" || element.xtype == "deletecolumn")) {
                    if (element.hidden != true) {
                        data.push({
                            vid: element.dataIndex,
                            name: element.text || ''
                        });
                    }                    
					if (element.hidden != true && (element.editor || element.xtype == 'attachcolumn' || element.xtype == 'ramcogridcheck')) {
						modifiedFlag = true;
                        if (element.xtype == 'attachcolumn')
                            flag = false;
                        me.setInsertFlag(insertFlag);
                    }
                }
            });
			if (flag && !showToolbar && insertFlag)
				insertFlag = insertFlag;
            else if (flag && !showToolbar && insertFlag)
                insertFlag = showToolbar;
            me.setInsertFlag(insertFlag);
            fieldList.getStore().setData(data);
            fieldList.setValue('v0');
        }
		if (height > 0) {
            me.setHeight(height);
        }	
        if (insertBtn)
            me.mon(insertBtn, {
                click: me.onTreeNodeInsert,
                scope: me
            });
        if (deleteBtn)
            me.mon(deleteBtn, {
                click: me.onTreeNodeDelete,
                scope: me
			});
		if (btnExapnd)
            me.mon(btnExapnd, {
                click: me.onTreeNodeExapnd,
                scope: me
			});
		if (btnCollapse)
            me.mon(btnCollapse, {
                click: me.onTreeNodeCollapse,
                scope: me
			});	
		if (btnDownload)
            me.mon(btnDownload, {
                click: me.onshowExcel,
                scope: me
            });		
		if (btnUpload) {
            me.mon(btnUpload, {
                click: me.onImportExcel,
                scope: me
            });
            if (!btnUpload.isHidden()) {
                me.importWindow = Ext.create('Ext.ramco.Import', {
                    height: 200,
                    width: 400,
                    scrollable: true,
                    hidden: true,
                    modal: true
                });
                me.importWindow.BtnImport.on('click', me.onBtnImportClick, me);
            }
        }        	
		if (btnTreeMlExpand) {
			me.mon(btnTreeMlExpand, {
                click: me.onTreeMlExpand,
                scope: me
            });
		}
		me.mon(me, {
			beforedrop: me.onNodeBeforeDrop,
			drop:me.onNodeDrop,
			scope: me
		});
		if (reqBorder === false) {
            if (me.lockable) {
                view.lockedGrid.addCls('noborder');
                view.normalGrid.addCls('noborder');
                view.ownerGrid.addCls('noborder');
            } else {
                me.addCls('noborder');
            }
        }
		if (me.lockable) {
            view.normalGrid.view.rowHeight = rowHeight;
            view.lockedGrid.view.rowHeight = rowHeight;
            view.lockedGrid.rowHeight = rowHeight;
            view.normalGrid.rowHeight = rowHeight;            
			view.normalGrid.view.onAfter('resize', me.onViewResize, me);
        } else {
            view.rowHeight = rowHeight;            
			view.onAfter('resize', me.onViewResize, me);
        }
    },
	onViewResize: function(view, width, height, oldWidth, oldHeight, eOpts) {
        var me = this,
            topbar = me.getDockedComponent('gridToolbar'),
            scrollbar = me.getDockedComponent('gridScroller'),
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            columns,
            totalCols,
            showScrollBar = me.getShowScrollBar(),
            insertFlag = me.getInsertFlag(),
            newNoOfRows = me.getVisibleRows(),
            autoHeight = me.getAutoHeight(),
            element1,
            gridView,
            column,
            oColumn,
            width = 0,
            colWidth = 0,
            forceFit = me.columnFit,
            nGridView,
			gridWidth = 0,
            box;
        //view = view ? view : me.getView();
        view = view ? view : me.normalGrid.getView();

		if (me.rendered === false)
			return;
		nGridView = view.normalGrid ? view.normalGrid.view : view;
		gridWidth = me.getWidth();
        //width = view.getWidth();		
		width = nGridView.getWidth();
        //columns = view.ownerCt.getVisibleColumns();
		columns = nGridView.ownerCt.getVisibleColumns();
        totalCols = 0;
		if(gridWidth == width) {
			//if(scrollbar && scrollbar.isVisible()) {
				width = width - scrollbar.getWidth();
			//}
		}
        if (columns) {
            var colWidth = 0,
                hasForceFit = false,
                oWidth = 0;
			if (columns && columns.length > 0) {	
				var len = columns.length,
					i = 0,
					element = null;
				for(; i < len; i++) {
					element = columns[i];
					//columns.forEach(function(element, index, array) {
                if (!(element.dataIndex == 'rn' || element.dataIndex == 'sel')) {
                    if (element.hidden != true && element.rendered) {
                        if (element.hasPer) {
                            colWidth += element.getWidth();
                            //colWidth += element.width;
                        } else {
                            if (element.oldWidth)
                                colWidth += element.oldWidth;
                            else
                                colWidth += element.getWidth();
                        }
                        if (element.forceFit)
                            hasForceFit = true;
						else
							hasForceFit = false;
                        totalCols++;
                    }
                }
                if (element.hidden != true && element.editor) {
                    insertFlag = true;
                }
				}
			}
			//);
            if (width >= colWidth && colWidth > 0) {
                if (hasForceFit)
                    forceFit = true;
				width = width - 17;
                var i = 0,
                    cWidth = (width - colWidth),
                    len = columns.length,
                    newWidth = 0,
                    col = 0,
                    aWidth = parseFloat((cWidth / colWidth), 10),
                    rWidth = cWidth - (aWidth * colWidth);
                for (; i < len; i++) {
                    column = columns[i];
                    if (column.rendered) {
                        me.suspendEvents();
						me.suspendLayouts();
                        col++;
						column.suspendEvents();
						column.suspendLayouts();
                        if (forceFit) {
                            if (!column.oldWidth)
                                column.oldWidth = column.getWidth();
                            newWidth = parseInt(column.oldWidth * aWidth, 10);
                            rWidth += (column.oldWidth * aWidth) - newWidth;
                            if (col == totalCols)
                                newWidth += rWidth;
                            if (column.hasPer) {
                                column.setWidth(column.width + newWidth);
                            } else
                                column.setWidth(column.oldWidth + newWidth);
                        } else {
                            if (col == totalCols) {
								// TECH-38195 / TECH-38215
								// TECH-38611
                                if (!column.oldWidth)
                                    column.oldWidth = column.getWidth();								
                                if (column.hasPer) {
                                    column.setWidth(cWidth + column.width);
                                } else {
                                    column.setWidth(cWidth + column.oldWidth);
                                }
								//column.setWidth(cWidth + column.getWidth());
                            } else {
                                if (column.hasPer) {
                                    column.setWidth(column.width);
                                } else if (column.oldWidth) {
                                    column.setWidth(column.oldWidth);
                                } else {
                                    column.oldWidth = column.getWidth();
                                }
                            }
                        }
						column.resumeLayouts();
                        column.resumeEvents();
						me.resumeLayouts();
                        me.resumeEvents();
                    }
                }
            }
        }
		//if (hasForceFit && nGridView.rendered)
		if (nGridView.rendered)
			nGridView.updateLayout();
        /*if (view.rendered) {
            var gridHeight = me.getGridHeight(newNoOfRows);
            if (autoHeight && me.tr < newNoOfRows)
                gridHeight = me.getGridHeight(parseInt(me.tr));
            if (gridHeight > 0) {
                me.suspendLayouts();        
                me.setHeight(gridHeight);
				me.resumeLayouts();        
            }
        }*/
    },
	getSelectedNode: function() {
		var me = this,
			navModel = me.getNavigationModel(),
			selectedRecord = navModel.getLastFocused(),			
			recordId = null,
			selectedNode = null;
		if (selectedRecord) {
			recordId = selectedRecord.record.id;
			selectedNode = me.store.getNodeById(recordId);			
		}
		return selectedNode;
	},
	onTreeNodeExapnd: function(btn) {
        var me = this,
			selectedNode = null;
		selectedNode = me.getSelectedNode();
		if (selectedNode) {			
			selectedNode.expand();
		}
        else { 
			me.expandAll();
		}
    },
	onTreeNodeCollapse: function(btn) {
        var me = this,
			selectedNode = null;
		selectedNode = me.getSelectedNode();
		if (selectedNode) {			
			selectedNode.collapse();
		}
		else {
			me.collapseAll();
		}
    },
	onTreeMlExpand: function() {
		var me = this;		
		me.isMlExpand = true;
		me.fireEvent('mlTreeExpand', this);	
	},
	onTreeGridContextmenu: function(view, record, item, index, e, eOpts) {
        var me = this,
            menu = me.menu,
			records = me.getSelectionModel().getSelection();
		me.ctxArguments = arguments;
		if (records.length > 0) {
			if (!menu) {
				me.menu = menu = new Ext.menu.Menu({
					items: {
						text: 'paste',
						id: 'ctxPaste',
						handler: function() {
							me.onTreeGridCtxPaste();
						}
					}
				});
			}				
			menu.showAt(e.event.x, e.event.y, false);		
		}
		else {
			Ext.RamcoMsg.alert(rvw_resources.R260, "Select Atleast One or More Records !");
		}
		e.preventDefault();
		e.stopPropagation();
    },
	onTreeGridCtxPaste : function(view, record, item, index, e, eOpts) {		
		var me = this,
			view = null,
			record = null,
			item = null,
			index = null,
			e = null,
			eOpts = null,
			navModel = me.getNavigationModel(),
			data = {records: me.getSelectionModel().getSelection(), view: null},
			treeddplugin = null;
		//LH-439	
		data.records = data.records.sort(function(a, b) {var s = me.store.indexOf(a) - me.store.indexOf(b); if(s>0) s = 1; else if(s<0) s=-1; else s=0; return s});	
		if (me.ctxArguments.length > 5) {
			view = me.ctxArguments[0];
			record = me.ctxArguments[1];
			item = me.ctxArguments[2];
			index = me.ctxArguments[3];
			e = me.ctxArguments[4];
			eOpts = me.ctxArguments[5];
		}			
		if (view) {
			treeddplugin = view.plugins[0];
			data.view = view;		
			me.onNodeBeforeDrop(item, data, record);
			treeddplugin.dropZone.handleNodeDrop(data, record, "append");
			me.onNodeDrop(item, data, record);
			navModel.setPosition(record);
			view.refresh();
		}
	},
	onBoxReady: function() {
        var me = this;
        me.callParent(arguments);		
    },
	onBtnImportClick: function() {
        var me = this,
            fields = null,
            formData = new FormData(),
            impWindow = me.importWindow;
        fields = impWindow.form.getForm().getFields();
		if(fields && fields.items && fields.items.length > 0) {
			var len = fields.items.length,
					  i = 0,
					  element = null;
			for(; i < len; i++) {
				element = fields.items[i];
				//fields.items.forEach(function(element, index, array) {
            formData.append(element.getItemId(), element.getValue());
			// TECH-30180
			//if (typeof element.extractFileInput == 'function') {
			// TECH-32997 / LBC-445
            if (element.button && element.button.fileInputEl) {
				//element.clearOnSubmit = true;
				// Import Format - Settings based
                //var fileInput = element.extractFileInput(),
				var fileInput = element.button.fileInputEl.dom,
					j = 0, fileName, fileExtension, fileObj, errorText, acceptFormat = (!Ext.isEmpty(RamcoRTC.settings.importAcceptFormats)) ? RamcoRTC.settings.importAcceptFormats : ["csv", "txt", "xlsm"];
                if (fileInput) {
                    for (; j < fileInput.files.length; j++) {
							//formData.append('file', fileInput.files[j]);
							fileObj = fileInput.files[j];
							if (fileObj) {
								fileName = (fileObj.name) ? fileObj.name.split('.') : null;
								if (fileName) {
									fileExtension = fileName[fileName.length - 1];				
									if (fileExtension && acceptFormat.indexOf(fileExtension) < 0) {
										errorText = Ext.String.format('Invalid file to import. Allowed file types are: "<b>{0}</b>"', acceptFormat);
										Ext.RamcoMsg.alert(rvw_resources.R260, errorText);
										return false;
									}
								}
								formData.append('file', fileInput.files[j]);
							}
						}
					}
				}
			}
		}
		//);
        me.fireEvent('importexcel', me, formData);
    },
	getTreeGridHeight: function(newNoOfRows) {
        var me = this,
            rowHeight = me.getRowHeight(),
            showToolbar = me.getShowToolbar(),
            header = me.getShowHeader(),
            view = me.view,
            headerHeight = 0,
            height = 0;
        if (newNoOfRows == 0)
            newNoOfRows++;
        height = (newNoOfRows * (rowHeight + 1));
        if (me.rendered) {
            if (header) {
                var headerCt;
                if (me.lockable)
                    headerCt = view.normalView.getHeaderCt();
                else
                    headerCt = view.getHeaderCt();
                headerHeight = headerCt.getHeight();
                if (headerHeight == 0)
                    headerHeight = me.oldheaderHeight;
                height += headerHeight;
            }
            var nGridView = view.normalGrid ? view.normalView : view;
            if (nGridView.rendered && nGridView.el.dom.scrollWidth > nGridView.el.dom.clientWidth)
                height += Ext.getScrollbarSize().height;
        }
        if (showToolbar != false)
            height += 26;
        return height;
    },
	onTreeNodeInsert: function(btn, e, obj) {
        var me = this,
            store = me.store,
			selectionModel = me.getSelectionModel(),
			navModel = me.getNavigationModel(),
            record = store.getAt(store.getCount() - 1),            
			cr = null,
            tr = store.tr,
            visibleRows = me.getVisibleRows(),
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,            
			start = null,
			end = null,
			nodeSelected = false,
			topbar = me.getDockedComponent('rsTreeToolbar'),
			appendedNode = null,
			rowNav = topbar ? topbar.getComponent('rowNav') : null,
            si, ei, vsi,
			editCol, focusCol = 2, lcelctxt, fcell, grdPlug, colView;
        me.lastEvent = 'insert';
		vsi = 1;
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		if(selectionModel.selected.length > 0) {
			record = selectionModel.selected.getAt(0);
			nodeSelected = true;		
		}		       
		if (nodeSelected)
			cr = store.tr + 1;
		start = cr > visibleRows ? cr - visibleRows : 1;
		end = (visibleRows) + (start - 1);
		/*if (!(cr >= si && cr <= ei)) {
			me.store.start = me.tr - (me.visibleRows * 3) + 1;
			me.store.end = me.tr;
			me.store.cr = me.tr + 1;                
			me.store.vsi = me.store.cr;
			me.store.changed = true;
			me.fireEvent('movetorow', me, start, end, me.store.vsi);
		} 
		else {*/
			appendedNode = this.createDummyRecord(nodeSelected, cr);
			/*navModel.setPosition(appendedNode.data.rn, 2, navModel.cell);
			navModel.focusPosition(navModel.getPosition());
			Ext.defer(function() { selectionModel.select(appendedNode);	}, 100);*/
			me.updateLayout();
			lcelctxt = new Ext.grid.CellContext(navModel.position.view);
			editCol = me.getVisibleFirstEditorColumn();
			if (editCol) {
				focusCol = editCol.getVisibleIndex();
				colView = (editCol.isLocked()) ? me.view.lockedView : me.view.normalView;
				lcelctxt = new Ext.grid.CellContext(colView);
			}
			fcell = lcelctxt.setPosition(me.store.indexOf(appendedNode), focusCol);
			//fcell.column = me.getColumnById('v2');
			navModel.focusPosition(fcell);
			selectionModel.select(appendedNode);
			if(editCol) {
				grdPlug = me.getPlugin('gridCellEdit');
				grdPlug.startEditByPosition(fcell);
			}
			/*me.setCurrentRow();
		}*/
    },
    onTreeNodeDelete: function(btn, e, obj) {
		var me = this,
			gridId = me.itemId;
		if (me.parentMl) {
			gridId = me.parentMl.itemId;
		}
        this.fireEvent('deleterow', this, gridId);
    },	
	createDummyRecord: function(nodeSelected, cr) {
        var me = this,
            item = null,
            name = null,
            val = null,
            visibleRows = me.getVisibleRows(),
            autoHeight = me.getAutoHeight(),
            insertFlag = me.getInsertFlag(),
            values = {},
            //value = me.rsColumnsValue || me.value.columnsValue || me.lastValue.columnsValue,
			value = '',
            topbar = me.getDockedComponent('rsTreeToolbar'),
            rowNav = topbar ? topbar.getComponent('rowNav') : null,
            dspRow = topbar ? topbar.getComponent('dspRow') : null,
            len = me.store.getRange(),
            colLen = me.getColumns().length,
            column = me.getColumns(),
			scrollbar = me.getDockedComponent('gridScroller'),
			showToolbar = me.getShowToolbar(),
            showScrollBar = me.getShowScrollBar(),
			gridSlider = me.down('#gridSlider'),
            storeAdd = true,
			appendedNode = null,
			//target = me.selModel.getSelection()[0] || me.getRootNode(),
			target = null,
            vr = null;
			target = me.selModel.getSelection()[0] || me.getRootNode();
			if (me.parentMl) {
				value = me.parentMl.rsColumnsValue || me.parentMl.value.columnsValue || me.parentMl.lastValue.columnsValue;
				if (Ext.isEmpty(me.tic))
					me.tic = me.store.tic
			}
			else {
				value = me.rsColumnsValue || me.value.columnsValue || me.lastValue.columnsValue;        
			}			
            me.tic++;
			me.store.tic = me.tic;			
			values.rn = me.tic;			
			values.sel = false;
            values.leaf = true;
			values.nid = "tmp_" + me.tic;
			values.pnid = target.data.nid;
			values.expandable = true;
			values.expanded = true;
			values.isNew = true;
			values.ex = '1';
            if (value) {
                for (item in value) {
                    item = value[item];
                    name = item.n;
                    val = item.v || '';
                    if (name)
                        values[name] = val;
                }
            }            
			if(target.isLeaf())
				target.set('leaf', false);
			if(Ext.isFunction(target.expand))
				target.expand();
			appendedNode = target.appendChild(values);
			//me.store.add([values]);        
        if (autoHeight) {
            me.suspendEvents();
            if (me.tic < visibleRows) {
                me.setHeight(me.getGridHeight(parseInt(me.tic) + (insertFlag ? 1 : 0)));
            } else {
                me.setHeight(me.getGridHeight(visibleRows));
            }
            me.resumeEvents();
        }		
		return appendedNode;
    },
	onNodeBeforeExpand : function(node , index , item , eOpts) {		
		var me =this;
		if(node) {
			node.set('ex', '1');
			me.fireEvent('expand', me,node,index,item);
		}		
	},
	onNodeBeforeCollapse: function(node , index , item , eOpts) {		
		if(node) {
			node.set('ex', '0');
		}		
	},
	onNodeBeforeDrop: function(node , data , overModel , dropPosition , eOpts) {
		data.copy = false;		
		var me = this,			
			len = data.records ? data.records.length : 0,
			r = 0,
			srcTree = data.view.grid.ownerCt.itemId,
			selectionModel = me.getSelectionModel(),
			navModel = me.getNavigationModel(),		
			targetTree = me.itemId,
			srcGrid = data.view.grid.ownerCt,			
			record,
			clndata = [],
			clnRec = null,
			tmpnid = '',
			ce = 0,
			matchRec,
			hasExist = false,			
			curItem,
			segTrbtn = srcGrid.getSegTreeBtnGroup();
			records = data.records;
			if (!Ext.isEmpty(segTrbtn) && (segTrbtn.value == '0' || segTrbtn.value == '1' || segTrbtn.value == '2')) {
				data.copy = true;
			}
			if (me.parentMl && Ext.isEmpty(me.tic))
				me.tic = me.store.tic
			//if(srcTree != targetTree) {
				for(;r < len; r++) {
					tr = me.tic;
					record = records[r];
					for (ce = 0; ce < clndata.length; ce ++) {
						curItem = clndata[ce];
						//LH-439
						//matchRec = curItem.findChild(record);
						matchRec = curItem.findChild("in", record.get("in"), true);
						if(matchRec) {
							hasExist = true;
							break;
						}
					}
					if (hasExist === true) {
						hasExist = false;
						continue;
					}
					if(segTrbtn.value == '0') {
						clnRec = record.copy(null, false, false);
						clnRec.data.leaf = true;
						clnRec.childNodes = null;
						delete clnRec.childNodes;
					}
					else
						clnRec = record.copy(null, false, true);
					if ((segTrbtn.value === '0' || segTrbtn.value === '1' || segTrbtn.value === '2'))
						record.set("isDel", "false");
					else {
						record.set("isDel", "true");						
						overModel.set("ex", clnRec.get("ex"));
					}
					clnRec.set("parentId", overModel.get("id"));
					clnRec.set("orn", clnRec.get("rn"));
					clnRec.set("rn", ++tr);
					tmpnid = "tmp_"+ tr;
					clnRec.set("opnid", clnRec.get("pnid"));
					clnRec.set("nid", tmpnid);
					clnRec.set("sel", "false");
					clnRec.set("isNew", true);
					clnRec.set("pnid", overModel.get("nid"));					
					me.tic = tr;
					clnRec.childNodes = me.parseTreeGridNode(record, clnRec, segTrbtn, tmpnid);	
					clndata.push(clnRec);					
				}
				data.records = clndata;
				me.tic = tr;
			//}
			/*else {
				for(;r < len; r++) {
					record = records[r];					
					record.set("pnid", overModel.get("pnid"));
					//record.set("nid", overModel.get("nid") || '');
				}
			}*/		
	},	
	parseTreeGridNode: function(record, rootNode, segTrbtn, tmpnid) {
		var me =this,			
			c=0,
			childNodes, childNode, childNodeLen,
			clnRec,
			tmpChnid,
			childRecord,
			clnData = [],
			recNodes, recNode, recNodeLen;
		if(rootNode && rootNode.hasChildNodes()){
			childNodes = rootNode.childNodes;
			recNodes = record.childNodes;
			childNodeLen = childNodes.length;
			c=0;
			if (me.parentMl && Ext.isEmpty(me.tic))
				me.tic = me.store.tic
			for (; c < childNodeLen; c++) {
				tr = me.tic;
				childNode =  childNodes[c];
				childRecord = recNodes[c];
				if(segTrbtn.value == '0') {
					clnRec = childNode.copy(null, false, false);
					clnRec.data.leaf = true;
					clnRec.childNodes = null;
					delete clnRec.childNodes;
				}
				else
					clnRec = childNode.copy(null, false, true);
				
				childNode = clnRec;
				childNode.set("orn", childNode.get("rn"));
				childNode.set("rn", ++tr);
				tmpChnid = "tmp_"+ tr;
				childNode.set("nid", tmpChnid);
				childNode.set("isNew", true);
				childNode.set("sel", "true");
				childNode.set("opnid", childNode.get("pnid"));
				childNode.set("pnid", tmpnid);
				me.tic = tr;				
				if ((segTrbtn.value === '0' || segTrbtn.value === '1' || segTrbtn.value === '2'))
					childRecord.set("isDel", "false");
				else
					childRecord.set("isDel", "true");				
				if(childNode.hasChildNodes()){
					childNode.childNodes = (me.parseTreeGridNode(childRecord, childNode, segTrbtn, tmpChnid));
				}
				clnData.push(childNode);
			}
		}
		return clnData;
	},
	onNodeDrop: function(node , data , overModel , dropPosition , eOpts) {
		console.log(data.view.grid.ownerCt.store.tr);
		data.copy = false;
		var me = this,		
			tr = me.tic,			
			r = 0,
			srcTree = data.view.grid.ownerCt.itemId,
			targetTree = me.itemId,
			record,
			len = 0,			
			selectionModel = me.getSelectionModel(),
			navModel = me.getNavigationModel(),			
			srcGrid = data.view.grid.ownerCt,
			srcGridTr = srcGrid.tic,
			srcTreeStore = data.view.grid.store,
			//records = srcTreeStore.getRemovedRecords(),
			records = data.records,
			len = records.length,
			segTrbtn = srcGrid.getSegTreeBtnGroup(),
			selRows = [],
			selRow;
			if (me.parentMl && Ext.isEmpty(me.tic))
				tr = me.tic = me.store.tic
			if (me.parentMl)
				targetTree = me.parentMl.itemId;			
			for(;r < len; r++) {
				record = records[r];
				record.set("sel", "false");
				record.set("isNew", "true");
				selRow = {
					_mod: true,
					isNew: true,
					rn: record.get('orn'),
					cin: record.get('in') || '0',
					pnid: record.get('pnid'),
					sel: "false"
				};
				selRows.push(selRow);
				me.setParseTreeSelection(record, selRows);
			}
			if(len > 0) {
				//navModel.focusPosition(navModel.getPosition());
				//selectionModel.select(record);
				//TECH-32261
				//srcGrid.updateValue(srcGrid.getValue());
				//me.updateValue(me.getValue());
				if (srcGrid.itemId != me.itemId)
					srcGrid.updateStoreValues(srcGrid, srcGrid.getValue());
				me.updateStoreValues(me, me.getValue());
				srcTreeStore.selRows = me.store.selRows = selRows;
				srcGrid.tic = srcGridTr;
				me.tic = tr;				
				/*if(record.parentNode)
					record.parentNode.expand();*/
			}
			if (!Ext.isEmpty(segTrbtn) && (segTrbtn.value == '0' || segTrbtn.value == '1' || segTrbtn.value == '2'))
				return;
			else if(len > 0) {
				this.fireEvent('deleterow', srcGrid, targetTree, record.data.rn, 2);
				/*var lcelctxt = new Ext.grid.CellContext(navModel.position.view)			
				var fcell = lcelctxt.setPosition(record.data.rn, 2);			
				navModel.focusPosition(fcell);*/
			}
			me.updateLayout();
	},
	//TECH-32261
	updateStoreValues: function(grid, newValue) {
		var me = this;
		grid.vsi = (newValue.vsi < 1) ? 1 : newValue.vsi;
		grid.si = newValue.si;
		grid.tr = newValue.tr;
		grid.tic = newValue.tic;
		grid.store.nsr = parseInt(newValue.nsr, 10);
		grid.store.start = grid.si;
		grid.store.si = grid.si;
		if (grid.store.end > grid.tr)
			grid.store.end = grid.tr
		grid.store.tr = grid.tr;
		grid.store.vr = newValue.vr || grid.store.vr;
		grid.store.tic = newValue.tic;
		grid.store.vsi = grid.vsi || newValue.vsi;
	},
	setParseTreeSelection : function(rootNode, selRows) {
		var me =this,			
			c=0,												
			childNodes, childNode, childNodeLen,
			selRow;
		if (rootNode && rootNode.hasChildNodes) {
			childNodes = rootNode.childNodes;
			childNodeLen = childNodes.length;
			c=0;
			for (; c < childNodeLen; c++) {
				childNode =  childNodes[c];										
				childNode.set("sel", "false");
				childNode.set("isNew", "true");
				selRow = {
					_mod: true,
					rn: childNode.get('orn'),
					isNew: true,
					cin: childNode.get('in') || '0',
					pnid: childNode.get('pnid'),
					sel: "false"
				};
				selRows.push(selRow);
				if(childNode.hasChildNodes){					
					me.setParseTreeSelection(childNode, selRows);
				}
			}
		}
	},
	//TECH-32422
	setStore: function(store) {
		//TECH-32556
		var me = this;
		if (store && !store.getRoot()) {
            store.setRoot({});
        }
		me.reconfigure(store);
		//TECH-32925
		me.store = store;
		me.setValueOnData();		
	},
	/*setStore: function(store) {
		console.log('treeSetStore');
        var me = this;
        me.mon(store, {
            refresh: me.setValueOnData,  
            //nodebeforeexpand: me.onNodeBeforeExpand,
			//nodebeforecollapse: me.onNodeBeforeCollapse,
            scope: me
        });        
        me.setValueOnData();
        if (me.autoLoad && !store.isEmptyStore && !(store.loading || store.isLoaded())) {
            store.load();
        }
		 me.callParent(arguments);
		 store.commitChanges();
    },
	setValueOnData: function() {
		console.log('treeSetValueOnData' + this.itemId);
        var me = this;
        if (me.lastValue)
            me.updateValue(me.lastValue);
        else if (me.value)
            me.updateValue(me.value);
        if (me.isSort) {
            me.isSort = false;
        } else {
            if (me.sortCol) {
                me.sortCol.setSortState(null);
                delete me.sortCol;
            }
        }
        me.mun(me.store, {
            refresh: me.setValueOnData
        });
    },*/
	//TECH-32556
	setValueOnData: function() {
		console.log('treeSetValueOnData' + this.itemId);
        var me = this;
        if (me.lastValue)
            me.updateValue(me.lastValue);
        else if (me.value)
            me.updateValue(me.value);
		if (me.isSort) {
            me.isSort = false;
        } else {
            if (me.sortCol) {
                me.sortCol.setSortState(null);
                delete me.sortCol;
            }
        }        
    },		
	onshowExcel: function(btn, e, obj) {
        this.fireEvent('exportexcel', this);
    }, 
	onImportExcel: function() {
        this.importWindow.show();
        this.importWindow.showMessage('');
    },
	getGridExportData: function(type, id, act, ilbo) {
        var me = this,
            columns = me.getColumns(),
            column, columnValue, xmlData, width, colMandatory = "true", // AHBG-27164
            data = me.getValue(), encodedText;
        data.columnsValue = me.rsColumnsValue;
        if (type == 'pdf') {
            //xmlData = '<gd ac="' + act + '" ic="' + ilbo + '" tc="">';
			//xmlData += '<c n="' + id + '" c="" ct="RSGrid" sl="true" st="0" ><vi>';
			xw = new XMLWriter('UTF-8');
			xw.writeStartDocument();
			xw.writeStartElement('gd');
				xw.writeAttributeString("ac", act);
				xw.writeAttributeString("ic", ilbo);
				xw.writeAttributeString("tc", "");
			xw.writeStartElement('c');
				xw.writeAttributeString("n", id);
				xw.writeAttributeString("c", "");
				xw.writeAttributeString("ct", "RSGrid");
				xw.writeAttributeString("sl", "true");
				xw.writeAttributeString("st",  "0");					
			xw.writeStartElement('vi');
            for (key in columns) {
                column = columns[key];
                width = (column.width > column.minWidth) ? column.width : column.minWidth;
                columnValue = data.columnsValue[column.dataIndex];
                if (column.xtype == "ramcotemplatecolumn" || column.xtype == "fileattachcolumn" || column.xtype == "attachcolumn" || column.xtype == "deletecolumn" || column.xtype == "imagecolumn" || column.hidden == true)
                    continue;
                if (column && columnValue) {
					encodedText = Ext.htmlEncode(column.text) || column.text;
                    //xmlData += '<vw n="' + column.name + '" vt="' + columnValue.vt + '" ht="' + encodedText + '" dt="' + columnValue.dt + '" ml="' + column.maxLength + '" dl="" w="' + width + '"/>'
					xw.writeStartElement('vw');
						xw.writeAttributeString("n", column.name);
						xw.writeAttributeString("vt", columnValue.vt);
						xw.writeAttributeString("ht", encodedText);
						xw.writeAttributeString("dt", columnValue.dt);
						xw.writeAttributeString("ml",  column.maxLength);
						xw.writeAttributeString("dl", (columnValue.dt == "numeric")?column.format:"");//TECH-29515
						xw.writeAttributeString("w", width);							
					xw.writeEndElement();
                }
            }
            //xmlData += '</vi></c></gd>';
			xw.writeEndElement();
			xw.writeEndElement();
			xw.writeEndElement();
			xmlData = xw.flush();
			xw.close();
        } else {
            //xmlData = '<trqi><vi df="'+ me.deleteFlag +'">';
			xw = new XMLWriter('UTF-8');
			xw.writeStartDocument();
			xw.writeStartElement('trqi');
			xw.writeStartElement('vi');
				xw.writeAttributeString("df", me.deleteFlag);
            for (key in columns) {
                column = columns[key];
                width = (column.width > column.minWidth) ? column.width : column.minWidth;
                columnValue = data.columnsValue[column.dataIndex];
                if (column.xtype == "ramcotemplatecolumn" || column.xtype == "fileattachcolumn" || column.xtype == "attachcolumn" || column.xtype == "deletecolumn" || column.xtype == "imagecolumn" || column.hidden == true)
                    continue;
                if (column && columnValue) {
					encodedText = Ext.htmlEncode(column.text) || column.text;
                    //xmlData += '<vw n="' + column.name + '" vt="' + columnValue.vt + '" c="' + encodedText + '" dt="' + columnValue.dt + '" ml="' + column.maxLength + '" dl="" w="' + width + '" h="auto" m="true"/>'
					xw.writeStartElement('vw');
						xw.writeAttributeString("n", column.name);
						xw.writeAttributeString("vt", columnValue.vt);
						xw.writeAttributeString("c", encodedText);
						xw.writeAttributeString("dt", columnValue.dt);
						xw.writeAttributeString("ml",  column.maxLength);
						xw.writeAttributeString("dl", (columnValue.dt == "numeric")?column.format:"");//TECH-29515
						xw.writeAttributeString("w", width);
						xw.writeAttributeString("h", "auto");
						// AHBG-27164
						// xw.writeAttributeString("m", "true");
						colMandatory = (column.mandatory?"true":"false");
						xw.writeAttributeString("m", colMandatory);
						
						/* TECH-32817 / TECH-32371 - List Edit & Sync View - Export Excel Handling */
						var editor = column.editor,
							lvsArray = editor && editor.columns,
							lvsVal = [];
						// TECH-40133
						if (column.customListEdit != true && editor && editor.xtype == 'ramcolistedit') {
							for (var m = 0; m < lvsArray.length; m++) {
								lvsVal.push(lvsArray[m].itemId);
							}
							xw.writeAttributeString("lvs", lvsVal.join(';'));
							xw.writeAttributeString("sc", editor.searchView);
							xw.writeAttributeString("sd", editor.mappedView.join(';'));
							xw.writeAttributeString("dc", editor.mapCtrl.join(';'));
						}
					xw.writeEndElement();
                }
            }
            //xmlData += '</vi></trqi>';
			xw.writeEndElement();
			xw.writeEndElement();
			xmlData = xw.flush();
			xw.close();
        }
        return xmlData;
    },    
    processState: function(views) {
		var me = this,            
            colunmManager = me.getColumnManager(),
            columns = colunmManager.getColumns(),
			topbar = me.getDockedComponent('rsTreeToolbar'),
			fieldList = topbar ? topbar.getComponent('fieldList') : null,            
            showScrollBar = me.getShowScrollBar(),
            insertFlag = me.getInsertFlag(),
            newNoOfRows = me.getVisibleRows(),
            element1,
            gridView,
            column,
            oColumn,
            width = 0,
            colWidth = 0,
            forceFit = me.columnFit,
            nGridView,
			vP='',
            persData = [];
        view = me.getView();
        me.coldef = false;
        nGridView = view.normalGrid ? view.normalGrid.view : view;
        me.suspendEvents();
        for (element1 in views) {
            gridView = views[element1];
			vP = me.getAllColumnIndex(gridView.id);			
            if (!persData[gridView.id]) {
                persData[gridView.id] = {
                    vid:gridView.id,
					p: vP,
                    wi: gridView.width,
                    pa: false,
                    ch:true
                };
            }
            column = colunmManager.getHeaderByDataIndex(gridView.id);
            if (gridView.coldefactive == "true")
                me.coldef = true;
            if (column) {
                if (gridView.columncaption) {
                    column.setText(gridView.columncaption);
                }
				// TECH-32964 - PFP-60
				if(column.initialConfig && column.initialConfig.hidden)
					column.isStateHidden = true;
                if (!Ext.isEmpty(gridView.visible)) {
					// TECH-35534 / TECH-35642 / TECH-35619 / TECH-35651
                    if (gridView.visible == 'n' && column.isVisible()) {
                        column.hide();
                    }
                    if (gridView.visible == 'y' && column.isHidden()) {
                        column.show();
                    }
					
					//TECH-28696 / TECH-29031
					// TECH-32964 - PFP-60
					if (Ext.isEmpty(gridView.st) || gridView.st == '0' || gridView.st == '2') {
						if(gridView.visible == "y")
							column.isStateHidden = false;
						else
							column.isStateHidden = true;
                    }
					if(me.formFields) {
						var fField = '';													
						fField = me.formItems.getComponent(column.dataName)								
						if(fField) {
							if (gridView.visible == 'n') {
								fField.hide();
							}
							else {
								fField.show();
							}
						}
					}
                }
				/*if (gridView.enable == 'y')
					column.enable();
				else if(gridView.enable == 'n')
					column.disable();*/
				if (gridView.enable == 'y')
					column.stateEnabled = true;
				else if(gridView.enable == 'n')
					column.stateEnabled = false;
                if (!Ext.isEmpty(gridView.width) && column.rendered) {
                    if (!column.oldWidth)
                        colWidth = column.oldWidth = column.getWidth();
                    else
                        colWidth = column.oldWidth;
                    gridView.width = parseInt(gridView.width);
                    if (!isNaN(gridView.width) && !column.viewProcessed) {
                        column.setWidth(colWidth + gridView.width);
                        column.hasPer = true;
                        column.cellWidth = (colWidth + gridView.width);
                    }
                }
                if (!Ext.isEmpty(gridView.choose)) {
                    if (gridView.choose == '0')
                        column.hide();
                    else
                        column.show();
                }
            }
        }
        me.resumeEvents();
        me.setPersonalization(persData);
        /*if (nGridView.rendered) {
            me.onViewResize(nGridView);
        }*/
        /* UPDATING GRID SEARCH COMBO - ON PERFORMING COLUMN CHOOSER OPTION */
		var cols = me.getVisibleColumnManager().getColumns(),
			gridSearchData = [{ vid: 'v0', name: rvw_resources.R007 }];
		if (!Ext.isEmpty(cols)) {
			for (var k = 0; k < cols.length; k++) {
				if (!(cols[k].dataIndex == 'rn' || cols[k].dataIndex == 'sel')) {
					gridSearchData.push({
						vid: cols[k].dataIndex,
						name: cols[k].text || ''
					});
				}
			}
			if (gridSearchData.length > 1) {
				fieldList.getStore().setData(gridSearchData);
				fieldList.setValue('v0');
			}
		}
        if (me.coldef) {
            me.dummyRec = views;
        }
        //me.setPersonalization(null);
    },	
	updateValue: function(newValue) {			
		 var me = this,
            view = me.getView(),
			vr,
			checkHeader = me.down('ramcogridcheck'),
			visibleRows = me.getVisibleRows(),
            insertFlag = me.getInsertFlag(),
            showToolbar = me.getShowToolbar(),
            showScrollBar = me.getShowScrollBar(),
			ilbo = me.up('ilbo'),
            viewModel = ilbo.getViewModel(),
            topbar = me.getDockedComponent('rsTreeToolbar');        
		if (!RamcoRTC.isGProto) {
			//TECH-32925	
			//if (!me.store || me.store.isEmptyStore) {
			if (!me.store || me.store.storeId != me.itemId) {	 
	            me.lastValue = newValue;
	            if (!me.columnInit && newValue.columnsValue) {
	                var columns = me.getColumns(),
	                    column, columnValue;
	                for (key in columns) {
	                    column = columns[key];
	                    if (column) {
	                        columnValue = newValue.columnsValue[column.dataIndex];
	                        if (columnValue) {
	                            column.setFormat(columnValue['ft']);
	                        }
	                    }
	                }
	                me.columnInit = true;
	            }
	            return;
	        }
		}
        if (newValue) {
            delete me.lastValue;
            if (newValue.columns) {
                me.rsColumns = newValue.columns || [];
                me.rsColumnsValue = newValue.columnsValue || [];
                if (!me.columnInit && newValue.columnsValue) {
                    var columns = me.getColumns(),
                        column, columnValue;
                    for (key in columns) {
                        column = columns[key];
                        if (column) {
                            columnValue = newValue.columnsValue[column.dataIndex];
                            if (columnValue) {
                                column.setFormat(columnValue['ft']);
                            }
                        }
                    }
                }
            }            
            me.vsi = (newValue.vsi < 1) ? 1 : newValue.vsi;
			me.si = newValue.si;
            me.tr = newValue.tr;
			me.tic = newValue.tic;
            me.store.nsr = parseInt(newValue.nsr, 10);
            me.store.start = me.si;
			me.store.si = me.si;            
            if (me.store.end > me.tr)
                me.store.end = me.tr
            me.store.tr = me.tr;
            me.store.vr = newValue.vr || me.store.vr;            
			me.store.tic = newValue.tic;
            me.store.vsi = me.vsi || newValue.vsi;
			//me.store.bufferedStore = me.getBufferedGrid() || false;
			console.log('treeupdate');
			vr = (me.vsi + (me.store.vr / 3)) >= me.tr ? me.tr : (me.vsi + (me.store.vr / 3) - 1);			
            if (!me.store.cr)
                me.store.cr = me.vsi;
            if (newValue.columnsValue) {
                var columns = me.getColumns(),
                    column, columnValue;
                for (key in columns) {
                    column = columns[key];
                    if (column) {
                        columnValue = newValue.columnsValue[column.dataIndex];
                        if (columnValue) {
                            column.setFormat(columnValue['ft']);
                            if (columnValue['scc'])
                                column.setText(columnValue['scc'])
							//if(columnValue.store) {
							if(columnValue.store && viewModel && viewModel.storeInfo) {
								colStore = viewModel.storeInfo[me.itemId + "_" + column.dataIndex + "_store"];
								colStore.loadData(columnValue.store);
								colStore.commitChanges();
								columnValue.store = null;
								delete columnValue.store;
							}
                        }
                    }
                }
                me.columnInit = true;
            }
			//TECH-30810
			me.store.setRoot(newValue.store);
			//TECH-32422
			me.store.commitChanges();
			/*if (true) {
				me.suspendEvents();
				if (newValue.tic < visibleRows) {
					me.setHeight(me.getTreeGridHeight(parseInt(newValue.tic)));
				} else {
					me.setHeight(me.getTreeGridHeight(visibleRows));
				}
				me.resumeEvents();
			}*/
			me.store.selRows = null;
			me.setCurrentRow();			
        }        
	},
	setCurrentRow: function() {
		 if (!this.view)
            return;
        var me = this,
            view = me.getView(),
            plugins = me.plugins,
            cellPlugin = plugins ? plugins[0] : null,
            colIndex = 0,
            lastEvent = me.lastEvent,
            editableCols = Ext.ComponentQuery.query('{editor}', me.columns),
            insertFlag = me.getInsertFlag();
        if (me.taskid) {
            clearTimeout(me.taskid);
            delete me.taskid;
        }
        if (insertFlag && (me.tic <= 0 || me.tic <= me.store.end + 1) && (me.lastEvent != 'onfirst' && me.lastEvent != 'onlast')) {
            me.createDummyRecord();
        }
	},
	doSearch: function(value, ctrl) {
        var me = this,
            searchCombo = null,
            searchBy = null,
            searchText = null,
            searchValue = null,
            store = me.getStore(),
            startIndex = store.vsi,
            record = null;

        if (me.showToolbar) {
            me.searchCombo = searchCombo = me.down('#fieldList');
            if (searchCombo) {
               searchBy =  me.searchBy = searchCombo.getValue() || 'v0';//TECH-29580
            }
            me.searchText = searchText = me.down('#fieldSearch');
            if (searchText) {
               searchValue =  me.searchValue = searchText.getValue();//TECH-29580
            }
            if (!Ext.isEmpty(searchBy) && !Ext.isEmpty(searchValue)) {
                if (searchBy == "v0") {
                    var row = 0,
                        col = 0,
                        colName = undefined,
                        colValue = undefined,
                        isFound = false,
                        recordCount = store.getCount(),
                        lockedColumns = me.lockedGrid.getColumns(),
                        normalColumns = me.normalGrid.getColumns(),
                        columnsLen = lockedColumns.length + normalColumns.length,
                        column = null;
                    if (me.lastSearch && me.lastSearch.text != searchValue)
                        delete me.lastEvent;
                    if (Ext.isEmpty(me.searchIndex)) {
                        record = store.findRecord('rn', startIndex, 0);
                        if (record)
                            me.searchIndex = store.indexOf(record);
                        else
                            me.searchIndex = 0;
                        me.searchColIndex = 2;
                    }
                    row = me.searchIndex;
                    col = me.searchColIndex;
                    for (; row < recordCount; row++) {
                        if (col == columnsLen) {
                            col = 0;
                            row++;
                        }
                        record = store.getAt(row);
                        if (record) {
                            for (; col < columnsLen; col++) {
                                if (col < lockedColumns.length)
                                    column = lockedColumns[col];
                                else
                                    column = normalColumns[col - lockedColumns.length];
                                if (column.isHidden())
                                    continue;
                                me.searchColIndex = col + 1;
                                colName = column.dataIndex;
                                colValue = record.get(colName);
                                 if(column.dataType == "date")//TECH-29580
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat)	
								else if(column.dataType == "date-time")
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat)
								else if(column.dataType == "time")
									colValue = Ext.util.Format.date(colValue,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat)	
								else
									colValue = me.getRawFormat(column.dataType, colValue);
                                if (me.compare(colValue, searchValue)) {
                                    isFound = true;
                                    break;
                                }
                            }
                        }
                        if (isFound) {
                            me.searchIndex = row;
                            break;
                        } else {
                            col = 2;
                        }
                    }
                    if (isFound) {
                        record = store.getAt(me.searchIndex);
                        me.scrollToRecord(me.searchIndex, record, colName, searchValue);
                        delete me.lastEvent;
                    } 
					else
						me.onNoSearchData(me);
					/*
					else if (!isFound && me.lastEvent == 'gridsearch') {
                        me.onNoSearchData(me);
                    } 
					else {
                        record = store.getAt(store.getCount() - 1);
                        if (store.tic > record.get('rn')) {
                            store.vsi = record.get('rn');
                            store.changed = true;
                            me.lastEvent = 'gridsearch';
                            me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, me.afterGridSearch.bind(me));
                        } else if (me.lastSearch) {
                            Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R256, function(btnId) {
                                if (btnId == "ok" || btnId == "yes") {
                                    me.lastEvent = 'gridsearch';
                                    me.searchIndex = 0;
                                    me.searchColIndex = 0;
                                    //me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, false);
                                    me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, me.afterGridSearch.bind(me));
                                }
                                me.lastSearch = null;
                                delete me.lastSearch;
                            });
                        } else
                            me.onNoSearchData(me);
                    }*/
                }
				else {
                    if (Ext.isEmpty(me.searchIndex)) {
                        var recs = store.findRecord('rn', startIndex, 0);
                        if (recs)
                            me.searchIndex = store.indexOf(recs);//TECH-29907
                        else
                            me.searchIndex = 0;
                    } else
                        me.searchIndex++;

                    var colDataType = me.getColumnById(me.searchBy);
					//TECH-29580
					if(colDataType.dataType == "date" || colDataType.dataType == "date-time" || colDataType.dataType == "time" || colDataType.dataType == "hdate" || colDataType.dataType == "hdate-time" || colDataType.dataType == "htime"){
						var storeIdx =  store.findBy(function(rec,Id){
							var recData = rec.get(me.searchBy),
								recField = me.getColumnById(me.searchBy),
								colVal; //= Ext.util.Format.date(recData,RamcoRTC.userPreference.dateFormat);
							if(recField.dataType == "date")
								colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDate:RamcoRTC.userPreference.dateFormat);
							else if(recField.dataType == "date-time") 
									colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliDateTime:RamcoRTC.userPreference.dateTimeFormat);
							else if(recField.dataType == "time")
									colVal = Ext.util.Format.date(recData,RamcoRTC.settings.isNepali?RamcoRTC.settings.nepaliTime:RamcoRTC.userPreference.timeFormat);
							else if(recField.dataType == "hdate")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							else if(recField.dataType == "hdate-time")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							else if(recField.dataType == "htime")
								colVal = me.getRawFormat(recField.dataType, me.searchValue);
							if(colVal == me.searchValue)
								return true;
						},me,me.searchIndex);
					}
					if(storeIdx > 0){
						record = store.getAt(storeIdx);
					}
					if(Ext.isEmpty(record))
						record = store.findRecord(searchBy, searchValue, me.searchIndex, true);
                    if (record) {
                        me.searchIndex = store.indexOf(record);
                        me.scrollToRecord(me.searchIndex, record, searchBy, searchValue);
                    } 
					else
						me.onNoSearchData(me);
					/*
					else if (!record && me.lastEvent == 'gridsearch') {
                        me.onNoSearchData(me);
                    } 
					else {
                        record = store.getAt(store.getCount() - 1);
                        me.searchIndex = 0;
                        if (store.tic > record.get('rn')) {
                            store.vsi = record.get('rn');
                            store.changed = true;
                            me.lastEvent = 'gridsearch';
                            me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue);
                        } else if (me.lastSearch) {
                            me.fireEvent('gridsearch', me, searchBy.replace('v', ''), searchValue, false);
                            me.lastSearch = null;
                            delete me.lastSearch;
                        } else
                            me.onNoSearchData(me);
                    }*/
                }
            }
        }
        return true;
    },
    afterGridSearch: function() {
        var me = this;
        me.searchIndex = null;
        me.doSearch();
    },
	scrollToRecord: function(index, rec, searchBy, searchText) {
        var me = this,
            store = me.store;
        if (searchBy) {
            me.lastSearch = {
                text: searchText,
                row: index,
                col: searchBy
            };
            me.setSearched(index, searchBy, rec);
        }
    },
	setSearched: function(index, colName, rec) {
        var me = this,
            store = me.getStore(),
            nav = me.getNavigationModel(),
            selModel = me.getSelectionModel(),
            columns = me.getColumns(),
            srchCmb = me.down('#fieldSearch'),
            rowNo = rec.get('rn'),
            column = null,
            scroller = null,
            viewRegion = null,
            lockViewRegion = null,
            cellRegion = null,
            inRange = true,
            lockInRange = false,
            colIndex = 0;
        column = Ext.ComponentQuery.query('{dataIndex == "' + colName + '"}', columns);
        if (column && column.length > 0) {
            colIndex = me.getColumnIndex(colName);
            column = me.getColumnById(colName);
            if (nav) {
                nav.cell = me.getCell(colName.replace('v', ''), rowNo);
                if (nav.cell) {
                    nav.cell = new Ext.dom.Fly(nav.cell);
                    scroller = nav.view.getScrollable();
                    lockViewRegion = nav.view.lockingPartner.getViewRegion();
                    viewRegion = nav.view.getViewRegion();
                    //cellRegion = nav.cell.dom.getViewRegion();
					cellRegion = nav.cell.getViewRegion();
                    lockInRange = lockViewRegion.contains(cellRegion);
                    if (!lockInRange)
                        inRange = viewRegion.contains(cellRegion);
                    /*if (!inRange) {
                        me.onBtnNext();
                    }*/
                    store.cr = rec.get('rn');
                    if (lockInRange) {
                        nav.position.setAll(nav.view.lockingPartner, index, colIndex, rec, column);
                        selModel = nav.view.lockingPartner.getSelectionModel();
                    } else
                        nav.position.setAll(nav.view, index, colIndex, rec, column);
					
					//TECH-39837
					if (selModel) {
						selModel.clearSelections();
						me.clearGridSelection(me);
					}										
					
                    lcelctxt = new Ext.grid.CellContext(nav.position.view);
                    var fcell = lcelctxt.setPosition(colIndex, rowNo);
                    fcell.record = nav.position.record;
                    fcell.rowIdx = nav.position.rowIdx;
                    fcell.column = column;
                    nav.focusPosition(nav.position);
                    // Maintain lastFocused in the view so that on non-specific focus of the View, we can focus the view's correct descendant. 
                    nav.view.lastFocused = nav.lastFocused = nav.position.clone();
                    // Use explicit scrolling rather than relying on the browser's focus behaviour. 
                    // Scroll on focus overscrolls. scrollIntoView scrolls exatly correctly. 
                    /*
                    if (scroller) {
                        scroller.scrollIntoView(nav.cell.dom);
                    }*/
					var topbar = me.getDockedComponent('gridToolbar'),
						rowNav;
					if (topbar) {
						rowNav = topbar.getComponent('rowNav');
						if (rowNav)
							rowNav.setValue(me.store.cr);
					}
					//TECH-39837
					if (fcell && selModel && selModel.view) {
						selModel.view.onCellSelect(fcell, true);
					}
					//TECH-31148						
                    /*if (selModel) {
                        //selModel.select(fcell.record);
						nav.cell.addCls('x-grid-cell-selected');
                    }*/
                }
                Ext.defer(function() {
                    srchCmb.focus();
                }, 50);
            }
        }
    },
	//TECH-39837	
	clearGridSelection: function(grid) {
		if(grid) {
			var selModel = grid.getSelectionModel();			
			if(selModel)
				selModel.clearSelections();			
			var selectedCls = grid.view.selectedCellCls,
				tds = grid.body && grid.body.query("td."+ selectedCls);
			for(td in tds){
				tds[td].classList.remove(selectedCls);
			}			
		}
	},
	//TECH-40238
	gridFocus: function(cellView, CRow) {
        var me = this,
            view = me.getView(),
            keyNav = RamcoRTC.focusCtrl[4],
            rowHeight = parseInt(me.rowHeight + 1),
            nav = me.getNavigationModel(),
            sel = me.getSelectionModel(),
            lokgr = me.getScrollable(),
			topbar = me.getDockedComponent('gridToolbar'),
			rowNav = topbar ? topbar.getComponent('rowNav') : null,            
			visibleRows = me.getVisibleRows(),
			vsiRecords,
			vsiRecord,
            rowIndex = -1,
			editCol = null,
            row, curRowIndex,
			column = null; 
		
		record = me.store.findRecord('rn', CRow);
        if (record)
            rowIndex = me.store.indexOf(record);
        if (rowIndex > -1)
            row = view.getRow(rowIndex);
        row = view.getRow(rowIndex);
        
		if (Ext.isEmpty(editCol) && (me.lastEvent == "cmbSelect" || me.lastEvent == "focusleave" || me.lastEvent == "focusenter" ) && !Ext.isEmpty(cellView)) {
            me.lastEvent = "";
			var getColumn = me.getColumnById("v" + cellView);
            if (getColumn){
                if(typeof getColumn.editor == "object") {
                    editCol = getColumn;
                }
            }
        }
		if(editCol) {
			me.col = editCol.getVisibleIndex();
			nav.view = (editCol.isLocked()) ? me.view.lockedView : me.view.normalView;			
			
			if(nav.lastFocused)
				nav.lastFocused.view = nav.view;
			if(sel)
				sel.view = nav.view;
			me.clearGridSelection(me);
			nav.setPosition(rowIndex, editCol);			
			column = editCol;
		}
		else {			
			var lcelctxt = new Ext.grid.CellContext(nav.position.view);
			var fcell = lcelctxt.setPosition(rowIndex,me.col);			
			var columnManager,
				columns;
			if(nav.position.view) {
				columnManager = nav.position.view.getVisibleColumnManager();
				columns = columnManager.getColumns();
			}
			fcell.record = record;
			fcell.rowIdx = rowIndex;
			if (Ext.isEmpty(columns)) {
				columns =  me.getVisibleColumns();
			}
			column = (columns && columns.length > 0) ? columns[0] : null;
			fcell.column = column;
			if (sel) {				
				sel.clearSelections();
				me.clearGridSelection(me);			
				var colCollection,
					colIndex = me.col;
				if (column) {
					nav.view = (column.isLocked()) ? me.view.lockedView : me.view.normalView;						
					if(nav.lastFocused)
						nav.lastFocused.view = nav.view;				
					sel.view = nav.view;
					colCollection = (column.isLocked()) ? me.lockedGrid.getVisibleColumns() : me.normalGrid.getVisibleColumns();				
					colIndex = colCollection.indexOf(column);
				}								
				if (fcell && sel && sel.view) {
					nav.setPosition(rowIndex, column);
					nav.focusPosition(nav.getPosition());
					sel.view.onCellSelect(fcell, true);
				}
			}
        }
        if (row) {
            if (nav) {
				if (!Ext.isIE) {
					me.updateLayout();
				}				
				nav.setPosition(rowIndex, column);	
				nav.focusPosition(nav.getPosition());
		    }
        }
		if(me.edited || editCol) {
			var grdPlug = me.getPlugin('gridCellEdit');
			if(Ext.isEmpty(nav.position) || Ext.isEmpty(nav.getPosition())){
				nav.setPosition(rowIndex, me.col);
			}
			if (!me.zoomWindow || (me.zoomWindow && !me.zoomWindow.isVisible())) // TECH-30546 / QA-151
				grdPlug.startEditByPosition(nav.getPosition());			
		}		
    },
	getCell: function(viewName, row) {
        var me = this,
            column = me.getColumnById('v' + viewName),
            view = me.getView(),
            record,
            td,
            cell;
        if (viewName == 'sel' || viewName == 'rn')
            return null;
        if (column) {
            if (column.locked || (column.xtype == "ramcotreecolumn" && column.autoLock)) {//TECH-29813/LH-290
                view = view.lockedView;
            } else {
                view = view.normalView ? view.normalView : view;
            }
            record = me.store.findRecord('rn', row);
            if (view && record && column) {
                cell = view.getCell(record, column);
				if(Ext.isEmpty(cell)){//TECH-29813/LH-290
					var idx =  me.store.indexOf(record);
					if(view.bufferedRenderer)
						view.bufferedRenderer.scrollTo(idx);
					cell = view.getCell(record, column);
				}
            }
        }
        return cell;
    },
    getColumnById: function(name) {
        var me = this,
            columns = me.getColumns(),
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        return column;
    },
    getColumnIndex: function(name) {
        var me = this,
            columns = me.getVisibleColumnManager().getColumns(),
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        //return (i - 2);
        return (i);
    },
	getAllColumnIndex: function(name) {
        var me = this,
            //columns = me.getColumns(),
            columns = me.initialConfig.columns,
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }
        //return (i - 2);
		return (i);
    },
    onNoSearchData: function(grid) {
        // TECH-40327
        //Ext.Msg.alert('', rvw_resources.R036, Ext.emptyFn, undefined, 'error');
		Ext.RamcoMsg.alert('', rvw_resources.R036, Ext.emptyFn, undefined, 'error');
        grid.searchIndex = 0;
        grid.searchColIndex = 0;
		var ilbo = this.up("ilbo");
		if(ilbo)
			ilbo.callBackStatusError = true;
    },
    getRawFormat: function(type, value) {
        var ret = value;
        if (Ext.isEmpty(value))
            return value;
        switch (type) {
            case 'hdate':
                ret = Ext.util.Format.date(value, 'B-Q-R');
                break;
            case 'hdate-time':
                ret = Ext.util.Format.date(value, 'B-Q-R G:i:s');
                break;
            case 'htime':
                ret = Ext.util.Format.date(value, 'G:i:s');
                break;
            case 'date':
                ret = Ext.util.Format.date(value, 'Y-m-d');
                break;
            case 'date-time':
                ret = Ext.util.Format.date(value, 'Y-m-d G:i:s');
                break;
            case 'time':
               ret = Ext.util.Format.date(value, 'G:i:s');
                break;
            default:
        }
        return ret;
    },
	compare: function(value, cValue) {
        var objType = typeof value;
        if (objType == "string") {
            return value.toLowerCase().indexOf(cValue.toLowerCase()) > -1;
        }
        return false;
    },
	getVisibleFirstEditorColumn: function() {
		var me = this,
			columns = me.getVisibleColumns(),
			colLen = columns.length,
			curCol = null,
			c =0;
		for(; c < colLen; c++) {
			curCol = columns[c];
			// TECH-33857
			if(!curCol.isHidden() && curCol.stateEnabled != false) {
				if(typeof curCol.editor == "object")
					return curCol;
			}
		}
		return null;
    },	
	//TECH-34475
	onClearDataSelection: function(store) {
        var me = this;
        Ext.Object.eachValue(store.byIdMap, function(node) {
			if (node.data.sel) {
				node.data.sel = "false";
				node.removeCls("x-grid-item-selected");
			}
		});
    },
	onDataUpdate: function(store, record, operation, modField, details, eOpts) {
        var me = this;
        if (record.data.isNew == true && modField && modField[0] != 'sel') {
            if (me.edited) {
				record.data.isNew = false;            
			}
        }
    },
	doDestroy: function() {
        var me = this,
            view = me.getView(),
            topbar = me.getDockedComponent('rsTreeToolbar'),
			insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            deleteBtn = topbar ? topbar.getComponent('btnDelete') : null,
			btnExapnd = topbar ? topbar.getComponent('btnExapnd') : null,
			btnCollapse = topbar ? topbar.getComponent('btnCollapse') : null,			
			btnDownload = topbar ? topbar.getComponent('btnDownload') : null,
			btnUpload = topbar ? topbar.getComponent('btnUpload') : null,
			btnTreeMlExpand = topbar ? topbar.getComponent('btnTreeMlExpand') : null;
			
		if (me.enableCtxMenu === true) {
			me.mun(me,{
				itemcontextmenu: me.onTreeGridContextmenu,
				scope: me
			});	
		}
		me.mun(me, {
			beforedrop: me.onNodeBeforeDrop,
			drop:me.onNodeDrop,
			scope: me
		});
        
        // Toolbar event Handler
        if (insertBtn)
            me.mun(insertBtn, {
                click: me.onTreeNodeInsert,
                scope: me
            });
        if (deleteBtn)
            me.mun(deleteBtn, {
                click: me.onTreeNodeDelete,
                scope: me
            });
		if (btnExapnd)
            me.mun(btnExapnd, {
                click: me.onTreeNodeExapnd,
                scope: me
			});
		if (btnCollapse)
            me.mun(btnCollapse, {
                click: me.onTreeNodeCollapse,
                scope: me
			});		
        if (btnUpload) {
            me.mun(btnUpload, {
                click: me.onImportExcel,
                scope: me
            });
            if (me.importWindow && me.importWindow.BtnImport) {
                me.importWindow.BtnImport.un('click', me.onBtnImportClick, me);
                Ext.destroy(me.importWindow)
                me.importWindow = null;
                delete me.importWindow;
            }
        }
        if (btnDownload)
            me.mun(btnDownload, {
                click: me.onshowExcel,
                scope: me
            });    
		if (btnTreeMlExpand) {
			me.mun(btnTreeMlExpand, {
                click: me.onTreeMlExpand,
                scope: me
            });
		}            
        me.callParent();
    }
});

//TECH-35877 - dont comment on 6.5.2
/*Ext.define('Ext.tree.o.View', {
	override: 'Ext.tree.View',
	 toggle: function(record, deep, callback, scope) {
		//AHBG-24766
		record.phantom = true;
        if (record.isExpanded()) {
            this.collapse(record, deep, callback, scope);
        } 
		else {			
            this.expand(record, deep, callback, scope);
        }
		this.updateLayout();
    }
});*/
//TECH-39599
Ext.define('Ext.tree.o.View', {
	override: 'Ext.tree.View',
	 toggle: function(record, deep, callback, scope) {
		var lstScrollYPos = this.getScrollY();
        if (record.isExpanded()) {
            this.collapse(record, deep, callback, scope);
        } 
		else {			
            this.expand(record, deep, callback, scope);
        }
		this.updateLayout();
		this.setScrollY(lstScrollYPos);
    }
});

Ext.define('Ext.tree.o.ViewDropZone', {
	override: 'Ext.tree.ViewDropZone',
	expandNode : function(node) {
        var view = this.view;
        this.expandProcId = false;
        if (!node.isLeaf() && !node.isExpanded() && view.expand) {            
			view.expand(node);
            this.expandProcId = false;
        }
    },
	getPosition: function(e, node) {
        var view = this.view,
            record = view.getRecord(node),
            y = e.getY(),
            noAppend = record.isLeaf(),
            noBelow = false,
            region = Ext.fly(node).getRegion(),
            fragment;
			noAppend = false;
 
        // If we are dragging on top of the root node of the tree, we always want to append. 
        if (record.isRoot()) {
            return 'append';
        }
 
        // Return 'append' if the node we are dragging on top of is not a leaf else return false. 
        if (this.appendOnly) {
            return noAppend ? false : 'append';
        }
 
        if (!this.allowParentInserts) {
            noBelow = record.hasChildNodes() && record.isExpanded();
        }
 
        fragment = (region.bottom - region.top) / (noAppend ? 2 : 3);
        if (y >= region.top && y < (region.top + fragment)) {
            return 'before';
        }
        else if (!noBelow && (noAppend || (y >= (region.bottom - fragment) && y <= region.bottom))) {
            return 'after';
        }
        else {
            return 'append';
        }
    }
});
//TECH-29358
//TECH-29739
//TECH-30599
//TECH-30598

// TECH-40912
Ext.define('Ext.ramco.OrgChart', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.ramcoorgchart',
    config: {
        value: null,
        store: null,
        defData: null,
        defFile: null
    },
    orient: 'vertical',
    hasDefData: false,
    viewType: 'ramcoorganizationchart',
    layout: 'border',
    cls: 'x-panel-orgchart',
    width: '100%',
    drawMode: 'Line',
    initComponent: function() {
        var me = this,
            store, view, viewConfig, tree,
            nodeSize = [parseInt(me.nodeWidth, 10) || 500, parseInt(me.nodeHeight, 10) || 250];

        viewConfig = Ext.apply({
            region: 'center',
            xtype: me.viewType,
            cls: Ext.baseCSSPrefix + 'orgchart-view',
            focusCls: '',
            drawMode: me.drawMode,
            orient: me.orient,
            nodeSize: nodeSize,
            emptyText: me.emptyText || ''
        }, me.viewConfig);

        if (!Ext.isEmpty(me.getDefFileUrl())) {
            Ext.Ajax.request({
                url: me.getDefFileUrl(),
                disableCaching: false,
                success: me.onDefResponse.bind(me),
                failure: me.onDefRejected.bind(me)
            });
        }
        /*var printSelectStore, prefData;
        prefData = [
			['11*17' , '11*17'],
			['16K' , '7.75*10.75'],
			['8K' , '10.75*15.5'],
			['A3' , '11.69 * 16.54'],
			['A4' , '8.27 * 11.69'],
			['A5' , '5.83*8.27'],
			['B4(JIS)' , '10.12*14.22'],
			['B5(ISO)' , '6.93*9.513'],
			['B5(JIS)' , '7.17*10.12'],
			['Double Japan Postcard Rotated' , '5.83*7.87'],
			['Envelope #10' , '4.12*9.5'],
			['Envelope B5' , '6.93*9.84'],
			['Envelope B5' , '6.93*9.84'],
			['Envelope DL' , '4.33*8.66'],
			['Envelope Monarch' , '3.87*7.5'],
			['Executive' , '7.25*10.5'],
			['Executive(JIS)' , '8.5*12.99'],
			['Legal' , '8.5*14'],
			['Letter' , '8.5*11'],
			['Custom Size','0*0']
        ];
        printSelectStore = new Ext.data.SimpleStore({
			autoLoad: true,
			fields: ["name", "key"],
			data: prefData
        });                           
        
        */
        me.dockedItems = [{
            dock: 'top',
            xtype: 'toolbar',
            items: [{
                    tooltip: 'ZoomIn',
                    iconCls: 'x-fa fa-search-plus',
                    listeners: {
                        click: me.onZoomIn,
                        scope: me
                    }
                }, {
                    tooltip: 'ZoomOut',
                    iconCls: 'x-fa fa-search-minus',
                    listeners: {
                        click: me.onZoomOut,
                        scope: me
                    }
                }, {
                    tooltip: 'Download as image',
                    iconCls: 'x-fa fa-download',
                    listeners: {
                        click: me.onOrgDownload,
                        scope: me
                    }
                }, {
                    toolTip: 'Print',
                    iconCls: 'x-fa fa-print',
                    listeners: {
                        click: me.onOrgPrint,
                        scope: me
                    }
                }, {
                    text: me.drawMode == "line" ? 'Modern' : 'Classic',
                    enableToggle: true,
                    toggleHandler: me.onChangeView.bind(me),
                    pressed: true,
                    itemId: 'classicView'
                },
                {
                    xtype: 'combofield',
                    queryMode: 'local',
                    displayField: 'name',
                    itemId: "printselectoptions",
                    emptyText: 'Print Size',
                    validateOnChange: false,
                    store: {
                        fields: ["name", "key"],
                        data: [{
                                name: '11*17',
                                key: '11*17'
                            },
                            {
                                name: '16K',
                                key: '7.75*10.75'
                            },
                            {
                                name: '8K',
                                key: '10.75*15.5'
                            },
                            {
                                name: 'A3',
                                key: '11.69 * 16.54'
                            },
                            {
                                name: 'A4',
                                key: '8.27 * 11.69'
                            },
                            {
                                name: 'A5',
                                key: '5.83*8.27'
                            },
                            {
                                name: 'B4(JIS)',
                                key: '10.12*14.22'
                            },
                            {
                                name: 'B5(ISO)',
                                key: '6.93*9.513'
                            },
                            {
                                name: 'B5(JIS)',
                                key: '7.17*10.12'
                            },
                            {
                                name: 'Double Japan Postcard Rotated',
                                key: '5.83*7.87'
                            },
                            {
                                name: 'Envelope #10',
                                key: '4.12*9.5'
                            },
                            {
                                name: 'Envelope B5',
                                key: '6.93*9.84'
                            },
                            {
                                name: 'Envelope B5',
                                key: '6.93*9.84'
                            },
                            {
                                name: 'Envelope DL',
                                key: '4.33*8.66'
                            },
                            {
                                name: 'Envelope Monarch',
                                key: '3.87*7.5'
                            },
                            {
                                name: 'Executive',
                                key: '7.25*10.5'
                            },
                            {
                                name: 'Executive(JIS)',
                                key: '8.5*12.99'
                            },
                            {
                                name: 'Legal',
                                key: '8.5*14'
                            },
                            {
                                name: 'Letter',
                                key: '8.5*11'
                            },
                            {
                                name: 'Custom Size',
                                key: '0*0'
                            }
                        ]
                    },
                    visibleLength: 0,
                    valueField: "key",
                    value: '8.27 * 11.69',
                    listeners: {
                        scope: me,
                        select: me.onPageSizeChange
                    },
                    width: 220
                },
                {
                    xtype: 'numberfield',
                    emptyText: 'width',
                    width: 50,
                    itemId: 'txtOrgPageWidth',
                    hidden: true
                },
                {
                    xtype: 'numberfield',
                    emptyText: 'height',
                    width: 50,
                    itemId: 'txtOrgPageHeight',
                    hidden: true
                },
                {
                    xtype: 'ramcolabel',
                    itemId: 'lblPrintConfig',
                    width: 250,
                    value: 'Selected Print Config is 8.27 * 11.69 (in pixels)'
                }
            ]
        }];

        /* ADDING DOCKED ITEMS - TREE GRID IN ORG CHART */
        me.tree = tree = Ext.create({
            region: 'north',
            collapsible: true,
            title: 'Treeview',
            minHeight: 100,
            height: 250,
            maxHeight: 300,
            xtype: 'ramcorstreegrid',
            itemId: me.getItemId() + '_treegrid'
        });

        /* END OF CHANGES */

        me.view = view = Ext.create(viewConfig);
        me.mon(view, {
            select: me.onOrgNodeSelect,
            uiclick: me.onOrgUIClick,
            scope: me
        });
        //me.items = [tree, view];
        me.items = view;
        me.callParent();
    },
    processState: function(view) {},
    onPageSizeChange: function(orgCtrl, selData) {
        var me = this,
            ctrl = me.down('#lblPrintConfig'),
            ctrlPageWidth = me.down('#txtOrgPageWidth'),
            ctrlPageHeight = me.down('#txtOrgPageHeight'),
            ctrl = me.down('#lblPrintConfig'),
            selVal = orgCtrl.getValue(),
            printVal;
        printVal = selVal.split('*');
        printVal = parseInt(printVal[0] * 96) + '*' + parseInt(printVal[1] * 96);
        ctrl.setValue('Selected Print Config is ' + printVal + ' (in pixels)');
        if (selVal == "0*0") {
            ctrlPageWidth.show();
            ctrlPageHeight.show();
        } else {
            ctrlPageWidth.hide();
            ctrlPageHeight.hide();
        }
    },
    onZoomIn: function() {
        try {
            var me = this,
                tree = me.view;
            if (tree) {
                var value = tree.panZoom.getZoom(),
                    newValue = value.cur + .1;
                if (value.cur > value.extent[1])
                    return
                else {
                    value.cur = newValue;
                    tree.panZoom.setZoom(value);
                    tree.panZoom.setScaling(newValue, newValue);
                }
            }
        } catch (ex) {
            console.log('onZoomIn ' + ex);
        }
    },
    onZoomOut: function() {
        try {
            var me = this,
                tree = me.view;
            if (tree) {
                var value = tree.panZoom.getZoom(),
                    newValue = value.cur - .1;
                if (value.cur < value.extent[0])
                    return
                else {
                    value.cur = newValue;
                    tree.panZoom.setZoom(value);
                    tree.panZoom.setScaling(newValue, newValue);
                }
            }
        } catch (ex) {
            console.log('onZoomOut ' + ex);
        }
    },
    onChangeView: function(btn) {
        var me = this,
            _tree = me.view,
            itemId = btn.getItemId(),
            txt = btn.getText(),
            nodes;
        if (itemId == 'classicView') {
            if (txt == 'Classic') {
                btn.setText("Modern")
                _tree.setDrawMode("line");
            } else {
                btn.setText("Classic")
                _tree.setDrawMode("diagonal");
            }
        }
        if (itemId == 'orientView') {
            if (txt == 'Vertical') {
                btn.setText("Horizantal")
                _tree.setOrient("horizantal");
            } else {
                btn.setText("Vertical")
                _tree.setOrient("vertical");
            }
        }
        _tree.performLayout();
    },
    onOrgDownload: function() {
        try {
            var me = this,
                tree = me.view,
                svg_data, content, svgObj, divElem,
                controller = getMainController();
            if (controller) {
                controller.mask(true);
            }

            content = tree.getSvg()._groups[0];
            svgObj = content[0];
            if (svgObj.outerHTML.length > 3145728) {
                Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R311, Ext.emptyFn, undefined, 'error');
                return;
            }

            var gNode = svgObj.querySelector('g'),
                aNode = gNode.querySelector('g'),
                availBox = me.view.getScene()._groups[0][0].getBBox(),
                cloneNode;
            availWidth = availBox.width;
            availHeight = availBox.height;

            svgObj.getElementsByClassName("x-d3-links")[0].style = "fill:none";
            var hiddenNode = svgObj.getElementsByClassName("x-d3-hidden")[0],
                hiddenOrgNode = (hiddenNode) ? hiddenNode.querySelector('rect') : null;
            if (hiddenOrgNode) {
                hiddenOrgNode.style.fill = 'none';
                hiddenOrgNode.style.stroke = 'none';
            }

            //divElem = document.createElement('div');
            cloneNode = svgObj.cloneNode(true);
            divElem = cloneNode;
            divElem.setAttribute("width", "100%");
            divElem.setAttribute("height", "100%");

            document.body.appendChild(divElem);

            if (divElem) {
                if (cloneNode && cloneNode.firstElementChild && cloneNode.firstElementChild.firstElementChild) {
                    var cloneNodeBox = cloneNode.firstElementChild.firstElementChild.getBBox(),
                        x = -(cloneNodeBox.x - 10),
                        y = -(cloneNodeBox.y - 10);
                    cloneNode.firstElementChild.firstElementChild.setAttribute("transform", "translate(" + x + "," + y + ")");
                }

                var imgNode = svgObj.querySelectorAll('image'),
                    htmlImgNode = svgObj.querySelectorAll('img'),
                    pbx, b64Data, b64Array = [],
                    cHeight, cWidth, cVal, cValSubString,
                    cCanvas = document.createElement('canvas'),
                    cCtxt, ccWidth, ccHeight;


                cWidth = availBox.width;
                cHeight = availBox.height;

                cCanvas.id = "cCanvas";
                cCtxt = cCanvas.getContext("2d");

                for (var k = 0; k < imgNode.length; k++) {
                    cVal = imgNode[k].getAttribute('xlink:href');
                    cValSubString = cVal.substring(0, 4);
                    if (cValSubString)
                        cValSubString = cValSubString.toLowerCase();
                    else
                        cValSubString = "";
                    if (!b64Array[cVal] && cValSubString.indexOf("data") != 0) {
                        ccWidth = parseInt(imgNode[k].getAttribute('width'));
                        ccHeight = parseInt(imgNode[k].getAttribute('height'));
                        cCanvas.width = ccWidth;
                        cCanvas.height = ccHeight;
                        cCtxt.drawImage(imgNode[k], 0, 0, ccWidth, ccHeight);
                        b64Data = cCtxt.canvas.toDataURL('image/png');
                        b64Array[cVal] = b64Data;
                    }
                }
                for (var k = 0; k < htmlImgNode.length; k++) {
                    cVal = htmlImgNode[k].getAttribute('src');
                    cValSubString = cVal.substring(0, 4);
                    if (cValSubString)
                        cValSubString = cValSubString.toLowerCase();
                    else
                        cValSubString = "";
                    if (!b64Array[cVal] && cValSubString.indexOf("data") != 0) {
                        ccWidth = parseInt(htmlImgNode[k].getAttribute('width'));
                        ccHeight = parseInt(htmlImgNode[k].getAttribute('height'));
                        cCanvas.width = ccWidth;
                        cCanvas.height = ccHeight;
                        cCtxt.drawImage(htmlImgNode[k], 0, 0, ccWidth, ccHeight);
                        b64Data = cCtxt.canvas.toDataURL('image/png');
                        b64Array[cVal] = b64Data;
                    }
                }


                svg_data = (new XMLSerializer()).serializeToString(divElem);
                document.body.removeChild(divElem);

                var DOMURL = window.URL || window.webkitURL || window,
                    img = new Image(),
                    svg, url;
                img.height = cHeight;
                img.width = cWidth;

                var sData = new DOMParser().parseFromString(svg_data, "text/xml"),
                    sImg = sData.querySelectorAll('image'),
                    hImg = sData.querySelectorAll('img'),
                    rImg, rImgVal;

                for (var j = 0; sImg && j < sImg.length; j++) {
                    rImg = sImg[j];
                    rImgVal = rImg.getAttribute('xlink:href');
                    if (b64Array[rImgVal]) {
                        rImg.setAttribute('xlink:href', b64Array[rImgVal]);
                        //rImg.setAttribute("width","100%");
                        //rImg.setAttribute("height","100%");
                    }
                }
                for (var j = 0; hImg && j < hImg.length; j++) {
                    rImg = hImg[j];
                    rImgVal = rImg.getAttribute('src');
                    if (b64Array[rImgVal]) {
                        rImg.setAttribute('src', b64Array[rImgVal]);
                    }
                }

                var doctype = '<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';
                svg_data = doctype + (new XMLSerializer()).serializeToString(sData);

                svg = new Blob([svg_data], {
                    type: 'image/svg+xml;charset=utf-8'
                });
                var reader = new window.FileReader();
                reader.onloadend = function() {
                    var base64data = reader.result;
                    img.onload = function() {

                        var mycanvas = document.createElement('canvas');
                        mycanvas.id = "mycanvas";
                        //mycanvas.setAttribute("width", availWidth * 1.5);
                        //mycanvas.setAttribute("height", availHeight * 1.5);
                        mycanvas.width = cWidth + 20;
                        mycanvas.height = cHeight + 20;
                        ctxt = mycanvas.getContext("2d");

                        ctxt.drawImage(img, 5, 5);
                        mycanvas.toBlob(function(file) {
                            if (file) {
                                if (window.navigator.msSaveOrOpenBlob) // IE10+
                                    window.navigator.msSaveOrOpenBlob(file, 'download_' + Date.now() + '.png');
                                else { // Others
                                    var a = document.createElement("a"),
                                        url = URL.createObjectURL(file);
                                    a.href = url;
                                    a.download = 'download_' + Date.now() + '.png';
                                    document.body.appendChild(a);
                                    a.click();
                                    setTimeout(function() {
                                        document.body.removeChild(a);
                                        window.URL.revokeObjectURL(url);
                                        if (controller) {
                                            controller.mask(false);
                                        }
                                    }, 0);
                                }
                            }
                            document.body.removeChild(img);
                        }, 'image/png', 0.95);
                    }
                    img.src = base64data;
                    document.body.appendChild(img);
                }
                reader.readAsDataURL(svg);

            }
        } catch (ex) {
            console.log('onOrgDownload ' + ex);
            if (controller) {
                controller.mask(false);
            }
        }
    },
    onOrgPrint: function() {
        var me = this,
            tree = me.view,
            svg_data, content, svgObj, divElem;
        if (!tree && !tree.panZoom)
            return;
        var value = tree.panZoom.getZoom(),
            zoom = (value && value.cur) ? value.cur : 1,
            controller = getMainController();
        value.cur = 1;
        tree.panZoom.setZoom(value);
        tree.panZoom.setScaling(1, 1);
        if (controller) {
            controller.mask(true);
        }
        try {
            content = tree.getSvg()._groups[0];
            svgObj = content[0];

            /* NEW IMPLEMENTATION */
            var printConfigObj = me.down('#printselectoptions'),
                printConfigVal = (printConfigObj) ? printConfigObj.getValue() : null,
                _printWidth = 700,
                _printHeight = 980;
            if (printConfigObj.getValue() == "0*0") {
                var ctrlPageWidth = me.down('#txtOrgPageWidth'),
                    ctrlPageHeight = me.down('#txtOrgPageHeight');
                if (ctrlPageWidth && ctrlPageHeight) {
                    _printWidth = parseInt(ctrlPageWidth.getValue() * 96);
                    _printHeight = parseInt(ctrlPageHeight.getValue() * 96);
                }
                if (_printWidth <= 0 || _printHeight <= 0) {
                    Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R309, Ext.emptyFn, undefined, 'error');
                    return;
                }
            } else {
                if (!Ext.isEmpty(printConfigVal)) {
                    printConfigVal = printConfigVal.split('*');
                    _printWidth = parseInt(printConfigVal[0] * 96);
                    _printHeight = parseInt(printConfigVal[1] * 96);
                }
            }

            var gNode = svgObj.querySelector('g'),
                aNode = gNode.querySelector('g'),
                printSize = {
                    width: _printWidth,
                    height: _printHeight
                }, // A4 - Size 500 * 500
                availBox = gNode.getBBox(),
                availHeight = availBox.height,
                availWidth = availBox.width,
                printObj = me.body.getSize(),
                printHeight = printObj.height,
                printWidth = printObj.width,
                cloneNode;

            svgObj.getElementsByClassName("x-d3-links")[0].style = "fill:none";
            var hiddenNode = svgObj.getElementsByClassName("x-d3-hidden")[0],
                hiddenOrgNode = (hiddenNode) ? hiddenNode.querySelector('rect') : null;
            if (hiddenOrgNode) {
                hiddenOrgNode.style.fill = 'none';
                hiddenOrgNode.style.stroke = 'none';
            }

            printHeight = _printHeight;
            printWidth = _printWidth;

            /* var nodeSizeWidth = (me.view.getNodeSize()[1] || 250),
                    lLeft = ( availWidth + printWidth )/ 2,
                    rRight = (-lLeft - (printWidth * 2)),
                    hHeight = parseInt((availHeight - nodeSizeWidth) / printHeight) + (availHeight % printHeight > 0 ? 1 : 0),
                    wWidth = parseInt((Math.abs(lLeft) + Math.abs(rRight)) /  printWidth),
                    j = 0, k = 0; */
            var contentRect = tree.getContentRect(),
                lLeft = -contentRect.x,
                tTop = -contentRect.y,
                //rRight = 
                hHeight = parseInt(availHeight / printHeight) + (availHeight % printHeight > 0 ? 1 : 0),
                wWidth = parseInt((Math.abs(lLeft) + availWidth) / printWidth) + (((Math.abs(lLeft) + availWidth) % printWidth) > 0 ? 1 : 0),
                j = 0,
                k = 0;

            //divElem = document.createElement('div');
            //divElem.style.pageBreakAfter = "always";
            //width:" + printWidth * wWidth  + "px;
            divElem = "<div style=\"page-break-after: always;\">";
            /* lLeft = parseInt(lLeft); */
            /* rRight = parseInt(rRight); */

            if (hHeight > 1 || wWidth > 1) {
                if (hHeight * wWidth > 100) {
                    value.cur = zoom;
                    tree.panZoom.setZoom(value);
                    tree.panZoom.setScaling(value.cur, value.cur);
                    if (controller) {
                        controller.mask(false);
                    }
                    Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R310, Ext.emptyFn, undefined, 'error');
                    return;
                } else {

                    var imgNode = svgObj.querySelectorAll('image'),
                        htmlImgNode = svgObj.querySelectorAll('img'),
                        pbx, b64Data, b64Array = [],
                        cVal, cValSubString,
                        cCanvas = document.createElement('canvas'),
                        cCtxt, ccWidth, ccHeight;

                    cCanvas.id = "cCanvas";
                    cCtxt = cCanvas.getContext("2d");

                    for (var k = 0; k < imgNode.length; k++) {
                        cVal = imgNode[k].getAttribute('xlink:href');
                        cValSubString = cVal.substring(0, 4);
                        if (cValSubString)
                            cValSubString = cValSubString.toLowerCase();
                        else
                            cValSubString = "";
                        if (!b64Array[cVal] && cValSubString.indexOf("data") != 0) {
                            ccWidth = parseInt(imgNode[k].getAttribute('width'));
                            ccHeight = parseInt(imgNode[k].getAttribute('height'));
                            cCanvas.width = ccWidth;
                            cCanvas.height = ccHeight;
                            cCtxt.drawImage(imgNode[k], 0, 0, ccWidth, ccHeight);
                            b64Data = cCtxt.canvas.toDataURL('image/png');
                            b64Array[cVal] = b64Data;
                        }
                    }
                    for (var k = 0; k < htmlImgNode.length; k++) {
                        cVal = htmlImgNode[k].getAttribute('src');
                        cValSubString = cVal.substring(0, 4);
                        if (cValSubString)
                            cValSubString = cValSubString.toLowerCase();
                        else
                            cValSubString = "";
                        if (!b64Array[cVal] && cValSubString.indexOf("data") != 0) {
                            ccWidth = parseInt(htmlImgNode[k].getAttribute('width'));
                            ccHeight = parseInt(htmlImgNode[k].getAttribute('height'));
                            cCanvas.width = ccWidth;
                            cCanvas.height = ccHeight;
                            cCtxt.drawImage(htmlImgNode[k], 0, 0, ccWidth, ccHeight);
                            b64Data = cCtxt.canvas.toDataURL('image/png');
                            b64Array[cVal] = b64Data;
                        }
                    }
                    var svg_data = svgObj.outerHTML;

                    var sData = new DOMParser().parseFromString(svg_data, "text/html"),
                        sImg = sData.querySelectorAll('image'),
                        hImg = sData.querySelectorAll('img'),
                        rImg, rImgVal;

                    for (var j = 0; sImg && j < sImg.length; j++) {
                        rImg = sImg[j];
                        rImgVal = rImg.getAttribute('xlink:href');
                        if (b64Array[rImgVal]) {
                            rImg.setAttribute('xlink:href', b64Array[rImgVal]);
                        }
                    }
                    for (var j = 0; hImg && j < hImg.length; j++) {
                        rImg = hImg[j];
                        rImgVal = rImg.getAttribute('src');
                        if (b64Array[rImgVal]) {
                            rImg.setAttribute('src', b64Array[rImgVal]);
                        }
                    }

                    j = 0;
                    k = 0;
                    for (; j < hHeight; j++) {
                        k = 0;
                        for (; k < wWidth; k++) {
                            cloneNode = sData.cloneNode(true);
                            cloneNode = cloneNode.querySelector('svg');
                            cloneNode.setAttribute('height', printHeight);
                            cloneNode.setAttribute('width', printWidth);
                            gNode = cloneNode.querySelector('g');
                            aNode = gNode.querySelector('g');
                            aNode.setAttribute("transform", "translate(" + (lLeft + (k * printWidth * -1)) + "," + (tTop + (j * printHeight * -1)) + " )");
                            //divElem.append(cloneNode);
                            divElem += cloneNode.outerHTML;
                            cloneNode = null;
                        }
                    }
                }
            } else
                divElem += svgObj.outerHTML;
            divElem += "</div>";
            var printWindow = window.open('', 'PrintMap', 'width=' + printWidth + ',height=' + printHeight);
            printWindow.document.writeln(divElem);
            //printWindow.document.close();
            /*
            var htmlBlob = new Blob([divElem], {type: 'text/html;charset=utf-8'});
            var url = URL.createObjectURL(htmlBlob);
            var printWindow = window.open(url, 'PrintMap', 'width=' + printWidth + ',height=' + printHeight);
            */
            printWindow.print();
            setTimeout(function() {
            /* printWindow.close(); */ }, 1);
        } catch (ex) {
            console.log('onOrgPrint ' + ex);
        }
        if (controller) {
            controller.mask(false);
        }
        value.cur = zoom;
        tree.panZoom.setZoom(value);
        tree.panZoom.setScaling(value.cur, value.cur);
    },
    onOrgNodeSelect: function() {
        var me = this,
            args = [],
            i = 0,
            ln = arguments.length;
        args[0] = 'orgnodeselect';
        args[1] = me;
        for (; i < ln; i++) {
            args.push(arguments[i]);
        }
        me.fireEvent.apply(me, args);
    },
    onOrgUIClick: function() {
        // TODO
    },
    getDefFileUrl: function() {
        var me = this,
            defFile = me.getDefFile();
        ilbo = me.up('ilbo');
        if (Ext.isEmpty(defFile))
            return "";
        else
            return (uiFilePath + ilbo.ilboConfig.componentName + '/' + me.defFile + ".txt?_dc=" + RamcoRTC.getCacheId())
    },
    onDefResponse: function(response, options) {
        var me = this,
            defData = response.responseText;
        try {
            me.setDefData(defData);
            if (me.view.isInitializing) {
                me.view.updateDefData(defData);
            } else {
                me.view.on({
                    scenerender: me.onSceneRender.bind(me),
                    single: true
                });
            }

        } catch (e) {
            console.log(e);
        }
    },
    onSceneRender: function() {
        var me = this,
            defData = me.getDefData();
        me.view.updateDefData(defData);
    },
    onDefRejected: function() {

    },
    updateValue: function(newValue) {
        var me = this;
        if (!me.store || me.store.isEmptyStore) {
            me.value = newValue;
            return;
        }
        if (newValue) {
            me.vsi = newValue.vsi;
            me.si = newValue.si;
            me.tr = newValue.tr;
            me.store.nsr = parseInt(newValue.nsr, 10);
            me.store.start = me.si;
            me.store.end = me.tr;
            me.store.tr = me.tr;
            me.store.vr = newValue.vr;
            me.store.vsi = me.vsi;
            if (!Ext.isEmpty(newValue.store)) {
                me.store.setData(newValue.store);
                me.store.commitChanges();
            }
        }
    },
    setValueOnData: function() {
        var me = this;
    },
    updateSelect: function() {

    },
    setStore: function(store) {
        var me = this,
            oldStore = me.store;
        /*me.mon(store, {
            refresh: me.setValueOnData,
            scope: me
        });*/
        if (RamcoRTC.isGProto && Ext.isEmpty(store.data)) {
            store = Ext.create('Ext.data.TreeStore', store);
        }
        if (store && store !== oldStore) {
            me.unbindStore();
            me.bindStore(store);
        }
        store.dataView = true;
        if (this.autoLoad && !store.isEmptyStore && !(store.loading || store.isLoaded())) {
            store.load();
        }
        if (me.index)
            me.updateSelect(me.index);
        if (Ext.isObject(me.value) && (Ext.isEmpty(me.store.vsi) || Ext.isEmpty(me.store.tr) || Ext.isEmpty(me.store.si)))
            me.updateValue(me.value);
        if (me.view && me.tree) {
            me.view.setStore(store);
            me.tree.setStore(store);
        }
    },
    onStoreLoad: Ext.emptyFn,
    bindStore: function(store, initial) {
        var me = this,
            view = me.view,
            tree = me.tree;

        if (store) {
            // Bind to store immediately because subsequent processing looks for grid's store property
            me.store = store;

            if (view && view.store !== store) {
                view.setStore(store, false);
            }
            if (tree && tree.store !== store) {
                tree.setStore(store, false);
            }

            me.mon(store, {
                load: me.onStoreLoad,
                scope: me
            });
            me.storeRelayers = me.relayEvents(store, [
                /**
                 * @event filterchange
                 * @inheritdoc Ext.data.Store#filterchange
                 */
                'filterchange',
                /**
                 * @event groupchange
                 * @inheritdoc Ext.data.Store#groupchange
                 */
                'groupchange'
            ]);
            //me.tree.setStore(store);
        } else {
            me.unbindStore();
        }
    },
    unbindStore: function() {
        var me = this,
            store = me.store,
            view,
            tree;

        if (store) {
            store.trackStateChanges = false;

            me.store = null;

            me.mun(store, {
                load: me.onStoreLoad,
                scope: me
            });
            if (me.storeRelayers)
                Ext.destroy(me.storeRelayers);

            view = me.view;
            tree = me.tree;
            if (view.store) {
                view.setStore(null);
            }
            if (tree.store) {
                tree.setStore(null);
            }
        }
    }
});

Ext.define("Ext.ramco.OrganizationChart", {
    extend: 'Ext.d3.hierarchy.tree.Tree',
    alias: 'widget.ramcoorganizationchart',
    rootVisible: false,
    expandEventName: null,
    config: {
        drawMode: 'diagonal',
        componentCls: 'horizontal-tree',
        nodeTransform: function(selection) {
            selection.attr('transform', function(node) {
                return 'translate(' + node.x + ',' + node.y + ')';
            });
        },
        nodeTransformH: function(selection) {
            selection.attr('transform', function(node) {
                return 'translate(' + node.y + ',' + node.x + ')';
            });
        },
        interactions: [{
            type: 'panzoom',
            zoom: {
                extent: [.1, 1],
                doubleTap: false,
                cur: 1
            }
        }],
        nodeSize: [500, 250],
        nodeRadius: 5,
        orient: 'vertical'
    },
    pendingTreeAlign: false,

    oldLayoutSaving: true,
    //downImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABgklEQVR42s3VzSsFURjH8bnykqxIWSgLImWJKC+FJVmhXH+A/fW2EImUl9j7A1BYiSXKSxGWSsRCWSixkryE79M8tzSdc+fcNOWpT/feM3fO75w5Z2ZiXsQV+y8BhahEkf5+wCUe/xpQjxG0Iytw7APbmMVxugHSPo8BHe0SdnGvx4vRin6d1QKG8O0SkIFV9GASc3ixDCQPwxjHGnrxFRYgo0mgDyth11grjmUs6qytAdU4w5SOKp2S2Y6hBue2gE3UoQRvhk6q9PPCcCwHdzhBpymgwPMXdBoTls4P9HuTJUTOG/X8hX8KBshJ+2jEkaHzPbzq71y0GEIacIjm5GB+B3RhHWW4DXS+g08N97STTLQFQkpxg25suATUYsvzbyoZ8bW2l+uM5ObrwKlLgOkSybaL65SvApejQv8vWznhcolMi5yNfG03lSzmM95dFlkqbJumqtBtKhX5jSYV6aNCKvKHXbI93cf1oK2jVOXywpnx/IW1jtSlIntl/rkiD/gBgqRtGXm812QAAAAASUVORK5CYII=",
    //upImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABhklEQVR42s3VSytFURTA8X3lkYxIGSgDInWHiPIoDMkIhQ9gfr0GIpHyyJ37ACiMxBDlUoThKREDZaDESPII/91Z6rQ7z26nrPp1O+vse9bae59HQsUcif9SoBS1KJPjR1zhKdsCTZhAF/KMc5/YwyJOoxbQ+WWMSLerOMCDnC9HB4ZlVisYw0+YAjnYQD9msYRXj0aKMI5pbGIA30EFdDcpDGE9aI0lBrGGtMzas0AdLjAnXUUJPdsp1OPSq8AOGlGB94gFCnCPM/S4FShR9obOY0Zy+SiWvFvoDX7Bhxzr/01K/tks0IojtOBEcmlZ3zZcGxevkfF6n1KSa8axjM+YBXqxhSrcSa4Bu8q+59txI/lqHCr72ejGueQrcYs+bIcpoCOJfXzJ7JR0mYtOWI6xvgXclshZRHf8JseFMiPLGOe7RG6bbBbJOJqxXMb4brKOoNs0Kb9uFw+8TXXE/qDpiPVVoSP2l91fPurretTrQn4R5oOzoOyN9ew0TMT2ycw6Yi/wC0SzbRleC1ONAAAAAElFTkSuQmCC",
    /* downImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAADh0lEQVRYha3XTWhdRRQH8F+uj1KLlBokDaWUEESCiBSVVlDri7EiUhV3UkIREUo1groRkdKhoUit3SoKUlD8qIhYFy60Ma9F6MaPKC5KkFpDyUKkphFKDK24mPvem/eR9+5rPKt7z8yc/3/OzJyPPkUlKOFe7MQdGMYGZFjEecxgGicFS0XM9hUAvgnP4xlsKkh3Ae/hiODCtREIMjyLSXGn1yJLeB2HBMvFCQQb8BEebmPwpOjms6LrM6zHEO7HQ/l/Kj/gCcFcdwLBAKZwW6K9iCN4R3CxLen6+hswjlexORm5gJ2CsysTiDs/hdsT7WfYK/izI3B7IofFY6zKPO4RnG8lEM/8BHYlCw7goNATdDORPXgXpVzzM7ZXX8l1tYlle/FSsnS/YFJlFeBQ8ZOy3/G4uOGNKKmYqhOIrj+B6/Nln+O5VYM3krgRd+eabco+VPFXlism0J9/L2LfqtzeXl6hdvZr8DL05Wf/G7bkgwcFB/53eAiewrH87zI2ZrgrAb+Ct5sWlfJo2CvYQB6+U/mY2mtah10ZysmEbwXzDeC8jzNCjWQR8CGcwbEGEvHmf5HMHMtwZ6KYagL/AE/iZpzKDXcDj3NjshpvIRGjaFW2ZjQY/TX57hezXlWGchLDHcBHcvDUW9s05pLZ1GbWNFhPocEfGG0itSUnccsK4NMaM+YsRpuiaJqmS5lOElNpM4nNmG4gEdyagw+2AZ/XQarFRFXWFiSxKScxku98qgfwFGM5Uw8OxMvWKp1I9L7zFGMuw/eJYnSFRVUSYziXaAd7BJfbqMpMhm8SxQ6hwWAzibmc5Lk2o93BgzV4LNFMZfhO/RhK2Lcy+RVJFLpw2E0tql7Gl5ngX43h94WOXmglUQw8WIv9ieYTwWL1Gb6pHqPX462u2bBOosjO4RC1ILaM16jWAxX/KLuER/MJI7iq4nRHkxWXVPzdFToYF8uzagV2VHC8TgDKfsR29WfygLKryk6vqjCJ4GlJ9gt2q7hCa1HaL8bytCL+VCxQei1K14lunhADHrEovU+oX+B2ZfkgvtZalh8Wy/KFAsB7xAooTUrzGOtclteN9OM4HmwaWcJXYuidFZ8SMbwOi43JI1obkxmxMTnfDNWtNZsQW7Nmg0VlCW9gsrfWrJHIAF7E0xgoCFxtTo+2a8d6I1AnUsIOsT3fKrq8X7xgC5gTXT2lh/b8PyKs+qb54P8cAAAAAElFTkSuQmCC",
	   upImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAADi0lEQVRYha3XX2jWVRgH8M9+vYgNkTVEI0xkdFEQIRUapPXKGv1RoS6TkJBAtBXUTUSIB4eEmrdFQQRdGHYR2UVBuXprEgSlY3ghEjmGjRCxNWSsOaKL83t9z/tne9/f5nP1+z3nz/d7nnPOc75Pl04tKGErBvAw+tCDDNMYxyh+wBnBbCfTdnUAvAav4RXc0yHdKXyK44IrSyMQZDiAIXGlS7FZHMMRwVznBIIefIZnWkx4RgzzRTH0GVZjI7blY1Y3jDuHFwQT7QkEazGMBxPvdRzHR4LrLUnXxndjD97B+qTlCgYEFxcmEFf+Ix5KvF9gn+DaosDNRFbhqLiNVZvE44LxZgJxz09jZzLgEA4LhaAbiezFhyjlnjFsqd6SO251LNuHN5OhBwVDKssAh4rzyi7jeXHB61BSMVwjEEN/Gnfmw77Eq23Bg1XK+lTabE/FmLK78Fju2azspIq/s9wxiN78exr724Y97vE3GBHqzsxC9jb+yL9X4C3oyvf+MjbkjYcFhzoE35p7rqFfMNZm3Mv4JP+bwboMjybg8+KBKQIOazDcQSRO5mShGzszlJMOZwWTBcE7JxGz4VeJpz/DI4ljuCD4DC4VIlGPsSkTU2jVfi8IvkNMvxcKkEgxNmbqH5rmJ3Rh8F2CiuAq+guQSDFKWYsO7cBvYIfg+6TfVWyn7hZ0dDCrYqJqK5NJVy4CXmlBNl7FKEoaSdzfEoO5jNrDgPuS71n8nPxP4WnBTwutJiFxLvFepE6UpBgTGX5LHNuTyYjZ6pj4HA8IdYQWIhH78ivO4lnBjaRHf/I92iXYjF9yxzzuFfzVQGR9O2nVgkgP5uvAgxX4U9waeLGUMx0Xr2MJ+0lScSRQDDyOm2rh3Z2Az+DrTPCf+vT7eq6Kbq/FQ30w8XwumK5ew/fVcnQPPliWCGltR0QpD3N4l6oeqPhX2T/YlXd4ADdVjNwW6OAlUZ5VFdgJwakaASg7jy1q16Rf2U1lI8tSRRH8YzVJdgG7VczTLEp7RVGaKuKlitJuMcyDYsIjitJtwi1h0lKW343vNMvyo6Isb3W6G4H3iApoQ9IyKYqWRWR5bZJenMJTDS2z+FZ8Ui+JV4mYXvvwJJ7TXJiMioXJeCNUu9JsUCzNGifs1GbxHoaKlWb1RNbiDeyl4/xQLU5PtCrHihGoESnhCTHPbxJD3isesClMiKEeVqA8/x/hPP3plNlbYAAAAABJRU5ErkJggg==",
	   leftImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAADZ0lEQVRYhZ3XXYhVVRQH8N+cBhEZZBjERERk8EUIkTIKstFhMjIs6DXEoqIwpsinCJE2mYWZ9JYUSOBLGRJ9YJ9OYyg9VQzRg0jZIMMgETINItMk0sM+Z+6+955777l3PZ2z9sf/v9f+WP/Vp6oF/diGnbgTwxhEhnlMYwqTOCtYqDJtXwXgVXgBz2BtRbpzOImjgpneCAQZnschcaW92ALewmHBYnUCwSA+xEMlE54Vw3xRDH2GldiA7Xgw/0/tFzwmuNKZQLAaE7gj8V7DUbwvuFZKujZ+AHtwAOuSlhnsFFxsTSCu/AdsTrynsU/wd1vgciJHxG0sbBb3CaabCcQ9/wy7kwGv4jWhI9hazAuul7TtxQn0555fcU9xS7Kk67MN4AeFSuDrxKh9la+6sf0knsat3LNZXBiKCMTQ/4Gh3P+peGiqgE9iY+65gF0tIvEOXsr/FrFJcLmIwHgCPi/uebfgxHei1ZV9haW9X4aXoS/f+z+xPm98XXCwB/Ar2J4esJJxT+KD/O8Gbs+wNQG/ieM9go+2BY/2EUu3aQV2Z9iRdLggmO0SfAZjgssdwOUn//PEM5bhrsQx0SX4bA7+e0fwmk0m31sy8QktrHyi1uCjgktdgKOu/4ZM/altTqHxkWkEv9ojeCNGf9ayW82u468G34DqqbmtFWKisOVNPYJ57MKPDQS+EOoOcFVLMRYz6q7ORmXWnsRIlwTqrm+GnxPHaMthrUmcEWzrgsBY8j2V4fvEMSJY0yOJeztCB8vwaOKZyPCT2jb0Y1+HScpIrBSz4dYOFB7Hqvz7Br7MBLfwXtLpxVwVdUtiEN8IhluMWU5djvlYMF9cw3fV3uhBHK+QDctIfE2z7svtMEvkFvEm3AbO+dcO/+CRvMMm/Oec821JxHGnRTF6Hk8IbpaQ3SPKs0KBHROcolmSnVGvhA/gjQrRGMBCG/ATogaA33B3IckaRemQKK9SRfwJnutBlK4QwzyuJv1mcX+aOctk+Rp8p1mWHxFl+VwF4L2iAlqftBSZs40sr00yhFN4oKFlAd+KafuSeJWIz+uweBYe1lyYTIkac7oRqlNpNi6WZo0TVrUFvI1D3ZVm9URWYz+eosP7ULOiOD1WVo51R6BGpB8jYnm+RQz5kHjA5sT7PyVuT+Xy/H8Pr/Sj23EH/wAAAABJRU5ErkJggg==",
       rightImage:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAADfElEQVRYhZ3XTWhcVRQH8F+eoZRSJAyxliKlBBdWpBQVXKh1QqyIVEHciBQVFaUaRVeiIl5aSqm1uFMUQagLrWBRF4ramEjdCH4EKRhCrSGU4KKUGKTEtAQX973OnZk3mTdzYGDuuR///z33vPMxoKoEg7gDu3EzRjCEDEuYwzQmcVKwXOXYgQrAw3geT2FLRbqLOIYjgnP9EQgyPIsD4k37kWW8iYOCleoEgiF8jHtLDjwpmnlGNH2Gq7ENd+GefJzKr3hQMN+dQLAJE7gp0V7AEbwvuFBKurF/I/biNVyXzJzDbsFMZwLx5j9gR6I9gWcE59cELidyWHzGQhZwu2CuUGTJhgwftYC/gYdKwUObmVvn/xU8h8dwOdduwReC9e0EeBp7kvHrgv1C6eEH8ZNg85ok4tpjeBKruWaHeDEUTxBN/ydquf5z0Wk6gb+aj2YwKvi7ApG38WI+WsF2wdnCAuMJ+BL2dQCviQ5WyA2YrGQJXuHK26/DyzCQv/1f2JpP7hcaJiohMSI6aurh1SwRPI4P89FFXJvh1gT8Mt7rcshZjIoeXUhVS3zCFYfegD0Z6smCH4WmgzuROJOTSG/cnUTMD18mmrEMtySKia7gjcNm+yIRo2ghOzMxhBZypjKBSGKmDxKzyf9tmeZEUymFlpAY64FEijGYlSzoR87TliOG89+aUhQThazvtLCjNJLXjS2ExgSnS3akGCuZRnCA6/sAn9ScOQvw3zvsSjHmM/ySKEZ7AB/W+eadwFsxpjN8nyh2VUwwNe01Q3fwYB0eSDQTGX7WeIZB7OsCPoRvNKftKjeHh7Ep/38RX2WCVc3h94X8bcvAN+JrMXz3Bh5rgDTHfCpYKj7DdzRi9BDeLc2G8RtOQ3XVm8MhsZQnpuNDcBWY8p+6f3B/vmA7LplyqumIKavqTohvf01l8ODRHLAoAY8KjjcIQN1vuE3jMxlTd0ndKVOlJD4T/FEBfC8+EP0LTuMRU7FMay1Ka2KuT72736J0g3jrcY3SbwF35ildO4G4cTO+016WHxbL8sUKwEVZvjWZWRCfbI2yvHFIDcdxd8vMMr4VY8Cs+CkRw+uI2Jjcp70xmRZrzLlWqG6t2bjYmq1dgneWZbyFA721Zs1ENuElPEGH+NAuRXN6tKwd641Ag8ggdont+U7R5DXRwRYxL5p6Qg/t+f9JIPdzmDZHgwAAAABJRU5ErkJggg==", */
    downImage: 'classic/resources/images/down.png',
    upImage: 'classic/resources/images/up.png',
    leftImage: 'classic/resources/images/left.png',
    rightImage: 'classic/resources/images/right.png',

    /**
     * @private
     * Marks the tree for alignment after the end of layout (or layout transition).
     */
    alignAfterLayout: function() {
        this.pendingTreeAlign = true;
    },
    onAfterRender: function() {
        if (this.pendingTreeAlign) {
            this.pendingTreeAlign = false;
            this.alignTree();
        }
    },
    onSceneResize: function(scene, rect) {
        var me = this,
            layout = me.getLayout();
        me.alignAfterLayout();

        if (layout.nodeSize()) {
            // `layout.size` and `layout.nodeSize` are mutually exclusive.
            // No need to set layout `size` and perform layout on component resize
            // (as we do in the parent method), if the `nodeSize` is set (fixed),
            // only need to perform layout initially and when data changes.

            if (me.size) {
                this.alignTree();
            } else { // first resize, the scene is empty
                me.performLayout();
            }
        } else {
            me.callParent(arguments);
        }
    },
    onLayout: function() {
        var me = this;

        if (me.pendingTreeAlign) {
            me.pendingTreeAlign = false;
            me.alignTree();
            // Note that after aligning the tree, the changes likely won't be visible
            // until after the next frame (this appears to be a render process optimization
            // on the browser's part). The state of the DOM has changed, however,
            // so this won't prevent the scroll indicators from being updated properly.
        }
        // The parent method will update the scroll indicator and should be called
        // after aligning the tree.
        me.callParent();
    },
    alignTree: function() {
        // It makes no sense aligning the tree, as the tree fills up the whole component area
        // when the node size isn't set.
        if (this.getNodeSize()) {
            var orient = this.getOrient();
            if (orient == "vertical")
                this.alignContent('tc');
            else
                this.alignContent('l');
        }
    },
    updateNodeSize: function(nodeSize) {
        var me = this,
            orient = this.getOrient();

        if (nodeSize) {
            // The x and y in `nodeSize` are swapped because the layout is always calculated
            // for a vertical tree, we just interpret the layout differently to render
            // a horizontal tree.
            if (orient == "vertical")
                me.getLayout().nodeSize(nodeSize);
            else
                me.getLayout().nodeSize(nodeSize.slice().reverse());
        } else {
            // We can't just set the `nodeSize` back to null here.
            // The way D3 works, is you have to set the layout size using its `size`
            // method, which will set the `nodeSize` to null automatically because these
            // "configs" are mutually exclusive. If we simply set the `nodeSize` to null,
            // we'd end up with no node size, nor layout size.
            me.setLayoutSize([
                me.sceneRect.width,
                me.sceneRect.height
            ]);
            //<debug>
            if (me.panZoom) {
                Ext.log.warn('With no `nodeSize` set, the `panzoom` interaction is likely redundant. ' +
                    'You can remove it with `component.panZoom.destroy()`. This will also remove any ' +
                    'translation/scaling currently applied to the scene.');
            }
            //</debug>
        }

        if (!me.isConfiguring) {
            me.skipLayoutTransition();
            me.alignAfterLayout();
            me.performLayout();
        }
    },
    getNodeHtml: function(node) {
        var _temp = new Ext.XTemplate(
            '<tpl>',
            '<rect itemid="orgRect" x="0" y="0" class="rectTpl" width="{nodeWidth}" height="{nodeHeight}" style="padding-bottom:20px;fill:transparent;stroke-width:0;stroke:rgb(0,0,0)"></rect>',
            '{MYTEMPLATE}',
            '</tpl>'
        );
        var me = this,
            nodeSize = me.getNodeSize(),
            orient = this.getOrient(),
            data = {},
            ilboView, templateObj, tempStr, _tempData, imgSrc;
        ilboView = me.up('ilbo') || getCurrentPage();
        if (ilboView && node.data && node.data.data && node.data.data.v1) {
            templateObj = ilboView.getTemplate(node.data.data.v1);
            if (templateObj) {
                data = node.data.data;
                data.nodeWidth = nodeSize[0] / 2;
                data.nodeHeight = nodeSize[1] / 2;
                tempStr = templateObj.apply(data);
                _tempData = _temp.apply({
                    MYTEMPLATE: tempStr,
                    nodeWidth: nodeSize[0] / 2,
                    nodeHeight: nodeSize[1] / 2
                });
                if (node.data.isExpandable()) {
                    if (orient == "vertical")
                        _tempData += '<image x="' + parseFloat(nodeSize[0] / 4 - 10) + '" y="' + parseFloat(nodeSize[1] / 2 + 1) + '" height="18" width="18" itemid="orgExpCol" xlink:href="';
                    else
                        _tempData += '<image x="' + parseFloat(nodeSize[0] / 2 + 1) + '" y="' + parseFloat(nodeSize[1] / 4 - 10) + '" height="18" width="18" itemid="orgExpCol" xlink:href="';
                    if (node.data.isExpanded())
                        if (orient == "vertical")
                            _tempData += me.downImage + '"/>';
                        else
                            _tempData += me.rightImage + '"/>';
                    else
                    if (orient == "vertical")
                        _tempData += me.upImage + '"/>';
                    else
                        _tempData += me.leftImage + '"/>';
                }
                return _tempData;
            }
        }
    },
    setLayoutSize: function(size) {
        // In the 'd3.tree' layout the first entry in the `size` array represents
        // the tree's breadth, and the second one - depth.
        var _ = size[0];
        size[0] = size[1];
        size[1] = _;

        this.callParent([size]);
    },

    onNodesAdd: function(selection) {
        var me = this,
            orient = me.getOrient();

        me.callParent([selection]);

        // `nodeFromRecord` must be called after calling the superclass method
        node = me.getOldNode(me.nodeFromRecord(me.getSelection()));

        // Position entering nodes at the selected node's position in the previous layout.
        if (node) {
            if (orient == "vertical")
                selection.attr('transform', 'translate(' + node.x + ',' + node.y + ')');
            else
                selection.attr('transform', 'translate(' + node.y + ',' + node.x + ')');
        }
    },

    addNodes: function(selection) {
        var me = this;

        selection
            .attr('class', me.defaultCls.node)
            .attr('opacity', 0)
            .html(me.getNodeHtml.bind(me));
    },

    updateNodes: function(update, enter) {
        var me = this,
            selectionCfg = me.getSelection(),
            orient = me.getOrient(),
            nodeTransform = orient == "vertical" ? me.getNodeTransform() : me.getNodeTransformH(),
            nodeSize = me.getNodeSize(),
            selection = update.merge(enter),
            transition = me.layoutTransition;

        selection
            .transition(transition)
            .call(nodeTransform)
            .attr('opacity', 1);
    },

    removeNodes: function(selection) {
        var me = this,
            orient = this.getOrient();

        selectedNode = me.nodeFromRecord(me.getSelection());

        // We want to transition the exiting nodes from their current position to their
        // parent's position before removing them. Typically, this will be the selected
        // node, as the nodes will be exiting as a result of a mouse/pointer event that
        // selected the collapsing node.

        selection
            .attr('opacity', 1)
            .transition(me.layoutTransition)
            .attr('opacity', 0)
            .attr('transform', function(node) {
                var p = node.parent, // This is the node's parent from the old layout;
                    // we need to find it in the new layout for a proper looking transition.
                    d = selectedNode || p && me.nodeFromRecord(p.data),
                    x = d && d.x || 0,
                    y = d && d.y || 0;
                if (orient == "vertical")
                    return 'translate(' + x + ',' + y + ')';
                else
                    return 'translate(' + y + ',' + x + ')';
            })
            .remove();
    },
    getLinkPath: function(link) {
        var me = this,
            orient = me.getOrient(),
            drawMode = me.getDrawMode(),
            nodeSize = me.getNodeSize(),
            _rectW = nodeSize[0],
            _rectH = nodeSize[1];
        if (orient == "vertical") {
            if (drawMode == "diagonal") {
                var line = d3.line()
                    .x(function(d) {
                        return (d.x);
                    })
                    .y(function(d) {
                        return (d.y);
                    })
                    .curve(d3.curveCardinal);
                return line([{
                        x: link.source.x + (_rectW / 4),
                        y: link.source.y + (_rectH / 2 + 17)
                    },
                    {
                        x: link.target.x + (_rectW / 4),
                        y: link.target.y
                    }
                ]);
            } else {
                var line = d3.line()
                    .x(function(d) {
                        return (d.x);
                    })
                    .y(function(d) {
                        return (d.y);
                    })
                    .curve(d3.curveStep);
                return line([{
                        x: link.source.x + (_rectW / 4) - 1,
                        y: link.source.y + (_rectH / 2 + 17)
                    },
                    {
                        x: link.source.x + (_rectW / 4) - 1,
                        y: link.target.y - (_rectH / 2 - 40)
                    },
                    {
                        x: link.target.x + (_rectW / 4) - 1,
                        y: link.target.y - (_rectH / 2 - 40)
                    },
                    {
                        x: link.target.x + (_rectW / 4) - 1,
                        y: link.target.y
                    }
                ]);
            }
        } else {
            if (drawMode == "diagonal") {
                var line = d3.line()
                    .x(function(d) {
                        return (d.x);
                    })
                    .y(function(d) {
                        return (d.y);
                    })
                    .curve(d3.curveCardinal);
                return line([{
                        x: link.source.y + (_rectW / 2 + 17),
                        y: link.source.x + (_rectH / 4)
                    },
                    {
                        x: link.target.y,
                        y: link.target.x + (_rectH / 4)
                    }
                ]);
            } else {
                var line = d3.line()
                    .x(function(d) {
                        return (d.x);
                    })
                    .y(function(d) {
                        return (d.y);
                    })
                    .curve(d3.curveStep);
                return line([{
                        x: link.source.y + (_rectW / 2 + 17),
                        y: link.source.x + (_rectH / 4) - 1
                    },
                    {
                        x: link.target.y - (_rectW / 4),
                        y: link.source.x + (_rectH / 4) - 1
                    },
                    {
                        x: link.target.y - (_rectW / 4),
                        y: link.target.x + (_rectH / 4) - 1
                    },
                    {
                        x: link.target.y,
                        y: link.target.x + (_rectH / 4) - 1
                    }
                ]);
            }
        }
    },
    handleSelectEvent: function(g, d, e) {
        var me = this,
            orient = this.getOrient(),
            targetEl = g.target,
            attributes = (targetEl) ? targetEl.attributes : {},
            selItemId = (attributes && attributes['itemid']) ? attributes['itemid'].value : null,
            record = d.data,
            obj = me.getTaskInfo(targetEl);

        if (selItemId && selItemId == 'orgExpCol' && g.type != 'dblclick') {
            //me.setSelection(d);
            var a = d3.select(d);
            var selNode = e.querySelector('[itemid=orgExpCol]'),
                oldSrc = orient == "vertical" ? me.upImage : me.leftImage,
                replaceSrc = orient == "vertical" ? me.downImage : me.rightImage,
                src;
            if (d.data.isExpanded()) {
                if (orient == "vertical") {
                    oldSrc = me.upImage;
                    replaceSrc = me.downImage;
                } else {
                    oldSrc = me.rightImage;
                    replaceSrc = me.leftImage;
                }
            }
            if (selNode) {
                //src = selNode.getAttribute('xlink:href').replace(oldSrc, replaceSrc);
                //selNode.setAttribute('xlink:href', src);
                selNode.setAttributeNS("http://www.w3.org/1999/xlink", "href", replaceSrc);
            }
            me.setSelection(a.data);
            me.onExpandEvent(g);
            me.performLayout();
            //me.onExpandEvent(g,d,e);
            //me.handleExpandEvent(g,d,e);
        } else if (obj) {
            var me = this,
                type = obj[0],
                action = obj[1],
                args = [],
                ilboView = me.up('ilbo') || getCurrentPage(),
                viewModel = ilboView.getViewModel(),
                data = viewModel.getSessionData();

            if (type == 'taskinfo') {
                args = ['uitask', ilboView, data];
                args = args.concat(TaskInfoToObjectArray(action));
                while (args.length < 10) {
                    args[args.length] = null;
                }
                ilboView.fireEvent.apply(ilboView, args);
                return true;
            } else if (type == 'linkinfo') {
                args = ['linktask', ilboView, data];
                args = args.concat(LinkInfoToObjectArray(action));
                ilboView.fireEvent.apply(ilboView, args);
                return true;
            } else if (type == 'newwindow') {
                openNewWindow(action);
                return true;
            }
        }
    },
    getTaskInfo: function(target) {
        var attributes = target.attributes,
            taskInfo = attributes.hasOwnProperty('taskinfo') ? attributes['taskinfo'] : null,
            linkInfo = attributes.hasOwnProperty('linkinfo') ? attributes['linkinfo'] : null,
            newWindow = attributes.hasOwnProperty('opennewwindow') ? attributes['opennewwindow'] || 'about:blank' : null;

        if (taskInfo)
            return ['taskinfo', taskInfo.value];
        if (linkInfo)
            return ['linkinfo', linkInfo.value];
        if (newWindow)
            return ['newwindow', newWindow.value];

        var me = this,
            parentNode = target.parentNode;

        if ((parentNode.getAttribute('class') && parentNode.getAttribute('class').indexOf('x-d3-scene') > -1) || (parentNode.hasAttribute('itemId') && parentNode.attributes['itemId'].value === "orgRect"))
            return null;
        else
            return me.getTaskInfo(parentNode);
    },
    addLinks: function(selection) {
        var me = this,
            selectedNode = me.nodeFromRecord(me.getSelection());

        return selection
            .append('path')
            .classed(this.defaultCls.link, true)
            .style('stroke', function(n) {
                if (n.source.data.id == "root")
                    return 'transparent'
                else
                    return 'black'
            })
            .style('stroke-width', 3)
            .attr('d', me.getLinkPath.bind(me));
        //.attr('transform','translate(0,0)')
        //.attr('d', this.getDiagonal());
        /*.attr('d', function (link) {
                var source = selectedNode || link.source,
                    xy = me.getOldNode(source),
                    x = xy ? xy.y : source.y,
                    y = xy ? xy.x : source.x;

                return 'M' + x + ',' + y
                     + 'C' + x + ',' + y
                     + ' ' + x + ',' + y
                    + ' ' + x + ',' + y;
            });*/
    },
    updateLinks: function(update, enter) {
        var me = this,
            selection = update.merge(enter),
            transition = me.layoutTransition,
            isRootHidden = !me.getRootVisible();
        selection
            .classed(me.defaultCls.hidden, function(link) {
                return isRootHidden && link.source.data === me.storeRoot;
            })
            .transition(transition)
            .attr('d', me.getLinkPath.bind(me));
        //.attr('d', this.getDiagonal());
    },
    removeLinks: function(selection) {
        var me = this,
            orient = this.getOrient(),
            selectedNode = me.nodeFromRecord(me.getSelection());
        selection
            .attr('opacity', 1)
            .transition(me.layoutTransition)
            .attr('opacity', 0)
            .attr('d', function(link) {
                var s = link.source, // This is the source from the old layout;
                    // we need to find it in the new layout for a proper looking transition.
                    node = selectedNode || s && me.nodeFromRecord(s.data),
                    x = node && node.x || 0,
                    y = node && node.y || 0;
                if (orient == "vertical") {
                    return 'M' + x + ',' + y +
                        'C' + x + ',' + y +
                        ' ' + x + ',' + y +
                        ' ' + x + ',' + y;
                } else {
                    return 'M' + y + ',' + x +
                        'C' + y + ',' + x +
                        ' ' + y + ',' + x +
                        ' ' + y + ',' + x;
                }
            })
            .remove();
    },
    updateDefData: function(defData) {
        var me = this,
            curDef = me.getDefs();
        if (curDef && defData) {
            curDef.html(function(node) {
                return defData;
            });
        }
    }
});
// Pivot Drill down 
Ext.define('Ext.ramoc.pivot.plugin.DrillDown', {
    alias: 'plugin.ramcopivotdrilldown',
    extend: 'Ext.plugin.Abstract',
    lockableScope:  'top',
    config: {
		columns:     null,
		width:        '95%',
		height:        400,
		remoteStore:    null,
		grid: null,
		view: null
	},
	textWindow: 'Drill down window',
	init: function(grid){
        //<debug>
        // this plugin is available only for the pivot grid
        if (!grid.isPivotGrid) {
            Ext.raise('This plugin is only compatible with Ext.pivot.Grid');
        }
        //</debug>

        this.setGrid(grid);
        return this.callParent([grid]);
    },
	
    destroy: function(){
        this.setConfig({
            grid: null,
            view: null
        });
        this.callParent();
    },
	updateGrid: function(grid){
        Ext.destroy(this.gridListeners);

        if(grid){
            this.gridListeners = grid.on({
                pivotitemcelldblclick:      'showPanel',
                pivotgroupcelldblclick:     'showPanel',
                pivottotalcelldblclick:     'showPanel',
                scope:                      this,
                destroyable:                true
            });
        }
    },

    updateView: function(view, oldView){
        Ext.destroy(oldView);
    },

    showPanel: function(params, e, eOpts){
        var me = this,
            grid = me.getGrid(),
            matrix = grid.getMatrix(),
            columns = Ext.Array.from(me.getColumns() || []),
            result, fields, store, filters, view,
            i, len, value;

        // do nothing if the plugin is disabled
        if(me.disabled) {
            return;
        }
		if(params){
			result = matrix.results.get(params.leftKey, params.topKey);

			if(!result){
				return;
			}
		}
		//TECH-34281 // EP-409
		// Handling DDT Grid State Process
		configurator = grid.plugins[2];
		if (configurator) {
			len = configurator.getFields().length,
			cLen = columns.length;
			if (len == cLen) {
				for(var cr = 0; cr < len; cr++) {
					if (columns[cr].dataIndex == configurator.fields.items[cr].dataIndex) {
						columns[cr].hidden = configurator.fields.items[cr].hidden;
					}
				}
			}
		}
		store = grid.getRemoteStore();
		store.removeAll(true);
        // create the window that will show the records
        view = me.createPanel(store, columns);
		view.ilbo = grid.up('ilbo');
		view.ilbo.add(view);
        view.show();
		grid.ddtGrid = true;
        me.setView(view);
		if(result)
			grid.fireEvent('showdrilldownpanel', grid,view, result);
    },	
    createPanel: function(store, columns){
        var me = this,
		grid = me.getGrid();

        var ddtGridWin = Ext.create('Ext.window.Window', {
            title: me.textWindow,
            layout: 'fit',
			width: window.screen.width - 100,
			height: 188,
            modal: true,
			isPvtDD: true,
            closeAction: 'hide',
            items: [{
					xtype: 'ramcoddtgrid',	
					parentId:grid.itemId,
					flex: 1,
					visibleRows: 5,
					reqBorder: true,
					columnLines: true,
					rowLines: true,
					insertFlag: false,
					deleteFlag: true,
					showHeader: true,
					showRowNumber: true,
					showSelection: true,
					showScrollBar: false,
					showToolbar: false,
					stripeRows: true,
					//columnFit: true,					  
					padding:0,
					//visibleRows:20,
					viewConfig: {
						loadMask: false
					},
					columns: columns,
					store: store
            }],
            listeners: {
                close: 'onClosePanel',
                scope: me
            }
        });
		return ddtGridWin;
    },

    onClosePanel: function(){
        var view = this.getView(),
			grid = this.getGrid();
		
        grid.fireEvent('hidedrilldownpanel', view);
        //Ext.destroy(view);
		view.ilbo.remove(view, true);
		this.setView(null);		
		grid.ddtGrid = false;
    },

    getFiltersFromParams: function(obj){
        var filters = [],
            i, len, keys;

        if(Ext.isObject(obj)) {
            keys = Ext.Object.getKeys(obj);
            len = keys.length;

            for (i = 0; i < len; i++) {
                filters.push({
                    property: keys[i],
                    exactMatch: true,
                    value: obj[keys[i]]
                });
            }
        }

        return filters;
    }
});

// Pivot Maxtrix
Ext.define('Ext.ramco.pivot.matrix.Remote', {
    extend: 'Ext.pivot.matrix.Base',
    alias: 'pivotmatrix.ramcoremote',
    delayedProcess: function() {
        var me = this,
            matrix = me.serialize(),
            ret, params;

        me.clearData();

    },
	processDynCaption: function (data) {
        var me = this,
            items, item, len, i, dimension, 
			colData = null;
		
		items = Ext.Array.from(data.leftAxis || []);
        len = items.length;
		
        for (i = 0; i < len; i++) {
            item = items[i];
            if (Ext.isObject(item)) {
				dimension = me.leftAxis.dimensions.getByKey(item.dimensionId);
				if(dimension) {
					if(data.columnsValue)
						colData = data.columnsValue[dimension.id];
					if (colData && !Ext.isEmpty(colData.scc))
						dimension.config.header = colData.scc;
						me.leftAxis.addItem(item);
            	}
        	}
        }
	},
    processRemoteResults: function(data) {
        var me = this,
            items, item, len, i, dimension, 
			colData = null;

        items = Ext.Array.from(data.leftAxis || []);
        len = items.length;
        for (i = 0; i < len; i++) {
            item = items[i];
            if (Ext.isObject(item)) {
				dimension = me.leftAxis.dimensions.getByKey(item.dimensionId);
                if(dimension)
                me.leftAxis.addItem(item);
            }
        }

        items = Ext.Array.from(data.topAxis || []);
        len = items.length;
        for (i = 0; i < len; i++) {
            item = items[i];
            if (Ext.isObject(item)) {
				dimension = me.topAxis.dimensions.getByKey(item.dimensionId);
                if(dimension)
                me.topAxis.addItem(item);
            }
        }

        items = Ext.Array.from(data.results || []);
        len = items.length;
        for (i = 0; i < len; i++) {
            item = items[i];
            if (Ext.isObject(item)) {
                var result = me.results.add(item.leftKey || '', item.topKey || '');
                Ext.Object.each(item.values || {}, result.addValue, result);
            }
        }

        me.endProcess();
    }
});

Ext.define('Ext.o.form.field.Base', {
	override:'Ext.form.field.Base',
	initDefaultName: function() {
        var me = this;
        // Default name to inputId
        if (!me.name) {
            me.name = me.getItemId(); //+ "_" + (Date.now());
        }
    },
	initEvents : function(){		 
        var me = this,
            inputEl = me.inputEl,
            onFieldMutation = me.onFieldMutation,
            events = me.checkChangeEvents,
            len = events.length,
            i, event;
		me.callParent();
        if (inputEl && (inputEl.dom.type == "checkbox" || inputEl.dom.type == "radio")) {
            //me.mon(inputEl, 'mouseup', me.mouseUp,  me); 
			me.mon(inputEl, Ext.supports.SpecialKeyDownRepeat ? 'keydown' : 'keypress', me.spacedown,  me);
			me.mon(inputEl, 'change', me.checkedChange,  me); 
        }
    },
	fireKey: function(e, eOpts){
		var me = this;
        if(e.isSpecialKey()){
            this.fireEvent('specialkey', this, e, eOpts);
        }
		if (me.picker && !me.picker.isHidden() && me.xtype == "ramcolistedit") {
			me.fireEvent('lstedtspecialkey', this, e, eOpts);
		}
    },
	checkedChange: function(e, eOpts) {
		var me = this;
		Ext.defer(function() {me.fireEvent('mouseclick', me, arguments);},10);
	},
	spacedown: function(e, eOpts){
        if(e.keyCode == 32){
            this.fireEvent('specialkey', this, e, eOpts);
        }
    },
	mouseUp: function() {
		var me = this;
		Ext.defer(function() {me.fireEvent('mouseclick', me, arguments);},10);
    }
});
Ext.define('Ext.o.pivot.matrix.Base', {
	override:'Ext.pivot.matrix.Base',
	initAggregates: function(dimensions){
        var me = this,
            i, item;        
        Ext.destroy(me.aggregate);
        me.aggregate = new Ext.pivot.MixedCollection();
        me.aggregate.getKey = function(item){
            return item.getId();
        };        
        if(Ext.isEmpty(dimensions)){
            return;
        } 
        dimensions = Ext.Array.from(dimensions);        
        for(i = 0; i < dimensions.length; i++){
            item = dimensions[i];
			item.id = item.dataIndex + "agg" + i;			
            if(!item.isInstance){
                Ext.applyIf(item, {
                    isAggregate:        true,
                    align:              'right',
                    showZeroAsBlank:    me.showZeroAsBlank
                });
                item = new Ext.pivot.dimension.Item(item);
            }
            item.matrix = this;
            me.aggregate.add(item);
        }
    }
});
Ext.define('Ext.o.pivot.plugin.configurator.Field', {
	override:'Ext.pivot.plugin.configurator.Field',
	clone: function() {
        return new Ext.pivot.plugin.configurator.Field(Ext.applyIf({}, this.getInitialConfig()))		
    }
});
Ext.define('Ext.o.pivot.plugin.configurator.Panel', {
	override:'Ext.pivot.plugin.configurator.Panel',	
	addFieldsToConfigurator: function(fields, fieldsCt) {
		var len = fields.length, 
			i;
		for(i = 0; i < len; i++) {
			if (fields[i].hidden == false)
			   fieldsCt.addField(fields[i], -1);
		}
	}
});

// Pivot Control
Ext.define('Ext.ramco.pivot.Grid', {
    extend: 'Ext.pivot.Grid',
    xtype: 'ramcopivot',
    enableLoadMask: false,
    enableLocking: true,
    showCfg: true,
	collapseCfg: false,
	bufferedRenderer: false,
    border: true,
    fields: [],
    config: {
        value: null,
		ddtValue: null,
		remoteStore:null,
		assGridName:null,
		assGridTask:null,
		assGridTaskType:null,
		assGridTaskLaunchMode:null
    },
    defaultBindProperty: 'value',
    initComponent: function() {
        var me = this,
			f = null,
			assGridName = me.getAssGridName();
        me.plugins = [{
            ptype: 'pivotexporter',
            pluginId: 'exporter'
		}]
		if(Ext.isEmpty(assGridName)){
			me.plugins.push({
			ptype: 'ramcopivotdrilldown',
			pluginId: 'drilldown',
			columns:me.fields
			});
		}
		else{
			me.mon(me,{
				pivotitemcelldblclick:'onCellDblClick',
				scope:me,
				destroyable: true
			});
		}
        if (me.showCfg) {
            if (me.fields && me.fields.length > 0) {
				for(f = 0; f  < me.fields.length; f++) {
					me.fields[f].settings = {aggregators: ['sum', 'avg', 'count', 'min', 'max']};
				}
                me.plugins.push({
                    ptype: 'pivotconfigurator',
					dock: 'top',
                    border: true,
                    pluginId: me.itemId + '_cfg',
                    fields: me.fields
                });
            }
        }
        me.dockedItems = [{
            dock: 'top',
            xtype: 'toolbar',
            itemId: 'gridToolbar',
            overflowHandler: 'scroller',
            defaults: {
                scale: 'small',
                padding: 0
            },
            items: [{
                text: rvw_resources.R162,
                itemId: 'btnExpPvtExcel',
                tooltip: rvw_resources.R151,
				iconCls: 'x-fa fa-download',
				menu: {
					items: [{
						text:   'Excel xlsx (all items)',
						iconCls: 'x-fa fa-file-excel-o',
						handler: me.exportAllToXlsx.bind(me)
					},{
						text:   'Excel xlsx (visible items)',
                		iconCls: 'x-fa fa-file-excel-o',
						handler: me.exportVisibleToXlsx.bind(me)
					},{
						text: 'Excel xml (all items)',
						iconCls: 'x-fa fa-file-excel-o',
						handler: me.exportAllToXml.bind(me)
					},{
						text:   'Excel xml (visible items)',
						iconCls: 'x-fa fa-file-excel-o',
						handler: me.exportVisibleToXml.bind(me)
					},{
						text:   'CSV (all items)',
						iconCls: 'x-fa fa-file-csv-o',
						handler: me.exportAllToCSV.bind(me)
					},{
						text:   'CSV (visible items)',
						iconCls: 'x-fa fa-file-csv-o',
						handler: me.exportVisibleToCSV.bind(me)
					},{
						text:   'TSV (all items)',
						iconCls: 'x-fa fa-file-tsv-o',
						handler: me.exportAllToTSV.bind(me)
					},{
						text:   'TSV (visible items)',
						iconCls: 'x-fa fa-file-tsv-o',
						handler: me.exportVisibleToTSV.bind(me)
					},{
						text:   'HTML (all items)',
						iconCls: 'x-fa fa-file-html-o',
						handler: me.exportAllToHtml.bind(me)
					},{
						text:   'HTML (visible items)',
						iconCls: 'x-fa fa-file-html-o',
						handler: me.exportVisibleToHtml.bind(me)
					}]
				}
            }, '->', {
                itemId: 'dspPvt',
                xtype: 'component',
                html: rvw_resources.R142
            }]
        }];
        me.callParent();
		me.mon(me,{
			documentsave: me.onDocumentSave,
			beforedocumentsave: me.onBeforeDocumentSave
		});
	},
	onCellDblClick:function(params, e, eOpts){
		var me = this,
			src = RamcoRTC.RTS.getDrillDownUrl(),
			assGridName = me.getAssGridName(),
			assGridTask = me.getAssGridTask(),
			assGridTaskType= me.getAssGridTaskType(),
			assGridTaskLaunchMode = me.getAssGridTaskLaunchMode(),			
			view = me.up('ilbo'),
			viewcfg =  view.ilboConfig,
			xw = new XMLWriter('UTF-8'),
			xmlData="",
			headerText="",
			key,
			value,
			leftData = params.leftItem.data,
			topData = params.topItem.data,
			leftKeys,topKeys,i,len;
		
		xw.writeStartDocument();
		xw.writeStartElement('trqi');
		
		leftKeys = Object.keys(leftData);
		i=0;
		len = leftKeys.length;
		for(;i<len;i++){
			xw.writeStartElement('i');
			key = leftKeys[i];
			value = leftData[key];
			headerText = me.getColumnHeader(key);
			xw.writeAttributeString('n', headerText);
			xw.writeAttributeString('v', value);
			xw.writeEndElement();
		}
		topKeys = Object.keys(topData);
        
		i=0;
		len = topKeys.length;
		for(;i<len;i++){
			xw.writeStartElement('i');
			key = topKeys[i];
			value = topData[key];
			headerText = me.getColumnHeader(key);
			xw.writeAttributeString('n', headerText);
			xw.writeAttributeString('v', value);
			xw.writeEndElement();
		}
		xw.writeEndElement();
		xw.writeEndDocument();
		xmlData = xw.flush();
		xw.close();
		Ext.Ajax.request({
			timeout: 600000,
            url: src,
			method:"POST",
			headers: {'Requid': RamcoRTC.sessionToken},
			urlParams: {
				al: viewcfg.activityName,
				il: viewcfg.ilboName,
				ct: assGridName
			},
			xmlData:xmlData,
            disableCaching: true
		}).then(function(response){
			var mainController = getMainController(),
				isModal = false;			
			RamcoRTC.sessionToken = response.getResponseHeader("Requid");
			if (assGridTaskType == "link" && !Ext.isEmpty(assGridTaskLaunchMode) && assGridTaskLaunchMode == "modal") {
				isModal = true;
			}
			view.executeTask(assGridTask, assGridTaskType, isModal);
		},function(response){
			RamcoRTC.sessionToken = response.getResponseHeader("Requid");
		});
	},
	doExport: function(config){
        this.saveDocumentAs(config).then(null, this.onError);
    },
	onError: function(error){
        Ext.Msg.alert('Error', typeof error === 'string' ? error : 'Unknown error');
    },

    onBeforeDocumentSave: function(view){
		Ext.getBody().mask('Document is prepared for export. Please wait ...');
        //this.mask('Document is prepared for export. Please wait ...');
    },

    onDocumentSave: function(view){
		Ext.getBody().unmask();
        //this.unmask();
    },
	exportAllToXml: function(){
        this.doExport({
            type: 'excel03',
            title: 'Pivot grid export demo',
            fileName: 'ExportAll.xml'
        });
    },

    exportVisibleToXml: function(){
        this.doExport({
            type: 'excel03',
            title: 'Pivot grid export demo',
            fileName: 'ExportVisible.xml',
            onlyExpandedNodes: true
        });
    },

    exportAllToCSV: function(){
        this.doExport({
            type: 'csv',
            title: 'Pivot grid export demo',
            fileName: 'ExportAll.csv'
        });
    },

    exportVisibleToCSV: function(){
        this.doExport({
            type: 'csv',
            title: 'Pivot grid export demo',
            fileName: 'ExportVisible.csv',
            onlyExpandedNodes: true
        });
    },

    exportAllToTSV: function(){
        this.doExport({
            type: 'tsv',
            title: 'Pivot grid export demo',
            fileName: 'ExportAll.csv'
        });
    },

    exportVisibleToTSV: function(){
        this.doExport({
            type: 'tsv',
            title: 'Pivot grid export demo',
            fileName: 'ExportVisible.csv',
            onlyExpandedNodes: true
        });
    },

    exportAllToHtml: function(){
        this.doExport({
            type: 'html',
            title: 'Pivot grid export demo',
            fileName: 'ExportAll.html'
        });
    },

    exportVisibleToHtml: function(){
        this.doExport({
            type: 'html',
            title: 'Pivot grid export demo',
            fileName: 'ExportVisible.html',
            onlyExpandedNodes: true
        });
    },

    exportAllToXlsx: function(){
        this.doExport({
            type: 'excel07',
            title: 'Pivot grid export demo',
            fileName: 'ExportAll.xlsx'
        });
    },
    exportVisibleToXlsx: function(){
        this.doExport({
            type: 'excel07',
            title: me.title ? me.title : 'export',
            fileName: 'ExportVisible.xlsx',
            onlyExpandedNodes:  true
         });
    },
    updateValue: function(newValue) {
		var me = this,
			configPanel = null,
			tbar = me.getDockedComponent('gridToolbar'),
			maxtrix;
		//Dynamic Caption
		configurator = me.getPlugin(me.itemId + '_cfg');
		if (configurator) {
			configPanel = configurator.getConfigPanel();
			if (configPanel && !configPanel.getCollapsed()) {
				configPanel.setCollapsed(me.collapseCfg);
			}
		}
		if(configurator && newValue.columns) {
			var c =0,
				columns = me.getColumns(),				
				len = configurator.getFields().length;
				maxtrix = me.getMatrix();
			for(; c < len; c++) {				
				cDataIndex = configurator.fields.items[c].dataIndex;
				columnValue = newValue.columnsValue[cDataIndex];
				if (columnValue && columnValue.scc) {					
					configurator.fields.items[c].header = columnValue.scc;
					configurator.fields.items[c].config.header = columnValue.scc;
				}
			}
			maxtrix.processDynCaption(newValue);
		}
        if(Ext.isEmpty(newValue.success)) {
			var pivotGr = this.plugins[1];
			var view = pivotGr.view;
			if(!pivotGr.view){
				pivotGr.showPanel();
			}
			var ddtGr = pivotGr.view.items.getAt(0);
			//var ddtGr = grCon.items.getAt(0);
			ddtGr.updateValue(newValue);
		}
		else if (!Ext.isEmpty(me.ddtGrid) && me.ddtGrid === true) {
			var pivotGr = this.plugins[1];
			var view = pivotGr.view;
			if(!pivotGr.view){
				pivotGr.showPanel();
			}
			var ddtGr = pivotGr.view.items.getAt(0);
			//var ddtGr = grCon.items.getAt(0);
			ddtGr.updateValue(newValue.ddtValue);
		}
		else {
			var	dspPvt = null;
				if (tbar) {
					dspPvt = tbar.getComponent("dspPvt");
				}
				maxtrix = me.getMatrix();
				maxtrix.delayedProcess();
				
			//if(newValue && newValue.results && newValue.results.length > 0) {
			if(newValue.results && newValue.results.length > 0) {
				if (newValue) {
					maxtrix.processRemoteResults(newValue);
					if (dspPvt) {
						dspPvt.setHtml("");
					}
				} 
				else {
					if (dspPvt) {
						dspPvt.setHtml(rvw_resources.R142);
					}
					maxtrix.endProcess();
				}
			}
			else {
				maxtrix.clearData();
				maxtrix.endProcess();
			}
		}
		if (newValue.columns) {
			if (!me.columnInit && newValue.columnsValue) {
				var columns = me.getColumns(),
					column, columnValue;
				for (key in columns) {
					column = columns[key];
					if (column) {
						columnValue = newValue.columnsValue[column.dataIndex];
						if (columnValue) {
							//column.setFormat(columnValue['ft']);
							if (columnValue['scc'])
								column.setText(columnValue['scc'])
						}
					}
				}
			}
		}		
    },
	processState: function(views) {	
        var me = this,
            topbar = me.getDockedComponent('gridToolbar'),
            scrollbar = me.getDockedComponent('gridScroller'),
            fieldList = topbar ? topbar.getComponent('fieldList') : null,
            insertBtn = topbar ? topbar.getComponent('btnInsert') : null,
            btnCut = topbar ? topbar.getComponent('btnCut') : null,
            btnCopy = topbar ? topbar.getComponent('btnCopy') : null,
            colunmManager = me.getColumnManager(),
            columns = colunmManager.getColumns(),            
            element1,
            gridView,
            column,
            oColumn,
            width = 0,
            colWidth = 0,
            forceFit = me.columnFit,
            nGridView,
			vP='',
			configurator = null,
            persData = [];
        view = me.getView();
        me.coldef = false;
        nGridView = view.normalGrid ? view.normalGrid.view : view;
        configurator = me.plugins[2];
        me.suspendEvents();
        for (element1 in views) {
            gridView = views[element1];
			vP = me.getAllColumnIndex(gridView.id);			
            if (!persData[gridView.id]) {
                persData[gridView.id] = {
                    vid:gridView.id,
					p: vP,
                    wi: gridView.width,
                    pa: false,
                    ch:true
                };
            }            
			if(configurator && configurator.fields) {
				column = configurator.fields.items[vP];
			}
            if (column) {
                if (gridView.text) {
                    column.setText(gridView.text);
                }
				// TECH-32964 - PFP-60
				if(column.initialConfig && column.initialConfig.hidden)
					column.isStateHidden = true;
                if (!Ext.isEmpty(gridView.visible)) {
					// TECH-35534 / TECH-35642 / TECH-35619 / TECH-35651                    
					// TECH-36636
					//if (gridView.visible == 'n' && column.isVisible()) {
					if (gridView.visible == 'n' && column.hidden === false) {
						column.hidden = true;
                    }
					// TECH-36636
					//if (gridView.visible == 'y' && column.isHidden()) {
					if (gridView.visible == 'y' && column.hidden === true) {
						column.hidden = false;
                    }
					//TECH-28696 / TECH-29031
					// TECH-32964 - PFP-60
					if (Ext.isEmpty(gridView.st) || gridView.st == '0' || gridView.st == '2') {
						if(gridView.visible == "y")
							column.isStateHidden = false;
						else
							column.isStateHidden = true;
                    }                    
                }				
            }
        }
        me.resumeEvents();        
	},
	getColumnHeader: function(name) {
        var me = this,            
            columns = me.fields,
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name)
                return column.btSynonym;
        }        
		return "";
    },
	getAllColumnIndex: function(name) {
        var me = this,            
            columns = me.fields,
            column = {},
            i = 0;
        for (; i < columns.length; i++) {
            column = columns[i];
            if (column.dataIndex == name) {
                break;
            } else
                column = {};
        }        
		return (i);
    },
	updateHeaderContainerColumns: function(group){
		var me = this,
			view = this.getView(),
			headerCt = view.normalView ? view.normalView.getHeaderCt() : view.getHeaderCt(),
			grid = view.normalGrid ? view.normalGrid : me,
			i = 0,
			toDestroy = [],
			cols, index, ownerCt, item, column;

		if(group) {
			// let's find the first column that matches this group
			// that will be our new columns insertion point
			column = me.getColumnForGroup(headerCt.items, group);
			if(column.found) {
				// let's inform the view that we add/remove columns in a batch
				grid.reconfiguring = true;
				ownerCt = column.item.ownerCt;
				index = column.index;

				while (i < ownerCt.items.length) {
					item = ownerCt.items.getAt(i);
					if (item.group == group) {
						// destroying should happen after the new columns were inserted
						toDestroy.push(item);
					}
					i++;
				}

				cols = Ext.clone(me.pivotColumns);
				me.preparePivotColumns(cols);
				cols = me.getVisiblePivotColumns(me.prepareVisiblePivotColumns(cols), group);
				cols = ownerCt.insert(index, cols);
				Ext.destroy(toDestroy);
				grid.reconfiguring = false;
				// let's focus the first inserted column now
				if (cols && cols.length) {
					cols[0].focus();
				}
				// for performance reasons we do a custom reconfiguring of columns
				// so we need to call ourselves onHeadersChanged handler
				grid.onHeadersChanged();
			}
		}else{
			// we probably have to expand/collapse all group columns
			cols = Ext.clone(me.pivotColumns);
			me.preparePivotColumns(cols);
			// we need to remove the hidden columns because they trigger view refreshes during reconfiguring
			cols = me.prepareVisiblePivotColumns(cols);
			me.reconfigure(undefined, cols);
		}
    }	
});

// Org Chart
Ext.define('Ext.ramco.Orgchart', {
    extend: 'Ext.Component',
    alias: 'widget.orgchart'
});

// User Info Profile
Ext.define('Ext.ramco.Profile', {
    extend: 'Ext.panel.Panel',
    xtype: 'profile',

    requires: [
        'Ext.Button',
        'Ext.Container'
    ],
    layout: {
        type: 'hbox',
        align: 'stretch'
    },
    height: 103,
    bodyPadding: 5,
    style: {
        'background-color': 'white'
    },
    viewModel: {
        data: {
            n: '',
            fn: '',
            oud: '',
            rd: ''
        }
    },
    dockedItems: [{
        xtype: 'container',
        dock: 'bottom',
        height: 1,
        margin: '0 5',
        style: {
            'background-color': 'transparent'
        },
        items: [{
            xtype: 'ramcoline'
        }]
    }],
    items: [{
        xtype: 'ramcoimage',
        width: 90,
        height: 90,
        //errSrc:'resources/images/profile.png',
        bind: 'resources/images/{n}.png'
    }, {
        xtype: 'container',
        padding: 5,
        layout: {
            type: 'vbox',
            align: 'stretch'
        },
        items: [{
            xtype: 'component',
            style: {
                'text-align': 'right',
                'padding': '5px',
                'font-size': '18px',
                'font-weight': 'bold'
            },
            bind: '{fn}'
        }, {
            xtype: 'component',
            style: {
                'text-align': 'right',
                'padding': '5px',
                'font-size': '14px'
            },
            bind: '{oud}'
        }, {
            xtype: 'component',
            style: {
                'text-align': 'right',
                'padding': '5px',
                'font-size': '14px'
            },
            bind: '{rd}'
        }],
        flex: 1
    }]
});

// Message Window
Ext.define('Ext.ramco.MessageBox', {
    extend: 'Ext.window.Window',
    listTitle: 'Details',
    sr: 'Source',//TECH-31092
    sv: 'Severity',
    cd: 'Error Id',
    ds: 'Description',
    ca: 'Corrective Action',
    requires: [
        'Ext.toolbar.Toolbar',
        'Ext.form.field.Text',
        'Ext.form.field.TextArea',
        'Ext.button.Button',
        'Ext.layout.container.Anchor',
        'Ext.layout.container.HBox',
        'Ext.ProgressBar'
    ],

    alias: 'widget.messagebox',

    /**
     * @property
     * Button config that displays a single OK button
     */
    OK: 1,
    /**
     * @property
     * Button config that displays a single Yes button
     */
    YES: 2,
    /**
     * @property
     * Button config that displays a single No button
     */
    NO: 4,
	CONTINUE: 8,
    /**
     * @property
     * Button config that displays a single Cancel button
     */
    CANCEL: 16,
    /**
     * @property
     * Button config that displays OK and Cancel buttons
     */
    OKCANCEL: 17,
    /**
     * @property
     * Button config that displays Yes and No buttons
     */
    YESNO: 6,
    /**
     * @property
     * Button config that displays Yes, No and Cancel buttons
     */
    YESNOCANCEL: 22,
    CONTINUECANCEL: 24,
    /**
     * @property
     * The CSS class that provides the INFO icon image
     */
    INFO: Ext.baseCSSPrefix + 'message-box-info',
    /**
     * @property
     * The CSS class that provides the WARNING icon image
     */
    WARNING: Ext.baseCSSPrefix + 'message-box-warning',
    /**
     * @property
     * The CSS class that provides the QUESTION icon image
     */
    QUESTION: Ext.baseCSSPrefix + 'message-box-question',
    /**
     * @property
     * The CSS class that provides the ERROR icon image
     */
    ERROR: Ext.baseCSSPrefix + 'message-box-error',

    // hide it by offsets. Windows are hidden on render by default.
    hideMode: 'offsets',
    closeAction: 'hide',
    resizable: false,
    scrollable: true,
    alwaysOnTop: true,
    title: '&#160;',
	// TECH-29248 - Message Window - Width Update
    defaultMinWidth: window.screen.availWidth / 2,
    defaultMaxWidth: window.screen.availWidth / 2,
    defaultMinHeight: 55,
    defaultMaxHeight: 250,

    // Forcibly set these to null on the prototype to override anything set higher in
    // the hierarchy
    minWidth: null,
    maxWidth: null,
    minHeight: null,
    maxHeight: null,
    constrain: true,

    cls: [Ext.baseCSSPrefix + 'message-box', Ext.baseCSSPrefix + 'hidden-offsets'],

    layout: {
        type: 'vbox',
        align: 'stretch'
    },

    // We want to shrinkWrap around all docked items
    shrinkWrapDock: true,

    /**
     * @property
     * The default height in pixels of the message box's multiline textarea if displayed.
     */
    defaultTextHeight: 75,
    /**
     * @property
     * The minimum width in pixels of the message box if it is a progress-style dialog.  This is useful
     * for setting a different minimum width than text-only dialogs may need.
     */
    minProgressWidth: 250,
    /**
     * @property
     * The minimum width in pixels of the message box if it is a prompt dialog.  This is useful
     * for setting a different minimum width than text-only dialogs may need.
     */
    minPromptWidth: 250,
    //<locale type="object">
    /**
     * @property
     * An object containing the default button text strings that can be overriden for localized language support.
     * Supported properties are: ok, cancel, yes and no.  Generally you should include a locale-specific
     * resource file for handling language support across the framework.
     * Customize the default text like so:
     *
     *     Ext.window.MessageBox.buttonText.yes = "oui"; //french
     */
    buttonText: {
        ok: rvw_resources.R102,
        yes: rvw_resources.R104,
        no: rvw_resources.R105,
		tcontinue: rvw_resources.R127,
        cancel: rvw_resources.R103
    },
    //</locale>

    buttonIds: [
        'ok', 'yes', 'no', 'tcontinue', 'cancel'
    ],

    //<locale type="object">
    titleText: {
        confirm: 'Confirm',
        prompt: 'Prompt',
        wait: 'Loading...',
        alert: 'Attention'
    },
    //</locale>

    baseIconCls: Ext.baseCSSPrefix + 'message-box-icon',

    ariaRole: 'alertdialog',

    makeButton: function(btnIdx) {
        var btnId = this.buttonIds[btnIdx];
        return new Ext.button.Button({
            handler: this.btnCallback,
            itemId: btnId,
            scope: this,
            text: this.buttonText[btnId]
            //minWidth: 75
        });
    },

    btnCallback: function(btn, evt) {
        var me = this,
            value,
            field;

        // If this is caused by a keydown event (eg: SPACE on a Button), then the
        // hide will throw focus back to the previously focused element which will
        // then recieve an unexpected keyup event.
        // So defer callback handling until the upcoming keyup event.
        if (evt && evt.type === 'keydown' && !evt.isSpecialKey()) {
            evt.getTarget(null, null, true).on({
                keyup: function(e) {
                    me.btnCallback(btn, e);
                },
                single: true
            });
            return;
        }

        if (me.cfg.prompt || me.cfg.multiline) {
            if (me.cfg.multiline) {
                field = me.textArea;
            } else {
                field = me.textField;
            }
            value = field.getValue();
            field.reset();
        }

        // Component.onHide blurs the active element if the Component contains the active element
        me.hide();
        me.userCallback(btn.itemId, value, me.cfg);
    },

    hide: function() {
        var me = this,
            cls = me.cfg ? me.cfg.cls : '';

        me.progressBar.reset();
        if (cls) {
            me.removeCls(cls);
        }
        me.callParent(arguments);
    },

    /**
     * @private
     */
    constructor: function(cfg) {
        var me = this;

        me.callParent(arguments);

        // set the default min/max/Width/Height to the initially configured min/max/Width/Height
        // so that it will be used as the default when reconfiguring.
        me.minWidth = me.defaultMinWidth = (me.minWidth || me.defaultMinWidth);
        me.maxWidth = me.defaultMaxWidth = (me.maxWidth || me.defaultMaxWidth);
        me.minHeight = me.defaultMinHeight = (me.minHeight || me.defaultMinHeight);
        me.maxHeight = me.defaultMaxHeight = (me.maxHeight || me.defaultMaxHeight);
    },

    initComponent: function(cfg) {
        var me = this,
            baseId = me.id,
            i, button;

        // A title or iconCls could have been passed in the config to the constructor.
        me.title = me.title || '&#160;';
        me.iconCls = me.iconCls || '';

        me.topContainer = new Ext.container.Container({
            layout: 'hbox',
            padding: 10,
            style: {
                overflow: 'hidden'
            },
            items: [
                me.iconComponent = new Ext.Component({
                    cls: me.baseIconCls
                }),
                me.promptContainer = new Ext.container.Container({
                    flex: 1,
                    layout: {
                        type: 'vbox',
                        align: 'stretch'
                    },
                    items: [
                        me.msg = new Ext.Component({
                            id: baseId + '-msg',
                            cls: me.baseCls + '--text'
                        }),
                        me.textField = new Ext.form.field.Text({
                            id: baseId + '-textfield',
                            enableKeyEvents: true,
                            listeners: {
                                keydown: me.onPromptKey,
                                scope: me
                            }
                        }),
                        me.textArea = new Ext.form.field.TextArea({
                            id: baseId + '-textarea',
                            height: 75
                        })
                    ]
                })
            ]
        });
        me.store = new Ext.data.JsonStore({
            proxy: {
                type: 'memory',
                reader: {
                    type: 'json'
                }
            },
            fields: ['sr', 'sv', 'cd', 'ds', 'ca']
        });
        me.gridContainer = new Ext.grid.Panel({
            title: me.listTitle,
            collapsible: true,
            collapsed: true,
            height: 131,
            store: me.store,
            columns: [{
				//TECH-31092
                text: me.cd,
                dataIndex: 'cd',
                //TECH-30396
				//flex: 1
				cellWrap: true,
				width: 50
            }, {
                text: me.sv,
                dataIndex: 'sv',
                //TECH-30396
				//flex: 1
				cellWrap: true,
				width: 50 
            }, {
				//TECH-31092
                text: me.sr,
                dataIndex: 'sr',
                //TECH-30396
				//flex: 1
				cellWrap: true,
				width: 50 
            }, {
                text: me.ds,
                dataIndex: 'ds',
				//TECH-30396
				cellWrap: true, 
                flex: 1
            }, {
                text: me.ca,
                dataIndex: 'ca',
                //TECH-30396
				//flex: 1
				cellWrap: true,
				width: 100 
            }],
            //forceFit :true,
			// TECH-32904
			viewConfig : {
				deferEmptyText: false,
				enableTextSelection:true
			},
            listeners: {
                beforeexpand: {
                    fn: me.onGridExpand.bind(me)
                },
                beforecollapse: {
                    fn: me.onGridCollapse.bind(me)
                }
            }
        });
        me.progressBar = new Ext.ProgressBar({
            id: baseId + '-progressbar',
            margin: '0 10 10 10'
        });

        me.items = [me.topContainer, me.progressBar, me.gridContainer];

        // Create the buttons based upon passed bitwise config
        me.msgButtons = [];
        for (i = 0; i < 5; i++) {
            button = me.makeButton(i);
            me.msgButtons[button.itemId] = button;
            me.msgButtons.push(button);
        }
        me.bottomTb = new Ext.toolbar.Toolbar({
            id: baseId + '-toolbar',
            ui: 'footer',
            dock: 'bottom',
            layout: {
                pack: 'center'
            },
            items: [
                me.msgButtons[0],
                me.msgButtons[1],
                me.msgButtons[2],
                me.msgButtons[3],
                me.msgButtons[4]
            ]
        });
        me.dockedItems = [me.bottomTb];
        me.on('close', me.onClose, me);
        me.callParent();
    },
    onGridExpand: function(p, animate, eOpts) {
        this.oldHeight = this.getHeight();
        this.setHeight(this.oldHeight + 300);
        this.center();
    },
    onGridCollapse: function(p, direction, animate, eOpts) {
        this.setHeight(this.oldHeight);
        delete this.oldHeight;
        this.center();
    },

    onClose: function() {
        var btn = this.header.child('[type=close]');

        if (btn) {
            // Give a temporary itemId so it can act like the cancel button
            btn.itemId = 'cancel';
            this.btnCallback(btn);
            delete btn.itemId;
        }
    },

    onPromptKey: function(textField, e) {
        var me = this;

        if (e.keyCode === e.RETURN || e.keyCode === 10) {
            if (me.msgButtons.ok.isVisible()) {
                me.msgButtons.ok.handler.call(me, me.msgButtons.ok);
            } else if (me.msgButtons.yes.isVisible()) {
                me.msgButtons.yes.handler.call(me, me.msgButtons.yes);
            }
        }
    },

    reconfigure: function(cfg) {
        var me = this,
            buttons = 0,
            hideToolbar = true,
            oldButtonText = me.buttonText,
            resizer = me.resizer,
            header = me.header,
            headerCfg = header && !header.isHeader,
            message = cfg && (cfg.message || cfg.msg),
            resizeTracker, width, height, i, textArea,
            textField, msg, progressBar, gridContainer, msgButtons, wait, tool;
			

        // Restore default buttonText before reconfiguring.
        me.updateButtonText();

        me.cfg = cfg = cfg || {};

        wait = cfg.wait;
        if (cfg.width) {
            width = cfg.width;
        }

        if (cfg.height) {
            height = cfg.height;
        }

        me.minWidth = cfg.minWidth || me.defaultMinWidth;
        me.maxWidth = cfg.maxWidth || me.defaultMaxWidth;
        me.minHeight = cfg.minHeight || me.defaultMinHeight;
        me.maxHeight = cfg.maxHeight || me.defaultMaxHeight;

        if (resizer) {
            resizeTracker = resizer.resizeTracker;
            resizer.minWidth = resizeTracker.minWidth = me.minWidth;
            resizer.maxWidth = resizeTracker.maxWidth = me.maxWidth;
            resizer.minHeight = resizeTracker.minHeight = me.minHeight;
            resizer.maxHeight = resizeTracker.maxHeight = me.maxHeight;
        }

        // Default to allowing the Window to take focus.
        delete me.defaultFocus;
        if (cfg.defaultFocus) {
            me.defaultFocus = cfg.defaultFocus;
        }

        // clear any old animateTarget
        me.animateTarget = cfg.animateTarget || undefined;

        // Defaults to modal
        me.modal = cfg.modal !== false;

        // Show the title/icon if a title/iconCls config was passed in the config to either the constructor
        // or the show() method. Note that anything passed in the config should win.
        //
        // Note that if there is no title/iconCls in the config, check the headerCfg and default to the instance
        // properties. This works because there are default values defined in initComponent.
        me.setTitle(cfg.title || (headerCfg && header.title) || me.title);
        me.setIconCls(cfg.iconCls || (headerCfg && header.iconCls) || me.iconCls);

        // Extract button configs
        if (Ext.isObject(cfg.buttons)) {
            me.buttonText = cfg.buttons;
            buttons = 0;
        } else {
            me.buttonText = cfg.buttonText || me.buttonText;
            buttons = Ext.isNumber(cfg.buttons) ? cfg.buttons : 0;
        }

        // Apply custom-configured buttonText
        // Infer additional buttons from the specified property names in the buttonText object
        buttons = buttons | me.updateButtonText();

        // Restore buttonText. Next run of reconfigure will restore to prototype's buttonText
        me.buttonText = oldButtonText;

        // During the on render, or size resetting layouts, and in subsequent hiding and showing, we need to
        // suspend layouts, and flush at the end when the Window's children are at their final visibility.
        Ext.suspendLayouts();
        me.width = me.height = null;
        if (width || height) {
            if (width) {
                me.setWidth(width);
            }

            if (height) {
                me.setHeight(height);
            }
        }
        me.hidden = false;
        if (!me.rendered) {
            me.render(Ext.getBody());
        }

        // Hide or show the close tool
        me.closable = cfg.closable !== false && !wait;

        // We need to redefine `header` because me.setIconCls() could create a Header instance.
        header = me.header;

        if (header) {
            tool = header.child('[type=close]');

            if (tool) {
                tool.setVisible(me.closable);
            }

            // Hide or show the header
            if (!cfg.title && !me.closable && !cfg.iconCls) {
                header.hide();
            } else {
                header.show();
            }
        }

        // Default to dynamic drag: drag the window, not a ghost
        me.liveDrag = !cfg.proxyDrag;

        // wrap the user callback
        me.userCallback = Ext.Function.bindCallback(cfg.callback || cfg.fn || Ext.emptyFn,
            cfg.scope || Ext.global);

        // Hide or show the icon Component
        me.setIcon(cfg.icon);

        // Hide or show the message area
        msg = me.msg;
        if (message) {
            msg.setHtml(message);
            msg.show();
        } else {
            msg.hide();
        }

        // Hide or show the input field
        textArea = me.textArea;
        textField = me.textField;
        if (cfg.prompt || cfg.multiline) {
            me.multiline = cfg.multiline;
            if (cfg.multiline) {
                textArea.setValue(cfg.value);
                textArea.setHeight(cfg.defaultTextHeight || me.defaultTextHeight);
                textArea.show();
                textField.hide();
                me.defaultFocus = textArea;
            } else {
                textField.setValue(cfg.value);
                textArea.hide();
                textField.show();
                me.defaultFocus = textField;
            }
        } else {
            textArea.hide();
            textField.hide();
        }

        // Hide or show the progress bar
        progressBar = me.progressBar;
        if (cfg.progress || wait) {
            progressBar.show();
            me.updateProgress(0, cfg.progressText);
            if (wait) {
                progressBar.wait(wait === true ? cfg.waitConfig : wait);
            }
        } else {
            progressBar.hide();
        }

        // Hide or show the Grid Panel
        gridContainer = me.gridContainer;
        if (cfg.details) {
            gridContainer.store.loadData(cfg.details);
            gridContainer.show();
        } else {
            gridContainer.hide();
        }

        // Hide or show buttons depending on flag value sent.
        msgButtons = me.msgButtons;
        for (i = 0; i < 5; i++) {
            if (buttons & Math.pow(2, i)) {

                // Default to focus on the first visible button if focus not already set
                if (!me.defaultFocus) {
                    me.defaultFocus = msgButtons[i];
                }
                msgButtons[i].show();
                hideToolbar = false;
            } else {
                msgButtons[i].hide();
            }
        }

        // Hide toolbar if no buttons to show
        if (hideToolbar) {
            me.bottomTb.hide();
        } else {
            me.bottomTb.show();
        }
        Ext.resumeLayouts(true);
		
		if((me.getWidth() - me.bottomTb.getWidth())> 10)
			me.bottomTb.setWidth(me.getWidth());
    },

    updateButtonText: function() {
        var me = this,
            buttonText = me.buttonText,
            buttons = 0,
            btnId,
            btn;

        for (btnId in buttonText) {
            if (buttonText.hasOwnProperty(btnId)) {
                btn = me.msgButtons[btnId];
                if (btn) {
                    if (me.cfg && me.cfg.buttonText) {
                        buttons = buttons | Math.pow(2, Ext.Array.indexOf(me.buttonIds, btnId));
                    }
                    if (btn.text !== buttonText[btnId]) {
                        btn.setText(buttonText[btnId]);
                    }
                }
            }
        }
        return buttons;
    },

    show: function(cfg) {
        var me = this,
            visibleFocusables;

        cfg = cfg || {};

        if (Ext.Component.layoutSuspendCount) {
            Ext.on({
                resumelayouts: function() {
                    me.show(cfg);
                },
                single: true
            });
            return me;
        }
		me.buttonText = {
			ok: rvw_resources.R102,
			yes: rvw_resources.R104,
			no: rvw_resources.R105,
			tcontinue: rvw_resources.R127,
			cancel: rvw_resources.R103
		};
        me.reconfigure(cfg);
        if (cfg.cls) {
            me.addCls(cfg.cls);
        }

        visibleFocusables = me.query('textfield:not([hidden]),textarea:not([hidden]),button:not([hidden])');
        me.preventFocusOnActivate = !visibleFocusables.length;
        me.hidden = true;
        me.callParent();
		me.focus();
        return me;
    },

    onShow: function() {
        this.callParent(arguments);
		// AHBG-26113
		this.gridContainer.collapse();
        this.center();
    },

    updateText: function(text) {
        this.msg.setHtml(text);
    },

    setIcon: function(icon, width, height) {
        var me = this,
            iconCmp = me.iconComponent,
            cls = me.messageIconCls;

        if (cls) {
            iconCmp.removeCls(cls);
        }

        if (icon) {
            iconCmp.show();
            if (width || height) {
                iconCmp.setSize(width || iconCmp.getWidth(), height || iconCmp.getHeight());
            }
            iconCmp.addCls(Ext.baseCSSPrefix + 'dlg-icon');
            iconCmp.addCls(me.messageIconCls = icon);
        } else {
            iconCmp.removeCls(Ext.baseCSSPrefix + 'dlg-icon');
            iconCmp.hide();
        }
        return me;
    },

    updateProgress: function(value, progressText, message) {
        this.progressBar.updateProgress(value, progressText);
        if (message) {
            this.updateText(message);
        }
        return this;
    },

    onEsc: function() {
        if (this.closable !== false) {
            this.callParent(arguments);
        }
    },
    followUp: function(cfg, message, fn, scope) {
        if (Ext.isString(cfg)) {
            cfg = {
                title: cfg,
                icon: this.QUESTION,
                message: message,
				buttons: this.CONTINUECANCEL,
                callback: fn,
                scope: scope
            };
        }
        return this.show(cfg);
    },
	timeOut: function(cfg, message, fn, scope) {
        if (Ext.isString(cfg)) {
            cfg = {
                title: cfg,
                icon: this.WARNING,
                message: message,
				buttons: this.OKCANCEL,
                callback: fn,
                scope: scope
            };
        }
        return this.show(cfg);
    },

    confirm: function(cfg, message, fn, scope) {
        if (Ext.isString(cfg)) {
            cfg = {
                title: cfg,
                icon: this.QUESTION,
                message: message,
                buttons: this.YESNO,
                callback: fn,
                scope: scope
            };
        }
        return this.show(cfg);
    },

    prompt: function(title, message, fn, scope, multiline, value) {
        if (Ext.isString(title)) {
            title = {
                prompt: true,
                title: title,
                minWidth: this.minPromptWidth,
                message: message,
                buttons: this.OKCANCEL,
                callback: fn,
                scope: scope,
                multiline: multiline,
                value: value
            };
        }
        return this.show(title);
    },

    wait: function(message, title, config) {
        if (Ext.isString(message)) {
            message = {
                title: title,
                message: message,
                closable: false,
                wait: true,
                modal: true,
                minWidth: this.minProgressWidth,
                waitConfig: config
            };
        }
        return this.show(message);
    },

    alert: function(title, message, fn, scope, icontype, details, buttons) {
        var iconCls = this.INFO,
            buttons = buttons ? buttons : this.OK;
        switch (icontype) {
            case 'error':
                iconCls = this.ERROR;
                break;
            case 'question':
                iconCls = this.QUESTION;
                break;
            case 'warning':
                iconCls = this.WARNING;
                break;
            default:
                iconCls = this.INFO;
        }
        if (Ext.isString(title)) {
            title = {
                title: title,
                message: message,
                buttons: buttons,
                fn: fn,
                scope: scope,
                icon: iconCls,
                details: details,
                minWidth: details ? 500 : this.minWidth
            };
        }
        return this.show(title);
    },
    progress: function(title, message, progressText) {
        if (Ext.isString(title)) {
            title = {
                title: title,
                message: message,
                progress: true,
                progressText: progressText
            };
        }
        return this.show(title);
    }
}, function(MessageBox) {
    Ext.onInternalReady(function() {
        Ext.RamcoMsg = new MessageBox();
    });
});

// Personalization Window
Ext.define('Ext.ramco.CtrlPers', {
    extend: 'Ext.window.Window',
    xtype: 'ramcoctrlpers',
    closeAction: 'hide',
	alwaysOnTop: true, // AHBG-31969
    ctrlId: null,
    cType: 'ctrl',
    modal: true,
    width: 300,
    layout: {
        type: 'table',
        columns: 2
    },
    bbar: [{
        xtype: 'button',
        text: rvw_resources.R190,
        handler: function(btn) {
            var me = this,
                pers = me.up('window'),
                items = pers.items,
                i = 0,
                id, data = {},
                tskBtn = {},
                roleBtn = {},
                allTask = {},
                tskMenu,
                colItem,
                roleMenu,
                roleCheck,
                allMenu,
                tskCheck,
                allTskMenu,
                allRoleMenu,
				btnCombo,
                ctrlId = pers.ctrlId;
				//TECH-32503/CDIH-122
				btnCombo = pers.down('combobox');
				if(btnCombo && btnCombo.isVisible() && !Ext.isEmpty(btnCombo.getValue()))
					ctrlId = btnCombo.getValue();
				
			if (RamcoRTC.isEntUser == true)	 {
				if (pers.down("#mandatory").getValue() == 'Yes' && Ext.isEmpty(pers.down("#errormessage").getValue())) {
					Ext.Msg.alert('', rvw_resources.R230, Ext.emptyFn, undefined, 'error');
					return false;
				}
				//else if(!Ext.isEmpty(pers.down("#errormessage").getValue())){//TECH-26897
				// TECH-33523 / SDC-56
				else {
					tskMenu = pers.down("#taskbtn").menu;
					if(!Ext.isEmpty(tskMenu))
						(tskCheck = tskMenu.query('menucheckitem[checked=true]'));
					roleMenu = pers.down("#rolebtn").menu;
					roleCheck = (!Ext.isEmpty(roleMenu))?roleMenu.query('menucheckitem[checked=true]'):'';
					allTskMenu = (!Ext.isEmpty(tskMenu))?tskMenu.query('menucheckitem'):'';
					allRoleMenu = (!Ext.isEmpty(allTskMenu))?roleMenu.query('menucheckitem'):'';
					if(tskCheck && tskCheck.length > 0){
						for (i = 0; i < tskCheck.length; i++) {
							if (tskCheck[i].itemId == 'alltasks') {
								data[tskCheck[i].itemId] = true;//TECH-29763/TAQ-121
								for (l = 0; l < allTskMenu.length; l++) {
									if (allTskMenu[l].itemId == 'alltasks'){
										continue;
									}
									tskBtn[allTskMenu[l].itemId] = allTskMenu[l].itemId;
								}
							}
							else {
								if(allTskMenu.length == 2)
									data['alltasks'] = true;
								tskBtn[tskCheck[i].itemId] = tskCheck[i].itemId;
							}
						}
					}
					if(roleCheck && roleCheck.length > 0) {
						for (j = 0; j < roleCheck.length; j++) {
							if (roleCheck[j].itemId == 'allroles') {
								data[roleCheck[j].itemId] = true;//TECH-29763/TAQ-121
								for (l = 0; l < allRoleMenu.length; l++) {
									if (allRoleMenu[l].itemId == 'allroles'){
										continue;
									}
									roleBtn[allRoleMenu[l].itemId] = allRoleMenu[l].itemId;
								}
							}
							else {
								if(allRoleMenu.length == 2)
									data['allroles'] = true;
								roleBtn[roleCheck[j].itemId] = roleCheck[j].itemId;
							}
						}
					}
					if(allTskMenu && allTskMenu.length > 0) {
						for (k = 0; k < allTskMenu.length; k++) {
							if (allTskMenu[k].itemId != 'alltasks')
								allTask[allTskMenu[k].itemId] = allTskMenu[k].itemId;
						}
					}
					
					// TECH-33523 / SDC-56
					if (!Ext.isEmpty(pers.down("#errormessage").getValue()))
						data['errormessage'] = pers.down("#errormessage").getValue();
					
					data['roles'] = roleBtn;
					data['task'] = tskBtn;
					if (!Ext.isEmpty(allTask))
						data['alltask'] = allTask;
				}
			}            
            pers.fireEvent('save', ctrlId, items, data);
            var wind = btn.up('window');
            wind.close();
        },
        itemId: 'applybtn'
    }, {
        xtype: 'button',
        text: rvw_resources.R099,
        handler: function(btn) {
            var wind = btn.up('window');
            wind.close();
        },
        itemId: 'clearbtn'
    }],
    initComponent: function(cfg) {
        var me = this,
            baseId = me.id,
            i, button;
		// TECH-32503/CDIH-122
		me.items =[{
		        xtype: 'label',
		        html: 'Select Button',
				hidden:true
		    },{
		        xtype: 'combobox',
		        queryMode: 'local',
				role:'segpers',
				displayField: 'text',
				valueField: 'value',
				hidden:true,
				store: {
                        fields: ['text', 'value'],
                        proxy: {
                            type: 'memory',
                            reader: 'array'
                        }
                    }
		    },{
		        xtype: 'label',
		        html: 'Visible',
				hidden:!RamcoRTC.isEntUser
			}, {
		        xtype: 'ramcoradio',
		        itemId: "visible",
				hidden:!RamcoRTC.isEntUser,
			   //value: 'Yes',
		        items: [{
		            xtype: "radiofield",
		            name: "visible",
		            inputValue: "Yes",
		            boxLabel: "Yes",
		            visibleLength: 0,
		            itemId: "visy"
		        }, {
		            xtype: "radiofield",
		            name: "visible",
		            inputValue: "No",
		            boxLabel: "No",
		            visibleLength: 0,
		            itemId: "visn"
		        }]
		    }, {
		        xtype: 'label',
				hidden:!RamcoRTC.isEntUser,
		        html: 'Editable'
		    }, {
		        xtype: 'ramcoradio',
		        itemId: "editable",
				hidden:!RamcoRTC.isEntUser,
			    //value: 'Yes',
		        items: [{
		            xtype: "radiofield",
		            name: "editable",
		            inputValue: "Yes",
		            boxLabel: "Yes",
		            visibleLength: 0,
		            itemId: "edity"
		        }, {
		            xtype: "radiofield",
		            name: "editable",
		            inputValue: "No",
		            boxLabel: "No",
		            visibleLength: 0,
		            itemId: "editn"
		        }]
		    }, {
		        xtype: 'label',
		        html: 'Rename Label'
		    }, {
		        xtype: 'textfield',
		        itemId: "rename"
		    }, {
		        xtype: 'label',
		        html: 'Mandatory',
				hidden:!RamcoRTC.isEntUser,
		    }, {
		        xtype: 'ramcoradio',
		        itemId: "mandatory",
				hidden:!RamcoRTC.isEntUser,
				//value: 'No',
		        items: [{
		            xtype: "radiofield",
		            name: "mandatory",
		            inputValue: "Yes",
		            boxLabel: "Yes",
		            visibleLength: 0,
		            itemId: "mandy"
		        }, {
		            xtype: "radiofield",
		            name: "mandatory",
		            inputValue: "No",
		            boxLabel: "No",
		            //checked: true,
		            visibleLength: 0,
		            itemId: "mandn"
		        }]
		    }, {
		        xtype: 'label',
				hidden:!RamcoRTC.isEntUser,
		        html: 'Task'
		    }, {
		        xtype: 'button',
				hidden:!RamcoRTC.isEntUser,
		        itemId: "taskbtn"
		    }, {
		        xtype: 'label',
				hidden:!RamcoRTC.isEntUser,
		        html: 'Error Message'
		    }, {
		        xtype: 'textarea',
		        height: 40,
				hidden:!RamcoRTC.isEntUser,
		        itemId: "errormessage"
		    }, {
		        xtype: 'label',
				hidden:!RamcoRTC.isEntUser,
		        html: 'Role'
		    }, {
		        xtype: 'button',
				hidden:!RamcoRTC.isEntUser,
		        itemId: "rolebtn"
		    },{
				xtype: 'label',
				hidden:true,
				itemId:'pesCollapse',
				html: 'Collapse Section'
			},{
				xtype: 'checkbox',
				hidden:true,
				itemId: 'checkpers'
		    }
		];
        me.callParent();
    },
    processData: function(ctrl, data, lblObj, cType) {
        var me = this,
            items = me.items,
            i = 0,
            id, colItem, value,
            ctrlId = me.ctrlId,
            len = 0;
        len = items.length;
		//HSI-191 // TECH-32503/CDIH-122
        if (cType == 'panel' || cType == 'task' || cType == 'label' || cType == 'segmentedbtn') {//TECH-29763/TAQ-121
			if(cType == 'panel' && Ext.isEmpty(lblObj.config.title))
				k = 6;
			else
				k = 8;
	        for (j=0; j < len; j++) {
                colItem = items.getAt(j);
				if (j >= k) {
					if((lblObj && lblObj.config && lblObj.config.collapsible && lblObj.config.collapsible == true) && (j == 16||j == 17)){
						colItem.show();
						continue;
					}
                    colItem.hide();
                }
            }
			if(cType == 'label'){
				items.items[4].hide();
				items.items[5].hide();
			}
        }
		// TECH-32503/CDIH-122
		if(cType == 'segmentedbtn'){
				items.items[0].show();
				items.items[1].show();
		}else{
				items.items[0].hide();
				items.items[1].hide()
		}
        if (data) {
            for (; i < len; i++) {
                colItem = items.getAt(i);
                if (colItem.xtype == 'label' || colItem.hidden)
                    continue;
                id = colItem.itemId;
                switch (id) {
                    case 'visible':
                        value = (data['sv'] == "y") ? 'Yes' : 'No';
                        colItem.setValue(value);
                        break;
                    case 'editable':
                        value = (data['se'] == "y") ? 'Yes' : 'No';
                        colItem.setValue(value);
                        break;
                    case 'rename':
                        value = data['scc'];
                        colItem.setValue(value);
                        break;
                    case 'mandatory':
                        value = (data['sbc'] !='white') ? 'Yes' : 'No';
                        colItem.setValue(value);
                        break;
                    case 'taskbtn':
                        value = data['task'];
                        colItem.setText(value)
                        break;
                    case 'errormessage':
                        value = data['error'];
                        colItem.setValue(value);
                        break;
                    case 'rolebtn':
                        value = data['role'];
                        colItem.setText(value)
                        break;
					case 'checkpers':
				      value = (data['sc'] == "y") ? true : false;
					  colItem.setValue(value);
					  break;
                }
            }
        } else {
            for (; i < len; i++) {
                colItem = items.getAt(i);
                if (colItem.xtype == 'label' || colItem.hidden)
                    continue;
                id = colItem.itemId;
                switch (id) {
                    case 'visible':
                        colItem.setValue('Yes');
                        break;
                    case 'editable':
                        colItem.setValue('Yes');
                        break;
                    case 'rename':
                        if (lblObj)
                            colItem.setValue(lblObj.getData() || lblObj.config.html ||lblObj.config.title);
                        else
                            colItem.setValue('');
                        break;
                    case 'mandatory':
                        colItem.setValue('No');
                        break;
                    case 'taskbtn':
                        colItem.setText('');
                        break;
                    case 'errormessage':
                        colItem.setValue('');
                        break;
                    case 'rolebtn':
                        colItem.setText('');
                        break;
					case 'checkpers':
					  colItem.setValue('');
					  break;	
                }
            }
        }
    }
});
Ext.define('Ext.o.form.field.File', {
	override:'Ext.form.field.File',	
	onFileChange: function(button, e, value) {
		var me = this,
			errLbl,
			impWindow = null;
			impWindow = me.ownerCt.ownerCt;
		if(impWindow) {
			if(impWindow.importWin === true) {
				if ((value.indexOf(".csv") > -1 || value.indexOf(".txt") > -1)) {
					impWindow.BtnImport.setDisabled(true);
					impWindow.BtnValidate.setHidden(false);
					impWindow.BtnValidate.setDisabled(false);			
				}
				else {
					impWindow.BtnValidate.setHidden(true);
					impWindow.BtnImport.setDisabled(false);
				}
				errLbl = impWindow.form.getComponent("errormessage");
			}
			errLbl = errLbl || impWindow.form.getComponent("avnuplderrmsg");
			if(errLbl) {
				errLbl.setHtml('');
			}
		}
		this.duringFileSelect = true;
		Ext.form.field.File.superclass.setValue.call(this, value);
		delete this.duringFileSelect;
    }
});

// Import Window
Ext.define('Ext.ramco.Import', {
    extend: 'Ext.window.Window',
    xtype: 'ramcoimport',
    closeAction: 'destroy',	 
	closable: true,
	alwaysOnTop: true, // AHBG-31969
    title: 'Import Data',
	importWin: true,
    layout: {
        type: 'vbox',
        align: 'stretch'
    },
    initComponent: function(cfg) {
        var me = this,
            baseId = me.id,
			filePathCmp,
			fileTrigger,
            i, button;
        me.BtnImport = new Ext.button.Button({
            text: rvw_resources.R050
        });
		me.BtnValidate = new Ext.button.Button({
            text: rvw_resources.R048,
			hidden: true
        });		
        me.bottomTb = new Ext.toolbar.Toolbar({
            id: baseId + '-toolbar',
            ui: 'footer',
            dock: 'bottom',
            layout: {
                pack: 'center'
            },
            items: [me.BtnValidate, me.BtnImport]
        });
        me.form = new Ext.form.Panel({
            padding: 5,
            margin: 5,
            url: '',
            items: [{
                xtype: 'textfield',
                itemId: 'file-meta',
                hidden: true,
                fieldLabel: 'File Name',
                width: '100%'
            }, {
                xtype: 'filefield',
                itemId: 'file-path',
				buttonText: rvw_resources.R059,
                //fieldLabel: 'Attach Document',
                width: '100%'
            }, {
                xtype: 'ramcolabel',
                width: '100%',
                itemId: 'errormessage'
            }],
            layout: 'vbox'
        });
        me.dockedItems = [me.bottomTb];
        //me.on('close', me.onClose, me);
        me.callParent();
		//AHBG-31970 
		me.setHeight(150);
		filePathCmp = me.form.getComponent('file-path');
		if (filePathCmp) {
			fileTrigger = me.form.getComponent('file-path').getTriggers();
			if(fileTrigger)
				fileTrigger.filebutton.cls += " x-file-btn-browse";
		}
        me.add(me.form);
    },
    showMessage: function(errormessage, data, ilboConfig, options) {
        var me = this,
            form = me.form,
            error = null,			
			url = '',
			colorName = 'blue',
			errorLink = null;
        error = form.getComponent('errormessage');
		errorLink = errormessage;
		if(data && parseInt(data.code, 10) > 200) {
			colorName = 'red';
		}		
		if (ilboConfig && !Ext.isEmpty(data.success)) {
			url = RamcoRTC.getCsvReportUrl(ilboConfig, options);
			errorLink = "<a style='color:" + colorName + "; text-decoration: none;' target='_blank' href='"+ url + "'>" + errormessage + "</a>";
		}
		error.setData(errorLink);
        error.show();
    }
});

//TreeSearch Config Window
Ext.define('Ext.ramco.TreeSearchWindow', {
    extend: 'Ext.window.Window',
    xtype: 'ramcotreesearch',
	defaultFocus: '#cmbTreeSearch',
    closeAction: 'hide',
	closable: true,	
    title: 'Tree Search Dialog',	
	treeSearchWin: true,
	config: {
		treeData: {
			LEVEL:"All",
			SEARCH:"Any Match",
			DEFAULT:"next"
		}
	},
	buttonAlign: 'center',
    initComponent: function() {
        var me = this,
            baseId = me.id,
            button;
			treeData = me.getTreeData();
		me.buttons = [{
			xtype: 'button',
			text: 'Reset',
			itemId: 'btnReset',
			handler: function(btn) {
					var win = btn.up('window'),
						cmbTrSh, cmbTrSL, optSh,
						shForm;
					if (win) {
						 shForm = win.searchForm;
						 cmbTrSh = shForm.getComponent("cmbTreeSearch");
						 cmbTrSL = shForm.getComponent("cmbTreeSearchLevel");
						 optSh = shForm.getComponent("treesearchoptions");
						 cmbTrSh.setValue('Any Match');
						 cmbTrSL.setValue('All');
						 optSh.simpleValue = true;
						 optSh.setValue('next');
						 optSh.simpleValue = false;
						 win.tree.clearTreeHightLight();
					}
				}
			}, {
				xtype: 'button',
				text: 'Close',
				itemId: 'btnClose',
				handler:function(btn) {
					var win = btn.up('window'),
						cmbTrSh, cmbTrSL, optSh,
						trData = me.getTreeData(),
						treeCtrl = null,
						shForm;
					if (win) {
						treeCtrl = win.tree;
						shForm = win.searchForm;
						trData.SEARCH = shForm.getComponent("cmbTreeSearch").getValue();
						trData.LEVEL = shForm.getComponent("cmbTreeSearchLevel").getValue();
						trData.DEFAULT = shForm.getComponent("treesearchoptions").getChecked()[0].inputValue;
						me.setTreeData(trData);
						if(treeCtrl.prevSearchType != trData.SEARCH || treeCtrl.prevSearchLvl != trData.LEVEL)
							treeCtrl.clearTreeHightLight();
						win.close();
					}
				}
			}
		];
        me.searchForm = new Ext.panel.Panel(
		{
			padding: 5,							
			itemId:'treesearchformpanel',
			userCls: 'x-avn-winadj',
			layout: {
				type: 'vbox',
				align: 'stretch'
			},
			defaults: {
				labelWidth: 175				
			},
			items: [	
				{
					xtype: 'combofield',
					itemId: 'cmbTreeSearch',				
					role:'uipage',
					fieldLabel: 'Search',					
					store: {
						fields: [ {"name":"text","type":"string"},
								  {"name":"value","type":"string"}
						],
						data : [
							{"text":"Starts with", "value":"Starts with"},
							{"text":"Ends with", "value":"Ends with"},
							{"text":"Any match", "value":"Any Match"}
						]					
					},
					value :	treeData.SEARCH,
					displayField: 'text',
					valueField: 'value'
				}, 
				{
					xtype: 'combofield',
					itemId: 'cmbTreeSearchLevel',				
					role:'uipage',
					fieldLabel: 'Levels',
					store: {
						fields: [
								{ "name":"text", "type":"string"},
								{ "name":"value","type":"string"}
						],
						data : [
							{"text":"Leaf", "value":"Leaf"},
							{"text":"All", "value":"All"}
						]					
					},
					value :	treeData.LEVEL,
					displayField: 'text',
					valueField: 'value'
				}, 
				{
					xtype: 'radiogroup',
					itemId: "treesearchoptions",
					fieldLabel: 'Search Traversal',
					columns: 3,					
					vertical: true,
					tableAttrs: {
						style: {
								width: '100%'
							}
					},
					items: [
						{
							name: "tso",
							inputValue: "next",
							checked: (treeData.DEFAULT === "next"),
							boxLabel: "Next",
							itemId: "radNext"
						}, {						
							name: "tso",
							inputValue: "prev",
							checked: (treeData.DEFAULT === "prev"),
							boxLabel: "Prev",
							itemId: "radPrev"
						}, {						
							name: "tso",
							inputValue: "all",
							checked: (treeData.DEFAULT === "all"),
							boxLabel: "All",
							itemId: "radAll"
						}
					]
				}
			]			
		});				
        me.callParent();		
        me.add(me.searchForm);
    }
});

// Avn Upload Window
Ext.define('Ext.ramco.AvnUplodWindow', {
    extend: 'Ext.window.Window',
    xtype: 'ramcoavnupload',
    closeAction: 'destroy',	 
	userCls: 'x-avn-uplwin',
	closable: true,
    title: rvw_resources.R295,	
	alwaysOnTop: true, // AHBG-31969
	avnfileUpload: true,
	config: {
		custData: {
			OVR:"disable",
			SAVEAS:"disable",
			ABORT:"disable",
			DEFAULT:"ABORT",
			FileMaxSize:"40000KB"			
		}
	},	
	buttonAlign: 'right', // AHBG-31790 
	onAvnUploadFileClick: function() {		
		var me = this;
		me.fireEvent('uploadClick', me);
	},
    initComponent: function() {
        var me = this,
            baseId = me.id,
			filePathCmp,
			fileTrigger,
            button,
			fileDestPath,
			custData = me.getCustData();
		me.buttons = [{
			xtype: 'button',
			text: rvw_resources.R295,
			itemId: 'avnupld',
				listeners:{
					click: me.onAvnUploadFileClick.bind(me)
				}
			}, {
				xtype: 'button',
				text: rvw_resources.R103,
				itemId: 'avnupldclose',
				handler:function(btn) {
					var win = btn.up('window');
					win.close();
				}
			}
		];
        me.form = new Ext.form.Panel(
		{
			padding: 5,				
			url: '',
			itemId:'avnfileformpanel',			
			userCls: 'x-avn-uplwin',
			layout: 'vbox', 
			defaults: {
				labelWidth: 175
			},
			items: [	
			{
				xtype: 'textfield',
				itemId: 'file-dest',                
				fieldLabel: rvw_resources.R296,
				value:'',
				width: 300
			}, {
				xtype: 'filefield',
				itemId: 'file-path',				
				buttonText: rvw_resources.R059,
				emptyText: 'Select a file',                			
				width: 380
			}, {
				xtype: 'radiogroup',
				itemId: "avncustomactions",
				fieldLabel: rvw_resources.R297,
				columns: 3,
				vertical: true,
				tableAttrs: {
					style: {
						width: '100%'
					}
				},
				items: [
					{						
						name: "avncustomactions",
						inputValue: "OVR",
						boxLabel: rvw_resources.R298,
						disabled: (custData.OVR === "disable"),
						checked: (custData.DEFAULT === "OVR"),
						itemId: "radavnovr"
					}, {						
						name: "avncustomactions",
						inputValue: "SAVEAS",
						disabled: (custData.SAVEAS === "disable"),
						checked: (custData.DEFAULT === "SAVEAS"),
						boxLabel: rvw_resources.R299,
						itemId: "radavnsaveas"
					}, {						
						name: "avncustomactions",
						inputValue: "ABORT",
						disabled: (custData.ABORT === "disable"),
						checked: (custData.DEFAULT === "ABORT"),
						boxLabel: rvw_resources.R300,
						itemId: "radavnabort"
					}
				]
			}, {
					xtype: 'displayfield',					
					itemId: 'lblmaxfilesize',
					fieldLabel: rvw_resources.R301,
					value: custData.FileMaxSize,
					width: 300
			}, {
					xtype: 'ramcolabel',
					width: '100%',
					userCls: 'x-field-lblstatus',
					itemId: 'avnuplderrmsg'
			   }
			]			
		});				
        me.callParent();
		filePathCmp = me.form.getComponent('file-path');
		fileDestPath = me.form.getComponent('file-dest');
		if(fileDestPath) {
			me.destSrcPath = fileDestPath.getValue();
		}
		if (filePathCmp) {
			fileTrigger = me.form.getComponent('file-path').getTriggers();
			if(fileTrigger)
				fileTrigger.filebutton.cls += " x-file-btn-browse";
		}
        me.add(me.form);
    },
    showMessage: function(errormessage) {
        var me = this,
            form = me.form,
            error = null;

		// AHBG-26482
		if(!Ramcoutil.isEmpty(form))
		{
			error = form.getComponent('avnuplderrmsg');
			error.setHtml(errormessage);
		}
		else
			Ext.RamcoMsg.alert(rvw_resources.R260, errormessage);
    }
});

// TECH-34272
// Column Chooser Window
Ext.define('Ext.ramco.Colchooser', {
    extend: 'Ext.window.Window',
	xtype: 'ramcocolchooser',
    title: 'Column Chooser',
	width: 400,
	height: 400,
	modal: true,
	closable: true,
	alwaysOnTop: true, // AHBG-31969
	autoScroll: true,
	closeAction: 'hide',
	layout: {
		type: 'hbox',
		align: 'stretch'
	},
	buttonAlign: 'center',	
	initComponent: function() {
		var me = this,
			items, buttonItems,
			colGridArray = me.colGridColumns || [];
			
		me.colGridStore = new Ext.data.JsonStore({
			proxy: { type: 'memory' },
			autoLoad: true,
			fields: ['dataIndex', 'drag', 'colname', 'visible'],
			data: colGridArray
		});
		
		items = [{
			xtype: 'grid',
			showToolbar: false,
			multiSelect: true,
			rowLines: true,
			header: false,
			userCls: 'gridColChoose',
			hideHeaders: true,
			flex: 1,
			minHeight: 300,
			scrollable: true,
			itemId: 'colGrid',
			margin: '5 5 5 5',
			plugins: {
				cellediting: {
					clicksToEdit: 2
				}
			},
			viewConfig: {
				plugins:{
					ptype: 'gridviewdragdrop',
					containerScroll: true,
					enableDrag: true,
					enableDrop: true,
					ddGroup:'colchoosergroup'
				},
				enableTextSelection:false,
				scrollable: true
			},
			store: me.colGridStore,
			columns: [{
				dataIndex: 'dataIndex',
				hidden: true
			}, {
				xtype:'templatecolumn',
				dataIndex: 'drag',
				tpl: '{drag}',
				width: 30,
				align: 'center'
			}, {
				text: 'Column Name',
				dataIndex: 'colname',
				flex: 1,
				editor: {
					xtype: 'textfield',
					allowBlank: false
				},
				sortable: false
			}, {
				xtype:'checkcolumn',
				dataIndex: 'visible',
				width: 30
			}]
		}];
		buttonItems = [{
			xtype: 'button',
			//id: 'btnApplyColChoose', // TECH-34925
			itemId: 'btnApplyColChoose',
			customCls: 'green',
			handler: me.onApplyColChoose,
			scope: me,
			text: 'Apply'
		}, {
			xtype: 'button',
			//id: 'btnClearColChoose', // TECH-34925
			itemId: 'btnClearColChoose',
			customCls: 'red',
			handler: me.onClearColChoose,
			scope: me,
			text: 'Clear'
		}];
		me.items = items;
		me.buttons = buttonItems;
		me.callParent();
		me.on('beforehide', me.onClose, me);
	},
	setGridColumns: function(gridObj, gridCols) {
		var me = this,
			grid = me.items && me.items.items[0];
		if (grid) {
			me.colGridColumns = gridCols;
			me.ctrlObj = gridObj;
			grid.store.setData(gridCols);
			me.show();
		}
	},
	onApplyColChoose: function(btn) {
		try {
			var me = this,
				colChooser = {},
				//colChooser = me.down('#columnChooser').items,
				i = 0,
				id, col,
				ctrl = me.ctrlObj,
				ctrlId = ctrl.getItemId(),
				cols = ctrl.getColumns(),
				colItem = null,
				colManager = ctrl.getColumnManager(),
				colData = {},
				data = {},
				vseq = [],
				currentView,
				winGridObj = me.down('grid'),
				winGridObjStore = winGridObj.store,
				winGridObjStoreData = winGridObjStore.data,
				//len = colChooser.length;
				len = winGridObj.store.getTotalCount();
			colData = data['default'] = {};
			colData['data'] = {};
			colData.data[ctrlId] = {};
			colData.data[ctrlId]['type'] = 'grid';
			
			for (; i < len; i++) {
				/* colItems = colChooser.getAt(i);
				colItem = colItems.items.items[0]; */
				colItems = winGridObjStoreData.items[i];
				colItem = colItems && colItems.data;
				id = colItem.dataIndex;
				vseq.push(id.replace('v', ''));
				col = colManager.getHeaderByDataIndex(id);
				if (colItem.visible)
					col.show();
				else
					col.hide();
				colData.data[ctrlId][id] = {};
				//colData.data[ctrlId][id]['sv'] = col.hidden;
				colData.data[ctrlId][id]['sv'] = !colItem.visible;
				//if (col.text !== colChooser.items[i].el.dom.textContent || (ctrl.persData && (ctrl.persData.type == 'grid') && (ctrl.persData[id] && ctrl.persData[id]['scc'] ))) {
				if (col.text !== colItem.colname || (ctrl.persData && (ctrl.persData.type == 'grid') && (ctrl.persData[id] && ctrl.persData[id]['scc'] ))) {
					colData.data[ctrlId][id]['scc'] = colItem.colname;
					col.setText(colItem.colname);
				}
			}
			ctrl.onViewResize(ctrl.view.normalView);
			currentView = ctrl.up('ilbo');
			if (currentView) {
				currentView.callBack = function() {
					ctrl.fireEvent('colpers', ctrl, data);
					var wind = btn.up('window');
					wind.close();
				}
			}
			ctrl.vseq = vseq;
			ctrl.onSavePers();			
		}
		catch(ex) { console.log('onApplyColChoose Exception is ' + ex); }		
	},
	onClearColChoose: function() {
		var me = this,
			ctrl = me.ctrlObj,
			colData = {},
			data = {};
		colData = data['default'] = {};
		colData['data'] = {};
		ctrl.fireEvent('colpers', ctrl, data);
		me.hide();
	},
	onCancel: function() {
		var me = this;
		me.close();
	},
	onClose: function () {
		var me = this;
	}
});

// MultiSort Window
Ext.define('Ext.ramco.Multisort', {
    extend: 'Ext.window.Window',
	xtype: 'ramcomultisort',
    title: 'MultiSort',
	width: 600,
	height: 420,
	modal: true,
	closable: true,
	autoScroll: true,
	alwaysOnTop: true, // AHBG-31969
	closeAction: 'hide',
	layout: {
		type: 'hbox',
		align: 'stretch'
	},
	buttonAlign: 'center',	
	initComponent: function() {
		var me = this,
			items, buttonItems = [], defButtons,
			colGridArray, sortGridArray;
		
		colGridArray = me.colGridColumns || [];
		sortGridArray = me.sortGridColumns || [];
			
		me.colGridStore = new Ext.data.JsonStore({
			proxy: { type: 'memory' },
			autoLoad: true,
			fields: ['view', 'colname', 'asc', 'desc'],
			data: colGridArray
		});
		me.sortGridStore =  new Ext.data.JsonStore({
			proxy: { type: 'memory' },
			autoLoad: true,
			fields: ['view', 'colname', {name: 'asc', type: 'int'}, {name:'desc', type: 'int'}],
			data: sortGridArray
		});
		items = [{
			xtype: 'grid',
			multiSelect: true,
			rowLines: true,
			userCls: 'gridBorder',
			flex: 1,
			height: 300,
			itemId: 'colGrid',
			margin: '5 5 5 5',
			viewConfig: {
				plugins: {
					ptype: 'gridviewdragdrop',
					containerScroll: true,
					enableDrag: true,
					enableDrop: true,
					ddGroup:'multisortgroup'
				}
			},
			store: me.colGridStore,
			columns: [{
				text: "Column Set",
				flex: 1,
				columns: [{
					text: 'Column Name',
					dataIndex: 'colname',
					flex: 1,
					sortable: true
				}]
			}]
		}, {
			xtype: 'container',
			width: 30,
			height: 300,
			itemId: 'leftRightContainer',
			layout:{
				type: 'vbox',
				pack: 'center'
			},
			items: [{
				xtype: 'button',
				tooltip: 'Move Record to Right',
				iconCls: 'tech-right_btn',
				width: 30,
				handler: function() {
					me.onHandleMultiSortNavigation('right');
				},
				scope: me,
				role: "uipage"
			}, {
				xtype: 'button',
				tooltip: 'Move Record to Left',
				iconCls: 'tech-left_btn',
				width: 30,
				handler: function() {
					me.onHandleMultiSortNavigation('left');
				},
				scope: me,
				role: "uipage"
			}]			
		}, {
			xtype: 'grid',
			multiSelect: true,
			rowLines: true,
			userCls: 'gridBorder',
			flex: 2,
			height: 300,
			itemId: 'sortGrid',
			margin: '5 5 5 5',
			viewConfig: {
				plugins: {
					ptype: 'gridviewdragdrop',
					containerScroll: true,
					enableDrag: true,
					enableDrop: true,
					ddGroup:'multisortgroup'
				},
				forceFit: true
			},
			store: me.sortGridStore,
			columns: [{
				text: "Sort Criteria",
				flex: 1,
				columns: [{
						text: 'Column Name',
						dataIndex: 'colname',
						flex: 2,
						sortable: true
					}, {
						id:'asc',
						width:70,
						header:'Ascending',
						align: 'center', // TECH-34273
						dataIndex:'asc',
						renderer:function(a,b,c) {
							var div = "<div class='{0}' style='color:{1}'></div>",
								cls = "tech-Ascending_ic",
								// TECH-28159 / TECH-26959
								// color = '#8f8f8f';
								color = '#f29400';
							if ( a == "1" ) {
								//cls = "tech-Descending_ic";
								// TECH-28159 / TECH-26959
								// color = '#f29400';
								color = '#8f8f8f';
							}
							return Ext.String.format(div, cls, color);
						}
					}, {
						id:'desc',
						width:70,
						header:'Descending',
						align: 'center', // TECH-34273
						dataIndex:'desc',
						renderer:function(a,b,c) {
							var div = "<div class='{0}' style='color:{1}'></div>",
								cls = "tech-Descending_ic",
								// TECH-28159 / TECH-26959
								// color = '#f29400';
								color = '#8f8f8f';
							if ( a == "0" ) {
								//cls = "tech-Ascending_ic";
								// TECH-28159 / TECH-26959
								// color = '#8f8f8f';
								color = '#f29400';
							}
							return Ext.String.format(div, cls, color);
						}
					}]
				}],
			listeners: {
				'cellclick':function(_this,rowIndex,columnIndex,e) {
					rowIndex = arguments[5];
					if(columnIndex == 1 || columnIndex == 2)
					{
						var record = _this.getStore().getAt(rowIndex),
							_val;
						switch(columnIndex) {
							case 1:
								_val = record.get("asc") == "0" ? "1" : "0";
								record.set("asc",_val);
								_val = record.get("desc") == "0" ? "1" : "0";
								record.set("desc",_val);
							break;
							case 2:
								_val = record.get("desc") == "1" ? "0" : "1";
								record.set("desc",_val);
								_val = record.get("asc") == "0" ? "1" : "0";
								record.set("asc",_val);
						}
					}
				}
			}
		}, {
			xtype: 'container',
			width: 30,
			itemId: 'upDownContainer',
			margin: '0 5 0 0',
			layout:{
				type: 'vbox',
				pack: 'center'
			},
			items: [{
				xtype: 'button',
				tooltip: 'Move Record to Up',
				iconCls: 'tech-up_btn',
				handler: function() {
					me.onHandleMultiSortNavigation('up');
				},
				scope: me,
				width: 30,
				role: "uipage"
			}, {
				xtype: 'button',
				tooltip: 'Move Record to Down',
				iconCls: 'tech-down_btn',
				handler: function() {
					me.onHandleMultiSortNavigation('down');
				},
				scope: me,
				width: 30,
				role: "uipage"
			}]
		}];
		// TECH-34273
		
		if (RamcoRTC.settings.requireSortPersistence == true) {
			buttonItems = [{
				xtype: 'component',
				width: 20
			},{
				xtype: 'checkbox',
				id: 'chkMultiPersistence',
				name: 'rowasxaxis',
				boxLabel: 'Save Sort Preference',
						checked: false,
				value: 0
			}, {
				xtype: 'component',
				width: 50
			}, {
			xtype: 'button',
			id: 'btnApplyMultiSort',
			customCls: 'green',
			handler: me.onApply,
			scope: me,
			text: 'Apply'
		}, {
			xtype: 'button',
			id: 'btnClearMultiSort',
			customCls: 'gray',
			handler: me.onClear,
			scope: me,
			text: 'Clear'
		}, {
			xtype: 'button',
			id: 'btnCancelMultiSort',
			customCls: 'red',
			handler: me.onCancel,
			scope: me,
			text: 'Cancel'
			}, '->'];
		}
		else {
			
			buttonItems = [{
			xtype: 'button',
			id: 'btnApplyMultiSort',
			customCls: 'green',
			handler: me.onApply,
			scope: me,
			text: 'Apply'
		}, {
			xtype: 'button',
			id: 'btnClearMultiSort',
			customCls: 'gray',
			handler: me.onClear,
			scope: me,
			text: 'Clear'
		}, {
			xtype: 'button',
			id: 'btnCancelMultiSort',
			customCls: 'red',
			handler: me.onCancel,
			scope: me,
			text: 'Cancel'
			}];
		
		}
		me.items = items;
		me.buttons = buttonItems;
		me.callParent();
		me.on('beforehide', me.onClose, me);
	},
	setGridColumns: function(gridCtrl, colArray, sortColArray) {
		var me = this,
			chkPersistence = me.down('#chkMultiPersistence');
			colGrid = me.items && me.items.items[0],
			sortGrid = me.items && me.items.items[2];
		if (colGrid && sortGrid) {
			if (chkPersistence)
				chkPersistence.setValue(false);
			me.colGridColumns = colArray;
			me.sortGridColumns = sortColArray;
			me.gridObj = gridCtrl;
			colGrid.store.setData(colArray);
			sortGrid.store.setData(sortColArray);
			me.show();
		}
	},
	onApply: function() {
		var me = this,
			data = me.sortGridStore.data,
			sortArray = [],			
			task = 'tskstdsort',
			taskType = 'multisort',
			sortData,
			chkPersistence = me.down('#chkMultiPersistence'),
			hasPersistence = chkPersistence && chkPersistence.checked,
			gridId = me.parentGridId,
			grid = me.gridObj, // TECH-34273
			gridCols, index, workArea, ilbo, // TECH-28159 / TECH-26959
			view = grid.up('ilbo'),
			controller = getMainController(); // TECH-29276
		// TECH-28159 / TECH-26959
		//grid =  view.down('#' + gridId);
		if (grid) {
			gridCols =  grid.getColumns();
			for (var j = 0; j < data.items.length; j++) {
				sortData = data.items[j].data;
				if (sortData) {
					// TECH-28159 / TECH-26959
					//index = gridCols.findIndex(x => x.dataIndex == sortData.view);
					index = gridCols.findIndex(function(x){return x.dataIndex == sortData.view});
					gridCols[index].asc = sortData.asc;
					gridCols[index].desc = sortData.desc;
					sortData.view = sortData.view.replace('v', '');
					sortArray.push({'view': sortData.view, 'so' : sortData.asc});
				}
			}
			// TECH-28159 / TECH-26959
			// RamcoRTC.lastFocusCtrl[1] = gridId;
			// RamcoRTC.lastFocusCtrl[2] = sortArray;
			// view.fireEvent('multisort', view, task, taskType, gridId, sortArray);
	
			// TECH-34273
			
			workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
			ilbo = view.ilboConfig.ilboName;
	
			// TECH-29276
			
			if(!controller.multiSortGridData[workArea])
				controller.multiSortGridData[workArea] = [];
			if(!controller.multiSortGridData[workArea][ilbo])
				controller.multiSortGridData[workArea][ilbo] = [];
	
			controller.multiSortGridData[workArea][ilbo][gridId]  = [gridId, sortArray];
	
			view.fireEvent('multisort', view, task, taskType, gridId, sortArray, 'apply');
			grid.multiSortData = sortArray;
			// AHBG-31969
			var toolbar =  grid.getDockedComponent('gridToolbar'),
				multiSortObj = toolbar && toolbar.getComponent('clearMultiSort');
			if (multiSortObj)
				multiSortObj.setDisabled(false);
		}
	},
	onClear: function() {
		var me = this,
			data = me.sortGridStore.data,
			chkPersistence = me.down('#chkMultiPersistence'),
			hasPersistence = chkPersistence && chkPersistence.checked,
			sortArray = [],			
			task = 'tskstdsort',
			taskType = 'multisort',
			sortData,
			gridId = me.parentGridId,
			// TECH-34273
			grid = me.gridObj,
			view = grid && grid.up('ilbo');
			mainController = getMainController(),
			workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default",
			ilboName = view && view.ilboConfig && view.ilboConfig.ilboName;
		
		//grid =  view.down('#' + gridId);
		for (var j = 0; j < data.items.length; j++) {
			sortData = data.items[j].data;
			if (sortData) {
				sortData.view = sortData.view.replace('v', '');
				sortArray.push({'view': sortData.view, 'so' : '-1'});
			}
		}		
		// TECH-34273
		if (hasPersistence)	 {
			// TECH-28159 / TECH-26959
			// view.fireEvent('multisort', view, task, taskType, gridId, sortArray);
			view.fireEvent('multisort', view, task, taskType, gridId, sortArray, 'clear');
			if (grid) {
				grid.multiSortData = null;
				delete grid.multiSortData;
			}
			RamcoRTC.lastFocusCtrl = null;
		}
		else {
			if (sortArray.length > 0) {
				grid.applyGridMultiSort(sortArray, 'clear');
				mainController.resetGridMultiSort(workArea, ilboName, gridId);
			}			
			me.hide();
		}
		// AHBG-31969
		if (!Ext.isEmpty(grid)) {
			var toolbar =  grid.getDockedComponent('gridToolbar'),
				multiSortObj = toolbar && toolbar.getComponent('clearMultiSort');
			if (multiSortObj)
				multiSortObj.setDisabled(true);
		}
	},
	onCancel: function() {
		var me = this;
		me.close();
	},
	onClose: function () {
		var me = this;
		if (me.colGridStore && me.sortGridStore) {
			me.colGridStore.removeAll(true);
			me.sortGridStore.removeAll(true);			
		}
	},
	onHandleMultiSortNavigation: function(dir) {
		var me = this,
			colGrid = me.getComponent('colGrid'),
			sortGrid = me.getComponent('sortGrid'),			
			colGridSelection, sortGridSelection,
			recIndex;
		
		if (colGrid && sortGrid) {
			if (dir == 'right') {
				colGridSelection = colGrid.getSelection();
				if (colGridSelection.length > 1)
					colGridSelection = colGridSelection.sort(function(a, b) {var s = me.colGridStore.indexOf(a) - me.colGridStore.indexOf(b); if(s>0) s = 1; else if(s<0) s=-1; else s=0; return s});
				Ext.each(colGridSelection,function(rec){
					rec.set("asc","0");
					rec.set("desc","1");
					me.sortGridStore.add(rec);
					me.colGridStore.remove(rec);
				});
			}
			else if (dir == 'left') {
				sortGridSelection = sortGrid.getSelection();
				if (sortGridSelection.length > 1)
					sortGridSelection = sortGridSelection.sort(function(a, b) {var s = me.sortGridStore.indexOf(a) - me.sortGridStore.indexOf(b); if(s>0) s = 1; else if(s<0) s=-1; else s=0; return s});
				Ext.each(sortGridSelection,function(rec){
					me.colGridStore.add(rec);
					me.sortGridStore.remove(rec);
				});				
			}
			else if (dir == 'up') {
				sortGridSelection = sortGrid.getSelection();
				/* if (sortGridSelection.length > 1)
					sortGridSelection = sortGridSelection.sort(function(a, b) {var s = me.sortGridStore.indexOf(b) - me.sortGridStore.indexOf(a); if(s>0) s = 1; else if(s<0) s=-1; else s=0; return s}); */
				Ext.each(sortGridSelection,function(rec){
					recIndex = me.sortGridStore.indexOf(rec);
					if (recIndex > 0) {
						me.sortGridStore.remove(rec);
						me.sortGridStore.insert((recIndex - 1), rec);
					}
				});
			}
			else if (dir == 'down') {
				sortGridSelection = sortGrid.getSelection();
				var len = me.sortGridStore.data.length;
				/* if (sortGridSelection.length > 1)
					sortGridSelection = sortGridSelection.sort(function(a, b) {var s = me.sortGridStore.indexOf(b) - me.sortGridStore.indexOf(a); if(s>0) s = 1; else if(s<0) s=-1; else s=0; return s}); */
				Ext.each(sortGridSelection,function(rec){
					recIndex = me.sortGridStore.indexOf(rec);
					if (recIndex < len - 1) {
						me.sortGridStore.remove(rec);
						me.sortGridStore.insert((recIndex + 1), rec);
					}
				});
			}
			colGrid.store = me.colGridStore;
			sortGrid.store = me.sortGridStore;
		}
	}
});


// Zoom Controller 
Ext.define('Ext.ramco.GridController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.grid',
    config: {
        control: {
            'field[role=gridzoom]': {
                change: 'onZoomFieldChange',
                specialkey: 'onZoomFieldTask',
				help: 'onHelp',
				uploadfile: 'onUploadFile',//TECH-31705
                deletefile: 'onDeleteFile',//TECH-31705
				validitychange: 'updateErrorState' // TECH-28871
            },
			//TECH-29761
			'ramcolistedit[role=gridzoom]':{
				lstedtspecialkey: 'onLstEdtSpecialKey',
				select: 'onSetListData'
			},
			'combofield[role=gridzoom]': {
                select: 'onSelect',
				focusleave:'onFocusLeave', // TECH-30546 / QA-151
				blur:'onFocusLeave'
			},
            'field[role=gridtool]': {
                specialkey: 'onZoomNav',
            },
            'ramcoslider': {
                changecomplete: 'onRowChange'
            },
            'button': {
                click: 'onZoomBtnTap'
            }
        }
    },
    onZoomBtnTap: function(btn) {
        var me = this,
            view = me.getView(),
            grid = view.grid,
			ilbo = view.up('ilbo'),
            gridView = grid.getView(),
            store = grid.store,
        	//TECH-34239
            //newValue = store.cr,
			topToolbar =  view.topToolBar,
            newValue =  (topToolbar && topToolbar.down('#zoomNumber'))? topToolbar.down('#zoomNumber').value:null,
			data = null,
            record = store.findRecord('rn', newValue),
            itemId = btn.getItemId(),
            totalRows = store.tr, taskType, // AHBG-27296
			controller = ilbo.controller; //TECH-28871

		if(controller && controller.errors && controller.errors.length > 0) {
			Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R044, Ext.emptyFn, undefined, 'error');
			return;
		}
		// ZoomWindow //TECH-36970 //TECH-37397
		// ZoomWindow //TECH-36970

        switch (itemId) {
			case 'closeBtn':
			case 'closeBtnBottom':
				view.hide();
				break;
            case 'restoreBtn':
            case 'restoreBtnBottom':
				view.toggleMaximize();
				break;
            case 'maximizeBtn':
            case 'maximizeBtnBottom':
				//me.isMlExpand = true;	
				view.toggleMaximize();	
				//me.fireEvent('mlExpand', me);
				break;
			case 'btnZoomColumnCopy':
			case 'btnZoomColumnCopyBottom':
				grid.fireEvent('copyappend', grid);
				break;
            case 'btnZoomColumnCut':
            case 'btnZoomColumnCutBottom':
				grid.fireEvent('cutappend', grid);
				break;
            case 'btnZoomColumnDefault':
            case 'btnZoomColumnDefaultBottom':
				grid.fireEvent('columndefault', grid);
				break;
            case 'btnZoomClearDefault':
            case 'btnZoomClearDefaultBottom':
				grid.fireEvent('columncleardefault', grid);
				break;
            case 'btnZoomColumnFilter':
            case 'btnZoomColumnFilterBottom':
				grid.fireEvent('columnfilter', grid);
				break;
            case 'btnZoomClearFilter':
            case 'btnZoomClearFilterBottom':
				grid.fireEvent('columnclearfilter', grid);
				break;
            case 'btnExpPdf':
            case 'btnExpPdfBottom':
				grid.fireEvent('exportpdf', grid);
				break;
            case 'btnExpReport':
            case 'btnExpReportBottom':
				grid.fireEvent('exportreport', grid);
				break;
            case 'btnExpHtml':
            case 'btnExpHtmlBottom':
				grid.fireEvent('exporthtml', grid);
				break;
            case 'btnExpExcel':
            case 'btnExpExcelBottom':
				grid.fireEvent('exportexcel', grid);
				//me.onZoomShowExcel();
				break;
            case 'btnExpCsv':
            case 'btnExpCsvBottom':
				grid.fireEvent('exportcsv', grid);
				break;
            case 'btnExpOffice':
            case 'btnExpOfficeBottom':
				grid.fireEvent('exportcsv', grid);
				break;
            case 'btnZoomColumnChooser':
            case 'btnZoomColumnChooserBottom':
				grid.fireEvent('colchoose', grid);
				break;
            case 'addBtn':
            case 'addBtnBottom':
                // TECH-28863
                //grid.fireEvent('insert', grid);
				grid.onInsert();
                grid.lastAction = 'insert';
				// TECH-28863 //TECH-34239 //QA-254
				record = store.findRecord('rn', newValue+1);
				if (view && record) {
					view.onLoadStore(record);
				}
                break;
            case 'deleteBtn':
            case 'deleteBtnBottom':
                record.set('sel', true);
                grid.fireEvent('deleterow', grid);
                grid.lastAction = 'delete';
                break;
            case 'zoomFirst':
            case 'zoomFirstBottom':
                me.moveToRow(1);
                break;
            case 'zoomPrev':
            case 'zoomPrevBottom':
                me.moveToPrev(newValue);
                break;
            case 'zoomNext':
            case 'zoomNextBottom':
                me.moveToNext(newValue);
                break;
            case 'zoomLast':
            case 'zoomLastBottom':
                // AHBG-27296
                //me.moveToRow(totalRows - 1); 
				me.moveToRow(totalRows);
				grid.lastEvent = 'onlast';
                break;
            default:
        }
		if(btn && btn.task){
			record.set('sel', true);
			// AHBG-27296
			//ilbo.fireEvent('trans', ilbo, data, btn.task, btn.taskType, '', '', '', '', '');
			taskType = btn.isModal ? 'modal' : btn.taskType;
			ilbo.fireEvent('trans', ilbo, data, btn.task, taskType, '', '', '', '', '');
		}
    },
    onZoomFieldChange: function(field, newValue, oldValue, eOpts) {
		// TECH-30546 / QA-151
		if(!field.isValid() || field.xtype == 'combofield') // TECH-33892
			return;
		
        var me = this,
            view = me.view,
            grid = view.grid,
            store = view.store,
			//TECH-34239
            //index = store.cr,
			topToolbar =  view.topToolBar,
            index =  (topToolbar && topToolbar.down('#zoomNumber'))? topToolbar.down('#zoomNumber').value:null,
            ilbo = view.up('ilbo'),
            name = field.getItemId();
			//TECH-36970
			view.index = index;
            //viewModel = ilbo.getViewModel(),
            //data = null,
        rec = store.findRecord('rn', index);
		
		
        if (rec) {
            rec.set(name, newValue);
			//TECH-37120
			if (!Ext.isEmpty(field.dataCol)) {
				rec.set(field.dataCol, newValue);
			}
            // AHBG-27296
            /*if (rec.get('isNew'))
                rec.set('isNew', false);*/
            /* if (field.uiTask && newValue) {
                ilbo.fireEvent('trans', ilbo, data, field.uiTask, field.uiTaskType);
                grid.lastAction = 'task';
            } */
        }
		// TECH-30188
		if(rec.get('isNew') && rec.dirty) {
			rec.data.isNew = false;
			grid.createDummyRecord();
		}
    },
	onSelect: function(ctrl, newValue) {
        var me = this,
			id = ctrl.getItemId(),
			view = me.view,
			grid = view.grid,
			store = view.store,
			//TECH-34239
			//index = store.cr,
			topToolbar =  view.topToolBar,
            index =  (topToolbar && topToolbar.down('#zoomNumber'))? topToolbar.down('#zoomNumber').value:null,
			val = newValue.get('value')
			ilbo = view.up('ilbo'),
			controller = ilbo.getController();
		rec = store.findRecord('rn', index);
		//TECH-36970
		view.index = index;
		if (rec) {
			rec.set(id, val);
			/* if (rec.get('isNew'))
				rec.set('isNew', false); */
			if(rec.get('isNew') && rec.dirty) { // TECH-30546 / QA-151
				rec.data.isNew = false;
				grid.createDummyRecord();
			}
			if (ctrl.uiTaskType == 'ui' && ctrl.uiTask) {
				if (controller.taskPending)
					return;
				var me = this,
					view = me.getView(),
					data = [],
					task = ctrl.uiTask,
					taskType = ctrl.uiTaskType || "ui";
				controller.taskPending = true;
				//view.fireEvent('trans', view, data, task, taskType, '', '', '', '', '', id, id);
				ilbo.fireEvent('trans', ilbo, data, task, taskType);
				grid.lastAction = 'task';
            }
        }
    },
	// TECH-30546 / QA-151
	onFocusLeave: function(field,evt) { 
		try {
			var me = this,
				comboVal = field.getRawValue(),
				store = field.store,
				rec, index,
				view = me.view,
				grid = view.grid,
				viewStore = view.store,
				//TECH-34239
				//cr = viewStore.cr,
				topToolbar =  view.topToolBar,
				cr =  (topToolbar && topToolbar.down('#zoomNumber'))? topToolbar.down('#zoomNumber').value:null,
				ilbo = view.up('ilbo'),
				name = field.getItemId();
				//TECH-36970
				view.index = cr;
			if (!Ext.isEmpty(comboVal)) {
				field.checkChange();
			}
			 if (store && store.data && comboVal){
					rec = store.findRecord(field.displayField, comboVal,'','','',true);
					index = (rec) ? store.indexOf(rec) : -1;
					if (index > -1) {
						//field.select();
						field.setValue(rec.data.text);
						var recs = viewStore.findRecord('rn', cr);
						  if (recs) {
							recs.set(name, rec.data.text);
						}
					}
				}
			
		}	
		catch(ex) { console.log(ex); }
	},
	//TECH-31705
	 onDeleteFile: function(ctrl, grid, row, srcPath, assView, dView) {
		  var me = this,
			id = ctrl.getItemId(),
			view = me.view,
			grid = view.grid,
			store = view.store,
			//TECH-34239
			//index = store.cr,
			topToolbar =  view.topToolBar,
            index =  (topToolbar && topToolbar.down('#zoomNumber'))? topToolbar.down('#zoomNumber').value:null,
			ilbo = view.up('ilbo'),
			controller = ilbo.getController(),
		 /*ilbo.fireEvent('deletefile', ilbo, grid,index,srcPath,ctrl.assView,ctrl.dView); */
		   ctrlId = grid ? grid.itemId : ctrl.itemId,
           viewId = ctrl.itemId.replace('v',''),
            rowNo = index,
            ilboConfig = ilbo.getIlboConfig(),
            task = 'deletefile',
			fileName = '',
            taskType = 'trans',
			formItems = null;
			//TECH-36970
			view.index = index;
        if (ctrl.xtype == 'deletecolumn')
            viewId = ctrl.assView;		
		if (grid) {
			fileName = grid.getViewValue(viewId, index);
		}
		else {
			fileName = ctrl.value || ctrl.rawValue;
		}
		if (Ext.isEmpty(fileName)) {
			controller.taskPending = false;
			return;
		}
        // TECH-28698 / KNB-184
		fileName = '"<b>' + (fileName.substr(0, fileName.lastIndexOf('.')) || fileName) + '</b>"';
		fileName = Ext.String.format(rvw_resources.R252, fileName);
        Ext.RamcoMsg.confirm(rvw_resources.R253, fileName, function(btnId) {
            if (btnId == "ok" || btnId == "yes") {
				//TECH-30979
				var deleteCallBack = function() {
					controller.taskPending = true;
					ilbo.fireEvent('deletefile', ilbo, task, taskType, ctrlId, viewId, rowNo, srcPath, ctrl.assView,ctrl.dView);
					return;
				};
				ilbo.callBack = deleteCallBack.bind(me);
				var viewModel = me.getViewModel(),
				dummyData = viewModel.getSessionData();
				controller.taskPending = true;
				ilbo.fireEvent('trans', ilbo, dummyData, 'tskdummy', 'trans');
				//view.fireEvent('deletefile', view, task, taskType, ctrlId, viewId, rowNo, srcPath, assView, dView);
            }
			else
				controller.taskPending = false;
        });
	 },
	 //TECH-31705
	 onUploadFile: function(ctrl, fdata, data, column, srcCtrl) {
			var me = this,
			id = ctrl.getItemId(),
			view = me.view,
			grid = view.grid,
			store = view.store,
			//TECH-34239
			//index = store.cr,
			topToolbar =  view.topToolBar,
            index =  (topToolbar && topToolbar.down('#zoomNumber'))? topToolbar.down('#zoomNumber').value:null,
			ilbo = view.up('ilbo'),
			 viewModel = ilbo.getViewModel(),
			 data = viewModel.getSessionData(),
			controller = ilbo.getController(),
		    ilboConfig = ilbo.getIlboConfig(),
            task = 'uploadfile',
            taskType = 'trans';
			//TECH-36970
			view.index = index;
			fdata.controlRowNo = index;
        ilbo.browseCtrl = {
            ctrl: ctrl,
            v: ilbo,
            data: data,
            srcCtrl: srcCtrl,
            task: ctrl.task,
            taskType: ctrl.taskType
        };
		var uploadCallBack = function() {
			controller.taskPending = true;
            ilbo.fireEvent('upload', ilbo, fdata, task, taskType, grid.itemId);
            return;
		};
        ilbo.callBack = uploadCallBack.bind(me);
        var viewModel = ilbo.getViewModel(),
            dummyData = viewModel.getSessionData();
			controller.taskPending = true;
        ilbo.fireEvent('trans', ilbo, dummyData, 'tskdummy', 'trans');
			
	 },
    onZoomFieldTask: function(field, evt, eOpts) {
        var me = this,
            view = me.view,
            grid = view.grid,
            ilbo = view.up('ilbo'),
            viewModel = ilbo.getViewModel(),
            value = field.getValue(),
			controller = ilbo.getController();
            data = null;
		if(controller.taskPending)
			return;
        if (evt.getKey() == evt.ENTER) {
            data = viewModel.getSessionData();
			//TECH-31705
			if(field.xtype == 'ramcolistedit'){
				field.collapse();
				field.doQueryTask.cancel();
				if (field.picker)
					selectedVal = (field.picker.view && field.picker.view.selectionModel)?field.picker.view.selectionModel.lastSelected:'';
				if (!Ext.isEmpty(selectedVal)) {
					field.select(selectedVal);
					field.fireEvent("select", field, selectedVal);
					return;
				}
			}else if (field.uiTask && value) {
				controller.taskPending = true;
                ilbo.fireEvent('trans', ilbo, data, field.uiTask, field.uiTaskType);
                grid.lastAction = 'task';
            }
        }
    },
	onHelp: function(field) {
        var me = this,
			view = me.view,
            ilbo = view.up('ilbo'),
			grid = view.grid,
            viewModel = ilbo.getViewModel(),
			task = field.helpTask.toLowerCase(),
            taskType = field.helpTaskType.toLowerCase(),
			ddtObj = null,
            ddtTask = null,
            ddtCtrl = null,
            ddtView = null,
            ddtValue = null,
			topToolbar =  view.topToolBar,//AHBG-31996
			store = view.store,
			index =  (topToolbar && topToolbar.down('#zoomNumber'))? topToolbar.down('#zoomNumber').value:null,
			srcCtrl = null;
        data = [];
		//TECH-36970
        //data = viewModel.getSessionData();
        if (view.ddt && view.ddt['task'] && view.ddt['task'][task]) {
            ddtObj = view.ddt['task'][task];
            ddtCtrl = ddtObj.ctrl;
            ddtView = ddtObj.view;
            if (ddtCtrl == ddtView) {
                ddtValue = view.getControlData(ddtCtrl);
                if (!Ext.isEmpty(ddtValue))
                    ddtValue = ddtValue.toLowerCase();
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            } else {
                srcCtrl = view.down('#' + ddtCtrl);
                if (srcCtrl) {
                    ddtValue = record ? record.get('v' + ddtView) : null;
                    if (!Ext.isEmpty(ddtValue))
                        ddtValue = ddtValue.toLowerCase();
                }
                if (view.ddt && view.ddt['value'] && view.ddt['value'][ddtValue]) {
                    ddtTask = view.ddt['value'][ddtValue].task;
                }
            }
        }
		//if(RamcoRTC.settings.isExt2){//AHBG-31996
			rec = store.findRecord('rn', index);
			rec.set('sel', true);
		//}
        if (ddtTask)
            task = ddtTask;
        me.taskPending = true;
        ilbo.fireEvent('help', ilbo, data, task, taskType);
	},
    onZoomNav: function(field, evt, eOpts) {
        var me = this,
            recNo = field.getValue();
        if (evt.getKey() == evt.ENTER) {
			// TECH-29849
			if(me.view && me.view.store && recNo > me.view.store.tr)
				return;
			
            if (recNo)
				// AHBG-25813 / TECH-27633
                // me.moveToRow(recNo - 1);
				me.moveToRow(recNo);
        }
    },
	//TECH-29761
	onLstEdtSpecialKey:function(field, evt, eOpts){
		var	me = this,
			view = me.getView(),
			 viewModel = me.getViewModel(),
			ilbo = view.up('ilbo'),
			controller = ilbo.getController();
		if (controller.taskPending)
            return;
        var data = [],
            cols = '',
            listElems = '',
            searchElem = '',
            task = field.uiTask,
            taskType = field.taskType,
            grid = field.grid,
			picker, i=0,len=0,
			key = evt.getKey(),
			value, parseValue;
     
        if (evt.ctrlKey == true && field.xtype == 'ramcolistedit') {
            if (evt.SPACE == key) {                
				picker = field.picker?field.picker:field.getPicker();
				if(picker){
					cols = picker.getVisibleColumns();
					i = 0;
					len = cols.length;
                	for (i = 0; i < len; i++) {
                    if (cols[i].mandatory == true) {
                        cols[i].mandatory = null;
							searchElem = cols[i].ariaEl.dom;
							if (searchElem && searchElem.className.indexOf("item-mandatory") > -1) {
								searchElem.className = searchElem.className.replace("item-mandatory", "");
								searchElem.className = searchElem.className.replace("search-item", "");
							}
							if (evt.shiftKey) {
								if (i == cols.length - 1)
									i = 0;
								else
									i += 1;
							}
							else {
								if (i == 0)
									i = cols.length - 1;
								else
									i -= 1;
							}
                            searchElem = cols[i].ariaEl.dom;
                            if (cols[i]) {
                                cols[i].mandatory = true;
                                if (searchElem && searchElem.className.indexOf("item-mandatory") == -1)
                                    searchElem.className += " search-item item-mandatory";
                                field.searchView = cols[i].itemId;
                                if (field.store.getCount() == 0) {
									if (field.grid)
										field.grid.fireEvent('listdata', field.grid, field.column, field.lastValue, field.getListView(), field.searchView, field.grid);
									else
										field.fireEvent('listdata', field, null, field.getValue());
                                }
                                field.store.clearFilter();
                                filter = new Ext.util.Filter({
                                    anyMatch: true,
                                    property: field.searchView,
                                    value: field.getValue()
                                });
                                field.store.filter(filter);
                                break;
                            }
                        }
                    }
                }
            }
		}
	},
	onSetListData:function(ctrl, record){
		var	me = this,
			view = me.getView(),
			ilbo = view.up('ilbo'),
			viewModel = ilbo.getViewModel(),
			controller = ilbo.getController();
		if (controller.taskPending)
            return;
        var data = [],
            task = null,
		    taskType = null,
			store = ctrl.grid.store,
			//TECH-34239
			//index = store.cr,
			topToolbar =  view.topToolBar,
            index =  (topToolbar && topToolbar.down('#zoomNumber'))? topToolbar.down('#zoomNumber').value:null,
            i = 0,
            mappedId = ctrl.mappedId,
            itemId = ctrl.getItemId(),
            fields = ctrl.columns,
            mappedView = ctrl.mappedView,
            field = null,
            id = null,
            viewId = null,
            ctrlObj = null,
            rec = null,
            vs = null,
			name = ctrl.name,
            len = mappedId ? mappedId.length : 0;
			//TECH-36970
			view.index = index;
		ctrl.idField = record.id;
        for (; i < len; i++) {
            id = (len == 1) ? itemId : mappedId[i];
			if(ctrl.column && ctrl.column.customListEdit === true)//AHBG-31834
				field = ctrl.fromView[i];
			else
            	field = fields[i].itemId;
            viewId = mappedView[i];
			vs = 'v' + viewId;
			if(Ext.isEmpty(viewId))
				continue;
      		ctrlObj = view.down("#" + vs);
			if (ctrlObj) {
				ctrlObj.setValue(record.get(field));
				//TECH-34239
				rec = store.findRecord('rn', index);
				if (rec) {
					rec.set(vs, record.get(field));
					if (rec.get('isNew'))
						rec.set('isNew', false);
					/* if (field.uiTask && newValue) {
						ilbo.fireEvent('trans', ilbo, data, field.uiTask, field.uiTaskType);
						ctrl.grid.lastAction = 'task';
					} */
				}
			}
        }
		//ctrl.idField = record.id;
		if (Ext.isFunction(ctrl.collapse))
			ctrl.collapse();
        if (ctrl.uiTask && !ctrl.focusLeave) {
            task = ctrl.uiTask;
            taskType = ctrl.taskType || "ui";
            data = viewModel.getSessionData();
            controller.taskPending = true;
     		//ilbo.fireEvent('mltrans', ilbo, data, task, taskType, '', '', '', '', '', ctrl.name, ctrl.name);
			//view.fireEvent('mltrans', view, data, task, taskType, grid.itemId, column.name);
     		ilbo.fireEvent('mltrans', ilbo, data, task, taskType, ctrl.grid.itemId, ctrl.name);
        }
	},
    moveToRow: function(recNo) {
        var me = this,
            view = me.getView(),
            grid = view.grid,
            gridView = grid.getView();
			// TECH-29849
			cr = recNo,
			store = grid.store,
            lastRecord = store.getAt((store.count() -1)),
            firstRecord = store.getAt(0);
			
		if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
		
        view.setSliderValue(recNo);
		// AHBG-25813 / TECH-27633
        // view.store.cr = cr = recNo;
		// TECH-29849
		if (!(cr >= si && cr <= ei)) 
			view.store.cr = cr = (recNo - 1);
		else {
			view.store.cr = cr = (recNo)
			view.store.vsi = (recNo);
			grid.lastEvent = 'onnext';
			grid.gridFocus(grid.col, store.vsi);
		}
			
        if (recNo == 2)
            grid.lastAction = 'prev';
        else
            grid.lastAction = 'next';
    },
    moveToPrev: function(cr) {
        var me = this,
            view = me.getView(),
            grid = view.grid,
            gridView = grid.getView(),
            visibleRows = grid.getVisibleRows(),
            store = grid.store,
            vsi = store.vsi,
			//TECH-34239
			//cr = store.cr,
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = cr > visibleRows ? cr - visibleRows : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei,
			topbar, dspRow, rowNav, rowNo, lastRowIndex; // TECH-28875
        if (cr == 1)
            return;
        view.store.cr = cr = (cr - 1);
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (!(cr >= si && cr <= ei)) {
            view.setSliderValue(cr);
            view.store.cr = cr = (cr + 1);
            grid.lastAction = 'prev';
        } else {
            if (grid) {
                grid.updating = true;
                var nav = grid.getNavigationModel(),
                    sel = grid.getSelectionModel(),
                    record = grid.store.findRecord('rn', cr),
                    rowIndex = -1,
                    row;
                if (record)
                    rowIndex = grid.store.indexOf(record);
                if (rowIndex > -1)
                    row = gridView.getRow(rowIndex);
                row = gridView.getRow(rowIndex);
                if (row) {
                    if (nav) {
                        nav.setPosition(rowIndex, grid.col, null, true, true);
                    }
                }
				// TECH-28875
				topbar = grid.getDockedComponent('gridToolbar');
				dspRow = topbar ? topbar.getComponent('dspRow') : null;
				rowNav = topbar ? topbar.getComponent('rowNav') : null;
				rowNo = rowNav.getValue();
			
				if(dspRow && rowNav && cr < rowNo) {
					lastRowIndex = cr + (visibleRows - 1);
					dspRow.update({v:'- ' + lastRowIndex + '/' + tr});
					rowNav.setRawValue(cr);	
				}
                grid.updating = false;
            }
            if (view && record) {
                view.onLoadStore(record);
            }
        }
    },
    moveToNext: function(cr) {
        var me = this,
            view = me.getView(),
            grid = view.grid,
            gridView = grid.getView(),
            visibleRows = grid.getVisibleRows(),
            store = grid.store,
            vsi = store.vsi,
			//TECH-34239
            //cr = store.cr,
            tr = store.tr,
            lastRow = store.count(),
            lastRecord = lastRow > 0 ? store.getAt(lastRow - 1) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = cr > visibleRows ? cr - visibleRows : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei,
			topbar, dspRow, rowNav, rowNo, startRowIndex; // TECH-28875
        if (cr == tr)
            return;
        view.store.cr = cr = (cr + 1);
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (!(cr >= si && cr <= ei)) {
            view.setSliderValue(cr);
            view.store.cr = cr = (cr + 1);
            grid.lastAction = 'next';
        } else {
            if (grid) {
                grid.updating = true;
                var nav = grid.getNavigationModel(),
                    sel = grid.getSelectionModel(),
                    record = grid.store.findRecord('rn', cr),
                    rowIndex = -1,
                    row;
                if (record)
                    rowIndex = grid.store.indexOf(record);
                if (rowIndex > -1)
                    row = gridView.getRow(rowIndex);
                row = gridView.getRow(rowIndex);
                if (row) {
                    if (nav) {
                        nav.setPosition(rowIndex, grid.col);
                        nav.focusPosition(nav.getPosition());
                    }
                    if (sel) {
                        sel.select({
                            row: rowIndex,
                            column: grid.col
                        });
                    }
                }
				// TECH-28875
				topbar = grid.getDockedComponent('gridToolbar');
				dspRow = topbar ? topbar.getComponent('dspRow') : null;
				rowNav = topbar ? topbar.getComponent('rowNav') : null;
								
				if(dspRow && rowNav && cr > visibleRows) {
					rowNo = rowNav.getValue();
					startRowIndex = cr - (visibleRows - 1);
					if(startRowIndex > rowNo) {
						dspRow.update({v:'- ' + cr + '/' + tr});
						rowNav.setRawValue(startRowIndex);	
					}
				}
                grid.updating = false;
            }
            // AHBG-27296
			//if (view && record)
            if (view && record && !record.get('isNew')) {
                view.onLoadStore(record);
            }
        }
    },
    onRowChange: function(slider, index, thumb) {
        var me = this,
            view = me.getView(),
            grid = view.grid,
            gridView = grid.getView(),
            visibleRows = grid.getVisibleRows(),
            store = grid.store,
            cr = index,
            tr = grid.tr,
            lastRow = store.count(),
            insertFlag = grid.getInsertFlag(),
            last = insertFlag ? 2 : 1,
            lastRecord = lastRow > 0 ? store.getAt(lastRow - last) : null,
            firstRecord = lastRow > 0 ? store.getAt(0) : null,
            start = index > visibleRows ? index - visibleRows : 1,
            end = (visibleRows * 3) + (start - 1),
            si, ei;
		// AHBG-27296 
		if(cr == tr)
			grid.lastEvent = 'onlast';
        if (firstRecord && lastRecord) {
            si = firstRecord.get('rn');
            ei = lastRecord.get('rn');
        }
        if (!(cr >= si && cr <= ei)) {
            view.setSliderValue(cr);
            view.store.cr = cr - 1;
            grid.lastAction = 'slider';
        } else {
            view.store.cr = cr;
            if (grid) {
                grid.updating = true;
                var nav = grid.getNavigationModel(),
                    sel = grid.getSelectionModel(),
                    record = grid.store.findRecord('rn', cr),
                    rowIndex = -1,
                    row;
                if (record)
                    rowIndex = grid.store.indexOf(record);
                if (rowIndex > -1)
                    row = gridView.getRow(rowIndex);
                row = gridView.getRow(rowIndex);
                if (row) {
                    if (nav) {
                        nav.setPosition(rowIndex, grid.col);
                        nav.focusPosition(nav.getPosition());
                    }
                    if (sel) {
                        sel.select({
                            row: rowIndex,
                            column: grid.col
                        });
                    }
                }
                grid.updating = false;
            }
            if (view && record) {
                view.onLoadStore(record);
            }
        }
    },
	//TECH-28871
	updateErrorState: function(cmp, isValid) {
        var me = this,
            itemId = cmp.getId(),
            view = me.getView(),
			ilbo = view.up('ilbo'),
			errors = (ilbo.controller && ilbo.controller.errors) ? ilbo.controller.errors : "",
            caption = cmp.caption || 'No Caption',
            msg;
        if (ilbo.isInit) {
			
			// TECH-30546 / QA-151
			if (isValid && errors && errors.length == 1) {
				errors.clear();
			}
			
			if (isValid && errors && errors.length == 0) {
				// TECH-30546 / QA-151
				ilbo.fireEvent('errors', ilbo, errors);
				return;
			}
            if (!isValid && !cmp.isHidden()) {
				// TECH-39573
				var gridModel, gridCol, gridRec, rowNo;
				gridModel = cmp.ownerCt && cmp.ownerCt.context;
				if (gridModel && gridModel.grid) {
					gridCol = cmp.column;
					gridRec = gridModel.record;
					rowNo = (gridRec && gridRec.get('rn')) || 1;
					if (gridCol)
						caption = 'Row ' + rowNo + ' - ' + gridCol.text;
				}
                msg = cmp.getErrors().join(",");
				errors.add(itemId, {
                    itemId: itemId,
                    text: caption + ' ' + msg
                });
				view.rowNumber.disable();
				view.rowSlider.disable();
			} 
			else {
                errors.removeAtKey(itemId);
				if(errors.length == 0) {
					view.rowNumber.enable();
					view.rowSlider.enable();
				}
					
            }
            ilbo.fireEvent('errors', ilbo, errors);
        }
    }
});

// Ellipse Window
Ext.define('Ext.ramco.Ellipse', {
    extend: 'Ext.tip.Tip',
    xtype: 'ramcoellipse',
    closeAction: 'destroy',
	minHeight: 100,
	minWidth: 100, //TECH-39879
	cls: 'x-window-ellipse', // AHBG-31971
    closable: true,
	alwaysOnTop:true,//TECH-36883
    defaultFocus: '#ellipseText',
    buttonAlign: 'center', // TECH-40734
    /* bBar: [{
        xtype: 'button',
        text: rvw_resources.R102,
        handler: 'okClick',
        itemId: 'okbtn'
    }],*/	
	keyMap: { // TECH-27239 / TECH-27017
        scope: 'this',
        ESC: 'onEsc'
    },
	items: [{
        xtype: 'textarea',
        readOnly: true,
        itemId: 'ellipseText',
        height: 60
    },
	// AHBG-31971
	{
		xtype: 'container',
		itemId: 'okaybtncntr',
		style: {
			marginTop: '5px',
            textAlign: 'center'
        },
		items:[{
	        xtype: 'button',
	        text: rvw_resources.R102,
	        itemId: 'okaybtn',
			height: 20,
	        handler: function(btn, e) {
				var me = this,
				ellipse = me.up('ramcoellipse'),
				ellipseText = null,
				ascCtrl = null,
				column, colRecord;
				
				// TECH-39449
				if (ellipse) {
					ellipseText = ellipse.ellipseText;
					ascCtrl = ellipse.ascCtrl;
					if (ellipseText && ascCtrl && ascCtrl.xtype != "ramcogrid") {
						if (ascCtrl.ownerCt && ascCtrl.ownerCt.column) {
							column = ascCtrl.ownerCt.column;
							colRecord = ascCtrl.ownerCt.context && ascCtrl.ownerCt.context.record;
						}						
						if (column && !Ext.isEmpty(colRecord)) {
							colRecord.set(column.dataIndex, ellipseText.getValue());
							//ascCtrl.setValue(ellipseText.getValue());
						}
						else {
							ascCtrl.setValue(ellipseText.getValue());
							if (!ascCtrl.autoExpand)
								ascCtrl.focus();
						}
					}
					ellipse.close();
				}
				
			}
		}]
    }],
    initComponent: function() {
        var me = this;
        me.callParent();
        me.ellipseText = me.down('#ellipseText');
    },
    afterRender: function() {
        var me = this;
		// TECH-27017
        // keyMap;

        me.callParent();
        
		// TECH-27017
		/*
		keyMap = me.getKeyMap();

        if (keyMap) {

            if (me.closable) {
                //keyMap = me.getKeyMap();
                keyMap.on(27, me.onEsc, me);
            } else
                keyMap = me.keyMap;
            //if (keyMap && me.hidden)
            if (me.hidden)
                keyMap.disable();
        } */
    },
    onEsc: function(k, e) {
		// TECH-27017
        // e.stopEvent();
		k.stopEvent();
        this.close();
    },
    okClick: function() {}
});

//Zoom Grid
Ext.define('Ext.ramco.GridZoom', {
    extend: 'Ext.window.Window',
    xtype: 'uigridzoom',
    closeAction: 'destroy',
    closable: true,
	scrollable: true,
	alwaysOnTop: true, // AHBG-31969
    layout: {
        type: 'fit'
    },
    config: {
        margin: 5,
        currentRow: 0,
        currentRowIndex: 0
    },
    controller: 'grid',
    initComponent: function() {
        var me = this,
			dockItems;
		// ZoomWindow //TECH-36970 //TECH-37397
		if (RamcoRTC.settings.isExt2 == true) {
			me.modal = false;
			
			if(RamcoRTC.settings.isInplaceZoom){
			me.closable = false;
			me.title =  { hideMode: 'display', hidden: true };
			me.cls = 'x-grid-inplacezoom';
			}
			else{
				me.title = "Transposed View";
				me.maximizable = true;
			}
			
			dockItems = [{
				dock: 'top',
				xtype: 'toolbar',
				itemId: 'topBar',
				defaultButtonUI: 'bcb-toolbar',
				style: {
					'background-color': 'transparent',
					'color': 'black'
				},
				defaults: {
					scale: 'small',
					padding: 2
				},
				items: [{
					xtype: 'button',
					iconCls: 'x-fa fa-close',
					hidden:!(RamcoRTC.settings.isInplaceZoom === true),
					itemId: 'closeBtn'
				}, {
					xtype: 'button',
				//	iconCls: 'x-fa fa-window-restore',
					hidden:!(RamcoRTC.settings.isInplaceZoom === true),
					itemId: 'restoreBtn'
				}, {
					xtype: 'button',
					iconCls: 'x-fa fa-arrows-alt',
					hidden:!(RamcoRTC.settings.isInplaceZoom === true),
					//iconCls: 'x-fa fa-window-maximize',
					itemId: 'maximizeBtn'
				}, '-', {
					xtype: 'button',
					itemId: 'zoomFirst',
					iconCls: 'x-fa fa-angle-double-left',
					tooltip: rvw_resources.R011
				}, {
					xtype: 'button',
					itemId: 'zoomPrev',
					iconCls: 'x-fa fa-caret-left',
					tooltip: rvw_resources.R013
				}, {
					itemId: 'zoomNumber',
					xtype: 'numberfield',
					role: 'gridtool',
					width: 30,
					value: 1,
					increment: 1,
					minValue: 1,
					maxValue: 1,
				}, {
                    itemId: 'zoomdspRow',//AHBG-31996
					//hidden: true,
                    xtype: 'component',
					tpl: '{v}'                    
                },{
					xtype: 'button',
					itemId: 'zoomNext',
					iconCls: 'x-fa fa-caret-right',
					tooltip: rvw_resources.R014
				}, {
					xtype: 'button',
					itemId: 'zoomLast',
					iconCls: 'x-fa fa-angle-double-right',
					tooltip: rvw_resources.R012
				}, '-', {
						itemId: 'addBtn',
						xtype: 'button',
						hidden: true,
						iconCls: 'x-fa fa-plus',
						tooltip: rvw_resources.R145
					}, {
						itemId: 'deleteBtn',
						xtype: 'button',
						hidden: true,
						iconCls: 'x-fa fa-minus',
						tooltip: rvw_resources.R146
					}, {
						itemId: 'btnZoomColumnCopy',
						xtype: 'button',
						hidden: true,
						iconCls: 'tech-copy',
						tooltip: rvw_resources.R148
					}, {
						itemId: 'btnZoomColumnCut',
						xtype: 'button',
						hidden: true,
						iconCls: 'x-fa fa-cut',
						tooltip: rvw_resources.R147
					},{
                    itemId: 'btnZoomColumnDefault',
                    xtype: 'button',
                    //hidden: !showDefault,
                    iconCls: 'x-fa fa-cog',
                    tooltip: rvw_resources.R245
                }, {
                    itemId: 'btnZoomClearDefault',
                    xtype: 'button',
                    //hidden: !showDefault,
                    iconCls: 'tech-ClearDefault_ic',
                    tooltip: rvw_resources.R246
                }, {
                    itemId: 'btnZoomColumnFilter',
                    xtype: 'button',
                    hidden: !RamcoRTC.settings.enableColumnFilter,
                    iconCls: 'tech-Filter_ic',
                    tooltip: rvw_resources.R291
                }, {
                    itemId: 'btnZoomClearFilter',
                    xtype: 'button',
                    hidden: !RamcoRTC.settings.enableColumnFilter,
                    iconCls: 'tech-ClearFilter_ic',
                    tooltip: rvw_resources.R292
                }, '->', '-', {
					itemId: 'btnExpPdf',
					tooltip: rvw_resources.R153,
					iconCls: 'tech-adobe'
				},  {
					itemId: 'btnExpReport',
					tooltip: rvw_resources.R156,
					iconCls: 'tech-charts'
				}, {
					itemId: 'btnExpHtml',
					tooltip: rvw_resources.R154,
					iconCls: 'tech-html'
				}, {
					itemId: 'btnExpExcel',
					tooltip: rvw_resources.R151,
					iconCls: 'x-fa fa-file-excel-o'
				}, {
					itemId: 'btnExpCsv',
					tooltip: rvw_resources.R155,
					iconCls: 'tech-csv'
				}, '-', {
					itemId: 'btnExpOffice',
					tooltip: rvw_resources.R152,
					iconCls: 'x-fa fa-file-excel-o'
				}, {
					itemId: 'btnZoomColumnChooser',
					hidden: (RamcoRTC.settings.showColumnChooser === false),//TECH-30249
					tooltip: rvw_resources.R159,
					iconCls: 'tech-column_chooser'
				},
				{
		            itemId: 'zoomSlider',
		            xtype: 'ramcoslider',
		            role: 'rowSlider',
					hidden: true,
		            flex: 1,
		            value: 1,
		            increment: 1,
		            minValue: 1,
		            maxValue: 1,
				}]
			},{
					dock: 'bottom',
					xtype: 'toolbar',
					itemId: 'bottomBar',
					hidden:(RamcoRTC.settings.isInplaceZoom === true),
					defaultButtonUI: 'bcb-toolbar',
					style: {
						'background-color': 'transparent',
						'color': 'black'
					},
					defaults: {
						scale: 'small',
						padding: 2
					},
					items: [{
						xtype: 'button',
						iconCls: 'x-fa fa-close',
						hidden:!(RamcoRTC.settings.isInplaceZoom === true),
						itemId: 'closeBtnBottom'
					}, {
						xtype: 'button',
					//	iconCls: 'x-fa fa-window-restore',
						hidden:!(RamcoRTC.settings.isInplaceZoom === true),
						itemId: 'restoreBtnBottom'
					}, {
						xtype: 'button',
						iconCls: 'x-fa fa-arrows-alt',
						hidden:!(RamcoRTC.settings.isInplaceZoom === true),
						//iconCls: 'x-fa fa-window-maximize',
						itemId: 'maximizeBtnBottom'
					}, '-', {
						xtype: 'button',
						itemId: 'zoomFirstBottom',
						iconCls: 'x-fa fa-angle-double-left',
						tooltip: rvw_resources.R011
					}, {
						xtype: 'button',
						itemId: 'zoomPrevBottom',
						iconCls: 'x-fa fa-caret-left',
						tooltip: rvw_resources.R013
					}, {
						itemId: 'zoomNumberBottom',
						xtype: 'numberfield',
						role: 'gridtool',
						width: 30,
						value: 1,
						increment: 1,
						minValue: 1,
						maxValue: 1,
					}, {
						itemId: 'zoomdspRowBottom',//AHBG-31996
						//hidden: true,
						xtype: 'component',
						tpl: '{v}'                    
					},{
						xtype: 'button',
						itemId: 'zoomNextBottom',
						iconCls: 'x-fa fa-caret-right',
						tooltip: rvw_resources.R014
					}, {
						xtype: 'button',
						itemId: 'zoomLastBottom',
						iconCls: 'x-fa fa-angle-double-right',
						tooltip: rvw_resources.R012
					}, '-', {
							itemId: 'addBtnBottom',
							xtype: 'button',
							hidden: true,
							iconCls: 'x-fa fa-plus',
							tooltip: rvw_resources.R145
						}, {
							itemId: 'deleteBtnBottom',
							xtype: 'button',
							hidden: true,
							iconCls: 'x-fa fa-minus',
							tooltip: rvw_resources.R146
						}, {
							itemId: 'btnZoomColumnCopyBottom',
							xtype: 'button',
							hidden: true,
							iconCls: 'tech-copy',
							tooltip: rvw_resources.R148
						}, {
							itemId: 'btnZoomColumnCutBottom',
							xtype: 'button',
							hidden: true,
							iconCls: 'x-fa fa-cut',
							tooltip: rvw_resources.R147
						},{
						itemId: 'btnZoomColumnDefaultBottom',
						xtype: 'button',
						//hidden: !showDefault,
						iconCls: 'x-fa fa-cog',
						tooltip: rvw_resources.R245
					}, {
						itemId: 'btnZoomClearDefaultBottom',
						xtype: 'button',
						//hidden: !showDefault,
						iconCls: 'tech-ClearDefault_ic',
						tooltip: rvw_resources.R246
					}, {
						itemId: 'btnZoomColumnFilterBottom',
						xtype: 'button',
						hidden: !RamcoRTC.settings.enableColumnFilter,
						iconCls: 'tech-Filter_ic',
						tooltip: rvw_resources.R291
					}, {
						itemId: 'btnZoomClearFilterBottom',
						xtype: 'button',
						hidden: !RamcoRTC.settings.enableColumnFilter,
						iconCls: 'tech-ClearFilter_ic',
						tooltip: rvw_resources.R292
					}, '->', '-', {
						itemId: 'btnExpPdfBottom',
						tooltip: rvw_resources.R153,
						iconCls: 'tech-adobe'
					},  {
						itemId: 'btnExpReportBottom',
						tooltip: rvw_resources.R156,
						iconCls: 'tech-charts'
					}, {
						itemId: 'btnExpHtmlBottom',
						tooltip: rvw_resources.R154,
						iconCls: 'tech-html'
					}, {
						itemId: 'btnExpExcelBottom',
						tooltip: rvw_resources.R151,
						iconCls: 'x-fa fa-file-excel-o'
					}, {
						itemId: 'btnExpCsvBottom',
						tooltip: rvw_resources.R155,
						iconCls: 'tech-csv'
					}, '-', {
						itemId: 'btnExpOfficeBottom',
						tooltip: rvw_resources.R152,
						iconCls: 'x-fa fa-file-excel-o'
					}, {
						itemId: 'btnZoomColumnChooserBottom',
						hidden: (RamcoRTC.settings.showColumnChooser === false),//TECH-30249
						tooltip: rvw_resources.R159,
						iconCls: 'tech-column_chooser'
					},
					{
						itemId: 'zoomSliderBottom',
						xtype: 'ramcoslider',
						role: 'rowSlider',
						hidden: true,
						flex: 1,
						value: 1,
						increment: 1,
						minValue: 1,
						maxValue: 1,
					}]
			}]
		}
		else {
			dockItems = [{
		        dock: 'top',
		        xtype: 'toolbar',
		        itemId: 'topBar',
		        defaultButtonUI: 'bcb-toolbar',
		        style: {
		            'background-color': '#024a59',
		            'color': 'white'
		        },
		        defaults: {
		            scale: 'small',
		            padding: 2
		        },
		        items: [{
		            xtype: 'button',
		            iconCls: 'x-fa fa-plus',
		            hidden: true,
		            itemId: 'addBtn'
		        }, {
		            xtype: 'button',
		            iconCls: 'x-fa fa-minus',
		            hidden: true,
		            itemId: 'deleteBtn'
		        }, {
		            xtype: 'label',
		            role: 'totalrows',
		            tpl: '<span class="x-currentrow">Current : {rowno} - Total Row(s) : {totalrow} </span>'
		        }, {
		            xtype: 'button',
		            itemId: 'zoomFirst',
		            iconCls: 'x-fa fa-angle-double-left',
		            tooltip: rvw_resources.R011
		        }, {
		            xtype: 'button',
		            itemId: 'zoomPrev',
		            iconCls: 'x-fa fa-angle-left',
		            tooltip: rvw_resources.R013
		        }, {
		            itemId: 'zoomSlider',
		            xtype: 'ramcoslider',
		            role: 'rowSlider',
					hidden: (RamcoRTC.settings.isExt2 == true),
		            flex: 1,
		            value: 1,
		            increment: 1,
		            minValue: 1,
		            maxValue: 1,
		        }, {
		            itemId: 'zoomNumber',
		            xtype: 'numberfield',
		            role: 'gridtool',
		            width: 100,
		            value: 1,
		            increment: 1,
		            minValue: 1,
		            maxValue: 1,
		        }, {
		            xtype: 'button',
		            itemId: 'zoomNext',
		            iconCls: 'x-fa fa-angle-right',
		            tooltip: rvw_resources.R014
		        }, {
		            xtype: 'button',
		            itemId: 'zoomLast',
		            iconCls: 'x-fa fa-angle-double-right',
		            tooltip: rvw_resources.R012
		        }]
			}];
		}
		
		me.dockedItems = dockItems;
        me.callParent();
        me.topToolBar = me.down("#topBar");
		me.bottomToolBar = me.down("#bottomBar");
        me.on({
            remove: 'onRemove',
            scope: me
        });
    },
    onLoadStore: function(record) {
        var me = this;
        if (record) {
            me.bindDataToControl(record);
        }
    },
    createControls: function(grid, index, record) {
        var me = this,
            topToolbar = me.topToolBar,
			bottomToolBar = me.bottomToolBar,
            rowSlider = topToolbar.down('ramcoslider[role=rowSlider]'),
			rowSliderbtm = bottomToolBar && bottomToolBar.down('ramcoslider[role=rowSlider]'),
            rowNumber = topToolbar.down('#zoomNumber'),
            rowNumberbtm = bottomToolBar && bottomToolBar.down('#zoomNumberBottom'),
            totalRowsCtrl = topToolbar.down('label[role=totalrows]'),
			totalRowsCtrlbtm = bottomToolBar && bottomToolBar.down('label[role=totalrows]'),
            itemId = grid.getItemId(),
            store = grid.store,
            totalrows = store.tr,
            columns = grid.getColumns(),
            editableColumns = Ext.ComponentQuery.query('{editor}', columns),
            i = 0,
            k = 0,
            key = 0,
            value = null,
            name = null,
            column = null,
            ctrls = [],
            help = false,
            mandatory = false,
            helptask = '',
            editor = [],
			isTool=false,//TECH-36970
			isShowTool = false,//AHBG-31996
            recNo = record.get('rn'),
            sel = record.get('sel'),
            xTpl = null,
            ilbo = me.up('ilbo'),
            ctrlConfig, ctrlWidth; // TECH-28198
        me.grid = grid;
        me.store = store;
		//TECH-36970
		if(RamcoRTC.settings.isExt2){
			if(editableColumns.length == 0){
				topToolbar.items.getAt(11).hide();
				topToolbar.items.getAt(12).hide();
				topToolbar.items.getAt(13).hide();
				topToolbar.items.getAt(14).hide();
				if(bottomToolBar){
					bottomToolBar.items.getAt(11).hide();
					bottomToolBar.items.getAt(12).hide();
					bottomToolBar.items.getAt(13).hide();
					bottomToolBar.items.getAt(14).hide();
				}
			}
			else{
				for(var z = 0 ; z < editableColumns.length;z++ ){
					if(editableColumns[z].hidden)
						isTool = true;
					else if(editableColumns[z].hidden === false)
						isShowTool = true;
				}
				if(isShowTool || !isTool){
					topToolbar.items.getAt(11).show();
					topToolbar.items.getAt(12).show();
					topToolbar.items.getAt(13).show();
					topToolbar.items.getAt(14).show();
					if(bottomToolBar){
						bottomToolBar.items.getAt(11).show();
						bottomToolBar.items.getAt(12).show();
						bottomToolBar.items.getAt(13).show();
						bottomToolBar.items.getAt(14).show();
					}
				}
				else{
					topToolbar.items.getAt(11).hide();
					topToolbar.items.getAt(12).hide();
					topToolbar.items.getAt(13).hide();
					topToolbar.items.getAt(14).hide();
					if(bottomToolBar){
						bottomToolBar.items.getAt(11).hide();
						bottomToolBar.items.getAt(12).hide();
						bottomToolBar.items.getAt(13).hide();
						bottomToolBar.items.getAt(14).hide();
					}
				}
				}
			var zoomdspRow = topToolbar.down('#zoomdspRow');
			var zoomdspRowbtm = bottomToolBar && bottomToolBar.down('#zoomdspRowBottom');
			if(zoomdspRow){
				zoomdspRow.update({v: '/' + (totalrows)});
			}
			if(zoomdspRowbtm){
				zoomdspRowbtm.update({v: '/' + (totalrows)});
			}
        }
		// AHBG-27296
		if(totalrows != recNo && store.getAt(store.getCount() - 1).get('isNew'))
			totalrows--;
        if (!Ext.isBoolean(sel)) {
            sel = sel === 0 ? false : true;
        }
        if (editableColumns.length > 0 && (!RamcoRTC.settings.isExt2 && !RamcoRTC.settings.isInplaceZoom)) {
            topToolbar.items.getAt(0).show();
            topToolbar.items.getAt(1).show();
            topToolbar.items.getAt(2).show();
            topToolbar.items.getAt(3).show();
        }
		/* if(RamcoRTC.settings.isExt2){
			if(grid.getShowDefault()){
				topToolbar.items.getAt(10).show();
				topToolbar.items.getAt(10).show();
			}
			else{
				topToolbar.items.getAt(10).hide();
				topToolbar.items.getAt(11).hide();
			}
			if(grid.getPdfFlag()){
				topToolbar.items.getAt(16).show();
			}
			else{
				topToolbar.items.getAt(16).hide();
			}
			if(grid.getReportFlag()){
				topToolbar.items.getAt(17).show();
			}
			else{
				topToolbar.items.getAt(17).hide();
			}
			if(grid.getHtmlFlag()){
				topToolbar.items.getAt(18).show();
			}
			else{
				topToolbar.items.getAt(18).hide();
			}
			if(grid.getExportExcelFlag()){
				topToolbar.items.getAt(19).show();
			}
			else{
				topToolbar.items.getAt(19).hide();
			}
			if(grid.getExportCsvFlag()){
				topToolbar.items.getAt(20).show();
			}
			else{
				topToolbar.items.getAt(20).hide();
			}
		} */
        for (key in columns) {
            column = columns[key];
            name = column.dataIndex;
            if (Ext.isEmpty(column) || column.isHidden() || column.hidden)
                continue;
			//TECH-36970
			if(RamcoRTC.settings.isExt2 === true && (name == 'sel' || name == 'rn'))
				continue;
            help = column.helpIcon;
            mandatory = column.mandatory;
            helptask = column.helpTask;
            value = record.get(name);
            editor = column.getEditor(record);
            ctrlConfig = {};
            if (!editor) {
				//TECH-31705
                if (column.xtype == 'ramcogridcheck') {
                    ctrlConfig['role'] = 'gridzoom';
                    ctrlConfig['xtype'] = 'checkbox';
                } else if (column.xtype == 'fileattachcolumn' || column.xtype == 'attachcolumn' || column.xtype == 'imagecolumn' || column.xtype == 'deletecolumn' || column.xtype == 'linkimagecolumn' ) {//TECH-31705
                    ctrlConfig['role'] = 'gridzoom';
					ctrlConfig['xtype'] = 'ramcofileattach';
					ctrlConfig['srcPath'] = Ext.isEmpty(column.srcPath)?null:column.srcPath;
				    ctrlConfig['saveToDb'] = Ext.isEmpty(column.saveToDb)?false:column.saveToDb;
                    ctrlConfig['autoFileName'] = Ext.isEmpty(column.autoFileName)?true:column.autoFileName;
				    ctrlConfig['rowNo'] = recNo;
				    ctrlConfig['dView'] = Ext.isEmpty(column.dView)?null:column.dView;
				    ctrlConfig['assView'] = Ext.isEmpty(column.assView)?null:column.assView;
					ctrlConfig['hdnFileId'] = Ext.isEmpty(column.hdnFileId)?null:column.hdnFileId;
					ctrlConfig['staticName'] =  Ext.isEmpty(column.staticName)?null:column.staticName;
				    ctrlConfig['srcView'] = column.name;
					if(column.xtype == 'attachcolumn'){
						ctrlConfig['browseIcon'] = true;
						ctrlConfig['delIcon'] = false;
						ctrlConfig['hasLink'] = false;
					}else if(column.xtype == 'deletecolumn'){
						ctrlConfig['browseIcon'] = false;
						ctrlConfig['delIcon'] = true;
						ctrlConfig['hasLink'] = false;
					}else if(column.xtype == 'imagecolumn' || column.xtype == 'linkimagecolumn'){
						ctrlConfig['hasLink'] = Ext.isEmpty(column.hasLink)?null:column.hasLink;
						ctrlConfig['xtype'] = 'ramcoimageattach';
						ctrlConfig['browseIcon'] = false;
						ctrlConfig['delIcon'] = false;
						ctrlConfig['src'] = value;
						if(column.xtype == 'linkimagecolumn')
							ctrlConfig['linkImage'] = true;
						else
							ctrlConfig['linkImage'] = false;
						ctrlConfig['height'] = column.getHeight();
						if(!Ext.isEmpty(column.preventDownload))
								ctrlConfig['preventDownload'] = column.preventDownload;
					}
			        
                } else if (column.xtype == 'linkcolumn') {
                    ctrlConfig['role'] = 'gridzoom';
                    ctrlConfig['xtype'] = 'link';
					ctrlConfig['taskType'] = 'link';
					ctrlConfig['task'] = column.task;
					 ctrlConfig['html'] = value;
					 // AHBG-27296
					ctrlConfig['isModal'] = column.isModal;
					ctrlConfig['textAlign'] = 'left';
                } else {
                    ctrlConfig['xtype'] = 'ramcolabel';
                    ctrlConfig['role'] = 'gridzoom';
                    if (Ext.isString(value) && (value.indexOf('{') == 0 || value.indexOf('[') == 0)) {
                        tmpValue = value ? Ext.decode(value, true) : '';
                        tempid = tmpValue ? tmpValue.tplid : column.config.tplId;
                        if (tempid) {
                            xTpl = ilbo.getTemplate(tempid);
                            if (xTpl && xTpl.isTemplate)
                                value = xTpl.apply(tmpValue);
                        }
                    }
                }
            } else {
                ctrlConfig['xtype'] = editor.xtype;
                ctrlConfig['role'] = 'gridzoom';
				//TECH-31705
                if (column.getFormat()){
					ctrlConfig['format'] = column.getFormat();
					ctrlConfig['decimalPrecision'] = column.config.editor.decimalPrecision;
					ctrlConfig['dataPrec'] = column.config.editor.dataPrec;
					ctrlConfig['maxLength'] = column.config.editor.maxLength;
					ctrlConfig['maxValue'] = column.config.editor.maxValue;
					ctrlConfig['minValue'] = column.config.editor.minValue;
				}
            }

            if (ctrlConfig.xtype == 'combofield') {
                ctrlConfig['bind'] = editor.bind;
                ctrlConfig['queryMode'] = editor.queryMode;
				
				// TECH-30546 / QA-151
				ctrlConfig['typeAhead'] = true;
            }
			ctrlSubConfig ={};
            ctrlSubConfig['xtype'] = 'label';
			  if (name == 'sel')
                ctrlSubConfig['text'] = 'Row Selection';
			else{
				//TECH-36970
				if(RamcoRTC.settings.isExt2 === true){
					if(column.mandatory)
						ctrlSubConfig['cls'] = 'x-grid-inplacezoom-mandatory';
					ctrlSubConfig['text'] = '* '+column.text;
				}
			else
				ctrlSubConfig['text'] = column.text;
			}
			ctrls.push(ctrlSubConfig);
            ctrlConfig['itemId'] = name;
            ctrlConfig['ctrlId'] = itemId;
            ctrlConfig['hasHelp'] = help;
            ctrlConfig['mandatory'] = mandatory ? mandatory : false;
            ctrlConfig['helpIcon'] = (help == true) ? true : false;
			ctrlConfig['helpTaskType'] = (help == true) ?"help":'';
            ctrlConfig['helpTask'] = helptask;
            ctrlConfig['task'] = column.task;
			//ctrlConfig['disabled'] = column.isDisabled()?true:false;
            ctrlConfig['uiTask'] = column.uiTask;
            ctrlConfig['uiTaskType'] = column.uiTaskType;
			//TECH-37120
			ctrlConfig['dataCol'] = column.dataCol;
			if(ctrlConfig.xtype =="ramcolistedit"){//TECH-29761/QA-142
				ctrlConfig['columns'] = editor.columns;
				ctrlConfig['displayField'] = editor.displayField;
				ctrlConfig['mapCtrl'] = editor.mapCtrl;
				ctrlConfig['mappedId'] = editor.mappedId;
				ctrlConfig['mapView'] = editor.mapView;
				ctrlConfig['mappedView'] = editor.mappedView;
				ctrlConfig['searchView'] = editor.searchView;
				ctrlConfig['showAutoList'] = editor.showAutoList;
				ctrlConfig['startIndex'] = editor.startIndex;
				ctrlConfig['valueField'] = editor.valueField;
				ctrlConfig['bind'] = editor.bind;
				ctrlConfig['column'] = column;
				ctrlConfig['syncView'] = column.syncView;
				ctrlConfig['customListEdit'] = column.customListEdit;
				ctrlConfig['hideTrigger'] = editor.hideTrigger?editor.hideTrigger:false;
				if(column.customListEdit){
					ctrlConfig['listIndexSearch'] = editor.listIndexSearch;
					ctrlConfig['searchId'] = editor.searchId;
					ctrlConfig['searchContext'] = editor.searchContext;
					ctrlConfig['position'] = editor.position;
					ctrlConfig['fromView'] = editor.fromView;
				}
			}
			//TECH-28198
			ctrlWidth = ((me.getWidth()) / 4);
			if(column.width > ctrlWidth)
				ctrlConfig['width'] = ((me.getWidth()) / 4);
			else 
				ctrlConfig['width'] = column.width;

			// TECH-28866
			if(column.dataType == 'time' || column.dataType == 'date-time' || column.dataType == 'date') {
				ctrlConfig['value'] = Ext.util.Format.date(value,column.format);
				ctrlConfig['format'] = column.format;
			}
			else
				ctrlConfig['value'] = value;
            ctrlConfig['grow'] = false;
          
            ctrls.push(ctrlConfig);
            i++;
        }
        if (totalRowsCtrl) {
            me.totalRowsCtrl = totalRowsCtrl;
            me.totalRowsCtrl.setData({
                rowno: record.get('rn'),
                totalrow: totalrows
            });
        }
		if (totalRowsCtrlbtm) {
            me.totalRowsCtrlbtm = totalRowsCtrlbtm;
            me.totalRowsCtrlbtm.setData({
                rowno: record.get('rn'),
                totalrow: totalrows
            });
        }
        if (rowNumber) {
            me.rowNumber = rowNumber;
            me.rowNumber.setMinValue(1);
            me.rowNumber.setMaxValue(totalrows);
            me.rowNumber.setValue(record.get('rn'));
        }
		if (rowNumberbtm) {
            me.rowNumberbtm = rowNumberbtm;
            me.rowNumberbtm.setMinValue(1);
            me.rowNumberbtm.setMaxValue(totalrows);
            me.rowNumberbtm.setValue(record.get('rn'));
        }
        if (rowSlider) {
            me.rowSlider = rowSlider;
            me.rowSlider.suspendEvents();
            me.rowSlider.setMinValue(1);
            me.rowSlider.setMaxValue(totalrows);
            me.rowSlider.setValue(recNo);
            me.rowSlider.resumeEvents(true);
        }
		if (rowSliderbtm) {
            me.rowSliderbtm = rowSliderbtm;
            me.rowSliderbtm.suspendEvents();
            me.rowSliderbtm.setMinValue(1);
            me.rowSliderbtm.setMaxValue(totalrows);
            me.rowSliderbtm.setValue(recNo);
            me.rowSliderbtm.resumeEvents(true);
        }
        // TECH-33892
		me.suspendLayouts();
		// TECH-36970
		var gridSize, gridWidth, winColSize = 4, winColWidth = 25;
		if (RamcoRTC.settings.isExt2 == true) {
			gridSize = grid.getSize();
			gridWidth = gridSize && gridSize.width;
			gridWidth = (gridWidth / 3) * 2;
			if(gridWidth >= 900 || !RamcoRTC.settings.isInplaceZoom){
					winColSize = 6;
					winColWidth = parseInt(100 / winColSize);
			}
			else if (gridWidth >= 550) {
				winColSize = 4;
				winColWidth = parseInt(100 / winColSize);
			}
				
		}
		/* else if (RamcoRTC.settings.isExt2 == true && !RamcoRTC.settings.isInplaceZoom) {
			//gridSize = grid.getSize();
			gridWidth = gridSize && gridSize.width;
			if (gridWidth >= 550) {
				winColSize = 6;
				if(gridWidth >= 900)
					winColSize = 8;
			}
			winColSize = 6;
			winColWidth = parseInt(100 / winColSize);
		} */
		var winWidth = me.getWidth(), winHeight = me.getHeight();
		if (winWidth && winHeight) {
			if (RamcoRTC.settings.isExt2 == true && !Ext.isEmpty(gridWidth))
				winWidth += parseInt(gridWidth / 3) - 45;
			if(!RamcoRTC.settings.isExt2)
			me.setSize(winWidth, winHeight);
		}
        me.add({
            xtype: 'container',
            itemId: 'zoomCnt',
            items: ctrls,
			scrollable: true, // TECH-28198
            /* layout: {
                type: 'responsivecolumn',
                states: {
                    small: 600,
                    medium: 1000,
                    large: 0
                }
            } */
			layout: {
                type: 'table',
                columns: winColSize,
					tableAttrs: {
						style: {
							width: '100%',
							padding: '2px'
						}
					},
					tdAttrs: {
						style: {
							//width: '25%'
							width: winColWidth + '%'  //TECH-36970
						}
					}				
            }
        });
		me.resumeLayouts(true);
		//TECH-31705
		me.bindDataToControl(record);
    },
    onRemove: function() {
        if (this.grid) {
            this.grid = null;
            delete this.grid;
        }
    },
    setSliderValue: function(recNo) {
        var me = this,
            grid = me.grid;
		me.index = 	recNo;
        grid.updateSliderPosition(recNo, me);
    },
    processLastAction: function() {
        var me = this,
            grid = me.grid || {},
            store = grid.store || {},
            record = null,
            recNo = 1,
            lastAction = grid.lastAction,
			btnObj, btnId; // ZoomWindow
        if (!lastAction || store.tr == 0)
            return;
        //TECH-36970
		/* if (lastAction == 'prev') {
			btnId = 'zoomPrev';			
            me.down('#zoomPrev').fireEvent('click', me.down('#zoomPrev'));
        } else if (lastAction == 'next') {
            me.down('#zoomNext').fireEvent('click', me.down('#zoomNext'));
        } else if (lastAction == 'slider') {
            me.down('#zoomNext').fireEvent('click', me.down('#zoomNext'));
        } */
		
		/* if (lastAction == 'prev' || lastAction == 'next' ||  lastAction == 'slider') {
			if (lastAction == 'prev')
				btnId = 'zoomPrev';
			else if (lastAction == 'next' || lastAction == 'slider')
				btnId = 'zoomNext';
			btnObj = me.down('#' + btnId);
			if (btnObj)
				btnObj.fireEvent('click', btnObj);
		} */
		 if (lastAction == 'delete') {
            recNo = (store.cr - 1) > 0 ? store.cr - 1 : store.cr + 1
			// TECH-28863
			// me.setSliderValue(store.cr - 1);
            record = store.findRecord('rn', store.cr);
            if (!record)
                record = store.findRecord('rn', 1);
            me.onLoadStore(record);
        } else if (lastAction == 'task') {
            recNo = store.cr;
            me.setSliderValue(store.cr);
            record = store.findRecord('rn', store.cr);
            me.onLoadStore(record);
        } else if (lastAction == 'insert') { // TECH-28863
			recNo = store.cr;
            record = store.findRecord('rn', store.cr);
            me.onLoadStore(record);
        }
        delete grid.lastAction;
    },
    bindDataToControl: function(rec) {
        var me = this,
            key = undefined,
            grid = me.grid,
            store = me.store,
            cnt = me.down('#zoomCnt'),
            items = cnt.items,
            item = null,
            value = null,
            vsi = store.vsi,
            totalrows = store.tr,
            scroller = null,
            gridScroller = null,
            gridSlider = null,
			pageObject = getCurrentPage(),
            i = 0,
            recNo = 0;
        if (Ext.isEmpty(rec)) {
            rec = store.findRecord('rn', vsi);
        }
        if (!rec)
            return;
        recNo = rec.get('rn');
		// AHBG-25813 / TECH-27633
        // me.store.cr = recNo;
        me.store.crIndex = store.indexOf(rec);
        for (; i < items.length; i++) {
            item = items.getAt(i);
            value = rec.get(item.itemId);
            if (Ext.isString(value) && (value.indexOf('{') == 0 || value.indexOf('[') == 0)) {
                tmpValue = value ? Ext.decode(value, true) : '';
                tempid = tmpValue ? tmpValue.tplid : column.config.tplId;
                if (tempid) {
                    if (pageObject.templates && pageObject.templates[tempid]) {
                        tpl = pageObject.templates[tempid];
                        ctrlConfig['tpl'] = new Ext.XTemplate(tpl);
                        value = tmpValue;
                    }
                }
            }

			// TECH-28866
			if(Ext.isDate(value)) 
				value = Ext.util.Format.date(value, item.format);

			if(typeof item.setValue == "function") {
				item.suspendEvents();
				//TECH-31705
				if(item.xtype == "ramcoimageattach" && !Ext.isEmpty(pageObject.down('uigridzoom'))){
					item.setSrc(value);
				}else 
					item.setValue(value);
				item.resumeEvents();
			}
			else if(item.xtype == 'link'){
				// TECH-28866
				// item.setHtml(value);
				item.setText(value);
				// AHBG-25813 / TECH-27633
				item.addCls('x-link-inner-default-small');
			}	
			
        }
        if (me.totalRowsCtrl) {
            me.totalRowsCtrl.setData({
                rowno: recNo,
                totalrow: totalrows
            });
        }
        if (me.rowNumber) {
            me.rowNumber.setMinValue(1);
            me.rowNumber.setMaxValue(totalrows);
            me.rowNumber.setValue(recNo);
        }
		if (me.rowNumberbtm) {
            me.rowNumberbtm.setMinValue(1);
            me.rowNumberbtm.setMaxValue(totalrows);
            me.rowNumberbtm.setValue(recNo);
        }
        if (me.rowSlider) {
            me.rowSlider.suspendEvents();
            me.rowSlider.setMinValue(1);
            me.rowSlider.setMaxValue(totalrows);
            me.rowSlider.setValue(recNo);
            me.rowSlider.resumeEvents(true);
            scrollbar = grid.getDockedComponent('gridScroller');
            if (scrollbar) {
                gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null;
                if (gridSlider)
                    gridSlider.setValue(recNo);
            }
        }
		if (me.rowSliderbtm) {
            me.rowSliderbtm.suspendEvents();
            me.rowSliderbtm.setMinValue(1);
            me.rowSliderbtm.setMaxValue(totalrows);
            me.rowSliderbtm.setValue(recNo);
            me.rowSliderbtm.resumeEvents(true);
            scrollbar = grid.getDockedComponent('gridScroller');
            if (scrollbar) {
                gridSlider = scrollbar ? scrollbar.getComponent('gridSlider') : null;
                if (gridSlider)
                    gridSlider.setValue(recNo);
            }
        }
		//TECH-28873
		//me.focus();
		var count = me.query('field[editable][itemId!="rowNav"][itemId!="fieldList"][itemId!="fieldSearch"]');
		if(count && count[1])
			count[1].focus();
    },
	//TECH-28871
	close: function () {
		var me = this,
			ilbo = me.up('ilbo'),
			controller = ilbo ? ilbo.controller: '';
			if(controller && controller.errors && controller.errors.length > 0) {
				Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R044, Ext.emptyFn, undefined, 'error');
				return;
			} else {
				me.doClose();
			}
	}
});

// Help Window
Ext.define('Ext.ramco.HelpWindow', {
    extend: 'Ext.window.Window',
    xtype: 'ramcohelpwindow',
    closeAction: 'hide',
    winType: 'help',
    layout: 'card',
	autoDestroy: false,
    pageIndex: 0,
    pageArr: {},
    initComponent: function(cfg) {
        var me = this,
            baseId = me.id,
            i, button;
        me.BtnOk = new Ext.button.Button({
            text: rvw_resources.R102
        });
        me.BtnOk.on('click', me.onBtnOkClick, me);
        me.bottomTb = new Ext.toolbar.Toolbar({
            id: baseId + '-toolbar',
            ui: 'footer',
            dock: 'bottom',
            layout: {
                pack: 'center'
            },
            items: [me.BtnOk]
        });
		me.keyMap['K'] = [{
			scope: 'this',
			event: 'keydown',
			key: [75],
			charCode: 75,
			ctrlKey: true,
			altKey: true,
			handler: 'onEnter'
		}];
        me.dockedItems = [me.bottomTb];
        me.on('close', me.onClose, me);
        me.callParent();
    },
	onEnter:function(e) {
		var me = this;
		me.BtnOk.fireEvent('click', me.BtnOk);		
	},
    addComponent: function(cmp) {
        var me = this,		
			printBar = me.down('#helpPrint');
		
		if (printBar) {
			if (cmp.hidePrint == false)
				printBar.show();
			else
				printBar.hide();
		}
        if (!me.pageArr[cmp.tempId]) {
            me.pageIndex++;
            me.pageArr[cmp.tempId] = true;
        }        
        me.ilboComponent = cmp;
        me.add([cmp]);
        this.fireEvent('addPage', me, cmp);
		//TECH-30196
		/*if (me.down('#helpCancel')) {
            if (me.pageIndex <= 1) {
                me.down('#helpCancel').hide();
            } else {
                me.down('#helpCancel').show();
            }
        }*/
    },
	//TECH-30196
	checkCancel: function() {
		var me = this;
		if (me.down('#helpCancel')) {
            if (me.pageIndex <= 1) {
                me.down('#helpCancel').hide();
            } else {
                me.down('#helpCancel').show();
            }
        }
	},
    removeAllComponent: function(isDestroy) {
        var me = this;
		//TECH-30196
        /*if (me.down('#helpCancel')) {
            if (me.pageIndex <= 1) {
                me.down('#helpCancel').hide();
            } else {
                me.down('#helpCancel').show();
            }
        }*/
        return me.removeAll(isDestroy);
    },
    addTools: function() {
        var me = this,
            tools = [];

        // Call Panel's addTools
        me.callParent();
        tools.push({
            type: 'empty x-fa fa-long-arrow-left',
            itemId: 'helpCancel',
            tooltip: rvw_resources.R084,
            hidden: true,
            text: '',
            handler: me.cancel.bind(me)
        });
        tools.push({
            itemId: 'btnHelpSave',
            type: 'empty x-fa fa-floppy-o',
            hidden: true,
            tooltip: rvw_resources.R183,
            text: '',
            handler: me.btnHelpSave.bind(me)
        });
        tools.push({
            itemId: 'btnHelpClear',
            type: 'empty x-fa fa-eraser',
            hidden: true,
            tooltip: rvw_resources.R099,
            text: '',
            handler: me.btnHelpClear.bind(me)
        });
        tools.push({
            itemId: 'btnHelpCancl',
            type: 'empty x-fa fa-times',
            hidden: true,
            tooltip: rvw_resources.R103,
            text: '',
            handler: me.btnHelpCancl.bind(me)
        });
        tools.push({
            itemId: 'btnHelpPreference',
            //type: 'empty x-fa fa-cogs',
            type: 'empty tech-preference_mode', // AHBG-31969
			hidden: (RamcoRTC.settings.hidePersonalisation === true) ? true : false,
            tooltip: rvw_resources.R173,
            handler: me.btnHelpPreference.bind(me)
        });
        tools.push({
            type: 'print',
            itemId: 'helpPrint',
			hidden: true,
            tooltip: rvw_resources.R082,
            handler: me.print.bind(me)
        });
        tools.push({
            type: 'refresh',
            handler: me.refresh.bind(me)
        });
        tools.push({
            type: 'help',
            handler: me.help.bind(me)
        });
        if (tools.length) {
            me.addTool(tools);
        }
    },
    cancel: function() {
        var me = this;
        me.fireEvent('cancel', me, me.pageIndex);
        me.backbutton = true;
        //this.fireEvent('removePage', me);
        me.backbutton = false;
    },
	print: function() {
        var me = this;
        me.fireEvent('print', me);
    },
    refresh: function() {
        this.fireEvent('refresh', this);
    },
    help: function(btn) {
        this.fireEvent('help', this);
    },
    onBtnOkClick: function(btn) {
        this.fireEvent('transfer', this, this.ilboComponent, btn);
    },
    btnHelpPreference: function() {
        this.fireEvent('Preference', this.tools[4]);
    },
    btnHelpCancl: function() {
        this.fireEvent('cancl', this.tools[3]);
    },
    btnHelpSave: function() {
        this.fireEvent('save', this.tools[1]);
    },
    btnHelpClear: function() {
        this.fireEvent('clear', this.tools[2]);
    },
    onClose: function(btn) {
        var me = this,
			//e = event,
			ilboName = '',
            btnPref = btn.down('#btnHelpSave');
		if(me.ilboComponent && me.ilboComponent.ilboConfig)
			ilboName = me.ilboComponent.ilboConfig.ilboName;
		if(RamcoRTC.reader.uiCtrlArray && !Ext.isEmpty(RamcoRTC.reader.uiCtrlArray[ilboName])) {
			RamcoRTC.reader.uiCtrlArray[ilboName] = null;
			delete RamcoRTC.reader.uiCtrlArray[ilboName];
		}
		//if(e && (e.type == 'click' || e.type == 'mouseup'))
			//btn.isClose = true;
        if (btnPref)
            btnPref.hide();
        btnPref = btn.down('#btnHelpClear');
        if (btnPref)
            btnPref.hide();
        btnPref = btn.down('#btnHelpCancl');
        if (btnPref)
            btnPref.hide();
        me.fireEvent('windowclose', me, btn, 'tskstdgo', 'trans');
        me.pageIndex = 0;
    },
	onEsc: function(e) {
		this.isClose = true;
		this.close();
    }
});

Ext.define('Ext.ramco.SmartWindow', {
    extend: 'Ext.window.Window',
    xtype: 'ramcosmartwindow',
	closeAction: 'hide',
	alwaysOnTop:true,//AHBG-31896
	autoDestroy: false,
	initEvents: function() {
		var me = this;
		if(me.body) {
			me.body.on('click', me.smartItemClick, me);
		}                
    },
	smartItemClick: function(e, target) {
		var me = this,
			taskInfo,
			attributes,
			el,
			args,
			elDom;
		if(target.hasAttribute('taskinfo')) {
			el = Ext.fly(target);
			if (!Ext.isEmpty(el))				
				attributes = el.getAttributes();
		}
		else {
			el = Ext.fly(target);
			elDom = el.up('div[taskinfo]');
			if(elDom) {
				attributes = elDom.getAttributes();				
			}
		}
		if(attributes)
			taskInfo = attributes['taskinfo'];
		if (taskInfo) {
			args = ['uitask', me.curView, []];
			args = args.concat(TaskInfoToObjectArray(taskInfo));
			while (args.length < 10) {
				args[args.length] = null;
			}               
			me.curView.fireEvent.apply(me.curView, args);
			return true;
		}
	},
	onEsc: function(e) {		
		this.hide();
    }
});
	

// Modal Window
Ext.define('Ext.ramco.ModalWindow', {
    extend: 'Ext.window.Window',
    xtype: 'ramcomodalwindow',
    closeAction: 'hide',
    winType: 'modal',
    resizable: false,
    pageIndex: 0,
	autoDestroy: false,
    pageArr: {},
    layout: 'card',
    //layout: {type:'vbox',align:'stretch'},
    initComponent: function(cfg) {
        var me = this,
            baseId = me.id,
            i, button;
        me.on('hide', me.onClose, me);
        me.callParent();
    },
    addComponent: function(cmp) {
        var me = this,
			mCancel = me.down('#modalCancel'),		
			printBar = me.down('#modalPrint');
		
		if (printBar) {
			if (cmp.hidePrint == false)
			printBar.show();
			else
				printBar.hide();
		}
        if (me.childWidth) {
            cmp.setWidth(me.childWidth - 30);
            cmp.width = me.childWidth - 30;
        }
        me.oldChildWidth = me.childWidth;
        me.oldChildHeight = me.childHeight;        
        me.ilboComponent = me.add(cmp);
        this.fireEvent('addPage', me, cmp);
		//TECH-30196
		/*if(mCancel)
			mCancel.hide();
		if (me.pageIndex >= 2) {
			me.down('#modalCancel').show();
        }*/
    },
    removeAllComponent: function(isDestroy) {
        var me = this;
		//TECH-30196
        /*if (me.down('#modalCancel')) {
            if (me.pageIndex <= 1) {
                me.down('#modalCancel').hide();
            } else {
                me.down('#modalCancel').show();
            }
        }*/
        return me.removeAll(isDestroy);
    },
    addTools: function() {
        var me = this,
            tools = [];

        // Call Panel's addTools
        me.callParent();
        tools.push({
            type: 'empty x-fa fa-long-arrow-left',
            itemId: 'modalCancel',
            tooltip: rvw_resources.R084,
            hidden: true,
            text: '',
            handler: me.cancel.bind(me)
        });
		
		// TECH-40634
		tools.push({
            itemId: 'btnModalSave',
            type: 'empty x-fa fa-floppy-o',
            hidden: true,
            tooltip: rvw_resources.R183,
            text: '',
            handler: me.btnModalSave.bind(me)
        });
        tools.push({
            itemId: 'btnModalClear',
            type: 'empty x-fa fa-eraser',
            hidden: true,
            tooltip: rvw_resources.R099,
            text: '',
            handler: me.btnModalClear.bind(me)
        });
        tools.push({
            itemId: 'btnModalCancl',
            type: 'empty x-fa fa-times',
            hidden: true,
            tooltip: rvw_resources.R103,
            text: '',
            handler: me.btnModalCancl.bind(me)
        });
        tools.push({
            itemId: 'btnModalPreference',
            type: 'empty tech-preference_mode',
			hidden: (RamcoRTC.settings.hidePersonalisation === true) ? true : false,
            tooltip: rvw_resources.R173,
            handler: me.btnModalPreference.bind(me)
        });
		
        tools.push({
            type: 'refresh',
            itemId: 'modalRefresh',
			tooltip: rvw_resources.R083,
            handler: me.refresh.bind(me)
        });
        tools.push({
            type: 'print',
            itemId: 'modalPrint',
			hidden: true,
            tooltip: rvw_resources.R082,
            handler: me.print.bind(me)
        });
		// TECH-27458 - Modal level Smartbar
		tools.push({
            itemId: 'modalSmartBar',
			type:'empty x-fa fa-list-alt',//AHBG-31896
			hidden: true,
            tooltip: rvw_resources.R290,
            handler: me.smartbar.bind(me)
        });
        tools.push({
            type: 'help',
            itemId: 'modalHelp',
			tooltip: rvw_resources.R086,
            handler: me.help.bind(me)
        });
        if (tools.length) {
            me.addTool(tools);
        }
    },
    cancel: function() {
        var me = this;
        me.fireEvent('cancel', me, me.pageIndex);
        if (me.ilboComponent && me.pageArr[me.ilboComponent.tempId]) {
            delete me.pageArr[me.ilboComponent.tempId];
            me.pageIndex--;
        }
        if (me.pageIndex <= 1) {
            me.down('#modalCancel').hide();
        } else {
            me.down('#modalCancel').show();
        }                       
    },
	//TECH-30196
	checkCancel: function() {
		var me = this;
		if (me.down('#modalCancel')) {
            if (me.pageIndex <= 1) {
                me.down('#modalCancel').hide();
            } else {
                me.down('#modalCancel').show();
            }
        }
	},
    refresh: function() {
        var me = this;
        me.childWidth = me.oldChildWidth;
        me.childHeight = me.oldChildHeight;
        me.fireEvent('refresh', me);
    },
	
	// TECH-40634
	btnModalPreference: function() {
        this.fireEvent('preference', this.tools[4]);
    },
    btnModalCancl: function() {
        this.fireEvent('cancl', this.tools[3]);
    },
    btnModalSave: function() {
        this.fireEvent('save', this.tools[1]);
    },
    btnModalClear: function() {
        this.fireEvent('clear', this.tools[2]);
    },
	
    print: function() {
        var me = this;
        me.fireEvent('print', me);
    },
    help: function(btn) {
        this.fireEvent('help', this);
    },
	// TECH-27458 - Modal level Smartbar
	smartbar: function(btn) {
        this.fireEvent('smartbar', this);
    },
    onClose: function(btn) {
        var me = this,
			ilboName = '';
		if(me.modalClose === true || me.winType == "smartview" || (me.ilboComponent && me.ilboComponent.modalClose === true)) {
			btn.isClose = true;
			delete me.modalClose;
			delete me.ilboComponent.modalClose;
		}
		if(me.ilboComponent && me.ilboComponent.ilboConfig)
			ilboName = me.ilboComponent.ilboConfig.ilboName;
		if(RamcoRTC.reader.uiCtrlArray && !Ext.isEmpty(RamcoRTC.reader.uiCtrlArray[ilboName])) {
			RamcoRTC.reader.uiCtrlArray[ilboName] = null;
			delete RamcoRTC.reader.uiCtrlArray[ilboName];
		}
        me.oldChildWidth = null;
        me.oldChildHeight = null;
		//TECH-32118
		me.childWidth = null;
		me.childHeight = null;
        me.fireEvent('windowclose', me, btn, 'tskstdcancel', 'trans');
        me.pageIndex = 0;
        me.pageArr = [];
        me.removeAllComponent(true);
    },
	onEsc: function(e) {
		this.isClose = true;
		this.hide();
    }
});

// Report Window
Ext.define('Ext.ramco.ReportWindow', {
    extend: 'Ext.window.Window',
    xtype: 'ramcoReportwindow',
	autoDestroy: false,
    layout: 'fit',
    items: [{
        xtype: 'uxiframe',
        itemId: 'iframeCmp'
    }],
    loadSrc: function(src) {
        var me = this,
            iframeCmp = me.getComponent('iframeCmp');
        if (iframeCmp) {
            iframeCmp.load(src);
        }
    }
});

Ext.define('Ext.data.operation.Search', {
    extend: 'Ext.data.operation.Operation',
    alias: 'data.operation.search',    
    action: 'search', 
    isReadOperation: true,    
    config: {
        filters: undefined,
        sorters: undefined,
        grouper: undefined,
        start: undefined,
        limit: undefined,
        page: undefined,
        addRecords: false
    },
    doExecute: function() {
        return this.getProxy().search(this);
    },
    doProcess: Ext.emptyFn, 
    allowWrite: function() {
        return false;
    }
});

Ext.define('Ext.o.data.proxy.Server', {
	override: 'Ext.data.proxy.Server',
	search: function() {
        return this.doRequest.apply(this, arguments)
    }
});

Ext.define('Ext.o.data.ProxyStore', {
    override: 'Ext.data.ProxyStore',
	 flushSearchLoad: function() {
        var me = this,
            //options = me.pendingLoadOptions,
			options = {},
            operation;
        
        if (me.destroying || me.destroyed) {
            return;
        }        
        me.clearLoadTask();
        if (!options) {
            return;
        } 
        me.setLoadOptions(options);
        if (me.getRemoteSort() && options.sorters) {
            me.fireEvent('beforesort', me, options.sorters);
        }
        operation = Ext.apply({
            internalScope: me,
            internalCallback: me.onProxyLoad,
            scope: me
        }, options);
        me.lastOptions = operation;         
        operation = me.createOperation('search', operation);
        if (me.fireEvent('beforeload', me, operation) !== false) {
            me.onBeforeLoad(operation);
            me.loading = true;
            operation.execute();
        }
    }
});

Ext.define('Ext.o.data.proxy.Ajax', {
    override: 'Ext.data.proxy.Ajax',
	doRequest: function(operation) {
		var me = this,			
			prxy = operation.getProxy();
		prxy.extraParams.act = prxy.lastAction;
		if (prxy.lastAction == "gridsearch" || prxy.lastAction == "setSearchData") {
			Ext.apply(prxy.config.actionMethods.__proto__, {search: 'GET'});			
			prxy.extraParams.srval = prxy.searchValue;
			prxy.extraParams.srIdx = prxy.searchIndex;
		}
		else {			
			delete prxy.extraParams.srval;
			delete prxy.extraParams.srIdx;
		}
		if(prxy.headers)
			prxy.headers.Requid = RamcoRTC.sessionToken;
		else
			prxy.setHeaders("Requid",RamcoRTC.sessionToken);
		me.callParent(arguments);
	}
});

// ML Expand Window
Ext.define('Ext.ramco.MLExpandWindow', {
    extend: 'Ext.window.Window',
    xtype: 'ramcouigridexpand',
    closeAction: 'destroy',
    winType: 'mlexpand',
	userCls: 'x-mlexpand-win',
	title: 'Expanded Grid Window',	
    resizable: false,    
	//height: '100%',
	//width: '100%',
	//autoDestroy: false,    
    layout: 'card',
	/*constructor: function (config) {
		this.cfgGrid = config.cfgGrid;
		this.viewCfg = config.viewcfg;
		this.callParent();
    },*/
    initComponent: function() {
        var me = this,
			items = null,
			colWidth = 0,
			expGridBuffStore = null,
			colManager = this.cfgGrid.getColumnManager(),
			colMgrCol = colManager.getColumns(),
			lstColumn = null,
			colLen = (colMgrCol) ? colMgrCol.length : 0,
			columns = this.cfgGrid.initialConfig.columns,
			cl = 0,
			expGridStore = {},
			apiExtensionEx = ".ashx", // TECH-29466
			fields = this.cfgGrid.store.initialConfig.fields;
			for (cl = 0; cl < colLen; cl++) {
				colStatus = colMgrCol[cl].isVisible();
				colWidth = colMgrCol[cl].width;
				columns[cl].hidden = !colStatus;
				if(colStatus) {
					lstColumn = columns[cl];
					if (lstColumn.forceFit)
						lstColumn.visibleLength = colWidth;
				}
			}
			if (lstColumn && !lstColumn.forceFit) {
				//lstColumn.flex = 1;
				lstColumn.minWidth = colWidth;
			}
			expGridStore.id = this.cfgGrid.itemId + '_buffStr';
			expGridStore.fields = fields;
			expGridStore.expGridStore = true;
			expGridStore.pageSize = 25;
			expGridStore.currentPage = Math.ceil(this.cfgGrid.store.vsi / expGridStore.pageSize);
			//expGridStore.defaultViewSize = 25;
			expGridStore.autoLoad = true;
			//expGridStore.autoSync = true;
			//expGridStore.clearOnPageLoad = true;
			//expGridStore.leadingBufferZone = 0;
			//expGridStore.trailingBufferZone = 0;
			//expGridStore.buffered = true;

			// TECH-29466
			if(RamcoRTC.osType == "JAVA")
				apiExtensionEx = ".jsp";

			expGridStore.proxy = {
				type: 'ajax',
				pstoreid: expGridStore.id,				
				timeout: 600000,
				//url: './ilrt/GetGridData.ashx',
				// TECH-29466
				 api:{
					 /* create  : './ilrt/CreateGridData.ashx',
					 read    : './ilrt/GetGridData.ashx',
					 update  : './ilrt/UpdateGridData.ashx',
					 search	 : './ilrt/SearchGridData.ashx',
					 destroy : './ilrt/DeleteGridData.ashx'*/
					 create  : './ilrt/CreateGridData' + apiExtensionEx,
					 read    : './ilrt/GetGridData' + apiExtensionEx,
					 update  : './ilrt/UpdateGridData' + apiExtensionEx,
					 search	 : './ilrt/SearchGridData' + apiExtensionEx,
					 destroy : './ilrt/DeleteGridData' + apiExtensionEx
				 },
				//format :'ashx',
				headers: {'Requid': RamcoRTC.sessionToken},
				extraParams: {
					al: this.viewcfg.activityName,
					il: this.viewcfg.ilboName,
					ct: this.cfgGrid.itemId					
				},
				reader: {
					//type: 'json',
					rootProperty: 'rows',
					totalProperty: 'tr'
				},
				writer: {
					type: 'xml'
				},
				listeners: {
					endprocessresponse: function (proxy, response, operation) {
						var requid = response.getResponseHeader("Requid"),
							rn = response.getResponseHeader("rn"),
							vw = response.getResponseHeader("vw"),
							ilbo = getCurrentPage(),
							grid = null,
							store = null,
							expWindow;
						store = Ext.StoreManager.lookup(proxy.pstoreid);						
						grid = ilbo.getControl(store.storeId.replace('_buffStr', '-expanded'));
						RamcoRTC.sessionToken = requid;
						//TECH-30629
						if (grid) {
							expWindow = grid.up('window');
						}
						//TECH-30629
						//if (proxy.lastAction == "copyappend" || proxy.lastAction == "cutappend" || proxy.lastAction == 'gridsearch' || proxy.lastAction == 'setSearchData') {
						if (proxy.lastAction == "copyappend" || proxy.lastAction == "cutappend" || proxy.lastAction == 'gridsearch' || proxy.lastAction == 'setSearchData' || proxy.lastAction == 'onexpgridclose') {
							if (proxy.lastAction == 'setSearchData') {
								if (grid) {									
									proxy.lastAction = '';
									grid.searchIndex = null;
									grid.doSearch();
								}
							}
							else if (proxy.lastAction == 'gridsearch') {
								if (store) {									
									store.loadPage(Math.ceil(rn / 25));
									proxy.lastAction = 'setSearchData';
								}								
							}
							//TECH-30629
							else if (grid && proxy.lastAction == 'onexpgridclose') {
								proxy.lastAction = ''
								if (expWindow) {
									expWindow.close();
								}
							}
							else {
								proxy.lastAction = '';
								if (store) {
									store.reload();
								}
							}
						}
					},
					write: function(store, operation){
						var record = operation.getRecords()[0],
							name = Ext.String.capitalize(operation.action),
							verb;
						if (name == 'Destroy') {
							verb = 'Destroyed';
						} else {
							verb = name + 'd';
						}
						Ext.toast(name, Ext.String.format("{0} user: {1}", verb, record.getId()));
					}
				}
			};
		expGridStore.listeners = {
			beforeload :function(store, operation, eOpts) {
				var prxy = operation.getProxy();
					prxy.headers.Requid = RamcoRTC.sessionToken;					
			}
		};
		expGridBuffStore = Ext.create('Ext.data.Store', expGridStore);		
		//expGridBuffStore = new Ext.data.Store(expGridStore);
		//expGridBuffStore = new Ext.data.BufferedStore(expGridStore);
		me.expGrid = Ext.create('Ext.ramco.ExpGridPanel',{
			role:'uipage',
			store: expGridBuffStore,			
			//visibleRows: 50,
			// viewConfig: {
				// scrollable: {
					// x: 'auto',
					// y: true
				// }
			// },
			columns: columns,
			rowLines: true,
			parentMl: this.cfgGrid,
			itemId: this.cfgGrid.itemId + '-expanded'
        });
		me.items =[me.expGrid];
        //TECH-30629	
		me.on('hide', me.onClose, me);		
		me.callParent();
		//TECH-30629
		var expStore = me.expGrid.getStore();
        if (expStore) {
            me.mon(expStore, {                
                update: me.onDataUpdate,
                scope: me
            });
        }		
		//me.add(me.expGrid);
    },
    //TECH-30629	 
	onDataUpdate: function(store, record, operation, modField, details, eOpts) {
        var me = this;
        if (record.data.isNew == true && modField && modField[0] != 'sel') {
            if (me.expGrid.edited) {				
                record.data.isNew = false;
				me.expGrid.store.totalCount += 1;
                me.expGrid.createDummyRecord();				
            }
        }
    },
    removeAllComponent: function(isDestroy) {
        var me = this;        
        return me.removeAll(isDestroy);
    },
    addTools: function() {
        var me = this,
            tools = [];

        // Call Panel's addTools
        me.callParent();
        tools.push({
            type: 'refresh',
            itemId: 'modalRefresh',
			tooltip: rvw_resources.R083,
            handler: me.refresh.bind(me)
        });        
        if (tools.length) {
            me.addTool(tools);
        }
    },    
    refresh: function() {
        //TECH-30682
		var me = this;
		me.expGrid.store.reload();        
    },
	//TECH-30629
	onBeforeHide: function() {		
		if (this.hasUpdateRequestCalled){
			delete this.hasUpdateRequestCalled;
			return true;
		}
		var me = this,
			expGridAction = {},
			start,
			end,
			vsi,
			rec = me.expGrid.store.getModifiedRecords();
		if (rec.length > 0) {
			me.hasUpdateRequestCalled = true;
			me.expGrid.store.proxy.lastAction = "onexpgridclose";		
			me.expGrid.store.sync();		
			return false;
		}
	},
    onClose: function(btn) {
		//TECH-30629
		var me = this,
			start = (me.expGrid.store.totalCount - me.expGrid.parentMl.visibleRows) + 1,
			end = me.expGrid.store.totalCount,
			vsi = start,
			rec = me.expGrid.store.getModifiedRecords();
		if (rec.length > 0) {
			RamcoRTC.focusCtrl[1] = me.expGrid.parentMl.getItemId();
			RamcoRTC.focusCtrl[2] = start;
			me.expGrid.parentMl.lastEvent = "onlast";
			me.expGrid.parentMl.fireEvent('movetorow', me.expGrid.parentMl, start, end, vsi);
		}
    },
	doDestroy: function() {
		var me = this,
			expGrid = me.expGrid,
			store = expGrid.store,
			parentML = expGrid.parentMl,
			currPage = store.currentPage,
			pageSize = store.getPageSize(),
			startIndex = ((currPage - 1) * pageSize) + 1;			
			me.cfgGrid.isMlExpand = false;
		if (!(parentML.isDestroyed || parentML.isDestroying)){
			if (Ext.isEmpty(expGrid.lastEventType)){
				parentML.onMoveRowNum(startIndex);	
			}
		}
		me.callParent();	
	},
	onEsc: function(e) {
		this.isClose = true;
		this.hide();
    }
});
// ML Tree Expand Window
Ext.define('Ext.ramco.MLTreeExpandWindow', {
    extend: 'Ext.window.Window',
    xtype: 'ramcouitreegridexpand',
    closeAction: 'destroy',
    winType: 'mltreeexpand',
	userCls: 'x-ml-tree-expand-win',
	title: 'Expanded Tree Grid Window',	
    resizable: false,    
	layout: 'card',
	initComponent: function() {
        var me = this,
			items = null,
			colWidth = 0,			
			colManager = this.cfgGrid.getColumnManager(),
			colMgrCol = colManager.getColumns(),
			lstColumn = null,
			colLen = (colMgrCol) ? colMgrCol.length : 0,
			columns = this.cfgGrid.initialConfig.columns,
			cl = 0,
			expGridStore = {},
			fields = this.cfgGrid.store.initialConfig.fields;
		for (cl = 0; cl < colLen; cl++) {
			colStatus = colMgrCol[cl].isVisible();
			colWidth = colMgrCol[cl].width;
			columns[cl].hidden = !colStatus;
			if(colStatus) {
				lstColumn = columns[cl];
				if (lstColumn.forceFit)
					lstColumn.visibleLength = colWidth;
			}
		}
		if (lstColumn && !lstColumn.forceFit) {			
			lstColumn.minWidth = colWidth;
		}		
		me.expGrid = Ext.create('Ext.ramco.RSTreeGridPanel',{
			role:'uipage',
			store: this.cfgGrid.store,						
			enableTreeDD: this.cfgGrid.enableTreeDD,
			columns: columns,
			reqBorder: true,
			columnLines: true,
			rowLines: true,
			mlExpFlag: false,
			insertFlag: this.cfgGrid.config.insertFlag,
			deleteFlag: this.cfgGrid.config.deleteFlag,
			parentMl: this.cfgGrid,
			itemId: this.cfgGrid.itemId + '-tree-expanded'
        });
		me.items =[me.expGrid];
		me.callParent();		
    },
    removeAllComponent: function(isDestroy) {
        var me = this;        
        return me.removeAll(isDestroy);
    },
    addTools: function() {
        var me = this,
            tools = [];

        // Call Panel's addTools
        me.callParent();
        tools.push({
            type: 'refresh',
            itemId: 'modalRefresh',
			hidden: true,
			tooltip: rvw_resources.R083,
            handler: me.refresh.bind(me)
        });        
        if (tools.length) {
            me.addTool(tools);
        }
    },    
    refresh: function() {
        
    },    
    onClose: function(btn) {		
		
    },
	doDestroy: function() {
		var me = this,
			expGrid = me.expGrid,
			store = expGrid.store,
			parentML = expGrid.parentMl,
			currPage = store.currentPage,
			pageSize = store.getPageSize(),
			startIndex = ((currPage - 1) * pageSize) + 1;			
			me.cfgGrid.isMlExpand = false;
		// if (Ext.isEmpty(expGrid.lastEventType))
			// parentML.onMoveRowNum(startIndex);		
		me.callParent();	
	},
	onEsc: function(e) {
		this.isClose = true;
		this.hide();
    }
});

Ext.define("Ext.ramco.Gauge", {
    extend: 'Ext.container.Container',
    alias: 'widget.completionchart',
	viewType: 'ramcogaugectrl',
	trackStart: 270,
	trackLength: 360,
	width: 150,
	height: 150,	
    fillColor: '#D3D3D3',
    fontSize: '20',
    percentage: 0,
    fallbackPercentage: null,
    barColor: '#ef1e25',
    trackColor: '#f9f9f9',
    scaleColor: '#dfe0e0',
    scaleLength: 5,
    lineCap: 'round',
    lineWidth: 10,
    animate: {
        duration: 1000,
        enabled: true
    },	
    easing: 'easeOutBounce',
    cData: null,
	value: 0,	
	initComponent: function() {
        var me = this,			
        viewConfig = {
			innerStyle: {
				outerRadius:'100%',
				innerRadius:'100% - '+ me.lineWidth,
				round: true
			},
			trackStyle: {
				outerRadius: '100%',
				innerRadius: '100% - '+ me.lineWidth,
				round: true
			},
			valueStyle: {
				outerRadius: '100% - 2',
				innerRadius: '100% - '+ (parseInt(me.lineWidth, 10) - 2),
				round: false
			},
			innerArc: null,
            xtype: me.viewType
        };
        me.view = view = Ext.create(viewConfig);
		me.items = [view];
		me.callParent();
	},
	setFallbackData: function(data) {
		var me = this;
		me.view.updateGaugeData('', data, me.value);
	},
	setConfigData: function(data) {                 
		var me = this;
			me.view.updateGaugeData(data, '', me.value);
	},
	setValueData: function(value) {
		var me = this;
			me.value = value;
			me.view.updateGaugeData('', '', me.value);
	}
});

Ext.define('Ext.ramco.GaugeCtrl', {
	extend: 'Ext.ux.Gauge',
	xtype: 'ramcogaugectrl',
	trackStart: 270,
	trackLength: 360,
	width: 150,
	height: 150,	
	config: {
		innerStyle: {
			outerRadius:'100%',
			innerRadius:'100% - 20',
			round: false
		},
		innerArc: null
	},
	setValueData: function(value) {
		var me = this;
			me.setValue(value);
	},
	getInnerArc: function() {
		var me = this,
            innerArc = me.innerArc;        
        if (!innerArc) {
            innerArc = me.innerArc = document.createElementNS(me.svgNS, 'path');
            me.getSvg().append(innerArc);            
            innerArc.setAttribute('class', Ext.baseCSSPrefix + 'gauge-inner');
        }        
        return innerArc;
	},	
	applyInnerStyle: function (innerStyle) {
        var me = this,
            trackGradient; 
        innerStyle.innerRadius = me.getRadiusFn(innerStyle.innerRadius);
        innerStyle.outerRadius = me.getRadiusFn(innerStyle.outerRadius); 
        if (Ext.isArray(innerStyle.fill)) {
            trackGradient = me.getTrackGradient();
            me.setGradientStops(trackGradient, innerStyle.fill);
            innerStyle.fill = 'url(#' + trackGradient.getAttribute('id') + ')';
        } 
        return innerStyle;
    },   	
	updateValueStyle: function (valueStyle) {
       var me = this,
           valueArc = Ext.fly(me.getValueArc()), name; 
		   valueStyle.fill = me.barColor;
       for (name in valueStyle) {
           if (name in me.pathAttributes) {
               valueArc.setStyle(me.camelToHyphen(name), valueStyle[name]);
           }
       }
    },
	updateTrackStyle: function (trackStyle) {
        var me = this,
            trackArc = Ext.fly(me.getTrackArc()), name;
			trackStyle.fill = me.trackColor;
        for (name in trackStyle) {
            if (name in me.pathAttributes) {
                trackArc.setStyle(me.camelToHyphen(name), trackStyle[name]);
            }
        }
    },
	updateInnerStyle: function (innerStyle) {
        var me = this,
            innerArc = Ext.fly(me.getInnerArc()), name;
			innerStyle.fill = me.scaleColor || "#d3d3d3";
        for (name in innerStyle) {
            if (name in me.pathAttributes) {
                innerArc.setStyle(me.camelToHyphen(name), innerStyle[name]);
            }
        }
    },		
	updateGaugeData: function(configData, fallbackData, value) {
		var me = this;
		if(!Ext.isEmpty(configData)) {
			me.setViewConfigData(configData);
		}
		if(!Ext.isEmpty(fallbackData)) {
			me.setViewFallbackData(setFallbackData);
		}
		me.setValue(value);
	},
	setViewConfigData: function(data) {
		var me = this,
			valueStyle,
			aniCfg = me.getAnimation(),
			trackStyle;	
			size = me.getSize(),
			cData = Ext.decode(data)[0];			
			me.barColor = cData.barColor;
			me.trackColor = cData.trackColor;
			me.scaleColor = cData.scaleColor;
			if (!Ext.isEmpty(cData.animate))
				aniCfg.duration = cData.animate;
			if (!Ext.isEmpty(cData.easing))
				aniCfg.easing = cData.easing;
			me.setAnimation(aniCfg);
			me.lineWidth = cData.lineWidth;
			valueStyle = me.getValueStyle();
			trackStyle = me.getTrackStyle();
			innerStyle = me.getInnerStyle();							
			valueStyle.outerRadius = '100% - 1';
			valueStyle.innerRadius = '100% - '+ (parseInt(me.lineWidth, 10) - 1);
			valueStyle.fill = me.barColor;
			trackStyle.outerRadius = '100%';
			trackStyle.innerRadius = '100% - '+ me.lineWidth;
			trackStyle.fill = me.trackColor;
			innerStyle.outerRadius = '100%';
			innerStyle.innerRadius = '100% - '+ me.lineWidth;
			innerStyle.fill = me.scaleColor;
			me.setValueStyle(valueStyle);
			me.setTrackStyle(trackStyle);
			me.setInnerStyle(innerStyle);
			if (cData.size) {
				if (!Ext.isEmpty(me.cData) && me.cData.size != cData.size)
					cData.size = me.cData.size;
				me.width = me.height = cData.size;
				size.width = cData.size;
				size.height = cData.size;
			}
			width = size.width / 2;
			height = size.height / 2;		
			svgObj = me.getSvg();                   
			svgObj.setSize(cData.size);
	},
	render: function () { 
        if (!this.size) {
            return;
        } 
        var me = this,
            trackArc = me.getTrackArc(),
            valueArc = me.getValueArc(),
			innerArc = me.getInnerArc(),
            clockwise = me.getClockwise(),
            value = me.fxValue,
			arcVal = me.getValue(),
            angleOffset = me.fxAngleOffset,
            trackLength = me.getTrackLength(),
            width = me.size.width,
            height = me.size.height,
            paddingFn = me.getPadding(),
            padding = paddingFn(Math.min(width, height)),
            trackStart = me.normalizeAngle(me.getTrackStart() + angleOffset), // in the range of [0, 360) 
            trackEnd = trackStart + trackLength,                              // in the range of (0, 720) 
            valueLength = me.interpolator(value),
            innerStyle = me.getInnerStyle(),
			trackStyle = me.getTrackStyle(),
            valueStyle = me.getValueStyle(),
            sector = me.fitSectorInPaddedRect(width, height, padding, trackStart, trackLength, trackStyle.innerRadius.ratio),
            cx = sector.cx,
            cy = sector.cy,
            radius = sector.radius,
            innerInnerRadius = Math.max(0, innerStyle.innerRadius(radius)),
            innerOuterRadius = Math.max(0, innerStyle.outerRadius(radius)),
			trackInnerRadius = Math.max(0, trackStyle.innerRadius(radius)),
            trackOuterRadius = Math.max(0, trackStyle.outerRadius(radius)),			
            valueInnerRadius = Math.max(0, valueStyle.innerRadius(radius)),
            valueOuterRadius = Math.max(0, valueStyle.outerRadius(radius)),
			innerPath = me.getArcPath(cx, cy, innerInnerRadius, innerOuterRadius, trackStart, trackEnd, trackStyle.round),
            trackPath = me.getArcPath(cx, cy, trackInnerRadius, trackOuterRadius, trackStart, trackEnd, trackStyle.round),
            valuePath = me.getArcPath(cx, cy, valueInnerRadius, valueOuterRadius,
                clockwise ? trackStart : trackEnd - valueLength,
                clockwise ? trackStart + valueLength : trackEnd,
                valueStyle.round
            );
 
        me.centerText(cx, cy, sector.region, trackInnerRadius, trackOuterRadius);
 
        innerArc.setAttribute('d', innerPath);
		trackArc.setAttribute('d', trackPath);		
        valueArc.setAttribute('d', valuePath);
		me.updateValueStyle(valueStyle);
		me.updateTrackStyle(trackStyle);
		me.updateInnerStyle(innerStyle);
    }	
});

Ext.define("Ext.ramco.TagCloud", {
    extend: 'Ext.Component',
    xtype: 'tagcloud',
    minFontSize: null,
    maxFontSize: null,
    cls: 'x-tag-cloud',
    weightField: 'wgt',
    autoRender: true,
    tagStrength: [],
    config: {
        store: null
    },
    defaultAutoCreate: {
        tag: "div",
        cls: "x-cloud"
    },
    initComponent: function() {
        var me = this;
        me.store = Ext.getStore('tagidentifier');
    },
    getDataSource: function() {
        return this.store;
    },
    initEvents: function() {
        var me = this;
        this.store.remoteSort = false;
    },
    onRender: function(ct, position) {
        this.container = ct;
        this.callParent();
        if (this.el) {
            this.el = Ext.get(this.el);
            if (!this.target) {
                ct.dom.appendChild(this.el.dom);
            }
        } else {
            var cfg = this.getAutoCreate();
            if (!cfg.name) {
                cfg.name = this.name || this.id;
            }
            this.el = ct.createChild(cfg, position);
        }
        this.list = this.el.createChild({
            tag: "ul",
            cls: "x-cloud-unordered-list"
        });
        this.refresh();
    },
    refresh: function() {
        var me = this,
            store = this.store;
        this.clearNodes();
        this.getWeightDistribution();
        var records = store.getRange();
        this.minFontSize = 12;
        this.maxFontSize = 30;
        this.cls = "fontStyle";
        for (var j = 0; j < records.length; j++) {
            this.tagStrength.push(records[j].data[this.weightField]);
        }
        for (var i = 0; i < records.length; i++) {
            var count = records[i].data[this.weightField];
            var child = this.list.createChild({
                tag: "li",
                cls: "x-cloud-item" + ' tag' + parseInt(i % 5 + 1),
                html: '<a class="' + this.cls + '" style="cursor:pointer;' + "font-size:" + this.setFontSize(parseInt(count)) + 'px">' + records[i].data[this.displayField] + (this.displayWeight ? ' (' + count + ')' : '') + '</a>'
            });
            child.on('click', this.onSelect, this);
            child.on('contextMenu', this.onContextMenu, this);
        }
        this.list.fadeIn({
            duration: 0.5,
            block: true
        });
        this.nodes = this.list.dom.childNodes;
    },
    clearNodes: function() {
        while (this.list.dom.firstChild) {
            this.list.dom.removeChild(this.list.dom.firstChild);
        }
    },
    setFontSize: function(size) {
        try {
            var arr = this.tagStrength;
            var min = Math.min.apply(null, arr);
            var max = Math.max.apply(null, arr);
            var a = min; //the smallest count (or occurrence).
            var b = size; //the count of the tag being computed.
            var c = max; //the largest count.			
            var w = this.minFontSize; //the smallest font-size.
            var x = ''; //the font-size for the tag. It is the unknown.
            var y = this.maxFontSize; //the largest font-size.			
            x = (((b - a) * (y - w)) / (c - a)) + w;
            return x;
        } catch (ex) {}
    },
    onSelect: function(e, t) {
        var item = t.parentNode;
        var index = this.indexOf(item);
        var selected = this.list.query('.x-cloud-item-selected');
        if (selected.length > 0)
            Ext.get(selected[0]).removeClass('x-cloud-item-selected');
        this.fireEvent('tagselect', this, this.getDataSource().getAt(index), index);

        // Ext.EventObject.stopEvent(e);
    },
    onContextMenu: function(e, t) {
        var item = t.parentNode;
        var index = this.indexOf(item);
        this.fireEvent('contextmenu', this, this.getDataSource().getAt(index), e);
    },
    indexOf: function(node) {
        var ns = this.nodes;
        for (var i = 0, len = ns.length; i < len; i++) {
            if (ns[i] == node) {
                return i;
            }
        }
        return -1;
    },
    getWeightClassification: function(weight) {
        if (weight == this.max)
            return 'largest';
        if (weight == this.min)
            return 'smallest';
        if (weight > (this.min + (this.distribution * 2)))
            return 'large';
        if (weight > (this.min + this.distribution))
            return 'medium';

        return 'small';
    },
    getWeightDistribution: function() {
        var records = this.store.getRange();

        if (records.length == 0) {
            this.max = this.min = 0;
            return;
        }
        this.max = records[0].data.wgt;
        this.min = records[0].data.wgt;
        for (var i = 0; i < records.length; i++) {
            var count = records[i].data[this.weightField];
            if (count > this.max) {
                this.max = count;
            }
            if (count < this.min) {
                this.min = count;
            }
        }
        if (!this.distribution)
            this.distribution = (this.max - this.min) / 5;
    }
});
Ext.define("Ext.ramco.d3.CloudCmp", {
	extend: 'Ext.d3.svg.Svg',
	xtype: 'ramcod3cloud',
	requires: [
        'Ext.d3.Helpers'
    ],
    mixins: [
        'Ext.d3.mixin.ToolTip'
    ],
	min:1,
	max:1,
	steps:10,
	config: {
		padding: {
            top: 2,
            left: 2,
            right: 2,
            bottom: 2
        },
		interactions: {
		  type: 'panzoom',
		  zoom: {
			  extent: [0.3, 3],
			  doubleTap: false
		  }
	    },
		textSize:[],
		tipField:'',
		displayField:'',
		weightField:'',
		tooltip:{},
		value:null,
		visibleRows: 5,
		selection: null,
		selectEventName: 'click',
		layout: undefined,
		noSizeLayout: true,
		font:'Roboto',
		rotate:function(d) { return 0; },
		spiral:'archimedean'
	},
	publishes: 'selection',
    constructor: function (config) {
        this.callParent([config]);
		this.addNodeListeners();
        this.mixins.d3tooltip.constructor.call(this, config);
		// TECH-26860
		//this.color = d3.scale.category10();
		this.color = d3.schemeCategory10;
    },
	fontSize:function(d,i) {
		var me= this,
			field = me.getWeightField(),
			weight = Math.floor(me.steps / 2),
			v = parseFloat(d.get(field));
			
			if (me.max != me.min) {
				weight = Math.round((v - me.min) * 1.0 * (me.steps-1) / (me.max - me.min)) + 1;
			}
		return 10 + (weight * 3);
		//return  11 + (v * 2);
	},
	text:function(d) { 
		var me= this,
			field = me.getDisplayField();
		return d.get(field); 
	},
		
	onTooltip:function(component, tooltip, datum, element, evt) {
        var me = this,
			d = datum.data,
            field = me.getTipField();
        tooltip.setHtml(d[field]);
    },
	applyTooltip: function (tooltip, oldTooltip) {
        var me =this;
		if (tooltip) {
			tooltip.renderer = me.onTooltip.bind(me);
		    tooltip.delegate = 'text.word';
        }
        return this.mixins.d3tooltip.applyTooltip.call(this, tooltip, oldTooltip);
    },

    updateTooltip: null,
	applyLayout: function () {
         var me = this,
             font = me.getFont(),
			 rotate = me.getRotate(),
             layout;
		// TECH-26860
		layout = d3.cloud();
		layout.size(null);
		layout.timeInterval(10);
		layout.rotate(rotate);
		layout.font(font);
		layout.fontSize(me.fontSize.bind(me));
		layout.text(me.text.bind(me));
		layout.spiral(me.getSpiral());
		layout.padding(3);
		layout.on("end", me.draw.bind(me));
        return layout;
    },
	
	onSceneResize:function(scene, rect){
		var me =this;
		me.callParent([scene, rect]);
		//me.wrapper.attr('transform', 'translate(' + rect.width/2 + ',' + rect.height/2 + ')');
		me.performLayout(rect);
	},
	performLayout: function (rect) {
		var me = this;
		
		rect = rect || me.getSceneRect();

        if (!rect) {
            return;
        }
		var store = me.getStore(),
			items = me.data = me.getStoreData(store),
            layout = me.getLayout()
			size=0; 
		layout.stop();
		me.clearScene();
		if(items){
			if(items.length > 0 && items.length > 100){
				size = (parseInt(items.length / 100) + 1) / 0.5;
			}
			else
				size = 0;
			me.min = parseFloat(store.min(me.getWeightField()));
			me.max = parseFloat(store.max(me.getWeightField()));
			layout.size([rect.width + (rect.width * size),rect.height + (rect.height * size)]);
			if(items.length > 0) {
				layout.words(items);
				layout.start();
			}
		}
	},
	
	updateValue: function(newValue, oldValue) {
        var me = this,
			store = me.getStore(),
            visibleRows = me.getVisibleRows();
        if (!store || store.isEmptyStore) {
            me.value = newValue;
            return;
        }
        if (newValue) {
            me.vsi = newValue.vsi;
            me.si = newValue.si;
            me.tr = newValue.tr;
            store.nsr = parseInt(newValue.nsr, 10);
            store.start = me.si;
            store.end = (visibleRows * 3) + (me.si - 1);
            if (store.end > me.tr)
                store.end = me.tr
            store.tr = me.tr;
            store.vr = newValue.vr;
            store.vsi = me.vsi;
            store.cr = me.vsi;
			if (!Ext.isEmpty(newValue.store)) {
				store.setData(newValue.store);
				store.commitChanges();
			}
        }
    },
	getStoreData: function(store){
        return store ? store.getData().items : [];
    },
	processDataChange: function (store) {
		var me = this;
		me.performLayout();
		if (!me.isConfiguring) {
            me.isConfiguring = true;
			me.updateValue(me.value);
        }
	},
	addNodeListeners: function () {
        var me = this,
            selectEventName = Ext.Array.from(me.getSelectEventName()),
            i, len, eventName;

        for (i = 0, len = selectEventName.length; i < len; i++) {
            me.addNodeListener(selectEventName[i], me.onSelectEvent);
        }
    },
	addNodeListener: function(eventName, handler) {
        var me = this,
            targetEl = me.el;

		targetEl.on(eventName, handler, me, {
			delegate: 'text.word'
		});
    },
	getColor:function(d){
		var me =this,
			color = me.color,
			field = me.getWeightField(),
			weight = Math.floor(me.steps / 2),
			v = parseFloat(d.get(field));
			
			if (me.max != me.min) {
				weight = Math.round((v - me.min) * 1.0 * (me.steps-1) / (me.max - me.min)) + 1;
			}
		return color[(weight * 255) % 10];
	},
	onSelectEvent: function (evt, target) {
		var me=this,
			oldSelection = me.getSelection(),
			selection = d3.select(target),
            element = selection.node(),
            node = selection.datum();

		if(evt.type == "click"){
			if (me.task) {
				node.set("sel",true);
				if(oldSelection)
					oldSelection.attr("class","word");
				selection.attr("class","word selected");
				me.setSelection(selection);
                args = ['uiclick', me, node, me.task, me.taskType];
                me.fireEvent.apply(me, args);
            }
		}
    },
	draw : function(words){
		var me = this,
			font = me.getFont(),
			scene = me.scene || me.getScene();
		me.showScene();
		scene.selectAll("text")
        .data(words)
		.enter().append("text")
		.style("font-size", function(d,i) {
				return d.size + "px";
			})
        .style("font-family", font)
        .attr('class','word')
        .style("fill", me.getColor.bind(me))
        .attr("text-anchor", "middle")
        .attr("transform", function(d) { return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")"; })
        .text(me.text.bind(me));
		me.zoomToFitBounds(words,scene);
		//me.alignContent('center','center');
	},
	zoomToFitBounds:function(words, scene) {
		var me = this,
		rect = me.getSceneRect();
      var X0 = d3.min( words, function (d) {
        return d.x - (d.width/2);
      }),
        X1 = d3.max( words, function (d) {
          return d.x + (d.width/2);
        });

      var Y0 = d3.min( words, function (d) {
          return d.y - (d.height/2);
        }),
        Y1 = d3.max( words, function (d) {
          return d.y + (d.height/2);
        });

      var scaleX = (X1 - X0) / (rect.width);
      var scaleY = (Y1 - Y0) / (rect.height);

      var scale = 1 / Math.max(scaleX, scaleY);

      var translateX = Math.abs(X0) * scale;
      var translateY = Math.abs(Y0) * scale;

      scene.attr("transform", "translate(" +
        translateX + "," + translateY + ")" +
        " scale(" + scale + ")");
	}
})


Ext.define("Ext.ramco.TagCloudCmp", {
    extend: 'Ext.view.View',
    xtype: 'ramcotagcloud',
    cls: 'x-tagcloud',
    displayField: '',
    weightField: '',
    center: {
        x: 0.5,
        y: 0.5
    },
    steps: 10,
    shape: 'elliptic',
    step: null,
    angle: null,
    aspect_ratio: null,
    max_weight: null,
    min_weight: null,
    scrollable: true,
    trackOver: true,
    calcSize: [],
    config: {
        visibleRows: 5,
        value: null
    },
    autoEl: 'ui',
    bufferedRenderer: false,
    overItemCls: 'x-tagcloud-item-over',
    initComponent: function() {
        var me = this;
        me.tpl = ['<tpl for=".">',
            '<li class="x-tagcloud-item x-tagcloud-item-{weg}" style="left:{left};top:{top};"><span class="x-tagcloud-item-cell">{' + me.displayField + '}</span></li>',
            '</tpl>'
        ];
        me.itemSelector = "li.x-tagcloud-item";
        me.callParent();
    },
    updateValue: function(newValue, oldValue) {
        var me = this,
            visibleRows = me.getVisibleRows();
        if (!me.store || me.store.isEmptyStore) {
            me.value = newValue;
            return;
        }
		me.store.loadData(newValue.store);
        if (newValue) {
            me.vsi = newValue.vsi;
            me.si = newValue.si;
            me.tr = newValue.tr;
            me.store.nsr = parseInt(newValue.nsr, 10);
            me.store.start = me.si;
            me.store.end = (visibleRows * 3) + (me.si - 1);
            if (me.store.end > me.tr)
                me.store.end = me.tr
            me.store.tr = me.tr;
            me.store.vr = newValue.vr;
            me.store.vsi = me.vsi;
            me.store.cr = me.vsi;
        }
    },
    collectData: function(records, startIndex) {
        var me = this,
            data = [],
            i = 0,
            len = records.length,
            record,
            dSize = {},
            size = me.getSize();
        me.calcSize = [];
        me.angle = 0;
        me.step = (me.shape === 'rectangular') ? 18.0 : 1.0;
        me.aspect_ratio = size.width / size.height;
        me.max_weight = 0;
        me.min_weight = 0;
        if (len > 0) {
            me.max_weight = records[0].get(me.weightField);
            me.min_weight = records[len - 1].get(me.weightField);
        }
        for (; i < len; i++) {
            record = records[i];
            data[i] = me.prepareData(record.data, startIndex + i, record);
            dSize = me.getPosition(i, record);
            data[i].width = dSize.width;
            data[i].height = dSize.height;
            data[i].left = dSize.left;
            data[i].top = dSize.top;
            data[i].weg = dSize.weg;
        }
        return data;
    },
    getTextMetrics: function() {
        var me = this,
            cls = me.self,
            tm = cls.measurer,
            el;

        if (!tm) {
            el = Ext.getBody().createChild();
            cls.measurer = tm = new Ext.util.TextMetrics(el);
        }
        return tm;
    },
    getPosition: function(index, record) {
        var me = this,
            angle = me.angle,
            radius = 0.0,
            txtMetrics = me.getTextMetrics(),
            steps_in_direction = 0.0,
            quarter_turns = 0.0,
            weight = Math.floor(me.steps / 2),
            size = me.getSize(),
            dSize = {},
            word = '',
            data = {};
        if (me.max_weight != me.min_weight) {
            weight = Math.round((record.get(me.weightField) - me.min_weight) * 1.0 * (me.steps - 1) / (me.max_weight - me.min_weight)) + 1;
        }
        txtMetrics.el.setStyle({
            'font-size': ((weight * 3 + 9) + "px"),
            'line-height': ((weight * 3 + 9) + "px")
        });
        word = record.get(me.displayField);
        data = txtMetrics.getSize(word);
        dSize = txtMetrics.getSize(word);
        data.weg = weight;
        dSize.left = me.center.x * size.width - dSize.width / 2.0;
        dSize.top = me.center.y * size.height - dSize.height / 2.0;
        data.left = dSize.left + 'px';
        data.top = dSize.top + 'px';
        while (this.hitTest(dSize)) {
            if (me.shape === 'rectangular') {
                steps_in_direction++;

                if (steps_in_direction * me.step > (1 + Math.floor(quarter_turns / 2.0)) * me.step * ((quarter_turns % 4 % 2) === 0 ? 1 : me.aspect_ratio)) {
                    steps_in_direction = 0.0;
                    quarter_turns++;
                }

                switch (quarter_turns % 4) {
                    case 1:
                        dSize.left += me.step * me.aspect_ratio + Math.random() * 2.0;
                        break;
                    case 2:
                        dSize.top -= me.step + Math.random() * 2.0;
                        break;
                    case 3:
                        dSize.left -= me.step * me.aspect_ratio + Math.random() * 2.0;
                        break;
                    case 0:
                        dSize.top += me.step + Math.random() * 2.0;
                        break;
                }
            } else {
                radius += me.step;
                angle += (index % 2 === 0 ? 1 : -1) * me.step;

                dSize.left = me.center.x * size.width - (dSize.width / 2.0) + (radius * Math.cos(angle)) * me.aspect_ratio;
                dSize.top = me.center.y * size.height + radius * Math.sin(angle) - (dSize.height / 2.0);
            }
            data.left = dSize.left + 'px';
            data.top = dSize.top + 'px';
        }
        me.calcSize.push(dSize);
        return data;
    },
    hitTest: function(cSize) {
        var me = this,
            len = me.calcSize.length,
            i = 0;
        for (; i < len; i++) {
            if (me.overlapping(cSize, me.calcSize[i])) {
                return true;
            }
        }
        return false;
    },
    overlapping: function(a, b) {
        if (Math.abs(2.0 * a.left + a.width - 2.0 * b.left - b.width) < a.width + b.width) {
            if (Math.abs(2.0 * a.top + a.height - 2.0 * b.top - b.height) < a.height + b.height) {
                return true;
            }
        }
        return false;
    },
    onDataRefresh: function(store) {
        var me = this,
            preserveScrollOnRefresh = me.preserveScrollOnRefresh;

        if (store) {
            store.suspendEvents();
            store.sort(me.weightField, 'DESC');
            store.resumeEvents();
        }

        // If this refresh event is fire from a store load, then use the 
        // preserveScrollOnReLoad setting to decide whether to preserve scroll position
        if (store.loadCount > me.lastRefreshLoadCount) {
            me.preserveScrollOnRefresh = me.preserveScrollOnReload;
        }
        me.refreshView();
        me.preserveScrollOnRefresh = preserveScrollOnRefresh;
        me.lastRefreshLoadCount = store.loadCount;
    },
    processItemEvent: function(record, item, rowIndex, e) {
        var me = this,
            type = e.type;
        if (type == 'click') {
            if (me.task) {
                args = ['uiclick', me, record, me.task, me.taskType];
                me.fireEvent.apply(me, args);
            }
        }
    }
});

// Navigation Menu Store
Ext.define('RamcoHub.store.NavigationMenu', {
    extend: 'Ext.data.TreeStore',
    storeId: 'NavigationMenu',
    fields: [{
        name: 'text'
    }, {
        name: 'children',
        mapping: 'menu'
    }, {
        name: 'href',
        type: 'string',
        defaultValue: 'javascript:void(0)'
    }],
    root: {
        iconCls: 'x-fa fa-home',
        text: rvw_resources.R094,
        itemId: 'menuHome',
        expanded: true
    }
});

// Search Menu Box - Store
Ext.define('RamcoHub.store.MenuStore', {
    extend: 'Ext.data.Store',
    storeId: 'MenuStore',
    fields: [{
        name: 'actname'
    }, {
        name: 'actdesc'
    }, {
        name: 'stilbo'
    }, {
        name: 'isedk'
    }, {
        name: 'cmpname'
    }, {
        name: 'compdesc'
    }, {
        name: 'bpcdesc'
    }, {
        name: 'actdesc_ilbo',
        calculate: function(data) {
            //return '<div><span>' + data.compdesc + '&nbsp;</span><span class="x-fa fa-angle-right" aria-hidden="true">&nbsp;</span><span><b>' + data.actdesc + '</b></span></div>';
			return '<div><span>' + data.compdesc + '&nbsp;</span><span class="x-fa fa-angle-right" aria-hidden="true">&nbsp;</span><span>' + data.actdesc + '</span></div>';
        }
    }],
    proxy: {
        type: 'memory',
        reader: {
            type: 'json'
        }
    }
});

Ext.define('RamcoHub.store.AvnSearchStore', {
    extend: 'Ext.data.Store',
    storeId: 'AvnSearchStore',
    fields: [
		{
			name: 'Activity',
			type: 'string'
		}, 
		{
			name: 'Component',
			type: 'string'
		}, 
		{
			name: 'id',
			type: 'string'
		},
		{
			name: 'actdesc_ilbo',
			calculate: function(data) {
				if (Ext.isEmpty(data.Component) && Ext.isEmpty(data.Activity))
					return;				
				//return '<div><span>' + data.Component + '&nbsp;</span><span class="x-fa fa-angle-right" aria-hidden="true">&nbsp;</span><span><b>' + data.Activity + '</b></span></div>';
				return '<div><span>' + data.Component + '&nbsp;</span><span class="x-fa fa-angle-right" aria-hidden="true">&nbsp;</span><span>' + data.Activity + '</span></div>';
			}
		}
	],
    proxy: {
        type: 'memory',
        reader: {
            type: 'json'
        }
    }
});

// Default Template - Store
Ext.define('RamcoHub.store.TemplateStore', {
    extend: 'Ext.data.Store',
    storeId: 'TemplateStore',
    fields: [{
        name: 'text',
        type: 'string'
    }, {
        name: 'value',
        type: 'string'
    }],
    proxy: {
        type: 'memory',
        reader: {
            type: 'json'
        }
    }
});

Ext.create('Ext.data.Store', {
    proxy: {
        type: 'memory',
        reader: {
            type: 'json'
        }
    },
    storeId: 'tagidentifier',
    fields: [{
        name: 'actdesc',
        type: 'string'
    }, {
        name: 'wgt',
        type: 'int'
    }]
});
Ext.define('RamcoHub.view.main.AvnMain', {
	extend: 'Ext.container.Viewport',
    xtype: 'app-main',
    requires:[
        'Ext.layout.container.Border'
    ],
    layout: 'border',
	items: [{
		region:'north',
		xtype: 'panel',
		margin:0,
		itemId: 'northPanel',
		header:false,
		collapseMode:'mini',
		collapsible: true,
		collapsed: true,
        split: {
			size: 0,
			style:{
				zIndex:9
			}
		},
		splitterResize:false,
		dockedItems:[{
			xtype:'toolbar',
			itemId:'tblMain',
			height:42,
			overflowHandler: 'scroller',
			cls:'x-main-menu',
			items:[' ',{
				iconCls:'x-toolbar-more-icon',
				itemId:'mainMenu',
				role:'mainpage',
				arrowVisible:false,
				menuAlign :'tr-br?'
			},
			{
				xtype:'component',
				userCls:'product_logo',
				itemId:'productLogo'
			},
			'-',
			{
			   xtype:'component',
			   itemId:'companyLogo',
			   userCls:'project_logo'
			},
			'->'
			,
			{
				itemId:'recentMenu',
				iconCls:'tech-doculist',
				tooltip :rvw_resources.R174,
				arrowVisible :false,
				role:'mainpage',
				cls:'x-recent-menu',
				menuAlign :'tl-bl?'
			},
			{
				xtype:'badgebutton',
				itemId:'btnInbox',
				badgeText: '',
				iconCls:'tech-reminder',
				/* cls:'x-btn-inbox', */ /* AHBG-31964 */
				tooltip :rvw_resources.R176,
				role:'mainpage'
			},
			{
				iconCls:'x-fa fa-star',
				itemId:'btnFavorites',						
				tooltip :rvw_resources.R175,
				arrowVisible :false,
				role:'mainpage',
				menuAlign :'tl-bl?'
			},			
			{
				iconCls:'tech-menutag',
				tooltip :rvw_resources.R178,
				itemId:'btnMenuTag',
				role:'mainpage'
			},
			{
				iconCls:'x-fa fa-external-link',
				tooltip :rvw_resources.R327,
				itemId:'btnNewWindow',
				hidden: true,
				role:'mainpage'
			},
			{
				iconCls:'x-fa fa-ellipsis-h',
				tooltip :rvw_resources.R177,
				itemId:'btnLaunchDW',
				hidden:true,
				role:'mainpage'
			},
			{
				/* iconCls:'x-fa fa-clone', */ /* AHBG-31964 */
				itemId:'btnMenuDefault',
				tooltip :rvw_resources.R179,
				menuAlign :'tr-br?',
				role:'mainpage'
			},
			{
				xtype:'container',
				layout: {
					type: 'hbox',
					align: 'stretch'
				},			
				itemId:'btnWorkAreaStyle',
				tooltip: 'Default',
				hidden: true,
				defaults: {
					width: 24,
					height: 24,
					padding: 0,
					margin: 0,
					userCls: 'workareastyle'
				},
				role:'mainpage',
				items: [{
					xtype: 'button',
					itemId:'itmWorkAreaStyle',
					arrowVisible : false,
					iconCls:'x-fa fa-envelope',
					role:'workarea'
				},{
					xtype: 'button',
					itemId:'default',
					text: '1',
					isActive: true,
					cls: 'actworkarea',
					role:'workarea'
				}]
			},
			{
				iconCls:'',
				tooltip :rvw_resources.R078,
				itemId:'btnThemes',
				menuAlign :'tr-br?',
				role:'mainpage'
			},
			'->',
			{
				xtype:'combofield',
				itemId:'cmbActSearch',
				queryMode: 'remote',
				hideTrigger: true,
				displayField: 'actdesc_ilbo',
				valueField: 'stilbo',
				store:'MenuStore',
				role:'mainpage',
				minWidth:200,
				forceSelection : false,	
				matchFieldWidth :false,
				anyMatch: true,
				collapseOnSelect: true,
				validateOnBlur: false,
				validateOnChange: false,
				defaultListConfig: {
					loadingHeight: 100,
					minWidth: 70,
					maxHeight: 500,
					shadow: 'sides'
				},
				border:false,
				padding:2,
				emptyText: rvw_resources.R263
			},
			{		 		  
			  xtype: "ramcolistedit",
			  uiTaskType: "ui",
			  displayField: "actdesc_ilbo",
			  valueField: "actdesc_ilbo",
			  dataType: "char",		  		  
			  role: "mainpage",		  
			  position: 1,
			  maxLength: 45,
			  visibleLength: 45,
			  listIndexSearch: 2,
			  hidden: true,
			  hideLabel: true,
			  hideTrigger: true,
			  reqtype: 'quicksearch',
			  searchId: 'activitylist01',
			  store: "AvnSearchStore",
			  menuListEdit: true,
			  emptyText: rvw_resources.R263,
			  tdAttrs: {
				"style": {
				  "text-align": "left"
				}
			  },
			  itemId: "avnSearchField",
			  columns: [
				{
				  itemId: "Activity",
				  text: "Activity",
				  hidden: true,
				  width: 70
				},
				{
				  itemId: "Component",
				  text: "Component",
				  hidden: true,
				  width: 200
				},
				{
				  itemId: "id",
				  hidden: true
				},
				{
				  itemId: "actdesc_ilbo",
				  text: "Activity Description",
				  width: 500
				}			
			  ]
			},
			{
				xtype: 'textfield',
				itemId: 'quickIlbo',
				role: "mainpage",
				emptyText: 'Quick Code',
				width: 100,
				triggers: {
					arrow: {
						cls: 'x-fa fa-arrow-right'						
					}
				},
				userCls: 'x-quickIlbo'
			},
			'->',
			{
				itemId:'userMenu',
				menuAlign :'tr-br?'
			}]
		}],
		items:[{
			xtype:'container',
			userCls:'x-news-box',
			itemId:'tickerHeader',
			height:24,
			layout: {
				type: 'hbox',
				align: 'stretch'		
			},
			items:[{
				xtype:'label',
				itemId:'lblNewTicker',
				userCls:'x-news x-fa fa-caret-right',
				width:70,
				text:rvw_resources.R318
			},{
				xtype:'marquee',
				itemId:'newTicker',
				flex:1,
				autoStart:false
			}]
		}]
	},{
		region:'center',
		xtype: 'panel',
		margin:0,
		itemId:'ilboView',
		layout:'fit',
		cls:'x-ilbo-container',
		dockedItems:[
			{
				xtype:'toolbar',
				itemId:'tblBPC',
				dock:'top',
				height:30,
				overflowHandler: 'menu',
				cls:'x-main-submenubpc',
				defaults:{
					scale:'small',
					padding:1
				},
				items:[{
					itemId:'btnHome',
					iconCls:'x-fa fa-home',
					height: 22,
					tooltip :rvw_resources.R180,					
					role:'mainpage'
				},{
					itemId:'btnArrow1',
					iconCls:'x-fa fa-angle-right',
					ui:'plain',
					width:7,
					hidden:true,
					disabled:true
				},{
					itemId:'btnComponent',					
					role:'mainpage',
					cls:'x-btn-component',
					text: '',
					hidden:true,
					arrowVisible:true
				},{
					itemId:'btnArrow2',
					iconCls:'x-fa fa-angle-right',
					ui:'plain',
					width:7,
					hidden:true,
					disabled:true
				},{
					itemId:'btnActivity',					
					role:'mainpage',
					cls:'x-btn-activity',
					hidden:true,
					text: '',
					arrowVisible:true
				},
				{
					itemId:'btnArrow3',
					iconCls:'x-fa fa-angle-right',
					ui:'plain',
					width:7,
					hidden:true,
					disabled:true
				},
				{
					itemId:'txtBpcIlboTitle',
					role:'mainpage',
					userCls:'x-ilbo-title',
					text:'',
					arrowVisible:false
					
				},
				'->',
				{
					itemId:'currentOU',
					hidden:true
				}]
			},
			{
			xtype:'toolbar',
			itemId:'tblApp',
			dock:'top',
			height:30,			
			overflowHandler: 'menu',
			cls:'x-main-submenu',
			defaults:{
				scale:'small',
				padding:1,
				margin: '0 5'
			},
			items:[{
				iconCls:'x-fa fa-star',
				itemId:'getFav',
				tooltip :rvw_resources.R069,
				role: 'favmenu',
				arrowVisible:false, 
				menuAlign:'tl-bl?'
			},
			{
				iconCls:'tech-doculist',
				itemId:'compactMenu',
				tooltip :rvw_resources.R328, //TECH-40145
				role: 'mainpage',
				arrowVisible:false, 
				menuAlign:'tl-bl?'
			},
			{
				itemId:'txtIlboTitle',
				role:'mainpage',
				userCls:'x-ilbo-title',
				text:'',				
				arrowVisible:false
					
			},
			{
				itemId:'currentOU',
				hidden:true
			},
			'->',
			{
				xtype:'combofield',
				itemId:'cmbTemplate',
				displayField:'text',
				valueField:'value',
				store:'TemplateStore',
				role:'mainpage',
				width:100,
				minWidth:100,
				queryMode: 'local',
				allowBlank: true,
				border:false,
				hidden: true,
				padding:2
			},{
				xtype:'textfield',
				itemId:'txtTemplate',
				role:'mainpage',
				minWidth:100,
				visibleLength: 15,
				hidden: true,
				emptyText: 'Template Name'
			},{
				xtype: 'checkbox',
				boxLabel: 'Set Default Template ',
				itemId: 'chkTemplate',
				role:'mainpage',
				checked: false,
				hidden: true
			},{
				itemId:'btnSave',
				iconCls:'x-fa fa-floppy-o',
				hidden: true,
				tooltip :rvw_resources.R183,
				role:'mainpage',
				text: ''
			},
			{
				itemId:'btnClear',
				iconCls:'x-fa fa-eraser',
				hidden: true,
				tooltip :rvw_resources.R099,
				role:'mainpage',
				text: ''
			},
			{
				itemId:'btnCancl',
				iconCls:'x-fa fa-times',
				hidden: true,
				tooltip :rvw_resources.R103,
				role:'mainpage',
				text: ''
			},
			'-',
			,{
				itemId:'smartlinknav',
				role:'mainpage',
				hidden: true,
				xtype:'toolbar',
				height:19,
				defaults:{
					scale:'small',
					padding:0,
					margin:1
				}
			},{
				itemId:'btnUdsMenu',
				iconCls:'x-fa fa-list-alt',
				tooltip :rvw_resources.R184,
				hidden: true,
				role:'mainpage',
				text: ''
			},{
				itemId:'btnIlboSwitchContext',
				iconCls:'x-fa fa-caret-down',
				iconAlign:'right',					
				//tooltip :'ilboswitchcontext'					
				tooltip : rvw_resources.R329, //TECH-41247
				hidden: true,
				role:'ilboswitchcontext'					
			},{
				itemId:'btnTemplate',
				iconCls:'x-fa fa-list-alt',
				tooltip :rvw_resources.R185,
				hidden: true,						
				role:'mainpage',
				text: ''
			},{
				itemId:'btnTrailBar',
				iconCls:'x-fa fa-random',
				tooltip :'Trailbar',
				role:rvw_resources.R080,
				arrowVisible :false,
				menuAlign :'tr-br?',
				text: ''
			},{
				itemId:'btnPrintBar',
				iconCls:'x-fa fa-print', 
				tooltip :rvw_resources.R082,
				hidden: true,
				role:'mainpage',
				arrowVisible :false,
				menuAlign :'tr-br?',
				text: ''
			},{
				itemId:'btnRefresh',
				iconCls:'tech-refresh1',
				tooltip :rvw_resources.R083,
				role:'mainpage',
				text: ''
			},{
				itemId:'btnCancel',
				iconCls:'x-fa fa-arrow-left',
				tooltip :rvw_resources.R084,
				role:'mainpage',
				text: ''
			},{
				itemId:'btnSmartBar',
				iconCls:'tech-smartbar',
				tooltip :rvw_resources.R290,
				hidden:true,
				role:'mainpage',
				text: ''
			},{
				itemId:'btnHelp',
				iconCls:'x-fa fa-question',
				tooltip :rvw_resources.R086,
				role:'mainpage',
				text: ''
			},{
				itemId:'btnPreference',
				iconCls:'tech-preference_mode',
				tooltip :rvw_resources.R173,
				role:'mainpage',
				hidden: true,
				text: ''
			},{
				itemId:'btnDefaultMode',
				iconCls:'tech-default_mode',
				tooltip :rvw_resources.R188,
				role:'mainpage',
				hidden: false,
				text: ''
			}]
		}]
	},{
		region: 'south',
		height:23,
		margin:0,
		xtype:'statusbar',
		liquidLayout: true,
		itemId:'statusbarMain',
		defaultText: 'Default status text',
		defaultIconCls: 'default-icon',
		userCls:'x-main-statusbar',
		text: rvw_resources.R091,
		iconCls: 'ready-icon',
		border:true,
		hidden:true,
		items: [{
			itemId: 'errorDisplay',
			role: 'mainpage',
			xtype: 'ramcolabel',
			focusable: false,
			cls:'x-errordisplay',
			hidden:true,
			minWidth: 250,
			flex:1
		},{
			itemId: 'txtLastLogin',
			role: 'mainpage',
			dataType: 'date-time',
			xtype: 'ramcolabel',
			focusable: false,
			minWidth: 150,	
			cls: 'x-lastlogin'			
		},
		'-',
		{
			itemId:'txtTimeTaken',
			role:'mainpage',
			xtype:'component',
			minWidth:170,
			cls:"x-timetaken",
			tpl:'{s}'
		}, '-', {
			 text :rvw_resources.R089,
			 itemId:'accessKey',
			 role:'mainpage',
			 hidden:true,
			 menuAlign :'tr-br?'
	
			},{
			text:rvw_resources.R088,
			itemId:'btnErrorState',
			role:'mainpage',
			minWidth: 90,
			maxWidth: 90,
			menu:'',
			menuAlign :'tr-br?',
			cls: 'x-errorstate',
			arrowVisible: false,
			disabled:true
		},
		'-', 
		{
			itemId:'reactivateTime',
			iconCls:'x-fa fa-clock-o',
			tooltip :rvw_resources.R189,
			role:'mainpage',
			text: ''
		},						
		{
			xtype:'component',
			itemId:'sessionTimer',
			cls:'x-sessionTimer',
			html:'',
			width:75
		}, 
		'-', 
		{
			xtype:'trayclock',
			itemId:'trayClock',
			timeFormat: 'g:i A',
			width:70
		}]
	}]
});

Ext.define('RamcoHub.view.main.Main', {
	extend: 'Ext.container.Viewport',
    xtype: 'app-main',
    requires:[
        'Ext.layout.container.Border'
    ],
	layout: 'border',
	items: [{
		region:'north',
		xtype: 'panel',
		margin:0,
		itemId: 'northPanel',
		header:false,
		hidden: true,
		collapsible: false,
		collapsed:false,
		dockedItems:[{
			xtype:'toolbar',
			itemId:'tblMain',
			height:42,
			overflowHandler: 'scroller',
			cls:'x-main-menu',
			items:[' ',{
				iconCls:'x-toolbar-more-icon',
				itemId:'mainMenu',
				role:'mainpage',
				arrowVisible:false,
				menuAlign :'tr-br?'
			},{
				xtype:'component',
				userCls:'product_logo',
				itemId:'productLogo'
			},'-',{
			   xtype:'component',
			   itemId:'companyLogo',
			   userCls:'project_logo'
			},'->',{
				xtype:'combofield',
				itemId:'cmbActSearch',
				queryMode: 'remote',
				hideTrigger: true,
				displayField: 'actdesc_ilbo',
				valueField: 'stilbo',
				store:'MenuStore',
				role:'mainpage',
				minWidth:200,
				forceSelection : false,	
				matchFieldWidth :false,
				anyMatch: true,
				collapseOnSelect: true,
				validateOnBlur: false,
				validateOnChange: false,
				defaultListConfig: {
					loadingHeight: 100,
					minWidth: 70,
					maxHeight: 500,
					shadow: 'sides'
				},
				border:false,
				padding:2,
				emptyText: rvw_resources.R263
			},
			{		 		  
			  xtype: "ramcolistedit",
			  uiTaskType: "ui",
			  displayField: "actdesc_ilbo",
			  valueField: "actdesc_ilbo",
			  dataType: "char",		  		  
			  role: "mainpage",		  
			  position: 1,
			  maxLength: 45,
			  visibleLength: 45,
			  listIndexSearch: 2,
			  hidden: true,
			  hideLabel: true,
			  hideTrigger: true,
			  reqtype: 'quicksearch',
			  searchId: 'activitylist01',
			  store: "AvnSearchStore",
			  menuListEdit: true,
			  emptyText: rvw_resources.R263,
			  tdAttrs: {
				"style": {
				  "text-align": "left"
				}
			  },
			  itemId: "avnSearchField",
			  columns: [
				{
				  itemId: "Activity",
				  text: "Activity",
				  hidden: true,
				  width: 70
				},
				{
				  itemId: "Component",
				  text: "Component",
				  hidden: true,
				  width: 200
				},
				{
				  itemId: "id",
				  hidden: true
				},
				{
				  itemId: "actdesc_ilbo",
				  text: "Activity Description",
				  width: 500
				}			
			  ]
			},
			{
				itemId:'recentMenu',
				iconCls:'x-fa fa-th-list',
				tooltip :rvw_resources.R174,
				arrowVisible :false,
				role:'mainpage',
				menuAlign :'tl-bl?'
			},{
				iconCls:'x-fa fa-star',
				itemId:'btnFavorites',						
				tooltip :rvw_resources.R175,
				arrowVisible :false,
				role:'mainpage',
				menuAlign :'tl-bl?'
			},{
				xtype:'badgebutton',
				itemId:'btnInbox',
				badgeText: '',
				iconCls:'x-fa fa-inbox',
				tooltip :rvw_resources.R176,
				role:'mainpage'
			},{
				iconCls:'tech-menutag',
				tooltip :rvw_resources.R178,
				itemId:'btnMenuTag',
				role:'mainpage'
			},{
				iconCls:'x-fa fa-external-link',
				tooltip :rvw_resources.R327,
				itemId:'btnNewWindow',
				hidden: true,
				role:'mainpage'
			},{
				iconCls:'x-fa fa-ellipsis-h',
				tooltip :rvw_resources.R177,
				itemId:'btnLaunchDW',
				hidden:true,
				role:'mainpage'
			},{
				iconCls:'x-fa fa-clone',
				itemId:'btnMenuDefault',
				tooltip :rvw_resources.R179,
				menuAlign :'tr-br?',
				role:'mainpage'
			},{
				xtype:'container',
				layout: {
					type: 'hbox',
					align: 'stretch'
				},			
				itemId:'btnWorkAreaStyle',
				tooltip: 'Default',
				hidden: true,
				defaults: {
					width: 24,
					height: 24,
					padding: 0,
					margin: 0,
					userCls: 'workareastyle'
				},
				role:'mainpage',
				items: [{
					xtype: 'button',
					itemId:'itmWorkAreaStyle',
					arrowVisible : false,
					iconCls:'x-fa fa-envelope',
					role:'workarea'
				},{
					xtype: 'button',
					itemId:'default',
					text: '1',
					isActive: true,
					cls: 'actworkarea',
					role:'workarea'
				}]
			},{
				iconCls:'x-fa fa-th-large',
				tooltip :rvw_resources.R078,
				itemId:'btnThemes',
				menuAlign :'tr-br?',
				role:'mainpage'
			},{
				itemId:'userMenu',
				menuAlign :'tr-br?'
			}]
		}],
		items:[{
			xtype:'container',
			userCls:'x-news-box',
			itemId:'tickerHeader',
			height:24,
			hidden: true,
			layout: {
				type: 'hbox',
				align: 'stretch'		
			},
			items:[{
				xtype:'label',
				itemId:'lblNewTicker',
				userCls:'x-news',
				text:rvw_resources.R199
			},{
				xtype:'marquee',
				itemId:'newTicker',
				flex:1,
				autoStart:false
			}]
		}]
	},{
		region:'center',
		xtype: 'panel',
		margin:0,
		header:false,
		itemId:'ilboView',
		layout:'fit',
		cls:'x-ilbo-container',
		dockedItems:[{
				xtype:'toolbar',
				itemId:'tblApp',
				dock:'top',
				height:30,
				padding:1,
				hidden:true,
				overflowHandler: 'menu',
				cls:'x-main-submenu',
				defaults:{
					scale:'small',
					padding:1
				},
				items:[{
					itemId:'btnCancel',
					iconCls:'x-fa fa-arrow-left',
					tooltip :rvw_resources.R084,
					role:'mainpage',
					text: ''
				},{
					iconCls:'x-fa fa-star',
					itemId:'getFav',
					tooltip :rvw_resources.R069,
					role: 'favmenu',
					arrowVisible:false, 
					menuAlign:'tl-bl?'
				},{
					itemId:'btnHome',
					iconCls:'x-fa fa-home',
					tooltip :rvw_resources.R180,
					text:'Home',
					role:'mainpage'
				},{
					itemId:'btnArrow1',
					iconCls:'x-fa fa-angle-right',
					ui:'plain',
					width:7,
					hidden:true,
					disabled:true
				},{
					itemId:'btnComponent',
					//tooltip :rvw_resources.R181,
					role:'mainpage',
					text: '',
					hidden:true,
					arrowVisible:true
				},{
					itemId:'btnArrow2',
					iconCls:'x-fa fa-angle-right',
					ui:'plain',
					width:7,
					hidden:true,
					disabled:true
				},{
					itemId:'btnActivity',
					//tooltip :rvw_resources.R182,
					role:'mainpage',
					hidden:true,
					text: '',
					arrowVisible:true
				},
				{
					itemId:'btnArrow3',
					iconCls:'x-fa fa-angle-right',
					ui:'plain',
					width:7,
					hidden:true,
					disabled:true
				},
				{
					itemId:'txtIlboTitle',
					role:'mainpage',
					userCls:'x-ilbo-title',
					text:'',
					arrowVisible:false
					
				},
				'->',
				{
					itemId:'currentOU',
					hidden:true
				},{
					xtype:'combofield',
					itemId:'cmbTemplate',
					displayField:'text',
					valueField:'value',
					store:'TemplateStore',
					role:'mainpage',
					width:100,
					minWidth:100,
					queryMode: 'local',
					allowBlank: true,
					border:false,
					hidden: true,
					padding:2
				},{
					xtype:'textfield',
					itemId:'txtTemplate',
					role:'mainpage',
					minWidth:100,
					visibleLength: 15,
					hidden: true,
					emptyText: 'Template Name'
				},{
					xtype: 'checkbox',
					boxLabel: 'Set Default Template ',
					itemId: 'chkTemplate',
					role:'mainpage',
					checked: false,
					hidden: true
				},{
					itemId:'btnSave',
					iconCls:'x-fa fa-floppy-o',
					hidden: true,
					tooltip :rvw_resources.R183,
					role:'mainpage',
					text: ''
				},
				{
					itemId:'btnClear',
					iconCls:'x-fa fa-eraser',
					hidden: true,
					tooltip :rvw_resources.R099,
					role:'mainpage',
					text: ''
				},
				{
					itemId:'btnCancl',
					iconCls:'x-fa fa-times',
					hidden: true,
					tooltip :rvw_resources.R103,
					role:'mainpage',
					text: ''
				},
				'-',
				,{
					itemId:'smartlinknav',
					role:'mainpage',
					hidden: true,
					xtype:'toolbar'
				},{
					itemId:'btnUdsMenu',
					iconCls:'x-fa fa-list-alt',
					tooltip :rvw_resources.R184,
					hidden: true,
					role:'mainpage',
					text: ''
				},{
					itemId:'btnIlboSwitchContext',
					iconCls:'x-fa fa-caret-down',
					iconAlign:'right',		
					//tooltip :'ilboswitchcontext'					
					tooltip : rvw_resources.R329, //TECH-41247
					hidden: true,
					role:'ilboswitchcontext'					
				},{
					itemId:'btnTemplate',
					iconCls:'x-fa fa-list-alt',
					tooltip :rvw_resources.R185,
					hidden: true,						
					role:'mainpage',
					text: ''
				},{
					itemId:'btnTrailBar',
					iconCls:'x-fa fa-random',
					tooltip :'Trailbar',
					role:rvw_resources.R080,
					arrowVisible :false,
					menuAlign :'tr-br?',
					text: ''
				},{
					itemId:'btnPrintBar',
					iconCls:'x-fa fa-print', 
					tooltip :rvw_resources.R082,
					hidden: true,
					role:'mainpage',
					arrowVisible :false,
					menuAlign :'tr-br?',
					text: ''
				},{
					itemId:'btnRefresh',
					iconCls:'x-fa fa-refresh',
					tooltip :rvw_resources.R083,
					role:'mainpage',
					text: ''
				},{
					itemId:'btnSmartBar',
					iconCls:'tech-smartbar',
					tooltip :rvw_resources.R290,
					hidden:true,
					role:'mainpage',
					text: ''
				},{
					itemId:'btnHelp',
					iconCls:'x-fa fa-question',
					tooltip :rvw_resources.R086,
					role:'mainpage',
					text: ''
				},{
					itemId:'btnPreference',
					iconCls:'x-fa fa-cogs',
					tooltip :rvw_resources.R173,
					role:'mainpage',
					hidden: true,
					text: ''
				},{
					itemId:'btnDefaultMode',
					iconCls:'x-fa fa-cog',
					tooltip :rvw_resources.R188,
					role:'mainpage',
					hidden: false,
					text: ''
				}]
			}],
	},{
		region: 'south',
		height:30,
		margin:0,
		xtype:'statusbar',
		liquidLayout: true,
		itemId:'statusbarMain',
		defaultText: 'Default status text',
		defaultIconCls: 'default-icon',
		userCls:'x-main-statusbar',
		text: rvw_resources.R091,
		iconCls: 'ready-icon',
		border:true,
		hidden:true,
		items: [{
			itemId: 'errorDisplay',
			role: 'mainpage',
			xtype: 'ramcolabel',
			focusable: false,
			cls:'x-errordisplay',
			hidden:true,
			minWidth: 250,
			flex:1
		},{
			itemId: 'txtLastLogin',
			role: 'mainpage',
			dataType: 'date-time',
			xtype: 'ramcolabel',
			focusable: false,
			minWidth: 150,	
			cls: 'x-lastlogin'			
		},
		'-',
		{
			itemId:'txtTimeTaken',
			role:'mainpage',
			xtype:'component',
			minWidth:170,
			cls:"x-timetaken",
			tpl:'{s}'
		}, '-', {
			 text :rvw_resources.R089,
			 itemId:'accessKey',
			 role:'mainpage',
			 hidden:true,
			 menuAlign :'tr-br?'
	
			},{
			text:rvw_resources.R088,
			itemId:'btnErrorState',
			role:'mainpage',
			menu:'',
			menuAlign :'tr-br?',
			minWidth: 90,
			maxWidth: 90,
			arrowVisible: false,
			disabled:true
		},
		'-', 
		{
			itemId:'reactivateTime',
			iconCls:'x-fa fa-clock-o',
			tooltip :rvw_resources.R189,
			role:'mainpage',
			text: ''
		},						
		{
			xtype:'component',
			itemId:'sessionTimer',
			cls:'x-sessionTimer',
			html:'',
			width:75
		}, 
		'-', 
		{
			xtype:'trayclock',
			itemId:'trayClock',
			timeFormat: 'g:i A',
			width:70
		}]
	}]
});

// Main Controller
Ext.define('RamcoHub.controller.MainController', {
    extend: 'Ext.app.Controller',
    transcationTime: [],
    taskMgr: new Ext.util.TaskRunner(),
    proceed: false,
	maskCtrl: null,
	// TECH-29276
	dstRequired: [],
	multiSortGridData: [],
	//TECH-39454
	successMessage: "",
    config: {
        refs: {
            mainView: 'app-main',
            login: 'login',
            ilboView: '#ilboView',
            tblApp: '#tblApp',
			tblMain:'#tblMain',
			tblBPC: '#tblBPC',
			tickerHeader:'#tickerHeader',
            smartlinknav: '#smartlinknav',
            btnComponent: '#btnComponent',
            btnActivity: '#btnActivity',
            btnArrow1: "#btnArrow1",
            btnArrow2: "#btnArrow2",
            btnArrow3: "#btnArrow3",
			//favBtn: "#getFav", // TECH-32977
            ilboTitle: '#txtIlboTitle',
			txtBpcIlboTitle: '#txtBpcIlboTitle',
            cmbTemplate: '#cmbTemplate',
            txtTemplate: '#txtTemplate',
            chkTemplate: '#chkTemplate', // DefMode
            btnMenuDefault: '#btnMenuDefault',
			btnWorkAreaStyle: '#btnWorkAreaStyle', // TECH-28716
            trailBar: '#btnTrailBar',
			btnUdsMenu: '#btnUdsMenu', // TECH-29150
            dwLaunch: '#btnLaunchDW',
            statusBar: '#statusbarMain',
            errorDisplay: '#errorDisplay',//TECH-30310
            timeTaken: '#txtTimeTaken',
			lastLogin: '#txtLastLogin',
            sessionTimer: '#sessionTimer',
            btnErrorState: '#btnErrorState',
            reactivateTime: '#reactivateTime',
            accessKey: '#accessKey',
            username: '#ide_username',
            loginPanel: '#loginPanel',
            companyLogo: '#companyLogo',
            productLogo: '#productLogo',
            newTicker: '#newTicker',
            lblNewTicker: "#lblNewTicker",
			ilboSwitchContext:'#btnIlboSwitchContext',
			btnCancel: "#btnCancel",
			getFav: "#getFav",
			btnHome: "#btnHome",
			cmbActSearch: "#cmbActSearch",
			avnSearchField: "#avnSearchField",
			quickIlbo: '#quickIlbo',
			mainMenu: "#mainMenu",
			recentMenu: "#recentMenu",
			btnFavorites: "#btnFavorites",
			btnInbox: "#btnInbox",
			btnMenuTag: "#btnMenuTag",
			btnNewWindow: "#btnNewWindow", //TECH-39043
			btnThemes: "#btnThemes",
			userMenu: "#userMenu",
			btnSave: "#btnSave",
			btnClear: "#btnClear",
			btnCancl: "#btnCancl",
			btnTemplate: "#btnTemplate",
			btnPrintBar: "#btnPrintBar",
			btnRefresh: "#btnRefresh",
			btnSmartBar: "#btnSmartBar",
			btnPreference: "#btnPreference",
			btnDefaultMode: "#btnDefaultMode",
			btnHelp: "#btnHelp"
        },
        control: {
            'menuitem[role=mainpage]': {
                click: 'onMenuItemClick'
            },
            'menuitem[role=contextpage]': {
                click: 'onMenuContextClick'
            },
            'menuitem[role=favgroup]': {
                click: 'onFavMenuClick'
            },
            'menuitem[role=templategroup]': {
                click: 'onTemplateMenuClick'
            },
            'menuitem[role=trailbar]': {
                click: 'onTrailbarClick'
            },
            'menuitem[role=default]': {
                click: 'onInstanceClick'
            },
            'menuitem[role=themes]': {
                click: 'onThemeClick'
            },
			// TECH-29150
			'menuitem[role=uds]': {
                click: 'onUDSMenuClick'
            },
            'menuitem[role=trans]': {
                click: 'onTransClick'
            },
			// TECH-28716
            'button[role=workarea]': {
                click: 'onWorkAreaButtonClick'
            },
			'menuitem[role=workarea]': {
                click: 'onWorkAreaInstanceClick'
            },
            'button[role=mainpage]': {
                click: 'onButtonClick'
            },
            'button[role=appPreference]': {
                click: 'onSavePreferenceClick',
            },
			'button[role=ilboswitchcontext]': {
                click: 'onILBOSwitchContextClik',				
            },
			'button[role=ilboswitchcontextchange]': {
                click: 'onILBOSwitchContextChangeClik',
            },
			'combobox[role=ilboswitchcontext]': {
                select: 'onRoleSelect',                
            },
			//TECH-32503/CDIH-122
			 'combobox[role=segpers]': {
                select: 'onSegBtnChange',
				change: 'onSegBtnChange'  				
            },
            'field[role=mainpage]': {
                search: 'onSearchClick',
                change: 'onTextChange',
				menuListEdit:'onMenuListData',
				specialkey: 'onSpecialKey',
            },
			'ramcolistedit[role=mainpage]': {                
                specialkey: 'onMenuListSpecialKey',
				beforeselect: 'onActivitySelect',
				getMenuLstPageData: 'onGetMenuLstPageData'
            },
            'combofield[role=mainpage]': {
                beforequery: 'onBeforeMenuSearch',
                beforeselect: 'onActivitySelect'
            },
            'menucheckitem[role=mainpage]': {
                checkchange: 'onCheckChange'
            },
            'menucheckitem[role=rolepers]': {
                checkchange: 'onRoleCheckChange'
            },
            'button[role=favmenu]': {
                menuhide: 'onFavMenu',
				click: 'onMenuFavItemClick'
            },
            'login': {
                screeninit: 'onScreenInit',
                trans: 'onTrans',
				completed:'onCompleted'
            },
            'ilbo': {
                screeninit: 'onScreenInit',
				completed:'onCompleted',
                getdata: 'onGetData',
                gridtool: 'onGridToolAction',
                trans: 'onTrans',
				treegridexpand: 'onTreeGridExpanded', //TECH-28711
				oprototrans: 'onOProtoTrans',
                uilaunch: 'onUILaunch',
                wizard: 'onWizardTask',
                coldefaultsave: 'onColumnDefaultSave',
                coldefaultclear: 'onColumnDefaultClear',
				colfiltersave: 'onColumnFilterSave',
                colfilterclear: 'onColumnFilterClear',
                uitask: 'onExecuteTask',
                linktask: 'onExecuteLinkTask',
				dynamiclinktask:'onDynamicLinkTask',
                uimltask: 'onMLExecuteTask',
                mltrans: 'onMLTrans',
                wizardmltrans: 'onWizardMLTrans',
                wizardsteptrans: 'onWizardStepTrans',
                movetorow: 'onMoveToRow',
                help: 'onHelp',
                securitybuttonclick: 'onSecurityButtonClick',
                errors: 'onError',
                listdata: 'onListData',				
				griddata:'onGridData',
				customlistdata:'onCustomListData',				
                upload: 'onFileUpload',
                deletefile: 'onFileDelete',
                gridsearch: 'onSearch',
				avnactioncustom: 'onAvnActionCustom',				
                transfer: 'onTransfer',
                savepers: 'onSavePers',
                removepers: 'onRemovePers',
                colchoose: 'onColumnChoose',
                multisort: 'onMultiSort',
                clearmultisort: 'onClearMultiSort',
				persgetdoc: 'onPersGetDoc',
                deftemplate: 'onTemplateUpdate',
                destroy: 'onViewDestroy',
                persrole: 'onPersRole',
				getfavorites: 'onGetFavorites',
				getIlboData: 'onGetILBORoleOUData',
				applyIlboData: 'onApplyILBOOURoleData',
				gettreesearch: 'onGetTreeSearchData'
            },
            'ramcohelpwindow': {
                cancel: 'onCancel',
                Preference: 'onButtonClick',
				print: 'onModalPrint',
                refresh: 'onRefresh',
                help: 'onPageHelp',
                transfer: 'onTransfer',
                windowclose: 'onClose',
                cancl: 'onButtonClick',
                clear: 'onButtonClick',
                save: 'onButtonClick',
                addPage: 'onAddWindowPage',
				removePage:'onRemoveWindowPage'
            },
            'ramcomodalwindow': {
                cancel: 'onModalCancel',
                refresh: 'onRefresh',
                print: 'onModalPrint',
				smartbar: 'onSmartBar', // TECH-27458 - Modal level Smartbar
                help: 'onPageHelp',
                windowclose: 'onClose',
                addPage: 'onAddWindowPage',
                removePage: 'onRemoveWindowPage',
				// TECH-40634
				preference: 'onButtonClick',
				cancl: 'onButtonClick',
                clear: 'onButtonClick',
                save: 'onButtonClick'
            },
            'window': {
                beforehide: 'onWindowHide'
            },
            'ramcoctrlpers': {
                save: 'onUpdatePers',
                beforeshow: 'onPersBeforeRender'
            },
            'messagebox': {
                close: 'onMessageWindowClose'
            },
            'link[role=frgtpwd]': {
                click: 'onForgetPassword'
            },
            'uxiframe[role=iframereport]': {
                load: 'onLoadReport'
            }
        },
        taskDesc: null,
        timer: null,
        hasRunTask: false,
        isLogin: false,
		isBeforeLogin: true,		
        currentView: null,
        currentHelp: null,
        currentModel: null,
        lastUrl: null,
		lastIEDKUrl: {}, // TECH-32615 / PEPS-170
        lastTaskType: null,
		isLookUpLink: null, // AHBG-25962
        firstTimeLogin: false,
        forgotPwd: false,
        lastTask: null,
        wizBtns: null,
        inboxCount: null,
        inboxTaskPending: false,
		defaultActivityLaunched: false,
		invalidPageLaunch: false,
	    helpTask: null,
        tabInfo: null,
        personalization: null,
        defaultTemplate: null,
        defaultLaunch: null,
        defaultWizardTab: null,
        defaultTheme: null,
        favGrpdisp: null,
        persData: [],
        FavsMenu: [],
        defTemplateData: [],
        allWindowData: [],
        windowIndex: 0,
        lastMenuItem: null,
        lastTime: 1,
		preReportIlboText: null,
        showFavMenu: true,
		//TECH-36935
		activityDesc: ""
    },
    init: function() {
        var me = this;
        me.helpWindow = Ext.create('Ext.ramco.HelpWindow', {
            width: '95%',
            hidden: true,
			scrollable : 'y',
            modal: true
        });
        me.modalWindow = Ext.create('Ext.ramco.ModalWindow', {
            width: 'auto',
            hidden: true,
			scrollable : 'y',
            modal: true
        });
		me.smartWindow = Ext.create('Ext.ramco.SmartWindow', {            
            hidden: true,
			closeAction: 'hide',
			scrollable : 'y',
            modal: true
        });
		me.ilboswitchcontextwin = Ext.create('Ext.window.Window', {
			width: 305,
			height: 50,
			modal:true,
			floating: true,
			header: false,
			bodyPadding: 5,
			closeAction: 'hide',
			itemId:'ilboswitchcontextwin',
			layout: {
				type: 'ramcotable',
				columns: 3,
				tableAttrs: {
				  style: {
					width: '100%'
				  }
				},
				tdAttrs: {
				  style: {
					width: '33%'
				  }
				}
			},
			style: {
				'padding': '5px'
			},
			items: [{
				xtype: 'combofield',
				role:'ilboswitchcontext',				
				itemId: 'ctxtswrole',                    
				store: {
					fields: [
						{
							"name":"text",
							"type":"string"
						},
						{
							"name":"value",
							"type":"string"
						}
					],
					proxy: {
						type: 'memory',                            
					}
				},
				queryMode: 'local',
				displayField: 'text',
				valueField: 'value'
			},{
				xtype: 'combofield',
				itemId: 'ctxtswouinstance',				
				/* role:'ilboswitchcontext', */
				store: {
					 fields: [
						{
							"name":"text",
							"type":"string"
						},
						{
							"name":"value",
							"type":"string"
						}
					],
					proxy: {
						type: 'memory',                            
					}                        
				},
				queryMode: 'local',
				displayField: 'text',
				valueField: 'value'
			},{
					xtype: 'button',
					text: 'ok',
					itemId: 'okbtn',
					role:'ilboswitchcontextchange'
					/*handler: function(btn) {
						var wind = btn.up('window');
						wind.close();
					}*/
			}]
		});	
        /*me.ellipseWindow = Ext.create('Ext.ramco.Ellipse', {
            hidden: true,
            modal: true
        });*/
		//me.mask(true);
		getQueryStringtoArray(qsParm);
		RamcoHub.Reader = new Reader();
        RamcoHub.Writer = new Writer();
        Ext.Loader.setPath('RamcoHub', 'app/' + Ext.toolkit);
        uiFilePath += '/' + Ext.toolkit + '/';
        uiResourcePath = Ext.toolkit + "/resources/";
        RamcoRTC.cacheId = Ext.manifest.loader.cache;
		if(Ext.isEmpty(window.localStorage.getItem('lastUpdate'))) {
			window.localStorage.setItem('lastUpdate', new Date().getTime());
		}
		if (qsParm.ltype == "proto")
			RamcoRTC.isProto = true;
		if (qsParm.ltype == "gproto")
			RamcoRTC.isGProto = true;
		/*if (RamcoRTC.isPortal === true) {
			window.localStorage.setItem('reloaded', 'true');
			Ext.util.Cookies.set('reloaded', 'true');
		}*/
        me.initializeRTC().then(function(data) {
			if(window.localStorage.getItem('reloaded')== "true"){
				Ext.util.Cookies.set('reloaded', 'true');				
			}
			if (!Ext.isEmpty(qsParm.RVWRTQS_REQID))
				RamcoRTC.sessionToken = qsParm.RVWRTQS_REQID;
            RamcoRTC.initializeSession(
                function(data) {
                    this.initApplication(true, data);
                },
                function(data) {
                    this.initApplication(false, data);
                },
                me);
        }, function(data) {
            //me.mask(false);
            var fly = Ext.fly('splash');
            if (fly)
                fly.destroy();
            Ext.RamcoMsg.alert(rvw_resources.R052, rvw_resources.R231 + (data.message ? ' Reson : ' + data.message : ''));
        });
    },
    initializeRTC: function() {
        var me = this;
        return new Ext.Promise(function(resolve, reject) {
            RamcoRTC.initialize(
                function(data) {
                    resolve(data);
                },
                function(data) {
                    reject(data);
                });
        });
    },
    onBeforeRequest: function(conn, options, eOpts) {
        var taskName = options.params ? options.params.RVWRTQS_EVENTNAME : '',
            taskdesc = this.getTaskDesc() || taskName;
        this.setHasRunTask(true);
    },
	onGetFavorites: function() {
		var me = this,
			currentView = me.getCurrentView();
		RamcoRTC.doGetFavorites(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'fetch_favorites', 'async');
	},
	// TECH-28159 / TECH-26959
	resetGridMultiSort: function(workArea, ilbo, gridId) {
		// TECH-29395
		// TECH-29276
		/* if(workArea && ilbo && gridId)
			if(RamcoRTC.multiSortGridData[workArea] && RamcoRTC.multiSortGridData[workArea][ilbo] && RamcoRTC.multiSortGridData[workArea][ilbo][gridId])
				delete RamcoRTC.multiSortGridData[workArea][ilbo][gridId];
		else if(workArea && ilbo) 
			if(RamcoRTC.multiSortGridData[workArea] && RamcoRTC.multiSortGridData[workArea][ilbo])
				delete RamcoRTC.multiSortGridData[workArea][ilbo];
		else if(workArea) 
			if(RamcoRTC.multiSortGridData[workArea])
				delete RamcoRTC.multiSortGridData[workArea]; */

		var me = this;
		if(workArea && ilbo && gridId) {
			if(me.multiSortGridData[workArea] && me.multiSortGridData[workArea][ilbo] && me.multiSortGridData[workArea][ilbo][gridId])
				delete me.multiSortGridData[workArea][ilbo][gridId];
		}
		else if(workArea && ilbo)  {
			if(me.multiSortGridData[workArea] && me.multiSortGridData[workArea][ilbo])
				delete me.multiSortGridData[workArea][ilbo];
		}
		else if(workArea)  {
			if(me.multiSortGridData[workArea])
				delete me.multiSortGridData[workArea];
		}
	},
    onInboxComplete: function(response, options) {
        if (RamcoRTC.xhr)
            delete RamcoRTC.xhr;
        var me = this,
            currentView = me.getCurrentView(),
            controller = (currentView) ? currentView.getController() : null,
            splitArray = response.responseText,
            inboxElm = me.getBtnInbox();
		
		if (splitArray && splitArray.indexOf("Invalid session") > -1) {
			Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
			RamcoRTC.setSessionToken(null);
			me.mask(false);
			return;
		}
		
		splitArray = response.responseText.split('~#~');
        if (inboxElm && splitArray && splitArray.length > 1 && (!Ext.isEmpty(splitArray[1]) && !isNaN(splitArray[1]))) {
            var totalRows = splitArray[1] || 0,
				newReqId = splitArray[0];
            inboxElm.setBadgeText(totalRows);
            me.setInboxCount(totalRows);
            if (currentView && currentView.ilboConfig && currentView.ilboConfig.tabName == "myinbox") {
                var pageNum = currentView.down("#lblPageNo"),
                    inboxGrid = currentView.down("#mlmessageml"),
                    textNum = currentView.down("#txtPageNo"),
					pageIndex;
                if (pageNum && inboxGrid && totalRows && totalRows > 0) {
					pageIndex = inboxGrid.vsi || 1;
                    pageNum.setHtml(Math.ceil(totalRows / inboxGrid.visibleRows));
                    textNum.setValue(Math.ceil(pageIndex / inboxGrid.visibleRows));
                    textNum.focus();
                } else {
                    pageNum.setHtml(0);
                    textNum.setValue(0);
                }
            }
			//RamcoRTC.setSessionToken(newReqId);
            RamcoRTC.userInfo.asyncReqID = newReqId;
        }
		me.setInboxTaskPending(false);
		if (!me.getDefaultActivityLaunched()) {
			me.onDefaultActivityLaunch();
			//me.setDefaultActivityLaunched(false);
		}
		// TECH-31176
        /* Sending DelayedTask */
        /* Ext.defer(function() {
            var inboxPending = me.getInboxTaskPending();
            if (inboxPending == false && (!controller || controller.taskPending == false)) {
                me.setInboxTaskPending(true);
                RamcoRTC.doCountInboxMsg(me.onInboxComplete, me.onInboxException, me, 'getmsgcount', 'trans');
            }
        }, (RamcoRTC.settings.inboxCountTimer && !isNaN(RamcoRTC.settings.inboxCountTimer)) ? RamcoRTC.settings.inboxCountTimer * 60000 : 600000); */
    },
    onInboxException: function(response, options) {
        this.mask(false);
		RamcoRTC.setSessionToken(RamcoRTC.sessionToken);
        var me = this,
            currentView = me.getCurrentView(),
            controller = null;
        if (currentView) {
            controller = currentView.getController();
            if (controller)
                controller.taskPending = false;
        }
        me.setInboxTaskPending(true);
        // TECH-31176
		/* Sending DelayedTask */
        /* Ext.defer(function() {
            var inboxPending = me.getInboxTaskPending();
            if (inboxPending == false && (!controller || controller.taskPending == false)) {
                RamcoRTC.doCountInboxMsg(me.onInboxComplete, me.onInboxException, me, 'getmsgcount', 'trans');
            }
        }, 2000); */
    },
    getFavoritesMenu: function(dataArray) {
        var me = this,
            mainMenu = [],
            mainMenuItem = null,
            leafMenu = [],
            leafItem = null,
            parentMenu = [],
            parentItems = [],
            mainView;
        mainItems = dataArray.items;
        mainView = me;
        for (var i = 0; mainItems && i < mainItems.length; i++) {
            mainMenu = [];
            for (var j = 0; mainItems[i].items && j < mainItems[i].items.length; j++) {
                leafMenu = [];
                for (var k = 0; mainItems[i].items[j].items && k < mainItems[i].items[j].items.length; k++) {
                    var compVariables = mainItems[i].items[j].items[k],

                        leafItem = {
                            // TECH-29212
                            // text: compVariables.value,
							text: compVariables.html,
                            activity: compVariables.activity,
                            role: compVariables.role,
                            comp: compVariables.comp,
                            task: compVariables.task,
                            mainView: me,
                            ilbo: compVariables.ilbo,
                            handler: function(me, mainView) {
                                var me = this,
                                    _me = this.mainView;
                                _me.mask(true);
                                RamcoRTC.launchUI(_me.onRequestComplete, _me.onRequestException, _me, {
                                    componentName: me.comp,
                                    activityName: me.activity,
                                    ilboName: me.ilbo,
                                    isEdk: me.isedk ? me.edk : '',
                                    inlineTab: true
                                }, '');
                            }
                        }
                    leafMenu.push(leafItem);
                }
                mainMenuItem = {
                    text: mainItems[i].items[j].title,
                    hideOnClick: false,
                    menu: {
                        items: leafMenu
                    }
                }
                mainMenu.push(mainMenuItem)
            }
            parentMenu.push(mainMenu);
        }
        for (var i = 0; i < parentMenu.length; i++) {
            for (var j = 0; j < parentMenu[i].length; j++)
                parentItems.push(parentMenu[i][j]);
        }
        return (parentItems);
    },
    onSecurityButtonClick: function(btn, e, eOpts) {
        var me = this;
        if (me.modalWindow)
            me.modalWindow.hide();
        if (me.helpWindow)
            me.helpWindow.hide();
        me.setForgotPwd(false);
    },
    onFavMenuClick: function(item, e, eOpts) {
        if (this.taskPending)
            return;
        var me = this,
            obj = Ext.create('Ext.window.Window', {
                title: 'Create & Map to Group',
                width: 350,
                height: 125,
                modal: true,
                bodyPadding: 10,
                layout: {
                    type: 'ramcotable',
                    columns: 2,
                    tableAttrs: {
                        style: {
                            width: '100%'
                        }
                    },
                    tdAttrs: {
                        style: {
                            width: '50%'
                        }
                    }
                },
                style: {
                    'padding': '5px'
                },
                items: [{
                    xtype: 'label',
                    html: rvw_resources.R192 + ':',
                    captionAlign: 'left',
                    tdAttrs: {
                        style: {
                            'text-align': 'left'
                        }
                    },
                    forId: 'newGroup'
                }, {
                    xtype: 'textfield',
                    itemId: 'newGroup',
                    name: 'newGroup',
                    allowBlank: false,
                }],
                dockedItems: [{
                    xtype: 'ramcopanel',
                    bodyPadding: 5,
                    dock: 'bottom',
                    layout: 'hbox',
                    items: [{
                        xtype: 'component',
                        width: '25%'
                    }, {
                        xtype: 'button',
                        itemId: 'groupbutton',
                        text: rvw_resources.R193,
                        scope: me,
                        handler: function(btn) {
                            var wind = btn.up('window'),
                                view = me.getCurrentView(),
                                seq = view.favUi ? view.favUi.length : 1,
                                textObj = wind.getComponent('newGroup'),
                                textFieldValue = textObj ? textObj.getValue() : null;
                            if (Ext.isEmpty(textFieldValue)) {
                                Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R227);
                            } else {
								me.mask(true);
								// TECH-32726
								textFieldValue = purifyDom(textFieldValue);
                                RamcoRTC.doWindowUi(me.onRequestComplete, me.onRequestException, me, view.ilboConfig || {}, 'save_favorites', 'fav', [textFieldValue, seq, (view.ilboConfig || {})]);
                                wind.close();
                            }
                        }
                    }, {
                        xtype: 'component',
                        width: '25%'
                    }, {
                        xtype: 'button',
                        text: rvw_resources.R103,
                        itemId: 'cancelbtn',
                        handler: function(btn) {
                            var wind = btn.up('window');
                            wind.close();
                        }
                    }]
                }]
            }).show();
    },
    onRequestComplete: function(response, options) {
        var me = this,
            dataJson,
            className = '',
            menuStore = '',
            cmbSearch = '',
            errorMessage = '',
            mainView = me.getMainView(),
            ilboView = me.getIlboView(),
            ilboTitle = me.getIlboTitle(),
			txtBpcIlboTitle = me.getTxtBpcIlboTitle(),
			btnComponent = me.getBtnComponent(),
            btnActivity = me.getBtnActivity(),
			
			btnArrow2 = me.getBtnArrow2(), // TECH-32977
			favBtn = me.getGetFav(),
			// TECH-37478
			btnPrintBar = me.getBtnPrintBar(),
			btnPreference = me.getBtnPreference(),
			btnDefaultMode = me.getBtnDefaultMode(),
			btnHelp = me.getBtnHelp(),
			
            currentView = me.getCurrentView(),
            currentHelp = me.getCurrentHelp(),
            lastUrl = me.getLastUrl(),
            trailBar = me.getTrailBar(),
            UdsMenu = me.getBtnUdsMenu(), // TECH-29150
            smartlinknav = me.getSmartlinknav(),
            pers = me.getPersonalization(),
            persData = me.getPersData(),
            defTemplate = me.getDefaultTemplate(),
            dwLaunch = me.getDwLaunch(),
            btnDefault = me.getBtnMenuDefault(),
			btnWorkAreaStyle = me.getBtnWorkAreaStyle(), // TECH-28716
            btnThemes = me.getBtnThemes(),
            toolbarHide = me.getTblApp(),
			tblBPC = me.getTblBPC(),
            newTicker = me.getNewTicker(),
            lblNewTicker = me.getLblNewTicker(),
			ilboSwitchCtx = me.getIlboSwitchContext(),
            urlLCase,
            tabCtrl,
            tabVal,
            tagcloud,
            tagidentifier,
            tabItem,
            splitArray,
            jsondata,
            jsonArr,
            ezContext,
            btnMenuDefault,
            activeTab,
            cmbTemplate,
            txtTemplate,
            chkTemplate, // DefMode
            tempStore,
            timer = me.getTimer(),
            data = {},
            recent = 0,
            gridObj = null,
            gridObjColumn = null,
            record = null,
            tabTask = false,
            tempArr,
            tabView,
            statusBar = me.getStatusBar(),
			errorDisplay = me.getErrorDisplay(),//TECH-30310
			mboxObj,
            trayClock,
			miMessage;
        try {
            /* if (options && options.params && options.params.RVWRTQS_EVENTNAME == 'tskstdsort') {
                mainView.suspendEvents();
                mainView.suspendLayouts();
            } */
			// TECH-31176
            /* if (timer) {
                if (timer.stopped)
                    timer.start();
                else {
                    me.setLastTime(1);
                    me.OnTimer();
                }
            } else {
                me.setTimer(me.taskMgr.newTask({
                    run: me.OnTimer,
                    fireOnStart: true,
                    interval: 60000,
                    scope: me
                }));
                timer = me.getTimer();
            } */
			if (RamcoRTC.settings.isExt2 == true) {
				if (!currentView && toolbarHide) {
					toolbarHide.suspendLayouts();
					toolbarHide.hide();
					toolbarHide.resumeLayouts();
				}
				if (RamcoRTC.settings.isExt2 == true) {
					if (!currentView && tblBPC) {
						tblBPC.suspendLayouts();
						tblBPC.hide();
						tblBPC.resumeLayouts();
					}	
				}
			}
			else {
				if (!currentView && toolbarHide) {
					toolbarHide.suspendLayouts();
					toolbarHide.hide();
					toolbarHide.resumeLayouts();
				}
				if (RamcoRTC.settings.isExt2 == true) {
					if (!currentView && tblBPC) {
						tblBPC.suspendLayouts();
						tblBPC.hide();
						tblBPC.resumeLayouts();
					}	
				}
			}
            if (currentView && currentView.ilboConfig && currentView.ilboConfig.ilboName != "passremques" && currentView.ilboConfig.ilboName != "ondisablechangepwd" && toolbarHide && options.RTC != "" && (options.RTC != "recentMenu" && options.RTC != "menuSearch")) {                
				// TECH-32977
				//if (currentView.ilboConfig.ilboName == "ezwizard" || currentView.ilboConfig.ilboName == "ezelogin" || options.RTC == 'allMenu' || options.RTC == 'dummyinst')
				if (currentView.ilboConfig.ilboName == "ezelogin" || options.RTC == 'allMenu' || options.RTC == 'dummyinst')
					toolbarHide.hide();
				else {
					if (currentView.ilboConfig.ilboName == "ezwizard") {
						if (RamcoRTC.settings.requireHomeInWizard == true) {
							toolbarHide.show();
							btnActivity.hide();
							btnComponent.hide();
							btnArrow2.hide();
							favBtn.hide();
							btnPrintBar.hide();
						}
						else
							toolbarHide.hide();
					}
					else {
						toolbarHide.show();	 // TECH-30014
						btnActivity.show();
						btnComponent.show();
						btnArrow2.show();
						//TECH-39039
						if (!RamcoRTC.settings.hideMenuFavorites) {
							favBtn.show();
						}
						//btnPrintBar.show();
					}
				}
            }
			if (RamcoRTC.settings.isExt2 == true) {
				if (currentView && currentView.ilboConfig && currentView.ilboConfig.ilboName != "passremques" && currentView.ilboConfig.ilboName != "ondisablechangepwd" && tblBPC && options.RTC != "" && (options.RTC != "recentMenu" && options.RTC != "menuSearch")) {
					if (currentView.ilboConfig.ilboName == "ezwizard" || currentView.ilboConfig.ilboName == "ezelogin" || options.RTC == 'allMenu' || options.RTC == 'dummyinst')
						tblBPC.hide();
					else
						tblBPC.show(); // TECH-30014
				}	
			}
            switch (options.RTC) {
                case 'initSession':
                    me.initApplication(true, response);
                    break;
                case 'allMenu':
					Ext.USE_NATIVE_JSON = true;
                    dataJson = Ext.decode(response.responseText, true);
					Ext.USE_NATIVE_JSON = false;
					if(RamcoRTC.isOProto === true) {
						dataJson.trpi.menu.userinfo.n = RamcoRTC.uname;
						dataJson.trpi.menu.userinfo.fn = RamcoRTC.uname;
						dataJson.trpi.menu.userinfo.oud = "";
						dataJson.trpi.menu.userinfo.rd = "";						
					}
                    if (dataJson && !dataJson.message) {
                        RamcoRTC.setUserSessionInfo(dataJson);
                        RamcoRTC.setSessionToken(RamcoRTC.userInfo.rid);
                        me.configMainPage();
                    } else {
                        var fly = Ext.fly('splash');
                        if (fly)
                            fly.destroy();
                        if (dataJson && dataJson.message && dataJson.message == 'DUPLICATE SESSION') {
							window.onbeforeunload = null;
                            window.onunload = null;							
							window.location.replace('ilrt/rvw_window.htm?rid='+ dataJson.rid);
						}
                        //Ext.RamcoMsg.alert(rvw_resources.R052, rvw_resources.R244);
                        else
                            Ext.RamcoMsg.alert(rvw_resources.R052, rvw_resources.R232);
						me.mask(false);
                        return;
                    }
					
					// TECH-31176
                    //timer.start();
					
                    // TECH-29485 / ANZ-230
					var tickerHeader = me.getTickerHeader();
					if (!Ext.isEmpty(newTicker) && !Ext.isEmpty(tickerHeader)) {
						if (RamcoRTC.settings.hideTicker != true && !Ext.isEmpty(RamcoRTC.userInfo.scrMsg)) {
							tickerHeader.show();
							var interval = parseInt(RamcoRTC.userInfo.scrMsg.ri, 10);
							if (interval > 0) {
								newTicker.setAnimateInterval(interval * 10);
							}
							newTicker.setPauseOnMouseOver(RamcoRTC.userInfo.scrMsg.en);
							newTicker.setMessages(RamcoRTC.userInfo.scrMsg.msg);
							newTicker.start();
						}						
						else
							tickerHeader.hide();
					}
					
                    if (statusBar && RamcoRTC.settings.clockFormat) {
                        trayClock = statusBar.down('#trayClock');
                        trayClock.timeFormat = RamcoRTC.settings.clockFormat;
                    }
					else if(!Ext.isEmpty(qsParm["ltype"]) && RamcoRTC.isOProto === false) {
						var item = mainView.down('#defaulttheme');
						if (!Ext.isEmpty(item))
							me.onThemeClick(item);
						var ltype = "proto"
							activity = qsParm["la"],
							component = qsParm["lc"],
							ui= qsParm["lu"];							
							window.localStorage.setItem('reloaded', 'true');
							Ext.util.Cookies.set('reloaded', 'true');
							RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
								componentName: component,
								activityName: activity,
								ilboName: ui
							}, '');
					}
					else {
						// Get User Preferences
						RamcoRTC.doGetLaunchAppPreferences(me.onRequestComplete, me.onRequestException, me, (currentView && currentView.ilboConfig) || {});
					}					
					
					// TECH-28716
					if (!Ext.isEmpty(RamcoRTC.settings.workAreaRepresentation) && RamcoRTC.settings.workAreaRepresentation == 'style1') {
						btnDefault.hide();
						btnWorkAreaStyle.show();
					}
					else {
						var defText;
						defText = (!Ext.isEmpty(RamcoRTC.currentInstance) && RamcoRTC.currentInstance.toLowerCase() == 'wizard') ? 'Wizard' : 'Default Window';
						btnDefault.show();
						btnWorkAreaStyle.hide();
						btnDefault.setText(defText);
					}
					
                    if (RamcoRTC.userInfo.dwserver)
                        dwLaunch.show();
                    break;
                case 'recentMenu':
                    dataJson = Ext.decode(response.responseText, true);
                    var trpi = (RamcoRTC.osType == 'JAVA' && dataJson.trpi) ? dataJson.trpi.menu : dataJson.trpi,
						recent = 0;
					
					// TECH-32718
					if (trpi && trpi.rid)
						RamcoRTC.setSessionToken(trpi.rid);
					
					//TECH-32072	
                    if (dataJson && !dataJson.message && trpi && !Ext.Object.isEmpty(trpi.mi)) {
                    //if (dataJson && !dataJson.message && dataJson.trpi && dataJson.trpi.mi) {
						miMessage = dataJson.trpi.mi[0];						
						Ext.RamcoMsg.alert(rvw_resources.R052, miMessage.ds, function(btnId) {}, undefined, 'error', null);
					}
					//TECH-32072
					else if (dataJson && !dataJson.message && trpi && trpi.recs.length > 0) {
						//else if (dataJson && !dataJson.message && dataJson.trpi && dataJson.trpi.recs) {
                        for (; recent < trpi.recs.length; recent++) {
                            if (trpi.recs [recent].text == "Easy wizard") {
                                delete trpi.recs [recent];
                                break;
                            }
                        }
                        // TECH-32718
						//RamcoRTC.setSessionToken(trpi.rid);
                        RamcoRTC.setRecentActvities(dataJson);
                        me.configRecentActivities();
                    } 
					else {
                        var fly = Ext.fly('splash');
                        if (fly)
                            fly.destroy();
                        if (dataJson.message && dataJson.message == 'DUPLICATE SESSION'){
							window.onbeforeunload = null;
                            window.onunload = null;
							window.location.replace('ilrt/rvw_window.htm?rid='+ dataJson.rid);
						}
                        //Ext.RamcoMsg.alert(rvw_resources.R052, rvw_resources.R244);
                        else
							console.log(rvw_resources.R232);//TECH-32073
                           // Ext.RamcoMsg.alert(rvw_resources.R052, rvw_resources.R232);
                        return;
                    }
                    me.mask(false);
                    break;
                case 'gridExport':
                    RamcoRTC.doHtmlExport(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'htmlreport', '', '', options.params.RVWRTQS_CT);
                    me.mask(false);
                    break;
				case 'saveHtml':
					Ext.exporter.File.saveAs(response.responseText, "expothtml.html", "UTF-8", "text/html");
					me.mask(false);
					break;
                case 'exporttocsv':
                    splitArray = response.responseText.split('~#~');
                    if (splitArray.length > 1) {
                        RamcoRTC.setSessionToken(splitArray[0]);
                        RamcoRTC.doCSVExport(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'view', '', '', options.params.RVWRTQS_CT);
                        me.mask(false);
                    }
                    break;
				case 'exporttopdf':
                    splitArray = response.responseText.split('~#~');
                    if (splitArray.length > 1) {
                        RamcoRTC.setSessionToken(splitArray[0]);
                        RamcoRTC.doPDFExport(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'view', '', '', options.params.RVWRTQS_CT);
                        me.mask(false);
                    }
                    break;
				case 'treesearchdata':
					var mController = currentView.getController();
					if (mController)
						mController.taskPending = false;
					data = new DOMParser().parseFromString(response.responseText, "text/xml");                    
					data = RamcoRTC.processTreeSearchData(response, options);
					me.doHighLightTreeSearchData(data, options);
					me.mask(false);
					break;
                case 'abtvirtualworks':
                    me.onMenuItemClick(options.RTC, '', response.responseText)
                    me.mask(false);
                    break;
                case 'colSaveDefault':
                    data = new DOMParser().parseFromString(response.responseText, "text/xml");                    
					responseData = me.onColDefData(data, options);
					/* SETTING DATA BACK TO GRID FOR COLUMN DEFAULTING */
					data = RamcoRTC.processResponse(response, options);
					//TECH-33701
					if (responseData && responseData.gridId &&  data && data.data && data.data.ci && 
						data.data.ci[responseData.gridId] && 
						data.data.ci[responseData.gridId].value && 
						data.data.ci[responseData.gridId].value.store && 
						data.data.ci[responseData.gridId].value.store.length > 0) {
						if (currentHelp)
							currentHelp.setSessionData(data);
						else
							currentView.setSessionData(data);
					}
					/* ************************************************ */
                    RamcoRTC.doColumnSaveDefaults(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdsavepersonalization', 'rvwstandardtask', responseData.gridId, responseData, 'true');
                    me.mask(false);
                    break;
                case 'colSaveDefaultPers':
                    data = new DOMParser().parseFromString(response.responseText, "text/xml");
                    responseData = me.onColDefData(data, options);
                    me.mask(false);
                    break;
                case 'colClearDefault':
                    data = new DOMParser().parseFromString(response.responseText, "text/xml");
                    responseData = me.onColDefData(data, options);
                    RamcoRTC.doColumnClearDefaults(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdcleardefault', 'rvwstandardtask', options.params.RVWRTQS_PCONTROL, '', '');
                    me.mask(false);
                    break;
                case 'colClearDefaultPers':
                    data = new DOMParser().parseFromString(response.responseText, "text/xml");
                    responseData = me.onColDefData(data, options);
                    me.mask(false);
                    break;
                case 'gridExportReport':
                    data = new DOMParser().parseFromString(response.responseText, "text/xml");
                    responseData = me.onGridLoadData(data);
                    me.onGridRenderData(options.RTC, '', responseData);
                    me.mask(false);
                    break;
                case 'gridExportChart':
					//TECH-31782
                    data = (Ext.ieVersion != 0 && !Ext.isEmpty(response.responseXML)) ? response.responseXML : new DOMParser().parseFromString(response.responseText, "text/xml");
                    me.onGridLoadChartData(data);
                    me.mask(false);
                    break;
                case 'listData':
                    data = RamcoRTC.processListEdit(response, options);
					RamcoRTC.setSessionToken(RamcoRTC.sessionToken);					
                    if (data) {
						// XIP-516 / TECH-28336
						//if( data.messages && data.messages.length == 0) {
							if (data.message && data.message.length > 0)
								console.log(data.message[0].ds);
							if (currentHelp != null && !currentHelp.isHidden()) {
								currentHelp.setListData(data, options.targetCtrl, options.params.RVWRTQS_CONTROLVIEW, options.params.RVWRTQS_CONTROLNAME);
							}
							else if (currentView != null) {
								currentView.setListData(data, options.targetCtrl, options.params.RVWRTQS_CONTROLVIEW, options.params.RVWRTQS_CONTROLNAME);
							}
						//}
						// else {
							// console.log(data.messages[0].ds);														
						// }							
                    }
                    me.mask(false);
                    break;
				case 'customlistData':
					var mController = currentView.getController();
					if (mController)
						mController.taskPending = false;
					data = RamcoRTC.processCustomListEdit(response, options);
					RamcoRTC.setSessionToken(data.sessionToken);					
                    if (data) {
						// XIP-516 / TECH-28336
						if( data.message && data.message.length == 0) {
							if (currentHelp != null && !currentHelp.isHidden()) {
								currentHelp.setCustomListData(data, options.targetCtrl, options.params.RVWRTQS_PVIEW, options.params.RVWRTQS_PCONTROL);
							}
							else if (currentView != null) {
								currentView.setCustomListData(data, options.targetCtrl, options.params.RVWRTQS_PVIEW, options.params.RVWRTQS_PCONTROL);
							}
						}
						else {
							// XIP-516 / TECH-28336
							console.log(data.message[0].ds);
						}							
                    }
					me.mask(false)
					break;
				case 'validateFile':
					data = Ext.JSON.decode(response.responseText, true);
					RamcoRTC.setSessionToken(RamcoRTC.sessionToken);
					if (currentView && currentView.importWindow) {
						if (data) {
							currentView.importWindow.validationCode = data.code;
							currentView.importWindow.file = data.file;
							currentView.importWindow.showMessage(data.success, data, currentView.ilboConfig, options);
						}
						if(data && data.code == "200") {
							currentView.importWindow.BtnValidate.setDisabled(true);
							currentView.importWindow.BtnImport.setDisabled(false);
						}
					}
					me.mask(false);
					break;
				case 'csvdataresponse':
					data = Ext.JSON.decode(response.responseText, true);
					RamcoRTC.setSessionToken(RamcoRTC.sessionToken);
					if (currentView && currentView.importWindow) {
						if (data) {
							currentView.importWindow.validationCode = data.code;
							currentView.importWindow.file = data.file;
							currentView.importWindow.showMessage(data.success);							
						}
						if (data && data.code == "200") {
							currentView.importWindow.hide();
							Ext.destroy(currentView.importWindow);
							currentView.importWindow = null;
							delete currentView.importWindow;                            
							RamcoRTC.doMLTransaction(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdmovetorow', 'trans', '', options.params.RVWRTQS_CT, '1', '', '', '', '');
						}
					}
				case 'gridData':
                    data = Ext.JSON.decode(response.responseText, true);
					//TECH-31937
					RamcoRTC.sessionToken = response.getResponseHeader("Requid");
					RamcoRTC.setSessionToken(RamcoRTC.sessionToken);
					//TECH-39575
					if (currentHelp != null && !currentHelp.isHidden()) {
						me.mask(currentHelp.setGridFullData(data, options.targetCtrl));
					}
					else if (currentView != null) {
						me.mask(currentView.setGridFullData(data, options.targetCtrl));
					}
					break;
                case 'menuSearch':
                    data = Ext.JSON.decode(response.responseText, true);
					RamcoRTC.setSessionToken(RamcoRTC.sessionToken);
                    if (data && data.length > 0) {
                        menuStore = Ext.getStore('MenuStore');
                        menuStore.clearFilter();
                        menuStore.loadData(data);
                    }
                    cmbSearch = me.getCmbActSearch();
					if(cmbSearch && Ext.isFunction(cmbSearch.doAutoSelect)) {
						cmbSearch.doAutoSelect();
						// TECH-33892
						//if (!Ext.isEmpty(RamcoRTC.settings.actSearchCharLength))
						cmbSearch.expand();
					}
                    me.mask(false);
                    break;
				case 'avnMenuSearch':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
					
					splitArray = response.responseText.split('~#~');
					if (splitArray && splitArray.length > 1) {
                        RamcoRTC.setSessionToken(splitArray[0]);
						if (!Ext.isEmpty(splitArray[1])) {
							data = Ext.JSON.decode(splitArray[1], true);
                    	}
                    }
					if (data && data[0] == 500) {
						mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data[1], function(btnId) {}, undefined, 'error', null);
						if(mboxObj.msgButtons)
							mboxObj.msgButtons[0].focus(true);
						return;
					}
                    /* TECH-27116 */
                    if (data && data.response && data.response.docs && data.response.docs.length > 0) {
                        menuStore = Ext.getStore('AvnSearchStore');
                        menuStore.clearFilter();
						menuStore.st = data.response.start;
						menuStore.tr = data.response.numFound;
						menuStore.pgs = parseInt(data.responseHeader.params.rows, 10);
                        menuStore.loadData(data.response.docs);
                    }
                    cmbSearch = me.getCmbActSearch();
					if(cmbSearch && Ext.isFunction(cmbSearch.doAutoSelect))
						cmbSearch.doAutoSelect();
                    me.mask(false);
                    break;
				case 'quicksearchlaunch':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
					
					splitArray = response.responseText.split('~#~');
                    if (splitArray && splitArray.length > 1 && !Ext.isEmpty(splitArray[1])) {
                        RamcoRTC.setSessionToken(splitArray[0]);
						data = Ext.JSON.decode(splitArray[1], true);
                    }
					/*setTimeout(function(){
						//TECH-36492
						//me.doMenuSync(data.response.docs[0].ComponentName, data.response.docs[0].ActivityName, data.response.docs[0].ActivityName.ilbocode);
                    },10);*/
					RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
                        componentName: data.response.docs[0].ComponentName,
                        activityName: data.response.docs[0].ActivityName,
                        ilboName: data.response.docs[0].ilbocode
                    }, '');					
					break;
				case 'quickilbolaunch':
					this.taskPending = false;			
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}					
					splitArray = response.responseText.split('~#~');
                    if (splitArray && splitArray.length > 1 && !Ext.isEmpty(splitArray[1])) {
                        RamcoRTC.setSessionToken(splitArray[0]);
						data = Ext.JSON.decode(splitArray[1], true);
                    }
					if (Ext.isEmpty(data) && typeof splitArray[1] == "string") {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray[1]);						
					}
					else if (data && data.length > 0) {
						RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
							componentName: data[1],
							activityName: data[2],
							ilboName: data[3]
						}, '');
					}
					break;
				case 'getavncustomdata':
					var vController = currentView.getController();
					if (vController)
						vController.taskPending = false;
					data = Ext.JSON.decode(response.responseText, true);
					me.mask(false);					
					if (data.SuccessFlag.toLowerCase() == 'n') {
						mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.ErrMsg,
								 function(btnId) {}, undefined, 'error', null);
						if(mboxObj.msgButtons)
							mboxObj.msgButtons[0].focus(true);						
					}
					else {
						if (currentView && currentView.avnuplctrl) {
							setTimeout(function() {
								currentView.avnuplctrl.setCustomData(data);								
							}, 50);
						}
					}
					break;
                case 'preference':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
					
					splitArray = response.responseText.split('~#~');
					if (splitArray && splitArray.length > 1 && !Ext.isEmpty(splitArray[1])) {
						RamcoRTC.setSessionToken(splitArray[0]);
						if (response.responseText.indexOf('appsettpref') > -1) {
							RamcoRTC.doGetLaunch(me.onRequestComplete, me.onRequestException, me, (currentView && currentView.ilboConfig) || {});
							me.mask(true);
						}
						else
							me.mask(false);
					}
                    
                    var defWinObj = me.appPrefWindow;
					if (defWinObj)
						defWinObj.close();
                    break;
				case 'appprefdata':
                case 'getlaunchdata':
					// TECH-33892
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
					splitArray = response.responseText.split('~#~');
					if (splitArray && splitArray.length > 1 && !Ext.isEmpty(splitArray[1])) {
						RamcoRTC.setSessionToken(splitArray[0]);
						var xmlStr = "<Test>" + splitArray[1] + "</Test>", parser, optVal,
							btnPreference = me.getBtnPreference(),
							btnDefaultMode = me.getBtnDefaultMode();
						try {
							parser = new DOMParser();
							data = parser.parseFromString(xmlStr,"text/xml");
							
							if (data && me.isValidXML(data)) {
								optNode = data.querySelectorAll("opt");
								for (i = 0; optNode && i < optNode.length; i++) {
									me.optName = optNode[i].getAttribute('optname');
									optVal = optNode[i].getAttribute('optvalue');
									switch (me.optName) {
										case "applaunch":
											me.setDefaultLaunch(optVal);
											break;
										case "wiztab":
											// TECH-39589
											if (optVal == 'wizard')
												optVal = 'wizard1';
											me.setDefaultWizardTab(optVal);
											break;
										case "deftheme":
											me.setDefaultTheme(optVal);
											break;
										case "favGrpdisp":
											me.setFavGrpdisp(optVal);
											break;
										case "implementorUsers":
											if (!Ext.isEmpty(optVal))
												RamcoRTC.isEntUser = (optVal.toLowerCase() == 'y') ? true : false;
											break;
									}
								}
								
								// TECH-27432 - Ilbo Level Personalisation and Defaults Hide									
								if (RamcoRTC.isEntUser == false && RamcoRTC.settings.hidePersonalisation == true)
									btnPreference.hide();
								else
									btnPreference.show();
								
								if (RamcoRTC.isEntUser == false && RamcoRTC.settings.hideDefaultMode == true)
									btnDefaultMode.hide();
								else
									btnDefaultMode.show();
								
								if ((Ext.isEmpty(RamcoRTC.settings.enableTenantCSS) || RamcoRTC.settings.enableTenantCSS === false) && Ext.isEmpty(RamcoRTC.settings.customerTheme)) {
									var defTheme = me.getDefaultTheme(), item;
									if (!Ext.isEmpty(defTheme)) {
										if (RamcoRTC.settings.isExt2 == true) {											
											if (defTheme == 'bluetheme')
												defTheme = 'bluetheme';
											else if (defTheme == 'default_theme')
												defTheme = 'defaulttheme';
											else if (defTheme == 'graytheme')
												defTheme = 'graytheme';											
										}
										else {
											if (defTheme == 'bluetheme' || defTheme == 'articblue')
												defTheme = 'hydra';
											else if (defTheme == 'default_theme' || defTheme == 'greentheme')
												defTheme = 'aqua';
											else if (defTheme == 'bluejay' || defTheme == 'graytheme')
												defTheme = 'granite';
										}
		                            }
									else {
										// TECH-37062
										if (RamcoRTC.settings.isExt2 == true) {
											// TECH-39037
											if (!Ext.isEmpty(RamcoRTC.userInfo.defTheme))
												defTheme = RamcoRTC.userInfo.defTheme;
											else
												defTheme = 'articblue';
										}
										else {
											defTheme = 'hydra';
										}
									}
										// TECH-30743 JAVA - Case checking
									defTheme = defTheme.toLowerCase();
										
									item = mainView.down('#' + defTheme);
									if (!Ext.isEmpty(item))
										me.onThemeClick(item);
								}
	                        }
						}
						catch(ex) { Ext.RamcoMsg.alert(rvw_resources.R260, ex.message); }							
							
						if (options.RTC == 'getlaunchdata')
							Ext.RamcoMsg.alert(rvw_resources.R260, 'Application User Preferences Saved');
						else {
							// Do check for Instance
						if(!Ext.isEmpty(RamcoRTC.userInfo.forcecmp) && !Ext.isEmpty(RamcoRTC.userInfo.forceact) && !Ext.isEmpty(RamcoRTC.userInfo.forceilb)) {
							me.onForcedActivityLaunch();
							return;
						}
							me.setDefaultActivityLaunched(false);
							if (RamcoRTC.settings.enableWizard) {
								if (!RamcoRTC.settings.disableWizardInboxCountDisplay) {
									me.setInboxTaskPending(true);
									//me.setDefaultActivityLaunched(true);
									RamcoRTC.doCountInboxMsg(me.onInboxComplete, me.onInboxException, me, 'getmsgcount', 'trans');
									return;
								} else {
									if (me.getDefaultLaunch() == "WIZARD") {
										RamcoRTC.currentInstance = 'wizard';
										RamcoRTC.wizardLaunched = true;
										RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
											componentName: 'ezwizard',
											activityName: 'ezwizard',
											ilboName: 'ezwizard',
											inlineTab: true,
											tabName: me.getDefaultWizardTab()
										}, '');
										return;
									}
									else {
										var inboxTimer = me.getBtnInbox();
										if (inboxTimer)
											inboxTimer.removeCls('x-btn-button-badge', '');
									}
								}
							}
							
							if(!me.getDefaultActivityLaunched())
								me.onDefaultActivityLaunch();									
						}
                    }
                	//me.mask(false);
					break;
                case 'menutag':
                    jsondata = response.responseText;
                    jsonArr = jsondata.split('~#~');
                    tabCtrl = currentView.down('tabpanel');
                    tabVal = tabCtrl.getActiveTab();
                    if (jsonArr.length > 1) {
                        RamcoRTC.setSessionToken(jsonArr[0]);
                        data = Ext.JSON.decode(jsonArr[1]);
                        tagidentifier = Ext.getStore('tagidentifier');
                        tagidentifier.clearFilter();
                        tagidentifier.loadData(data);
                        tagcloud = currentView.down('#cloud');
                        if (tagcloud.el && tagcloud.el.dom.getElementsByTagName('a').length == 0) {
                            tagcloud.refresh();
                            currentView.updateLayout();
                        }
                    }
					// TECH-38435
					currentView.showWizardTitle('Menu Tag');
                    me.mask(false);
                    break;
                case 'favorites':
                    jsondata = response.responseText;
                    jsonArr = jsondata.split('~#~');
                    tabCtrl = currentView.down('#tabcontrol');
                    tabVal = tabCtrl.getActiveTab();
                    if (jsonArr.length > 1) {
                        RamcoRTC.setSessionToken(jsonArr[0]);
                        data = Ext.JSON.decode(jsonArr[1]);
						// TECH-28264
						if (data && data.items) {
							if (tabVal.items) {
								tabVal.items.each(function(item) {
									tabVal.remove(item);
								});
							}
							var favItems;
							if(currentView) {
								if (currentView.callout && currentView.callout.buildWizardCustomControls) {									
									favItems = currentView.callout.buildWizardCustomControls.call(currentView || window, 'favorites', data.items);
									if (!Ext.isEmpty(favItems))
										tabVal.add(favItems);
								}
							}
							//TECH-38726
							if (currentView && currentView.tabTask && currentView.ilboConfig && currentView.ilboConfig.ilboName == 'ezwizard') {
                                var pView = '',
                                    pCtrl = '',
                                    btnMenuDefault = me.getBtnMenuDefault(),
                                    ezContext = btnMenuDefault.query('menucheckitem');
                                currentView.ezValue = [];
                                for (i = 0; i < ezContext.length; i++) {
                                    if (ezContext[i].itemId == 'Wizard')
                                        continue;
                                    currentView.ezValue.push({
                                        itemId: ezContext[i].text,
                                        text: ezContext[i].text,
                                        role: 'contextpage'
                                    });
                                }
                                if (currentView.activeTabName == "myinbox" || RamcoRTC.actWizItem == 'myinbox') {
                                    currentView.setControlData('txthdrtextctrl', 'txthdrtextctrl', 0, '::#::::#::::#::::#::');
                                    pView = 'txthdrtextctrl';
                                    pCtrl = 'txthdrtextctrl';
                                }
                                var tData = currentView.getViewModel() && currentView.getViewModel().getSessionData();
                                RamcoRTC.doWizardTransactions(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, currentView.tabTask, 'trans', tData, null, '', '', pCtrl, pView);
                            }
						}
						else {
							RamcoRTC.doWizardTask(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, '', 'favorites', []);
                    	}
                    }
					// TECH-38435
					currentView.showWizardTitle('Favorites');
                    me.mask(false);
                    break;
                case 'menumap':
                    jsondata = response.responseText;
                    jsonArr = jsondata.split('~#~');
                    tabCtrl = currentView.down('#tabcontrol');
                    tabCtrl.setActiveTab('menumap');
                    tabVal = tabCtrl.getActiveTab();
                    if (jsonArr.length > 1) {
                        RamcoRTC.setSessionToken(jsonArr[0]);
                        data = Ext.JSON.decode(jsonArr[1]);
                        if (data && data.items) {
							if (tabVal.items) {
								tabVal.items.each(function(item) {
									tabVal.remove(item);
								});
							}
                            tabVal.add(data.items);
                    	}
                    }
					// TECH-38435
					currentView.showWizardTitle('Menu Map');
                    me.mask(false);
                    break;
                case 'colGetRoles':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
					
                    if (response.responseText.indexOf('~#~') > -1) {
						//TECH-30301
                        var colArr = response.responseText.split('~#~'),
                            persArr = null,currViewOrHelp = null;
                        if (colArr && colArr.length > 1 && !Ext.isEmpty(colArr[1])) {
                            RamcoRTC.setSessionToken(colArr[0]);
							persArr = Ext.JSON.decode(colArr[1]);
							//TECH-30301
							currViewOrHelp = currentHelp || currentView;
	                        currViewOrHelp.persrole = persArr;
							if(Ext.isFunction(currViewOrHelp.callBack)) {
								currViewOrHelp.callBack();
								currViewOrHelp.callBack = null;
								delete currViewOrHelp.callBack;
							}
						}
                    }
                    break;
                case 'colGetPers': // DefModeChanges
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
                    if (response.responseText.indexOf('~#~') > -1) {
                        var colArr = response.responseText.split('~#~'),
                            ctrlId = null;
						// TECH-36636
                        //if (colArr && colArr.length > 1 && !Ext.isEmpty(colArr[1])) {
                        if (!Ext.isEmpty(colArr) && colArr.length > 0) {
                            RamcoRTC.setSessionToken(colArr[0]);
							// TECH-37101 / PTP-133
							if (!Ext.isEmpty(colArr[1]) && colArr[1].indexOf('<') > -1)
                                data = RamcoRTC.processPersonalization(colArr[1], options);
                            ctrlId = options.params.RVWRTQS_CTRL;
							currentView = currentHelp || currentView;
                        }
						
						// DefModeChanges
						
						cmbTemplate = me.getCmbTemplate();
						txtTemplate = me.getTxtTemplate();
						chkTemplate = me.getChkTemplate();
						btnTemplate = me.getBtnTemplate();
						
                        if (data) {
							if (data.message)
								delete data.message;
							if (data.messages)
								delete data.messages;
							if (ctrlId) {
								if (pers && persData)
									data = persData;
								if (currentView) {
									currentView.updatePersonalization(ctrlId, data);
								}
								//TECH-31711
								if(me.columnPers){
									me.setPersData(data);
									delete me.columnPers;
								}
                            }
							else if (pers) {
								if (currentView) {
									me.setPersData(data);
									/* CLEARING THEME COMBO ON PERSONALIZATION */
									cmbTemplate.hide();
									txtTemplate.hide();
									chkTemplate.hide();
									if (!currentHelp || currentHelp.isHidden()) {
										currentView.performPersonalization(data);
									} else {
										currentHelp.performPersonalization(data);
									}
								}
                            }
							else if (defTemplate) {
	                            if (currentView) {
									var cmbValue, tempStore;
									me.setDefTemplateData(data);
									tempStore = cmbTemplate.getStore();
									tempStore = Ext.getStore('TemplateStore');
									cmbTemplate.show();
									//txtTemplate.show();
									chkTemplate.show();
									cmbValue = currentView.performDefaultTemplate(data);									
									if (!Ext.isEmpty(cmbValue)) {
										tempStore.loadData(cmbValue);
										cmbTemplate.setStore(tempStore);
										tempStore.sync();
									}
								}
							}
							if (!Ext.isEmpty(data.xml))
								me.configGetTemplate(data.xml);
							else if (Ext.isObject(data) && Object.keys(data).length == 0) {
								btnTemplate.hide();
								btnTemplate.setMenu(null);
							}
	                    }
						else {
							txtTemplate.suspendLayouts();
							txtTemplate.setValue('');
							txtTemplate.resumeLayouts();
							
							cmbTemplate.suspendLayouts();
							cmbTemplate.setValue('');
							cmbTemplate.resumeLayouts();
							
							chkTemplate.suspendEvents();
							chkTemplate.setValue(false);
							chkTemplate.resumeEvents();
							
							btnTemplate.hide();
							btnTemplate.setMenu(null);
						}
	                }
					
					// TECH-28978
					currentView = currentHelp || currentView;
					if(Ext.isFunction(currentView.callBack)) {
						currentView.callBack();
						currentView.callBack = null;
						delete currentView.callBack;
					}
					else
                    	me.mask(false);
                    break;
                case 'colSavePers':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
                    if (response.responseText.indexOf('~#~') > -1) {
                        var colArr = response.responseText.split('~#~'),
                            pers = me.getPersonalization(),
                            temp = me.getDefaultTemplate(),
                            className = null,
                            ctrlId = null;
                        //if (colArr && colArr.length > 1 && !Ext.isEmpty(colArr[1])) {
                        if (colArr && colArr.length > 1) {
                            RamcoRTC.setSessionToken(colArr[0]);
                        }
						/* COLUMN CHOOSER -> Search Combo Columns Update */
						try {
							var payLoadData = options.payload,
								responseData = new DOMParser().parseFromString(payLoadData, "text/xml"),
								gridXML, gridName, curViewOrHelp = currentHelp || currentView,
								gridCols, colObj, gTBar, fList,
								colData = [{vid: 'v0',name: rvw_resources.R007}];
							
							if (responseData && me.isValidXML(responseData)) {
								gridXML = responseData.querySelector('Grid');
								if (gridXML) {
									gridName = gridXML.getAttribute('name');
									gridObj = curViewOrHelp.down('#' + gridName);
									if (gridObj) {
										gTBar = gridObj.getComponent('gridToolbar');
										fList = gTBar ? gTBar.getComponent('fieldList') : null;
										gridCols = gridObj.getVisibleColumns();
										for (var k = 0; gridCols && gridCols.length > 0 && k < gridCols.length; k++) {
											colObj = gridCols[k];
											if(colObj && colObj.dataIndex != 'sel' && colObj.dataIndex != 'rn') {
												colData.push({vid: colObj.dataIndex,name: colObj.text || ''});
											}
										}
										if (fList && fList.getStore()) {
											fList.getStore().setData(colData);
											fList.setValue('v0');
										}
									}
								}								
							}							
						}
						catch(ex) {console.log('ColChooserComboUpdate Exception ' + ex);}
                        if (currentView && (pers || temp)) {
                            me.setPersonalization(false);
                            me.setDefaultTemplate(false);
							//TECH-30301
							RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, curViewOrHelp.ilboConfig || {}, 'tskstdrefresh', 'trans', null, null);
                            /* url = me.getLastUrl();
                            className = me.convertUrlToPage(url);
                            me.loadPage(className);
                            me.setLastUrl(url);
                            RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'GETDOC', 'personalization', '', ''); */
                        } else
                            me.mask(false);
                    } else
                        me.mask(false);
                    break;
                case 'setFav':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
					
                    splitArray = response.responseText.split('~#~');
					if (splitArray && splitArray.length > 1 && !Ext.isEmpty(splitArray[1])) {
					    RamcoRTC.setSessionToken(splitArray[0]);
	                    messageArray = splitArray[1];
						if (messageArray.indexOf('{') == 0 || messageArray.indexOf('[') == 0) {
							if (messageArray && messageArray.indexOf('[{') != -1)
								message = Ext.decode(messageArray, true) || [];
							else
								message = [];
							message[message.length] = {}
							message[message.length - 1].text = 'Create Group';
							message[message.length - 1].role = 'favgroup';
							if (message) {
								me.configGetFav(message,false);//TECH-28231
							}
							if(RamcoRTC.isFavActMenu)
									RamcoRTC.isFavActMenu = false;//TECH-28231
							// TO BE REVIEWED
							//RamcoRTC.getFavsAsMenu(me.onRequestComplete, me.onRequestException, me);//TECH-28231
							//me.setShowFavMenu(false);
						}
						else {
							Ext.RamcoMsg.alert(rvw_resources.R260, messageArray);
						}
					}                    
                    me.mask(false);
                    break;
                    // Entire case TO BE REVIEWED
                case 'getFavsAsMenu':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
					
					splitArray = response.responseText.split('~#~');
					if (splitArray && splitArray.length > 1 && !Ext.isEmpty(splitArray[1])) {
						RamcoRTC.setSessionToken(splitArray[0]);
						messageArray = splitArray[1];
						if (messageArray.indexOf('{') == 0 || messageArray.indexOf('[') == 0) {
							dataArray = Ext.decode(messageArray, true);
							if (dataArray) {
								var menuItems, favMenu;
								menuItems = me.getFavoritesMenu(dataArray);
								me.setFavsMenu(menuItems);
								favMenu = me.getFavsMenu();
								me.configGetFavsAsMenu(favMenu);
							}
						}
						else {
							//Ext.RamcoMsg.alert(rvw_resources.R260, messageArray);
							//TECH-32073
							console.log(messageArray);
						}
					}                    
					me.mask(false);
                    break;
                case 'getFav':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
                    splitArray = response.responseText.split('~#~');
					if (splitArray && splitArray.length > 1 && !Ext.isEmpty(splitArray[1])) {
	                    RamcoRTC.setSessionToken(splitArray[0]);
	                    messageArray = splitArray[1];
	                    tempArr = splitArray[2] || '';
	                    viewModel = currentView.getViewModel();
	                    if (viewModel) {
	                        viewModel.modified = [];
	                    }
	                    if (tempArr.indexOf('<') > -1) {
	                        data = RamcoRTC.processPersonalization(tempArr, options);
	                        if (data) {
	                            var getView = me.getBtnTemplate();
	                            if (!Ext.isEmpty(data.xml))
	                                me.configGetTemplate(data.xml);
	                            else
	                                getView.hide();
	                        }
	                    } else {
	                        var getView = me.getBtnTemplate();
	                        getView.hide();
	                    }
						if (messageArray && messageArray.indexOf('[{') != -1)
	                        message = Ext.decode(messageArray, true) || [];
	                    else
	                        message = [];
	                    message[message.length] = {}
	                    message[message.length - 1].text = 'Create Group';
	                    message[message.length - 1].role = 'favgroup';
	                    if (message) {
							me.configGetFav(message,true);//TECH-28231
	                    }                    
	                    if (pers) {
	                        if (currentView) {
	                            me.setPersData(data);
	                            /* CLEARING THEME COMBO ON PERSONALIZATION */
	                            cmbTemplate = me.getCmbTemplate();
	                            txtTemplate = me.getTxtTemplate();
								chkTemplate = me.getChkTemplate(); // DefMode
	                            cmbTemplate.hide();
	                            txtTemplate.hide();
								chkTemplate.hide(); // DefMode
	                            if (!currentHelp || currentHelp.isHidden()) {
	                                currentView.performPersonalization(data);
	                            } else {
	                                currentHelp.performPersonalization(data);
	                            }
	                        }
	                    } else if (defTemplate) {
	                        if (currentView) {
	                            me.setDefTemplateData(data);
	                            cmbTemplate = me.getCmbTemplate();
	                            txtTemplate = me.getTxtTemplate();
								chkTemplate = me.getChkTemplate(); // DefMode
	                            tempStore = cmbTemplate.getStore();
	                            tempStore = Ext.getStore('TemplateStore');
	                            cmbTemplate.show();
	                            txtTemplate.show();
								chkTemplate.show(); // DefMode
	                            var cmbValue = currentView.performDefaultTemplate(data);
	                            tempStore.loadData(cmbValue);
	                            cmbTemplate.setStore(tempStore);
	                            tempStore.sync();
	
	
	                        }
	                    }
					}
                    // TECH-29150
                    /* if (currentView && !currentView.callBack && currentView.ilboConfig && currentView.ilboConfig.ilboName != "ezwizard" && (pers || defTemplate || currentView.ilboConfig.ilboName != 'ezelogin'))
                        RamcoRTC.doAsyncCall(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {});
                    else */
                        me.mask(false);
                    break;
                case 'printScreen':
                    var colArr = response.responseText.split('~#~');
                    if (colArr && colArr.length > 1) {
                        RamcoRTC.setSessionToken(colArr[0]);
                    }
                    //var viewOrHelp = currentView || currentHelp;
					var viewOrHelp = currentHelp || currentView;
                    RamcoRTC.doPrintExport(me.onRequestComplete, me.onRequestException, me, viewOrHelp.ilboConfig || {}, 'view', 'printexport', '', null);
                    return;
                    break;
                case 'dummyinst':
                    data = RamcoRTC.processResponse(response, options);
                    if (data.sessionToken)
                        RamcoRTC.setSessionToken(data.sessionToken);
                    var defMenu = btnDefault.getMenu(),
                        className = null,
						currInstance;
                        
                    
					// TECH-28716
					if (!Ext.isEmpty(RamcoRTC.settings.workAreaRepresentation) && RamcoRTC.settings.workAreaRepresentation == 'style1') {
						currInstance = RamcoRTC.currentInstance || 'default';
						currInstance = btnWorkAreaStyle.down('#' + currInstance);
					}
					else {
						currInstance = RamcoRTC.currentInstance || 'Default Window';
						currInstance = (currInstance == 'default') ? 'Default Window' : currInstance;
						currInstance = defMenu.items.getByKey(currInstance);
					}
					
					me.lastInst = currInstance.lastInst = ilboView.remove(currentView);
					
					//currentView.hide();
					//Ext.destroy(ilboView.remove(currentView));
                    me.setCurrentView(null);
					/* if (RamcoRTC.currentInstance == 'default' && RamcoRTC.userInfo.launchdefault == true && RamcoRTC.userInfo.defac && RamcoRTC.userInfo.defic) {
                        me.onDefaultActivityLaunch();
                    } else  */
					if (RamcoRTC.currentInstance == 'Wizard') {
                        RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
                            componentName: 'wizard',
                            activityName: 'ezwizard',
                            ilboName: 'ezwizard'
                        }, '');
                        RamcoRTC.wizardLaunched = true;
                    } else if (currInstance.ilboConfig && currInstance.lastUrl && currInstance.ilboConfig.ilboName != 'ezelogin') {
                        /* if (!Ext.isEmpty(currInstance.pageConfig)) {
							me.onLoadMapSuccess(currInstance.pageConfig);
						} */
						//else {
                        className = me.convertUrlToPage(currInstance.lastUrl);
                        me.loadPage(className);
                        me.setLastUrl(currInstance.lastUrl);
						//}
                    } else {
						// TECH-27239 / AHBG-25709
						RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentView && currentView.ilboConfig || {}, 'tskstdcancel', 'dummyinstcancel', null, null);
                    }
                    break;
				case 'dummyinstcancel':
					data = RamcoRTC.processResponse(response, options);
                    if (data.sessionToken)
                        RamcoRTC.setSessionToken(data.sessionToken);
					
					//ilboView.remove(currentView);
					//me.setCurrentView(null);
					me.mask(false);
					break;
                case 'wizStep':
					splitArray = response.responseText;
					if (splitArray && splitArray.indexOf("Invalid session") > -1) {
						Ext.RamcoMsg.alert(rvw_resources.R260, splitArray);
						RamcoRTC.setSessionToken(null);
						me.mask(false);
						return;
					}
					
                    splitArray = response.responseText.split('~#~');
					//if (splitArray && splitArray.length > 1 && !Ext.isEmpty(splitArray[1])) {
                    if (splitArray)
                        RamcoRTC.setSessionToken(splitArray[0]);
					var _ilboConfig = { activityName: options.params.RVWRTQS_ST_LNCH_ACT, componentName: options.params.RVWRTQS_ST_LNCH_CMPNT, ilboName: options.params.RVWRTQS_ST_LNCH_ILBO, tabName: '' };
					RamcoRTC.doWizardTransactions(me.onRequestComplete, me.onRequestException, me, _ilboConfig || {}, 'tskstdlaunch', 'trans', currentView.getSessionData(), null, '', '', {}, {}, 'stepLaunch');
                    break;
                case 'rvwAsync':
					// TECH-29150
					RamcoRTC.setSessionToken(RamcoRTC.sessionToken);
					//TECH-30301
					var currViewOrHelp = currentHelp || currentView;
					if(response && response.responseXML) {
						data = response.responseXML.querySelectorAll("config > udslinks > lang");
						if (data) {
							var _data, linksArray, linkObj, menuObj = [], udsLinkName;
							_data = data[0];
							if (_data) {
								linksArray = _data.querySelectorAll('link');
								if (linksArray && linksArray.length > 0) {
									for (var j = 0; j < linksArray.length; j++) {
										linkObj = linksArray[j]; // TECH-30166
										if (linkObj && linkObj.nodeType == 1) {
											udsLinkName = linkObj.getAttribute('udslinkname');
											menuObj.push({
												text: linkObj.getAttribute('udsuidesc'),
												linkName: udsLinkName,
												langId: _data.getAttribute('id'),
												role: 'uds'
											});
										}
									}
									if (UdsMenu && menuObj.length > 0) {
										UdsMenu.show();
										UdsMenu.setMenu(menuObj);
									}
								}
								else {
									UdsMenu.hide();
									UdsMenu.setMenu(null);
								}
							}
						}
						else {
							UdsMenu.hide();
							UdsMenu.setMenu(null);
						}
					}
					if(RamcoRTC.osType == "JAVA" && currViewOrHelp && !Ext.isEmpty(currViewOrHelp.down('tabpanel')))//TECH-30233
						currViewOrHelp.ilboConfig.isTabScreen = true;
					//TECH-30301
					RamcoRTC.initializeUI(me.onRequestComplete, me.onRequestException, me, currViewOrHelp.ilboConfig || {}, ''); 
				    //me.mask(false);
                    break;
				case 'ILBOOURoleData':								
					if (RamcoRTC.isProto)
						return;			
					data = RamcoRTC.processResponse(response, options);
					if (data.sessionToken)
						RamcoRTC.sessionToken = data.sessionToken;
					var cbRole, cbOU, ilboObj, trialBarMenu, trailbarLen;
					ilboObj = me.ilboswitchcontextwin;
					cbRole = ilboObj.down("#ctxtswrole");
					cbOU = ilboObj.down("#ctxtswouinstance");
					trialBarMenu = trailBar.getMenu();
					if (trialBarMenu)
						trailbarLen = trialBarMenu.items.length;
					if(data.data.ci.ctxtswrole) {
						cbRole.store.loadRawData(data.data.ci.ctxtswrole.store);
						cbRole.select(data.data.ci.ctxtswrole.value);
					}
					if(data.data.ci.ctxtswouinstance) {
						cbOU.store.loadRawData(data.data.ci.ctxtswouinstance.store);
						cbOU.select(data.data.ci.ctxtswouinstance.value);
					}					
					if(ilboSwitchCtx && trailbarLen == 2) {
						ilboObj.showBy(ilboSwitchCtx, 'tl-bl?');
						cbRole.focus();
					}
					break;	
                case 'dummyTask':
                    data = RamcoRTC.processResponse(response, options);
                    RamcoRTC.setSessionToken(data.sessionToken);
					// TECH-29150
					if (currentView.callBack) {
						currentView.callBack.call();
						currentView.callBack = null;
						delete currentView.callBack;
					}
                    //me.mask(false);
                    break;
				case 'oprotoLogin':
					data = Ext.JSON.decode(response.responseText, true);
					if (data) {
						if(data[0] == "200") {
							me.signInSuccess(true);							
							return;
						}
					}
					break;
                case 'gridMultiSort':
					// TECH-34273
					data = RamcoRTC.processResponse(response, options);
					RamcoRTC.setSessionToken(data.sessionToken);
					try {
						var curViewOrHelp = currentHelp || currentView,
							gridId = options.params.RVWRTQS_PCONTROL,
							// TECH-28159 / TECH-26959
							multiSortGrid = curViewOrHelp.down('#' + gridId),
							multiSortGridWindow = (multiSortGrid) ? multiSortGrid.multiSortWindow : null,
							//processViews = RamcoRTC.lastFocusCtrl[2],
							//Defect Id: TECH-26959
							workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default",
							// TECH-29531
							ilbo = curViewOrHelp.ilboConfig.ilboName,
							processViews = (me.multiSortGridData[workArea] && me.multiSortGridData[workArea][ilbo] && me.multiSortGridData[workArea][ilbo][gridId]) ? me.multiSortGridData[workArea][ilbo][gridId][1] : null,
							processItemId, gridHeaderItem, sortOrder;
							
						if (data)
							curViewOrHelp.setSessionData(data);
						
						// TECH-28159 / TECH-26959
						if(options.sortState == 'clear') {
							me.resetGridMultiSort(workArea, ilbo, gridId);
						}
						
						// TECH-34273
						if (multiSortGrid && processViews)
							multiSortGrid.applyGridMultiSort(processViews, options.sortState);
						
						var chkPeristence = multiSortGridWindow && multiSortGridWindow.down('#chkMultiPersistence'),
							hasPersistence = chkPeristence && chkPeristence.checked;
						
						if (multiSortGridWindow) {
							multiSortGridWindow.close();
							/* multiSortGrid.multiSortWindow = null;
							delete multiSortGrid.multiSortWindow; */
						}
						
						// TECH-34273
						if (hasPersistence) {
							//curViewOrHelp.callBack = function() {
								var sortData = [];
								if (options.sortState != 'clear')
									sortData = multiSortGrid.multiSortData;
								sortData.hasSortPersistence = true;
								RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, curViewOrHelp.ilboConfig, 'SAVEDOC', 'personalization', gridId, sortData);
								//return;
							//}
						}
					}
					catch(ex) {}
					me.mask(false);
					break;
				case 'uiMethod':
                    //var viewModel = (currentView) ? currentView.getViewModel() : null;
                    me.addTime('Processing and Binding Data');
                    data = RamcoRTC.processResponse(response, options);
                    if (data.sessionToken)
                        RamcoRTC.setSessionToken(data.sessionToken);
					//TECH-36673
					if (options.params.RVWRTQS_EVENTNAME)
						me.setLastTask(options.params.RVWRTQS_EVENTNAME);
                    if (data.iEDK == '1') {
						// TECH-32615 / PEPS-170
						var instance = (RamcoRTC.currentInstance) ? RamcoRTC.currentInstance : 'default';
						if (!Ext.isEmpty(data.URL))
							me._lastIEDKUrl[instance] = data.URL;
                        RamcoRTC.iEDK = data.iEDK;
					}
					else
						RamcoRTC.iEDK = '0';

					// TECH-29276
					// TECH-29531
					// var controllerMain = getMainController(),
					var workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";

					// if(!controllerMain.dstRequired[workArea])
					//	controllerMain.dstRequired[workArea] = [];

					if(!me.dstRequired[workArea])
						me.dstRequired[workArea] = [];

					if(data.data && data.data.dst) 
						// controllerMain.dstRequired[workArea][options.params.RVWRTQS_ILBO] = data.data.dst;
						me.dstRequired[workArea][options.params.RVWRTQS_ILBO] = data.data.dst;
					//TECH-30310
					if((errorDisplay && errorDisplay.isVisible()) && (data.message.length == 0 || (data.message.length > 0 && data.message[0].sv !="6"))){
						errorDisplay.setVisible(false);
						errorDisplay.setValue("");	
					}

                    urlLCase = data.URL ? data.URL.toLowerCase() : '';
					// XIP-516 / TECH-28336
                    if (data.message.length > 0) {
						if(!Ext.isEmpty(currentView)){
								if (currentView.callout && currentView.callout.doHideMessage) {
									var hideMsg = currentView.callout.doHideMessage.call(me || window,data.data.taskName,data.message[0].ds);
									if(hideMsg){
										me.setLastTaskType("");
										me.mask(false);
										return;
									}
										
								}
						}
						// XIP-516 / TECH-28336 / TECH-29394
                        if (data.message[0].sv == 5 || data.message[0].sv == 1 || (Ext.isString(data.message[0].sv) && (data.message[0].sv.toLowerCase() == "stop" || data.message[0].sv.toLowerCase() == "error"))){						
							if (data.data.taskName == 'tskstdlaunch' || data.data.taskName == 'tskstdlaunchedk') {
                                // TECH-29150
								if (currentView != null && currentView.isEdkLaunched != true) {
                                    Ext.destroy(ilboView.remove(currentView));
									var ilMenu = ilboTitle.getMenu(),
										coMenu = btnComponent.getMenu(),
										acMenu = btnActivity.getMenu();                                    
									if(!Ext.isEmpty(ilMenu)) {
										ilboTitle.setMenu(null);
										if (txtBpcIlboTitle)
											txtBpcIlboTitle.setMenu(null);										
										Ext.destroy(ilMenu);
									}									
									if(!Ext.isEmpty(coMenu)) {
										btnComponent.setMenu(null);
										Ext.destroy(coMenu);
									}
									if(!Ext.isEmpty(acMenu)) {
										btnActivity.setMenu(null);
										Ext.destroy(acMenu);
									}
									if (RamcoRTC.settings.isExt2 == true) {
										if (toolbarHide)
											toolbarHide.hide();
									}
									else {
										/*if (toolbarHide)
											toolbarHide.hide();*/
									}
									
									if (RamcoRTC.settings.isExt2 == true && tblBPC) {
										tblBPC.hide();
									}
                                }
                                // me.doMenuSync();
                            }
							else if (currentHelp != null) {
								//TECH-30370
								//currentHelp.setSessionData({data:{taskName:data.data.taskName}});
								if (currentHelp && currentHelp.isVisible())
									currentHelp.setSessionData({data:{taskName:data.data.taskName}});
								else if (currentView)
									currentView.setSessionData({data:{taskName:data.data.taskName}});    
							   if (RamcoRTC.isWindowClose === true && me.modalWindow && !me.modalWindow.isHidden()) {
									currentHelp.modalClose = false;									
									me.modalWindow.hide();
									me.setLastTaskType("");
							   }
							}
                            else if (currentView != null)
								currentView.setSessionData({data:{taskName:data.data.taskName}, hasError: (data.message[0].sv == 5)}); // TECH-35955
                            if (options.params.RVWRTQS_TYPE == 'import' || options.params.RVWRTQS_EVENTNAME == 'fileupload') {
                                if (currentView && currentView.importWindow)
                                    currentView.importWindow.showMessage(data.message[0].ds); // XIP-516 / TECH-28336
                                else if (currentView && currentView.browseWindow)
                                    currentView.browseWindow.showMessage(data.message[0].ds); // XIP-516 / TECH-28336
								else if (currentView && currentView.avnuplctrl && currentView.avnuplctrl.avnUploadWin)
									currentView.avnuplctrl.avnUploadWin.showMessage(data.message[0].ds); // XIP-516 / TECH-28336
								else {
									// XIP-516 / TECH-28336
                                    mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds,
										function(btnId) {
												var cView = null;												
													cView = me.getCurrentView();
													if(Ext.isEmpty(cView))
														cView = me.getCurrentHelp();
													//TECH-36142
													if(cView && !cView.isDestroyed && typeof cView.focusPage == "function")
														cView.focusPage(true);
											}, undefined, 'error', data.messages.length > 1 ? data.messages : null);
									//if (me.popupSec)
										//me.popupSec = null;
									if(mboxObj.msgButtons)
										mboxObj.msgButtons[0].focus(true);
								}
                                if (currentView)
                                    delete currentView.tabTask;
                                me.mask(false);
                                return;
                            }
							// XIP-516 / TECH-28336
                            if (data.message[0].ds.indexOf('dispatcher.aspx') != -1)
                                data.message[0].ds = rvw_resources.R243;
                            if (data.data.taskName == 'tskstdquit') {
								var logoutQueryString = getLogoutQueryParam(data.URL),
									logoutURL;
                                window.onbeforeunload = null;
                                window.onunload = null;
                                if (!Ext.isEmpty(RamcoRTC.userInfo.isportallogin) && !Ext.isEmpty(RamcoRTC.settings.defaultPortalLogoutPage))
                                    window.location.replace(RamcoRTC.settings.defaultPortalLogoutPage);
								else if(!Ext.isEmpty(RamcoRTC.settings.defaultLogoutPage)){//TECH-27719 {
									//window.location.replace(RamcoRTC.settings.defaultLogoutPage);
									logoutURL = getCreateURL(RamcoRTC.settings.defaultLogoutPage, logoutQueryString);
									window.location.replace(logoutURL);
								}
                                else {
                                    if (!Ext.isEmpty(data.URL))
                                        window.location.replace(data.URL.replace('../', ''));
                                    else {										
                                        //window.location.replace('ilrt/rvw_logout.htm');
										window.location.replace(getCreateURL('ilrt/rvw_logout.htm', logoutQueryString));
									}
                                }
                                return;
                            } 
							else {
								if (response && response.ErrFlag && response.ErrFlag == "true")
								mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, response.ErrMsg, 
										function(btnId) {
												var cView = null;												
													cView = me.getCurrentView();
													if(Ext.isEmpty(cView))
														cView = me.getCurrentHelp();
													//TECH-36142
													if(cView && !cView.isDestroyed && typeof cView.focusPage == "function")
														cView.focusPage(true);
										}, undefined, 'error');
								else {
									// XIP-516 / TECH-28336	
									var errMsg = data.message[0].ds,
										exp = data.message[0].exp;
									if (RamcoRTC.osType == 'JAVA') {
										if (errMsg.indexOf('ORA-20000:') != -1)
											errMsg = errMsg.substring(errMsg.indexOf('ORA-20000:') + 10, errMsg.indexOf('ORA-06512:'));
									}
									//mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.messages[0].ds,
									
									// TECH-29121 - Single User Mode - Handling									
									if (!Ext.isEmpty(exp) && exp == 'SESSIONDEL') {
										mboxObj = Ext.RamcoMsg.confirm(rvw_resources.R260, errMsg, function(btnId) {
											var cView = me.getCurrentView(),
												cViewConfig = cView.rendered && cView.ilboConfig;
											if (btnId == 'yes' || btnId == 'ok') {
												if (!Ext.isEmpty(cViewConfig) && (cViewConfig.activityName == 'login' || cViewConfig.activityName == 'Logon')) {
													cView.fireEvent('trans', cView, [], 'tskstdlogin', 'trans', '', '', '', 0, 0, 'MSGOKBUTTON');
													return;
												}
											}
										}, undefined, 'warning', data.messages.length > 1 ? data.messages : null);
									}
									else {
										// TECH-29802
										var messageGrid;
										if(RamcoRTC.osType == "JAVA")
											messageGrid = data.messages;
										else {
											if(data.messages.length > 1) 
												messageGrid = data.messages;
											else
												messageGrid = null;
										}
										mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, errMsg, function(btnId) {
											var cView = null;
												cView = me.getCurrentView();
											if(Ext.isEmpty(cView))
												cView = me.getCurrentHelp();
											// TECH-39402
											me.setLastTaskType(null);
											if(cView && cView.coCtrlName)
												delete	cView.coCtrlName;
											if(me.coCtrlId)
												delete me.coCtrlId;
											delete me.popupSec;
											me.popupSec = null;
											//TECH-36142
											if(cView && !cView.isDestroyed && typeof cView.focusPage == "function")
												cView.focusPage(true);											
											if(RamcoRTC.osType != "JAVA") { //TECH-29806
												if(data.data.taskName == "transfer") {
													// TECH-31814
													if (me.helpWindow && me.helpWindow.isVisible()) {
														me.onRemoveWindowPage(me.helpWindow);
														if(me.getWindowIndex() <=0) {
															me.setCurrentHelp(null);
															currentView.getTaskData(0);
															return;
														}	
													}
													else if (data.URL){
														className = me.convertUrlToPage(data.URL);
														me.loadPage(className);
														me.setLastUrl(data.URL);
														return;
													}
												}
											}
										// TECH-29802
										//}, undefined, 'error', data.messages.length > 1 ? data.messages : null);	
										}, undefined, 'error', messageGrid);
										if (!RamcoRTC.settings.hideSmartlinks && !Ext.isEmpty(smartlinknav) && (data.data.taskName == 'tskstdscreeninit' || data.data.taskName == 'tskstdinstancenav')) {
											me.setSmartBardata(smartlinknav, data, currentHelp, currentView);
										}
									}
									//TECH-38726/ TECH-38522
									if(currentView && currentView.ilboConfig && currentView.ilboConfig.ilboName == 'ezwizard')
										RamcoRTC.wizardLaunched = false;
									if (currentView && currentView.isCancel)
										currentView.isCancel = false;
									else if(currentHelp && currentHelp.isCancel)
										currentHelp.isCancel = false;
	                            }
								//if (me.popupSec)
									//me.popupSec = null;
								if(mboxObj.msgButtons)
									mboxObj.msgButtons[0].focus(true);
                            }
                            if (currentView && currentView.popupClose)
                                currentView.popupClose = false;
                            else if (currentHelp && currentHelp.popupClose)
                                currentHelp.popupClose = false;
                            if (currentView && currentView.modalClose)
                                currentView.modalClose = false;
                            else if (currentHelp && currentHelp.modalClose)
                                currentHelp.modalClose = false;
                            if (me.isCallout)
                                me.isCallout = false;
                            if (me.isCancel == true)
                                me.isCancel = false;
                            /*if (data.data.taskName == 'tskstdlaunch' || data.data.taskName == 'tskstdlaunchedk') {
                                if (currentView != null) {
                                    Ext.destroy(ilboView.remove(currentView));
									var ilMenu = ilboTitle.getMenu(),
										coMenu = btnComponent.getMenu(),
										acMenu = btnActivity.getMenu();                                    
									if(!Ext.isEmpty(ilMenu)) {
										ilboTitle.setMenu(null);
										Ext.destroy(ilMenu);
									}
									if(!Ext.isEmpty(coMenu)) {
										btnComponent.setMenu(null);
										Ext.destroy(coMenu);
									}
									if(!Ext.isEmpty(acMenu)) {
										btnActivity.setMenu(null);
										Ext.destroy(acMenu);
									}
                                    if (toolbarHide)
                                        toolbarHide.hide();
                                }
                                // me.doMenuSync();
                            } 
							else if (currentHelp != null)
                                currentHelp.setSessionData({data:{taskName:data.data.taskName}});
                            else if (currentView != null)
                                currentView.setSessionData({data:{taskName:data.data.taskName}});*/
                            if (currentView) {
                                currentView.tabTask = null;
                                delete currentView.tabTask;
                            }
							if (data && data.URL)
								me.setLastUrl(data.URL);
                            me.setLastTaskType('');
                            me.mask(false);
                            return;
                        } 
						// XIP-516 / TECH-28336
						else if (data.message[0].sv == 6) {
                            //TECH-30370
							/*if (currentHelp != null)
                               currentHelp.setSessionData(data);
                            else if (currentView != null)
                               currentView.setSessionData(data);*/
							if (currentHelp && currentHelp.isVisible())
								currentHelp.setSessionData(data);
							else if (currentView)
								currentView.setSessionData(data);
                            if (data.data.taskName == "tskstdlogin") {
								// XIP-516 / TECH-28336
                                messages = [{
                                    sr: data.message[0].sr,
                                    sv: data.message[0].sv,
                                    cd: data.message[0].cd,
                                    ds: data.message[0].ds,
                                    ca: ''
                                }];
                                me.setFirstTimeLogin(true);
                                me.setLastUrl(data.URL);
								me.mask(false);
								// XIP-516 / TECH-28336
                                mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds, function(btnId) {
                                    if (btnId == "ok") {
										if (urlLCase.indexOf('homepage_homepage') > -1 || urlLCase.indexOf('rvw_blank') > -1 || urlLCase.indexOf('rvw_launch') > -1) {	
											me.setFirstTimeLogin(false);
											me.signInSuccess(true);
											 //TECH-34441
											me.windowReload();
											return;
										}
										else {
                                        me.setLastTaskType('modal');
                                        me.firstSignIn(true);
                                    }
									}
                                }, undefined, 'info', messages);
								if (me.popupSec)
									me.popupSec = null;
								if(mboxObj.msgButtons)
									mboxObj.msgButtons[0].focus(true);
                                return;
                            } 
							else if (data.data.taskName == "tsksave") {
								if(options.params.RVWRTQS_ILBO == "passremques"){
									me.mask(false);
									// XIP-516 / TECH-28336
									mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds, function(btnId) {
										if (btnId == "ok") {
											if(!Ext.isEmpty(data.URL)){
												//TECH-36142
												/* if(data.URL.indexOf('rvw_blank') < 0 ){
													me.mask(true);
													className = me.convertUrlToPage(data.URL);
													me.loadPage(className);
													me.setLastUrl(data.URL);
													me.mask(false);
												} */
												if(data.URL.indexOf('homepage_homepage') > 0  || data.URL.indexOf('rvw_blank') > 0){
													me.windowReload();
												}
												else{
													me.mask(true);
													className = me.convertUrlToPage(data.URL);
													me.loadPage(className);
													me.setLastUrl(data.URL);
													me.mask(false);
												}
												return;
											}else{
												var currHelp = null;
												currHelp = me.getCurrentHelp();
												currHelp.fireEvent('trans', currHelp, null, 'secmaieenmainpgmuauthli', 'trans');
											}
												
										}
									}, undefined, 'info');
									return;
								}else if(!Ext.isEmpty(data.URL)){
									className = me.convertUrlToPage(data.URL);
									me.loadPage(className);
									me.setLastUrl(data.URL);
									me.mask(false);
									return;
								}
							}else if(currentView && currentView.ilboConfig.ilboName == 'passremques') {
                                me.mask(false);
							} else if(RamcoRTC.osType == 'JAVA'&& data.data.taskName == "submit"){
									// XIP-516 / TECH-28336
									messages = [{
	                                    sr: data.message[0].sr,
	                                    sv: data.message[0].sv,
	                                    cd: data.message[0].cd,
	                                    ds: data.message[0].ds,
	                                    ca: ''
									}];
									me.setFirstTimeLogin(true);
									me.mask(false);
									// XIP-516 / TECH-28336
									mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds, function(btnId) {
                                    if (btnId == "ok") {
											if(!Ext.isEmpty(data.URL)){
												me.mask(true);
												className = me.convertUrlToPage(data.URL);
												me.loadPage(className);
												me.setLastUrl(data.URL);
												me.mask(false);
												return;
											}
                                    }
									}, undefined, 'info', messages);
									return;
							
							}
							else {
                                //Ext.RamcoMsg.alert(rvw_resources.R260, data.messages[0].ds, me.onSuccessMessageClose, me, 'info');
								var curViewOrHelp = currentHelp;
								
								if (Ext.isEmpty(curViewOrHelp))
									curViewOrHelp = currentView;
								
								if (curViewOrHelp && curViewOrHelp.followUpTasks) {
									var followupObj, followupTask = null, followupData; //TECH-32419
									for (var key in curViewOrHelp.followUpTasks) {
										if (key == curViewOrHelp.lastTaskName) {
											followupObj = curViewOrHelp.followUpTasks[key];
											if (followupObj)
												followupTask = (followupObj[data.message[0].cd]) ? followupObj[data.message[0].cd].task : null; // XIP-516 / TECH-28336
											break;
										}
									}
									
									if (!Ext.isEmpty(followupTask)) {
										//TECH-32419
										followupData = followupObj[data.message[0].cd];
										if (followupData && !Ext.isEmpty(followupData.hideMessage) && followupData.hideMessage === true) {											
											me.setIsLookUpLink(true);
											curViewOrHelp.fireEvent('trans', curViewOrHelp, null, followupTask, 'trans', "", "", "", followupData.width, followupData.height, "", "", "modal");
											return;
										}
										else {
											this.mask(false);
											// XIP-516 / TECH-28336
											Ext.RamcoMsg.followUp(rvw_resources.R260, data.message[0].ds, function(btnId) {											
												if (btnId == "tcontinue") {
													this.mask(true);
													curViewOrHelp.fireEvent('trans', curViewOrHelp, null, followupTask, 'trans', "", "", "","modal");
												}
												else {
													var controller = curViewOrHelp.getController();
													if (controller)
														controller.taskPending = false;
													this.mask(false);
													return;
												}
											},
											me, 'info');
											return;
										}
									}
									else {
										// XIP-516 / TECH-28336
										mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds, function(btnId) {
											var cView = null;
											if(btnId == "ok") {
												me.onSuccessMessageClose(options);
												if (me.popupSec)
													me.popupSec = null;
											}
											cView = me.getCurrentView();
											if(Ext.isEmpty(cView))
												cView = me.getCurrentHelp();
											//TECH-36142
											if(cView && !cView.isDestroyed && typeof cView.focusPage == "function")
												cView.focusPage(true);
										}, me, 'info');
										// if (me.popupSec)
											// me.popupSec = null;
										if(mboxObj && mboxObj.msgButtons)
											mboxObj.msgButtons[0].focus(true);
									}
								}
								if(curViewOrHelp) {
									var lookupStatus = false, 
										lookupTask = null,
										sData = [],
										lookupSize = {width: null, height: null};//TECH-32419
									if (curViewOrHelp.callout && curViewOrHelp.callout.checkMessageLookup) {
										try {
											// AHBG-25962
											// XIP-516 / TECH-28336
											//TECH-32419
											//lookupStatus = curViewOrHelp.callout.checkMessageLookup.call(me || window, data.data.taskName.toUpperCase(), data.message[0].cd); 
											lookupStatus = curViewOrHelp.callout.checkMessageLookup.call(me || window, data.data.taskName.toUpperCase(), data.message[0].cd, lookupSize);
											curViewOrHelp.lookupStatus = lookupStatus;
											if (lookupStatus === true) {
												lookupTask = "tskstderror";
												me.setLastTaskType("modal");
												//TECH-32419
												if (me.modalWindow) {
													me.modalWindow.childWidth = lookupSize.width;
													me.modalWindow.childHeight = lookupSize.height;
												}
												// AHBG-25962
												me.setIsLookUpLink(true);
												//data = curViewOrHelp.getSessionData();
												// XIP-516 / TECH-28336
												RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, curViewOrHelp.ilboConfig || {}, lookupTask, 'link', sData, data.data.taskName +"~"+data.message[0].cd, null, null, null, null);
												//curViewOrHelp.fireEvent('trans', curViewOrHelp, null, lookupTask, 'trans');
											}
											else {
												// XIP-516 / TECH-28336
												var l = 0, len = data.message.length, _errorMsg = data.message[0].ds;
												if (len > 1) {
													for(; l < len; l++) {
														if(data.message[l].sv == '5') {
															_errorMsg = data.message[l].ds;
															break;
														}
													}
												}
												if (options.params.RVWRTQS_ILBO != "passremques" && options.params.RVWRTQS_ILBO != "ondisablechangepwd") {
													mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, _errorMsg, function(btnId) {
														var cView = null;
														if(btnId == "ok") {
															me.onSuccessMessageClose(options);
														}
														cView = me.getCurrentView();
														if(Ext.isEmpty(cView))
															cView = me.getCurrentHelp();
														//TECH-36142
														if(cView && !cView.isDestroyed && typeof cView.focusPage == "function")
															cView.focusPage(true);
													}, me, 'info');
													me.mask(false);
												}
											}
										}
										catch (msglp) {
											console.log("Error in Callout Js - checkMessageLookup" + msglp);
										}
									}
									else {									
										//TECH-30310
										if(RamcoRTC.prefs.ERROR_DISPLAYMODE == "PAGE"){
											// XIP-516 / TECH-28336
											mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds, function(btnId) {
												var cView = null;
												if(btnId == "ok") {
													me.onSuccessMessageClose(options);
													if (me.popupSec)
														me.popupSec = null;
												}
												cView = me.getCurrentView();
												if(Ext.isEmpty(cView))
													cView = me.getCurrentHelp();
												//TECH-36142
												if(cView && !cView.isDestroyed && typeof cView.focusPage == "function")
													cView.focusPage(true);
												// TECH-29802	
												//}, me, 'info');
											}, me, 'info', RamcoRTC.osType == "JAVA" ? data.message : null);
											// if (me.popupSec)
												// me.popupSec = null;
											if(mboxObj && mboxObj.msgButtons)
												mboxObj.msgButtons[0].focus(true);
										}
										else if(RamcoRTC.prefs.ERROR_DISPLAYMODE == "DIALOG"){
											/*errorDisplay.setVisible(true);
											errorDisplay.inputEl.dom.setAttribute("data-qtip", data.message[0].ds);
											errorDisplay.setValue(data.message[0].ds);*/
											//TECH-39454
											me.successMessage = data.message[0].ds;											
											/*var cView = null;
											me.onSuccessMessageClose(options);
											if (me.popupSec)
												me.popupSec = null;
											cView = me.getCurrentView();
											if(Ext.isEmpty(cView))
												cView = me.getCurrentHelp();
											if(cView && !cView.isDestroyed)
												cView.focusPage(true)*/
										}
										// TECH-32067
										else {
											Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds, function(btnId) {
												//TECH-33447 /MPTP-228
                                                if (btnId == "ok" && (urlLCase.indexOf('homepage_homepage') > -1 || urlLCase.indexOf('rvw_blank') > -1 || urlLCase.indexOf('rvw_launch') > -1)){
                                                        me.signInSuccess(true);
														//TECH-34441
														me.windowReload();
														return;
												}
                                            }, me, 'info', '');
											me.mask(false);
											return;
										}
									}
								}
								else {
									// XIP-516 / TECH-28336
									var l = 0, len = data.message.length, _errorMsg = data.message[0].ds;
									if (len > 1) {
										for(; l < len; l++) {
											if(data.message[l].sv == '5') {
												_errorMsg = data.message[l].ds;
												break;
											}
										}
									}
									if(options.params.RVWRTQS_ILBO != "passremques" && options.params.RVWRTQS_ILBO != "ondisablechangepwd"){
										mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, _errorMsg, function(btnId) {
										var cView = null;
										if(btnId == "ok") {
											me.onSuccessMessageClose(options);
												if (me.popupSec)
													me.popupSec = null;
										}
										cView = me.getCurrentView();
										if(Ext.isEmpty(cView))
											cView = me.getCurrentHelp();
										//TECH-36142
										if(cView && !cView.isDestroyed && typeof cView.focusPage == "function")
											cView.focusPage(true);
										}, me, 'info');
									}
									me.mask(false);	//AHBG-32301									
										
									
								}
								errorMessage = _errorMsg;
								// if (me.popupSec)
									// me.popupSec = null;
								if(mboxObj && mboxObj.msgButtons)
									mboxObj.msgButtons[0].focus(true);
                            }
                        }
                    }
					if(data.data.forcedActivity){
						if(data.data.forcedActivity == "success") {
							RamcoRTC.currenInstance = "";
							me.setLastTaskType('');
							me.modalWindow.hide();
							me.setCurrentHelp(null);
							me.mask(true);
							RamcoRTC.getAllMenu(me.onRequestComplete, me.onRequestException, me);
							return;
						}else if(data.data.forcedActivity == "failure"){
							// XIP-516 / TECH-28336
							mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds, undefined, 'info');
							return;
						}
					}
					//TECH-35380
					if(options.params.RVWRTQS_EVENTNAME == 'tskstd2faverifycode'){
						if(!me.getIsLogin()){
							me.signInSuccess(true);
							me.windowReload();
							return;	
						}else if(me.otpTask){
							var currViewOrHelp = currentView || currentHelp;
							me.mask(true);
							RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currViewOrHelp.ilboConfig || {}, me.otpTask, 'trans', null, null, null, null, null, null);	
							if(loginTimers)
								Ext.TaskManager.stop(loginTimers);
							if(me.twoFactorWin){//TECH-35461
								me.twoFactorWin.hide();
								me.twoFactorWin = null;
							}
						}
						
					}
                    if (options.params.RVWRTQS_EVENTNAME == 'saveuserpassword') {
                        if (me.getFirstTimeLogin()) {
						 	me.setFirstTimeLogin(false);
						}
                        me.signInSuccess(true);
                        if (me.modalWindow) {
                            me.setForgotPwd(false);
                            me.modalWindow.hide();
                        }
						//TECH-30183
						/*window.localStorage.setItem('reloaded', 'true');
                        Ext.util.Cookies.set('reloaded', 'true');
                        window.onbeforeunload = null;
                        window.onunload = null;
                        window.location.reload();*/
						me.windowReload();
                        return;
                        //}
                    }
					//TECH-30183
					if (RamcoRTC.osType == 'JAVA' && options.params.RVWRTQS_EVENTNAME == 'savefavorites' &&  me.modalWindow && !me.modalWindow.isHidden()) {
						me.modalWindow.hide();
						me.windowReload();
						return;
					}		
					if(options.params.RVWRTQS_TYPE == 'import') {
						var curViewOrHelp = currentHelp;								
						if (Ext.isEmpty(curViewOrHelp))
							curViewOrHelp = currentView;
						curViewOrHelp.importWindow.hide();
						curViewOrHelp.importWindow = null;
						Ext.destroy(curViewOrHelp.importWindow);
						delete curViewOrHelp.importWindow;
					}
					if (options.params.RVWRTQS_EVENTNAME == 'tskgenpass'){
						 if (me.modalWindow) {
						    me.setForgotPwd(false);
                            me.modalWindow.hide();
							me.setCurrentHelp(null);
							me.setLastUrl('');
							me.setIsBeforeLogin(true);
				        }
					}  
                    if (options.params.RVWRTQS_EVENTNAME == 'fileupload' || options.params.RVWRTQS_EVENTNAME == 'filedelete') {
                        if (currentView.browseCtrl && currentView.browseCtrl.ctrl)
                            currentView.setControlModified(currentView.browseCtrl.ctrl.itemId);
						if(currentView && currentView.avnuplctrl && currentView.avnuplctrl.avnUploadWin)//TECH-27562
						{
							// AHBG-26482 / TECH-29531
							if(options.params.RVWRTQS_EVENTNAME == 'filedelete')
								currentView.avnuplctrl.avnUploadWin.showMessage(rvw_resources.R307);
							else
								currentView.avnuplctrl.avnUploadWin.showMessage(rvw_resources.R308);
						}
                    }
                    if (options.params.RVWRTQS_EVENTNAME)
						me.setLastTask(options.params.RVWRTQS_EVENTNAME);
				        
                    if (data.data.taskName == 'forgotpassword' || (RamcoRTC.osType == 'JAVA' && data.data.taskName == 'forgotpwdlink' ) || (urlLCase.indexOf('ondisable_changepwd_ondisablechangepwd')>=0 && data.data.taskName == 'tskstdlogin' ))
                        me.setForgotPwd(true);
                    if (trailBar && currentView && currentView.ilboConfig 
						&& options.params.RVWRTQS_EVENTNAME == 'tskstdscreeninit' 
							&& me.helpWindow.isHidden() && me.modalWindow.isHidden()) {
                        if (data.trailBar) {
							var homeAct = {
                                    text: 'Home',
									group: 'trailbar',
                                    checked: false,
                                    mainView: me,
                                    handler: function() {
                                        var me = this.mainView,
											trBar = me.getTrailBar(),
											trMenu = null;
										if (trBar && (trMenu = trBar.getMenu()))
											trMenu.hide();
										
										if ( RamcoRTC.settings.alwaysShowDefault == true && RamcoRTC.userInfo.defac && RamcoRTC.userInfo.defic ) {
											RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
												activityName: RamcoRTC.userInfo.defac,
												ilboName: RamcoRTC.userInfo.defic,
												componentName: (RamcoRTC.osType == 'JAVA') ? RamcoRTC.userInfo.defcomp : '',
												inlineTab: true
											}, '');
										}
										else {
                                        RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
                                            componentName: 'security',
                                            activityName: 'homepage',
                                            ilboName: 'homepage'
                                        }, '');
                                    }
                                    }
							}, ilbodesc = {};
							ilbodesc = {
								text: currentView.ilboConfig.ilboDesc,
								cName:currentView.ilboConfig.componentName,
								actName:currentView.ilboConfig.activityName,
								ilboName:currentView.ilboConfig.ilboName,
								checked: true,	
								group: 'trailbar',
								role:'trailbar',
								idx: RamcoRTC.protoTrailBar.length
							}
							if (!RamcoRTC.isProto || RamcoRTC.isOProto) {
							if (data.trailBar.length == 0)
								data.trailBar.push(homeAct);
							else
								data.trailBar.splice(0, 0, homeAct);
							}		
							data.trailBar.push(ilbodesc);							
                            if(RamcoRTC.isProto && data.data.taskName == "tskstdscreeninit") {
								var r = 0,
									tLen = RamcoRTC.protoTrailBar.length;
								if (tLen > 0) {
									if(RamcoRTC.protoTrailBar[tLen - 1].actName != ilbodesc.actName && RamcoRTC.protoTrailBar[tLen - 1].ilboName != ilbodesc.ilboName)
										RamcoRTC.protoTrailBar.push(ilbodesc);										
								}
								else
									RamcoRTC.protoTrailBar.push(ilbodesc);
								trailBar.setMenu(RamcoRTC.protoTrailBar, true);
							}
							else {

                            	trailBar.setMenu(data.trailBar, true);
							}
                        } 
						else
                            trailBar.setMenu(null, true);
                    }
					if(RamcoRTC.settings.avnCommonPageUrl && RamcoRTC.settings.avnCommonPageUrl.length > 0 && data.URL) {
						var vController;
						if (currentView)
							vController = currentView.getController();
						var dHtmName = RamcoRTC.settings.avnCommonPageUrl[0],							
							lUrlHtmName = data.URL.substring(data.URL.lastIndexOf("/") + 1),
							cViewGrids = null,
							cViewGridLen = 0,
							v;
							if (dHtmName === lUrlHtmName) {
								cViewGrids = Ext.ComponentQuery.query('ramcogrid');
								cViewGridLen = cViewGrids.length;
								for (v = 0; v < cViewGridLen; v++) {
									if (cViewGrids[v].itemId == RamcoRTC.lastFocusCtrl[1]) {
										cViewGrids[v].doMlAvnFileDownload();
										break;
									}
								}
								me.mask(false);
								if (vController)
									vController.taskPending = false;
								return;
							}
					}
                    if (data.data.taskName == 'tskstdquit') {
						var logoutQueryString = getLogoutQueryParam(data.URL),
							logoutURL;
                        window.onbeforeunload = null;
                        window.onunload = null;
                        if (!Ext.isEmpty(RamcoRTC.userInfo.isportallogin) && !Ext.isEmpty(RamcoRTC.settings.defaultPortalLogoutPage))
                            window.location.replace(RamcoRTC.settings.defaultPortalLogoutPage);
						else if(!Ext.isEmpty(RamcoRTC.settings.defaultLogoutPage)){//TECH-27719 {
							//window.location.replace(RamcoRTC.settings.defaultLogoutPage);
							logoutURL = getCreateURL(RamcoRTC.settings.defaultLogoutPage, logoutQueryString);							
							window.location.replace(logoutURL);
						}
						else {
							/*if (RamcoRTC.userInfo.isldaplogin === "1") {
								if (data.URL.indexOf('?') > -1)
									data.URL += "&ltype=WEBSSO";
								else
									data.URL += "?ltype=WEBSSO";
							}*/
                            if (!Ext.isEmpty(data.URL))
                                window.location.replace(data.URL.replace('../', ''));
                            else if (RamcoRTC.isOProto === true) {
								//window.location.replace('ilrt/rvw_logout.htm?ltype=proto');
								window.location.replace(getCreateURL('ilrt/rvw_logout.htm?ltype=proto', logoutQueryString));
							}
                            else {
                                //window.location.replace('ilrt/rvw_logout.htm');
								window.location.replace(getCreateURL('ilrt/rvw_logout.htm', logoutQueryString));
							}
                        }
                        return;
                    }
					else if (urlLCase.indexOf('homepage_homepage') > -1 || urlLCase.indexOf('rvw_blank') > -1 || urlLCase.indexOf('rvw_launch') > -1) {
						//TECH-30183
						if(RamcoRTC.osType == 'JAVA' && (options.params.RVWRTQS_EVENTNAME == 'updatepwd' || options.params.RVWRTQS_EVENTNAME == 'cancel')) {
							if (me.getFirstTimeLogin()) {
								me.setFirstTimeLogin(false);
							}
							me.setLastTaskType(null);
							me.setCurrentHelp(null);
							me.mask(false);
							me.modalWindow.hide();							
						}
						if(options.params.RVWRTQS_EVENTDETAILS == 'verifycode' && me.modalWindow){
							me.mask(false);
							me.modalWindow.hide();
						}
					    if (!me.getIsLogin()) {//TECH-35380
							if(data && data.data && data.data.tfi){
									me.mask(false);
									me.timeToExpire = data.data.tfi.ttl;
									me.desc = data.data.tfi.desc;
									me.len = data.data.tfi.klen;//TECH-35461
									RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me,{
										componentName: 'security',
										activityName:'login',
										activityDesc: 'Sign In',
										ilboName: 'ezelogin',
										ilboDesc: 'Sign In',
										ilboType: '1'
									}, 'tsksendcode', 'trans', null, null, null, null, null, null);	
							}
							else{
	                            me.signInSuccess(true);
								//TECH-34441
								me.windowReload();
								return;
							}
						}
						// TECH-28365
                        // else if (options.params.RVWRTQS_ACTIVITY == 'switchcontexts') {
						else if (options.params.RVWRTQS_ACTIVITY == 'switchcontexts' || options.params.RVWRTQS_ACTIVITY.toLowerCase() == 'contextswitch') {
                            if (me.modalWindow) {
                                me.modalWindow.suspendEvents();
                                me.modalWindow.hide();
                                me.setWindowIndex(0);
        						me.setAllWindowData([]);
                                me.setCurrentHelp(null);
                                me.modalWindow.resumeEvents();
								if ( RamcoRTC.settings.alwaysShowDefault == true && RamcoRTC.userInfo.defac && RamcoRTC.userInfo.defic ) {
									RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
										activityName: RamcoRTC.userInfo.defac,
										ilboName: RamcoRTC.userInfo.defic,
										componentName: (RamcoRTC.osType == 'JAVA') ? RamcoRTC.userInfo.defcomp : '',
										inlineTab: true
									}, '');
								}
                            }
                            if (options.params.RVWRTQS_EVENTNAME != 'cancel' && options.params.RVWRTQS_EVENTNAME != 'tskstdcancel') {
                                //RamcoRTC.getAllMenu(me.onRequestComplete, me.onRequestException, me);
                                window.localStorage.setItem('reloaded', 'true');
                                Ext.util.Cookies.set('reloaded', 'true');
                                window.onbeforeunload = null;
                                window.onunload = null;
                                window.location.reload();
                                return;
                            }
							// TECH-29856
							//if(RamcoRTC.osType == 'JAVA' && (options.params.RVWRTQS_EVENTNAME == 'cancel' || options.params.RVWRTQS_EVENTNAME == 'tskstdcancel')) {
							// TECH-30433 / PNU-162
							if(options.params.RVWRTQS_EVENTNAME == 'cancel' || options.params.RVWRTQS_EVENTNAME == 'tskstdcancel') {
								if (currentHelp && currentHelp.getController())
									currentHelp.getController().taskPending = false;
								me.mask(false);
								return;
							}
                        }
						/* // TECH-28394
						else if(RamcoRTC.osType == 'JAVA')
						{
							me.mask(false);
							return;
						} */
						else {
                            var itemNum = null;
							if (currentView != null) {
                                Ext.destroy(ilboView.remove(currentView));
								var ilMenu = ilboTitle.getMenu(),
									coMenu = btnComponent.getMenu(),
									acMenu = btnActivity.getMenu();
								if(!Ext.isEmpty(ilMenu)) {
									ilboTitle.setMenu(null);
									if (txtBpcIlboTitle)
										txtBpcIlboTitle.setMenu(null);
									Ext.destroy(ilMenu);
								}
								if(!Ext.isEmpty(coMenu)) {
									btnComponent.setMenu(null);
									Ext.destroy(coMenu);
								}
								if(!Ext.isEmpty(acMenu)) {
									btnActivity.setMenu(null);
									Ext.destroy(acMenu);
								}
																								
								if (toolbarHide && !toolbarHide.isHidden())
									toolbarHide.hide();
								
								if (RamcoRTC.settings.isExt2 == true && tblBPC) {
									tblBPC.hide();
								}
								
                                me.setCurrentView(null); // to set the currentView value to null
                                currentView = null;								
								if (data.data.taskName == "tskstdcancel" && RamcoRTC.wizardLaunched == true) {
                                    if (RamcoRTC.actWizItem == 'favorites')
                                        itemNum = "2";
                                    else if (RamcoRTC.actWizItem == 'menutag')
                                        itemNum = "3";
                                    else if (RamcoRTC.actWizItem == 'menumap')
                                        itemNum = "4";
                                    else if (RamcoRTC.actWizItem == 'myinbox')
                                        itemNum = "0";
                                    me.showEzWizard(itemNum);
                                }
                            }
                            me.doMenuSync();
							if (me.getDefaultLaunch() == 'DEFACT' && RamcoRTC.userInfo.defac && RamcoRTC.userInfo.defic) {
								me.onDefaultActivityLaunch();
								return;
							}
							if(Ext.isEmpty(itemNum))
								me.mask(false);
							
							// TECH-40504
							if (RamcoRTC.inlineReportLaunched == true) {
								me.onRemoveInlineReport();
								me.mask(false);
							}
							
							var iFramePanel,								
								iFramePanel = Ext.create("Ext.Ramco.BlankPageCmp",{src:RamcoRTC.RTS.getRvwBlank()}),//TECH-30052
								ilboView = me.getIlboView();
							if (ilboView) {
								me.setCurrentView(ilboView.add(iFramePanel));
								if (RamcoRTC.settings.isExt2 == true) {									
									var northPnl = mainView.getComponent("northPanel");
									if (northPnl && northPnl.splitter && northPnl.splitter.collapseEl) {
										northPnl.expand();
									}
								}
							}
							return;
                        }
                    } else if (options.params.RVWRTQS_EVENTNAME == "updtall") {
						if(options.params.RVWRTQS_ACTIVITY == 'userpreferences') {
							if (me.modalWindow) {
								me.modalWindow.suspendEvents();
								me.modalWindow.hide();
								me.setCurrentHelp(null);
								me.modalWindow.resumeEvents();													
								window.localStorage.setItem('reloaded', 'true');
								Ext.util.Cookies.set('reloaded', 'true');
								window.onbeforeunload = null;
								window.onunload = null;
								window.location.reload();
								return;
							}
						}
					}
					// TECH-34009
					else if ((RamcoRTC.osType == 'JAVA' && data.LaunchMode == "report") || (urlLCase.indexOf('crystal_report_launcher') > -1 || (data.LaunchMode == "report" && urlLCase.toLowerCase().indexOf('vwreport_launcher') > -1))) {
                        if (data.data.tab) {
                            currentView.setTabScreenInfo(data.data.tab, true)
                        }
						//TECH-30370
                        /*if (currentHelp)
                            currentHelp.setSessionData(data);
                        else if (currentView)
                            currentView.setSessionData(data);*/
						if (currentHelp && currentHelp.isVisible())
                            currentHelp.setSessionData(data);
                        else if (currentView)
                            currentView.setSessionData(data);
						//if (data.LaunchMode == "report" && RamcoRTC.settings.reportUriPrefix)
                        if (data.LaunchMode == "report") {
							/* if(!Ext.isEmpty(RamcoRTC.settings.reportUriPrefix)) {
								var subURLArr = data.URL.split('/'),
									subURL = (subURLArr) ? subURLArr[subURLArr.length-1] : '';
								if (!Ext.isEmpty(subURL)) {
									if (RamcoRTC.settings.reportUriPrefix == 'hub/ilrt')
										RamcoRTC.settings.reportUriPrefix = 'ilrt';
									data.URL = RamcoRTC.settings.reportUriPrefix + '/' + subURL;
								}
							}
							else {
								if(!RamcoRTC.userInfo.oldreportpath) {
									if (data.URL.indexOf("ilrt") > -1)
										data.URL = data.URL.replace("ilrt", "hub/ilrt");
								}
								else
									data.URL = data.URL.replace("../ilrt", "../ExtUI/ilrt");
							} */
							
							// TECH-34009
							if (RamcoRTC.osType == 'JAVA') {
								urlLCase = data.URL;
								if(!Ext.isEmpty(urlLCase)){
									var objUrl = urlLCase.split('/'),
										names = objUrl[objUrl.length - 1].split('.'),
										fileExtn = (names && names.length > 1 && names[1].toLowerCase()) || 'jsp',
										newURL;
									newURL = uiFilePath + objUrl[3] + "/" + names[0] + "." + fileExtn;
									data.URL = newURL;
								}else{
									data.URL = "about:blank";
								}
							}
							else {
								// TECH-27417
								if(RamcoRTC.userInfo.oldreportpath) {
									if (data.URL.indexOf('VWReport_launcher.aspx') > -1) {
										data.URL = data.URL.replace('VWReport_launcher.aspx', 'VWReport_launcher_hub.aspx');
									}
									else if (data.URL.indexOf('crystal_report_launcher.aspx') > -1) {
										data.URL = data.URL.replace('crystal_report_launcher.aspx', 'VWReport_launcher_hub.aspx');
									}
								}
							}
						}
						
						// TECH-34009
						//var url = (RamcoRTC.osType == 'JAVA') ? data.URL : data.URL + '&IsFromExtUi=True',
						var url = (RamcoRTC.osType == 'JAVA') ? data.URL : data.URL + '&IsFromHub=True',
							openReportWindow,
							width = (window.screen) ? window.screen.width : 780,
							height = (window.screen) ? window.screen.height : 460;
						
						if (RamcoRTC.userInfo.inlineReportLaunch) {
							RamcoRTC.inlineReportLaunched = true;
							var iFramePanel = Ext.create("Ext.ux.IFrame",{itemId: 'rptInline', src:url, role: 'iframereport'}),
								ilboView = me.getIlboView(),
								ilboTitle = me.getIlboTitle(),
								btnRefresh = me.getBtnRefresh(), // TECH-40504
								txtBpcIlboTitle = me.getTxtBpcIlboTitle();
							if (ilboView && ilboTitle) {
								me.setPreReportIlboText(ilboTitle.getText());
								ilboTitle.setText('Report');
								if (txtBpcIlboTitle)
									txtBpcIlboTitle.setText('Report');
								// TECH-37478
								Ext.destroy(ilboView.remove(currentView));
								me.setCurrentView(null);
								
								btnPreference.inlineHide = true;
								btnPreference.hide();
								
								btnDefaultMode.inlineHide = true;
								btnDefaultMode.hide();
								
								btnPrintBar.inlineHide = true;
								btnPrintBar.hide();
								
								btnHelp.inlineHide = true;
								btnHelp.hide();
								
								trailBar.inlineHide = true;
								trailBar.hide();
								
								favBtn.inlineHide = true;
								favBtn.hide();
								
								// TECH-40504
								btnRefresh.inlineHide = true;
								btnRefresh.hide();
								
								me.inlineReportPanel = iFramePanel;
								ilboView.add(iFramePanel);
								//ilboView.setActiveItem(ilboView.add(iFramePanel));
								return;
							}
						}
						else {
							openReportWindow = window.open(url, "_blank", "directories=yes,menubar=yes,titlebar=no,toolbar=no,status=yes,scrollbars=yes,resizable=yes,width=" + width + ",height=" + height + ",top=0,left=0", false);
							if (openReportWindow) {
								me.mask(true);
								openReportWindow.moveTo(0,0);
								openReportWindow.resizeTo(screen.width, screen.height);	
							}
							else
								Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R293);
						}
                    }
					// TECH-37478
					else if (RamcoRTC.inlineReportLaunched == true && data.data.taskName == 'tskstdcancel') {
						me.onRemoveInlineReport();
						
						className = me.convertUrlToPage(data.URL);
						me.setPersonalization(false);
						me.setDefaultTemplate(false);
						cmbTemplate = me.getCmbTemplate();
						txtTemplate = me.getTxtTemplate();
						chkTemplate = me.getChkTemplate();
						txtTemplate.hide();
						cmbTemplate.hide();
						chkTemplate.hide();
						
						
						me.loadPage(className);
                        me.setLastUrl(data.URL);
						return;
					}
					else if (RamcoRTC.hasSmartViewLink === true || data.data.taskName == 'tskstdremovepersonalization' || data.data.taskName == 'tskstdrefresh' || data.data.taskName == 'tskstdlaunch' || data.data.taskName == 'tskstdlaunchedk' || data.data.taskName == "tskstdgo" || data.data.taskName == "tsksysuictxtswapply" || (data.URL && lastUrl != data.URL)) {                       
						// TECH-37917 /TECH-37889 
						if (!Ext.isEmpty(data.URL))
							me.setLastUrl(data.URL);
						
						// TECH-28159 / TECH-26959
						if(data.data.taskName == 'tskstdlaunch') {
							var workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
							// TECH-29276
							// TECH-29531
							// controllerMain = getMainController(); 
							/*if(RamcoRTC.multiSortGridData[workArea])
								getMainController().resetGridMultiSort(workArea);        
							// TECH-28276
							if(RamcoRTC.dstRequired[workArea])
								delete RamcoRTC.dstRequired[workArea];*/

							/*if(controllerMain.multiSortGridData[workArea])
								controllerMain.resetGridMultiSort(workArea); 

							if(controllerMain.dstRequired[workArea])
								delete controllerMain.dstRequired[workArea];*/

							if(me.multiSortGridData[workArea])
								me.resetGridMultiSort(workArea); 

							if(me.dstRequired[workArea])
								delete me.dstRequired[workArea];
						}
						//TECH-36492
                        //if (currentView && currentView.ilboConfig && options && options.params && options.params.RVWRTQS_ACTIVITY != "login") {
                            //me.doMenuSync(options.params.RVWRTQS_ILBO);
							//me.doMenuSync(options.params.RVWRTQS_COMPONENT, options.params.RVWRTQS_ACTIVITY, options.params.RVWRTQS_ILBO);
							//me.doMenuSync(currentView.ilboConfig.componentName, currentView.ilboConfig.activityName, currentView.ilboConfig.ilboName, currentView.ilboConfig.ilboDesc);
						//}
						if(data.data.taskName == "transfer") {
							// TECH-31814
							if (me.helpWindow && me.helpWindow.isVisible()) {
								me.onRemoveWindowPage(me.helpWindow);
								if(me.getWindowIndex() <=0) {
									me.setCurrentHelp(null);
									currentView.getTaskData(0);
									return;
								}	
							}
							else if (data.URL){
								className = me.convertUrlToPage(data.URL);
								me.loadPage(className);
								me.setLastUrl(data.URL);
								return;
							}
						}
						else if(!options.tbIndex && (data.data.taskName == "tskstdcancel" || data.data.taskName == "tskstdgo")) {
							if(!me.helpWindow.isHidden())
								me.onRemoveWindowPage(me.helpWindow);
							else if(!me.modalWindow.isHidden())
								me.onRemoveWindowPage(me.modalWindow);
							else if (currentView && data.data.taskName == "tskstdgo") {
								currentView.getTaskData(1);
								return;	
							}
						}
                        /*if ((!me.helpWindow.isHidden() || me.helpWindow.isClose) && (data.data.taskName == "transfer" || data.data.taskName == "tskstdcancel")) {													
								currentView.getTaskData(me.helpWindow.pageIndex);							
                            if (currentView && me.helpWindow.pageIndex <= 1) {
                                delete me.helpWindow.tmpConfig;
                                me.helpWindow.pageArr = [];
                                me.helpWindow.pageIndex = 0;
                                me.helpWindow.hide();
                                me.helpWindow.removeAllComponent();
                                me.setCurrentHelp(null);
                            }
                            if (!me.modalWindow.isHidden() && me.modalWindow.pageIndex > 0) {
                                me.setLastTaskType('modal');
								className = me.convertUrlToPage(data.URL);
                                me.loadPage(className);
                                me.setLastUrl(data.URL);
                                return;
                            }
							else if(me.helpWindow.pageIndex <= 1)
								currentView.getTaskData(me.helpWindow.pageIndex);
							return;
							
                        }*/
						if (data.data.taskName == "tsksysuictxtswapply")
							ilboSwitchCtx.setText(RamcoRTC.ilbooud + "-" + RamcoRTC.ilbord);						
                        if (me.getIsLogin()) {
                            /*if (me.getLastTaskType() != 'help' && me.getLastTaskType() != 'modal' && currentView != null && me.helpWindow.isHidden() && me.modalWindow.isHidden()) {
									Ext.destroy(ilboView.remove(currentView));
	                        }*/
                            if (data.data.taskName == 'tskstdcancel' && currentView && data.URL.indexOf(currentView.ilboConfig.activityName + "_" + currentView.ilboConfig.ilboName + ".") > 0) {
                                currentView.getTaskData(0);
                                return;
                            }
							if (Ext.isEmpty(data.URL)) {
								me.mask(false);	
								me.setLastTaskType(null);
								return;
							}
							
							// TECH-40504
							if (data.URL.toLowerCase().indexOf('vwreport_launcher') > -1) {
								RamcoRTC.inlineReportLaunched = true;
								var iFramePanel = Ext.create("Ext.ux.IFrame",{itemId: 'rptInline', src:data.URL, role: 'iframereport'}),
									ilboView = me.getIlboView(),
									ilboTitle = me.getIlboTitle(),
									btnRefresh = me.getBtnRefresh(),
									txtBpcIlboTitle = me.getTxtBpcIlboTitle();
									toolbarHide.show();

								if (ilboView && ilboTitle) {
									me.setPreReportIlboText(ilboTitle.getText());
									ilboTitle.setText('Report');
									if (txtBpcIlboTitle)
										txtBpcIlboTitle.setText('Report');
									// TECH-37478
									Ext.destroy(ilboView.remove(currentView));
									me.setCurrentView(null);
									
									btnPreference.inlineHide = true;
									btnPreference.hide();
									
									btnDefaultMode.inlineHide = true;
									btnDefaultMode.hide();
									
									btnPrintBar.inlineHide = true;
									btnPrintBar.hide();
									
									btnHelp.inlineHide = true;
									btnHelp.hide();
									
									trailBar.inlineHide = true;
									trailBar.hide();
									
									favBtn.inlineHide = true;
									favBtn.hide();
									
									btnRefresh.inlineHide = true;
									btnRefresh.hide();
									
									me.inlineReportPanel = iFramePanel;
									ilboView.add(iFramePanel);
									//ilboView.setActiveItem(ilboView.add(iFramePanel));
									return;
								}
							}
							
                            className = me.convertUrlToPage(data.URL);
                            me.setPersonalization(false); // for launching screen in normal mode on clicking any link in personalisation/default mode
                            me.setDefaultTemplate(false);
                            cmbTemplate = me.getCmbTemplate();
                            txtTemplate = me.getTxtTemplate();
							chkTemplate = me.getChkTemplate(); // DefMode
                            txtTemplate.hide();
                            cmbTemplate.hide();
							chkTemplate.hide(); // DefMode
                            me.loadPage(className); //.then(me.onComponentPageResponse,me.onComponentPageRejected);
                            me.setLastUrl(data.URL);
                        } else {
                            var fly = Ext.fly('splash');
                            if (fly)
                                fly.destroy();
                            if (urlLCase.indexOf('login_ezelogin') > -1 && RamcoRTC.settings.defaultLoginPage)
                                data.URL = urlLCase.replace("login_ezelogin", RamcoRTC.settings.defaultLoginPage);
							if (RamcoRTC.osType == 'JAVA') {
								if (urlLCase.indexOf('logon_ezelogin') > -1 && RamcoRTC.settings.defaultLoginPage) {
									data.URL = urlLCase.replace("logon_ezelogin", RamcoRTC.settings.defaultLoginPage);
								}
							}
							if(RamcoRTC.isProto === true)
								data.URL = urlLCase.replace("login_ezelogin", "login_ezelogin_oproto");
                            className = me.convertUrlToPage(data.URL);
                            me.loadPage(className) //.then(me.onComponentPageResponse,me.onComponentPageRejected);
                            me.setLastUrl(data.URL);
                        }
                        return;
                    } else if ((currentView != null || currentHelp != null)) {
						var lstTaskType = me.getLastTaskType();
						// XIP-516 / TECH-28336
                        if(!(data.message && data.message.length > 0)) {
                        	// TECH-30101
							if (currentHelp && currentHelp.isVisible())
                           	 	currentHelp.setSessionData(data);
							else if (currentView)
                            	currentView.setSessionData(data, options);
							/* HSI-191 */
							// Need to uncomment the code, when roles and tasks in personalization changes on UI Task //
							
							/* var curViewOrHelp = currentHelp || currentView,
                            	isPersonalizationMode = me.getPersonalization(),
                            	persData = me.getPersData();
                            
                            if (isPersonalizationMode == true && !Ext.isEmpty(curViewOrHelp) && !Ext.isEmpty(persData))
                            	curViewOrHelp.performPersonalization(persData); */
                        }
						if (lstTaskType == "help" && data) {
							//TECH-31021
							if (currentHelp && currentHelp.isVisible()) {
                                var hlpwind = currentHelp.up('window');
                                if (hlpwind && !Ext.isEmpty(data.data) && data.data.ci["txtvw_rt_ilbo_title"] && data.data.ci["txtvw_rt_ilbo_title"].value)
                                    hlpwind.setTitle(data.data.ci["txtvw_rt_ilbo_title"].value);
                            } 
							if (Ext.isEmpty(data.URL)) {
								me.mask(false);	
								me.setLastTaskType(null);
								return;
							}
						}
                        try {
							if (data.data.tab) {
								if ( !me.modalWindow.isHidden() )
									tabView = me.modalWindow.ilboComponent;
								else if( currentHelp )
									tabView = currentHelp;	
								else
                                	tabView = currentView;
                                tabView.setTabScreenInfo(data.data.tab, true);
								//activeTab = tabView.activeTabName;

								tabCtrl = tabView.down('#tabcontrol');
                                if (tabCtrl) {
                                    tabItem = tabCtrl.items.getAt(0);
                                    if (RamcoRTC.currentInstance == 'Wizard' && currentView.ilboConfig.activityName == 'ezwizard') {
                                        if (data.data.taskName == 'tskstdscreeninit') {
                                            tabCtrl.setActiveTab(data.data.tab);
                                            tabView.tabTask = tabItem.task;
                                        }
										else
                                            tabCtrl.setActiveTab(RamcoRTC.actWizItem || activeTab);
                                    } else {
                                        //activeTab = (activeTab && activeTab != data.data.tab) ? tabCtrl.getActiveTab() : data.data.tab;
                                        activeTab = tabCtrl.getActiveTab();
										if(activeTab)
											activeTab = activeTab.itemId;
                                        //activeTab = tabCtrl.getActiveTab().itemId;
                                        if (activeTab != data.data.tab)
											tabCtrl.setActiveTab(data.data.tab);
											//tabCtrl.setActiveItem(tabView.activeTabName);
										else {
											// TECH-28263
											if (data.data.taskName == 'tskstdscreeninit' && activeTab == tabCtrl.getActiveTab().itemId && !currentView.callBack && tabItem.taskLaunched != true) {
												tabView.tabTask = tabItem.task;
												//tabItem.taskLaunched = true;
												tabTask = true;
												if(Ext.isEmpty(tabView.tabTask)) {
													currentView.callBackStatus = "";
													tabTask = false;
												}
											}
										}
                                    }
                                    tabView.ilboConfig.tabName = tabCtrl.getActiveTab().getItemId() || data.data.tab;
                                    //tabView.tabTask = tabItem.task;
                                }								
                            }
							else {
                                //var curViewOrHelp = currentView || currentHelp;
								// TECH-30101
								var curViewOrHelp = currentHelp || currentView;
								if (currentHelp && !currentHelp.isVisible())
									curViewOrHelp = currentView;
								if (curViewOrHelp) {
									tabCtrl = curViewOrHelp.down('#tabcontrol');
									if (tabCtrl) {
										var actTab = (RamcoRTC.currentInstance == 'Wizard' && curViewOrHelp.ilboConfig.componentName == 'ezwizard') ? RamcoRTC.actWizItem : curViewOrHelp.activeTabName;
										if (actTab)
											tabCtrl.setActiveTab(actTab);
									}
								}
                            }
                        }
						catch (ex) {
                            console.log('Exception in Tab: ' + ex);
                        }
						if (RamcoRTC.settings.enableWizard) {
							if (currentView && currentView.ilboConfig && currentView.ilboConfig.activityName == 'ezwizard' && RamcoRTC.currentInstance == 'Wizard' && tabCtrl) {
								// Hiding Wizard Tab Based on Item Id for Multi language
                            	var tabBar = tabCtrl.getTabBar(),
									tabBarItems = tabBar && tabBar.items,
									tabChildObj = tabCtrl.items,
									tabId,
									firstFocusObj = '',
									firstFocusObjId = '';
								for (var j = 0; j < tabBarItems.length; j++) {
									//tabItem = tabBar.items.items[j].text;
									tabId = tabChildObj && tabChildObj.items[j] && tabChildObj.items[j].itemId;
									if (RamcoRTC.settings.hideInbox && tabId == 'myinbox' ||
										RamcoRTC.settings.hideWizard && tabId == 'wizard1' ||
										RamcoRTC.settings.hideFavorites && tabId == 'favorites' ||
										RamcoRTC.settings.hideMenuTag && tabId == 'menutag' ||
										RamcoRTC.settings.hideMenuMap && tabId == 'menumap') {
										tabBarItems.getAt(j).setVisible(false);
										tabChildObj.getAt(j).setVisible(false);
                                }
								else if(Ext.isEmpty(firstFocusObjId))
									firstFocusObjId = j;
                            }
							firstFocusObj = tabCtrl.items.getAt(firstFocusObjId);
							if(firstFocusObj && options.params.RVWRTQS_EVENTNAME == 'tskstdscreeninit' && Ext.isEmpty(RamcoRTC.actWizItem))
								tabCtrl.setActiveTab(firstFocusObj.name || firstFocusObj.itemId);
							else if (!Ext.isEmpty(RamcoRTC.actWizItem) && RamcoRTC.actWizItem != (firstFocusObj.name || firstFocusObj.itemId))
								tabCtrl.setActiveTab(RamcoRTC.actWizItem);
                        }
                        if ((data.data.taskName == 'tskstdtabinit' || data.data.taskName == 'tskstdtabdata') && RamcoRTC.currentInstance == 'Wizard' && (RamcoRTC.actWizItem == 'menutag' || RamcoRTC.actWizItem == 'favorites' || RamcoRTC.actWizItem == 'menumap'))
                            currentView.fireEvent('wizard', currentView, data, '', RamcoRTC.actWizItem);
							if (RamcoRTC.currentInstance == 'Wizard' && currentView && currentView.ilboConfig && currentView.ilboConfig.tabName == 'myinbox') {
                            var gridObj = currentView.down('#mlmessageml'),
                                visibleRows = gridObj.visibleRows,
                                totalRows = (gridObj.tr > 0) ? (gridObj.tr || me.getInboxCount() || 0) : 0,
                                inboxElm = me.getBtnInbox(),
                                pageNum = currentView.down("#lblPageNo"),
                                pageIndex = gridObj.vsi || 1,
                                textNum = currentView.down("#txtPageNo"),
                                inboxGrid = currentView.down("#mlmessageml");

                            if (!RamcoRTC.settings.hideInbox || !Ext.isEmpty(RamcoRTC.settings.hideInbox)) {
                                var tabBar = (tabCtrl) ? tabCtrl.getTabBar() : null,
                                    tabBtn = (tabBar && tabBar.items) ? tabBar.items.getAt(0) : null;
                                if (tabBtn && tabBtn.rendered) {
                                    tabBtn.el.set({
                                        'data-badge': totalRows
                                    });
                                    tabBtn.addCls(Ext.baseCSSPrefix + 'btn-inboxbutton-badge');
                                }
                            }
							inboxElm.setBadgeText(totalRows);
                            me.setInboxCount(totalRows);
                            if (pageNum && inboxGrid && totalRows && totalRows > 0) {
                                pageNum.setHtml(Math.ceil(totalRows / visibleRows));
                                textNum.setValue(Math.ceil(pageIndex / visibleRows));
                                textNum.focus();

                            } else {
                                pageNum.setHtml(0);
                                textNum.setValue(0);
                            }
                            if (me.getLastTask() == 'ezwmainscinbox_tr' || data.data.taskName == 'ezwmainscinbox_tr') {
                                var _window = currentView.down('#winAdvSearch');
                                if (_window) {
                                    _window.hide();
                                    me.mask(false);
                                }
                            }
                        }
						}						
                        if (!RamcoRTC.settings.hideSmartlinks && !Ext.isEmpty(smartlinknav) && (data.data.taskName == 'tskstdscreeninit' || data.data.taskName == 'tskstdinstancenav')) {
                            me.setSmartBardata(smartlinknav, data, currentHelp, currentView);
							/*if (data.snbiData && !currentHelp) {
                                smartlinknav.show();
								currentView.hasSmartLink = true;
                                smartlinknav.data = data.snbiData;
                                smartlinknav.removeAll(true);
                                smartlinknav.add({
                                    itemId: 'snbFirst',
                                    padding: (RamcoRTC.settings.isExt2 == true) ? 0 : 2,
                                    task: 'navfirst',
                                    iconCls: (RamcoRTC.settings.isExt2 == true) ? 'x-fa fa-backward' : 'x-fa fa-angle-double-left',
                                    handler: me.onSNBMove,
                                    scope: me
                                });
                                smartlinknav.add({
                                    itemId: 'snbPrev',
                                    padding: (RamcoRTC.settings.isExt2 == true) ? 0 : 2,
                                    task: 'navprev',
                                    iconCls: (RamcoRTC.settings.isExt2 == true) ? 'x-fa fa-caret-left' : 'x-fa fa-angle-left',
                                    handler: me.onSNBMove,
                                    scope: me
                                });
                                for (var key in data.snbiData.data) {
                                    if (!data.snbiData.data[key].cls) {
                                        data.snbiData.data[key].handler = me.onMoveToSNBRow;
                                        data.snbiData.data[key].scope = me;
                                    }
                                    smartlinknav.add(data.snbiData.data[key]);

                                }
                                smartlinknav.add({
                                    itemId: 'snbNext',
                                    padding: (RamcoRTC.settings.isExt2 == true) ? 0 : 2,
                                    task: 'navnext',
                                    iconCls: (RamcoRTC.settings.isExt2 == true) ? 'x-fa fa-caret-right' : 'x-fa fa-angle-right',
                                    handler: me.onSNBMove,
                                    scope: me
                                });
                                smartlinknav.add({
                                    itemId: 'snbLast',
                                    padding: (RamcoRTC.settings.isExt2 == true) ? 0 : 2,
                                    task: 'navlast',
                                    iconCls: (RamcoRTC.settings.isExt2 == true) ? 'x-fa fa-forward' : 'x-fa fa-angle-double-right',
                                    handler: me.onSNBMove,
                                    scope: me
                                });
                            } 							
							else if(currentView && currentView.hasSmartLink === false) {
                                smartlinknav.hide();
                            }*/
                        }
                        if (ilboTitle && data.data.taskName == 'tskstdscreeninit') {
                            if (currentHelp && !currentHelp.hidden) {
                                var wind = currentHelp.up('window');
                                if (wind && !Ext.isEmpty(data.data) && data.data.ci["txtvw_rt_ilbo_title"] && data.data.ci["txtvw_rt_ilbo_title"].value)
                                    wind.setTitle(data.data.ci["txtvw_rt_ilbo_title"].value);
                            } 
							else if (!Ext.isEmpty(data.data) && data.data.ci["txtvw_rt_ilbo_title"] && data.data.ci["txtvw_rt_ilbo_title"].value) {
                                ilboTitle.setText(data.data.ci["txtvw_rt_ilbo_title"].value);
								if (txtBpcIlboTitle)
									txtBpcIlboTitle.setText(data.data.ci["txtvw_rt_ilbo_title"].value);
							}							
							if (!Ext.isEmpty(RamcoRTC.wizardOU) && !Ext.isEmpty(RamcoRTC.wizardRole)) {
								try {
									var ilboObj = me.ilboswitchcontextwin,
										cbRole = ilboObj.down("#ctxtswrole"),
										cbOU = ilboObj.down("#ctxtswouinstance"),
										view = me.getCurrentView(), 
										data = [];
									
									cbOU.setValue(RamcoRTC.wizardOU);
									cbRole.setValue(RamcoRTC.wizardRole);
									RamcoRTC.focusCtrl = [];
									RamcoRTC.ilbooud = view.ilbooud = cbOU.value.trim();
									RamcoRTC.ilbord = view.ilbord = cbRole.value.trim();
									data.push({id: 'ctxtswouinstance', vl: RamcoRTC.wizardOU }, {id: 'ctxtswrole', vl: RamcoRTC.wizardRole});
									view.fireEvent('applyIlboData', view, data, "tsksysuictxtswapply");
									
									delete RamcoRTC.wizardOU;
									delete RamcoRTC.wizardRole;
									me.mask(true);
									return;
								}
								catch(ex) {}
							}
							else if (ilboSwitchCtx && Ext.isEmpty(RamcoRTC.ilbooud) && Ext.isEmpty(RamcoRTC.ilbord))
								ilboSwitchCtx.setText(RamcoRTC.userInfo.oud + "-" + RamcoRTC.userInfo.rd);
							//AHBG-25958
                            /*
	                            if (currentView && currentView.rendered && (!RamcoRTC.settings.hideContextMenu || !RamcoRTC.settings.hideTitleContext) && currentView.ilboConfig.componentName != 'security' && !currentHelp) {
	                                var items, menuItm;
									if (currentView.contextMenu)
	                                    items = currentView.contextMenu;
									else {
	                                    var curMenu = currentView.query('button[role=uipage]'),
	                                        items = [],
	                                        obj = {},
	                                        icon,
	                                        menu = ilboTitle.getMenu();
	                                    
										if (menu)
	                                        Ext.destroy(menu);									
	                                    for (var i = 0; curMenu && i < curMenu.length; i++) {
											if (curMenu[i].hidden)
	                                            continue;                                        
											if (curMenu[i].componentCls == 'x-btn')
	                                            icon = 'x-fa fa-circle';
	                                        else
	                                            icon = 'x-fa fa-link';
											
	                                        obj = {
	                                            text: curMenu[i].text,
	                                            iconCls: icon,
	                                            role: 'trans',
	                                            task: curMenu[i].task,
												taskType: curMenu[i].taskType
	                                        };
	                                        if (obj.text)
	                                            items.push(obj)
	                                    }
									}
									
									if (items && items.length > 0) {
										if (!RamcoRTC.settings.hideContextMenu) {
											currentView.contextMenu = items;
											currentView.container.on({
												contextmenu: {
													fn: currentView.onContextmenu,
													scope: currentView
												}
											});
										}									
										if(!RamcoRTC.settings.hideTitleContext) {
											menuItm = Ext.create('Ext.menu.Menu', {
		                                    ignoreParentClicks: true,
		                                    items: items
		                                });
											ilboTitle.setMenu(menuItm);
		                                ilboTitle.setArrowVisible(false);
		                            }
		                        }
	                        }
						*/
                        }
						// TECH-30718 //TECH-38726/ TECH-38522 //TECH-39009
                        if (tabView && tabView.tabTask && !tabView.callBack && tabView.ilboConfig) {
                             if (tabView.ilboConfig && (tabView.ilboConfig.ilboName == 'ezwizard' && tabView.activeTabName == "myinbox")) {
                                var pView = '',
                                    pCtrl = '',
                                    btnMenuDefault = me.getBtnMenuDefault(),
                                    ezContext = btnMenuDefault.query('menucheckitem');
                                tabView.ezValue = [];
                                for (i = 0; i < ezContext.length; i++) {
                                    if (ezContext[i].itemId == 'Wizard')
                                        continue;
                                    tabView.ezValue.push({
                                        itemId: ezContext[i].text,
                                        text: ezContext[i].text,
                                        role: 'contextpage'
                                    });
                                }
                                if (tabView.activeTabName == "myinbox") {
                                    tabView.setControlData('txthdrtextctrl', 'txthdrtextctrl', 0, '::#::::#::::#::::#::');
                                    pView = 'txthdrtextctrl';
                                    pCtrl = 'txthdrtextctrl';
                                }
                                var tData = tabView.getViewModel() && tabView.getViewModel().getSessionData();
                                RamcoRTC.doWizardTransactions(me.onRequestComplete, me.onRequestException, me, tabView.ilboConfig || {}, tabView.tabTask, 'trans', tData, null, '', '', pCtrl, pView);
                            } else if((data.data.taskName == 'tskstdscreeninit' || data.data.taskName == 'tskstdtabinit') && tabView.ilboConfig.ilboName != 'ezwizard') {
								// TECH-28263
								//if (data.data.taskName == 'tskstdscreeninit' || data.data.taskName == 'tskstdtabinit') {
								RamcoRTC.doTabTransactions(me.onRequestComplete, me.onRequestException, me, tabView.ilboConfig || {}, tabView.tabTask);
								tabItem.taskLaunched = true;
								//}
								return true; // TECH-41167
							}
                            delete tabView.tabTask;
                            // return true; // TECH-40067
                        }
						/* else if(tabView && tabView.tabTask) {
							me.mask(true);
							RamcoRTC.doTabTransactions(me.onRequestComplete, me.onRequestException, me, tabView.ilboConfig || {}, tabView.tabTask);
							delete tabView.tabTask;
							return;
						} */
                    }
					//AHBG-25958
					if (currentView && currentView.rendered && (!RamcoRTC.settings.hideContextMenu || !RamcoRTC.settings.hideTitleContext) && currentView.ilboConfig && currentView.ilboConfig.componentName != 'security' && !currentHelp) {
						var items, 
							menuItm,
							ilboMenuItm,
							curMenu = currentView.query('button[role=uipage]:visible(true)'),
							items = [],
							obj = {},
							icon,
							menu = ilboTitle.getMenu();
						if (menu)
							Ext.destroy(menu);									
						for (var i = 0; curMenu && i < curMenu.length; i++) {
							if (curMenu[i].hidden)
								continue;                                        
							if (curMenu[i].componentCls == 'x-btn')
								icon = 'x-fa fa-circle';
							else
								icon = 'x-fa fa-link';
							
							obj = {
								text: curMenu[i].text,
								iconCls: icon,
								role: 'trans',
								task: curMenu[i].task,
								taskType: curMenu[i].taskType
							};
							if (obj.text)
								items.push(obj)
						}
						
						if (items && items.length > 0) {
							if (!RamcoRTC.settings.hideContextMenu) {
								currentView.contextMenu = items;
								currentView.container.on({
									contextmenu: {
										fn: currentView.onContextmenu,
										scope: currentView
									}
								});
							}									
							if(!RamcoRTC.settings.hideTitleContext) {
								menuItm = Ext.create('Ext.menu.Menu', {
									ignoreParentClicks: true,
									items: items
								});
								ilboMenuItm = Ext.create('Ext.menu.Menu', {
									ignoreParentClicks: true,
									items: items
								});
								ilboTitle.setMenu(ilboMenuItm);
								ilboTitle.setArrowVisible(false);
								if (txtBpcIlboTitle)
									txtBpcIlboTitle.setMenu(menuItm);
							}
					}
				}	// XIP-516 / TECH-28336
                    if (!(data.messages.length > 0)) {
                        if (currentView && currentView.modalClose && me.modalWindow && !me.modalWindow.isHidden()) {
                            currentView.modalClose = false;
                            me.modalWindow.hide();
                        } else if (currentHelp && currentHelp.modalClose && me.modalWindow && !me.modalWindow.isHidden()) {
                            me.modalWindow.modalClose = currentHelp.modalClose;
                            currentHelp.modalClose = false;
                            me.modalWindow.hide();
                        }
                        if (!Ext.isEmpty(me.popupSec)) {
							if (currentView && (currentView.popupClose) && !Ext.isString(me.popupSec)) {
								me.popupSec.hide();
								currentView.popupClose = false;
								currentView.modalClose = false;
								delete me.popupSec;
							} else if (currentHelp && (currentHelp.popupClose) && !Ext.isString(me.popupSec)) {
								me.popupSec.hide();
								currentHelp.popupClose = false;
								currentHelp.modalClose = false;
								delete me.popupSec;
							}
						}						
                        if (currentView && currentView.isCancel) {
                            RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdcancel', 'trans', null, null, null, null, null, null);
                            currentView.isCancel = false;
                        } else if (currentHelp && currentHelp.isCancel) {
                            RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentHelp.ilboConfig || {}, 'tskstdcancel', 'trans', null, null, null, null, null, null);
                            currentHelp.isCancel = false;
                        }
                    }
					
					var curViewOrHelp = currentHelp || currentView;
						if (currentHelp && !currentHelp.isVisible())
							curViewOrHelp = currentView;
					
					// TECH-30101
					var popupCallOutView = null, ilboController,
						curViewOrHelp = currentHelp || currentView;
						if (currentHelp && !currentHelp.isVisible())
							curViewOrHelp = currentView;
					// TECH-33556
					ilboController = curViewOrHelp && curViewOrHelp.getController(); // // TECH-28978
					// Popup || Callout Section Handling
					if(curViewOrHelp &&  (curViewOrHelp.popupSec || curViewOrHelp.calloutSec || me.popupSec || curViewOrHelp.smartPopupSec)) {
						popupCallOutView = curViewOrHelp;
					}					
					// Modal Popup || Callout Section Handling
					else if(me.modalWindow &&  (me.modalWindow.popupSec || me.modalWindow.calloutSec)) {
						popupCallOutView = me.modalWindow;
					}
                    // Popup || Callout Section Handling
					//else if (currentView && (currentView.popupSec || currentView.calloutSec) || me.popupSec)
						//popupCallOutView = currentView;
					
					if(popupCallOutView || me.popupSec) {
                        var popupSection, ctrl;
                        if (me.popupSec)
                            popupSection = me.popupSec;
                        else
                            popupSection = popupCallOutView.popupSec ? popupCallOutView.popupSec[data.data.taskName?data.data.taskName.toLowerCase():''] : null;
                        if (!popupSection) {
                            popupSection = popupCallOutView.calloutSec ? popupCallOutView.calloutSec[data.data.taskName?data.data.taskName.toLowerCase():''] : null;
                            me.isCallout = me.isCallout || me.coCtrlId;
                        }
						if (!popupSection) {
							popupSection = popupCallOutView.smartPopupSec ? popupCallOutView.smartPopupSec[data.data.taskName.toLowerCase()] : null;
						}
                        if (popupSection) {
                            try {
                                if (!Ext.isObject(popupSection))
                                    popupSection = popupCallOutView.down('#' + popupSection);
                                if (popupSection) {
                                    var wd = 0,
                                        pxWd = 0,
                                        isFirst,
										innerSize = {};						
									if(popupSection.rendered === false) {
										popupSection.alwaysOnTop = true;										
										popupSection.show();
										innerSize.height = popupSection.body.getAttribute('scrollHeight') + 50;
									}
									curViewOrHelp.curPopupView = popupSection;
                                    me.popupSec = popupSection;
									if(!popupSection.alterSize) {
										var	popSize = popupSection.getSize(),
											size = popupCallOutView.getSize();
										if (me.popupHeight || me.popupWidth) {
											if (me.popupHeight)
												popSize.height = me.popupHeight;
											if (me.popupWidth)
												popSize.width = me.popupWidth;
											popSize.height += 50;
											popupSection.alterSize = true; //TECH-33765
										}
										else {
											//innerSize.width = popupSection.body.getAttribute('scrollWidth');
											//innerSize.height = popupSection.body.getAttribute('scrollHeight');
											innerSize.width = popupSection.body.getAttribute('offsetWidth');
											innerSize.height = popupSection.body.getAttribute('offsetHeight');
											if (innerSize && (innerSize.width > popSize.width || innerSize.height > popSize.height || popupSection.title)) {
												if (innerSize.width > popSize.width) {
													popSize.width = innerSize.width;
													popSize.width += 50;
												}
												if (innerSize.height > popSize.height)
													popSize.height = innerSize.height;
												popSize.height += 50;
												popupSection.alterSize = true; //TECH-33765
											}
										}
										// TECH-31861
										if (popSize.width > size.width) {
											if(popSize.width == screen.width || popSize.width == '100%')
												popSize.width = size.width;
											else
												popSize.width = size.width - 50;
										}
										if (popSize.height > size.height) {
											if(popSize.height == screen.height || popSize.height == '100%')
												popSize.height = size.height;
											else
												popSize.height = size.height - 50;
										}
										popupSection.setSize(popSize);
										//popupSection.alterSize = true; //TECH-33765
										popupSection.setScrollable({ y: true });
									}
                                    if (!me.isCallout && Ext.isEmpty(RamcoRTC.hasSmartViewSec)) {
										if(popupSection.isHidden()){
                                        	popupSection.show();
										}
                                        //if (!me.coCtrlId)
                                        if(Ext.isEmpty(popupSection.isCallout))
                                        	popupSection.center();
                                    }
									else {
										if (RamcoRTC.hasSmartViewSec === true) {
											ctrl = RamcoRTC.smartViewSecCtrl	
											RamcoRTC.hasSmartViewSec = false;
											RamcoRTC.smartViewSecCtrl = null;
										}
										else {
											popupSection.addCls('x-callout-popup');
											ctrl = popupCallOutView.down('#' + me.isCallout);
										}
                                        if (!ctrl)
                                            ctrl = popupCallOutView.el.down("#" + me.isCallout);
                                        if (me.coView && ctrl.view) {
                                            ctrl = ctrl.view.getNodeByRecord(me.coView);
                                            delete me.coView;
                                        }
                                        if (ctrl) {
                                            if (!ctrl.el)
                                                ctrl = Ext.fly(ctrl);
                                            var totWidth = document.body.offsetWidth,
												/*totHeight = document.body.offsetHeight,
												popSecHeight = popupSection.getHeight(),
												ctrlY = ctrl.getY(),*/
                                                popSecWidth = popupSection.getWidth(),
												// TECH-27922
												ctrlWidth = ctrl.getWidth(),
                                                ctrlX = ctrl.getX();
											if ((ctrlX - (popSecWidth + 50)) < 0)
												popupSection.showBy(ctrl, 'tl-bl?');
											else if ((totWidth -(popSecWidth + ctrlX + ctrlWidth + 50)) > 0)
                                                popupSection.showBy(ctrl, 'tl-br?');
										    /*else if ( popSecHeight >(totHeight - ctrlY))
												popupSection.showBy(ctrl, 'tl?');*/
									        else if (totWidth > popSecWidth + ctrlX)
                                                popupSection.showBy(ctrl, 'tr-bl');
                                            else if (totWidth <= popSecWidth + ctrlX)
                                                popupSection.showBy(ctrl, 'tl-bl?');
                                            else {
                                                popupSection.show();
                                                popupSection.center();
                                            }
											
											if(!Ext.isEmpty(me.isCallout))
                                            	popupSection.isCallout = true;
                                        } 
										else {
                                            popupSection.show();
                                            popupSection.center();
                                        }
                                    }
									// TECH-31861
									popupSection.updateLayout(true);
                                    delete me.isCallout;
                                }
                            } catch (e) {
                                console.log(e);
								delete me.popupSec;
                            }
                            delete me.popupHeight;
                            delete me.popupWidth;
                        }
						//TECH-38726/ TECH-38522
						/* else {
							// AHBG-25962
                            if (me.getLastTaskType() == "modal" && !me.getIsLookUpLink()) {
                                me.setLastTaskType("");
                            }
                        } */
                    }
                    if (mainView && currentView && options.params.RVWRTQS_EVENTNAME == 'tskstdscreeninit') {
                        var printBar = me.getBtnPrintBar();
                        // TECH-33537
                        //if (currentView.hidePrint == true || RamcoRTC.settings.hidePrintButton == true)
                        if (currentView.hidePrint == false)
                            printBar.setVisible(true);
                        else
                            printBar.setVisible(false);
						if (!pers && !defTemplate) {
							printBar = me.getBtnSave();
							if (printBar)
								printBar.hide();
							printBar = me.getBtnClear();
							if (printBar)
								printBar.hide();
							printBar = me.getBtnCancl();
							if (printBar)
								printBar.hide();
						}
                    }
                    if (options.params.RVWRTQS_TYPE == 'import' || options.params.RVWRTQS_EVENTNAME == 'fileupload' || options.params.RVWRTQS_EVENTNAME == 'filedelete') {
                        if (currentView && currentView.importWindow) {
                            currentView.importWindow.hide();
                            delete currentView.importWindow;
                        } else if (currentView && currentView.browseWindow) {
                            currentView.browseWindow.hide();
                            delete currentView.browseWindow;
                        }
                        if (currentView && currentView.browseCtrl) {
                            if (currentView.browseCtrl.task) {
								if (data) {
									currentView.setSessionData(data);
									currentView.browseCtrl.data = currentView.getSessionData();
								}
                                me.onTrans(currentView.browseCtrl.v, currentView.browseCtrl.data, currentView.browseCtrl.task, currentView.browseCtrl.taskType);
							}
                            delete currentView.browseCtrl;
                            me.mask(false, errorMessage);
							//TECH-32573
							currentView.focusPage(true);
                            return true;
                        } else if (currentView && currentView.deleteCtrl) {
                            if (currentView.deleteCtrl.task)
                                me.onTrans(currentView.deleteCtrl.v, currentView.deleteCtrl.data, currentView.deleteCtrl.task, currentView.deleteCtrl.taskType);
                            delete currentView.deleteCtrl;
                            me.mask(false, errorMessage);
                            return true;
                        }
                        if (options.params.RVWRTQS_EVENTNAME == 'filedelete') {
                            me.mask(true);
                            if (currentHelp && !currentHelp.hidden) {
                                gridObj = currentHelp.getControl(options.params.RVWRTQS_CONTROLNAME);
                                if (gridObj && gridObj.xtype == 'ramcogrid') {
									gridObjColumn = gridObj.getColumnById("v" + options.params.RVWRTQS_CONTROLVIEW);
                                    if(gridObjColumn && gridObjColumn.xtype != "fileattachcolumn"){
	                                    record = gridObj.store.findRecord('rn', options.params.RVWRTQS_ROWNO);
	                                    if (record)
	                                        record.set('sel', true);
	                                    vData = currentHelp.getSessionData();
	                                    RamcoRTC.doMLTransaction(me.onRequestComplete, me.onRequestException, me, currentHelp.ilboConfig || {}, 'tskstddelete', 'trans', vData, options.params.RVWRTQS_CONTROLNAME, gridObj.store.start, gridObj.store.end);
	                                }
                                }
                            } else {
                                gridObj = currentView.getControl(options.params.RVWRTQS_CONTROLNAME);
                                if (gridObj && gridObj.xtype == 'ramcogrid') {
									gridObjColumn = gridObj.getColumnById("v" + options.params.RVWRTQS_CONTROLVIEW);
                                    if(gridObjColumn && gridObjColumn.xtype != "fileattachcolumn"){
	                                    record = gridObj.store.findRecord('rn', options.params.RVWRTQS_ROWNO);
	                                    if (record)
	                                        record.set('sel', true);
	                                    vData = currentView.getSessionData();
	                                    RamcoRTC.doMLTransaction(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstddelete', 'trans', vData, options.params.RVWRTQS_CONTROLNAME, gridObj.store.start, gridObj.store.end);
                                	}
                            	}
                        	}
                    	}
                    }
                    /*if (currentView && !tabTask && (data.data.taskName == 'tskstdscreeninit' || data.data.taskName == 'tskstdtabinit' || data.data.taskName == 'tskstdtabdata') && currentView && currentView.ilboConfig.ilboName != 'ezelogin' && RamcoRTC.settings.enableWizard && currentView && currentView.ilboConfig && currentView.ilboConfig.ilboName != "ezwizard" && currentView.ilboConfig.componentName != 'security')
                        RamcoRTC.doGetFavorites(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'fetch_favorites', 'async');
                    else if (currentView && !tabTask && (options && tabView && options.params && options.params.RVWRTQS_EVENTDETAILS == tabView.ilboConfig.tabName) && data.data.taskName != 'tskstdscreeninit' && currentView.ilboConfig.ilboName != 'ezelogin' && RamcoRTC.settings.enableWizard && currentView && currentView.ilboConfig && currentView.ilboConfig.ilboName != "ezwizard" && currentView.ilboConfig.componentName != 'security')
                        RamcoRTC.doGetFavorites(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'fetch_favorites', 'async');
                    else
                        me.mask(false, errorMessage);
					*/
					
					// TECH-28978
					/* if (mainView && currentView && currentView.ilboConfig && currentView.ilboConfig.componentName != 'security' && currentView.ilboConfig.ilboName != 'ezwizard' && options.params.RVWRTQS_EVENTNAME == 'tskstdscreeninit') {
						RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'GETDOC', 'trans');
						return;
					} */
					if(ilboController && ilboController.taskPending === false){
						if((currentView && currentView.callBackStatus != "IP") || (me.helpWindow && me.helpWindow.ilboComponent && me.helpWindow.ilboComponent.callBackStatus != "IP") || (me.modalWindow.ilboComponent && me.modalWindow.ilboComponent.callBackStatus != "IP")){
							if ( !currentView || ( currentView && Ext.isEmpty(currentView.tabTask) && !currentView.callBack && (currentView.getActiveTabName() != 'menumap' && currentView.getActiveTabName() != 'menutag' && currentView.getActiveTabName() != 'favorites') )) // TECH-35461 // TECH-38435
								me.mask(false, errorMessage);
								//var curViewOrHelp = currentHelp || currentView;
							// MPTP-299
							//if(Ext.isEmpty(curViewOrHelp.callBackStatusError))
							if (Ext.isEmpty(curViewOrHelp.callBackStatusError) && data.message.length ==0)
								curViewOrHelp.focusPage(true);
						}
						//TECH-29873
						if (options.params.RVWRTQS_EVENTNAME == "tskstdsearch") {
							me.mask(false, errorMessage);
						}
					}
					//TECH-35380 //TECH-35461
					if (options.params.RVWRTQS_EVENTNAME == "tsksendcode" && me.timeToExpire && me.desc && me.len) {
							me.mask(false, errorMessage);
							me.twoFactorWindow(me.timeToExpire,me.desc,me.len);
					}else if(data && data.data && data.data.tfi &&(data.data.tfi.ttl && data.data.tfi.desc && data.data.tfi.klen)){
							me.timeToExpire = data.data.tfi.ttl;
							me.desc = data.data.tfi.desc;
							me.len = data.data.tfi.klen;//TECH-35461
							if(data.data.tfi.otpTsk.length > 0)
								me.otpTaskArr = data.data.tfi.otpTsk;
							if(options.params.RVWRTQS_EVENTNAME == "tskstdlogin"){
								me.otpTask = "tskstdlogin";
								me.twoFactorWindow(data.data.tfi.ttl,data.data.tfi.desc,data.data.tfi.klen);
							}	
					}
					//AHBG-27567
					// TECH-33556
					if (data.data.taskName == "tskdummy") {
						if(!Ext.isEmpty(curViewOrHelp)){
							if(curViewOrHelp.avnFileDownload === true) {
								me.mask(false, errorMessage);						
								curViewOrHelp.avnFileDownload = null;
								delete curViewOrHelp.avnFileDownload;
							}
							if(curViewOrHelp.syncView === true) {
								curViewOrHelp.focusPage(true);
								curViewOrHelp.syncView = false;
							}
							// TECH-39603
							if (curViewOrHelp.xtype == 'ramcoblankpagecmp')
								me.mask(false);
						}
						else{
							me.mask(false);
						}
					}
                    break;
            }
            delete me.isCallout;
            if (options && options.params && options.params.RVWRTQS_EVENTNAME == 'tskstdsort') {
                mainView.resumeLayouts();
                mainView.resumeEvents();
            }
        } catch (e) {
            me.mask(false, e.message);
            Ext.RamcoMsg.alert(rvw_resources.R260, e.message);
        }
    },
	setSmartBardata: function(smartlinknav, data, currentHelp, currentView) {
		var me = this;
		if (!RamcoRTC.settings.hideSmartlinks && !Ext.isEmpty(smartlinknav) && (data.data.taskName == 'tskstdscreeninit' || data.data.taskName == 'tskstdinstancenav')) {
			if (data.snbiData && !currentHelp) {
				smartlinknav.show();
				currentView.hasSmartLink = true;
				smartlinknav.data = data.snbiData;
				smartlinknav.removeAll(true);
				smartlinknav.add({
					itemId: 'snbFirst',
					padding: (RamcoRTC.settings.isExt2 == true) ? 0 : 2,
					task: 'navfirst',
					iconCls: (RamcoRTC.settings.isExt2 == true) ? 'x-fa fa-backward' : 'x-fa fa-angle-double-left',
					handler: me.onSNBMove,
					scope: me
				});
				smartlinknav.add({
					itemId: 'snbPrev',
					padding: (RamcoRTC.settings.isExt2 == true) ? 0 : 2,
					task: 'navprev',
					iconCls: (RamcoRTC.settings.isExt2 == true) ? 'x-fa fa-caret-left' : 'x-fa fa-angle-left',
					handler: me.onSNBMove,
					scope: me
				});
				for (var key in data.snbiData.data) {
					if (!data.snbiData.data[key].cls) {
						data.snbiData.data[key].handler = me.onMoveToSNBRow;
						data.snbiData.data[key].scope = me;
					}
					smartlinknav.add(data.snbiData.data[key]);

				}
				smartlinknav.add({
					itemId: 'snbNext',
					padding: (RamcoRTC.settings.isExt2 == true) ? 0 : 2,
					task: 'navnext',
					iconCls: (RamcoRTC.settings.isExt2 == true) ? 'x-fa fa-caret-right' : 'x-fa fa-angle-right',
					handler: me.onSNBMove,
					scope: me
				});
				smartlinknav.add({
					itemId: 'snbLast',
					padding: (RamcoRTC.settings.isExt2 == true) ? 0 : 2,
					task: 'navlast',
					iconCls: (RamcoRTC.settings.isExt2 == true) ? 'x-fa fa-forward' : 'x-fa fa-angle-double-right',
					handler: me.onSNBMove,
					scope: me
				});
			} 							
			else if(currentView && currentView.hasSmartLink === false) {
				smartlinknav.hide();
			}
		}			
	},
	//TECH-30183
	windowReload: function() {
		var me = this;		
		window.localStorage.setItem('reloaded', 'true');
		Ext.util.Cookies.set('reloaded', 'true');
		window.onbeforeunload = null;
		window.onunload = null;
		window.location.reload();		
	},
	twoFactorWindow:function(timetoExpire,desc,len){//TECH-35380
		var me =this,modalHelp,//TECH-35461
		twoFactorWin,authLabel,sendCode,verify,component;
		
		component =   {
						xtype: 'container',
						 layout: {
							type: 'vbox',
							align: 'center',
							pack: 'center'
						}, 
						items: [{
							xtype: 'panel',
							itemId:'passcodePanel',
							style:{'top':'15px'},
							padding:'0 10 10 10',
							layout:'hbox',
							items:[{
								xtype: 'label',
								itemId: 'passcodeLabel',
								padding:'0 3 0 0',
								html:'Enter the Pass code'
							 },{
								xtype: 'numberfield',
								role: 'uipage',
								maxLength:len,
								visibleLength:20,
								enforceMaxLength:true,
								itemId: 'passcodeField',
								listeners:{
									keyup:function(ths,e,eopts){
										if(this.twoFactorWin){
											//passcodeField = this.twoFactorWin.down("#passcodeField");
											value = ths.getValue()
											if(value){
												passCodestr = value.toString();
												verify = this.twoFactorWin.down("#verify");
												if(verify){
													if(passCodestr.length == this.len){
														verify.setDisabled(false);
													}else
														verify.setDisabled(true);
												}
											}
											
										}
										
									},
									 scope: this
								}
							}]
							},{
							xtype: 'label',
							itemId: 'authLabel'
						  },{
							xtype: 'panel',
							layout:'hbox',
							 padding:'20 20 20 20',
							items:[{
								xtype: 'button',
								itemId: 'verify',
								role:'mainpage',
								disabled:true,
								text:'Verify'
							 },{
								xtype: 'button',
								itemId: 'sendCode',
								role:'mainpage',
								disabled:true,
								text:'Re-Send passcode'
							  }]
							}
							]
					 }
					
					 if(Ext.isEmpty(me.twoFactorWin)){
						 me.twoFactorWin = twoFactorWin =  Ext.create('Ext.window.Window', {
									title: 'Authenticate Secure Code',
									height: 250,
									width: 350,
									closable:true,
									resizable:true,
									modal: true,
									closeAction: 'hide',
									itemId:'twoFactorWin',
									layout: 'fit',
									items:[component]   
								});	
					 }else{
						 passcodeField = me.twoFactorWin && me.twoFactorWin.down("#passcodeField");
						 passcodeField.setValue("");
					 }
						
					
		if(me.getLastTask() != 'tskstdlogin')
			me.twoFactorWin.setClosable(false);
	 	me.twoFactorWin.show();
		authLabel = me.twoFactorWin.queryById('authLabel');
		sendCode = me.twoFactorWin.queryById('sendCode');
		verify = me.twoFactorWin.queryById('verify');
		
		loginTimers = Ext.TaskManager.start({
						run: function() {
							if(timetoExpire > 1 ){
								 // verify.setDisabled(false);
								  sendCode.setDisabled(true);
								  authLabel.setHtml('<div style = "padding:10 2 2 2">Pass code sent to the registered '+desc.toLowerCase()+'.</div><div style = "padding:10 2 2 2">Re-Send pass code will be enabled after '+timetoExpire--+'  seconds.</div>');
								  
							}
							else {
								 Ext.TaskManager.stop(loginTimers);
								 authLabel.setHtml('<div style = "padding:10 2 2 2">Pass code expired.</div><div style = "padding:10 2 2 2">Kindly regenerate the pass code.</div>');  	
								 sendCode.setDisabled(false);
								 verify.setDisabled(true);
							}
						},interval: 800}); 
		
		
	},
	isValidXML: function(xmlObj) {
		var errorObj = xmlObj.getElementsByTagName('parsererror');
		if (!Ext.isEmpty(errorObj) && errorObj.length > 0)
			return false;		
		return true;
	},
	onForcedActivityLaunch: function() {
		var me = this;
		if (( RamcoRTC.userInfo.launchdefault == true) && RamcoRTC.userInfo.forcecmp && RamcoRTC.userInfo.forceact && RamcoRTC.userInfo.forceilb) {
			RamcoRTC.currentInstance = 'forcedlaunch';
			RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
				componentName: RamcoRTC.userInfo.forcecmp,
				activityName: RamcoRTC.userInfo.forceact,
				ilboName: RamcoRTC.userInfo.forceilb,
				inlineTab: true
			}, '');					
			me.setLastTaskType('modal');
		}
		else
			me.mask(false);
	},
    onDefaultActivityLaunch: function() {
		var me = this,
			btnDefault = me.getBtnMenuDefault(),
			mainView = me.getMainView();
		if ( (RamcoRTC.settings.alwaysShowDefault === true || RamcoRTC.userInfo.launchdefault == true)) {
			if (RamcoRTC.settings.enableWizard && (RamcoRTC.userInfo.appLaunch == "WIZARD" || me.getDefaultLaunch() == 'WIZARD') && !RamcoRTC.wizardLaunched) {
				RamcoRTC.currentInstance = 'Wizard';
				btnDefault.setText('Wizard');
				RamcoRTC.wizardLaunched = true;
				var menu = btnDefault.getMenu();
				menu.items.each(function(itm, index) { if (index != 0) itm.setChecked(false); });
				menu = menu.items.getByKey('Wizard');
				if (menu)
					menu.setChecked(true);
				// TECH-38258
				RamcoRTC.actWizItem = RamcoRTC.userInfo.wizTab || me.getDefaultWizardTab();
				RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
					componentName: 'ezwizard',
					activityName: 'ezwizard',
					ilboName: 'ezwizard',
					inlineTab: true,
					tabName: RamcoRTC.actWizItem
				}, '');
				me.setDefaultActivityLaunched(true);
				if (RamcoRTC.settings.isExt2 == true && RamcoRTC.settings.bannerCollapse === true) {					
					var northPnl = mainView.getComponent("northPanel");
					if (northPnl && northPnl.splitter && northPnl.splitter.collapseEl && northPnl.getCollapsed() === false) {
						northPnl.collapse();
					}
				}
				return;
			}
			else if (!me.getInvalidPageLaunch() && RamcoRTC.userInfo.defac && RamcoRTC.userInfo.defic) {
				RamcoRTC.currentInstance = 'default';
				btnDefault.setText('Default Window');
				var menu = btnDefault.getMenu();
				menu.items.each(function(itm, index) {if (index != 0) itm.setChecked(false);});
				menu = menu.items.getByKey('Default Window');
				if (menu)
					menu.setChecked(true);

				// TECH-28385
				
				
				// Portal Launch With Default Values
				
				var edkValue, isPortalLogin;
				edkValue = (RamcoRTC.userInfo.isedk === true) ? RamcoRTC.userInfo.edk : (RamcoRTC.userInfo.isedk == "1" || RamcoRTC.userInfo.isedk == "2") ? RamcoRTC.userInfo.isedk : '';
				isPortalLogin = (!Ext.isEmpty(RamcoRTC.userInfo.isportallogin) && RamcoRTC.userInfo.isportallogin == 'true') ? true : false;

				RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
					activityName: RamcoRTC.userInfo.defac,
					ilboName: RamcoRTC.userInfo.defic,
					// TECH-28385
					// componentName: (RamcoRTC.osType == 'JAVA') ? RamcoRTC.userInfo.defcomp : '',
					componentName: RamcoRTC.userInfo.defcomp ? RamcoRTC.userInfo.defcomp : '',
					inlineTab: true,
					isEdk: edkValue,
					isPortal: isPortalLogin
				}, '');
				me.setDefaultActivityLaunched(true);
				if (RamcoRTC.settings.isExt2 == true && RamcoRTC.settings.bannerCollapse === true) {					
					var northPnl = mainView.getComponent("northPanel");
					if (northPnl && northPnl.splitter && northPnl.splitter.collapseEl && northPnl.getCollapsed() === false) {
						northPnl.collapse();
					}
				}
				return;
			}
			else {
				//TECH-38997
				var iFramePanel,								
					iFramePanel = Ext.create("Ext.Ramco.BlankPageCmp",{src:RamcoRTC.RTS.getRvwBlank()}),//TECH-30052
					ilboView = me.getIlboView();
				if (ilboView) {
					me.setCurrentView(ilboView.add(iFramePanel));
					if (RamcoRTC.settings.isExt2 == true) {									
						var northPnl = mainView.getComponent("northPanel");
						if (northPnl && northPnl.splitter && northPnl.splitter.collapseEl) {
							northPnl.expand();
						}
					}
				}				
			}
		}
		me.mask(false);
	},
	onSuccessMessageClose: function(options) {
        var me = this,
            currentView = me.getCurrentView(),
            currentHelp = me.getCurrentHelp();
        if (currentView && currentView.modalClose && me.modalWindow && !me.modalWindow.isHidden()) {
            me.modalWindow.hide();
			//currentView.modalClose = false;
        } else if (currentHelp && currentHelp.modalClose && me.modalWindow && !me.modalWindow.isHidden()) {
            me.modalWindow.hide();
			//currentHelp.modalClose = false;
        }
        if (currentView && (currentView.popupClose || currentView.modalClose) && me.popupSec) {
            me.popupSec.hide();
            currentView.popupClose = false;
            currentView.modalClose = false;
            delete me.popupSec;
        } else if (currentHelp && (currentHelp.popupClose || currentHelp.modalClose) && me.popupSec) {
            me.popupSec.hide();
            currentHelp.popupClose = false;
            currentHelp.modalClose = false;
            delete me.popupSec;
        }
        if (currentView && currentView.isCancel) {
            RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdcancel', 'trans', null, null, null, null, null, null);
            currentView.isCancel = false;
        } else if (currentHelp && currentHelp.isCancel) {
            RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentHelp.ilboConfig || {}, 'tskstdcancel', 'trans', null, null, null, null, null, null);
            currentHelp.isCancel = false;
        }
		if (options.params.RVWRTQS_EVENTNAME == 'saveuserpassword') {
			if(!me.getFirstTimeLogin()){
				window.localStorage.setItem('reloaded', 'true');
				Ext.util.Cookies.set('reloaded', 'true');
				window.onbeforeunload = null;
				window.onunload = null;
				window.location.reload();
				return;
			}
		}
    },
    onRequestException: function(response, options) {
		RamcoRTC.setSessionToken(RamcoRTC.sessionToken);
        this.mask(false);
        var me = this,
            currentView = me.getCurrentView(),
            currentHelp = me.getCurrentHelp(),
            controller = null;
        if (currentView) {
            controller = currentView.getController();
            if (controller)
                controller.taskPending = false;
        }
        if (currentHelp && !currentHelp.isHidden()) {
            controller = currentHelp.getController();
            if (controller)
                controller.taskPending = false;
        }
        if (options && options.params.RVWRTQS_EVENTNAME == "getlistdata") {
            if (currentHelp != null && !currentHelp.isHidden())
                currentHelp.setListData(null, options.targetCtrl, options.params.RVWRTQS_CONTROLVIEW, options.params.RVWRTQS_CONTROLNAME);
            else if (currentView != null)
                currentView.setListData(null, options.targetCtrl, options.params.RVWRTQS_CONTROLVIEW, options.params.RVWRTQS_CONTROLNAME);
        } else {
            if (response && response.ErrFlag && response.ErrFlag == "true")
                Ext.RamcoMsg.alert(rvw_resources.R260, response.ErrMsg, Ext.emptyFn, undefined, 'error');
            else if (!Ext.isEmpty(response.statusText))
                Ext.RamcoMsg.alert(rvw_resources.R260, response.statusText, Ext.emptyFn, undefined, 'error');
        }
    },
    convertUrlToPage: function(url) {
        if (!url)
            return '';
        var objUrl = (RamcoRTC.osType == 'JAVA') ? url.split('/') : url.toLowerCase().split('/'),
            lang = RamcoRTC.lang || RamcoRTC.userInfo.l || 1,
            strUrl = null,
			URLPath,
			loginStatus = this.getIsLogin(),
            urlString;
        if (objUrl.length > 0) {
			// TECH-33892
            var names = objUrl[objUrl.length - 1].split('.'),
				fileExtn = (names && names.length > 1 && names[1].toLowerCase()) || "aspx";
			// TECH- 29219
			if(RamcoRTC.osType == 'JAVA')
			{
				names[0] = names[0].split("_");
				names[0].pop();
				names[0] = names[0].join("_");
			}
			
			// TECH-33892
            if (!Ext.isEmpty(fileExtn) && (fileExtn == "aspx" || fileExtn == "jsp")) {
				strUrl = (RamcoRTC.osType == 'JAVA') ? objUrl[3] : objUrl[objUrl.length - 2];				
				//TECH-34035
                urlString = uiFilePath + strUrl + "/" + names[0] + "." + fileExtn + "?_dc=" + RamcoRTC.getCacheId();
			}
            else {
                // TECH- 29219
               // if(RamcoRTC.osType == 'JAVA')
				   //TECH-37874
				  if((RamcoRTC.osType == 'JAVA') && (url.indexOf('/iedk/') < 0 && url.indexOf('/client/') < 0))
					strUrl = objUrl[3];
				else
				{
					objUrl.pop();
					objUrl = objUrl.slice(1);
					strUrl = objUrl.join('/');
				}
				URLPath = (RamcoRTC.osType == 'JAVA') ? 'GetPageDetails.jsp' : 'GetPageDetails.ashx';
				urlString = "ilrt/" + URLPath +"?cn="+ strUrl +"&al="+ names[0] +"&lg=" + lang + "&login=" + loginStatus + "&_dc=" + RamcoRTC.getCacheId();
            }
        }
		if (RamcoRTC.isGProto === true) {
			urlString = "/app/classic/" + strUrl + "/" + names[0] + ".json?_dc=" + Date.now();
		}		
        return urlString;
    },
    isSamePage: function(url, ilboConfig) {
        if (!url || !ilboConfig)
            return false;
        else {
            var objUrl = url.toLowerCase().split('/');
            if (objUrl.length > 0) {
                var names = objUrl[objUrl.length - 1].split('.');
                if (names[1].toLowerCase() == "aspx")
                    return false;
                else
                    return ((objUrl[objUrl.length - 2] == ilboConfig.componentName) &&
                        (names[0] == ilboConfig.activityName + "_" + ilboName))
            } else {
                return false;
            }
        }
    },
    loadComponentPage: function(className) {
        var me = this,
            classNameUrl = Ext.Loader.getPath(className);
        return new Ext.Promise(function(resolve, reject) {
            Ext.Loader.loadScript({
                url: classNameUrl,
                onLoad: function(response) {
                    response.className = className;
                    response.classNameUrl = classNameUrl;
                    response.scope = me;
                    resolve(response);
                },
                onError: function(response) {
                    response.className = className;
                    response.classNameUrl = classNameUrl;
                    response.scope = me;
                    reject(response);
                }
            });
        });
    },
    onComponentPageResponse: function(response) {
        var me = response.scope,
            lastTaskType = me.getLastTaskType(),
            lastTaskType = lastTaskType ? lastTaskType.toLowerCase() : null,
            currentView = me.getCurrentView(),
            ilboView = me.getIlboView(),
            className = response.className,
            cmp = null;
        try {
            if (lastTaskType != 'help' && lastTaskType != 'modal') {
                if (currentView != null) {
                    Ext.destroy(ilboView.remove(currentView));
                }
                cmp = Ext.create(className);
                if (cmp) {
                    me.setCurrentView(cmp);
                    if (me.getIsLogin()) {
                        if (ilboView) {
                            ilboView.add([cmp]);
                            cmp.focus();
                        }
                    } else {
                        cmp.focus();
                    }
                }
            } else {
                cmp = Ext.create(className);
                if (cmp) {
                    me.setCurrentHelp(cmp);
                    me.helpWindow.removeAllComponent(true);
                    me.helpWindow.center();
                    me.helpWindow.addComponent(cmp);
                    me.helpWindow.setTitle(cmp.ilboConfig.ilboDesc);
                    me.helpWindow.show();
                    me.helpWindow.updateLayout();
                }
            }
        } catch (e) {
            console.log(e);
            Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R226);
        }
        me.mask(false);
    },
    onComponentPageRejected: function(response) {
        var me = response.scope;
        me.mask(false);
        Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R223 + ' \n' + response.className);
    },
    loadPage: function(className) {
        var me = this;
		/*RamcoRTC.getFileRequest(me.onPageResponse.bind(me), me.onPageRejected.bind(me), me, className);
		*/
		RamcoLog.end('Client Trans');
		RamcoLog.start('Server Trans', className);
        Ext.Ajax.request({
			timeout: 600000,
            url: className,
            disableCaching: false,
            success: me.onPageResponse.bind(me),
            failure: me.onPageRejected.bind(me)
        });
    },
    loadIEDKPage: function(className) {
		RamcoLog.end('Client Trans');
		RamcoLog.start('Server Trans', className);
        var me = this;
		className = className + "?_dc=" + RamcoRTC.cacheId;
		/*RamcoRTC.getFileRequest(me.onIEDKPageResponse.bind(me), me.onIEDKPageRejected.bind(me), me, className);
		*/
        Ext.Ajax.request({
			timeout: 600000,
            url: className,
            disableCaching: false,
            success: me.onIEDKPageResponse.bind(me),
            failure: me.onIEDKPageRejected.bind(me)
        });
    },
    onPageResponse: function(response, options) {
		RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','pageResponse');
        var me = this,
            src = null,
            oScript = null,
            head = (document.getElementsByTagName("head")[0] || document.documentElement),
            cmp = null,
            win = null,
            accesskey,
			smartBarWin = me.getBtnSmartBar(),
            objMenu,
            textVal,
            currentView = me.getCurrentView(),
            currentHelp = me.getCurrentHelp(),
			controller,
            pageConfig;
        try {
			if(currentView) {
				controller = currentView.getController();
			}
            pageConfig = Ext.decode(response.responseText, true);
			if(pageConfig && pageConfig.status == "Failed") {
				if (controller)
					controller.taskPending = false;
				var lastTaskType = me.getLastTaskType();
				if (lastTaskType == 'modal' || lastTaskType == 'help')
					me.setLastTaskType(null);
				Ext.RamcoMsg.alert(rvw_resources.R260, pageConfig.error, function() {
					if (me.getIsLogin() === false) {
						return;
					}
					me.setTaskDesc('On Cancel');
					me.setLastTaskType('trans');
					if(!Ext.isEmpty(RamcoRTC.userInfo.forcecmp) && !Ext.isEmpty(RamcoRTC.userInfo.forceact) && !Ext.isEmpty(RamcoRTC.userInfo.forceilb)){
						RamcoRTC.doLogout(me.onRequestComplete, me.onRequestException, me, {}, 'tskstdquit', 'trans');
						return;
					}else if (me.getDefaultActivityLaunched() && RamcoRTC.userInfo.defac && RamcoRTC.userInfo.defic) {
						me.setInvalidPageLaunch(true);
					}
					
					var task = 'tskstdgo',
						ilboConfig = {
								activityName: 'homepage',
								ilboName: 'homepage',
								compName: 'security'
						};
					if (!Ext.isEmpty(currentHelp) || !Ext.isEmpty(currentView)) {
						ilboConfig = (currentHelp) ? currentHelp.ilboConfig : currentView.ilboConfig 
					}
					RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, ilboConfig, task, 'trans', null, null);
				}, me);
				me.mask(false);
				return;
			}				
            accesskey = me.getAccessKey();			
			if (pageConfig && pageConfig.ilboConfig) {
				if (pageConfig.ilboConfig.activityName == "login")
					delete pageConfig.plugins;
				// TECH-27458 - Modal level Smartbar
				if(smartBarWin && pageConfig.ilboConfig.ilboType != '6') {
					if (pageConfig.smartBar || (!smartBarWin.isHidden() && me.getLastTaskType() == 'modal'))
						smartBarWin.show();
					else
						smartBarWin.hide();
				}
			}
			
            if (pageConfig && pageConfig.accessdetails) {
                accesskey.setHidden(false);
                objMenu = Ext.create('Ext.menu.Menu', {});
                for (i = 0; i < pageConfig.accessdetails.length; i++) {
                    textVal = {
                        text: ' Alt&nbsp+' + pageConfig.accessdetails[i].key + " &nbsp->&nbsp" + pageConfig.accessdetails[i].desc,
                        xtype: 'button',
                        accesskey: pageConfig.accessdetails[i].key,
                        role: 'mainpage'
                    }
                    objMenu.add(textVal);
                }

                accesskey.setMenu(objMenu);
            } else {
                if (typeof accesskey != 'undefined')
                    accesskey.setHidden(true);
            }
            if (pageConfig) {
				if(Ext.isEmpty(RamcoRTC.settings.mapProvider))
					RamcoRTC.settings.mapProvider = "openStreetMap";
                if (!window.google && pageConfig.google && RamcoRTC.settings.mapProvider == "google") {
					RamcoLog.end('Client Trans');
					RamcoLog.start('Server Trans','GMAP');
                    src = window.location.protocol + "//maps.googleapis.com/maps/api/js?key=" + RamcoRTC.settings.googlemapkey;
                    oScript = document.createElement("script");
					oScript.language = "javascript";
                    oScript.type = "text/javascript";
                    oScript.defer = true;
					oScript.onerror = function(){
						RamcoLog.end('Server Trans');
						RamcoLog.start('Client Trans','GMap');
						me.onLoadMapFail(pageConfig);
					}
                    oScript.onload = function(){
						RamcoLog.end('Server Trans');
						RamcoLog.start('Client Trans','GMap');
						me.onLoadMapSuccess(pageConfig);
					} 
                    head.appendChild(oScript);
                    oScript.src = src;
                }
                //TECH-37671
				else if(pageConfig.google && ((!window.L && RamcoRTC.settings.mapProvider == "openStreetMap") || RamcoRTC.settings.mapProvider == "mapMyIndia" || RamcoRTC.settings.mapProvider == "hereMap")){//TECH-27237 
					//TECH-28641
					if(Ext.isEmpty(RamcoRTC.settings.tileServer)){
						if(RamcoRTC.settings.mapProvider == "hereMap"){
							RamcoRTC.settings.tileServer = {};
							RamcoRTC.settings.tileServer.url = "http://4.base.maps.api.here.com/maptile/2.1/maptile/newest/normal.day/{z}/{x}/{y}/256/png8?app_id="+RamcoRTC.settings.hereAppId+"&app_code="+RamcoRTC.settings.hereAppCode;
							RamcoRTC.settings.tileServer.options = {
								attribution:"<a href=\"https://legal.here.com/terms/serviceterms/gb/\" target=\"_blank\">HERE maps</a> . Data by <a href=\"http://openstreetmap.org\" target=\"_blank\">OpenStreetMap</a>, under <a href=\"http://creativecommons.org/licenses/by-sa/3.0\" target=\"_blank\">CC BY SA</a>.",
								maxZoom:18,
								minNativeZoom:0
							}
						}else{
						RamcoRTC.settings.tileServer = {};
						RamcoRTC.settings.tileServer.url = "https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png";
						RamcoRTC.settings.tileServer.options = {
							attribution:"Map tiles by <a href=\"http://stamen.com\" target=\"_blank\">Stamen Design</a>, under <a href=\"http://creativecommons.org/licenses/by/3.0\" target=\"_blank\">CC BY 3.0</a>. Data by <a href=\"http://openstreetmap.org\" target=\"_blank\">OpenStreetMap</a>, under <a href=\"http://creativecommons.org/licenses/by-sa/3.0\" target=\"_blank\">CC BY SA</a>.",
							maxZoom:18,
							minNativeZoom:0
						}
					}
					}
					if(Ext.isEmpty(RamcoRTC.settings.fallbackServer)){
						if(RamcoRTC.settings.mapProvider == "hereMap"){
							RamcoRTC.settings.fallbackServer = {};
							RamcoRTC.settings.fallbackServer.url = "http://4.base.maps.api.here.com/maptile/2.1/maptile/newest/normal.day/{z}/{x}/{y}/256/png8?app_id="+RamcoRTC.settings.hereAppId+"&app_code="+RamcoRTC.settings.hereAppCode;
							RamcoRTC.settings.fallbackServer.options = {
								attribution:"<a href=\"https://legal.here.com/terms/serviceterms/gb/\" target=\"_blank\">HERE maps</a> . Data by <a href=\"http://openstreetmap.org\" target=\"_blank\">OpenStreetMap</a>, under <a href=\"http://creativecommons.org/licenses/by-sa/3.0\" target=\"_blank\">CC BY SA</a>.",
								maxZoom:18,
								minNativeZoom:0
							}
						}else{
						RamcoRTC.settings.fallbackServer = {};
						RamcoRTC.settings.fallbackServer.url = "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
						RamcoRTC.settings.fallbackServer.options = {
							attribution:"Map tiles by <a href=\"http://openstreetmap.org\" target=\"_blank\">OpenStreetMap</a>.",
							maxZoom:18,
							minNativeZoom:0
						}
					}
					}
					//TECH-37671
					var olink = document.createElement('link');
					 olink.rel = 'stylesheet';
					 olink.type = 'text/css';
					 olink.href = 'classic/resources/leaflet.css';
					 head.appendChild(olink);
					 olink.onload = function(){
						 RamcoLog.end('Server Trans');
						 RamcoLog.start('Client Trans','OpenStreetMap');
								var oScript = document.createElement("script");
                        oScript.language = "javascript";
                    oScript.type = "text/javascript";
                    oScript.defer = true;
								if(RamcoRTC.settings.mapProvider == "openStreetMap" || RamcoRTC.settings.mapProvider == "hereMap")
					oScript.src = 'ramco/leaflet-src.js';
						 else if(RamcoRTC.settings.mapProvider == "mapMyIndia")
							oScript.src = window.location.protocol + "//apis.mapmyindia.com/advancedmaps/v1/" +RamcoRTC.settings.mapMyIndiaKey + "/map_load?v=01.";
								head.appendChild(oScript);
                   oScript.onerror = function(){
						RamcoLog.end('Server Trans');
						RamcoLog.start('Client Trans','OpenStreetMap');
									console.log('Leaflet Soruce file not loaded');
						me.onLoadMapFail(pageConfig);
					}
                    oScript.onload = function(){
						RamcoLog.end('Server Trans');
						RamcoLog.start('Client Trans','OpenStreetMap');
									var oScriptRout = document.createElement("script");
									oScriptRout.language = "javascript";
									oScriptRout.type = "text/javascript";
									oScriptRout.defer = true;
									head.appendChild(oScriptRout);
									//if(RamcoRTC.settings.mapProvider == "openStreetMap")
										oScriptRout.src = 'ramco/leaflet-routing-machine.js';
										oScriptRout.onerror = function(){
											RamcoLog.end('Server Trans');
											RamcoLog.start('Client Trans','OpenStreetMap');
											me.onLoadMapFail(pageConfig);
						} 
										oScriptRout.onload = function(){
							RamcoLog.end('Server Trans');
							RamcoLog.start('Client Trans','OpenStreetMap');
						me.onLoadMapSuccess(pageConfig);
					} 
					}
                   
                } 
					olink.onerror = function(){
						RamcoLog.end('Server Trans');
						RamcoLog.start('Client Trans','OpenStreetMap');
						console.log('Leaflet css not loaded');
						me.onLoadMapFail(pageConfig);
					}
				/*
					else if(pageConfig.google && RamcoRTC.settings.mapProvider == "mapMyIndia"){//TECH-28715 
						//RamcoLog.end('Client Trans');
						//RamcoLog.start('Server Trans','MapMyIndia');
						var olink = document.createElement('link');
						olink.rel = 'stylesheet';
						olink.type = 'text/css';
						olink.href = 'classic/resources/leaflet.css';
						head.appendChild(olink);
						oScript = document.createElement("script");
						oScript.language = "javascript";
						oScript.type = "text/javascript";
						oScript.defer = true;
						oScript.src = window.location.protocol + "//apis.mapmyindia.com/advancedmaps/v1/" +RamcoRTC.settings.mapMyIndiaKey + "/map_load?v=01.";
						oScript.onerror = function(){
							RamcoLog.end('Server Trans');
							RamcoLog.start('Client Trans','MapMyIndia');
							me.onLoadMapFail(pageConfig);
						}
						oScript.onload = function(){
							RamcoLog.end('Server Trans');
							RamcoLog.start('Client Trans','MapMyIndia');
							me.onLoadMapSuccess(pageConfig);
						} 
						head.appendChild(oScript);
						oScript.src = src;
                	}
				 */
			}
				else {
                    me.onLoadMapSuccess(pageConfig);
                }
            } else {
				var lastTaskType = me.getLastTaskType();
				if (lastTaskType == 'modal' || lastTaskType == 'help')
					me.setLastTaskType(null);
                Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R222);
                me.mask(false);
            }
        } catch (e) {
            console.log(e);
            Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R226);
            me.mask(false);
        }
    },
    onLoadMapFail: function(pageConfig) {
        var me = this;
        console.log('Error in loading map script.');
        me.onLoadMapSuccess(pageConfig);
    },
    onLoadMapSuccess: function(pageConfig, pageLaunch) {
        var me = this,
			cmp=null,
            className = null,
			// TECH-32615 / PEPS-170
			lastURL = me.getLastUrl(),
			instance = (RamcoRTC.currentInstance) ? RamcoRTC.currentInstance : 'default',
			lastIEDKURL = me._lastIEDKUrl && me._lastIEDKUrl[instance];
		// TECH-32615 / PEPS-170
		if (!Ext.isEmpty(lastURL) && !Ext.isEmpty(lastIEDKURL) && lastURL.toLowerCase() == lastIEDKURL.toLowerCase())
			RamcoRTC.iEDK = '1';
		
        if (RamcoRTC.iEDK == '1' && !pageLaunch) {
            RamcoRTC.pageConfig = pageConfig;
            className = uiFilePath + 'iedk/' + RamcoRTC.segmentName + '/' + pageConfig.ilboConfig.componentName + '/client/' + pageConfig.ilboConfig.activityName + '_' + pageConfig.ilboConfig.ilboName + '.json'
            me.loadIEDKPage(className);
            return;
        }
		
		/*if (!Ext.isEmpty(RamcoRTC.currentInstance)) {
			var btnDefault = me.getBtnMenuDefault(),
				defMenu = btnDefault.getMenu();
			if (defMenu) {
				currInstance = defMenu.items.getByKey(RamcoRTC.currentInstance);
				if (currInstance)
					currInstance.pageConfig = pageConfig;
			}
		}*/
		console.log("Component create " + new Date().getTime());
		
        try {
			//pageConfig.userCls = "x-hideilbo";
			/* if(pageConfig.smartHide)
				pageConfig.userCls += " x-smarthide"; */
			//cmp = Ext.create('Ext.ramco.Ilbo', pageConfig);
			cmp = new Ext.ramco.Ilbo(pageConfig);			
        } catch (e) {
            me.mask(false);
            Ext.RamcoMsg.alert('Virtual Works™ Message', rvw_resources.R226, function() {
                me.setTaskDesc('On Cancel');
                me.setLastTaskType('trans');
                RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, pageConfig.ilboConfig || {}, 'tskstdcancel', 'trans', null, null);
            }, me);
            return;
        }
		cmp.addCls('x-hideilbo');
        //TECH-39980
		if(cmp.smartHide){
			var fillers = cmp.query("component[html=\"&nbsp;\"]");
			if(fillers && fillers.length > 0){
				fillers.forEach(function(item){
					if(item){
						item.maxHeight = 0;
					}
				})
			}
		}
		RamcoRTC.cmp = cmp;
		RamcoRTC.pageConfig = pageConfig;
		setTimeout(function(){
			cmp.callInit();
		},0);
	},
	onAfterLoad:function(){
		 var me = this,
            lastTaskType = me.getLastTaskType(),
            lastTaskType = lastTaskType ? lastTaskType.toLowerCase() : null,
            currentView = me.getCurrentView(),
            currentHelp = me.getCurrentHelp(),
            mainView = me.getMainView(),
            ilboView = me.getIlboView(),
			txtBpcIlboTitle = me.getTxtBpcIlboTitle(),
            ilboTitle = me.getIlboTitle(),
            btnArrow3 = me.getBtnArrow3(),
            btnArrow2 = me.getBtnArrow2(),
            btnActivity = me.getBtnActivity(),
			btnWorkAreaStyle = me.getBtnWorkAreaStyle(), // TECH-28716
            firstTimeLogin = me.getFirstTimeLogin(),
            persMode = me.getPersonalization(),
            defaultMode = me.getDefaultTemplate(),
            forgotPwd = me.getForgotPwd(),
            activityDesc = me.getActivityDesc(),//TECH-36935
            win = null,
            size = {},
            cmp = RamcoRTC.cmp,
			pageConfig = RamcoRTC.pageConfig;
            className = null;
		RamcoRTC.cmp = null;
		delete  RamcoRTC.cmp;
		RamcoRTC.pageConfig = null;
		delete  RamcoRTC.pageConfig;
		// TECH-32503/CDIH-122
		if(persMode && cmp){
			cmp.addCls('x-pers-ilbo');
			if(cmp.smartHide)
				delete cmp.smartHide;
		}
        if (lastTaskType != 'help' && lastTaskType != 'modal' && lastTaskType != "smartviewlink" && !currentHelp && !firstTimeLogin && !forgotPwd) {
            if (currentView != null) {
				/*if (currentView.contextMenu) {
					Ext.destroy(currentView.contextMenu);
					delete currentView.contextMenu;
				}*/					
				if (ilboTitle && ilboTitle.menu) {
					Ext.destroy(ilboTitle.menu)
					if (txtBpcIlboTitle)
						Ext.destroy(txtBpcIlboTitle.menu);
					delete ilboTitle.menu;
					if (txtBpcIlboTitle)
						delete txtBpcIlboTitle.menu;
				}
				//Ext.suspendLayouts();
                Ext.destroy(ilboView.remove(currentView));
				//Ext.resumeLayouts();
            }
            if (cmp) {
				if (RamcoRTC.settings.isExt2 == true && RamcoRTC.settings.bannerCollapse === true) {					
					var northPnl = mainView.getComponent("northPanel");
					if (northPnl && northPnl.splitter && northPnl.splitter.collapseEl && northPnl.getCollapsed() === false) {
						northPnl.collapse();
					}
				}
				cmp.callBackStatus = "IP";
				me.setCurrentView(cmp);
				if (me.getIsLogin() || me.getIsBeforeLogin()) {
                    me.setIsBeforeLogin(false);
                    if (ilboView) {
                        
						/* TECH-33610 / PTPH-22 - Wizard Toolbar buttons Creation and Selection */
						/* TECH-35301 / LMH-200 - Handling Wizard Toolbar Buttons with overflowing menu handling */
						var dataArray = me.getWizBtns();
                        //if (me.getLastTask() == "tskstdwizardlink" || (dataArray && !Ext.isEmpty(dataArray['preItem'])) && cmp.ilboConfig.activityName != 'def_user_ezwizard') {
                        if (me.getLastTask() == "tskstdwizardlink" || (dataArray && !Ext.isEmpty(dataArray['preItem'])) && cmp.ilboConfig.ilboName != "ezwizard") {
							if (!Ext.isEmpty(dataArray) && dataArray.length > 0) {
								var value, activeWizBtn, inLimit = false, wizardNavItems, actPreItem,
									i = 0, count, len = dataArray && dataArray.length || 0,
									wizText;
								
								activeWizBtn = dataArray['preItem'];
								if (!Ext.isEmpty(activeWizBtn))
									activeWizBtn = parseInt(activeWizBtn);
								
								wizardNavItems = Ext.create('Ext.toolbar.Toolbar', {
	                                width: '99%',
									dock: 'top',
									cls: 'x-toolbar-wizbuttons',
	                                items: []
								});
								
								actPreItem = dataArray['actPreItem'];
								
								var startIndex = (!Ext.isEmpty(activeWizBtn)) ? activeWizBtn : dataArray.findIndex(function(a, b) {return a.act == 1}),
									wizToolbarWidth = (ilboView && ilboView.getWidth() - 50) || window.screen.availWidth,
									availToolCount = Math.floor((wizToolbarWidth - 50) / 200),
									actStartIndex;
								
								if (!Ext.isEmpty(actPreItem)) {
									actStartIndex = actPreItem;
									dataArray['actPreItem'] = null;
								}
								else if (!Ext.isEmpty(activeWizBtn))
									actStartIndex = activeWizBtn;
								/* else if (!Ext.isEmpty(actStartIndex))
									dataArray['preItem'] = actStartIndex; */
								
								actStartIndex = (availToolCount > len) ? startIndex : (((startIndex - 1) + availToolCount <= (len - 1)) ? startIndex : ((len - 1) - (availToolCount - 1)));
								count = actStartIndex + availToolCount;
								
								if (availToolCount > len) {
									count = availToolCount = len;
									actStartIndex = 0;
									inLimit = true;
								}
								else if((actStartIndex - 1) + availToolCount > len) {
									actStartIndex = (len - 1) - (availToolCount - 1);									
								}
								
								// TECH-37523
								//dataArray['preItem'] = actStartIndex;
								if (!Ext.isEmpty(startIndex) && Ext.isEmpty(dataArray['preItem']) && Ext.isEmpty(dataArray['actPreItem']))
									dataArray['preItem'] = dataArray['actPreItem'] = startIndex;
								
								//for (i = 0; i < len; i++) {
								for (i = actStartIndex; i < count; i++) {
									wizText = (i + 1) + '. ' + dataArray[i].wd;
	                                value = [{
										text: wizText,
										name: i,
	                                    minWidth: 195,
										tooltip: wizText,
										itemId: 'wiz-step-' + i,
										xtype: 'button',
										role: 'mainpage',
										task: 'tskstdwizardlink'
	                                }, {
										xtype: 'component',
										html: '|',
										hidden: (i == count - 1),
										width: 1
									}];
									if (i == activeWizBtn || dataArray[i].act == 1)
										value[0].cls = 'x-actwiz-btntab';
									wizardNavItems.add(value);
								}
								var wizToolBtn = Ext.create('Ext.button.Button', {
									width: 20,
									hidden: inLimit,
									cls: 'x-toolbar-wizbtnmenu',
									role: 'uipage',
									itemId: 'dockContainerBtn'
								});
								
								var wizToolBtnMenuVal = [];
								for (var l = 0 ; l < dataArray.length; l++) {
									wizText = (l + 1) + '. ' + dataArray[l].wd;
									wizToolBtnMenuVal.push({
										text: wizText,
										name: l,
										group: 'theme',
										checked: (l == activeWizBtn || dataArray[l].act == 1) ? true : false,
										tooltip: wizText,
	                                    role: 'mainpage',
	                                    task: 'tskstdwizardlink'
									});
								}
								
								var wizToolBtnMenu = Ext.create('Ext.menu.Menu', {
									itemId: 'x-menu-wizbtn',
									maxHeight: 600,
									width: 80,
									items: wizToolBtnMenuVal
								});
								
								wizToolBtn.setMenu(wizToolBtnMenu);
								
								wizardNavItems.add({ xtype: 'component', html: '', width: 30 }, '->');
								wizardNavItems.add(wizToolBtn);
								cmp.dockedItems.add(wizardNavItems);
								/* TECH-35301 / LMH-200 - End of Handling Wizard Toolbar Buttons with overflowing menu handling */
							}
                        }
						
						//ilboView.suspendLayouts();
						ilboView.add(cmp);
						//ilboView.resumeLayouts();
						
						//setTimeout(function(){
							if(RamcoRTC.isProto && RamcoRTC.isOProto === false) {
								ilboTitle.suspendLayouts();
								if (txtBpcIlboTitle) {
									txtBpcIlboTitle.suspendLayouts();								
									txtBpcIlboTitle.setText(cmp.ilboConfig.ilboDesc);
									txtBpcIlboTitle.resumeLayouts();	
								}								
								ilboTitle.setText(cmp.ilboConfig.ilboDesc);
								ilboTitle.resumeLayouts();
							}
							else {
								//Ext.suspendLayouts();
								//ilboTitle.suspendLayouts();
								//TECH-27479
								me.doMenuSync(cmp.ilboConfig.componentName, cmp.ilboConfig.activityName, cmp.ilboConfig.ilboName, cmp.ilboConfig.ilboDesc,cmp.ilboConfig.componentDesc);
								//btnActivity.show();
								//btnArrow2.show();							
								//TECH-36935
								ilboTitle.setText(cmp.ilboConfig.ilboDesc);								
								me.setActivityDesc(cmp.ilboConfig.activityDesc);
								if (txtBpcIlboTitle)
									txtBpcIlboTitle.setText(cmp.ilboConfig.ilboDesc);
								// TECH-28716
								if (!Ext.isEmpty(RamcoRTC.settings.workAreaRepresentation) && RamcoRTC.settings.workAreaRepresentation == 'style1') {
									var workAreaItems = btnWorkAreaStyle && btnWorkAreaStyle.items && btnWorkAreaStyle.items.items;
									if(!Ext.isEmpty(workAreaItems)) {
										workAreaItems[0].setTooltip('Default');
										for (var l = 1; l < workAreaItems.length; l++) {
											if (workAreaItems[l].isActive == true) {											
												if (RamcoRTC.wizardLaunched == true && cmp.ilboConfig.activityName == 'ezwizard') {
													workAreaItems[l].removeCls('actworkarea');
													//workAreaItems[l].isActive = false;
												}
												else {
													workAreaItems[l].setTooltip(cmp.ilboConfig.ilboDesc);
													workAreaItems[l].ilboConfig = cmp.ilboConfig;
												}
											}
										}
									}
								}
								
							if (RamcoRTC.settings.isExt2 == true)
								btnArrow3.show();
							else
								btnArrow3.hide();
							
							//ilboTitle.resumeLayouts();
							//Ext.resumeLayouts();
							}
						//},10);						
                    }
                }
				
				// TECH-29150
				var UdsMenu = me.getBtnUdsMenu();
				if (UdsMenu && !UdsMenu.isHidden()) {
					Ext.suspendLayouts();
					UdsMenu.hide();
					UdsMenu.setMenu(null);
					Ext.resumeLayouts();
				}
				
				if (!persMode && !defaultMode) {
					var hideConfig = '';
					if (pageConfig) {
						if (RamcoRTC.isEntUser == false) {
							if (pageConfig.hideIlboPersonalisation == true) {
								hideConfig = me.getBtnPreference();
								if (hideConfig)
									hideConfig.setVisible(false);
							}
							if (pageConfig.hideIlboDefaults == true) {
								hideConfig = me.getBtnDefaultMode();
								if (hideConfig)
									hideConfig.setVisible(false);
								hideConfig = me.getBtnTemplate();
								if (hideConfig)
									hideConfig.setVisible(false);
							}
						}
						//if (pageConfig.hidePrint == true || RamcoRTC.settings.hidePrintButton == true || (currentView && currentView.templateFile == true)) {
							hideConfig = me.getBtnPrintBar();
						if (hideConfig) {
							if (pageConfig.hidePrint == false)							
								hideConfig.setVisible(true);
							else
								hideConfig.setVisible(false);
						}
					}
				}
            }
        } else {
            if (cmp && !firstTimeLogin && !forgotPwd) {
                var ilboSize = mainView.getSize();
                //if (!Ext.isEmpty(currentHelp) && lastTaskType != 'help') {
				//if (!Ext.isEmpty(currentHelp) && currentHelp.ilboConfig && currentHelp.ilboConfig.ilboType != '6') {
				//if (cmp.ilboConfig && (cmp.ilboConfig.ilboType != '6' || lastTaskType == 'link')) {
				// TECH-39155
				if (cmp.ilboConfig && ((cmp.ilboConfig.ilboType != '6' && !(cmp.ilboConfig.ilboType == '3' &&  cmp.modelSource == 'edk')) || lastTaskType == 'link')) {
                    lastTaskType = 'modal';
					if (!me.helpWindow.isHidden())
						me.helpWindow.hide();
                }
				if (lastTaskType != 'modal') {
                    lastTaskType = 'help';
                    if (!me.modalWindow.isHidden())
						me.modalWindow.hide();
                }
                win = (lastTaskType == 'help' || !(me.helpWindow.isHidden())) ? me.helpWindow : me.modalWindow;				
				win.tmpConfig = currentView ? currentView.ilboConfig : {};
                /*
                if (!win.tmpConfig && me.helpWindow.isHidden() && me.modalWindow.isHidden())
                    win.tmpConfig = currentView ? currentView.ilboConfig : {};
                else if (!win.tmpConfig)
                    win.tmpConfig = currentHelp ? currentHelp.ilboConfig : {};
				*/
				//TECH-30196
				win.removeAllComponent(true);				
				// TECH-39155
				if (win.bottomTb) {
					win.bottomTb.suspendLayouts();
					if (cmp.ilboConfig.ilboType == '3' && cmp.modelSource == 'edk')
						win.bottomTb.hide();
					else
						win.bottomTb.show();
					win.bottomTb.resumeLayouts();
				}
                //win.addComponent(cmp);
				me.setWindowSize(win, size, cmp);
                win.isClose = false;
				win.show();
				//TECH-34886
				win.alwaysOnTop = true;
				//TECH-30196
				//win.checkCancel(); 
                if (lastTaskType != 'help') {
                    win.setMaxWidth(ilboSize.width - 50);
                    win.setMaxHeight(ilboSize.height - 80);
                }
				if(RamcoRTC.hasSmartViewLink) {
					win.header.setVisible(false);
					win.body.addCls("x-smartview-window");
					if (me.modalWindow && me.modalWindow.isHidden())
						win.showBy(RamcoRTC.smartViewLnkCtrl, 'tl-bl?');
					win.maskClickAction = "hide";
					win.winType = "smartview";
					RamcoRTC.hasSmartViewLink = false;
				}
				else {
					win.center();				
					win.header.setVisible(true);
					win.winType = lastTaskType;//TECH-27444
					win.body.removeCls("x-smartview-window");
					win.maskClickAction = "focus";
				}
                me.setCurrentHelp(cmp);
				//TECH-30196
                //win.removeAllComponent(true);
                win.addComponent(cmp);
				win.checkCancel();
                win.setTitle(cmp.ilboConfig.ilboDesc);
                if (lastTaskType == 'help') {
                    if (size.width > ilboSize.width) {
                        size.width = ilboSize.width - 100;
                        win.setMaxWidth(size.width);
                    }
                    if (size.height > ilboSize.height) {
                        size.height = ilboSize.height - 60;
                        win.setMaxHeight(size.height);
                    } else
                        win.setMaxHeight(ilboSize.height - 60);

                    if (size.width || size.height)
                        win.setSize(size);
                } else if (lastTaskType == 'modal') {
                    var cmpSize = {},
						popupSize = null,
						actName, popupObj, perIlbo;
                    try {
                        if (cmp && cmp.rendered) {
                            cmpSize = cmp.getSize();
                            perIlbo = cmp.el.down('table[per=ilbo]');
                            if (perIlbo)
                                cmpSize = perIlbo.getSize();
                        } else
                            cmpSize = {
                                height: parseInt(cmp.height, 10),
                                width: parseInt(cmp.width, 10)
                            };
                        if (!win.childWidth)
                            cmpSize.width = ilboSize.width - 100;
                        if (!win.ChildHeight)
                            cmpSize.height = ilboSize.height - 60;

                        if (cmp.width)
                            cmpSize.width = cmp.width;
                        if (cmp.height)
                            cmpSize.height = cmp.height;
						actName = cmp.ilboConfig.activityName;
						popupObj = (actName && RamcoRTC.settings.popupSize) ? RamcoRTC.settings.popupSize[actName] : null;
						if (popupObj) {
							popupSize = {};
							popupSize.height = popupObj.h;
							popupSize.width = popupObj.w;
						}

                    } catch (e) {

                    }
                    if (win.childWidth)
                        size.width = parseInt(win.childWidth, 10);
                    else if (cmpSize.width)
                        size.width = cmpSize.width + 50;
                    else
                        size.width = ilboSize.width - 100;

                    if (win.childHeight)
                        size.height = parseInt(win.childHeight, 10);
                    else if (cmpSize.height)
                        size.height = cmpSize.height;
                    else
                        win.setMaxHeight(ilboSize.height - 60);
                    //win.childWidth = null;
                    //win.childHeight = null;
					if (popupSize) {
						win.setSize(popupSize);
						win.setMaxWidth(popupSize.width);
						win.setMaxHeight(popupSize.height);
						win.updateLayout();
					}
					else if (size.width || size.height) {
						//TECH-30196
						/*var winSize = {}, winData = me.getAllWindowData();
						
						var winData = winData.find(function(value) { if(value.id == cmp.tempId) return value; });
						if (!Ext.isEmpty(winData))
							winSize = winData.winsize;*/
						
						/* for (var x = 0; x < winData.length; x++) {
							if (winData[x].id == cmp.tempId) {
								winSize = winData[x].winsize;
								break;
							}
						} */
						
						/*if (winSize && winSize.width != '100%')
							size = winSize;
	                        win.setSize(size);*/
						me.setWindowSize(win, size, cmp);						
                        if (size.width)
                            win.setMaxWidth(size.width);
                        if (size.height)
                            win.setMaxHeight(size.height);
                    }
                }
				if(win.winType == "smartview") {
					var totWidth = document.body.offsetWidth,
						totHeight = document.body.offsetHeight,
						smartSecWidth = win.getWidth(),
						smartSecHeight = win.getHeight(), //TECH-34281
						ctrlX, ctrlPos,smartWidth = null,smartHeight = null, ctrlY,
						//TECH-34281
						ilboViewSize = ilboView.getSize(),
						ilboViewWidth,
						ilboViewHeight,
						changeWinSize = false;
					ilboViewWidth = ilboViewSize.width;
					//TECH-34281
					ilboViewHeight = ilboViewSize.height;	
					/* if (!Ext.isEmpty(me.popupPosCtrl))
						RamcoRTC.smartViewLnkCtrl = me.popupPosCtrl; */
					if (!Ext.isEmpty(RamcoRTC.smartViewLnkCtrl)) {
						ctrlX = RamcoRTC.smartViewLnkCtrl.getX();
						ctrlY = RamcoRTC.smartViewLnkCtrl.getY(); //TECH-34281
						if(RamcoRTC.smartViewLnkCtrl.childWidth && RamcoRTC.smartViewLnkCtrl.childHeight){
						 	smartWidth = parseInt(RamcoRTC.smartViewLnkCtrl.childWidth, 10);
						 	smartHeight = parseInt(RamcoRTC.smartViewLnkCtrl.childHeight, 10); //TECH-34281
							if (smartWidth > ilboViewWidth) {
								smartWidth = ilboViewWidth - 30; //TECH-34281
								changeWinSize = true;								
							}
							if (smartHeight > ilboViewHeight) {
								smartHeight = ilboViewHeight - 30; //TECH-34281
								changeWinSize = true;
							}
							win.setSize({width:smartWidth,height:smartHeight});
							win.setMaxWidth(smartWidth);
							win.setMaxHeight(smartHeight);
						}
						
					//TECH-34281
					/*if ((ctrlX - (smartSecWidth + 50)) < 0)
						win.showBy(RamcoRTC.smartViewLnkCtrl, 'tl-br?');
						//win.showBy(RamcoRTC.smartViewLnkCtrl, 'tl-bl?');
					else if (totWidth > smartSecWidth + ctrlX)
						win.showBy(RamcoRTC.smartViewLnkCtrl, 'tl-bl?');
					else if (totWidth <= smartSecWidth + ctrlX)
						win.showBy(RamcoRTC.smartViewLnkCtrl, 'tr-bl?');*/
					
					if ((smartSecWidth + ctrlX) > totWidth && (smartSecHeight + ctrlY) > totHeight)
						win.center();
					else if ((smartSecWidth + ctrlX) > totWidth && (smartSecHeight + ctrlY) < totHeight)
						win.showBy(RamcoRTC.smartViewLnkCtrl, 'tr-bl?');
					else if ((smartSecWidth + ctrlX) < totWidth && (smartSecHeight + ctrlY) > totHeight)
						win.showBy(RamcoRTC.smartViewLnkCtrl, 'tl-tc?');
					else if ((smartSecWidth + ctrlX) < totWidth && (smartSecHeight + ctrlY) < totHeight)
						win.showBy(RamcoRTC.smartViewLnkCtrl, 'tr-bl?');
					else if ((ctrlX - (smartSecWidth + 50)) < 0)
						win.showBy(RamcoRTC.smartViewLnkCtrl, 'tl-br?');
				}
				else {
						ctrlPos = me.popupPos;
						win.showAt(ctrlPos);
					}
				}
				else {
                	win.center();
                	win.show();
				}
                modalPrint = win.queryById('modalPrint');
				// TECH-27458 - Modal level Smartbar
				modalSmartBar = win.queryById('modalSmartBar');
                modalHelp = win.queryById('modalHelp');
                modalRefresh = win.queryById('modalRefresh');
                modalCancel = win.queryById('modalCancel');
				if (modalPrint && cmp) {
					//if (RamcoRTC.settings.hidePrintButton == true || cmp.templateFile == true)
					if (cmp.hidePrint == false)
						modalPrint.show();
					 else
						modalPrint.hide();
				}
				
				// TECH-27458 - Modal level Smartbar
				if (modalSmartBar){//TECH-27537
					if (cmp.smartBar)
						  modalSmartBar.show();
					else
						modalSmartBar.hide();
				}
			    if (modalHelp)
                    modalHelp.show();
                if (modalRefresh)
                    modalRefresh.show();
                if (modalCancel && me.getWindowIndex() > 1)
                    modalCancel.show();
                win.updateLayout();
            } else {
                win = me.modalWindow;
            	win = (lastTaskType == 'help' || !(me.helpWindow.isHidden())) ? me.helpWindow : me.modalWindow;
				win.tmpConfig = currentView ? currentView.ilboConfig : {};
				me.setCurrentHelp(cmp);
                win.removeAllComponent(true);
			    win.addComponent(cmp);
				win.setTitle(cmp.ilboConfig.ilboDesc);
                win.childWidth = 800;
                win.childHeight = 400;
                win.closable = true;
                if (win.childWidth)
                    size.width = parseInt(win.childWidth, 10);
                if (win.childHeight)
                    size.height = parseInt(win.childHeight, 10);
                win.childWidth = null;
                win.childHeight = null;
                if (size.width || size.height) {
                    win.setSize(size);
                    if (size.width)
                        win.setMaxWidth(size.width);
                    if (size.height)
                        win.setMaxHeight(size.height);
                }

                win.show();
                win.center();
                modalPrint = win.queryById('modalPrint');
                modalHelp = win.queryById('modalHelp');
                modalRefresh = win.queryById('modalRefresh');
                modalCancel = win.queryById('modalCancel');
                if (modalPrint)
                    modalPrint.hide();
                if (modalHelp)
                    modalHelp.hide();
                if (modalRefresh)
                    modalRefresh.hide();
                if (modalCancel)
                    modalCancel.hide();
                cmp.focus();
                me.setLastTaskType('');
                win.updateLayout();

            }
        }
		console.log("Component after render" + new Date().getTime());
    },
	//TECH-30196
	setWindowSize: function(win, size, cmp) {
		var me = this,
			winSize = {}, 
			winData = me.getAllWindowData();
		winData = winData.find(function(value) { if(value.id == cmp.tempId) return value; });
		if (!Ext.isEmpty(winData))
			winSize = winData.winsize;
		if (winSize && winSize.width != '100%')
			size = winSize;
		//TECH-32118
		if(size) {
			if(size.width > 0){
				win.setMaxWidth(size.width);				
				win.childWidth = size.width;				
			}
			if(size.height > 0){
				win.setMaxHeight(size.height);				
				win.childHeight = size.height;				
			}
		}
		win.setSize(size);
	},
    onIEDKPageResponse: function(response, options) {
		RamcoLog.end('Server Trans');
		RamcoLog.start('Client Trans','IEDKResponse');
        var me = this,
            item, items, ctrls, sec, secs, section, itm, 
			i = 0,
			iLen=0,
            j = 0,
			jLen=0,
			k = 0,
			kLen=0,
			l=0,
			lLen=0,
			m=0,
			mLen=0,
			tabCtrlItemLen,
			gridColLen=0,
            cols = 0,
            index = 0,
			store,
			column,
			columns,
			gridCtrl,
			tabcontrol,
			tabItem,
			tabsecKey,
			tabsecItem,
			tabItemSecKey,
			tabItemSec,
			stroeKey,
			stores,
			seqNos=[],
			seqNo,
			dataType='',
            pageConfig = RamcoRTC.pageConfig,
            config, pageSec, ctrlObj, ctrlConfig;
        try {
            config = Ext.decode(response.responseText, true);
            if (config) {
                if(config.viewModel){
					items = config.ic;
					i = 0;
					if ( items && items.length > 0)
						iLen= items.length;
					for (; i < iLen; i++) {
						sec = items[i];
						for (item in sec) {
							if (item == "tab"){
								tabcontrol = getPanelItems(pageConfig.items, 'tabcontrol');
								//tabitem
								tabsecItem = sec.tab;
								for(tabsecKey in tabsecItem){
									tabsec = tabsecItem[tabsecKey];
									if(tabsec && tabsec.n === true){
										// TECH-29511
										index = (tabsec.config) ? tabsec.config[0].cn : (tabcontrol.items.length + 1);
										delete tabsec.config;
										delete tabsec.n;
										if (index <= tabcontrol.items.length)
											tabcontrol.items.splice(index, 0, tabsec);
										else
											tabcontrol.items.push(tabsec);
									}else{
										tabItem = getPanelItems(tabcontrol.items,tabsecKey);
										if(tabItem){
											//tabitem sec
											for(tabItemSecKey in tabsec){
												section = tabsec[tabItemSecKey];
												if(section && section.n === true){
													index = section.config[0].rn - 1;
													delete section.config;
													delete section.n;
													if (index < tabItem.items.length)
														tabItem.items.splice(index, 0, section);
													else
														tabItem.items.push(section);
												}else{
													pageSec = getPanelItems(tabItem.items,tabItemSecKey);
													if(pageSec){
													j = 0;
													jLen = section.items.length;
													for (; j < jLen; j++) {
														ctrlObj = section.items[j];
														ctrlConfig = section.config[j];
														cols = pageSec.layout.columns;
														index = (ctrlConfig.rn - 1)  * cols + (ctrlConfig.cn - 1);
														if (ctrlObj.xtype == 'ramcogrid') {
															columns = ctrlObj.columns;
															gridCtrl =  getPanelItems(pageConfig.items,ctrlObj.itemId);
															if(gridCtrl){
																seqNos = ctrlObj.seqNo;
																m=0;
																mLen = seqNos.length;
																gridColLen = gridCtrl.columns.length;
																for(;m<mLen;m++){
																	seqNo = parseInt(seqNos[m],10);
																	if(!columns[m].forceFit) {
																		gridCtrl.columnFit = false;
																	}
																	if(seqNo+1 >= gridColLen)
																	   gridCtrl.columns.push(columns[m]);
																	else
																	   gridCtrl.columns.splice(seqNo+1,0,columns[m]);
																}
															}
														}
														else{
															if (pageSec.items) {
																var compItem = pageSec.items[index];
																if (!compItem || (compItem && !compItem.isNew)) {
																	for (var o = 0; o < cols; o++) {
																		// TECH-30544
																		var temp = {isNew:true,hideLabel: true, itemId: pageSec.itemId + '_filler_' + Math.ceil(pageSec.items.length / cols) + '_' + (cols - o), role: 'uiPage', userCls: 'filler', xtype: 'component'};
																		pageSec.items.splice(index, 0, temp);
																	}
																	compItem = pageSec.items[index];
																}
																
																if (index < pageSec.items.length) {
																	if (!compItem)
																	pageSec.items.splice(index, 0, ctrlObj);
																	else {
																			ctrlObj.isNew = true;
																			if (ctrlConfig.width) {
																				if(!Ext.isEmpty(ctrlObj.tdAttrs) && !Ext.isEmpty(ctrlObj.tdAttrs.style)){
																					ctrlObj.tdAttrs.style.width = ctrlConfig.width//TECH-29277
																				}else{
																					ctrlObj.tdAttrs = {"style" : { "width" : ctrlConfig.width } };
																				}
																			}
																		pageSec.items.splice(index, 1, ctrlObj);
																	}
																}
																else
																	pageSec.items.push(ctrlObj);
															} else {
																pageSec.items = [];
																pageSec.items.push(ctrlObj);
															}
														}
													}
													pageSec = null;
												}
													else {
														index = section.config[0].rn - 1;
														delete section.config;
														delete section.n;
														if (index < tabItem.items.length)
															tabItem.items.splice(index, 0, section);
														else
															tabItem.items.push(section);
													}
												}
											}
										}
									}
								}
							}
							else{
								if (item == "mainpage")
									pageSec = pageConfig;
								else
									pageSec = getPanelItems(pageConfig.items, item);
								if (pageSec) {
									section = sec[item];
									j = 0;
									jLen = section.items.length;
									for (; j < jLen; j++) {
										ctrlObj = section.items[j];
										ctrlConfig = section.config[j];
										if (item == "mainpage") {
											if((ctrlConfig.rn - 1) >= pageSec.items)
											pageSec.items.push(ctrlObj);
											else
												pageSec.items.splice((ctrlConfig.rn -1), 0, ctrlObj);	
										} else {
											cols = pageSec.layout.columns;
											index = (ctrlConfig.rn - 1)  * cols + (ctrlConfig.cn - 1);
											if (ctrlObj.xtype == 'ramcogrid') {
												columns = ctrlObj.columns;
												gridCtrl =  getPanelItems(pageConfig.items,ctrlObj.itemId);
												if(gridCtrl){
													seqNos = ctrlObj.seqNo;
													m=0;
													mLen = seqNos.length;
													gridColLen = gridCtrl.columns.length;
													for(;m<mLen;m++){
														seqNo = parseInt(seqNos[m],10);
														if(!columns[m].forceFit) {
															gridCtrl.columnFit = false;
														}
														if(seqNo+1 >= gridColLen)
														   gridCtrl.columns.push(columns[m]);
														else
														   gridCtrl.columns.splice(seqNo+1,0,columns[m]);
													}
												}
											}
											else{
												if (pageSec.items) {
													var compItem = pageSec.items[index];
													if (!compItem || (compItem && !compItem.isNew)) {
														for (var o = 0; o < cols; o++) {
															// TECH-30544
															var temp = {isNew:true,hideLabel: true, itemId: pageSec.itemId + '_filler_' + Math.ceil(pageSec.items.length / cols) + '_' + (cols - o), role: 'uiPage', userCls: 'filler', xtype: 'component'};															
															pageSec.items.splice(index, 0, temp);
														}
														compItem = pageSec.items[index];
													}
													
                                                    if (index < pageSec.items.length) {
														if (!compItem)
														pageSec.items.splice(index, 0, ctrlObj);
														else {
																ctrlObj.isNew = true;
																if (ctrlConfig.width) {
																	if(!Ext.isEmpty(ctrlObj.tdAttrs) && !Ext.isEmpty(ctrlObj.tdAttrs.style)){
																		ctrlObj.tdAttrs.style.width = ctrlConfig.width//TECH-29277
																	}else{
																		ctrlObj.tdAttrs = {"style" : { "width" : ctrlConfig.width } };
																	}
																}
															pageSec.items.splice(index, 1, ctrlObj);
														}
													}
													else
														pageSec.items.push(ctrlObj);
												} else {
													pageSec.items = [];
													pageSec.items.push(ctrlObj);
												}
											}
										}
									}
								}
							}
						}
					}
					//Store update
					stores = config.viewModel.stores;
					for(key in stores){
						store = stores[key];
						// TECH-26498
						if(!pageConfig.viewModel.stores)
							pageConfig.viewModel.stores = [];
						if(pageConfig.viewModel.stores[key]){
							j=0;
							jLen = store.fields?store.fields.length:0;
							for(;j<jLen;j++){
								pageConfig.viewModel.stores[key].fields.push(store.fields[j]);
							}
						}else{
							pageConfig.viewModel.stores[key] = store;
						}
					}
				}
				else if(config.ic){
					items = config.ic;
                            i = 0;
					for (; items && i < items.length; i++) {
                                sec = items[i];
                                for (item in sec) {
							if (item == "tab"){
								tabcontrol = getPanelItems(pageConfig.items, 'tabcontrol');
								//tabitem
								tabsecItem = sec.tab;
								for(tabsecKey in tabsecItem){
									tabsec = tabsecItem[tabsecKey];
									if(tabsec && tabsec.n === true){
										// TECH-29511
										index = (tabsec.config) ? tabsec.config[0].cn : (tabcontrol.items.length + 1);
										delete tabsec.config;
										delete tabsec.n;
										if (index <= tabcontrol.items.length)
											tabcontrol.items.splice(index, 0, tabsec);
										else
											tabcontrol.items.push(tabsec);
									}else{
										tabItem = getPanelItems(tabcontrol.items,tabsecKey);
										if(tabItem){
											//tabitem sec
											for(tabItemSecKey in tabsec){
												section = tabsec[tabItemSecKey];
												if(section && section.n === true){
													index = section.config[0].rn - 1;
													delete section.config;
													delete section.n;
													if (index < tabItem.items.length)
														tabItem.items.splice(index, 0, section);
													else
														tabItem.items.push(section);
												}else{
													pageSec = getPanelItems(tabItem.items,tabItemSecKey);
													if(pageSec){
													j = 0;
													jLen = section.items.length;
													for (; j < jLen; j++) {
														ctrlObj = section.items[j];
														ctrlConfig = section.config[j];
														cols = pageSec.layout.columns;
														index = (ctrlConfig.rn - 1)  * cols + (ctrlConfig.cn - 1);
														if (ctrlObj.xtype == 'ramcogrid') {
															columns = ctrlObj.columns;
															gridCtrl =  getPanelItems(pageConfig.items,ctrlObj.itemId);
															if(gridCtrl){
																seqNos = ctrlObj.seqNo;
																m=0;
																mLen = seqNos.length;
																gridColLen = gridCtrl.columns.length;
																for(;m<mLen;m++){
																	seqNo = parseInt(seqNos[m],10);
																	if(!columns[m].forceFit) {
																		gridCtrl.columnFit = false;
																	}
																	if(seqNo+1 >= gridColLen)
																	   gridCtrl.columns.push(columns[m]);
																	else
																	   gridCtrl.columns.splice(seqNo+1,0,columns[m]);
																}
															}
														}
														else{
															if (pageSec.items) {
																var compItem = pageSec.items[index];
																if (!compItem || (compItem && !compItem.isNew)) {
																	for (var o = 0; o < cols; o++) {
																		// TECH-30544
																		var temp = {isNew:true,hideLabel: true, itemId: pageSec.itemId + '_filler_' + Math.ceil(pageSec.items.length / cols) + '_' + (cols - o), role: 'uiPage', userCls: 'filler', xtype: 'component'};
																		pageSec.items.splice(index, 0, temp);
																	}
																	compItem = pageSec.items[index];
																}
																
																if (index < pageSec.items.length) {
																	if (!compItem)
																	pageSec.items.splice(index, 0, ctrlObj);
																	else {
																			ctrlObj.isNew = true;
																			if (ctrlConfig.width) {
																				if(!Ext.isEmpty(ctrlObj.tdAttrs) && !Ext.isEmpty(ctrlObj.tdAttrs.style)){
																					ctrlObj.tdAttrs.style.width = ctrlConfig.width//TECH-29277
																				}else{
																					ctrlObj.tdAttrs = {"style" : { "width" : ctrlConfig.width } };
																				}
																			}
																		pageSec.items.splice(index, 1, ctrlObj);
																	}
																}
																else
																	pageSec.items.push(ctrlObj);
															} else {
																pageSec.items = [];
																pageSec.items.push(ctrlObj);
															}
														}
													}
													pageSec = null;
												}
													else {
														index = section.config[0].rn - 1;
														delete section.config;
														delete section.n;
														if (index < tabItem.items.length)
															tabItem.items.splice(index, 0, section);
														else
															tabItem.items.push(section);
													}
												}
											}
										}
									}
								}
							}
							else {
                                    if (item == "mainpage")
                                        pageSec = pageConfig;
                                    else
                                        pageSec = getPanelItems(pageConfig.items, item);
                                    if (pageSec) {
                                        section = sec[item];
                                        j = 0;
                                        for (; j < section.items.length; j++) {
                                            ctrlObj = section.items[j];
                                            ctrlConfig = section.config[j];
                                            if (item == "mainpage") {
												if((ctrlConfig.rn - 1) >= pageSec.items)
                                                pageSec.items.push(ctrlObj);
												else
													pageSec.items.splice((ctrlConfig.rn -1), 0, ctrlObj);	
                                            } else {
                                                cols = pageSec.layout.columns;
                                                index = (ctrlConfig.rn - 1)  * cols + (ctrlConfig.cn - 1);
                                                for (var i = 0; ctrlObj.items && i < ctrlObj.items.length; i++) {
                                                    if (ctrlObj.items[i].xtype == 'combofield') {
                                                        var store = {
                                                            proxy: {
                                                                type: 'memory',
                                                                reader: {
                                                                    type: 'json'
                                                                }
                                                            },
                                                            storeId: ctrlObj.items[i].itemId + '_store',
                                                            fields: [{
                                                                name: 'text',
                                                                type: 'string'
                                                            }, {
                                                                name: 'value',
                                                                type: 'string'
                                                            }]
                                                        };
                                                        pageConfig.viewModel.stores[ctrlObj.items[i].itemId + '_store'] = store;
                                                    }
                                                }
                                                if (pageSec.items) {
													var compItem = pageSec.items[index];
													if (!compItem || (compItem && !compItem.isNew)) {
														for (var o = 0; o < cols; o++) {
															// TECH-30544
															var temp = {isNew:true,hideLabel: true, itemId: pageSec.itemId + '_filler_' + Math.ceil(pageSec.items.length / cols) + '_' + (cols - o), role: 'uiPage', userCls: 'filler', xtype: 'component'};
															pageSec.items.splice(index, 0, temp);	
														}
														compItem = pageSec.items[index];
													}
													
                                                    if (index < pageSec.items.length) {
														if (!compItem)
                                                        pageSec.items.splice(index, 0, ctrlObj);
														else {
																ctrlObj.isNew = true;
																if (ctrlConfig.width) {
																	if(!Ext.isEmpty(ctrlObj.tdAttrs) && !Ext.isEmpty(ctrlObj.tdAttrs.style)){
																		ctrlObj.tdAttrs.style.width = ctrlConfig.width//TECH-29277
																	}else{
																		ctrlObj.tdAttrs = {"style" : { "width" : ctrlConfig.width } };
																	}
																}
															pageSec.items.splice(index, 1, ctrlObj);
														}
													}
                                                    else
                                                        pageSec.items.push(ctrlObj);
                                                } else {
                                                    pageSec.items = [];
                                                    pageSec.items.push(ctrlObj);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                	}
				}
				/** GLOSSARY - NAME CHANGE **/
				
				if (config.gl) {
					var ctrls = config.gl.ctrls,
						secs = config.gl.secs,
						tab = config.gl.tab,
						grids = config.gl.grids,
						_ctrl, itemVal;
					
					if (ctrls) {
						for (var key in ctrls) {
							itemVal = ctrls[key];
							_ctrl = getPanelItems(pageConfig.items, key);
							if (_ctrl){
								if(_ctrl.hideLabel)//TECH-28704
									_ctrl = getPanelItems(pageConfig.items, "lbl"+key);
								if (!Ext.isEmpty(_ctrl))
									_ctrl.html = itemVal;
							}
								
						}
					}
					
					if (secs) {
						for (var key in secs) {
							itemVal = secs[key];
							_ctrl = getPanelItems(pageConfig.items, key);
							if (_ctrl)
								_ctrl.title = itemVal;
						}
					}
					
					if (grids) {
						var _views;
						for (var key in grids) {							
							_ctrl = getPanelItems(pageConfig.items, key);
							if (_ctrl) {
								var gridObj = grids[key],
									reVal, colObj;
								for (var _key in gridObj) {
									value = gridObj[_key];
									for (var k = 0; _ctrl.columns && k < _ctrl.columns.length; k++) {
										if (_ctrl.columns[k].dataIndex == 'v' + _key) {
											colObj = _ctrl.columns[k];
											colObj.text = value;
											break;
										}
									}
								}
							}
						}
					}
					
					/* if (tab) {
						for (var key in tab) {
							itemVal = tab[key];
							_ctrl = getPanelItems(pageConfig.items, key);
							if (_ctrl)
								_ctrl.title = itemVal;
						}
					}
					
					if (grids) {
						var _views;
						for (var key in grids) {							
							_ctrl = getPanelItems(pageConfig.items, key);							
							if (_ctrl) {
								for (var _key in _ctrl) {
									itemVal = ctrl[key];
									_ctrl = getPanelItems(_ctrl, key);
									if (_ctrl)
										_ctrl.text = itemVal;
								}
							}
						}
					} */
					
				}
				
				/** END OF GLOSSARY NAME CHANGE **/
                me.onLoadMapSuccess(pageConfig, true);
                delete RamcoRTC.pageConfig;
                //delete getSec;
            } else {
                Ext.RamcoMsg.alert('Virtual Works™ Message', rvw_resources.R222);
                me.mask(false);
            }
        } catch (e) {
            console.log(e);
            Ext.RamcoMsg.alert('Virtual Works™ Message', rvw_resources.R226);
            me.mask(false);
        }
    },
    onIEDKPageRejected: function(response, options) {
        var me = this,
            item, items, ctrls, sec, secs, section, itm, i = 0,
            j = 0,
            cols = 0,
            index = 0,
            pageConfig = RamcoRTC.pageConfig;
        try {
			console.log('Network Error / Request Exception');
			console.log(response);
			console.log(options);
            RamcoRTC.iEDK = '0';
            me.onLoadMapSuccess(pageConfig, true);
            delete RamcoRTC.pageConfig;
        } catch (e) {
            console.log(e);
            Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R226);
            me.mask(false);
        }
    },
    onPageRejected: function(response, options) {
        var me = this,
			currView = me.getCurrentView() || me.getCurrentHelp(),
			controller;
		if(currView && !Ext.isEmpty(controller = currView.getController()))
		{
			me.setLastUrl('');
			me.setLastTaskType(null);
			controller.taskPending = false;        
		}
        messages = [{
            sr: response.statusText,
            sv: response.status,
            cd: options.url,
            ds: response.statusText,
            ca: 'Contact Admin..'
        }];
        me.mask(false);
        Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R223, me.afterError.bind(me), undefined, 'error', messages);
    },
    afterError: function() {
        var me = this;

    },
    initApplication: function(success, response) {
        var me = this,
			timer; // TECH-31176
        if (success) {
			Ext.USE_NATIVE_JSON = true;
            var objResponse = Ext.JSON.decode(response.responseText);
			Ext.USE_NATIVE_JSON = false;
            if (objResponse && !objResponse.message) {
                RamcoRTC.sessionID = objResponse.sessionId;
                if (objResponse.rid)
                    RamcoRTC.setSessionToken(objResponse.rid);
                if (objResponse.segmentName != 'Ramco')
                    RamcoRTC.segmentName = objResponse.segmentName;
                if (objResponse.asyncReqID && objResponse.asyncReqID != "")
                    RamcoRTC.asyncReqId = objResponse.asyncReqID;
                if (objResponse.settings)
                    RamcoRTC.settings = Ext.JSON.decode(objResponse.settings, true) || {};
				if (qsParm.isExt2 == "true") {
					RamcoRTC.settings.isExt2= true;
				}				
                RamcoRTC.sessionTimeOut = objResponse.sessionTimeOut || 20;
                RamcoRTC.showPortal = objResponse.showPortal;
                RamcoRTC.ou = objResponse.ou;
                RamcoRTC.role = objResponse.role;
                RamcoRTC.lang = objResponse.lang;
                RamcoRTC.ldir = objResponse.ldir;
				RamcoRTC.isPortal = objResponse.isPortal;
				RamcoRTC.portalMode = objResponse.portalMode;
				//TECH-34101
				RamcoRTC.acceptFileType = objResponse.acceptFileType;

				if(Ext.isEmpty(objResponse.hasReferrer) || window.localStorage.getItem("hasReferrer") == "true") {
					if(!Ext.isEmpty(RamcoRTC.settings.idpURL) && objResponse.hasLogin === false){
						window.localStorage.removeItem("hasReferrer");
						window.location.replace(RamcoRTC.settings.idpURL);
						return;
					}
				} else {
					if(objResponse.hasLogin === true){
						window.localStorage.setItem("hasReferrer", "true");
					}
				}
			
                if (RamcoRTC.settings && RamcoRTC.settings.appCss && RamcoRTC.settings.appCss.length > 0) {
					var len = RamcoRTC.settings.appCss.length,
						  i = 0,
						  ele = null;
					for(; i < len; i++) {
						ele = RamcoRTC.settings.appCss[i];
						//RamcoRTC.settings.appCss.forEach(function(ele, index, array) {
                        var oCss = document.createElement("link"),
                            head = (document.getElementsByTagName("head")[0] || document.documentElement);
                        oCss.rel = "stylesheet";
                        oCss.type = "text/css";
                        oCss.defer = true;
                        oCss.href = "classic/resources/" + ele + ".css?_dc=" + RamcoRTC.cacheId;
                        head.appendChild(oCss);
                    }
					//);
                }
				if (RamcoRTC.lang != "1") {
					Ext.Loader.loadScript({
						url: 'classic/resources/locale/locale-' + RamcoRTC.lang + ".js",
						onLoad: function(response) {
							this.loadAppMainPage();
							if (objResponse.hasLogin) {
								RamcoRTC.username = objResponse.LoginUser;
								me.signInSuccess(true);
							} else {
								me.launchLogin();
							}
						},
						onError: function(response) {
							this.loadAppMainPage();
							if (objResponse.hasLogin) {
								RamcoRTC.username = objResponse.LoginUser;
								me.signInSuccess(true);
							} else {
								me.launchLogin();
							}
						},
						scope: me
					});
				} 
				else {
					me.loadAppMainPage();
					RamcoRTC.isOProto = (Ext.isEmpty(qsParm.lc) && Ext.isEmpty(qsParm.la) && Ext.isEmpty(qsParm.lu)) && qsParm.ltype == "proto";
					if(RamcoRTC.isProto && RamcoRTC.isOProto === false)
						objResponse.hasLogin = true;
					if(RamcoRTC.isGProto)
						objResponse.hasLogin = true;	                
	                if (objResponse.hasLogin) {
	                    RamcoRTC.username = objResponse.LoginUser;
	                    me.signInSuccess(true);
	                }
					else {
						if(Ext.isEmpty(objResponse.hasReferrer) && !Ext.isEmpty(RamcoRTC.settings.idpURL)) {
							window.onbeforeunload = null;
							window.onunload = null;
							window.location.replace(RamcoRTC.settings.idpURL);
							return;
						}
	                    me.launchLogin();
	                }
				}
				
				// TECH-31176
				timer = me.taskMgr.newTask({
					run: me.OnTimer,
					fireOnStart: true,
					interval: 60000,
					scope: me
				});		
				timer.stop();
				me.setTimer(timer);
            } else {
                var fly = Ext.fly('splash');
                if (fly)
                    fly.destroy();
                if (objResponse.message && objResponse.message == 'DUPLICATE SESSION'){
					window.onbeforeunload = null;
                    window.onunload = null;
                    window.location.replace('ilrt/rvw_window.htm?rid='+ objResponse.rid);
				}
                //Ext.RamcoMsg.alert(rvw_resources.R052, rvw_resources.R244);
                else
                    Ext.RamcoMsg.alert(rvw_resources.R052, rvw_resources.R232);
            }
        } else {
            var fly = Ext.fly('splash');
            if (fly)
                fly.destroy();
            Ext.RamcoMsg.alert(rvw_resources.R052, rvw_resources.R233);
            console.log('server-side failure with status code ' + response.status);
        }
    },
    launchLogin: function() {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Launching Screen');
        RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
            componentName: 'security',
            activityName: (RamcoRTC.osType == 'JAVA') ? 'Logon' : 'login',
            activityDesc: 'Sign In',
            ilboName: 'ezelogin',
            ilboDesc: 'Sign In',
            ilboType: '1'
        }, '');
    },
    signInSuccess: function(hasSign, showmask) {
        var me = this,
            login = me.getCurrentView(),
            loginCont = me.getLoginPanel();
        if (loginCont) {
            loginPanel = loginCont.up('[xtype=ilbo]');
            Ext.destroy(loginPanel);
        }
        if (login) {
            Ext.destroy(login);
            me.setCurrentView(null);
        }
        var fly = Ext.fly('splash');
        if (fly)
            fly.destroy();
        if (RamcoRTC.lang != "1") {
            Ext.Loader.loadScript({
                url: 'classic/resources/locale/locale-' + RamcoRTC.lang + ".js",
                onLoad: function(response) {
                    this.loadMainPage();
                },
                onError: function(response) {
                    this.loadMainPage();
                },
                scope: me
            });
        } else
            me.loadMainPage();
    },
	loadAppMainPage: function() {
        var me = this,
			fly = Ext.fly('splash'),
			mainView = null,
			maskCtrl = null,
			cmp = null,
            className = (RamcoRTC.settings.isExt2 == true) ? "RamcoHub.view.main.AvnMain" : "RamcoHub.view.main.Main";
		// TECH-35301
		if (RamcoRTC.settings.showNoRowsFoundText == false)
			rvw_resources.R033 = '';
		cmp = Ext.create(className, {
			rtl: (RamcoRTC.userInfo.ldir == "rtl" || RamcoRTC.ldir == "rtl")
		});
		mainView = me.getMainView();
		if (RamcoRTC.settings.isExt2 == true) {
			RamcoRTC.headerFontSize = 7.5;
		}
		
		/*if (RamcoRTC.settings.isExt2 == true) {
			if(mainView && mainView.items.length > 2) {
				mainView.items.items[0].setVisible(false);
				mainView.items.items[2].setVisible(false);
			} 	
		}
		else {
			if(mainView && mainView.items.length > 2) {
				mainView.items.items[0].setVisible(false);
				mainView.items.items[2].setVisible(false);
			}
		}*/
		
		if (RamcoRTC.settings.isExt2 == true) {			
			var northPnl = mainView.getComponent("northPanel");
			if (northPnl && northPnl.splitter && northPnl.splitter.collapseEl) {
				northPnl.splitter.collapseEl.hide();				
			}
		}
		
		maskCtrl = new Ext.LoadMask({
			msg: rvw_resources.R093,
			hideMode:'offsets',
			target: mainView
		});
		maskCtrl.setZIndex(99999999999);
		me.maskCtrl = maskCtrl;
		if (Ext.toolkit == 'modern') {
			Ext.Viewport.add(cmp);
		}		
		if (fly)
			fly.destroy();
    },
    loadMainPage: function() {
        var me = this,
			mainView = me.getMainView();
		if(mainView && mainView.items.length > 2) {
			mainView.items.items[0].setVisible(true);
			mainView.items.items[2].setVisible(true);	
		}
        Ext.getBody().removeCls('loginPage');
        me.setIsLogin(true);
            me.initMainPage();
    },
    firstSignIn: function(hasSign, showmask) {
        var me = this,
            url = '../security/passremques_passremques.htm',
            lastUrl = me.getLastUrl(),
            login = me.getCurrentView();
        if (lastUrl)
            url = lastUrl;
        Ext.getBody().removeCls('loginPage');
        me.setIsLogin(true);
        className = me.convertUrlToPage(url);
        me.loadPage(className);
        me.setLastUrl(url);
    },
    initMainPage: function() {
        this.mask(true);
        var me = this;
        var defaultMode = me.getBtnDefaultMode(),
			printButton = me.getBtnPrintBar(),
			personalisationMode = me.getBtnPreference(),
			ilboSwitchCtxt = me.getIlboSwitchContext(),
			templateMode = me.getBtnTemplate();
			if(RamcoRTC.isPortal && RamcoRTC.portalMode && RamcoRTC.isPortal === true && RamcoRTC.portalMode === "1") {
				RamcoRTC.settings.hideIlboSwitchcontext = true;
			}
			if(RamcoRTC.settings.hideIlboSwitchcontext == false)
				ilboSwitchCtxt.show();
			// TECH-37397
			if (RamcoRTC.settings.isExt2 == true && RamcoRTC.settings.hideQuickSearch == true) {
				var quickIlbo = me.getQuickIlbo();
				if (!Ext.isEmpty(quickIlbo)) {
					quickIlbo.hide();
				}
			}
            // if (RamcoRTC.settings.hidePrintButton)
                printButton.hide();
            if (RamcoRTC.isEntUser == false) {
                if (RamcoRTC.settings.hideDefaultMode) {
                    defaultMode.hide();
                    templateMode.hide();
				}
                if (RamcoRTC.settings.hidePersonalisation)
                    personalisationMode.hide();


            }
        me.setTaskDesc('Initialize Screen');
        RamcoRTC.getAllMenu(me.onRequestComplete, me.onRequestException, me);
    },
    configMainPage: function() {
        var me = this,
            mainView = me.getMainView(),
            store = Ext.getStore('NavigationMenu'),
            objMainMenu,
			tblApp = null,
            mainMenu = null,
            userMenu = null,
            favourites = null,
            inbox = null,
            menuTag = null,
			newWindow = null, //TECH-39043
            defMenu = null,
            themesMenu = null,
            recentMenu = null,
            cmpnyLogo = null,
            statusBar = null,
			lastLogin = null,
			tblMain = null,
			tblBPC = null,
			northPnl = null,
			tickerHeader = null,
            prdctName = null,
            cLogo = null,
			btnCancel = null,
			btnHome = null,
			getFav = null,
			actSearch = null,
			avnSearchField = null,
			quickIlbo = null,
			btnComponent = null,
			btnActivity = null,
			btnArrow1 = null,
			btnArrow2 = null,
			btnArrow3 = null,
			btnTemplate = null,
			btnPreference = null,
			btnDefaultMode = null
            pLogo = null;
        if (mainView) {
			/* mainView.suspendLayouts(); */
            if (store) {
                var root = {
                    iconCls: 'x-fa fa-home',
                    text: '',
                    itemId: 'menuHome',
                    expanded: true,
                    children: RamcoRTC.menu
                }
                store.setRoot(root);
            }
            if (RamcoRTC.settings.companyLogo) {
                cLogo = me.getCompanyLogo();
			if (!Ext.isEmpty(RamcoRTC.userInfo.companyLogo))
				cLogo.setHtml(RamcoRTC.userInfo.companyLogo);
            }
            if (RamcoRTC.settings.productLogo) {
                pLogo = me.getProductLogo();
				if (!Ext.isEmpty(RamcoRTC.userInfo.productLogo))
					pLogo.setHtml(RamcoRTC.userInfo.productLogo);
            }
            mainMenu = me.getMainMenu();
            defMenu = me.getBtnMenuDefault();
            themesMenu = me.getBtnThemes();
            userMenu = me.getUserMenu();
            recentMenu = me.getRecentMenu();
            favourites = me.getBtnFavorites();
            inbox = me.getBtnInbox();
            menuTag = me.getBtnMenuTag();
			newWindow = me.getBtnNewWindow(); //TECH-39043
            statusBar = me.getStatusBar();
			lastLogin = me.getLastLogin();
			tblMain = me.getTblMain();
			tblBPC = me.getTblBPC();
			tickerHeader = me.getTickerHeader();
			btnCancel = me.getBtnCancel();
			btnHome = me.getBtnHome();
			getFav = me.getGetFav();
			avnSearchField = me.getAvnSearchField();
			actSearch = me.getCmbActSearch();
			quickIlbo = me.getQuickIlbo();
			btnComponent = me.getBtnComponent();
            btnActivity = me.getBtnActivity();
            btnArrow1 = me.getBtnArrow1();
            btnArrow2 = me.getBtnArrow2();
            btnArrow3 = me.getBtnArrow3();
			tblMain.setVisible(true);
			//tblBPC.setVisible(true);
			btnTemplate = me.getBtnTemplate(),
			btnPreference = me.getBtnPreference(),
			btnDefaultMode = me.getBtnDefaultMode(),
			tickerHeader.setVisible(true);
			if(RamcoRTC.isPortal && RamcoRTC.portalMode && RamcoRTC.isPortal === true && RamcoRTC.portalMode === "1") {
				tblMain.setVisible(false);
				//tblBPC.setVisible(false);
				tickerHeader.setVisible(false);	
				btnHome.setVisible(false);
				/* To be confirmed for portal based login, if it's needed */
				//btnCancel.setVisible(false);
				getFav.setVisible(false);				
			}
			if (RamcoRTC.settings.avnSearch === true && avnSearchField) {
				avnSearchField.show();
				actSearch.hide();
			}
			//TECH-39043
			if (window.location.href.indexOf(RamcoRTC.sessionID) > -1) {
				newWindow.show();
			}
			//TECH-39039
			if (RamcoRTC.settings.hideMenuFavorites) {
				getFav.setVisible(false);
			}
			if (RamcoRTC.settings.hideFavorites)
				favourites.hide();
			if (RamcoRTC.settings.hideMenuTag)
				menuTag.hide();
			if (RamcoRTC.settings.hideInbox)
				inbox.hide();
			if (RamcoRTC.settings.hideRecent)
				recentMenu.hide();
			if (!Ext.isEmpty(RamcoRTC.settings.customerTheme) || RamcoRTC.settings.enableTenantCSS === true)
				RamcoRTC.settings.hideThemeMenu = true;
			if (RamcoRTC.settings.hideThemeMenu)
				themesMenu.hide();
			if (RamcoRTC.settings.hideStatusBarUIContext)
				statusBar.setVisible(false);
			else {
				statusBar.setVisible(true);
				if (RamcoRTC.userInfo.haslastlogin === "YES") {
					lastLogin.setValue(RamcoRTC.userInfo.lastlogin);
					lastLogin.inputEl.dom.setAttribute("data-qtip", rvw_resources.R306);
				}
			}
			if (!RamcoRTC.settings.enableWizard) {
				favourites.hide();
				menuTag.hide();
				inbox.hide();


            }
            if (mainMenu) {
                objMainMenu = Ext.create('Ext.menu.Menu', {
                    maxHeight: 400,
                    ignoreParentClicks: true,
                    items: RamcoRTC.menu,
					layout: {
						type: 'vbox',
						align: 'stretchmax',
						overflowHandler: {
							type : 'Scroller',
							wheelIncrement:(-.075), // TECH-40768 / TECH-39617
							scrollDuration:600
						}
					},
                });
                mainMenu.setMenu(objMainMenu);
            }
            if (userMenu) {
                //userMenu.setText('<div class="x-user-btn"><span class="x-fname">' + RamcoRTC.userInfo.fn + '</span><span class="x-ourole">' + RamcoRTC.userInfo.oud + ',&nbsp' + RamcoRTC.userInfo.rd + '</span></div>');
                userMenu.setText('<div class="x-user-btn"><span class="x-fname">' + RamcoRTC.userInfo.fn + '</span><span class="x-ourole">' + RamcoRTC.userInfo.rd + ' - ' + RamcoRTC.userInfo.oud + '</span></div>'); // AHBG-31964
                objMainMenu = Ext.create('Ext.menu.Menu', {
                    items: RamcoRTC.secs
                })
                userMenu.setMenu(objMainMenu);
                var array = objMainMenu.items,
                    length = null,
                    menuName;
                for (var i = 0; i <= array.length - 1; i++) {
					//var menu = (RamcoRTC.osType == 'JAVA') ? array.getAt(i).cname : array.getAt(i).aname;
					var menu = array.getAt(i).aname;
					if (menu) {
						menuName = menu.toLowerCase();
	                    if (menuName == 'userpreferences' && RamcoRTC.settings.hideUIPreference ||
	                        menuName == "userapppreferences" && RamcoRTC.settings.hidePreference ||
							menuName == 'changepwd' && (!Ext.isEmpty(RamcoRTC.userInfo.isldaplogin) && RamcoRTC.userInfo.isldaplogin == '1') )
	                        array.getAt(i).setVisible(false);
					}
                    
                }
            }
            if (defMenu) {
                objMainMenu = Ext.create('Ext.menu.Menu', {
                    items: [{
                        itemId: 'New Work Area',
                        key: 'New Work Area',
                        text: rvw_resources.R197,
						group: 'areaMenu',
                        hidden: (RamcoRTC.settings.hideWorkArea) ? true : false,
                        role: 'default'
                    }, {
                        itemId: 'Default Window',
                        key: 'Default Window',
                        text: rvw_resources.R179,
						group: 'areaMenu',
                        role: 'default',
                        checked: true
                    }, {
                        itemId: 'Wizard',
                        key: 'Wizard',
                        text: rvw_resources.R198,
						group: 'areaMenu',
						hidden: (!RamcoRTC.settings.enableWizard || (RamcoRTC.settings.enableWizard && (RamcoRTC.settings.hideWizard && RamcoRTC.settings.hideInbox && RamcoRTC.settings.hideFavorites && RamcoRTC.settings.hideMenuMap && RamcoRTC.settings.hideMenuTag))) ? true : false,
                        role: 'default',
                        checked: false
                    }]
                });
                defMenu.setMenu(objMainMenu);
            }
			if (RamcoRTC.settings.isExt2 == true) {
				/* AHBG-31965 */				
				var avnThemes = [
					{
                        itemId: 'defaulttheme',
                        key: 'DefaultTheme',
                        tname: 'DefaultTheme',
                        text: 'Default Theme',
                        role: 'themes',
						group: 'theme',
                        checked: true
                    },
					{
                        itemId: 'bluetheme',
                        key: 'BlueTheme',
                        tname: 'BlueTheme',
                        text: 'Theme Blue',
                        role: 'themes',
						group: 'theme',
                        checked: false
                    },
					{
                        itemId: 'greentheme',
                        key: 'GreenTheme',
                        tname: 'GreenTheme',
                        text: 'Theme Green',
                        role: 'themes',
						group: 'theme',
                        checked: false
                    },
					{
                        itemId: 'graytheme',
                        key: 'GrayTheme',
                        tname: 'GrayTheme',
                        text: 'Theme Grey',
                        role: 'themes',
						group: 'theme',
                        checked: false
                    },
					{
                        itemId: 'articblue', // TECH-37062
                        key: 'ArticBlueTheme',
                        tname: 'ArticBlueTheme',
                        text: 'Artic Blue',
                        role: 'themes',
						group: 'theme',
                        checked: false
                    },					
					{
                        itemId: 'bluejay', // TECH-37062
                        key: 'BlueJayTheme',
                        tname: 'BlueJayTheme',
                        text: 'BlueJay',
                        role: 'themes',
						group: 'theme',
                        checked: false
                    }					
				];
			}
			var commonThems = [
					{
                        itemId: 'hydra',
                        key: 'Hydra',
                        tname: 'Hydra',
                        text: 'Hydra',
                        role: 'themes',
						group: 'theme',
                        checked: true
                    }, {
                        itemId: 'aqua',
                        key: 'Aqua',
                        tname: 'Aqua',
                        text: 'Aqua',
                        role: 'themes',
						group: 'theme',
                        checked: false
                    }, {
                        itemId: 'granite',
                        key: 'Granite',
                        tname: 'Granite',
                        text: 'Granite',
                        role: 'themes',
						group: 'theme',
                        checked: false
                    },
				];			
            if (themesMenu) {//TECH-30308
                objMainMenu = Ext.create('Ext.menu.Menu', {
                    items: (RamcoRTC.settings.isExt2 == true) ? avnThemes : commonThems
                });
                themesMenu.setMenu(objMainMenu);
                if (!Ext.isEmpty(RamcoRTC.settings.excludeCustomTheme)) {
                    var menu = themesMenu.getMenu();
                    menu.items.each(function(itm, index) {
                        for (var key in RamcoRTC.settings.excludeCustomTheme) {
                            if (itm.getItemId() == RamcoRTC.settings.excludeCustomTheme[key]) {
                                itm.setVisible(false);
                                break;
                            }
                        }
                    });
                }
            }
            if (recentMenu) {
                objMainMenu = Ext.create('Ext.menu.Menu', {
                    items: RamcoRTC.recs
                })
				objMainMenu.cls += " x-recent-menu";
                recentMenu.setMenu(objMainMenu);
            }			
			
			// TECH-30014

			// TECH-33892
			var currentView = me.getCurrentView(),
				implUsers = RamcoRTC.settings.implementorUsers,
				userName = RamcoRTC.userInfo.n,
				userRole = RamcoRTC.userInfo.r,
				toolbarHide = me.getTblApp();
				
			btnPreference.suspendLayouts();
			btnDefaultMode.suspendLayouts();
			
			if (implUsers && implUsers.length > 0)
				implUsers.find(function(a,b) { if(a.user.toLowerCase() == userName.toLowerCase() && a.role.toLowerCase() == userRole.toLowerCase()) { RamcoRTC.isEntUser = true; return; } });
			
			if (!me.getPersonalization() && !me.getDefaultTemplate()) {
				btnPreference.show();
				btnDefaultMode.show();
			}
			else {
				btnPreference.hide();
				btnDefaultMode.hide();
			}
			
			btnPreference.resumeLayouts(true);
			btnDefaultMode.resumeLayouts(true);
			
			// TECH-27432 - Ilbo Level Personalisation and Defaults Hide			
			if (currentView && currentView.hideIlboPersonalisation == true)
				btnPreference.hide();
			else
				btnPreference.show();
			
			if (currentView && currentView.hideIlboDefaults == true)
				btnDefaultMode.hide();
			else
				btnDefaultMode.show();
			if(toolbarHide.isVisible() === false) {
				//toolbarHide.suspendLayouts();
				toolbarHide.show();
				//toolbarHide.resumeLayouts();
			}
			if (tblBPC && tblBPC.isVisible() === false)
				tblBPC.show();
			
			// TECH-30723
			if (RamcoRTC.isProto == true) {
				//prefMode.hide();
				//defaultMode.hide();
				btnPreference.hide();
				btnDefaultMode.hide();
				btnCancel.hide()
				btnHome.hide();
				getFav.hide();
				tblMain.hide();
				//tblBPC.hide();
			}
			if (RamcoRTC.settings.isExt2 == true) {
				northPnl = mainView.getComponent("northPanel");
				if (northPnl) {
					if (northPnl.splitter && northPnl.splitter.collapseEl) {
						northPnl.splitter.collapseEl.show();
					}
					northPnl.expand();
				}
			}
            /* mainView.resumeLayouts(true); */
			//mainView.resumeLayouts();
            /* mainView.focus(); */
        }
    },
    configGetFav: function(items,showMenu) {//TECH-28231
        var me = this,
            getFav = null;
		getFav = me.getGetFav();
		if (getFav){
            getFav.setMenu(items, true);
			if(showMenu){
				getFav.showMenu();
				RamcoRTC.isFavActMenu = true;//TECH-28231
			}
				
		}
        me.mask(false);
    },
    configGetTemplate: function(items) {
		// DefModeChanges
        var me = this,
            btnTemplate = me.getBtnTemplate(),
            VWrules, template, role, itemId, defTemp, actMenu, tempMode,
            menu = [];
        VWrules = items.querySelectorAll('VWRules');
        if (VWrules && VWrules.length > 0) {
            template = VWrules[0].querySelectorAll('Template');
            if (template && template.length > 0) {
                for (i = 0; i < template.length; i++) {
					// DefMode
					itemId = template[i].getAttribute('name');
					if (itemId == 'default') {
						defTemp = template[i].getAttribute('mapped_template');
					}
					if (itemId != 'xml' && itemId != 'default') {
	                    menu.push({
							text: itemId,
	                        role: 'templategroup',
							itemId: itemId
	                    })
	                }
	            }
            }
        }
		else
            menu = '';
		
		if (!Ext.isEmpty(btnTemplate)) {
			if (menu && menu.length > 0) {
				// DefMode
				if (!Ext.isEmpty(defTemp)) {
					actMenu = menu.find(function(a,b) {if(defTemp == a.text) return a;});
					actMenu.cls = 'x-templatemenu-active';
					RamcoRTC.defTemplate = defTemp;
				}
				// DefMode
				tempMode = me.getDefaultTemplate();
				if (tempMode == false) {
					btnTemplate.show();
					btnTemplate.setMenu(menu, true);
				}
			}
			else {
				btnTemplate.hide();
				btnTemplate.setMenu(null);
			}
		}
        //me.mask(false);
    },
    configRecentActivities: function() {
        var me = this,
            recentMenu = null;
        recentMenu = me.getRecentMenu();
            if (recentMenu) {
                recentMenu.setMenu(RamcoRTC.recs, true)
                recentMenu.showMenu(true);
            }
        me.mask(false);
    },
    configGetFavsAsMenu: function(parentItems) {
        var me = this,
            favAsMenu = null,
			objMainMenu;
		
		// TECH-32977
		if (parentItems && parentItems.length == 0)
			parentItems = [{itemId:'dummyfavmenu', text: '...'}];
		
		objMainMenu = Ext.create('Ext.menu.Menu', {
			items: parentItems
		});
        favAsMenu = me.getBtnFavorites();
		if (favAsMenu) {
			favAsMenu.setMenu(objMainMenu);
			if (me.getShowFavMenu())
				favAsMenu.showMenu();
		}
        me.mask(false);
    },
    addTime: function(message) {
        /*var me = this,
            content = null;
        content = {
            n: message,
            v: Ext.Date.now(),
            fv: Ext.util.Format.date(new Date(), 'G:i:s:u')
        };
        message = 'Processing Request';
        me.transcationTime.push(Ext.merge({}, content));
		*/
    },
    onTrailbarClick: function(item, e, eOpts) {        
        var me = this,
            tBar = item.up('toolbar'),
            btnPref = null,
			itmIdx = null,			
            btnDefault = me.getBtnMenuDefault(),
            index = item.index + 1,
            ilboConfig = {
                activityName: item.an || item.actName || 'homepage',
				ilboName: item.ic || item.ilboName || 'homepage',
				compName: item.cName || 'security'
            },
            currentView = me.getCurrentView(),
			menu, workArea, ilbo; // , controller; // TECH-29276 // TECH-29531
        if (currentView && currentView.hasModified() && !me.proceed) {
            Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R257, function(btnId) {
                if (btnId == "ok" || btnId == "yes") {
                    me.proceed = true;
                    me.onTrailbarClick(item, e, eOpts);
                }
            });
            return true;
        }
		this.mask(true);
		// TECH-28159 / TECH-26959
		menu = me.getTrailBar().getMenu().config.items;
		for(var menuIndex = 0; menuIndex < menu.length; menuIndex++) {
			if(menuIndex > index) {
				workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
				ilbo = menu[menuIndex].ic ? menu[menuIndex].ic : menu[menuIndex].ilboName;
				// TECH-29276
				/*getMainController().resetGridMultiSort(workArea, ilbo);
				// TECH-28276
				if(RamcoRTC.dstRequired[workArea][ilbo])
					delete RamcoRTC.dstRequired[workArea][ilbo];*/

				// TECH-29531
				// controller = getMainController();

				// controller.resetGridMultiSort(workArea, ilbo);
				me.resetGridMultiSort(workArea, ilbo);

				// TECH-29395
				// if(controller.dstRequired[workArea] && controller.dstRequired[workArea][ilbo])
				// 	delete controller.dstRequired[workArea][ilbo];

				if(me.dstRequired[workArea] && me.dstRequired[workArea][ilbo])
					delete me.dstRequired[workArea][ilbo];
			}
		}

		if(RamcoRTC.isProto && RamcoRTC.protoTrailBar.length > 1) {			
			RamcoRTC.protoTrailBar = RamcoRTC.protoTrailBar.slice(0, parseInt(item.idx, 10) + 1);
		}		
        if (item.itemId == 'btnTrailHome') {
            me.mask(true);
            me.setTaskDesc('Home');
            me.setLastTaskType('trans');
            if (currentView) {
                btnPref = me.getBtnSave();
                if (btnPref)
                    btnPref.hide();
                btnPref = me.getBtnClear();
                if (btnPref)
                    btnPref.hide();
                btnPref = me.getBtnCancl();
                if (btnPref)
                    btnPref.hide();
                btnPref = me.getBtnPrintBar();
                //if (RamcoRTC.settings.hidePrintButton == true || (btnPref && !Ext.Object.isEmpty(currentView.templatesJson) && currentView.templateFile))
                if (currentView.hidePrint == false)
					btnPref.show();
				else
					btnPref.hide();
            }
            me.setPersonalization(false);
            me.setDefaultTemplate(false);
        }
        me.proceed = false;
        RamcoRTC.doBackNavigation(me.onRequestComplete, me.onRequestException, me, ilboConfig, 'tskstdgo', 'rvwstandardtask', {}, new String(index));
    },
    createNewInstance: function() {
        var me = this,
            view = me.getCurrentView(),
			// TECH-30816
            //data = view && view.getViewModel() ? view.getSessionData() : '',
            data = view && view.getViewModel() && view.getViewModel().getSessionData(),
            defMenu = me.getBtnMenuDefault(),
			menuCnt = 0, menuItems, subMenu;
			// TECH-28714
			if (defMenu.menu && defMenu.menu.items) {
				menuItems = defMenu.menu.items;
				for (var k = 0; k < menuItems.length; k++) {
					subMenu = menuItems.getAt(k);
					if (!Ext.isEmpty(subMenu) && subMenu.isVisible()) {
						if (subMenu.itemId == "New Work Area" || subMenu.itemId == "Default Window" || subMenu.itemId == "Wizard")
							continue;
						menuCnt++;
					}
				}
			}
			//menuCnt = (defMenu.menu && defMenu.menu.items && defMenu.menu.items.getCount() > 3)?(defMenu.menu.items.getCount() - 3):0; // TECH-29362
			
			// TECH-28714
			if (menuCnt >= RamcoRTC.settings.workAreaLimit) {
				Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R314);
				return;
			}
			
            obj = Ext.create('Ext.window.Window', {
                title: 'Create New Workarea',
                width: 350,
                height: 125,
                modal: true,
                bodyPadding: 10,
                layout: {
                    type: 'ramcotable',
                    columns: 2,
                    tableAttrs: {
                        style: {
                            width: '100%'
                        }
                    },
                    tdAttrs: {
                        style: {
                            width: '50%'
                        }
                    }
                },
                style: {
                    'padding': '5px'
                },
                items: [{
                    xtype: 'label',
                    html: 'Name:',
                    captionAlign: 'left',
                    tdAttrs: {
                        style: {
                            'text-align': 'left'
                        }
                    },
                    forId: 'newInstance'
                }, {
                    xtype: 'textfield',
                    itemId: 'newInstance',
                    name: 'newInstance',
					value: 'WorkArea_0' + (menuCnt + 1).toString(), // TECH-29362
                    allowBlank: false
                }],
                dockedItems: [{
                    xtype: 'ramcopanel',
                    bodyPadding: 5,
                    dock: 'bottom',
                    layout: 'hbox',
                    items: [{
                        xtype: 'component',
                        width: '25%'
                    }, {
                        xtype: 'button',
                        itemId: 'instancebutton',
                        text: rvw_resources.R200,
                        scope: me,
                        handler: function(btn) {
                            var wind = btn.up('window'),
                                currInstance = null,
                                textObj = wind.getComponent('newInstance'),
                                textFieldValue = textObj ? textObj.getValue() : null;
                            if (Ext.isEmpty(textFieldValue) || Ext.isEmpty(textFieldValue.trim())) {
                                Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R225);
                            }
							else if(textObj && !textObj.isValid()) {								
								Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R044, Ext.emptyFn, undefined, 'error');
							}
							else {
                                var menu = defMenu.getMenu();
								// TECH-32726
								textFieldValue = purifyDom(textFieldValue);
								textFieldValue = Ext.htmlEncode(textFieldValue);
								
                                if (menu && menu.items && menu.items.getByKey(textFieldValue)) {
                                    Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R224);
                                    return;
                                }
                                if (view && view.ilboConfig) {
                                    currInstance = RamcoRTC.currentInstance || 'Default Window';
                                    currInstance = (currInstance == 'default') ? 'Default Window' : currInstance;
                                    currInstance = menu.items.getByKey(currInstance);
                                    currInstance.ilboConfig = view.ilboConfig;
                                    currInstance.lastUrl = me.getLastUrl();
                                    RamcoRTC.doCreateInstance(me.onRequestComplete, me.onRequestException, me, view.ilboConfig || {}, data);
                                } else {
                                    currInstance = RamcoRTC.currentInstance || 'Default Window';
                                    currInstance = (currInstance == 'default') ? 'Default Window' : currInstance;
                                    currInstance = menu.items.getByKey(currInstance);
                                    currInstance.ilboConfig = null;
                                }
                                menu.items.each(function(itm, index) {
                                    if (index != 0) itm.setChecked(false);
                                });
                                menu.add({
                                    itemId: textFieldValue,
                                    key: textFieldValue,
                                    text: textFieldValue,
									group: 'areaMenu',
                                    role: 'default',
                                    checked: true
                                });
                                RamcoRTC.currentInstance = textFieldValue;
                                defMenu.setText(textFieldValue);
                                wind.close();
                            }
                        }
                    }, {
                        xtype: 'component',
                        width: '25%'
                    }, {
                        xtype: 'button',
                        text: rvw_resources.R103,
                        itemId: 'cancelbtn',
                        handler: function(btn) {
                            var wind = btn.up('window');
                            wind.close();
                        }
                    }]
                }]
            }).show();
    },
	// TECH-28716
	onWorkAreaInstanceClick: function(item, e, eOpts) {
		try {
			var me = this,
			currentView = me.getCurrentView(),
			btnWorkAreaStyle = me.getBtnWorkAreaStyle(),
			btnPref = null,
			data = currentView && currentView.getViewModel() && currentView.getViewModel().getSessionData(),
			className = null,
            currInstance = null,
			menuLen = btnWorkAreaStyle.items && btnWorkAreaStyle.items.length || 0,
			workAreaCount = ( RamcoRTC.settings.workAreaLimit || 3 ) + 1; // TECH-28714
			
			if (item.text == 'New Work Area') {
				if (me.getWizBtns())
					me.getWizBtns()['preItem'] = null;
			
				if (currentView && currentView.ilboConfig) {
					currInstance = RamcoRTC.currentInstance || 'default';
					currInstance = btnWorkAreaStyle.down('#' + currInstance);
					currInstance.ilboConfig = currentView.ilboConfig;
					currInstance.lastUrl = me.getLastUrl();
					//RamcoRTC.doCreateInstance(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, data);
				} else {
					currInstance = RamcoRTC.currentInstance || 'default';
					currInstance = btnWorkAreaStyle.down('#' + currInstance);
					currInstance.ilboConfig = null;
				}
				
				// TECH-28714
				if (menuLen <= workAreaCount) {
					RamcoRTC.doCreateInstance(me.onRequestComplete, me.onRequestException, me, currentView && currentView.ilboConfig || {}, data);
					for (var j = 1; menuLen > 1 && j < menuLen; j++) {
						btnWorkAreaStyle.items.items[j].removeCls('actworkarea');
						btnWorkAreaStyle.items.items[j].isActive = false;
					}
					btnWorkAreaStyle.add({
						xtype: 'button',
						itemId:'workarea' + menuLen,
						text: menuLen,
						cls: 'actworkarea',
						isActive: true,
						role:'workarea'
					});
					RamcoRTC.currentInstance = 'workarea' + menuLen;
				}
				else
					Ext.RamcoMsg.alert(rvw_resources.R260, rvw_resources.R314);
				return;
			}
			else if (item.text == 'Wizard') {
				if (me.getWizBtns())
					me.getWizBtns()['preItem'] = null;
				if (!Ext.isEmpty(currentView) && currentView.ilboConfig) {
					currInstance = RamcoRTC.currentInstance || 'default';
					currInstance = btnWorkAreaStyle.down('#' + currInstance);
					currInstance.ilboConfig = currentView.ilboConfig;
					currInstance.lastUrl = me.getLastUrl();
					data = currentView.getSessionData();
					if (currentView.ilboConfig.ilboName == 'ezelogin') {
						currentView.ilboConfig.componentName = 'security';
						currentView.ilboConfig.activityName = 'homepage';
						currentView.ilboConfig.ilboName = 'homepage';
					}
					RamcoRTC.doCreateInstance(me.onRequestComplete, me.onRequestException, me, currentView && currentView.ilboConfig || {}, data);
					RamcoRTC.currentInstance = 'Wizard';
					RamcoRTC.wizardLaunched = true;
				} else {
					RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
						componentName: 'ezwizard',
						activityName: 'ezwizard',
						ilboName: 'ezwizard'
					}, '');
					RamcoRTC.wizardLaunched = true;
				}
				
				for (var j = 1; menuLen > 1 && j < menuLen; j++) {
					btnWorkAreaStyle.items.items[j].removeCls('actworkarea');
					//btnWorkAreaStyle.items.items[j].isActive = false;
				}
				RamcoRTC.currentInstance = 'Wizard';
			}			
			me.mask(true);
		}
		catch(ex) { console.log('onWorkAreaInstanceClick Exception is ' + ex); }
	},
    onInstanceClick: function(item, e, eOpts) {
        var me = this,
            ilboView = me.getIlboView(),
            currentView = me.getCurrentView() || '',
            currentHelp = me.getCurrentHelp() || '',
            btnPref = null,
            data = null,
            url = null,
            className = null,
            currInstance = null,
            tBar = (typeof item == 'object') ? item.up('toolbar') : '';
        if (currentView && currentView.ilboConfig && currentView.ilboConfig.ilboName != "ezwizard") {
            RamcoRTC.wizardLaunched = false;
			if (currentView.isCancel)
				currentView.isCancel = false;
			else if(currentHelp && currentHelp.isCancel)
				currentHelp.isCancel = false;
		}
        if (item.text == 'New Work Area') {
            me.createNewInstance();
            return;
        }
        me.mask(true);
        me.setTaskDesc('Launching Screen');
        me.setPersonalization(false);
        me.setDefaultTemplate(false);
        btnPref = me.getBtnSave();
        if (btnPref)
            btnPref.hide();
        btnPref = me.getBtnClear();
        if (btnPref)
            btnPref.hide();
        btnPref = me.getBtnCancl();
        if (btnPref)
            btnPref.hide();
        btnPref = me.getBtnMenuDefault();
        btnPref.menu.hide();
        if (item.text == 'Wizard') {
            if (me.getWizBtns())
                me.getWizBtns()['preItem'] = null;
            var menu = btnPref.getMenu();
            if (!Ext.isEmpty(currentView) && currentView.ilboConfig) {
                currInstance = RamcoRTC.currentInstance || 'Default Window';
                currInstance = (currInstance == 'default') ? 'Default Window' : currInstance;
                currInstance = menu.items.getByKey(currInstance);
                currInstance.ilboConfig = currentView.ilboConfig;
                currInstance.lastUrl = me.getLastUrl();
                data = currentView.getSessionData();
                if (currentView.ilboConfig.ilboName == 'ezelogin') {
                    currentView.ilboConfig.componentName = 'security';
                    currentView.ilboConfig.activityName = 'homepage';
                    currentView.ilboConfig.ilboName = 'homepage';
                }
                RamcoRTC.doCreateInstance(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, data);
                RamcoRTC.currentInstance = 'Wizard';
                btnPref.setText('Wizard');
                RamcoRTC.wizardLaunched = true;
            } else {
                RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
                    //componentName: 'wizard',
                    componentName: 'ezwizard',
                    activityName: 'ezwizard',
                    ilboName: 'ezwizard'
                }, '');
                RamcoRTC.wizardLaunched = true;
            }
            RamcoRTC.currentInstance = 'Wizard';
            btnPref.setText('Wizard');
            menu.items.each(function(itm, index) {
                if (index != 0) itm.setChecked(false);
            });
            currInstance = menu.items.getByKey('Wizard');
            if (currInstance)
                currInstance.setChecked(true);
        } else if (item.text == 'Default Window') {
            if (me.getWizBtns())
                me.getWizBtns()['preItem'] = null;
            var menu = btnPref.getMenu();
            if (!Ext.isEmpty(currentView) && currentView.ilboConfig) {
                currInstance = RamcoRTC.currentInstance || 'Default Window';
                currInstance = (currInstance == 'default') ? 'Default Window' : currInstance;
                currInstance = menu.items.getByKey(currInstance);
                currInstance.ilboConfig = currentView.ilboConfig;
                currInstance.lastUrl = me.getLastUrl();
                data = currentView.getSessionData();
                /* RamcoRTC.currentInstance = 'default';
                btnPref.setText('Default Window'); */
            } else {
                currentView = {};
                currentView.ilboConfig = {
                    componentName: 'security',
                    activityName: 'homepage',
                    ilboName: 'homepage'
                }
            }
			RamcoRTC.doCreateInstance(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, data);
            RamcoRTC.currentInstance = 'default';
            btnPref.setText('Default Window');
            menu.items.each(function(itm, index) {
                if (index != 0) itm.setChecked(false);
            });
            currInstance = menu.items.getByKey('Default Window');
            if (currInstance)
                currInstance.setChecked(true);
        } else {
            var menu = btnPref.getMenu();
            if (!Ext.isEmpty(currentView) && currentView.ilboConfig) {
                currInstance = RamcoRTC.currentInstance || 'Default Window';
                currInstance = (currInstance == 'default') ? 'Default Window' : currInstance;
                currInstance = menu.items.getByKey(currInstance);
                currInstance.ilboConfig = currentView.ilboConfig;
                currInstance.lastUrl = me.getLastUrl();
                data = currentView.getSessionData();
                /* RamcoRTC.currentInstance = item.text;
                btnPref.setText(item.text); */
            } else {
                currentView = {};
                currentView.ilboConfig = {
                    componentName: 'security',
                    activityName: 'homepage',
                    ilboName: 'homepage'
                }
            }
			RamcoRTC.doCreateInstance(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, data);
            RamcoRTC.currentInstance = item.text;
            btnPref.setText(item.text);
            menu.items.each(function(itm, index) {
                if (index != 0) itm.setChecked(false);
            });
            currInstance = menu.items.getByKey(item.text);
            currInstance.setChecked(true);
        }
    },
    onThemeClick: function(item, e, eOpts) {
        var me = this,
            ilboView = me.getIlboView(),
            mainView = me.getMainView(),
            currentView = me.getCurrentView(),
            themesArray = ['hydra', 'aqua', 'granite', 'defaulttheme', 'bluetheme', 'graytheme', 'greentheme', 'bluejay', 'articblue'],// TECH-37062
			btnThemes = me.getBtnThemes(),
            currentThmItem = '';

        for (var i = 0; i < themesArray.length; i++) {
            if (item.itemId == themesArray[i])
                continue;
            currentThmItem = mainView.down('#' + themesArray[i]);
            if (currentThmItem)
                currentThmItem.setChecked(false);
        }

        if (me.getDefaultTheme() == null || me.getDefaultTheme() == '' || me.getDefaultTheme() != item.tname) {
            me.loadTheme(uiResourcePath + item.tname + ".css?_dc=" + RamcoRTC.cacheId, item.tname, (me.getDefaultTheme() == null) ? '' : me.getDefaultTheme());
            me.setDefaultTheme(item.tname);
			currentThmItem = mainView.down('#' + item.itemId); // TECH-35461
            if (currentThmItem)
                currentThmItem.setChecked(true);
        }
		
        if (btnThemes) {
			btnThemes.setText(item.text);
			btnThemes.setTooltip(item.text);
			if (btnThemes.getMenu())
				btnThemes.getMenu().hide();
		}
    },
	// TECH-29150
	onUDSMenuClick: function(item, e, eOpts) {
        var me = this,
            mainView = me.getMainView(),
            currentView = me.getCurrentView(),
			data = currentView && currentView.getSessionData() || [],
			udsLinkName = item.linkName,
			taskArray, evtDtls, actName, ilboName, cmpName;
			taskArray = (udsLinkName) ? udsLinkName.slice(udsLinkName.indexOf('(') + 1, udsLinkName.indexOf(')')) : '';
		if (!Ext.isEmpty(taskArray)) {
			taskArray = taskArray.replace(/[^a-zA-Z0-9,_-]/g,'');
			taskArray = taskArray.split(',');
			if (taskArray.length > 0) {
				actName = taskArray[4];
				ilboName = taskArray[5];
				cmpName = taskArray[6];
				evtDtls = "EDKTASK~" + actName + "~" + ilboName;
				RamcoRTC.doDummyTask(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, data, evtDtls);
				currentView.callBack = function() {
					currentView.isEdkLaunched = true;
					RamcoRTC.launchEDKUI(me.onRequestComplete, me.onRequestException, me, {
						activityName: actName,
						ilboName: ilboName,
						componentName: cmpName,
						parentIlbo: currentView.ilboConfig.ilboName,
						parentActivity: currentView.ilboConfig.activityName,
						parentComponent: currentView.ilboConfig.componentName,
						langId: item.langId,
						extnControl: ''
					}, '');
					me.mask(true);
				}
			}
		}
    },
    onTransClick: function(v, e) {
        var me = this,
            curentView = me.getCurrentView();
		// TECH-40080
        //sesionData = curentView.getSessionData();
        //me.onTrans(curentView, sesionData, v.task, v.taskType);
		if (curentView) {
			curentView.fireEvent('trans', curentView, [], v.task, v.taskType);
		}		
    },
    loadTheme: function(src, id, oldThemeId) {
        var me = this,
            oCss = document.createElement("link"),
            head = (document.getElementsByTagName("head")[0] || document.documentElement),
            linkElem = head.getElementsByTagName('link');

        if (oldThemeId != '') {
            for (var i = 0; i < linkElem.length; i++) {
                if (linkElem[i].id && linkElem[i].id == oldThemeId) {
                    head.removeChild(linkElem[i]);
                    break;
                }
            }
        }

        oCss.rel = "stylesheet";
        oCss.type = "text/css";
        oCss.defer = true;
        oCss.href = src;
        oCss.id = id;
        head.appendChild(oCss);
    },
    onMenuClick: function(item, e, eOpts) {
        if (this.taskPending)
            return;
        var me = this,
            view = me.getView(),
            viewModel = me.getViewModel(),
            data = [],
            task = ctrl.task,
            taskType = ctrl.taskType;
        data = viewModel.getSessionData();
        me.taskPending = true;
        view.fireEvent('trans', view, data, task, taskType);
    },
    onGridLoadData: function(responseXML) {
        var me = this,
            data = {},
            columns = [],
            fields = [],
            c, vi, vd, vw, r, text, n, width, dt, vws, vn, v, y,nodVal,re,
			ctrlName, store = [];
        gd = responseXML.querySelector('gd');
        if (gd) {
            RamcoRTC.setSessionToken(gd.getAttribute('rid'));
            c = gd.querySelectorAll('c');
            vi = c[0].querySelectorAll('vi');
            vd = c[0].querySelectorAll('vd');
			// AHBG-31972
			ctrlName = c[0].getAttribute('n');
			//if (vi[0] && vd[0] && vi[0].childElementCount > 0 && vd[0].childElementCount > 0) {
			if (vi.length > 0 && vd.length > 0) {
            vw = vi[0].querySelectorAll('vw');
            // TECH-29906
			//r = vd[0].querySelectorAll('r');
            r = vd[0] ? vd[0].querySelectorAll('r') : "";
            if (r && r.length > 0) {
                for (i = 0; i < vw.length; i++) {
                    text = vw[i].getAttribute('ht');
                    n = 'v' + vw[i].getAttribute('n');
                    width = vw[i].getAttribute('w');
                    dt = vw[i].getAttribute('dt');
                    fields.push(n);
					//TECH-34198
                    columns.push({
                        //flex: 1,
                        text: text,
                        dataIndex: n,
                        name: n,
                        width: parseInt(width),
                        itemId: n,
						dt:dt
                    });
                    // TECH-40247
					if (dt == 'date') {
                        columns[i]['xtype'] = 'datecolumn';
                        columns[i]['format'] = RamcoRTC.userPreference.dateFormat;
                    } else if (dt == 'date-time') {
                        //columns[i]['xtype'] = 'ramcodatetimefield';
                        columns[i]['format'] = RamcoRTC.userPreference.dateTimeFormat;
                    } else if (dt == 'time') {
                        //columns[i]['xtype'] = 'ramcotimefield';
                        columns[i]['format'] = RamcoRTC.userPreference.timeFormat;
                    }
                }
                for (j = 0; j < r.length; j++) {
                    ss = {};
                    for (k = 0; k < vw.length; k++) {
                        vws = r[j].querySelectorAll('vw' + k);
                        vn = vws[0].getAttribute('n');
                        v = vws[0].getElementsByTagName('v')[0];
                        y = v.childNodes[0];
                        // TECH-29906
                        //ss['v' + vn] = y.nodeValue;
						nodVal = y.nodeValue;
						//TECH-34198
						if(columns[k].dt == "date" || columns[k].dt == "date-time" || columns[k].dt == "time" || columns[k].dt == "integer" || columns[k].dt == "numeric"){
						 re = /(\r|\t|\n|\s)/g;
						 nodVal = nodVal.replace(re, '');
						}
						ss['v' + vn] = nodVal? nodVal : null;
                    }
                    store.push(ss);
                }
                data['fields'] = fields;
                data['columns'] = columns;
                data['store'] = store;
						data['ctrlname'] = ctrlName;
                return data;
				}
				else
	                return false;
	        }
        }

    },
    onGridLoadChartData: function(responseXML) {
        try {
            var me = this,
                data = {},
                columns = [],
                fields = [],
                c, vi, vd, vw, r, text, n, width, dt, vws, vn, v, y, vid,
                store = [];

            var xAxisList, xAxisField, yAxisList, yAxisField;
            xAxisList = new Array();
            xAxisField = new Array();
            var xId = "";
            yAxisList = new Array();
            yAxisField = new Array();
            var yId = "";
            var vDataType;
            var thCtrl, columnType, templateName;

            gd = responseXML.querySelector('gd');
            if (gd) {
                RamcoRTC.setSessionToken(gd.getAttribute('rid'));
                c = gd.querySelectorAll('c');
                vi = c[0].querySelectorAll('vi');
                vd = c[0].querySelectorAll('vd');
				// AHBG-31972
				//if (vi[0] && vd[0] && vi[0].childElementCount > 0 && vd[0].childElementCount > 0) {
				if (vi.length > 0 && vd.length > 0) {
	                vw = vi[0].querySelectorAll('vw');
	                r = vd[0].querySelectorAll('r');
	                if (r && r.length > 0) {
	                    for (i = 0; i < vw.length; i++) {
	                        text = vw[i].getAttribute('ht');
	                        n = 'v' + vw[i].getAttribute('n');
	                        vid = vw[i].getAttribute('n');
	                        width = vw[i].getAttribute('w');
	                        dt = vw[i].getAttribute('dt');
	                        fields.push(n);
	                        columns.push({
	                            flex: 1,
	                            text: text,
	                            dataIndex: n,
	                            name: n,
	                            width: width,
	                            itemId: n
	                        });
	                        if (dt == 'date') {
	                            columns[i]['xtype'] = 'datecolumn';
	                            columns[i]['format'] = RamcoRTC.userPreference.dateFormat;
	                        } else if (dt == 'date-time') {
	                            columns[i]['format'] = RamcoRTC.userPreference.dateTimeFormat;
	                            columns[i]['xtype'] = 'ramcodatetimefield';
	                        } else if (dt == 'time') {
	                            columns[i]['format'] = RamcoRTC.userPreference.timeFormat;
	                            columns[i]['xtype'] = 'ramcotimefield';
	                        }
	
	                        xId = "X_" + vid;
	                        if (xAxisList.length == 0) {
	                            xAxisList[xAxisList.length] = {
	                                checked: true,
	                                group: 'xAxisFieldGrp',
	                                id: xId,
	                                text: text
	                            };
	                            xAxisField[0] = {
	                                id: vid,
	                                ds: text
	                            };
	                        } else
	                            xAxisList[xAxisList.length] = {
	                                checked: false,
	                                group: 'xAxisFieldGrp',
	                                id: xId,
	                                text: text
	                            };
	
	                        if (dt == "numeric" || dt == "integer") {
	                            yId = "Y_" + vid;
	                            yAxisList[yAxisList.length] = {
	                                checked: true,
	                                hideOnClick: false,
	                                id: yId,
	                                text: text
	                            };
	                            yAxisField[yAxisField.length] = {
	                                id: vid,
	                                ds: text
	                            };
	                        }
	                    }
	
	                    me.onShowMultiLineChart(responseXML, 'chart', xAxisField, yAxisField, xAxisList, yAxisList);
					}
					else
	                    return false;
	            }
            }
        }
		catch (ex) {
            me.mask(false);
        }
    },
    onShowMultiLineChart: function(response, eventName, xAxisField, yAxisField, xAxisList, yAxisList) {
        try {
            var me = this,
                eventName = "Chart",
                cNodeNode = response.querySelector("c"),
                chrtcaption = cNodeNode.getAttribute("c"),
                //rtcaption = 'Grid Chart',
                rtcaption = '', // AHBG-31972
                chartScope = me;

            if (!Ext.isEmpty(chrtcaption))
                rtcaption = eventName + " on " + chrtcaption;

            // TECH-38989
            var strXmlData = me.onGetChartData(response, xAxisField, yAxisField, chrtcaption, "", "X-Axis", "Y-Axis", "column3d", undefined);

            var xAxisMenu = new Ext.menu.Menu({
                id: 'xAxis',
                items: xAxisList
            });
            var yAxisMenu = new Ext.menu.Menu({
                id: 'yAxis',
                items: yAxisList
            });
			// TECH-38726
            var chartTypeItems = Ext.create('Ext.menu.Menu', {
                id: 'chartType',
                items: [{
                    itemId: 'MSColumn2D',
                    key: 'Column 2D',
					type: 'column2d',
					group: 'chartType',
                    text: 'Column 2D',
                    checked: false
                }, {
                    itemId: 'MSColumn3D',
                    key: 'Column 3D',
					type: 'column3d',
					group: 'chartType',
                    text: 'Column 3D',
                    checked: true
                }, {
                    itemId: 'MSLine',
                    key: 'Line',
					type: 'line',
					group: 'chartType',
                    text: 'Line',
                    checked: false
                }, {
                    itemId: 'MSBar2D',
                    key: 'Bar 2D',
					type: 'bar2d',
					group: 'chartType',
                    text: 'Bar 2D',
                    checked: false
                }, {
                    itemId: 'MSBar3D',
                    key: 'Bar 3D',
					type: 'bar3d',
					group: 'chartType',
                    text: 'Bar 3D',
                    checked: false
                }],
                onClick: function(a, b) {
                    var me = this,
                        menu = me.items;
                    menu.each(function(itm, index) {
                        itm.setChecked(false);
                    });
                    me.getItemFromEvent(a).setChecked(true);
                }
            });
            var lablDispItems = Ext.create('Ext.menu.Menu', {
                items: [{
                    itemId: 'lblHori',
					group: 'labelDisplay',
                    key: 'Display labels horizontally',
                    text: 'Display labels horizontally',
                    checked: true
                }, {
                    itemId: 'lblVert',
					group: 'labelDisplay',
                    key: 'Display labels vertically',
                    text: 'Display labels vertically',
                    checked: false
                }],
                onClick: function(a, b) {
                    var me = this,
                        menu = me.items;
                    menu.each(function(itm, index) {
                        itm.setChecked(false);
                    });
                    me.getItemFromEvent(a).setChecked(true);
                }
            });

            var chartSetButton = {
                xtype: 'button',
                text: 'Refresh Chart',
                handler: function() {
                    var _me = this,
                        toolbar = _me.up('toolbar'),
                        chartWind = null;

                    if (!Ext.isEmpty(toolbar))
                        chartWind = toolbar.up('window')
                    else
                        return;

                    if (chartWind != "undefined") {
						/* AHBG-31843 */
						
                        /* var objCaption = toolbar.query('#chartname')[0];
                        var objsubCaption = toolbar.query('#chartsubname')[0];
                        var objChartType = toolbar.query('#charttype')[0];
                        var objyAxis = toolbar.query('#yaxisname')[0];
                        var objxAxisField = toolbar.query('#xaxisfield')[0];
                        var objyAxisField = toolbar.query('#yaxisfield')[0];
                        var rowasxaxis = toolbar.query('#rowasxaxis')[0].getValue();
                        var objLabelDisp = toolbar.query('#labelDisp')[0]; */
						
						var objCaption = toolbar.down('#txtchartcaption'),
							objsubCaption = toolbar.down('#txtchartsubname'),
							objChartType = toolbar.down('#btncharttype'),
							objyAxis = toolbar.down('#txtchartyaxis'),
							objxAxisField = toolbar.down('#btnchartxaxis'),
							objyAxisField = toolbar.down('#btnchartyaxis'),
							rowasxaxis = toolbar.down('#chkchartxaxis').getValue(),
							objLabelDisp = toolbar.down('#btnchartlbldisplay');
							
						/* AHBG-31843 */

                        try {
                            var xField = new Array(),
								yField = new Array(),
								xItem, yItem, ctItem, cType,
								lType, ldItem;
                            for (var xCIndex = 0; xCIndex < objxAxisField.menu.items.length; xCIndex++) {
                                xItem = objxAxisField.menu.items.getAt(xCIndex);
                                if (xItem) {
                                    if (xItem.checked) {
                                        xField[0] = {
                                            id: xItem.id.replace("X_", ""),
                                            ds: xItem.text
                                        };
                                        break;
                                    }
                                }
                            }
                            for (var yCIndex = 0; yCIndex < objyAxisField.menu.items.length; yCIndex++) {
                                yItem = objyAxisField.menu.items.getAt(yCIndex);
                                if (yItem) {
                                    if (yItem.checked) {
                                        yField[yField.length] = {
                                            id: yItem.id.replace("Y_", ""),
                                            ds: yItem.text
                                        };
                                    }
                                }
                            }
                            for (var ctIndex = 0; ctIndex < objChartType.menu.items.length; ctIndex++) {
                                ctItem = objChartType.menu.items.getAt(ctIndex);
                                if (ctItem) {
                                    if (ctItem.checked) {
                                        cType = ctItem.type; // TECH-38726
                                    }
                                }
                            }
                            for (var ldIndex = 0; ldIndex < objLabelDisp.menu.items.length; ldIndex++) {
                                ldItem = objLabelDisp.menu.items.getAt(ldIndex);
                                if (ldItem) {
                                    if (ldItem.checked) {
                                        lType = ldItem.itemId;
                                    }
                                }
                            }
							// TECH-38989
                            var caption = objCaption.getValue(),
								subCaption = objsubCaption.getValue(),
								yName = objyAxis.getValue(),
								xName = xItem.text,
								ramcoChartObj = chartWind.items.getAt(0),
								_scope = chartWind.scope,
								_chartData = chartWind.chartData,
								strXmlData1;
							
							strXmlData1 = _scope.onGetChartData(undefined, xField, yField, caption, subCaption, xName, yName, cType, rowasxaxis, null, lType, chartWind, _chartData);
							// TECH-38726
							if (!Ext.isEmpty(ramcoChartObj)) {
								// TECH-38989
								ramcoChartObj.chartValData = strXmlData1;
								//ramcoChartObj.setChartType(cType);
								ramcoChartObj.setDataXml(strXmlData1);
								//ramcoChartObj.setValue(strXmlData1);
							}
                        } catch (e) {
                            console.log("RefreshChart", e.message);
                        }
                    }
                }
            };
            /* AHBG-31843 */

            var bbarItems = [{
                xtype: 'toolbar',
                docked: 'bottom',
                title: 'My Toolbar',
                items: [{
                        xtype: 'ramcolabel',
						itemId: 'lblchartcaption',
                        value: 'Caption:',
                        width: 50
                    }, {
                        xtype: 'textfield',
						itemId: 'txtchartcaption',
                        //id: 'chartname',
                        name: 'chartname',
                        value: chrtcaption,
                        width: 80
                    }, {
                        xtype: 'ramcolabel',
						itemId: 'lblchartsubcaption',
                        value: 'Sub caption:',
                        width: 70
                    }, {
                        xtype: 'textfield',
						itemId: 'txtchartsubname',
                        //id: 'chartsubname',
                        name: 'chartsubname',
                        value: '',
                        width: 80
                    }, {
                        xtype: 'ramcolabel',
						itemId: 'lblchartyaxis',
                        value: 'y-Axis Name:',
                        width: 75
                    }, {
                        xtype: 'textfield',
						itemId: 'txtchartyaxis',
                        //id: 'yaxisname',
                        name: 'yaxisname',
                        value: 'Y-Axis',
                        width: 75
                    }, '-', {
                        xtype: 'ramcolabel',
						itemId: 'lblchartxaxis',
                        value: 'Row as X-Axis:',
                        width: 90
                    }, {
                        xtype: 'checkbox',
						itemId: 'chkchartxaxis',
                        //id: 'rowasxaxis',
                        name: 'rowasxaxis',
                        value: 0,
                        width: 20
                    }, '-', {
                        xtype: 'button',
						itemId: 'btnchartxaxis',
                        //id: 'xaxisfield',
                        name: 'xaxisfield',
                        iconCls: 'x-icon-trailbar',
                        menu: xAxisMenu,
                        text: '&nbsp;x-AxisField'
                    }, {
                        xtype: 'button',
						itemId: 'btnchartyaxis',
                        //id: 'yaxisfield',
                        name: 'yaxisfield',
                        iconCls: 'x-icon-trailbar',
                        menu: yAxisMenu,
                        text: '&nbsp;y-AxisField'
                    }, '-', {
                        xtype: 'button',
						itemId: 'btncharttype',
                        //id: 'charttype',
                        name: 'charttype',
                        iconCls: 'x-icon-charttype',
                        menu: chartTypeItems,
                        text: '&nbsp;Chart Type'
                    }, {
                        xtype: 'button',
						itemId: 'btnchartlbldisplay',
                        //id: 'labelDisp',
                        name: 'labelDisp',
                        iconCls: 'x-icon-charttype',
                        menu: lablDispItems,
                        text: '&nbsp;Label Display'
                    }, '->', '-',
                    chartSetButton
                ]
            }];
			
			/* AHBG-31843 */

            /* SHOW GRAPH - MULTILINE */

            // TECH-37397
			
			var ilbo = me.getCurrentHelp() || me.getCurrentView(),
				ilboSize = ilbo.getSize(),
				_chartWidth = ilboSize.width - 100, 
				_chartHeight = ilboSize.height - 200;
            /* _chartWidth = document.body.offsetWidth - 100;
            _chartHeight = document.body.offsetHeight - 200; */

            var chartWindow = Ext.create('Ext.window.Window', {
                title: rtcaption,
                itemId: 'gridChartWindow',
                minWidth: _chartWidth > 1040 ? _chartWidth : 1040,
                width: _chartWidth,
                height: _chartHeight,
                modal: true,
                closable: true,
                resizable: true,
                autoDestroy: true,
                autoScroll: false, // TECH-37397
                maximizable: true,
                closeAction: 'hide',
                layout: 'fit',
                items: [{
                    xtype: 'ramcochart',
					// TECH-38989
                    //chartType: 'column3d',
                    //value: strXmlData,
                    dataXml: strXmlData,
                    role: 'uipage',
                    minHeight: 400
                }],
                bbar: bbarItems
            });
            chartWindow.scope = chartScope;
            chartWindow.chartData = response;
			chartWindow.chartValData = strXmlData;

            chartWindow.show();
			// TECH-38989
			try {				
				chartWindow.on('maximize', function() {
					var chartWin = this,
						chartObj = chartWin.down('ramcochart'),
						chartData = chartWin.chartValData,
						chartWinSize = chartWin.getSize(), chart = chartObj && chartObj.getChart();
					if (chart && chartData) {
						chartObj.setDataXml(chartData);
						chart.resizeTo(chartWinSize.width - 20, chartWinSize.height - 75);
					}
				});
				
				chartWindow.on('restore', function() {
					var chartWin = this,
						chartObj = chartWin.down('ramcochart'),
						chartData = chartWin.chartValData,
						chartWinSize = chartWin.getSize(), chart = chartObj && chartObj.getChart();
					if (chart && chartData) {
						chartObj.setDataXml(chartData);
						chart.resizeTo(chartWinSize.width - 20, chartWinSize.height - 75);
					}
				});
			}
			catch(ex) {}
        } catch (ex) {
            me.mask(false);
        }
    },
    onGetChartData: function(objRawData, xField, yField, caption, subCaption, xName, yName, chartType, rowasxaxis, reserved, labelType, chartWind, chartData) {
        try {
            var me = this,
                colors = ['AFD8F8', 'FF8E46', 'F6BD0F', '8BBA00', '008E8E', 'D64646', '8E468E', '588526', 'B3AA00', '008ED6', '9D080D', 'A186BE'];

            if (objRawData == undefined && !Ext.isEmpty(chartData))
                objRawData = chartData;

            if (typeof objRawData == "object" && typeof xField == "object" && typeof yField == "object") {
                if (chartWind)
                    chartWind.chartData = objRawData;
                var cNodeData = objRawData.querySelector("c");
                var nodeData = cNodeData.querySelector("vd");
                if (nodeData != null) {
                    var XmlDoc = window.document.implementation.createDocument('', 'graph', null);
                    var chartDocument = XmlDoc;

                    var chartNode, chartcategories, category, dataset, set, isMultiChart = false;
                    var xFldId = xField[0].id;
                    if (chartDocument != null) {
                        chartNode = chartDocument.childNodes[0];
						if (yField && yField.length > 1)
							isMultiChart = true;
						
						if (isMultiChart) {
							chartcategories = chartDocument.createElement("categories");
							chartNode.appendChild(chartcategories);
						}
                        if (rowasxaxis) {
							if (isMultiChart) {
								for (var yAxIndex = 0; yAxIndex < nodeData.childNodes.length; yAxIndex++) {
									if (nodeData.childNodes[yAxIndex] && nodeData.childNodes[yAxIndex].nodeType != 3) {
										category = chartDocument.createElement("category");
										// TECH-38989									
										category.setAttribute("label", nodeData.childNodes[yAxIndex].querySelector("vw[n='" + xFldId + "']").getAttribute("v") + "(" + nodeData.childNodes[yAxIndex].getAttribute("n") + ")");
										category.setAttribute("name", nodeData.childNodes[yAxIndex].querySelector("vw[n='" + xFldId + "']").getAttribute("v") + "(" + nodeData.childNodes[yAxIndex].getAttribute("n") + ")");
										chartcategories.appendChild(category);
									}
								}
							}

                            for (var yAxIndex1 = 0; yAxIndex1 < yField.length; yAxIndex1++) {
								if (isMultiChart) {
									dataset = chartDocument.createElement("dataset");
									dataset.setAttribute("seriesName", yField[yAxIndex1].ds);
									var cIndx = yAxIndex1;
									if (cIndx > 11)
										cIndx = (cIndx % 11);
									dataset.setAttribute("color", colors[cIndx]);
								}

                                for (var chrtRow = 0; chrtRow < nodeData.childNodes.length; chrtRow++) {
                                    if (nodeData.childNodes[chrtRow] && nodeData.childNodes[chrtRow].nodeType != 3) {
                                        set = chartDocument.createElement("set");
                                        set.setAttribute("value", nodeData.childNodes[chrtRow].querySelector("vw[n='" + yField[yAxIndex1].id + "']").getAttribute("v"));
										// TECH-38726
										//set.setAttribute("label", yField[yAxIndex1].ds); // Setting Chart Label
                                        if (isMultiChart)
											dataset.appendChild(set);
										else
											chartNode.appendChild(set);
                                    }
                                }
                                if (isMultiChart)
									chartNode.appendChild(dataset);
                            }
                        }
						else {
							
							if (isMultiChart) {
								for (var yAxIndex = 0; yAxIndex < yField.length; yAxIndex++) {
									category = chartDocument.createElement("category");
									category.setAttribute("label", yField[yAxIndex].ds);
									category.setAttribute("name", yField[yAxIndex].ds);
									chartcategories.appendChild(category);
								}
							}

                            for (var chrtRow = 0; chrtRow < nodeData.childNodes.length; chrtRow++) {
                                if (nodeData.childNodes[chrtRow] && nodeData.childNodes[chrtRow].nodeType != 3) {
									
									if (isMultiChart) {
										dataset = chartDocument.createElement("dataset");
										dataset.setAttribute("seriesName", nodeData.childNodes[chrtRow].querySelector("vw[n='" + xFldId + "']").getAttribute("v"));
										var cIndx = chrtRow;
										if (cIndx > 11)
											cIndx = (cIndx % 11);
										dataset.setAttribute("color", colors[cIndx]);
									}
                                    for (var yAxIndex1 = 0; yAxIndex1 < yField.length; yAxIndex1++) {
                                        set = chartDocument.createElement("set");
                                        set.setAttribute("value", nodeData.childNodes[chrtRow].querySelector("vw[n='" + yField[yAxIndex1].id + "']").getAttribute("v"));
										// TECH-38726
										//set.setAttribute("label", yField[yAxIndex1].ds); // Setting Chart Label
										if (isMultiChart)
											dataset.appendChild(set);
										else
											chartNode.appendChild(set);
                                    }
									if (isMultiChart)
										chartNode.appendChild(dataset);
                                }
                            }
                        }

                        chartNode.setAttribute("caption", caption);
                        chartNode.setAttribute("subcaption", subCaption);
                        chartNode.setAttribute("xAxisName", xName != "" ? xName : xField[0].ds);
                        chartNode.setAttribute("yAxisName", yName);
                        chartNode.setAttribute("showValues", "1");
						// TECH-38989
						chartNode.setAttribute("showLegend", "1");
						if (isMultiChart) {
							if (chartType.indexOf('ms') < 0)
								chartType = "ms" + chartType;
						}
						chartNode.setAttribute("charttype", chartType);

                        if (labelType == "lblVert") {
                            chartNode.setAttribute("rotateValues", "1");
                            chartNode.setAttribute("rotateNames", "1");
                            chartNode.setAttribute("labelDisplay", "ROTATE");
                            chartNode.setAttribute("rotateLabels", "1");
                            chartNode.setAttribute("slantLabels", "1");
                        }
                        //TECH-31782
                        if(Ext.ieVersion != 0 && Ext.isEmpty(chartNode.xml) && Ext.isEmpty(chartNode.outerHTML))
							var xmlstr = (new XMLSerializer()).serializeToString(chartNode);
                        return chartNode.xml || chartNode.outerHTML || xmlstr ;
                    }
                }
            }
        } catch (ex) {
            me.mask(false);
        }
    },
    onColDefData: function(responseXML, options) {
        var me = this,
            currentView = me.getCurrentView(),
            data = {},
            trpi,
            grid,
            len,
            colLen,
            column,
			columnsValue,
            c, vi, vd, vw, r, text, n, width, dt, vws, vn, v, y,
            store = [];
        trpi = responseXML.querySelector('trpi');
        sysi = responseXML.querySelector('sysi');
        if (trpi) {
            RamcoRTC.setSessionToken(sysi.getAttribute('rid'));
            c = trpi.querySelectorAll('c');            
			if (c && c.length > 0) {
				gridId = c[0].getAttribute('n');
				did = c[0].querySelectorAll('did');
				vw = did[0].querySelectorAll('vw');
				grid = currentView.queryById(gridId);
				grid.dummyRec = [];
				if (vw && vw.length > 0) {
					for (i = 0; i < vw.length; i++) {
						valObj = {};
						data[vw[i].getAttribute('n')] = vw[i].getAttribute('v');
						valObj['id'] = 'v' + vw[i].getAttribute('n');
						valObj['coldefval'] = vw[i].getAttribute('v');
						valObj['coldefactive'] = "true";
						grid.dummyRec.push(valObj);
					}
				}
				grid.coldef = true;
				grid.edited = false;
				grid.createDummyRecord();
				data['gridId'] = gridId;
				return data;
			}			
            else if (options.RTC == 'colClearDefault') {
                grid = currentView.queryById(options.params.RVWRTQS_PCONTROL);
                len = grid.store.getRange();
                colLen = grid.getColumns().length;
                column = grid.getColumns();
				columnsValue = (grid.value && grid.value.columnsValue ) ? grid.value.columnsValue : grid.rsColumnsValue;
                for (i = 0; i < len.length; i++) {
                    if (len[i].data.isNew) {
                        for (j = 0; j < colLen; j++) {
                            //if (column[j].dataIndex == 'rn' || column[j].dataIndex == 'sel')
                             //   continue;
                            if (!Ext.isEmpty(columnsValue[column[j].dataIndex])) {
                                grid.colClear = true;
                                grid.edited = false;
                                len[i].set(column[j].dataIndex, columnsValue[column[j].dataIndex].v);
                            }
                        }
                    }
                }
                grid.dummyRec = '';
                return;
            }
            return;
        }
    },
	doHighLightTreeSearchData: function(data, options) {
		var me = this,
			currentView = me.getCurrentView(),
			searchData = null, len, visblepos = false,
			regex = Ext.String.createRegex(options.params.srchtext,false,false,true),
			rtNode = null, treeStore = null,
			treePanel = currentView.queryById(options.params.treeid),
			rtNode = treePanel.getRootNode(),
			treeStore = treePanel.getStore(),
			treeSearchWin = treePanel.treeSearchWin,
			treeSchData,
			mboxObj;
		if (data.data && data.data.searchNode) {
			treePanel.searchDataLength = data.data.searchNode[options.params.treeid].length;
			treePanel.selectedCount = 0;
		}			
		if (treeSearchWin)
			treeSchData = treeSearchWin.getTreeData();
		// XIP-516 / TECH-28336 / TECH-29394
		if (data.message && data.message.length > 0 && (data.message[0].sv == 5 || data.message[0].sv == 1)) { //TECH-28711
			mboxObj = Ext.RamcoMsg.alert(rvw_resources.R260, data.message[0].ds,
			function(btnId) {}, undefined, 'error', data.messages.length > 1 ? data.messages : null);
			if(mboxObj.msgButtons)
				mboxObj.msgButtons[0].focus(true);
		}
		treePanel.clearTreeHightLight();		
		if((treeSchData && treeSchData.DEFAULT == 'all') || !treeSchData) {
			Ext.Object.eachValue(treeStore.byIdMap, function(node) {
				if (node ) {
					if(regex.test(node.get("itemId")) || regex.test(node.get("text"))) {
						node.addCls("x-tree-search-item");
						if(!visblepos) {
							treePanel.ensureVisible(node.getPath());
							visblepos = true;
						}					
					}
					else {
						node.removeCls("x-tree-search-item");
					}
				}
			});
		}
		else if (treeSchData && treeSchData.DEFAULT == 'next') {
			if (treePanel.searchDataLength == treePanel.selectedCount) {
				treePanel.selectedCount = 0;
			}
			Ext.Object.eachValue(treeStore.byIdMap, function(node) {
				if (node ) {
					if((regex.test(node.get("itemId")) || regex.test(node.get("text"))) && (!node.data.sel || node.data.sel == false)) {
						node.addCls("x-tree-search-item");
						node.data.sel = true;
						treePanel.selectedCount++;
						if(!visblepos) {
							treePanel.ensureVisible(node.getPath());
							visblepos = true;
						}
						return false;
					}
					else {
						node.removeCls("x-tree-search-item");
						node.data.sel = false;
					}
				}
			});			
		}
		else if (treeSchData && treeSchData.DEFAULT == 'prev') {
			if (treePanel.searchDataLength == treePanel.selectedCount) {
				treePanel.selectedCount = 0;
			}
			var revTreeStoreIds = Object.keys(treeStore.byIdMap).reverse();
				Ext.Object.eachValue(revTreeStoreIds, function(key) {
					var node = treeStore.byIdMap[key];
					if (node) {					
						if((regex.test(node.get("itemId")) || regex.test(node.get("text"))) && (!node.data.sel || node.data.sel == false)) {
							node.addCls("x-tree-search-item");
							node.data.sel = true;
							treePanel.selectedCount++;
							if(!visblepos) {
								treePanel.ensureVisible(node.getPath());
								visblepos = true;
							}
							return false;
						}
						else {
							node.removeCls("x-tree-search-item");
							node.data.sel = false;
						}
					}
				});			
			}
	},	
    onGridRenderData: function(item, e, response) {
        if(response) {	// TECH-29906
			var me = this,
				store,
				win,
				curViewOrHelp = me.getCurrentHelp() || me.getCurrentView(),
				gridContainer,
				// AHBG-31972
				gridObj = curViewOrHelp && curViewOrHelp.down('#' + response.ctrlname),
				panelObj = gridObj && gridObj.up('ramcopanel'),
				panelTitle = (panelObj && panelObj.title) || '';
			store = new Ext.data.Store({
				fields: response.fields
			});
			store.loadData(response.store);

			gridContainer = new Ext.grid.Panel({
				title: '',
				store: store,
				columnLines:true,
				columns: response.columns

			});
			// TECH-38034 / TECH-38059
			if (!Ext.isEmpty(panelTitle))
				panelTitle = 'Report on ' + panelTitle;
			//TECH-34198
			win = Ext.create('Ext.window.Window', {
				//title: '',
				title: panelTitle,
				minHeight: 200,
				modal: true,
				maximizable:true,
				scrollable:true,
				alwaysOnTop:true,//TECH-36970
				closeAction: 'hide',
	            width: '80%',
				height:'80%',
	            layout: 'fit',
					style: {
						'padding': '10px'
					},
				items: [gridContainer]

			});

			win.show();
			win.center();
			win.updateLayout();
		}


    },
    onTemplateMenuClick: function(btn, e, eOpts) {
        var me = this,
            currentView = me.getCurrentView();
        RamcoRTC.doGetTemplateData(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, btn.itemId);
    },
	onMenuFavItemClick: function(item, e, eOpts) {
		var me = this,
			currentView = me.getCurrentView();
		//if(Ext.isEmpty(RamcoRTC.settings.enableWizard) || RamcoRTC.settings.enableWizard == false || (item.menu && item.menu.items.length > 0))
		  if(Ext.isEmpty(RamcoRTC.settings.enableWizard) || RamcoRTC.settings.enableWizard == false )//AHBG-25784	
			return;
		me.mask(true);
		RamcoRTC.doGetFavorites(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'fetch_favorites', 'async');		
	},
    onMenuItemClick: function(item, e, eOpts) {
        var me = this,
			currentView = me.getCurrentView(),
			currentHelp = me.getCurrentHelp(),
			wizBtns = me.getWizBtns(), // TECH-35301 / LMH-200
			//ilboTitle = me.getIlboTitle(),
			favBtn = item.parentMenu;
        if (favBtn && favBtn.ownerCmp && favBtn.ownerCmp.itemId == 'getFav')
            return;
		if (item.task == 'tskstdwizardlink') {
			try {
				var _data = me.getWizBtns();
				if (_data) {
					var record = _data.record,
						data = currentView.getSessionData(),
						_data = record.data["v5"],
						_btnVal = me.getWizBtns()[item.name],
						_dataEx, wizardDetails;
						
					_dataEx = _data.split("::#::");
					currentView.fireEvent('wizardsteptrans', currentView, data, 'getsteplaunchflag', 'trans', null, _btnVal, (_data['preItem'] || 1));
					
					// TECH-35301 / LMH-200
					//me.getWizBtns()['preItem'] = "'" + item.name + "'";
					if (!Ext.isEmpty(wizBtns)) {
						wizBtns['actPreItem'] = wizBtns['preItem'] = item.name;
					}
					
					var wizBtnObj = me.getWizBtns(), wizActItem, ind = 0;					
					if (wizBtnObj && wizBtnObj.length > 0) {
						for (; ind < wizBtnObj.length; ind++) {
							wizActItem = wizBtnObj[ind].act;
							if (!Ext.isEmpty(wizActItem)) {
								delete wizBtnObj[ind].act;
								break;
							}
						}
					}
				}
				return true; // TECH-35301 / LMH-200
			}
			catch(ex) {
				console.log(ex);
			}
		}
		else {
			// TECH-35301 / LMH-200
			if (!Ext.isEmpty(wizBtns)) {
				wizBtns['actPreItem'] = wizBtns['preItem'] = null;
			}
		}
		
			// TECH-37478
		if(RamcoRTC.inlineReportLaunched == true) {
			me.onRemoveInlineReport();
			
			/* var mainView = me.getMainView(),
				inlineReport = mainView.down('#rptInline'),
				ilboView = me.getIlboView();
			if (inlineReport && ilboView) {
				ilboView.setActiveItem(currentView);
				Ext.destroy(ilboView.remove(inlineReport));
				//ilboTitle.setText(me.getPreReportIlboText());
				delete RamcoRTC.inlineReportLaunched;
				me.setPreReportIlboText(null);
			} */
		}
		
		if (item.startui && item.startui.indexOf('URL') > -1) {
			var URL = item.startui.substring(5, item.startui.length),
				launchMode = item.startui.charAt(0);
			if (launchMode) {
				// TECH-27239 / AHBG-22815
				if (launchMode == '3' || launchMode == '5') {
					if (launchMode == '3' && URL){
						if(URL.indexOf("?") >-1)
							URL += "&";
						else 
							URL += "?";
						URL += "USER_ID=" + RamcoRTC.userInfo.n + "&ROLE_NAME=" + RamcoRTC.userInfo.rd + "&OU_ID=" + RamcoRTC.userInfo.oud + "&LANG_ID=" + RamcoRTC.userInfo.l;
					}
					openWindow(URL);
					me.mask(false);
					return;
				}
				else if(launchMode == '6') {
					var iFramePanel = Ext.create("Ext.ux.IFrame",{src:URL}),
						ilboView = me.getIlboView();					
					if (ilboView) {
						if (currentView)
							Ext.destroy(ilboView.remove(currView));
						ilboView.add(iFramePanel);
						return;
					}		
				}
			}
		}
        //this.mask(true);
        var me = this,
            btnPref = null,
            btnDefault = me.getBtnMenuDefault(),
            tBar = (typeof item == 'object') ? item.up('toolbar') : '';
        me.proceed = false;
		// TECH-28365
        // if ((currentView && currentView.xtype !='ramcoblankpagecmp') && (currentView.hasModified() || item.aname == 'switchcontexts')) {
		// TECH-29809
		// if ((currentView && currentView.xtype !='ramcoblankpagecmp') && (currentView.hasModified() || item.aname == 'switchcontexts' || item.aname.toLowerCase() == 'contextswitch')) {
		// TECH-30187
		// if ((currentView && currentView.xtype !='ramcoblankpagecmp') && (currentView.hasModified() || item.aname == 'switchcontexts' || item.aname.toLowerCase() == 'contextswitch' ||  item.aname.toLowerCase() == 'organizefavorites')) {
		if ((currentView && currentView.xtype !='ramcoblankpagecmp') && (currentView.hasModified() || (item.aname && (item.aname.toLowerCase() == 'switchcontexts' || item.aname.toLowerCase() == 'contextswitch' ||  item.aname.toLowerCase() == 'organizefavorites')))) {
            // TECH-28636
			
			// TECH-29809
			// if(item.aname == 'switchcontexts'){
			if(item.aname == 'switchcontexts' || item.aname == 'contextswitch' || item.aname == 'organizefavorites'){
				Ext.RamcoMsg.confirm(rvw_resources.R111, rvw_resources.R259, function(btnId) {
					if (btnId == "ok" || btnId == "yes") {
						me.mask(true);
						var ilboView = me.getIlboView(),
							currentView = me.getCurrentView(),
							currentHelp = me.getCurrentHelp();
						if (currentView && currentView.ilboConfig && currentView.ilboConfig.ilboName != "ezwizard") {
							RamcoRTC.wizardLaunched = false;
							if (currentView.isCancel)
								currentView.isCancel = false;
							else if(currentHelp && currentHelp.isCancel)
								currentHelp.isCancel = false;
						}
						Ext.destroy(ilboView.remove(currentView));
						me._currentView = null;
						me.setTaskDesc('Launching Screen');
						me.menuItemsFn(item, e, eOpts);
						return
					}
				});
			}
			else
			{
				var menuFunction = function(){
					me.mask(true);
					var ilboView = me.getIlboView(),
						currentView = me.getCurrentView(),
						currentHelp = me.getCurrentHelp();
					if (currentView && currentView.ilboConfig && currentView.ilboConfig.ilboName != "ezwizard") {
						RamcoRTC.wizardLaunched = false;
						if (currentView.isCancel)
							currentView.isCancel = false;
						else if(currentHelp && currentHelp.isCancel)
							currentHelp.isCancel = false;
					}
					Ext.destroy(ilboView.remove(currentView));
					me._currentView = null;
					me.setTaskDesc('Launching Screen');
					me.menuItemsFn(item, e, eOpts);
				}

				var workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default",
				dstRequired = "1",
				controller = getMainController(); // TECH-29276

				if (currentView && currentView.ilboConfig)
				{
					// TECH-29276
					// dstRequired = RamcoRTC.dstRequired[workArea][currentView.ilboConfig.ilboName];
					dstRequired = controller.dstRequired[workArea][currentView.ilboConfig.ilboName];
					
					if(!dstRequired)
						dstRequired = "1";
				}

				if(dstRequired == "1")
				{
					Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R218, function(btnId) {
						if (btnId == "ok" || btnId == "yes") {
							menuFunction();
							return;
						}
					});
				}
				else
					menuFunction();
			}
        } else {
			this.mask(true);
            if (RamcoRTC.currentInstance == 'Wizard') {
                RamcoRTC.currentInstance = 'default';
                btnDefault.setText('Default Window');
                var menu = btnDefault.getMenu();
                menu.items.each(function(itm, index) {
                    if (index != 0) itm.setChecked(false);
                });
                menu = menu.items.getByKey('Default Window');
                if (menu)
                    menu.setChecked(true);
            }
            if (item.startui == 'ezwizard') {
                RamcoRTC.currentInstance = 'Wizard';
                btnDefault.setText('Wizard');
                RamcoRTC.wizardLaunched = true;
                var menu = btnDefault.getMenu();
                menu.items.each(function(itm, index) {
                    if (index != 0) itm.setChecked(false);
                });
                menu = menu.items.getByKey('Wizard');
                if (menu)
                    menu.setChecked(true);
            }
            me.setTaskDesc('Launching Screen');
            if (item.aname == 'logout') {
                RamcoRTC.doLogout(me.onRequestComplete, me.onRequestException, me, {}, 'tskstdquit', 'trans');
                return;
            } else if (item.aname == 'abtvirtualworks' || item == 'abtvirtualworks') {
                if (me.aboutWindow) {
                    me.aboutWindow.show();
                    me.aboutWindow.center();
                    me.mask(false);
                    return;
                }
                if (!Ext.isEmpty(item.aname)) {
                    RamcoRTC.doAbout(me.onRequestComplete, me.onRequestException, me, {}, '', '');
                } else {
                    me.aboutWindow = Ext.create('Ext.window.Window', {
                        title: rvw_resources.R326,
                        height: 450,
                        width: 400,
                        modal: true,
                        layout: 'auto',
                        bodyPadding: 10,
                        closeAction: "hide",
                        items: [{
                            xtype: 'ramcolabel',
                            focusable: false,
                            width: '100%',
                            height: '100%',
                            value: eOpts,
                        }]
                    }).show();
                    me.mask(false);
                }
                return;
            } else if (item.aname == "changepwd" && RamcoRTC.settings.domainChangePwdUrl) {
                openWindow(RamcoRTC.settings.domainChangePwdUrl);
                return;
            } else if (item.aname == "userapppreferences") {
                me.showAppPreference();
                return;
            }
            this.menuItemsFn(item, e, eOpts)
        }
    },
	launchHomeScreen: function() {
		var me = this,
			currentView = me.getCurrentView() || {},
			ilboView = me.getIlboView(),
			actName = 'homepage', compName = 'security', ilboName = 'homepage', data = '', // TECH-30816
			btnPref = null, toolbar = me.getTblApp(); // TECH-39424
		me.mask(true);
		me.setTaskDesc('Home');
		me.setLastTaskType('trans');			
		if (currentView) {
			// TECH-30816
			if (currentView.ilboConfig) {
				actName = currentView.ilboConfig.activityName;
				compName = currentView.ilboConfig.componentName;
				ilboName = currentView.ilboConfig.ilboName;
				data = 'tskstdcancel';
			}
			
			btnPref = me.getBtnSave();
			if (btnPref)
				btnPref.hide();
			btnPref = me.getBtnClear();
			if (btnPref)
				btnPref.hide();
			btnPref = me.getBtnCancl();
			if (btnPref)
				btnPref.hide();
			btnPref = me.getBtnPrintBar();
			//if (RamcoRTC.settings.hidePrintButton == true || (btnPref && !Ext.Object.isEmpty(currentView.templatesJson) && currentView.templateFile))
			if (currentView.hidePrint == false)
				btnPref.show();
			else
				btnPref.hide();
			Ext.destroy(ilboView.remove(currentView));
			me.setCurrentView(null);
			me.setTaskDesc('Launching Screen');
		}
		me.setPersonalization(false);
		me.setDefaultTemplate(false);
		// TECH-39424
		if (toolbar && toolbar.isVisible())
			toolbar.hide();		
		// TECH-38856
		if ( !me.getInvalidPageLaunch() && RamcoRTC.settings.alwaysShowDefault == true && ((RamcoRTC.userInfo.defac && RamcoRTC.userInfo.defic) || !Ext.isEmpty(me.getDefaultLaunch())) ) {
			/* RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
				activityName: RamcoRTC.userInfo.defac,
				ilboName: RamcoRTC.userInfo.defic,
				componentName: (RamcoRTC.osType == 'JAVA') ? RamcoRTC.userInfo.defcomp : '',
				inlineTab: true
			}, ''); */
			me.onDefaultActivityLaunch();
		}
		else {
			// TECH-30816
			/* RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
				componentName: compName,
				activityName: actName,
				ilboName: ilboName
			}, data); */
			
			// TECH-32502
			RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
				componentName: 'security',
				activityName: 'homepage',
				ilboName: 'homepage'
			}, '');
		}
	},
    menuItemsFn: function(item, e, eOpts) {
        var me = this,
            btnPref = null,
            tBar = (typeof item == 'object') ? item.up('toolbar') : '',
            ilboView = me.getIlboView(),
            currView = me.getCurrentView(),
            currHelp = me.getCurrentHelp();
        if (currView && currView.ilboConfig && currView.ilboConfig.ilboName != "ezwizard") {
            RamcoRTC.wizardLaunched = false;
			if (currView.isCancel)
				currView.isCancel = false;
			else if(currHelp && currHelp.isCancel)
				currHelp.isCancel = false;
		}
        if (item.aname == "changepwd" && RamcoRTC.settings.domainChangePwdUrl) {
            openWindow(RamcoRTC.settings.domainChangePwdUrl);
            return;
        } else if (item.aname == 'logout') {
            RamcoRTC.doLogout(me.onRequestComplete, me.onRequestException, me, {}, 'tskstdquit', 'trans');
            return;
        }
        if (item.packagegroup == "security")
            me.setLastTaskType('modal');
        if (currView && ilboView)
            Ext.destroy(ilboView.remove(currView));
        me.setCurrentView(null);
        me.doMenuSync(item.packagegroup, item.aname, item.startui);
        me.setPersonalization(false);
        me.setDefaultTemplate(false);
        btnPref = me.getBtnSave();
        if (btnPref)
            btnPref.hide();
        btnPref = me.getBtnClear();
        if (btnPref)
            btnPref.hide();
        btnPref = me.getBtnCancl();
        if (btnPref)
            btnPref.hide();
		//Clears IlboLevel OU and Role On NewActivity Launched From Menu
		RamcoRTC.ilbooud = "";
		RamcoRTC.ilbord = "";
        RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
            componentName: item.packagegroup,
            activityName: item.aname,
            ilboName: item.startui,
            isEdk: item.isedk ? item.edk : ''
        }, '');
    },
    onMenuContextClick: function(item, e, eOpts) {
        var me = this,
            instance = item.text || 'default',
            text = (instance == 'default') ? 'Default Window' : instance,
            currentView = me.getCurrentView();
        if (currentView.tempId == 'ezwizard_ezwizard') {
            me.mask(true);
            RamcoRTC.currentInstance = instance;
            var btnDefault = me.getBtnMenuDefault(),
                menu = btnDefault.getMenu();
            btnDefault.setText(text);
            menu.items.each(function(itm, index) {
                if (index != 0) itm.setChecked(false);
            });
            menu.items.getByKey(text).setChecked(true);
			//TECH-36492
            //me.doMenuSync(currentView.tmpConfig.componentName, currentView.tmpConfig.activityName, currentView.tmpConfig.ilboName);
            RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, currentView.tmpConfig || {}, '');
        } else
            RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, item.task, item.taskType, '', null);
    },
    showAppPreference: function() {
        var me = this,
            GetItems = function(_optionValue) {
                var returnArray = [];
                try {
                    switch (_optionValue) {
                        case "preference":
                            returnArray.push([rvw_resources.R276, "BLANK"]);
                            returnArray.push([rvw_resources.R277, "DEFACT"]);
							if (RamcoRTC.settings.enableWizard)
                            returnArray.push([rvw_resources.R278, "WIZARD"]);
                            return returnArray;
                            break;
                        case "wizard":
							if (RamcoRTC.settings.enableWizard) {
								if (!RamcoRTC.settings.hideInbox)
									returnArray.push([rvw_resources.R279, "inbox"]);
								if (!RamcoRTC.settings.hideWizard)
									returnArray.push([rvw_resources.R280, "wizard"]);
								if (!RamcoRTC.settings.hideMenuMap)
									returnArray.push([rvw_resources.R281, "menumap"]);
								if (!RamcoRTC.settings.hideFavorites)
									returnArray.push([rvw_resources.R282, "favorites"]);
								if (!RamcoRTC.settings.hideMenuTag)
									returnArray.push([rvw_resources.R283, "menutag"]);
							}							
                            return returnArray;
                            break;
                        case "theme":
							if (RamcoRTC.settings.isExt2 == true) {
								return [
									[rvw_resources.R320, "defaulttheme"],
									[rvw_resources.R321, "bluetheme"],
									[rvw_resources.R322, "greentheme"],
									[rvw_resources.R323, "graytheme"],
									[rvw_resources.R324, "articbluetheme"],
									[rvw_resources.R325, "bluejaytheme"]
								];
							}
							else {
                            return [
                                [rvw_resources.R284, "hydra"],
                                [rvw_resources.R285, "aqua"],
                                [rvw_resources.R286, "granite"]
                            ];
							}
                            break;
                        case "favgroupdisp":
                            return [
                                [rvw_resources.R287, "asc"],
                                [rvw_resources.R288, "desc"]
                            ];
                            break;

                        default:
                            break
                    }
                } catch (ex) {}
            },
            prefData = GetItems("preference"),
            wizData = GetItems("wizard"),
            themeData = GetItems("theme"),
            favGroupDispData = GetItems("favgroupdisp"),
            launchStore = new Ext.data.SimpleStore({
                autoLoad: true,
                fields: ["name", "key"],
                data: prefData
            }),
            wizardStore = new Ext.data.SimpleStore({
                autoLoad: true,
                fields: ["name", "key"],
                data: wizData
            }),
            themeStore = new Ext.data.SimpleStore({
                autoLoad: true,
                fields: ["name", "key"],
                data: themeData
            }),
			favGroupDispStore = new Ext.data.SimpleStore({
				autoLoad: true,
				fields: ["name", "key"],
				data: favGroupDispData
			});
		var appLaunch = RamcoRTC.userInfo.appLaunch || me.getDefaultLaunch() || '',
			defWizTab = RamcoRTC.userInfo.wizTab || me.getDefaultWizardTab() || '',
			defTheme = RamcoRTC.userInfo.deftheme || me.getDefaultTheme() || '',
			favGrpdisp = RamcoRTC.userInfo.favGrpdisp || me.getFavGrpdisp() || '';
			
		// TECH-32718
		if (!Ext.isEmpty(defTheme)) {
			// TECH-37062
			if (defTheme == 'bluetheme' || defTheme == 'articblue')
				defTheme = 'hydra';
			else if (defTheme == 'default_theme' || defTheme == 'greentheme')
				defTheme = 'aqua';
			else if (defTheme == 'bluejay' || defTheme == 'graytheme')
				defTheme = 'granite';
		}
		else {
			defTheme = 'hydra';
		}
		defTheme = defTheme.toLowerCase();
		
        if (!me.appPrefWindow) {
            me.mask(false);
            me.appPrefWindow = Ext.create('Ext.window.Window', {
                title: 'Application Preference',
                width: 350,
                height: 200,
                bodyPadding: 5,
                resizable: false,
                closeAction: 'hide',
                modal: true,
                layout: {
                    type: 'table',
                    columns: 2
                },
                dockedItems: [{
                    xtype: 'ramcopanel',
                    bodyPadding: 5,
                    dock: 'bottom',
                    layout: 'hbox',
                    items: [{
                        xtype: 'component',
                        width: '33%'
                    }, {
                        xtype: 'button',
                        role: 'appPreference',
                        itemId: 'savePreference',
                        text: rvw_resources.R191,
                    }, {
                        xtype: 'component',
                        width: '33%'
                    }]
                }],
                items: [{
                    xtype: 'label',
                    html: rvw_resources.R201
                }, {
                    xtype: 'combofield',
                    queryMode: 'local',
                    displayField: 'name',
                    itemId: "deflaunchoptions",
                    emptyText: rvw_resources.R202,
                    store: launchStore,
                    visibleLength: 0,
                    valueField: "key",
                    value: appLaunch,
                    width: 200
                }, {
                    xtype: 'label',
                    html: 'Wizard',
					hidden: (!RamcoRTC.settings.enableWizard) ? true : false
                }, {
                    xtype: 'combofield',
                    queryMode: 'local',
                    displayField: 'name',
                    itemId: "wizardoptions",
                    emptyText: rvw_resources.R203,
                    store: wizardStore,
                    visibleLength: 0,
                    valueField: "key",
					hidden: (!RamcoRTC.settings.enableWizard) ? true : false,
                    value: defWizTab,
                    width: 200
                }, {
                    xtype: 'label',
                    html: 'Theme'
                }, {
                    xtype: 'combofield',
                    queryMode: 'local',
                    displayField: 'name',
                    itemId: "themeoptions",
                    emptyText: rvw_resources.R204,
                    store: themeStore,
                    visibleLength: 0,
                    valueField: "key",
                    value: defTheme,
                    width: 200
                }, {
                    xtype: 'label',
                    html: 'Favorites Group'
                }, {
                    xtype: 'combofield',
                    queryMode: 'local',
                    displayField: 'name',
                    itemId: "favgroupsortoptions",
                    emptyText: rvw_resources.R255,
                    store: favGroupDispStore,
                    visibleLength: 0,
                    valueField: "key",
                    value: favGrpdisp,
                    width: 200
                }]
            }).show();
        } else {
			me.mask(false);
            me.appPrefWindow.show();
		}
    },
    doMenuSync: function(cmpName, actName, ilboName, ilboDesc,cmpDesc) {
        var me = this,
            btnComponent = me.getBtnComponent(),
            btnActivity = me.getBtnActivity(),
            btnArrow1 = me.getBtnArrow1(),
            btnArrow2 = me.getBtnArrow2(),
            ilboTitle = me.getIlboTitle(),
			txtBpcIlboTitle = me.getTxtBpcIlboTitle(),
            btnArrow3 = me.getBtnArrow3(),
            menu,
            itm,
            cItem,
            itmArr,
            items = [],
            record = null,
            store = Ext.getStore('NavigationMenu');
        if (cmpName && actName && ilboName) {
            if (store) {
                //record = store.findNode('startui', value);
				var rt = store.getRootNode();
				record = rt.findChildBy(function (child) { return (cmpName == child.get('packagegroup') && actName == child.get('aname') && ilboName == child.get('startui')); }, me, true);
				
				// TECH-39192 / IHH-516
				if (!record)
					record = rt.findChildBy(function (child) { return (child.get('packagegroup') == cmpName && actName == child.get('aname')); }, me, true);
                if (record) {
                    if (btnActivity) {
						btnActivity.suspendLayouts();
                        parentItem = record.parentNode;
                        menu = btnActivity.getMenu();
                        if (menu) {
                            Ext.destroy(menu);
                        }
                        items = [];
						if(parentItem.raw.menu && parentItem.raw.menu.length > 0) {
							var len = parentItem.raw.menu.length,
								  i = 0,
								  ele = null;
							for(; i < len; i++) {
								ele = parentItem.raw.menu[i];
							//parentItem.raw.menu.forEach(function(ele, index, array) {
                            ele.id = null;
                            delete ele.id;
                            itm = Ext.clone(ele);
                            items.push(itm);
							}
							//);
						}
                        menu = Ext.create('Ext.menu.Menu', {
                            ignoreParentClicks: true,
                            items: items
                        });
                        btnActivity.setMenu(menu);
						btnActivity.setText(parentItem.raw.text);
						btnActivity.show();
						btnActivity.resumeLayouts();
						btnArrow1.suspendLayouts();
						btnArrow1.show();
						btnArrow1.resumeLayouts();						
                    }
                    if (btnComponent) {
                        parentItem = parentItem.parentNode;
                        if (parentItem) {
                            menu = btnComponent.getMenu();
                            if (menu) {
                                Ext.destroy(menu);
                            }
                            items = [];
							if(parentItem.raw.menu && parentItem.raw.menu.length > 0) {
								var len = parentItem.raw.menu.length,
									  i = 0,
									  ele = null;
								for(; i < len; i++) {
									ele = parentItem.raw.menu[i];
									//parentItem.raw.menu.forEach(function(ele, index, array) {
									ele.id = null;
									delete ele.id;
									itm = Ext.clone(ele);
									if (itm) {
										itmArr = [];
										if(itm.menu && itm.menu.length > 0) {
											var aclen = itm.menu.length,
												c = 0,
												itmEle = null;
											for(; c < aclen; c++) {
												itmEle = itm.menu[c];
												//itm.menu.forEach(function(itmEle, itmIndex, itmArray) {
												itmEle.id = null;
												delete itmEle.id;
												cItem = Ext.clone(itmEle);
												itmArr.push(cItem);
											}
											//);
										}
									}
									itm.menu = itmArr;
									items.push(itm);
								}
							//);
							}
                            menu = Ext.create('Ext.menu.Menu', {
                                ignoreParentClicks: true,
                                items: items
                            });
							btnComponent.suspendLayouts();
                            btnComponent.setMenu(menu);
							btnComponent.setText(parentItem.raw.text);
							btnComponent.show();
							btnComponent.resumeLayouts();
							btnArrow2.suspendLayouts();
							btnArrow2.show();
							btnArrow2.resumeLayouts();
                        }
                    }
                }
				else {
					 // TECH-27479
					 if ((btnComponent || btnActivity) && cmpDesc) {
						record = rt.findChildBy(function (child) { return (child.get('packagegroup') == cmpName); }, me, true);						
						if(!Ext.isEmpty(record) && record.parentNode && record.parentNode.parentNode) {
							btnComponent.suspendLayouts();	
							btnComponent.setText(record.parentNode.parentNode.raw.text);
							btnComponent.show();
							btnComponent.resumeLayouts();							
						}
						btnActivity.suspendLayouts();	
						btnActivity.setText(cmpDesc);
						btnActivity.show();
						btnActivity.resumeLayouts();
					}
				}
            }
			ilboTitle.setText(ilboDesc);
			if (txtBpcIlboTitle)
				txtBpcIlboTitle.setText(ilboDesc);
        } else {
            if (ilboTitle) {
                ilboTitle.setText('');
				//TECH-36935
				me.setActivityDesc('');
			}
			if (txtBpcIlboTitle) {
                txtBpcIlboTitle.setText('');
			}			
            btnArrow1.hide();
            btnArrow2.hide();
            btnArrow3.hide();
            if (btnActivity) {
                menu = btnActivity.getMenu();
                if (menu) {
                    Ext.destroy(menu);
                }
                btnActivity.setMenu(null);
                btnActivity.menu = null;
                delete btnActivity.menu
                btnActivity.setText('');
                btnActivity.hide();
            }
            if (btnComponent) {
                menu = btnComponent.getMenu();
                if (menu) {
                    Ext.destroy(menu);
                }
                btnComponent.setMenu(null);
                btnComponent.menu = null;
                delete btnComponent.menu
                btnComponent.setText('');
                btnComponent.hide();
            }
        }
		if(RamcoRTC.isPortal && RamcoRTC.portalMode && RamcoRTC.isPortal === true && RamcoRTC.portalMode === "1") {
			btnComponent.setVisible(false);
			btnActivity.setVisible(false);
			btnArrow1.setVisible(false);
			btnArrow2.setVisible(false);
			btnArrow3.setVisible(false);
		}
    },
    onForgetPassword: function(v) {
        if (RamcoRTC.settings && RamcoRTC.settings.domainChangePwdUrl) {
            openWindow(RamcoRTC.settings.domainChangePwdUrl);
            return;
        } else {
            var me = this,
                data = null,
                currentView = null;
            me.mask(true);
            me.setTaskDesc('Trans Screen');
            me.setLastTaskType('link');
            currentView = me.getCurrentView();
            data = currentView.getSessionData() || [];
            if (Ext.isEmpty(data)) {
                data.push({
                    id: "ide_username",
                    vl: me.getUsername().value
                });
            }
            RamcoRTC.doForgetPwd(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, data);
        }
    },
	onLoadReport: function(a) {
		var me = this;
		me.mask(false);
	},
    onScreenInit: function(v, data) {
        //this.mask(true);
        var me = this;
		me.onAfterLoad();
		me.setTaskDesc('Initialize Screen');
		setTimeout(function(){
			if (RamcoRTC.osType == 'JAVA' && v.ilboConfig && v.ilboConfig.activityName == 'login') {
				v.ilboConfig.activityName = 'Logon';
				v.ilboConfig.activityDesc = 'Logon';
			}
			// TECH-28978
			//if(me.getPersonalization()){
				var currentView = me.getCurrentHelp(),
					lastTaskType = me.getLastTaskType(),
					lastTaskType = lastTaskType ? lastTaskType.toLowerCase() : null,
					currentHelp = currentView,
					firstTimeLogin = me.getFirstTimeLogin(),
					forgotPwd = me.getForgotPwd();
				if(!currentView)
					currentView = me.getCurrentView();
				if(currentView.ilboConfig.ilboName == 'ezelogin' || RamcoRTC.isGProto)
					RamcoRTC.initializeUI(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, data);
				else {
					currentView.callBack = function() {
							//me.mask(true);
							//TECH-29150
							//if (lastTaskType != 'help' && lastTaskType != 'modal' && lastTaskType != "smartviewlink" && !currentHelp && !firstTimeLogin && !forgotPwd)
							// TECH-30747 - Prevent Async call for Proto
							if (!RamcoRTC.isProto && lastTaskType != 'help' && lastTaskType != 'modal' && lastTaskType != "smartviewlink" && !currentHelp && !firstTimeLogin && !forgotPwd)
								RamcoRTC.doAsyncCall(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {});
							else
								RamcoRTC.initializeUI(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, data); 
					}
					RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'GETDOC', 'trans');
				}
				//currentView.performPersonalization(me.getPersData());
			/*}else{
				RamcoRTC.initializeUI(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, data); 
			}*/
		}, 0);
    },
    onCompleted: function(v) {
		if (this.doGetFavourities == true) {
			this.doGetFavourities = false;
			RamcoRTC.doGetFavorites(this.onRequestComplete, this.onRequestException, this, v.ilboConfig || {}, 'fetch_favorites', 'async');
			return;
		}
		this.mask(false);
    },
    onGetData: function(v, data, task, lastTaskName) {
        this.mask(true);
        var me = this,
            helpTask = me.getHelpTask();
        me.setTaskDesc('Get Screen Data');
        me.setHelpTask(null);
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, 'trans', data, lastTaskName);
    },
    onAddWindowPage: function(win, cmp) {
        var me = this,
            curIndex = me.getWindowIndex(),
            allPageArr = me.getAllWindowData(),
			newData = true,
			size = {};
		for (w = 0; w < allPageArr.length; w++) {
			if (allPageArr[w].id == cmp.tempId) {
				newData = false;
				break;
			}						
		}
		if(newData == true) {
			size = (win.childHeight && win.childWidth) ? ({width: win.childWidth, height: win.childHeight}) : ({width: '100%', height: '100%'});
			allPageArr.push({
				id:cmp.tempId,
				// TECH-29396
				//wintype: me.getLastTaskType(),
				wintype: me.getLastTaskType() ? me.getLastTaskType() : win.winType,
				smartview:(win.winType =="smartview")?true:false,//TECH-27444
				winsize: size
			});
			me.setWindowIndex(allPageArr.length);
		}
		win.pageIndex = me.getWindowIndex();
        me.setAllWindowData(allPageArr);
    },
    onRemoveWindowPage: function(win) {
        var me = this,
            allPageArr = me.getAllWindowData();
		allPageArr.pop();
		me.setWindowIndex(allPageArr.length);			
        me.setAllWindowData(allPageArr);
		//TECH-32118
		win.childWidth = null;
		win.childHeight = null;
		//win.hide();//TECH-27444
	    if (allPageArr.length > 0) {			
			var lastWindow = allPageArr[allPageArr.length - 1];
			if(lastWindow.smartview){//TECH-27444
				Ext.suspendLayouts();
				me.modalWindow.header.setVisible(false);
				RamcoRTC.hasSmartViewLink = true;
				win.removeAllComponent(true);
				Ext.resumeLayouts(true);
			}	
			else{
				win.closeType = "1"; // TECH-29165
				//TECH-30370
				//me.setCurrentHelp(null);
				win.hide();
				win.removeAllComponent(true);
			}
			if (win.winType == 'modal') {
				if (win.winType != lastWindow.wintype) {
					me.helpWindow.show();
					me.setLastTaskType('help');
				}
			} else {
				if (win.winType != lastWindow.wintype) {
					me.modalWindow.show();
					me.setLastTaskType('modal');
				}
			}
		}
		else{
			win.closeType = "1"; // TECH-29165
			//TECH-30370
			me.setCurrentHelp(null);
			win.hide();
			win.removeAllComponent(true);
			me.setLastTaskType('trans');		
		}
    },
    onClose: function(win, btn, task, taskType) {
        if(!btn.isClose)
			return;		
		btn.isClose = false;
		if (this.getFirstTimeLogin() || this.getForgotPwd()) {
			this.setCurrentHelp(null);
			this.setLastUrl('');
			this.setForgotPwd(false);
            return false;
        }
		if(!Ext.isEmpty(RamcoRTC.userInfo.forcecmp) && !Ext.isEmpty(RamcoRTC.userInfo.forceact) && !Ext.isEmpty(RamcoRTC.userInfo.forceilb)) {
			var me = this, v = me.getCurrentHelp();
			 RamcoRTC.doLogout(me.onRequestComplete, me.onRequestException, me, v ? v.ilboConfig : {}, 'tskstdquit', 'trans');
		}
        this.mask(true);
        var me = this,
            data = {},
            loginPanel = null,
            loginCont = null,
            v = me.getCurrentHelp() || me.getCurrentView() || {},
            curIndex = me.getWindowIndex(),
            ilboConfig = v.tmpConfig ? v.tmpConfig : v.ilboConfig,
			lastTskType = me.getLastTaskType(),
			allWinData = me.getAllWindowData();
        me.setPersonalization(false);
		if(curIndex > 0) {
			curWinType = allWinData[curIndex - 1].wintype;
			task = 'tskstdgo';
			if(curWinType == 'modal' || curWinType == 'link') {
				if (ilboConfig.ilboName != 'ondisablechangepwd')
					ilboConfig = (task == 'tskstdgo') ? me.modalWindow.tmpConfig : v.ilboConfig;
				delete me.modalWindow.tmpConfig;
				me.modalWindow.pageIndex = 0;
				me.modalWindow.pageArr = [];
				me.modalWindow.hide();
				me.modalWindow.removeAllComponent(true);
				if (!me.getForgotPwd() && ilboConfig.ilboName == 'ondisablechangepwd') {
					loginCont = me.getLoginPanel();
					loginPanel = loginCont.up('[xtype=ilbo]');
					Ext.destroy(loginPanel);
					return;
				}
			}
			else if(curWinType == 'help') {
				ilboConfig = (task == 'tskstdgo') ? me.helpWindow.tmpConfig : v.ilboConfig;
				delete me.helpWindow.tmpConfig;
				me.helpWindow.pageArr = [];
				me.helpWindow.pageIndex = 0;
				me.helpWindow.hide();
				me.helpWindow.removeAllComponent(true);
			}
		}
		/*
		if (!me.modalWindow.isHidden() && me.modalWindow.pageIndex > 0)
            taskType = 'modal';
        if (me.modalWindow.pageIndex > 1 && !me.helpWindow.pageIndex) {
            task = (me.modalWindow.pageIndex > 1) ? 'tskstdgo' : 'tskstdcancel';
            if (ilboConfig.ilboName != 'ondisablechangepwd')
                ilboConfig = (task == 'tskstdgo') ? me.modalWindow.tmpConfig : v.ilboConfig;
            delete me.modalWindow.tmpConfig;
            me.modalWindow.pageIndex = 0;
            me.modalWindow.pageArr = [];
            me.modalWindow.hide();
            me.modalWindow.removeAllComponent();
            if (!me.getForgotPwd() && ilboConfig.ilboName == 'ondisablechangepwd') {
                loginCont = me.getLoginPanel();
                loginPanel = loginCont.up('[xtype=ilbo]');
                Ext.destroy(loginPanel);
                return;
            }
        } else {
            task = (me.helpWindow.pageIndex > 1) ? 'tskstdgo' : 'tskstdcancel';
            ilboConfig = (task == 'tskstdgo') ? me.helpWindow.tmpConfig : v.ilboConfig;
            delete me.helpWindow.tmpConfig;
            me.helpWindow.pageArr = [];
            me.helpWindow.pageIndex = 0;
            me.helpWindow.hide();
            //me.helpWindow.isHelpClose = true;
            me.helpWindow.removeAllComponent();
        }
		*/		
        me.setWindowIndex(0);
        me.setAllWindowData([]);
        if (ilboConfig) {
			if ((ilboConfig.ilboName == 'passremans' || ilboConfig.ilboName == 'ondisablechangepwd') && me.getForgotPwd()) {
				task = 'tskstdscreeninit';
				ilboConfig.activityDesc = 'Login';
				ilboConfig.activityName = 'login';
				delete ilboConfig.componentName;
				delete ilboConfig.ilboDesc;
				ilboConfig.ilboName = 'ezelogin';
				me.setLastUrl('');
				me.setForgotPwd(false);
			}
			if(!Ext.isEmpty(ilboConfig.eventDetails))
				delete ilboConfig.eventDetails;
        }
        me.setCurrentHelp(null);
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        if (curWinType != 'smartviewlink') {
			if (task == "tskstdgo") {
				v.isCancel = false;
			}
			RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, ilboConfig || {}, task, taskType, data, null);
			return;
		}
		me.mask(false);
    },
    onMessageWindowClose: function() {
        var me = this,
            firstTimeLogin = me.getFirstTimeLogin();
        if (firstTimeLogin) {
            me.setLastTaskType('modal');
            me.firstSignIn(true);
            return;
        }
    },
	//TECH-28711
	onTreeGridExpanded: function(grid, record, eOpts) {	
		this.mask(true);	
		var me = this,
			view = me.getCurrentView(),
			ilboConfig = view.ilboConfig,
			url = 'ilrt/Ez_Report.aspx?gridid=' + grid.getItemId() + '&component=' + ilboConfig.componentName + '&activity=' + ilboConfig.activityName + '&ilbocode=' + ilboConfig.ilboName + '&RVWQS_ACTIVEUI=' + '&type=treegrid',
			element = grid,
			store = element.getStore(),
			proxy = store ? store.getProxy() : null;
			
		proxy.extraParams.node = record.data.id;		
		if (proxy) {
			proxy.setUrl(url);
			store.load({
				node:record,
				scope: element,
				callback: function(records, operation, success) {
					me.mask(false);
					var totNode,
						tr;
					if (operation._response && operation._response.responseXML) {
						totNode = operation._response.responseXML.querySelector("xml > total");									
					}
					if (this.getStore()) {									
						var root = this.getRootNode();
						root.expand();									
						var topbar = this.getDockedComponent('gridToolbar');
						dspRow = topbar ? topbar.getComponent('dspRow') : null;
						rowNav = topbar ? topbar.getComponent('rowNav') : null;
						if(totNode) {
							tr = parseInt(totNode.innerHTML, 10);
							dspRow.suspendLayouts();
							if (tr > 0) {
							dspRow.update({v:'- ' + tr + '/' + tr});
							rowNav.setMaxValue(tr);
							rowNav.setRawValue(1);
							rowNav.show();
							}									
							else {
								dspRow.update({v:rvw_resources.R033});
								rowNav.hide();
							}
							dspRow.resumeLayouts();
						}
					}								
				}
			});
		}
	},
	//TECH-32419
    //onTrans: function(v, data, task, taskType, gridId, viewname, direction, childWidth, childHeight, pCtrl, pView) {
	//TECH-35056
	//onTrans: function(v, data, task, taskType, gridId, viewname, direction, childWidth, childHeight, pCtrl, pView, ltaskType) {
	onTrans: function(v, data, task, taskType, gridId, viewname, direction, childWidth, childHeight, pCtrl, pView, ltaskType, metaViewName) {
        this.mask(true);
        var me = this;
        if (me.modalWindow) {
            me.modalWindow.childWidth = (childWidth) ? childWidth : null;
            me.modalWindow.childHeight = (childHeight) ? childHeight : null;
        }
        me.setTaskDesc('Trans Screen');
		//TECH-32419
        //me.setLastTaskType(taskType);
		me.setLastTaskType(ltaskType || taskType);
        me.isCallout = v.coSecName;
        me.coCtrlId = v.coCtrlName;
        me.isCancel = v.isCancel;
        if (task == 'tskstdsort') {
			// TECH-29773
			/* if (RamcoRTC.userInfo.hasmsort) {
				data = viewname;
				RamcoRTC.doSort(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId, 'msort');
				//RamcoRTC.doMultiSort(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, gridId, viewname);
			}
			else */
			data.msortData = viewname;
            RamcoRTC.doSort(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId, viewname, direction);
		}
        else {
			if (task == 'tskstdclink')
				v.ilboConfig.taskId = gridId;
			//TECH-35056	
            //RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, null, gridId, viewname, pCtrl, pView);
			RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, null, gridId, viewname, pCtrl, pView, '', metaViewName);
		}
    },
	onOProtoTrans: function(v, data, task, taskType) {
		this.mask(true);
		var me = this;
		me.setTaskDesc('OProtoTrans Screen');
        me.setLastTaskType(taskType);
		RamcoRTC.doOProtoTransactions(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data);
	},
    onUILaunch: function(v, instance) {
        this.mask(true);
        var me = this,
            btnDefault = me.getBtnMenuDefault();
        me.setTaskDesc('Launching Screen');
        me.setLastTaskType('link');
        if (RamcoRTC.currentInstance == 'Wizard') {
            RamcoRTC.currentInstance = 'default';
            btnDefault.setText('Default Window');
            var menu = btnDefault.getMenu();
            menu.items.each(function(itm, index) {
                if (index != 0) itm.setChecked(false);
            });
            menu = menu.items.getByKey('Default Window');
            if (menu)
                menu.setChecked(true);
			// TECH-38856
			RamcoRTC.wizardLaunched = false;
        }
        RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, v.tmpConfig || v.ilboConfig || {}, '');
    },
    onWizardTask: function(v, data, task, taskType, gridId, viewname) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Wizard Task');
        me.setLastTaskType(taskType);
        RamcoRTC.doWizardTask(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data);
    },
    onExecuteTask: function(v, data, task, taskType, view, childWidth, childHeight, modal, popupSec, popupPos) {
        this.mask(true);
        var me = this;
        if (modal == "true" || modal == true) {
            if (me.modalWindow) {
                me.modalWindow.childWidth = (childWidth) ? childWidth : null;
                me.modalWindow.childHeight = (childHeight) ? childHeight : null;
            }
        } else if (popupSec) {
            me.popupSec = popupSec;
            me.popupHeight = (childHeight) ? childHeight : null;
            me.popupWidth = (childWidth) ? childWidth : null;
        }
        me.isCallout = v.coSecName;
        me.coCtrlId = v.coCtrlName;
        me.setTaskDesc('Trans Screen');
		
		if (taskType == 'smartviewlink') {
			RamcoRTC.hasSmartViewLink = true;			
			me.popupPos = popupPos;
			me.setLastTaskType('smartviewlink');
		}
		else {
        	if ((modal == "true" || modal == true) && Ext.isEmpty(popupSec))
            	//taskType = 'modal';
				me.setLastTaskType('modal');
		}
        //me.setLastTaskType(taskType);
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, null);
    },
    onExecuteLinkTask: function(v, data, task, taskType, view, childWidth, childHeight, modal, popupSec, hlpTask) {
        this.mask(true);
        var me = this;
        if (me.modalWindow) {
            me.modalWindow.childWidth = (childWidth) ? childWidth : null;
            me.modalWindow.childHeight = (childHeight) ? childHeight : null;
        }
        if (modal == "true" || modal == true) {
            taskType = 'modal';
        }
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, hlpTask);
    },
	onDynamicLinkTask: function(v, data, task, taskType, modal,childWidth, childHeight) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
		
		if (me.modalWindow) {
            me.modalWindow.childWidth = (childWidth) ? childWidth : null;
            me.modalWindow.childHeight = (childHeight) ? childHeight : null;
        }
		
		if (modal == "true" || modal == true) {
			me.setLastTaskType('modal');
        }
		else
			me.setLastTaskType(taskType);
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data);
    },
    onMLExecuteTask: function(v, data, task, taskType, gridId, viewname, direction, start, end, childWidth, childHeight, modal, popupSec) {
        this.mask(true);
        var me = this;
        if (modal == "true" || modal == true) {
            if (me.modalWindow) {
                me.modalWindow.childWidth = (childWidth) ? childWidth : null;
                me.modalWindow.childHeight = (childHeight) ? childHeight : null;
            }
        } else if (popupSec) {
            me.popupSec = popupSec;
            me.popupHeight = (childHeight) ? childHeight : null;
            me.popupWidth = (childWidth) ? childWidth : null;
        }
        me.isCallout = v.coSecName;
        me.coCtrlId = v.coCtrlName;
        me.coView = v.coView;
        me.setTaskDesc('Trans Screen');
        if ((modal == "true" || modal == true) && Ext.isEmpty(popupSec))
            taskType = 'modal';
        me.setLastTaskType(taskType);
        RamcoRTC.doMLTransaction(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId, start, end, viewname);
    },
	//TECH-35056
    //onMLTrans: function(v, data, task, taskType, gridId, viewname, direction, start, end) {
	onMLTrans: function(v, data, task, taskType, gridId, viewname, direction, start, end, metaViewName) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        if (v.ilboConfig.ilboName == "ezwizard")
            RamcoRTC.doWizardTransactions(me.onRequestComplete, me.onRequestException, me, me.getCurrentView().ilboConfig || {}, task, taskType, data, null, gridId, viewname, gridId, gridId);
        else
			//TECH-35056
            //RamcoRTC.doMLTransaction(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId, start, end, viewname);
			  RamcoRTC.doMLTransaction(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId, start, end, viewname, metaViewName);
    },
    onWizardMLTrans: function(v, data, task, taskType, gridId, viewname, direction, start, end, wizBtns) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        me.setWizBtns(wizBtns);
        RamcoRTC.doWizardTransactions(me.onRequestComplete, me.onRequestException, me, me.getCurrentView().ilboConfig || {}, task, taskType, data, null, gridId, viewname, (v.ilboConfig.tabName == "wizard1") ? "" : gridId, (v.ilboConfig.tabName == "wizard1") ? "" : gridId, end);
    },
    onWizardStepTrans: function(v, data, task, taskType, gridId, wizBtns, prevBtn) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doWizardStepTransactions(me.onRequestComplete, me.onRequestException, me, me.getCurrentView().ilboConfig || {}, task, taskType, data, gridId, wizBtns, prevBtn);
    },
    onSubmit: function(v, data, task, taskType) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, null);
    },
    onMoveToRow: function(v, data, task, taskType, gridId, start, end, vsi, keyNav) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doMLTransaction(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'tskstdmovetorow', taskType, data, gridId, start, end, '', vsi, keyNav);
    },
    onGridToolAction: function(v, data, task, taskType, gridId, start, end, viewname) {
        var me = this,
			curViewOrHelp = me.getCurrentHelp() || me.getCurrentView(),
			controller = curViewOrHelp.getController();
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
		if (task == 'export' || task == 'exportpdf' || task == 'exportcsv' || task == 'exporthtml' || task == 'importexcel' 
			|| task == 'validatefile' || task == 'importcsv' || task == 'importtext' || task == 'exportreport' || task == 'exportchart') {			
			var gridActionCallBack = function() {
				//controller.taskPending = true;
		        if (task == 'export') {
		            RamcoRTC.doExport(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId, start, end);
		            me.mask(false);
		        } else if (task == 'exportpdf') {
		            RamcoRTC.doPDFExport(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'save', taskType, data, gridId, start, end);
		            me.mask(false);
		        } else if (task == 'exportcsv') {
		            RamcoRTC.doCSVExport(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'save', taskType, data, gridId, start, end);
		            me.mask(false);
		        } else if (task == 'exporthtml') {
		            RamcoRTC.doHtmlExport(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'save', taskType, data, gridId, start, end);
		            me.mask(false);
		        } else if (task == 'importexcel') {
		            RamcoRTC.doImport(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'save', taskType, data, gridId, start, end);
				//TECH-38234
				//me.mask(false);
		        } else if (task == 'validatefile') {
		            RamcoRTC.doValidateFile(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'save', taskType, data, gridId, start, end);
		        } else if (task == 'importcsv' || task == 'importtext') {
		            RamcoRTC.doImportCSV(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'save', taskType, data, gridId, start, end);
	            	//TECH-38234
					//me.mask(false);
		        } else if (task == 'exportreport') {
		            RamcoRTC.doExportReport(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'save', taskType, data, gridId, start, end);
		        } else if (task == 'exportchart') {
		            RamcoRTC.doExportChart(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'save', taskType, data, gridId, start, end);
				}
				//TECH-36063
				curViewOrHelp.focusPage(true);
			};
			
			curViewOrHelp.callBack = gridActionCallBack.bind(me);
			//TECH-34198
			if(task == 'exportreport' || task == 'exportchart' || task == 'exporthtml') {
				Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R319, function(btnId) {
						if (btnId == "ok" || btnId == "yes") {
							this.mask(true);
							var	curViewOrHelp = this.getCurrentHelp() || me.getCurrentView();
							curViewOrHelp.fireEvent('trans', curViewOrHelp, [], 'tskdummy', 'trans');
						}
				},me);
			}
			else {
				this.mask(true);
				curViewOrHelp.fireEvent('trans', curViewOrHelp, [], 'tskdummy', 'trans');
			}
				
			
		}
		else {
            RamcoRTC.doMLTransaction(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId, start, end, viewname);
			controller.taskPending = false;
			return;
		}
    },
    onHelp: function(v, data, task, taskType, gridId) {
        this.mask(true);
        var me = this;
        /* DISABLING HELP TASK ON PERSONALIZATION */
        if (me.getPersonalization()) {
            Ext.RamcoMsg.alert(rvw_resources.R260, 'This action cannot be performed in Personalisation mode. Please Save/Cancel Personalisation mode and try again.');
            this.mask(false);
            if (me.getCurrentView()) {
                var controller = me.getCurrentView().getController();
                controller.taskPending = false;
            }
            return;
        }		
        me.setTaskDesc('On Help Screen');
        me.setLastTaskType(taskType);
        me.setHelpTask(task);
        RamcoRTC.doHelp(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId);
    },
    onTransfer: function(win, view, btn) {
        this.mask(true);
        var me = this,
            viewModel = view.getViewModel ? view.getViewModel() : null,
            data, task;
        if (viewModel) {
            data = viewModel.getSessionData();
        }
        if (win.pageIndex > 1) {
            if (win.ilboComponent && win.pageArr[win.ilboComponent.tempId]) {
                delete win.pageArr[win.ilboComponent.tempId];
                win.pageIndex--;
            }
            me.setLastTaskType('help');
            task = 'help';
        } /*else if (me.modalWindow.pageIndex > 0 && !me.modalWindow.isHidden()) {
            me.setLastTaskType('modal');
            task = 'modal';
        } */else {
            me.setLastTaskType('trans');
            task = 'trans';
        }
        me.setTaskDesc('On Data Transfer');
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, view.ilboConfig || {}, 'transfer', task, data, null);
    },
    onSavePers: function(v, data, task, taskType, gridId) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doSavePersonalization(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId);
    },
    onRemovePers: function(v, data, task, taskType, gridId) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doRemovePersonalization(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, data, gridId);
    },
    onColumnChoose: function(v, task, taskType, gridId, data) {
        this.mask(true);
        var me = this,persData = me.getPersData(),currViewOrHelp = me.getCurrentHelp() || me.getCurrentView();
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
		//TECH-31711
		if(task == 'SAVEDOC' && persData && persData[RamcoRTC.currentTemplate] && !Ext.isEmpty(persData[RamcoRTC.currentTemplate]['data'])){
			for (var persVal in  persData[RamcoRTC.currentTemplate]['data']){
				if(persData[RamcoRTC.currentTemplate]['data'][persVal]['type'] == 'grid')
					continue;
				var persCtrl = currViewOrHelp.down('#'+persVal);
				if(persCtrl.xtype == "button" || persCtrl.xtype == "link" || persCtrl.xtype == "ramcopanel")
					persData[RamcoRTC.currentTemplate].data[persVal]['ctrlType'] = 'LayoutControl';
				else if(persCtrl.xtype == "tabpanel")
					persData[RamcoRTC.currentTemplate].data[persVal]['ctrlType'] = 'TabControl';
				else if(persCtrl.xtype != "ramcogrid"){
					if(persCtrl.dataType == "integer")
						persData[RamcoRTC.currentTemplate].data[persVal]['dataType'] = 'vwisnumeric';	
					else
						persData[RamcoRTC.currentTemplate].data[persVal]['dataType'] = 'vwisnullorempty';	
					persData[RamcoRTC.currentTemplate].data[persVal]['ctrlType'] = 'Control';
				}
				data[RamcoRTC.currentTemplate]['data'][persVal] = persData[RamcoRTC.currentTemplate]['data'][persVal];
			}
		}else if(task == 'GETDOC')
				me.columnPers = true;
		
		
        RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, gridId, data);
    },
	// TECH-28159 / TECH-26959
	// onMultiSort: function(v, task, taskType, gridId, data) {
	onMultiSort: function(v, task, taskType, gridId, data, sortState) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
		// TECH-28159 / TECH-26959
        // RamcoRTC.doMultiSort(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, gridId, data);
		RamcoRTC.doMultiSort(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, gridId, data, sortState);
    },
	onPersGetDoc: function(v, task, taskType) {
		this.mask(true);
        var me = this;
		me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
		RamcoRTC.doAsyncCall(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'GETDOC', 'trans');
	},
    onColumnDefaultSave: function(v, data, task, taskType, gridId, colstatus) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doColumnSaveDefaults(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, gridId, data, colstatus);
    },
    onColumnDefaultClear: function(v, data, task, taskType, gridId, colstatus) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doColumnClearDefaults(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, gridId, data, colstatus);
    },
	onColumnFilterSave: function(v, data, task, taskType, gridId, colstatus) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doColumnFilter(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, gridId, data, colstatus);
    },
    onColumnFilterClear: function(v, data, task, taskType, gridId, colstatus) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Trans Screen');
        me.setLastTaskType(taskType);
        RamcoRTC.doColumnClearFilter(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, gridId, data, colstatus);
    },
    onError: function(view, errors) {
        var me = this,
			statusBar = me.getStatusBar(), // TECH-37822
            btnErrorState = me.getBtnErrorState(),
            count = errors.length;
        if (btnErrorState) {
			btnErrorState.suspendLayouts();
            if (count <= 0) {
                btnErrorState.setIconCls('');
                btnErrorState.setText(rvw_resources.R211);
                btnErrorState.setDisabled(true);
                btnErrorState.setMenu(null, true);
            } else {
                btnErrorState.btnIconEl.setStyle('color', '#ff0000');
                btnErrorState.setIconCls('x-fa fa-exclamation');
                btnErrorState.setText(count + " " + rvw_resources.R088);
                btnErrorState.setDisabled(false);
                btnErrorState.setMenu(errors.getRange(), true);
            }
			btnErrorState.resumeLayouts();
			// TECH-38146
			//statusBar.updateLayout(true); // TECH-37822			
        }
    },
	onMenuListData: function(v, data, value) {
		if (this.menuTaskPending == true)
			return;
		//this.mask(true);
        var me = this;
        me.setTaskDesc('Custom List Edit Data');
        me.setLastTaskType('async');        
		//RamcoRTC.doGetCustomListData(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'getcustlistdata', '', ctrlId, ctrlView, value, searchId, searchContext, targetCtrl, row, stVal);
		me.menuTaskPending = true;
		RamcoRTC.doAvnMenuSearch(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, value);
        //me.mask(false);  
	},
	onMenuNavigationData: function(v, data, ctrlId, ctrlView, value, searchId, searchContext, targetCtrl, row, stVal) {
		//this.mask(true);
        var me = this;
        me.setTaskDesc('Menu List Navigation Data');
        me.setLastTaskType('async');        
		RamcoRTC.doGetMenuNavigationData(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'getmenunavigationdata', '', ctrlId, ctrlView, value, searchId, searchContext, targetCtrl, row, stVal);
        //me.mask(false);
	},
	onCustomListData: function(v, data, ctrlId, ctrlView, value, searchId, searchContext, targetCtrl, row, stVal) {
        //this.mask(true);
        var me = this;
        me.setTaskDesc('Custom List Edit Data');
        me.setLastTaskType('async');        
		RamcoLog.clear();
		RamcoRTC.doGetCustomListData(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'getcustlistdata', '', ctrlId, ctrlView, value, searchId, searchContext, targetCtrl, row, stVal);
        //me.mask(false);
    },
    onListData: function(v, data, ctrlId, ctrlView, value, searchView, listView, targetCtrl, row) {
        //this.mask(true);
        var me = this;
        me.setTaskDesc('List Edit Data');
        me.setLastTaskType('async');
		RamcoLog.clear();
        RamcoRTC.doGetListData(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'getlistdata', '', ctrlId, ctrlView, value, searchView, listView, targetCtrl, row);
        //me.mask(false);
    },
	onGridData: function(v, ctrlId) {
        //this.mask(true);
        var me = this;
        me.setTaskDesc('Get Grid Full Data');
        me.setLastTaskType('async');
        RamcoRTC.doGetGridData(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, ctrlId);
        //me.mask(false);
    },
    onFileUpload: function(v, data, task, taskType, ctrlId) {
        this.mask(true);
        var me = this,
            fileName = data.fileName || data.file.name || data.file.fileName || '',
			fileExt = '';
        me.setTaskDesc('File Upload');
        me.setLastTaskType(taskType);
		me.fileExt =  fileName.slice(fileName.lastIndexOf("."));
		fileName = fileName.substring(0, fileName.lastIndexOf(me.fileExt));
        //fileName = fileName.split('.');
        //data.fileName = RamcoRTC.userInfo.n + '_' + RamcoRTC.userInfo.r + '_' + RamcoRTC.userInfo.ou + '_' + new Date().getTime() + "." + fileName[fileName.length - 1];		
		data.fileName = fileName + me.fileExt;		
		if(data.autoFileName === true)
			data.fileName = RamcoRTC.userInfo.n + '_' + RamcoRTC.userInfo.r + '_' + RamcoRTC.userInfo.ou + '_' + new Date().getTime() + me.fileExt;
        RamcoRTC.doUpload(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'upload', taskType, data, ctrlId);
    },
    onFileDelete: function(v, task, taskType, ctrlId, viewId, row, srcPath, assView, dView) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('File Delete');
        me.setLastTaskType(taskType);
        RamcoRTC.doDelete(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'upload', taskType, ctrlId, viewId, row, srcPath, assView, dView);
    },
	onAvnActionCustom: function(v, task, taskType, role) {
		this.mask(true);
        var me = this;
        me.setTaskDesc('avncustomaction');
        me.setLastTaskType(taskType);
        RamcoRTC.getAvnCustomAction(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, task, taskType, role);
	},
    onSearch: function(v, data, task, taskType, ctrlId, searchBy, searchValue) {
        this.mask(true);
        var me = this;
        me.setTaskDesc('Grid Search');
        me.setLastTaskType(taskType);
        RamcoRTC.doSearch(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, 'search', taskType, data, ctrlId, searchBy, searchValue);
        //me.mask(false);
    },
    onCheckChange: function(item, checked, eOpts) {
        var me = this,
            menu = item.up('menu');
        if (!menu.changedArray)
            menu.changedArray = {};
        menu.changedArray[item.catname] = item;
    },
    onRoleCheckChange: function(item, checked, eOpts) {
        var me = this,
            checkedStatus,
            menu = item.up('menu');
        if (item.itemId == 'allroles' || item.itemId == 'alltasks') {
            for (i = 0; i < menu.items.items.length; i++) {
                if (checked) {
                    if (menu.items.items[i].itemId == 'allroles' || menu.items.items[i].itemId == 'alltasks')
                        menu.items.items[i].setChecked(true);
                    else
                        menu.items.items[i].setChecked(false);
                }
            }
        } else {
            if (checked && menu.items.items[0].checked == true)
                menu.items.items[0].setChecked(false);
        }
        checkedStatus = menu.down('menucheckitem[checked=true]');
        if (Ext.isEmpty(checkedStatus))
            menu.items.items[0].setChecked(true);

    },
    onFavMenu: function(btn) {
        var menuitems, i, me = this,
            itm,
            view = me.getCurrentView();
        if (btn.menu && btn.menu.changedArray) {
            menuitems = btn.menu.changedArray;
            RamcoRTC.doFavChange(me.onRequestComplete, me.onRequestException, me, view.ilboConfig || {}, 'save_favorites', 'favchange', [menuitems, (view.ilboConfig || {})]);
        }else{
			RamcoRTC.isFavActMenu = false;
		}
    },
	// TECH-28716
	onWorkAreaButtonClick: function(btn, e, eOpts) {
		try {
			var me = this,
				currentView = me.getCurrentView(),
				itemId = btn.getItemId(),
				btnWorkAreaStyle = me.getBtnWorkAreaStyle(),
				btnObj = null, btnCtrls, btnVal, data = null,
				objMainMenu = btn.getMenu() || null;
			if (itemId == 'itmWorkAreaStyle') {
				if (Ext.isEmpty(objMainMenu)) {
					objMainMenu = Ext.create('Ext.menu.Menu', {
						items: [{
							itemId: 'New Work Area',
							key: 'New Work Area',
							text: rvw_resources.R197,
							group: 'areaMenu',
							hidden: (RamcoRTC.settings.hideWorkArea) ? true : false,
							role: 'workarea'
						},{
							itemId: 'Default Window',
							key: 'Default Window',
							text: rvw_resources.R179,
							hidden: true,
							group: 'areaMenu',
							role: 'default',
							checked: true
						},{
							itemId: 'Wizard',
							key: 'Wizard',
							text: rvw_resources.R198,
							group: 'areaMenu',
							hidden: (!RamcoRTC.settings.enableWizard || (RamcoRTC.settings.enableWizard && (RamcoRTC.settings.hideWizard && RamcoRTC.settings.hideInbox && RamcoRTC.settings.hideFavorites && RamcoRTC.settings.hideMenuMap && RamcoRTC.settings.hideMenuTag))) ? true : false,
							role: 'workarea'
						}]
					});
					btn.setMenu(objMainMenu);
					btn.showMenu();
				}
				btn.show();
			}
			else {
				btnObj = btn.up('[itemId="btnWorkAreaStyle"]');
				btnCtrls = btnObj && btnObj.items;
				for (var i = 1; btnCtrls && btnCtrls.length > 1 && i < btnCtrls.length; i++) {
					btnVal = btnCtrls.getAt(i);
					if (!Ext.isEmpty(btnVal)) {
						if (btnVal.hasCls('actworkarea')) {
							btnVal.removeCls('actworkarea');
						}
						btnVal.isActive = false;
					}
				}
				btn.addCls('actworkarea');
				btn.isActive = true;
				
				if (!Ext.isEmpty(currentView) && currentView.ilboConfig) {
					currInstance = RamcoRTC.currentInstance || 'default';
					currInstance = btnWorkAreaStyle.down('#' + currInstance);
					currInstance.ilboConfig = currentView.ilboConfig;
					currInstance.lastUrl = me.getLastUrl();
					data = currentView.getSessionData();
				} else {
					currentView = {};
					currentView.ilboConfig = {
						componentName: 'security',
						activityName: 'homepage',
						ilboName: 'homepage'
					}
				}
				me.mask(true);
				RamcoRTC.doCreateInstance(me.onRequestComplete, me.onRequestException, me, currentView && currentView.ilboConfig || {}, data);
				RamcoRTC.currentInstance = itemId || 'default';
			}
		}
		catch(ex){ console.log('onWorkAreaButtonClick Exception is ' + ex); }
	},
	// TECH-37478
	onRemoveInlineReport: function() {
		var me = this;
		me.mask(true);
		var ilboView = me.getIlboView();
		Ext.destroy(ilboView.remove(me.inlineReportPanel));
		delete RamcoRTC.inlineReportLaunched;
		me.setPreReportIlboText(null);
		
		var btnPreference = me.getBtnPreference(),
			btnDefaultMode = me.getBtnDefaultMode(),
			btnTrailBar = me.getTrailBar(),
			btnHelp = me.getBtnHelp(),
			btnPrintBar = me.getBtnPrintBar(),
			btnRefresh = me.getBtnRefresh(), // TECH-40504
			getFav = me.getGetFav();
		
		if (btnPreference.inlineHide == true) {
			btnPreference.show();
			delete btnPreference.inlineHide;
		}
		
		if (btnDefaultMode.inlineHide == true) {
			btnDefaultMode.show();
			delete btnDefaultMode.inlineHide;
		}
		
		if (btnPrintBar.inlineHide == true) {
			btnPrintBar.show();
			delete btnPrintBar.inlineHide;
		}
		
		if (btnTrailBar.inlineHide == true) {
			btnTrailBar.show();
			delete btnTrailBar.inlineHide;
		}
		
		if (btnHelp.inlineHide == true) {
			btnHelp.show();
			delete btnHelp.inlineHide;
		}
		
		// TECH-40504
		if (btnRefresh.inlineHide == true) {
			btnRefresh.show();
			delete btnRefresh.inlineHide;
		}
		
		if (getFav.inlineHide == true) {
			getFav.show();
			delete getFav.inlineHide;
		}
	},
    onButtonClick: function(btn, e, eOpts) {
        var me = this,
            className = null,
            url = null,
            currentView = me.getCurrentView() || {},
            currentHelp = me.getCurrentHelp(),
			currViewOrHelp = currentHelp || currentView,//TECH-30301
            mainView = me.getMainView(),
            itemId = btn.getItemId(),
            tBar = btn.up('toolbar'),
            btnPref = null,
            btnDefault = me.getBtnMenuDefault(),
            data = '', workArea, ilbo; // , controller, // TECH-28159 / TECH-26959 / TECH-29276 / TECH-29531
            viewModel = null,
            viewData = '',
            menuTools = null,
            cmbTemplate = me.getCmbTemplate(),
            txtTemplate = me.getTxtTemplate(),
			chkTemplate = me.getChkTemplate(), // DefMode
            sectionVal = [];
        /*if(currentView && currentView.hasModified() && !me.proceed){
        	Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R257,function(btnId){
        		if(btnId == "ok" || btnId == "yes"){
        			me.proceed = true;
        			me.onButtonClick(btn, e, eOpts);
        		}
        	});
        	return true;
        }*/
        if (currentView && currentView.getSessionData) {
            data = currentView.getSessionData();
            viewModel = currentView.getViewModel();
            viewData = viewModel ? viewModel.getData() : '';
        }
        me.proceed = false;
        if (itemId == 'btnHome') {
			// TECH-37478
			if(RamcoRTC.inlineReportLaunched == true) {
				me.onRemoveInlineReport();
				RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, { componentName: 'security', activityName: 'homepage', ilboName: 'homepage' }, '');
				return;
			}
			else if (currentView && currentView.hasModified()) {
				Ext.RamcoMsg.confirm(rvw_resources.R111, rvw_resources.R259, function(btnId) {
					if (btnId == "ok" || btnId == "yes") {
						me.mask(true);						
						me.launchHomeScreen();
						return;
					}
				});
				return;
			}
			me.launchHomeScreen();
        } 
		else if (itemId == "btnCancel") {
            me.mask(true);
			if(RamcoRTC.isProto) {
				var trBar = me.getTrailBar();
				var trialBarMenu = trBar.getMenu();
				var prvItem, prvURL;
				if (trialBarMenu)
					trailbarLen = trialBarMenu.items.length;				
				prvItem = trialBarMenu.items.getAt(trailbarLen - 2);
				if(prvItem) {
					prvURL = prvItem.cName + "/" + prvItem.actName + "_" + prvItem.ilboName;				
					trialBarMenu.items.items.pop();
					RamcoRTC.protoTrailBar.pop();
				}
				else {
					me.mask(false);
					return true;
				}
			}
			if(RamcoRTC.inlineReportLaunched == true) {
				// TECH-37478
				me.mask(true);
				var ilboConfig = { activityName: 'homepage', ilboName: 'homepage', compName: 'security' };
				RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, ilboConfig, 'tskstdcancel', 'trans', null, null);
				return;
				/* var mainView = me.getMainView(),
					inlineReport = mainView.down('#rptInline'),
					ilboView = me.getIlboView(),
					ilboTitle = me.getIlboTitle(),
					txtBpcIlboTitle = me.getTxtBpcIlboTitle();
				if (inlineReport && ilboView) {
					ilboTitle.setText(me.getPreReportIlboText());
					if (txtBpcIlboTitle)
						txtBpcIlboTitle.setText(me.getPreReportIlboText());
					me.setPreReportIlboText(null);
					//ilboView.setActiveItem(currentView);
					//Ext.destroy(ilboView.remove(inlineReport));
					Ext.destroy(ilboView.remove(me.inlineReportPanel));
					ilboView.add(me.reportPreView);
					delete RamcoRTC.inlineReportLaunched;
					me.mask(false);
					return;
				} */
			}
			else {
				me.setTaskDesc('On Cancel');
				me.setLastTaskType('trans');
				// TECH-28159 / TECH-26959
				workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
				ilbo = currentView.ilboConfig.ilboName;
				// TECH-29276
				
				/*if(RamcoRTC.multiSortGridData[workArea] && RamcoRTC.multiSortGridData[workArea][ilbo])
					getMainController().resetGridMultiSort(workArea, ilbo);
				// TECH-28276
				if(RamcoRTC.dstRequired[workArea][ilbo])
					delete RamcoRTC.dstRequired[workArea][ilbo];*/
				// TECH-29531
				// controller = getMainController();

				/* if(controller.multiSortGridData[workArea] && controller.multiSortGridData[workArea][ilbo])
					controller.resetGridMultiSort(workArea, ilbo);

				if(controller.dstRequired[workArea] && controller.dstRequired[workArea][ilbo])
					delete controller.dstRequired[workArea][ilbo];*/

				if(me.multiSortGridData[workArea] && me.multiSortGridData[workArea][ilbo])
					me.resetGridMultiSort(workArea, ilbo);

				if(me.dstRequired[workArea] && me.dstRequired[workArea][ilbo])
					delete me.dstRequired[workArea][ilbo];

				RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdcancel', 'trans', null, null);
			}         
        } else if (btn.accesskey) {
            btns = currentView.down('button[accesskey="' + btn.accesskey + '"]');
            btns.focus();
        } else if (itemId == "btnLaunchDW") {
            RamcoRTC.doDWLaunchUI(me.onRequestComplete, me.onRequestException, me, {}, '', '', null, null);
        } else if (itemId == "btnPrintBar") {
            secVal = me.onScreenReqExport(currentView, viewData);
            data = currentView.getSessionData();
            RamcoRTC.doDummyTask(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, data);
            Ext.defer(function() {
                RamcoRTC.doPrintExport(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'save', 'printexport', secVal, null);
            }, 500, me);
        } else if (itemId == "btnRefresh") {
            this.mask(true);
            if (currentView) {
				// TECH-34273
                var me = this,
					workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default",
					ilboName = currentView.ilboConfig && currentView.ilboConfig.ilboName; // TECH-40504
				if (ilboName)
					me.resetGridMultiSort(workArea, ilboName);
                me.setPersonalization(false);
                me.setDefaultTemplate(false);
                txtTemplate.hide();
                cmbTemplate.hide();
				chkTemplate.hide(); // DefMode
				me.setLastTaskType('trans');
				Ext.asap(function() {
					var me = this,
						ilboView = me.getIlboView(),
            			currentView = me.getCurrentView(); 
					if(currentView){
						ilboView.suspendLayouts();
						Ext.destroy(ilboView.remove(currentView));
						ilboView.resumeLayouts();
					}
                    me.setCurrentView(null);
				},me);
            }
            RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentView && currentView.ilboConfig || {}, 'tskstdrefresh', 'trans', null, null); // TECH-40504
        } 
		else if (itemId == "btnSmartBar") {
			if (!currentView || !currentView.smartBar)
                return;
			var smartBarGrid , 
				rowCnt,				
				curViewValue,
				tplValue,
				tplData = '',
				r = 0,
				smartBar = me.getBtnSmartBar();			
			//smartBarGrid = currentView.queryById(currentView.smartBar.itemId);
			smartBarGrid = RamcoRTC.reader.uiCtrlArray[currentView.ilboConfig.ilboName][currentView.smartBar.itemId].value;
			//rowCnt = smartBarGrid.store.count();
			rowCnt = smartBarGrid.store.length;
			for(; r < rowCnt; r++) {
				//curViewValue = smartBarGrid.getViewValue(currentView.smartBar.viewName, r);
				curViewValue = smartBarGrid.store[r]["v" + currentView.smartBar.viewName];
				if (Ext.isString(curViewValue) && (curViewValue.indexOf('{') == 0 || curViewValue.indexOf('[') == 0)) {
					tmpValue = curViewValue ? Ext.decode(curViewValue, true) : '';
					tempid = tmpValue ? tmpValue.tplid : rowExCfg.tplId;
					if (tempid) {
						xTpl = currentView.getTemplate(tempid);
						if (xTpl && xTpl.isTemplate)
							tplValue = xTpl.apply(tmpValue);
					}
					tplData += tplValue;
				}
			}
			me.smartWindow.curView = currentView;
			// TECH-40742
			me.smartWindow.setHtml(tplData);
			//me.smartWindow.html = tplData;
			me.smartWindow.showBy(smartBar, 'tl-bl?');			
		}
		else if (itemId == "reactivateTime") {
			// TECH-33556
			var ilboConfig = {};
            if (!currentView || !currentView.ilboConfig)
				ilboConfig = { componentName: 'security', activityName: 'homepage', ilboName: 'homepage' };
			else
				ilboConfig = currentView.ilboConfig;
            this.mask(true);
            RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, ilboConfig, 'tskdummy', 'trans', null, null);
        } else if (itemId == "signout") {
            this.mask(true);

        } else if (itemId == "userinfo") {
            this.mask(true);
        } else if (itemId == "btnTemplate") {
			// DefMode
            //this.mask(true);
			//RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'GETDOC', 'trans');
        } else if (itemId == 'btnPreference' || itemId == 'btnHelpPreference' || itemId == 'btnModalPreference') { // TECH-40634
            if (currentView) {
                this.mask(true);
                if (!currentHelp || currentHelp.isHidden == true) {
                    btnPref = me.getBtnSave();
                    if (btnPref)
                        btnPref.show();
                    btnPref = me.getBtnClear();
                    if (btnPref)
                        btnPref.show();
                    btnPref = me.getBtnCancl();
                    if (btnPref)
                        btnPref.show();
                    btnPref = me.getBtnPrintBar();
                    if (btnPref)
                        btnPref.hide();
					
					// TECH-32027
					btnPref = me.getBtnPreference();
					if (btnPref)
						btnPref.show();
					btnPref = me.getBtnDefaultMode();
					if (btnPref)
						btnPref.show();
                } else {
                    menuTools = btn.up();
					// TECH-40634
					if (itemId == 'btnModalPreference') {
						btnPref = menuTools.down('#btnModalSave');
						if (btnPref)
							btnPref.show();
						btnPref = menuTools.down('#btnModalClear');
						if (btnPref)
							btnPref.show();
						btnPref = menuTools.down('#btnModalCancl');
						if (btnPref)
							btnPref.show();
					}
					else {
						btnPref = menuTools.down('#btnHelpSave');
						if (btnPref)
							btnPref.show();
						btnPref = menuTools.down('#btnHelpClear');
						if (btnPref)
							btnPref.show();
						btnPref = menuTools.down('#btnHelpCancl');
						if (btnPref)
							btnPref.show();
					}                    
                }
                url = me.getLastUrl();
                if (!me.getPersonalization())
                    me.setPersonalization(true);
                else
                    me.setPersonalization(false);
                me.setDefaultTemplate(false);
                txtTemplate.hide();
                cmbTemplate.hide();
				chkTemplate.hide(); // DefMode
                RamcoRTC.currentTemplate = 'default';
                // TECH-33523 / SDC-56
				var persCallBack = function() {
					className = me.convertUrlToPage(url);
					me.loadPage(className);
					me.setLastUrl(url);
					mainView.callBack =true;
					return;
				};
				currentView.callBack = persCallBack.bind(me);
				RamcoRTC.doDummyTask(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, currentView.getSessionData() || []);
			}
        } else if (itemId == 'btnDefaultMode') {
            if (currentView) {
                this.mask(true);
                btnPref = me.getBtnSave();
                if (btnPref)
                    btnPref.show();
                btnPref = me.getBtnClear();
                if (btnPref)
                    btnPref.show();
                btnPref = me.getBtnCancl();
                if (btnPref)
                    btnPref.show();
                btnPref = me.getBtnPrintBar();
				btnPref.hide();
				
				// TECH-32027
				btnPref = me.getBtnPreference();
                if (btnPref)
                    btnPref.show();
				btnPref = me.getBtnDefaultMode();
				if (btnPref)
					btnPref.show();
				
				// DefMode
				btnPref = me.getBtnTemplate();
				if (btnPref)
					btnPref.hide();
                cmbTemplate.show();
                //txtTemplate.show();
				chkTemplate.show();
                me.setDefaultTemplate(true);
                /* CLEARING PERSONALIZATION MODE */
                me.setPersonalization(false);
				url = me.getLastUrl();
                className = me.convertUrlToPage(url);
                me.loadPage(className);
                me.setLastUrl(url);
            }
        } else if (itemId == 'btnSave' || itemId == 'btnHelpSave' || itemId == 'btnModalSave') { // TECH-40634
            if (currentView) {
                var me = this,
                    persData = me.getPersData();
                me.mask(true);
                if (!currentHelp || currentHelp.isHidden == true) {
                    btnPref = me.getBtnSave();
                    if (btnPref)
                        btnPref.hide();
                    btnPref = me.getBtnClear();
                    if (btnPref)
                        btnPref.hide();
                    btnPref = me.getBtnCancl();
                    if (btnPref)
                        btnPref.hide();
                    btnPref = me.getBtnPrintBar();
                    //if (currentView.hidePrint == true || RamcoRTC.settings.hidePrintButton == true || (btnPref && !Ext.Object.isEmpty(currentView.templatesJson) && currentView.templateFile))
                    if (currentView.hidePrint == false)
						btnPref.show();
					else
						btnPref.hide();
                } else {
                    menuTools = btn.up();
					// TECH-40634
					if (itemId == 'btnModalSave') {
						btnPref = menuTools.down('#btnModalSave');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnModalClear');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnModalCancl');
						if (btnPref)
							btnPref.hide();
					}
					else {
						btnPref = menuTools.down('#btnHelpSave');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnHelpClear');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnHelpCancl');
						if (btnPref)
							btnPref.hide();
					}
                }
                
				// TECH-28978 - DefMode
				var cmbVal = cmbTemplate.getValue(),
					txtVal = txtTemplate.getValue(),
					chkVal = chkTemplate.checked,
					defData, mode;
                
				txtTemplate.hide();
                cmbTemplate.hide();
				chkTemplate.hide();
				
				// DefModeChanges
				
				txtTemplate.suspendLayouts();
				txtTemplate.setValue('');
				txtTemplate.resumeLayouts();
				
				cmbTemplate.suspendLayouts();
				cmbTemplate.setValue('');
				cmbTemplate.resumeLayouts();
				
				chkTemplate.suspendEvents();
				chkTemplate.setValue(false);
				chkTemplate.resumeEvents();
				
				btnPref = me.getBtnDefaultMode();
				if (btnPref)
					btnPref.show();
				// DefMode
				
				
				if (cmbVal == 'new' && !Ext.isEmpty(txtVal)) {
					if (chkVal) {
						// TECH-32726
						txtVal = purifyDom(txtVal);
						defData = persData[txtVal];
						if (defData && defData.data)
							defData.data.defTemp = true
					}
				}
				
				// DefMode
				if (me.getPersonalization() == true)
					mode = 'personalization';
				else if (me.getDefaultTemplate() == true)
					mode = 'defaults';
				//TECH-30301
                if (persData){
					if(mode == 'personalization'){//TECH-31711
						if(!me.persChanged)
							persData = '';
						else
							delete me.persChanged;	
					}
					RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, currViewOrHelp.ilboConfig || {}, 'SAVEDOC', mode, '', persData);
				}
                    
                else {
                    me.setPersonalization(false);
                    me.setDefaultTemplate(false);
                    me.mask(false);
                }
            }
        } else if (itemId == 'btnClear' || itemId == 'btnHelpClear' || itemId == 'btnModalClear') { // TECH-40634
            if (currentView) {
                var me = this,
                    persData = me.getPersData();
                me.mask(true);
                if (!currentHelp || currentHelp.isHidden == true) {
                    btnPref = me.getBtnSave();
                    if (btnPref)
                        btnPref.hide();
                    btnPref = me.getBtnClear();
                    if (btnPref)
                        btnPref.hide();
                    btnPref = me.getBtnCancl();
                    if (btnPref)
                        btnPref.hide();
					btnPref = me.getBtnPrintBar();
                    //if (currentView.hidePrint == true || RamcoRTC.settings.hidePrintButton == true || (btnPref && !Ext.Object.isEmpty(currentView.templatesJson) && currentView.templateFile))
                    if (currentView.hidePrint == false)
						btnPref.show();
					else
						btnPref.hide();
                } else {
                    menuTools = btn.up();
					// TECH-40634
					if (itemId == 'btnModalClear') {
						btnPref = menuTools.down('#btnModalSave');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnModalClear');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnModalCancl');
						if (btnPref)
							btnPref.hide();
					}
					else {
						btnPref = menuTools.down('#btnHelpSave');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnHelpClear');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnHelpCancl');
						if (btnPref)
							btnPref.hide();
					}
                }
                txtTemplate.hide();
                cmbTemplate.hide();
				chkTemplate.hide(); // DefMode
				
				// DefModeChanges
				
				txtTemplate.suspendLayouts();
				txtTemplate.setValue('');
				txtTemplate.resumeLayouts();
				
				cmbTemplate.suspendLayouts();
				cmbTemplate.setValue('');
				cmbTemplate.resumeLayouts();
				
				chkTemplate.suspendEvents();
				chkTemplate.setValue(false);
				chkTemplate.resumeEvents();
				//TECH-30301
                RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, currViewOrHelp.ilboConfig || {}, 'SAVEDOC', 'personalization', '', []);
            }
        } else if (itemId == 'btnCancl' || itemId == 'btnHelpCancl' || itemId == 'btnModalCancl') { // TECH-40634
            if (currentView) {
				// DefMode
                var me = this,
					persData = me.getPersData();
                me.mask(true);
                if (!currentHelp || currentHelp.isHidden == true) {
                    btnPref = me.getBtnSave();
                    if (btnPref)
                        btnPref.hide();
                    btnPref = me.getBtnClear();
                    if (btnPref)
                        btnPref.hide();
                    btnPref = me.getBtnCancl();
                    if (btnPref)
                        btnPref.hide();
                    btnPref = me.getBtnPrintBar();
					//if (currentView.hidePrint == true || currentView.hidePrint == true || RamcoRTC.settings.hidePrintButton == true || (btnPref && !Ext.Object.isEmpty(currentView.templatesJson) && currentView.templateFile))
					if (currentView.hidePrint == false)
						btnPref.show();
					else
						btnPref.hide();
					btnPref = me.getBtnDefaultMode();
                    if (btnPref)
                        btnPref.show();
                } else {
                    menuTools = btn.up();
					// TECH-40634
					if (itemId == 'btnModalCancl') {
						btnPref = menuTools.down('#btnModalSave');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnModalClear');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnModalCancl');
						if (btnPref)
							btnPref.hide();
					}
					else {
						btnPref = menuTools.down('#btnHelpSave');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnHelpClear');
						if (btnPref)
							btnPref.hide();
						btnPref = menuTools.down('#btnHelpCancl');
						if (btnPref)
							btnPref.hide();
					}
                }
                txtTemplate.hide();
                cmbTemplate.hide();
				chkTemplate.hide(); // DefMode
				
				// DefModeChanges
				
				txtTemplate.suspendLayouts();
				txtTemplate.setValue('');
				txtTemplate.resumeLayouts();
				
				cmbTemplate.suspendLayouts();
				cmbTemplate.setValue('');
				cmbTemplate.resumeLayouts();
				
				chkTemplate.suspendEvents();
				chkTemplate.setValue(false);
				chkTemplate.resumeEvents();
				
                me.setPersonalization(false);
                me.setDefaultTemplate(false);
				// DefMode
				//if (!Ext.isEmpty(persData)) {
					//RamcoRTC.doColumnPersonalization(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'SAVEDOC', 'personalization', '', persData);
					url = me.getLastUrl();
					className = me.convertUrlToPage(url);
					me.loadPage(className);
					me.setLastUrl(url);
				//}
            }
        } 
		else if (itemId == "btnHelp") {
            if (currentView && currentView.ilboConfig) {
				var prefPathUrl = (RamcoRTC.settings.onLineHelpUriPrefix) ? RamcoRTC.settings.onLineHelpUriPrefix : "../";
				// TECH-29799 //TECH-31606
                if(RamcoRTC.osType == "JAVA")
					url = prefPathUrl + "rvwhelp/" + currentView.ilboConfig.componentName + '/' + RamcoRTC.lang + '/' +'Hlp' + currentView.ilboConfig.activityName.toLowerCase() + '_' + currentView.ilboConfig.ilboName + '_' + RamcoRTC.lang + '.htm';
				else
                url = prefPathUrl + currentView.ilboConfig.componentName + '/help/hlp' + currentView.ilboConfig.activityName + '_' + currentView.ilboConfig.ilboName + '.htm';
                if (RamcoRTC.iEDK == 1 && RamcoRTC.settings.iEdkOnlineHelpPath === true)
                    url = "../iEDK/" + RamcoRTC.segmentName + "/" + currentView.ilboConfig.componentName + "/Client/help/hlp" + currentView.ilboConfig.activityName + "_" + currentView.ilboConfig.ilboName + '.htm';
                if (currentView.ilboConfig.ilboType == 2 && RamcoRTC.settings.EdkOnlineHelpUriPrefix)
                    url = RamcoRTC.settings.EdkOnlineHelpUriPrefix + currentView.ilboConfig.componentName + "/Client/help/hlp" + currentView.ilboConfig.activityName + "_" + currentView.ilboConfig.ilboName + '.htm';
                if (RamcoRTC.lang != "1")
                    url += "_" + RamcoRTC.lang;
                openWindow(url);
            }
        } else if (itemId == "btnInbox") {
			// TECH-31733
            me.showEzWizard(0);
        } else if (itemId == "btnFavorites") {
            // To BE REVIEWED
			if (RamcoRTC.settings.enableFavoritesMenu) {
				stopTimer =  Ext.TaskManager.start({//TECH-28231
					run: function() {
						if(!RamcoRTC.isFavActMenu) {
							delete RamcoRTC.isFavActMenu;
							Ext.TaskManager.stop(stopTimer);
							//if (me.getFavsMenu().length == 0) {//TECH-28231
			                me.mask(true);
			                RamcoRTC.getFavsAsMenu(me.onRequestComplete, me.onRequestException, me);
							//}
							/*if (me.getFavsMenu().length != 0) {
			                   var favMenuShow = arguments[0];
			                   favMenuShow.show();
							}*/
						}
				},interval: 10});


			}
			else {
				// TECH-31733
                me.showEzWizard(2);
            }
        } 
		else if (itemId == "btnMenuTag") {
			// TECH-31733
            me.showEzWizard(3);
        } 
		//TECH-39043
		else if (itemId == "btnNewWindow") {			
            var urlPath = "",
				pathArray = [],
				urlArray = [];
			if (window.location.href.indexOf(RamcoRTC.sessionID) > -1) {
				urlArray = window.location.href.split("/");
				for (var u=0; u < urlArray.length; u++) {
					if(urlArray[u].indexOf(RamcoRTC.sessionID) > - 1) {
						break;
					}
					pathArray.push(urlArray[u]);
				}
				urlPath = pathArray.join("/");				
				window.open(urlPath, "_blank", 'height=' + (screen.availHeight - 70) + ',width=' + (screen.availWidth - 10) + ',toolbar=0,location=0,menubar=0,resizable=yes,scrollbars=yes');
			}
        } 
		else if (itemId == "btnMenuMap") {
			// TECH-31733
            me.showEzWizard(4);
        } 
		else if (itemId == "recentMenu") {
            RamcoRTC.getRecentMenu(me.onRequestComplete, me.onRequestException, me);
        } 
		else if (itemId == "txtIlboTitle") {
			if (currentView) {
				currentView.onContextmenu(e, btn, eOpts, true);
			}
        } 
		else if (itemId == "compactMenu") {
			var com = me.getBtnComponent(),
				act = me.getBtnActivity(),
				comMenu,
				actMenu,
				comMenuItems = [],
				actMenuItems = [],
				allMenu = [];
			if (com) {
				comMenu = com.getMenu();
				if (comMenu) {
					comMenuItems = comMenu.config.items;
				}
			}
			if (act) {
				actMenu = act.getMenu();
				if (actMenu) {
					actMenuItems = actMenu.config.items;
				}
			}			
			allMenu = actMenuItems.concat(comMenuItems);
			
			menu = Ext.create('Ext.menu.Menu', {
				ignoreParentClicks: true,
				items: allMenu
			});
			
			if (menu) {
				menu.showBy(btn);
			}			
        }
		else if (itemId.indexOf("wiz-step") > -1 && btn.task == "tskstdwizardlink") {
            var _data = me.getWizBtns();
            if (_data) {
                var record = _data.record;
                var _data = record.data["v5"],
                    _dataEx,
                    _btnVal = me.getWizBtns()[btn.name],
                    wizardDetails;
                _dataEx = _data.split("::#::");
                if (Ext.isEmpty(me.getWizBtns()['preItem']) && itemId == 'wiz-step-0') {

                    wizardDetails = 'segnm:' + RamcoRTC.segmentName + ',sno:' + (btn.name + 1) + ',wn:' + record.data["v1"] + ',sc:' + _dataEx[4] + ',sa:' + _dataEx[2] + ',' +
                        'si:' + _dataEx[5] + ',tc:' + _dataEx[11] + ',ta:' + _dataEx[9] + ',ti:' + _dataEx[12] + ',lnkt:' + _dataEx[6] + ',psno:1,' +
                        'actntype:savetask,actcmp:' + _dataEx[4];

                    currentView.fireEvent('wizardmltrans', currentView, currentView.getSessionData(), btn.task, 'trans', null, '1', 0, 0, wizardDetails, me.getWizBtns());

                } else {
                    currentView.fireEvent('wizardsteptrans', currentView, currentView.getSessionData(), 'getsteplaunchflag', 'trans', null, _btnVal, (me.getWizBtns()['preItem'] || 1));

                }
                me.getWizBtns()['preItem'] = itemId.substring(9, itemId.length);
				var wizBtnObj = me.getWizBtns(),
					wizActItem, ind = 0;
				if (wizBtnObj && wizBtnObj.length > 0) {
					for (; ind < wizBtnObj.length; ind++) {
						wizActItem = wizBtnObj[ind].act;
						if (!Ext.isEmpty(wizActItem)) {
							delete wizBtnObj[ind].act;
							break;
						}
					}
				}
            }
        } else if(itemId == "verify" || itemId == "sendCode" ){//TECH-35380
			me.mask(true);
			if(itemId == "verify"){
				// TECH-32726
				var panel = btn.up('panel'),passContainer,passcodeField, passcodeFieldVal;
				passContainer = panel.up('container');
				passcodeField = passContainer.down('#passcodeField');
				passcodeFieldVal = passcodeField.getValue();
				lastTask = me.getLastTask();
				passcodeFieldVal = passcodeFieldVal && purifyDom(passcodeFieldVal),data=[];
				data.push({id: "securitycode",vl: passcodeFieldVal});
				//if(!me.getIsLogin() && lastTask != 'tskstdlogin'){
				if(me.otpTask != 'tskstdlogin'){
						RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, {
						componentName: 'security',
						activityName:'login',
						activityDesc: 'Sign In',
						ilboName: 'ezelogin',
						ilboDesc: 'Sign In',
						ilboType: '1'
					}, 'tskstd2faverifycode', 'trans', data, null, null, null, null, null);
				}
				else{
				currentView.ilboConfig.eventDetails = 'verifycode';
			    RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdlogin', 'trans', data, null, null, null, null, null);
				}
			} else {
				if(currentView && currentView.ilboConfig &&  !Ext.isEmpty(currentView.ilboConfig.eventDetails))
					delete currentView.ilboConfig.eventDetails;
					RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me,{
						componentName: 'security',
						activityName:'login',
						activityDesc: 'Sign In',
						ilboName: 'ezelogin',
						ilboDesc: 'Sign In',
						ilboType: '1'
					}, 'tsksendcode', 'trans', null, null, null, null, null, null);	
			}
        }
    },
    // TECH-33537
    onScreenReqExport: function(currView, viewData) {		
        var me = this,
			tabCheck = false,
            activeTab = null,
            activeTabSec = null,
            grid,
			gridCols, 
			gridCol, 
			isAssorted = false,
            ctrl,
            label,
            persData = [],
			//curViewOrHelp,
            filSec = currView.query('container[role=fillpage]'),
            sec = currView.query('ramcopanel[role=uipage],ramcotreepanel[role=uipage]');
        for (var key in viewData) {
            if (viewData[key]['controlType'] != "RSGrid")
                persData.push(key);
            else
                persData.push(viewData[key]);
        }
		
		var cssText = '',
			linkVal,
			cssArray = document.head.querySelectorAll("link[type='text/css']");
		if (!Ext.isEmpty(cssArray)) {
			for (var cssLen = 0; cssLen < cssArray.length; cssLen++) {
				linkVal = cssArray[cssLen].href;
				cssText += '<link rel="stylesheet" type="text/css" href="' + linkVal + '">';
			}
			//cssText = encodeURIComponent(cssText);
		}
		
        xw = new XMLWriter('UTF-8');
        xw.writeStartDocument();
        xw.writeStartElement('sp');
        xw.writeStartElement('scri');
		xw.writeAttributeString("css", cssText);
        xw.writeAttributeString("c", currView.ilboConfig.activityDesc);
        xw.writeAttributeString("idpfx", "SPAN_");
        xw.writeAttributeString("cn", currView.ilboConfig.componentName);
        xw.writeAttributeString("ac", currView.ilboConfig.activityName);
        xw.writeAttributeString("ic", currView.ilboConfig.ilboName);
        xw.writeAttributeString("tc", currView.activeTabName);
        xw.writeStartElement('ci');
        if (sec && sec.length > 0) {
            for (i = 0; i < sec.length; i++) {
                tabsec = sec[i].down('tabpanel')

                //if (tabsec && tabCheck == false) {
                if (!Ext.isEmpty(tabsec) && tabsec.role != "calander") {
                    activeTab = tabsec.getActiveTab();
                    activeTabSec = activeTab.query('ramcopanel[role=uipage]');
					grid = activeTab.query('ramcogrid[role=uipage],ramcorstreegrid[role=uipage],ramcotreegrid[role=uipage]');
					
                    //tabCheck = true;
                    xw.writeStartElement("c");
                    xw.writeAttributeString("n", sec[i].itemId);
                    xw.writeAttributeString("c", "");
                    xw.writeAttributeString("st", ((sec[i].isVisible() && !sec[i].collapsed) ? "0" : "1"));
                    xw.writeEndElement();
                    for (h = 0; h < activeTabSec.length; h++) {
                        xw.writeStartElement("c");
                        xw.writeAttributeString("n", activeTabSec[h].itemId);
                        xw.writeAttributeString("c", "");
                        xw.writeAttributeString("st", ((activeTabSec[h].isVisible() && !activeTabSec[h].collapsed) ? "0" : "1"));
                        xw.writeEndElement();
                    }
                    for (j = 0; j < persData.length; j++) {
                        if (typeof persData[j] !== 'object') {
                            ctrl = activeTab.query('#' + persData[j]);
                            label = activeTab.query('#lbl' + persData[j]);
                            if (!Ext.isEmpty(ctrl)) {
                                xw.writeStartElement("c");
                                xw.writeAttributeString("n", persData[j]);
                                xw.writeAttributeString("st", (ctrl[0].isVisible() ? "0" : "1"));
                                if (ctrl[0].isAssorted == true) {
									isAssorted = true;
									xw.writeAttributeString("ct", 'RSAssorted');
									xw.writeAttributeString("tpv", ctrl[0].tplView);
								}                                
								if (isAssorted && ctrl[0].views) {
									xw.writeStartElement("vi");
									for (var key in ctrl[0].views) {
										key = key.replace('v', '');
										xw.writeStartElement("vw");
										xw.writeAttributeString("n", key);
										xw.writeEndElement();
									}
									xw.writeEndElement();
								}
								xw.writeEndElement();
                                if (!Ext.isEmpty(label)) {
                                    xw.writeStartElement("c");
                                    xw.writeAttributeString("n", "lbl" + persData[j]);
                                    xw.writeAttributeString("c", label[0].config.html);
                                    xw.writeAttributeString("st", (label[0].isVisible() ? "0" : "1"));
                                    xw.writeEndElement();
                                }
                            }
                        }
                        if (!Ext.isEmpty(grid)) {
                            for (k = 0; k < grid.length; k++) {
                                if (grid[k].itemId == persData[j].name) {
                                    xw.writeStartElement("c");
                                    xw.writeAttributeString("n", persData[j].name);
                                    xw.writeAttributeString("c", sec[i].title);
                                    //xw.writeAttributeString("ct", "RSGrid");
                                    xw.writeAttributeString("ct", grid[k].xtype);
                                    xw.writeAttributeString("sl", (!Ext.isEmpty(grid[k].showSelection)) ? grid[k].showSelection : true);
                                    xw.writeAttributeString("sr", (!Ext.isEmpty(grid[k].showRowNumber)) ? grid[k].showRowNumber : true);
									xw.writeAttributeString("sh", (!Ext.isEmpty(grid[k].showHeader)) ? grid[k].showHeader : true);
									xw.writeAttributeString("grh", grid[k].rowHeight || '');
									xw.writeAttributeString("scl", (!Ext.isEmpty(grid[k].columnLines)) ? grid[k].columnLines : true);
									xw.writeAttributeString("srl", (!Ext.isEmpty(grid[k].rowLines)) ? grid[k].rowLines : true);
									xw.writeAttributeString("grb", (!Ext.isEmpty(grid[k].reqBorder)) ? grid[k].reqBorder : true);
                                    xw.writeAttributeString("st", ((sec[i].isVisible() && !sec[i].collapsed) ? "0" : "1"));
                                    xw.writeStartElement("vi");
									
									gridCols = grid[k].getVisibleColumns();
                                    for (l = 0; l < gridCols.length; l++) {
                                        if (gridCols[l].dataIndex != "rn" && gridCols[l].dataIndex != "sel") {
											gridCol = gridCols[l];											
											if (gridCol) {
												xw.writeStartElement("vw");
												xw.writeAttributeString("n", gridCol.name);
												xw.writeAttributeString("ht", gridCol.text);
												xw.writeAttributeString("w", (gridCol.rendered) ? gridCol.getWidth() : 0);
												if (grid[k].xtype == 'ramcogrid') {
													xw.writeAttributeString("vt", persData[j].value.columnsValue[gridCol.dataIndex].vt);
													xw.writeAttributeString("dt", persData[j].value.columnsValue[gridCol.dataIndex].dt);
													xw.writeAttributeString("ml", gridCol.maxLength || "20");
													xw.writeAttributeString("dl", "");
													if (gridCol.xtype == 'ramcotemplatecolumn')
														xw.writeAttributeString("ct", 'template');
												}
												else {
													if (gridCol.isVisible())
														xw.writeAttributeString("st", "0");
													if (gridCol.xtype == 'imagecolumn' || gridCol.xtype == 'linkimagecolumn')
														xw.writeAttributeString("ct", "image");
													if ((gridCol.dataName == grid[k].treeColumn) || gridCol.xtype == 'ramcotreecolumn')
														treeTemplateCol = gridCol.name;
												}
												xw.writeEndElement();
											}
                                        }
                                    }
                                    xw.writeEndElement();
                                    xw.writeEndElement();
                                }
                            }
                        }
						
						grid = sec[i].query('horizontalview[role=uipage],verticalview[role=uipage]');
						if (!Ext.isEmpty(grid)) {
							var dataViewColIdx = '';
                            for (k = 0; k < grid.length; k++) {
								//if (grid[k].itemId == persData[j].name) {
								if (grid[k].itemId == persData[j].name || grid[k].itemId == persData[j]) {
									dataViewColIdx = grid[k].displayFields && grid[k].displayFields[0];
									dataViewColIdx = dataViewColIdx.replace('v','');
									xw.writeStartElement("c");
									xw.writeAttributeString("n", grid[k].itemId);
									xw.writeAttributeString("c", sec[i].title);
									xw.writeAttributeString("ct", "RSGrid");
									xw.writeAttributeString("or", grid[k].xtype);
									xw.writeAttributeString("wd", grid[k].getWidth());
									xw.writeAttributeString("sr", (grid[k].view && grid[k].view.curSelect ? (grid[k].view.curSelect + 1) : 1));
									xw.writeAttributeString("si", (grid[k].store && grid[k].store.vsi || grid[k].vsi));
									xw.writeAttributeString("tr", grid[k].view.nvr);
									xw.writeStartElement("vi");
									xw.writeStartElement("vw");
									xw.writeAttributeString("n", dataViewColIdx);
									xw.writeEndElement();
									xw.writeEndElement();
									xw.writeEndElement();
								}
                            }
                        }
                    }
                }
				//else if (tabCheck == false) {
				else {
                    xw.writeStartElement("c");
                    xw.writeAttributeString("n", sec[i].itemId);
                    xw.writeAttributeString("c", "");
                    xw.writeAttributeString("st", ((sec[i].isVisible() && !sec[i].collapsed) ? "0" : "1"));
					if (sec[i].xtype == 'ramcotreepanel')
						xw.writeAttributeString("ct", sec[i].xtype);
                    xw.writeEndElement();
					
                    for (j = 0; j < persData.length; j++) {
                        if (typeof persData[j] !== 'object') {
                            ctrl = sec[i].query('#' + persData[j]);
                            label = sec[i].query('#lbl' + persData[j]);
                            if (!Ext.isEmpty(ctrl)) {
                                xw.writeStartElement("c");
                                xw.writeAttributeString("n", persData[j]);
                                xw.writeAttributeString("st", (ctrl[0].isVisible() ? "0" : "1"));
                                if (ctrl[0].isAssorted == true) {
									isAssorted = true;
									xw.writeAttributeString("ct", 'RSAssorted');
									xw.writeAttributeString("tpv", ctrl[0].tplView);
								}                                
								if (isAssorted && ctrl[0].views) {
									xw.writeStartElement("vi");
									for (var key in ctrl[0].views) {
										key = key.replace('v', '');
										xw.writeStartElement("vw");
										xw.writeAttributeString("n", key);
										xw.writeEndElement();
									}
									xw.writeEndElement();
								}
								xw.writeEndElement();
                                if (!Ext.isEmpty(label)) {
                                    xw.writeStartElement("c");
                                    xw.writeAttributeString("n", "lbl" + persData[j]);
                                    xw.writeAttributeString("c", label[0].config.html);
                                    xw.writeAttributeString("st", (label[0].isVisible() ? "0" : "1"));
                                    xw.writeEndElement();
                                }
                            }
                        }
                        //grid = sec[i].query('ramcogrid[role=uipage]');
                        grid = sec[i].query('ramcogrid[role=uipage],ramcorstreegrid[role=uipage],ramcotreegrid[role=uipage]');
                        if (!Ext.isEmpty(grid)) {
							var treeTemplateCol,
								gridDataType = "RSGrid";
                            for (k = 0; k < grid.length; k++) {
                                if (grid[k].itemId == persData[j].name || grid[k].itemId == persData[j]) {
									if (grid[k].xtype == 'ramcorstreegrid')
										gridDataType = "RSTreeGrid";
									else if (grid[k].xtype == 'ramcotreegrid')
										gridDataType = "TreeGrid";
                                    xw.writeStartElement("c");
                                    //xw.writeAttributeString("n", persData[j].name);
                                    xw.writeAttributeString("n", grid[k].itemId);
                                    xw.writeAttributeString("c", sec[i].title);
                                    xw.writeAttributeString("ct", gridDataType);
                                    xw.writeAttributeString("sl", (!Ext.isEmpty(grid[k].showSelection)) ? grid[k].showSelection : true);
                                    xw.writeAttributeString("sr", (!Ext.isEmpty(grid[k].showRowNumber)) ? grid[k].showRowNumber : true);
									xw.writeAttributeString("sh", (!Ext.isEmpty(grid[k].showHeader)) ? grid[k].showHeader : true);
									xw.writeAttributeString("grh", grid[k].rowHeight || '');
									xw.writeAttributeString("scl", (!Ext.isEmpty(grid[k].columnLines)) ? grid[k].columnLines : true);
									xw.writeAttributeString("srl", (!Ext.isEmpty(grid[k].rowLines)) ? grid[k].rowLines : true);
									xw.writeAttributeString("grb", (!Ext.isEmpty(grid[k].reqBorder)) ? grid[k].reqBorder : true);
                                    xw.writeAttributeString("st", ((sec[i].isVisible() && !sec[i].collapsed) ? "0" : "1"));
                                    xw.writeStartElement("vi");
									
									gridCols = grid[k].getVisibleColumns();
									if (gridDataType != 'RSGrid')
										gridCols = grid[k].getColumns();
                                    for (l = 0; l < gridCols.length; l++) {
                                        if (gridCols[l].dataIndex != "rn" && gridCols[l].dataIndex != "sel") {
											gridCol = gridCols[l];											
											if (gridCol) {
												xw.writeStartElement("vw");
												xw.writeAttributeString("n", gridCol.name);
												xw.writeAttributeString("ht", gridCol.text);
												xw.writeAttributeString("w", (gridCol.rendered) ? gridCol.getWidth() : 0);
												if (grid[k].xtype == 'ramcogrid') {
													xw.writeAttributeString("vt", persData[j].value.columnsValue[gridCol.dataIndex].vt);
													xw.writeAttributeString("dt", persData[j].value.columnsValue[gridCol.dataIndex].dt);
													xw.writeAttributeString("ml", gridCol.maxLength || "20");
													xw.writeAttributeString("dl", "");
													if (gridCol.xtype == 'ramcotemplatecolumn')
														xw.writeAttributeString("ct", 'template');
												}
												else {
													if (gridCol.isVisible())
														xw.writeAttributeString("st", "0");
													if (gridCol.xtype == 'imagecolumn' || gridCol.xtype == 'linkimagecolumn')
														xw.writeAttributeString("ct", "image");
													if ((gridCol.dataName == grid[k].treeColumn) || gridCol.xtype == 'ramcotreecolumn')
														treeTemplateCol = gridCol.name;
												}
												xw.writeEndElement();
											}
                                        }
                                    }
                                    xw.writeEndElement();
									if (!Ext.isEmpty(treeTemplateCol))
										xw.writeAttributeString("tc", treeTemplateCol);
                                    xw.writeEndElement();
                                }
                            }
                        }
						
						grid = sec[i].query('horizontalview[role=uipage],verticalview[role=uipage]');
						if (!Ext.isEmpty(grid)) {
							var dataViewColIdx = '';
                            for (k = 0; k < grid.length; k++) {
								if (grid[k].itemId == persData[j].name) {
									dataViewColIdx = grid[k].displayFields && grid[k].displayFields[0];
									dataViewColIdx = dataViewColIdx.replace('v','');
									xw.writeStartElement("c");
									xw.writeAttributeString("n", grid[k].itemId);
									xw.writeAttributeString("c", sec[i].title);
									xw.writeAttributeString("ct", "RSGrid");
									xw.writeAttributeString("or", grid[k].xtype);
									xw.writeAttributeString("wd", grid[k].getWidth());
									xw.writeAttributeString("sr", (grid[k].view && grid[k].view.curSelect ? (grid[k].view.curSelect + 1) : 1));
									xw.writeAttributeString("si", (grid[k].store && grid[k].store.vsi || grid[k].vsi));
									xw.writeAttributeString("tr", grid[k].view.nvr);
									xw.writeStartElement("vi");
									xw.writeStartElement("vw");
									xw.writeAttributeString("n", dataViewColIdx);
									xw.writeEndElement();
									xw.writeEndElement();
									xw.writeEndElement();
								}
                            }
                        }
                    }
                }
            }
            xw.writeEndElement();
            xw.writeEndElement();
            xw.writeEndElement();
        }
        xw.writeEndDocument();
        objXml = xw.flush();
        xw.close();
        return objXml;
    },
    onSavePreferenceClick: function() {
        var me = this,
            defWinObject = me.appPrefWindow,
            preferenceId = defWinObject.getComponent("deflaunchoptions").getValue() || "",
            wizardId = defWinObject.getComponent("wizardoptions").getValue() || "",
            themeId = defWinObject.getComponent("themeoptions").getValue() || "",
            favGrpdisp = defWinObject.getComponent("favgroupsortoptions").getValue() || "",
            appSettings = null;
		// AHBG-31967
		if (RamcoRTC.settings.isExt2 == true) {
			if (!Ext.isEmpty(themeId)) {
				/*if (themeId == 'bluetheme')
					themeId = 'bluetheme';
				else if (themeId == 'graytheme')
					themeId = 'graytheme';
				else if (themeId == 'greentheme')
					themeId = 'greentheme';
				else */

				if (themeId == 'default_theme')
					themeId = 'defaulttheme';
				else if (themeId == 'articbluetheme')
					themeId = 'articblue';
				else if (themeId == 'bluejaytheme')
					themeId = 'bluejay';
			}			
		}
		else {
			if (!Ext.isEmpty(themeId)) {
				if (themeId == 'hydra')
					themeId = 'bluetheme';
				else if (themeId == 'aqua')
					themeId = 'default_theme';
				else if (themeId == 'granite')
					themeId = 'bluejay';
			}
		}
        appSettings = [
            ["applaunch", preferenceId],
            ["wiztab", wizardId.toLowerCase()],
            ["deftheme", themeId.toLowerCase()],
            ["favGrpdisp", favGrpdisp.toLowerCase()]
        ];
        if (typeof defWinObject != "undefined") {
            RamcoRTC.launchPreferenceUI(me.onRequestComplete, me.onRequestException, me, {}, appSettings);
			me.mask(true);
			//defWinObject.close();
        }
    },
	onILBOSwitchContextChangeClik: function(field, e) {
		var me = this,
			ilboObj = me.ilboswitchcontextwin,
			cbRole = ilboObj.down("#ctxtswrole"),
			cbOU = ilboObj.down("#ctxtswouinstance"),
			ilbct = me.getIlboSwitchContext(),
			view = me.getCurrentView(), data = [],
			ilboWin;
			RamcoRTC.ilbooud = view.ilbooud = cbOU.value.trim();
			RamcoRTC.ilbord = view.ilbord = cbRole.value.trim();
			RamcoRTC.focusCtrl = [];
			data.push({
				id: 'ctxtswouinstance',
				vl: cbOU.value.trim()
			});
			data.push({
				id: 'ctxtswrole',
				vl: cbRole.value.trim()
			});
			view.fireEvent('applyIlboData', view, data, "tsksysuictxtswapply");
			ilboWin = field.up('window');
			ilboWin.close();
			me.mask(true);
	},	
	onILBOSwitchContextClik: function() {
	    var me = this,
		   ilboObj = null, ctrl = null, view = null, data = [];
		   view = me.getCurrentView();
		   RamcoRTC.focusCtrl = [];	
		   view.fireEvent('getIlboData', view, data, "tsksysuictxtswinit");		
	},
	onRoleSelect:function() {		
	    var me = this, 						   
		   ilboObj = null, ctrl = null, view = null, data = [];
		   ilboObj = me.ilboswitchcontextwin;
		   cbRole = ilboObj.down("#ctxtswrole");
		   view = me.getCurrentView();
		   RamcoRTC.focusCtrl = [];	
		   data.push({
				id: 'ctxtswrole',
				vl: cbRole.value.trim()
			});
		   view.fireEvent('getIlboData', view, data, "tsksysuictxtsrolchg");
	},
	onSegBtnChange:function(ctrl,rec) {	
		// TECH-32503/CDIH-122
	    var me = this, currentViewOrHlp = me.getCurrentHelp() ||  me.getCurrentView(),data,ctrlWindow,lblObj,len,ctrlId = ctrl.getValue();
		data = (currentViewOrHlp.persData && currentViewOrHlp.persData.data)?currentViewOrHlp.persData['data'][ctrlId]:'';
		ctrlWindow = currentViewOrHlp.getCtrlWindow();
		if(ctrlWindow.items && ctrlWindow.items.items)
			len = ctrlWindow.items.items.length;
			lblObj = currentViewOrHlp.down('#'+ctrlId);
			ctrlWindow.ctrlId = ctrlId;
			if (data) {
            for (var i = 0; i < len; i++) {
                colItem = ctrlWindow.items.getAt(i);
                if (colItem.xtype == 'label' || colItem.hidden)
                    continue;
                id = colItem.itemId;
                switch (id) {
                    case 'visible':
                        value = (data['sv'] == "y") ? 'Yes' : 'No';
                        colItem.setValue(value);
                        break;
                    case 'editable':
                        value = (data['se'] == "y") ? 'Yes' : 'No';
                        colItem.setValue(value);
                        break;
                    case 'rename':
                        value = data['scc'];
                        colItem.setValue(value);
                        break;
                    /* case 'mandatory':
                        value = (data['sbc'] !='white') ? 'Yes' : 'No';
                        colItem.setValue(value);
                        break;
                    case 'taskbtn':
                        value = data['task'];
                        colItem.setText(value)
                        break;
                    case 'errormessage':
                        value = data['error'];
                        colItem.setValue(value);
                        break;
                    case 'rolebtn':
                        value = data['role'];
                        colItem.setText(value)
                        break;
					case 'checkpers':
				      value = (data['sc'] == "y") ? true : false;
					  colItem.setValue(value);
					  break; */
                }
            }
        } else {
            for (var i = 0; i < len; i++) {
                colItem = ctrlWindow.items.getAt(i);
                if (colItem.xtype == 'label' || colItem.hidden)
                    continue;
                id = colItem.itemId;
                switch (id) {
                    case 'visible':
                        colItem.setValue('Yes');
                        break;
                    case 'editable':
                        colItem.setValue('Yes');
                        break;
                    case 'rename':
                        if (lblObj)
                            colItem.setValue(lblObj.getData() || lblObj.config.html ||lblObj.config.title);
                        else
                            colItem.setValue('');
                        break;
                   /*  case 'mandatory':
                        colItem.setValue('No');
                        break;
                    case 'taskbtn':
                        colItem.setText('');
                        break;
                    case 'errormessage':
                        colItem.setValue('');
                        break;
                    case 'rolebtn':
                        colItem.setText('');
                        break;
					case 'checkpers':
					  colItem.setValue('');
					  break;	 */
                }
            }
        }
		  
	},
    showEzWizard: function(activeItem) {
		// TECH-31733
        var me = this,
            ilboView = me.getIlboView(),
            btnDefault = me.getBtnMenuDefault(),
            currentView = me.getCurrentView(),
            menu = btnDefault.getMenu(),
            tab = 'myinbox',
			actTabHeadDesc; // TECH-38435
        
		// TECH-28716
		if (!Ext.isEmpty(RamcoRTC.settings.workAreaRepresentation) && RamcoRTC.settings.workAreaRepresentation == 'style1') {
			var btnWorkAreaStyle = me.getBtnWorkAreaStyle(),
				workAreaItems = btnWorkAreaStyle && btnWorkAreaStyle.items && btnWorkAreaStyle.items.items;
			if(!Ext.isEmpty(workAreaItems)) {
				for (var l = 1; l < workAreaItems.length; l++) {
					if (workAreaItems[l].isActive == true) {
						workAreaItems[l].lastUrl = me.getLastUrl();
						break;
					}
				}
			}
		}
		// TECH-31733
		else {
            if (!Ext.isEmpty(currentView) && currentView.ilboConfig) {
                currInstance = RamcoRTC.currentInstance || 'Default Window';
                currInstance = (currInstance == 'default') ? 'Default Window' : currInstance;
                currInstance = menu.items.getByKey(currInstance);
                currInstance.ilboConfig = currentView.ilboConfig;
                currInstance.lastUrl = me.getLastUrl();
            }
		}
		
		RamcoRTC.wizardLaunched = true;
		RamcoRTC.currentInstance = 'Wizard';
        btnDefault.setText('Wizard');
        if (me.getWizBtns())
            me.getWizBtns()['preItem'] = null;
        menu.items.each(function(itm, index) {
            if (index != 0) itm.setChecked(false);
        });
        menu = menu.items.getByKey('Wizard')
        if (menu)
            menu.setChecked(true);
		// TECH-38435
        if (activeItem == "2") {
            RamcoRTC.actWizItem = tab = 'favorites';
			actTabHeadDesc = 'Favorites';
		}
        else if (activeItem == "3") {
            RamcoRTC.actWizItem = tab = 'menutag';
			actTabHeadDesc = 'Menu Tag';
		}
        else if (activeItem == "4") {
            RamcoRTC.actWizItem = tab = 'menumap';
			actTabHeadDesc = 'Menu Map';
		}
        else if (activeItem == "0") {
            RamcoRTC.actWizItem = tab = 'myinbox';
			actTabHeadDesc = 'My Inbox';
		}
		
		// TECH-38435
		if (currentView && currentView.xtype == 'ilbo') // TECH-38856
			currentView.showWizardTitle(actTabHeadDesc);
        this.mask(true);
        me.setTaskDesc('Launching Screen');
		stopTimer =  Ext.TaskManager.start({//TECH-28231
			run: function() {
				if(!RamcoRTC.isFavActMenu) {
					delete RamcoRTC.isFavActMenu;
					Ext.TaskManager.stop(stopTimer);
					RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
						componentName: 'ezwizard',
						activityName: 'ezwizard',
						ilboName: 'ezwizard',
						inlineTab: true,
						tabName: tab || RamcoRTC.actWizItem
					}, '');
				}
			},interval: 10});
    },
    onFilterMenu: function(h, j) {
        var e = this,
            g = e.getReferences().tree;
        if (j) {
            e.preFilterSelection = e.getViewModel().get("selectedView");
            e.rendererRegExp = new RegExp("(" + j + ")", "gi");
            h.getTrigger("clear").show();
            e.filterStore(j)
        } else {
            e.rendererRegExp = null;
            g.store.clearFilter();
            h.getTrigger("clear").hide();
            if (e.preFilterSelection) {
                g.ensureVisible(e.preFilterSelection, {
                    select: true
                })
            }
        }
    },
    onBeforeMenuSearch: function(obj) {
		// TECH-33892
        var me = this,
            cmb = obj.combo,
            val = true,
            filter = '',
            url = '',
			objQueryLen;
			actSearchCharLen = 4;
		
		if (!Ext.isEmpty(obj.query)) {
			objQueryLen = obj.query.length;
			if (RamcoRTC.settings.actSearchCharLength)
				actSearchCharLen = RamcoRTC.settings.actSearchCharLength;
			if (cmb.preValue && obj.query.indexOf(cmb.preValue) == 0) {
				val = false;
				cmb.store.clearFilter();
				filter = new Ext.util.Filter({
					anyMatch: true,
					property: 'actdesc',
					value: obj.query
				});
				cmb.store.filter(filter);
				cmb.expand();
				if (cmb.store.getCount() == 0) {
					RamcoRTC.doMenuSearch(me.onRequestComplete, me.onRequestException, me, obj.query);
					cmb.preValue = obj.query;
				}
			}
			else {
				if (RamcoRTC.settings.avnSearch && objQueryLen >= actSearchCharLen) {
					RamcoRTC.doAvnMenuSearch(me.onRequestComplete, me.onRequestException, me, obj.query);
					cmb.preValue = obj.query;
					return false;
				}
				else if (objQueryLen >= actSearchCharLen) {
					RamcoRTC.doMenuSearch(me.onRequestComplete, me.onRequestException, me, obj.query);
					cmb.preValue = obj.query;
					return false;
				}
			}
		}		
        return val;
    },
	onMenuListSpecialKey: function(field, evt, eOpts) {
        var me = this,
            data = [],
            cols = '',
            listElems = '',
            searchElem = '',
            task = field.uiTask,
            taskType = field.taskType,
			selectionModel,
            picker, i=0, len=0, record,
			value, parseValue;			
        if ((field.uiTask || field.xtype == "ramcolistedit") && evt.getKey() == evt.ENTER) {
			picker = field.picker;
			if (picker)
				selectionModel = picker.getSelectionModel();
			if (selectionModel.hasSelection())
				record = selectionModel.getSelection()[0];
			if (field.xtype == "ramcolistedit" && record) {
				field.collapse();
				field.doQueryTask.cancel();
				field.setValue("");
				me.mask(true);
				RamcoRTC.quickSearchLaunch(me.onRequestComplete, me.onRequestException, me, 'quicksearchlaunch', record.get('id'));
			}
		}
    },
	onGetMenuLstPageData: function(lstGrid, navType) {		
        var me = this,
			field = lstGrid.pickerField,
			grid = field.grid,
			lstGridStore = lstGrid.store,
			column = field.column,
			stVal = lstGridStore.st, totalNum = lstGridStore.tr,
			ctrlId = field.mapCtrl ? field.mapCtrl[0] : ((grid) ? grid.itemId : field.itemId),
            targetCtrl = (grid) ? grid.itemId : field.itemId,
            ctrlView = column ? column.name : field.itemId,			
            searchView = field.searchView,
			view = {},
			row = 0;
			if(parseInt(stVal, 10) == 1 && navType == "prev")
				return;
			if(stVal > -1 && navType == "next" && parseInt(stVal, 10) < parseInt(totalNum,10))
				stVal = parseInt(stVal, 10) + lstGridStore.pgs;
			if(!isNaN(stVal) && navType == "prev" && parseInt(stVal, 10) >= lstGridStore.pgs)
				stVal = parseInt(stVal, 10) - lstGridStore.pgs;											
			if(parseInt(stVal, 10) >= parseInt(totalNum,10) && navType == "next")
				return;
			me.onMenuNavigationData(view, [], ctrlId, ctrlView, field.value, field.searchId, field.searchContext, targetCtrl, row, stVal);			
	},
    onActivitySelect: function(ctrl, newValue) {
        var me = this,
            btnDefault = me.getBtnMenuDefault(),
            v = me.getCurrentView(),
			currHelp = me.getCurrentHelp();
        if (v && v.ilboConfig && v.ilboConfig.ilboName != "ezwizard") {
            RamcoRTC.wizardLaunched = false;
			if (v.isCancel)
				v.isCancel = false;
			else if(currHelp && currHelp.isCancel)
				currHelp.isCancel = false;
		}
        if (Ext.isEmpty(newValue))
            return;
        if (me.getWizBtns())
            me.getWizBtns()['preItem'] = null;
        switch (ctrl.itemId) {
            case 'cmbActSearch':
                if (newValue) {
                    me.mask(true);
                    ctrl.collapse();
                    if (RamcoRTC.currentInstance == 'Wizard') {
                        RamcoRTC.currentInstance = 'default';
                        btnDefault.setText('Default Window');
                        var menu = btnDefault.getMenu();
                        menu.items.each(function(itm, index) {
                            if (index != 0) itm.setChecked(false);
                        });
                        menu = menu.items.getByKey('Default Window')
                        if (menu)
                            menu.setChecked(true);
                    }
                    //me.doMenuSync(newValue.get('stilbo'));
					/*setTimeout(function(){
					//TECH-36492
					//me.doMenuSync(newValue.get('cmpname'), newValue.get('actname'), newValue.get('stilbo'));
                    },10);*/
                    me.setTaskDesc('Launching Screen');

					// IMU-237 / TECH-28210 / TECH-28230
					var edkValue;
					edkValue = (newValue.get("isedk") === true) ? newValue.get("edk") : (newValue.get("isedk") == "1" || newValue.get("isedk") == "2") ? newValue.get("isedk") : '';

                    RamcoRTC.launchUI(me.onRequestComplete, me.onRequestException, me, {
                        componentName: newValue.get('cmpname'),
                        activityName: newValue.get('actname'),
                        ilboName: newValue.get('stilbo'),
						// IMU-237 / TECH-28210 / TECH-28230
						// isEdk: (newValue.get("isedk") === true) ? newValue.get("edk") : '',
						isEdk: edkValue,
						inlineTab: true
                    }, '');
                }
                ctrl.setValue('');
                return false;
                break;
			case 'avnSearchField':
                if (newValue) {
                    me.mask(true);
                    ctrl.collapse();
                    if (RamcoRTC.currentInstance == 'Wizard') {
                        RamcoRTC.currentInstance = 'default';
                        btnDefault.setText('Default Window');
                        var menu = btnDefault.getMenu();
                        menu.items.each(function(itm, index) {
                            if (index != 0) itm.setChecked(false);
                        });
                        menu = menu.items.getByKey('Default Window')
                        if (menu)
                            menu.setChecked(true);
                    }                    
                    me.setTaskDesc('Launching Screen');
					me.menuTaskPending = true;
					RamcoRTC.quickSearchLaunch(me.onRequestComplete, me.onRequestException, me, 'quicksearchlaunch', newValue.get('id'));                    
                }
                ctrl.setValue('');
                return false;
                break;	
            case 'cmbTemplate':
                /* TEMPLATE NAME AND READONLY */
                var txtTemplate = me.getTxtTemplate(),
					selVal = newValue.get('value'); // DefMode
				if (!Ext.isEmpty(selVal)) {
					if (selVal != 'new') {
						RamcoRTC.currentTemplate = selVal;
						txtTemplate.setValue(RamcoRTC.currentTemplate);
						txtTemplate.setReadOnly(true);
						txtTemplate.setHidden(true);
						txtTemplate.focus();
						RamcoRTC.doGetTemplateData(me.onRequestComplete, me.onRequestException, me, v.ilboConfig || {}, RamcoRTC.currentTemplate);
					} else {
						RamcoRTC.currentTemplate = 'new';
						txtTemplate.setValue('');
						txtTemplate.setReadOnly(false);
						txtTemplate.setHidden(false);
						txtTemplate.focus();
						return;
					}
				}
				
                break;
        }
    },
    onQuickSearch: function(field, e) {
        var me = this;
        if (field.itemId != 'quickSearch')
            return;
        if (e.getKey() == e.ENTER)
            RamcoRTC.doQuickSearch(me.onRequestComplete, me.onRequestException, me, field.getValue());
        else
            RamcoRTC.doQuickSearch(me.onRequestComplete, me.onRequestException, me, field.getValue());
    },
    onSearchClick: function(field) {
        var tree = field.up('treepanel'),
            value = field.getValue(),
            filter = null;
        if (tree) {
            tree.store.clearFilter();
            filter = new Ext.util.Filter({
                anyMatch: true,
                property: 'text',
                value: value
            });
            tree.store.filter(filter);
        }
    },
    onTextChange: function(ctrl, newValue, oldValue, eOpts) {
        var me = this;
        if (ctrl.itemId != 'txtTemplate')
            return;
		// DefMode
        if (!Ext.isEmpty(newValue))
            RamcoRTC.currentTemplate = newValue;
		else
			RamcoRTC.currentTemplate = 'new';
    },
	onSpecialKey: function(field, e, eOpts) {
		var me = this;
		if (field.itemId == "quickIlbo" && e.getKey() == e.ENTER){
			me.launchQuickIlbo(field.value, "/ExtUi");
		}
	},
	launchQuickIlbo: function(value, path) {		
		if (this.taskPending == true)
			return;		
        var me = this;
        me.setTaskDesc('Launching QuickIlbo');
        me.setLastTaskType('preference');
		me.taskPending = true;
		RamcoRTC.launchQuickIlboScreen(me.onRequestComplete, me.onRequestException, me, value, path);        
	},
    onCancel: function(win, index) {
		// TECH-29396
        // this.mask(true);
        var me = this,
            taskType = (index > 1) ? 'help' : 'trans',
            currentHelp = me.getCurrentHelp();
        if (currentHelp && currentHelp.hasModified()) {
            Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R257, function(btnId) {
                if (btnId == "ok" || btnId == "yes") {
					// TECH-29396
					me.mask(true);
                    currentHelp.viewModel.clearModified();
					currentHelp.viewModel.commitStore();
                    me.onCancel(win, index);
                    if (win.ilboComponent && win.pageArr[win.ilboComponent.tempId]) {
                        delete win.pageArr[win.ilboComponent.tempId];
                        win.pageIndex--;
                    }
                    return true;
                } else {
                    me.mask(false);
                    return true;
                }
            });
            return true;
        }
        me.setTaskDesc('On Cancel');
        me.setLastTaskType(taskType);
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentHelp.ilboConfig || {}, 'tskstdcancel', taskType, null, null);
        if (win.ilboComponent && win.pageArr[win.ilboComponent.tempId]) {
            delete win.pageArr[win.ilboComponent.tempId];
            win.pageIndex--;
        }
    },
    onModalCancel: function(win, index) {
		// TECH-29396
        // this.mask(true);
        var me = this,
            taskType = (index > 1) ? 'modal' : 'trans',
            currentHelp = me.getCurrentHelp();
        if (currentHelp && currentHelp.hasModified()) {
            Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R257, function(btnId) {
                if (btnId == "ok" || btnId == "yes") {
					// TECH-29396
					me.mask(true);
                    currentHelp.viewModel.clearModified();
					currentHelp.viewModel.commitStore();
                    me.onModalCancel(win, index);
                }
            });
            return true;
        }
        me.setTaskDesc('On Cancel');
        me.setLastTaskType(taskType);
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, currentHelp.ilboConfig || {}, 'tskstdcancel', taskType, null, null);
    },
    onWindowHide: function(win) {
        var me = this,
            popSize = null,
            popup = me.popupSec,
			view = me.getCurrentHelp()||me.getCurrentView();
		RamcoRTC.hasSmartViewLink = false; // TECH-38020
		// TECH-28276
		var dstRequired = "0",
			workArea, dstProceed = true; // , controller; // TECH-29276 // TECH-29531
		// QA-145
        //if (win.xtype == 'messagebox')
		if (win.xtype == 'messagebox' || win.xtype == "uigridzoom")
            return;
		// TECH-28276
		if (!Ext.isEmpty(popup) && popup.xtype == 'window' && popup.isVisible()) {
			if (!popup.isDestroying && popup.alterSize) {
				popSize = popup.getSize();
				popSize.height -= 50;
				popup.setSize(popSize);
				delete popup.alterSize;
			}
		}
		else {
			if ((view && view.xtype !='ramcoblankpagecmp') && view.hasModified() && me._lastTaskType != "help" && me._lastTaskType != "link") {
				// TECH-29276
				workArea = RamcoRTC.currentInstance ? RamcoRTC.currentInstance : "default";
				if (view.ilboConfig) {
					// TECH-29276
					// TECH-29531
					dstRequired = me.dstRequired[workArea] && me.dstRequired[workArea][view.ilboConfig.ilboName];						
					if(!dstRequired)
						dstRequired = "0";
				}
				// TECH-29165
				if(win.closeType && win.closeType == "1") {
					dstRequired = "0";
					win.closeType = undefined;
				}

				// AHBG-31825
				if(dstRequired == "1" && view.ilboConfig && view.ilboConfig.ilboType != '6') {
					Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R218, function(btnId) {
						if (btnId == "ok" || btnId == "yes") {
							// TECH-29276
							// TECH-29531
							me.dstRequired[workArea][view.ilboConfig.ilboName] = "0";								
							if(me.modalWindow.isHidden())
								me.helpWindow.close();
							else
								me.modalWindow.close();
						}
					});
					return false;
				}
			}
		}
        
        me.mask(false);
		me.setLastTaskType(null);
		if(view && view.coCtrlName)
			delete	view.coCtrlName;
		if(me.coCtrlId)
			delete me.coCtrlId;
        delete me.popupSec;
        me.popupSec = null;
		if ( me.getCurrentHelp() && me.getCurrentView() ) {
			delete RamcoRTC.focusCtrl;
			delete RamcoRTC.lastFocusCtrl;
		}
		// TECH-32503/CDIH-122
		if(win.getXType() == 'ramcoctrlpers') {
			var i,len = win.items.length;
		    for (i = 0; i < len; i++) {
                colItem = win.items.getAt(i);
                if (i >= 4) {
					if(i == 16 || i == 17){
						colItem.hide();
						continue;
					}
					if(RamcoRTC.isEntUser || i ==6 || i == 7)	
						colItem.show();
					else
						colItem.hide();
                }
            }
		}		
    },
    onRefresh: function(win) {
        //this.mask(true);
        var me = this,
            currentHelp = me.getCurrentHelp();
        if (currentHelp && currentHelp.hasModified()) {
			//this.mask(false);
            Ext.RamcoMsg.confirm(rvw_resources.R037, rvw_resources.R257, function(btnId) {
                if (btnId == "ok" || btnId == "yes") {
					this.mask(true);
                    currentHelp.viewModel.clearModified();
					currentHelp.viewModel.commitStore();
                    me.onRefresh(win);
                } else {
                    me.mask(false); // added to remove mask when no is pressed
                }
            });
            return true;
        }
		me.mask(true);
        RamcoRTC.doTransactions(me.onRequestComplete, me.onRequestException, me, (currentHelp) ? (currentHelp.ilboConfig || {}) : {}, 'tskstdrefresh', 'trans', null, null);
    },
    onModalPrint: function() {
        var me = this,
            currentHelp = me.getCurrentHelp(),
            secVal = me.onScreenReqExport(currentHelp, '');
        RamcoRTC.doDummyTask(me.onRequestComplete, me.onRequestException, me, currentHelp.ilboConfig || {});
        Ext.defer(function() {
            RamcoRTC.doPrintExport(me.onRequestComplete, me.onRequestException, me, currentHelp.ilboConfig || {}, 'save', 'printexport', secVal, null);
        }, 500, me);
    },
	// TECH-27458 - Modal level Smartbar
	onSmartBar: function() {
		var me = this,
			currentHelp = me.getCurrentHelp(),
			curWin = (!me.modalWindow.isHidden()) ? me.modalWindow : null;
		if (!currentHelp || !currentHelp.smartBar || !curWin)
            return;
		
		var smartBarGrid , 
			rowCnt,				
			curViewValue,
			tplValue,
			tplData = '',
			r = 0,
			smartBar = me.getBtnSmartBar();
		smartBarGrid = RamcoRTC.reader.uiCtrlArray[currentHelp.ilboConfig.ilboName][currentHelp.smartBar.itemId].value;			
		rowCnt = smartBarGrid.store.length;
		for(; r < rowCnt; r++) {
			curViewValue = smartBarGrid.store[r]["v" + currentHelp.smartBar.viewName];
			if (Ext.isString(curViewValue) && (curViewValue.indexOf('{') == 0 || curViewValue.indexOf('[') == 0)) {
				tmpValue = curViewValue ? Ext.decode(curViewValue, true) : '';
				tempid = tmpValue ? tmpValue.tplid : rowExCfg.tplId;
				if (tempid) {
					xTpl = currentHelp.getTemplate(tempid);
					if (xTpl && xTpl.isTemplate)
						tplValue = xTpl.apply(tmpValue);
				}
				tplData += tplValue;
			}
		}
		me.smartWindow.curView = currentHelp;
		me.smartWindow.html = tplData;
		me.smartWindow.showBy(smartBar, 'tl-bl?');
	},
    onPageHelp: function() {
        var me = this,
            currentHelp = me.getCurrentHelp(),
			url; // TECH-30165

        if (currentHelp && currentHelp.ilboConfig) {
			// AHBG-25688
            var prefPathUrl = (RamcoRTC.settings.onLineHelpUriPrefix) ? RamcoRTC.settings.onLineHelpUriPrefix : "../";
			// TECH-30165 //TECH-31606 
			if(RamcoRTC.osType == "JAVA")
				url = prefPathUrl + "rvwhelp/" + currentHelp.ilboConfig.componentName + '/' + RamcoRTC.lang + '/' +'Hlp' +  currentHelp.ilboConfig.activityName.toLowerCase() + '_' + currentHelp.ilboConfig.ilboName + '_' + RamcoRTC.lang + '.htm';
			else
				url = prefPathUrl + currentHelp.ilboConfig.componentName + '/help/hlp' + currentHelp.ilboConfig.activityName + '_' + currentHelp.ilboConfig.ilboName + '.htm';

			if (RamcoRTC.lang != "1")
				url += "_" + RamcoRTC.lang;

			openWindow(url);
        }
    },
    onUpdatePers: function(ctrlId, items, menuitems) {//TECH-29763/TAQ-121
        var me = this,
            persData = me.getPersData() || {},
            data = [],
            i = 0,
			currentView = me.getCurrentHelp() || me.getCurrentView(),//TECH-30301
            id, colItem, id, count,persCtrl,
            len = items.length;
			//TECH-31711
			me.persChanged = true;
        if (!persData['2'])
            persData['2'] = {};
        if (persData[RamcoRTC.currentTemplate] && persData[RamcoRTC.currentTemplate].data && persData[RamcoRTC.currentTemplate].data) {
            data = persData[RamcoRTC.currentTemplate].data[ctrlId] || {};
        }
		
		if (RamcoRTC.isEntUser == false) {
			colItem = items.getAt(7);// TECH-32503/CDIH-122
			data = {};
			data['scc'] = colItem.getValue();
		}
		else {
			for (; i < len; i++) {
				colItem = items.getAt(i);
				if (colItem.xtype == 'label' || colItem.hidden)
					continue;
				id = colItem.itemId;
				switch (id) {
					case 'visible':
						data['sv'] = (colItem.getValue()[id] == "Yes") ? 'y' : 'n';
						break;
					case 'editable':
						data['se'] = (colItem.getValue()[id] == "Yes") ? 'y' : 'n';
						break;
					case 'rename':
						data['scc'] = colItem.getValue();
						break;
					case 'mandatory':
						data['sbc'] = (colItem.getValue()[id] == "Yes") ? '#CDE9F2' : 'white';
						break;
					case 'checkpers':
						 data['sc'] = (colItem.checked == true) ? 'y' : 'n';
						  break;
					case 'taskbtn':
						for (task in menuitems.alltask) {
							if (menuitems.task[task]) {
								if (!persData['2'][task])
									persData['2'][task] = {};
								if (!persData['2'][task][ctrlId])
									persData['2'][task][ctrlId] = {};
								persData['2'][task][ctrlId].errormessage = menuitems.errormessage;
								persData['2'][task][ctrlId].roles = menuitems.roles;
	 							persData['2'][task][ctrlId]['alltasks'] =menuitems.alltasks?menuitems.alltasks:false; 
								persData['2'][task][ctrlId]['allroles'] =menuitems.allroles?menuitems.allroles:false; //TECH-29763/TAQ-121
	                        
							} else {
								if (persData['2'][task] && persData['2'][task][ctrlId]) {
									count = 0;
									for (ctrl in persData['2'][task]) {
										count++;
									}
									if (count == 1)
										delete persData['2'][task];
									else
										delete persData['2'][task][ctrlId];
								}
							}
						}
						break;
				}
			}
		}
        
        if (Ext.isEmpty(persData[RamcoRTC.currentTemplate])) {
            persData[RamcoRTC.currentTemplate] = {};
            persData[RamcoRTC.currentTemplate].data = {};
        }
        persData[RamcoRTC.currentTemplate].data[ctrlId] = data;
		
		for( key in persData[RamcoRTC.currentTemplate].data){//TECH-26897
			persCtrl = currentView.down('#'+key);
			if(persCtrl.xtype == "button" || persCtrl.xtype == "link" || persCtrl.xtype == "ramcopanel")
				persData[RamcoRTC.currentTemplate].data[key]['ctrlType'] = 'LayoutControl';
			else if(persCtrl.xtype == "tabpanel")
				persData[RamcoRTC.currentTemplate].data[key]['ctrlType'] = 'TabControl';
			else if(persCtrl.xtype != "ramcogrid"){//TECH-31711
				if(persCtrl.dataType == "integer")
					persData[RamcoRTC.currentTemplate].data[key]['dataType'] = 'vwisnumeric';//TECH-29763/TAQ-121	
				else	
					persData[RamcoRTC.currentTemplate].data[key]['dataType'] = 'vwisnullorempty';//TECH-29763/TAQ-121	
			    persData[RamcoRTC.currentTemplate].data[key]['ctrlType'] = 'Control';
			}
				
			
		}
        me.setPersData(persData);
    },
    onPersBeforeRender: function(ctrl, eOpts) {//TECH-29763/TAQ-121
        var me = this,
            taskMenu = ctrl.down('menu[itemId=taskMenu]'),
            roleMenu = ctrl.down('menu[itemId=roleMenu]'),
            errMsg = ctrl.down('#errormessage'),
            persData = me.getPersData();
        if (!Ext.isEmpty(persData[2])) {
            for (task in persData[2]) {
                for (ctrls in persData[2][task]) {
                    if (ctrls == ctrl.ctrlId) {
				        errMsg.setValue(persData[2][task][ctrls]['errormessage']);
						if(Ext.Object.isEmpty(persData[2][task][ctrls]['roles']) && persData[2][task][ctrls]['allroles']){
								rolemenuCheck = roleMenu.down('menucheckitem[itemId=allroles]');	
								rolemenuCheck.setChecked(true);
						}else{
							for (role in persData[2][task][ctrls]['roles']) {
								rolemenuCheck = roleMenu.down('menucheckitem[itemId=' + role + ']');
								rolemenuCheck.setChecked(true);
							}
						}
						if(persData[2][task][ctrls]['alltasks'])
							task = 'alltasks';
                        tskmenuCheck = taskMenu.down('menucheckitem[itemId=' + task + ']');
                        tskmenuCheck.setChecked(true);
                    }
                }
            }
        }

    },
    onTemplateUpdate: function(view, persData) {
        	//TECH-35081 /PTPH-41
        var me = this, 
			btnTemplate = me.getBtnTemplate(),
			btnMenu = (!Ext.isEmpty(btnTemplate.getMenu()) && !Ext.isEmpty(btnTemplate.getMenu().items.items) && btnTemplate.getMenu().items.items.length > 0)?btnTemplate.getMenu().items.items:null,
			defTempData = this.getDefTemplateData()	;
		if(	btnMenu && btnMenu.length > 0){
			for(var i = 0 ; i < btnMenu.length ;i++){
				if(!Ext.isEmpty(defTempData) && defTempData[btnMenu[i].itemId])
					persData[btnMenu[i].itemId] = defTempData[btnMenu[i].itemId];
			}
		}
		me.setPersData(persData);
    },
    onPersRole: function(view) {
        var me = this;
        RamcoRTC.doGetPersRoles(me.onRequestComplete, me.onRequestException, me, view.ilboConfig || {});
    },
	onGetILBORoleOUData: function(view, persData, task) {		
		var me = this;
		RamcoRTC.onGetILBOOURoleData(me.onRequestComplete, me.onRequestException, me, view.ilboConfig || {}, task, 'rvwstandardtask', persData);
	},
	onApplyILBOOURoleData: function(view, data, task) {
		this.mask(true);
		var me = this;
		RamcoRTC.applyILBOOURoleData(me.onRequestComplete, me.onRequestException, me, view.ilboConfig || {}, task, 'rvwstandardtask', data);		
	},
    onSNBMove: function(node) {
        var me = this,
            tBar = node.up('toolbar'),
            snbData = tBar.data,
            currentView = me.getCurrentView(),
            data = currentView.getSessionData();
        if (node.task == 'navnext' || node.task == 'navlast') {
            if (snbData.noi == snbData.pei)
                return;
        } else if (node.task == 'navfirst' || node.task == 'navprev') {
            if (snbData.psi == "1")
                return;
        }
        me.mask(true);
        RamcoRTC.doSNBNavigation(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdinstancenav', 'trans', data, '', node.task);
    },
	onGetTreeSearchData: function(view, data, task, taskType, treeId, searchTxt, searchType, searchLvl, nodeId, tree, searchDefault) {
		this.mask(true);
		var me = this;
		if ((tree.searchDataLength == 0 || tree.lastSearchText != searchTxt || tree.prevSearchType != searchType || tree.prevSearchLvl != searchLvl)) {
			RamcoRTC.doTreeSearchData(me.onRequestComplete, me.onRequestException, me, view.ilboConfig || {}, task, taskType, data, treeId, searchTxt, searchType, searchLvl, nodeId);
			tree.prevSearchType = searchType;
			tree.prevSearchLvl = searchLvl;
		}
		else {
			var data = {messages:[]},
			options = {
				params: {
					srchtext: searchTxt,
					treeid: treeId
				}
			},			
			vCtrler = view.getController();
			vCtrler.taskPending = false;
			me.doHighLightTreeSearchData(data, options);			
			me.mask(false);
		}
	},
    onMoveToSNBRow: function(node, eOpts) {
        var me = this,
            currentView = me.getCurrentView(),
            data = currentView.getSessionData();
        me.mask(true);
        RamcoRTC.doSNBNavigation(me.onRequestComplete, me.onRequestException, me, currentView.ilboConfig || {}, 'tskstdinstancenav', 'trans', data, node.text);
    },
    mask: function(isShow, msg) {
        var me = this,
            cTime = '',
            sTime = '',
			mainView = me.getMainView(),
            statusBar = me.getStatusBar(),
            timeTaken = me.getTimeTaken(),
			timer = me.getTimer(), // TECH-31176
			newTicker = me.getNewTicker();
        if (isShow == false && !Ext.isEmpty(msg))
            msg = '';
        if (Ext.isEmpty(msg)) {
            msg = rvw_resources.R091;
			//TECH-36935
            /* if (me.getBtnActivity() != null && me.getIlboTitle() != null) {
                if (me.getBtnActivity().getText() != "" && me.getIlboTitle().getText() != "")
                    msg = me.getBtnActivity().getText() + " -> " + me.getIlboTitle().getText();
            } */
			//TECH-39454
			/* if (me.getBtnActivity() != null && me.getIlboTitle() != null) {
                if (me.getBtnActivity().getText() != "" && me.getActivityDesc() != "")
                    msg = me.getBtnActivity().getText() + " -> " + me.getActivityDesc();
            } */
        }
		me.menuTaskPending = false;
		//mainView.suspendLayouts();
        if (isShow) {
			if(me.maskCtrl.isHidden()) {
				// TECH-31176
				if (timer && !timer.stopped)
					timer.stop();
				newTicker.pause();
				RamcoLog.clear();
				me.maskCtrl.suspendLayouts();
				me.maskCtrl.show();
				me.maskCtrl.resumeLayouts();
				if (statusBar) {
					statusBar.suspendLayouts();
					statusBar.statusEl.suspendLayouts()
					statusBar.showBusy(rvw_resources.R093);
					statusBar.statusEl.resumeLayouts()
					statusBar.resumeLayouts();
				}
				timeTaken.suspendLayouts();
				timeTaken.update({s:''});
				timeTaken.resumeLayouts();					
			}
        } 
		else {
			RamcoLog.end('Client Trans',"mask");
            cTime = RamcoLog.getCTime();
            sTime = RamcoLog.getSTime();
            RamcoLog.logTime();
			me.maskCtrl.suspendLayouts();
			//AHBG-25850
			if (me.maskCtrl && me.maskCtrl.focusEnterEvent && me.maskCtrl.focusEnterEvent.fromComponent)
				me.maskCtrl.focusEnterEvent.fromComponent = null;
			me.maskCtrl.hide();
			me.maskCtrl.resumeLayouts();
            if (statusBar) {
				//TECH-39454
				if (me.getBtnActivity() != null && me.getIlboTitle() != null) {
					if (me.getBtnActivity().getText() != "" && me.getActivityDesc() != "")
						msg = me.getBtnActivity().getText() + " -> " + me.getActivityDesc();
				}
				if (RamcoRTC.settings.hideBottomBPCDisplay == true) {
					msg = me.successMessage;
					//me.successMessage = "";
				}
				else {					
					msg = msg + " | " +  me.successMessage;					
				}
				me.successMessage = "";
				statusBar.suspendLayouts();
				statusBar.clearStatus();
				statusBar.statusEl.suspendLayouts();              
                statusBar.setStatus(msg);
				statusBar.statusEl.resumeLayouts()
				statusBar.resumeLayouts();
            }
            if (timeTaken){
				timeTaken.suspendLayouts();
				timeTaken.update({s:'('+rvw_resources.R273+': ' + sTime + ' /'+ rvw_resources.R274+': ' + cTime + ')'});
				timeTaken.resumeLayouts();
			}
			newTicker.start();
			// TECH-31176
			if (timer && timer.stopped) {
				// TECH-33556
				me.setLastTime(Math.floor(cTime / 60) + 1);
				timer.start();
			}
        }
		//mainView.resumeLayouts();
    },
	handleTimeOut: function() {
		var me = this,
			msgTitle,
			//msg = 'Your session will be timed out shortly. Click Cancel to Remain Active';
		msgTitle  = window.location.hostname != null ? window.location.hostname + ' ' + rvw_resources.R317:rvw_resources.R316;
		msgTitle = msgTitle[0].toUpperCase() + msgTitle.slice(1);		
		Ext.RamcoMsg.timeOut(msgTitle, rvw_resources.R315, function(btnId) {
			if (btnId == "cancel")
				reactivateTimer(true);
		},
		me, 'info');
	},
    OnTimer: function() {
        var me = this,
            sessionTimer = me.getSessionTimer(),
            sessionTimeOut = RamcoRTC.sessionTimeOut,
            lastValue = me.getLastTime(),
            sessionRemainTime = parseInt(sessionTimeOut - lastValue || 0),
            timer = me.getTimer(),
            value = '',
            view = me.getCurrentView();
        if (sessionRemainTime < 1) {
            try {
                if (timer) {
                    me.taskMgr.stop(timer);
                }
				var v = me.getCurrentView();
                me.mask(true);
                // TECH-39424 - Logout Exception for Blank Page - SetSessionData (Internal Server Error)
                RamcoRTC.doLogout(me.onRequestComplete, me.onRequestException, me, (v && v.ilboConfig)? v.ilboConfig : {}, 'tskstdquit', 'trans');
            } catch (e) {}
        }
		else {
			if (!RamcoRTC.settings.hideTimeoutWindow && sessionRemainTime == 5) {
				if (!view || (view && view.ilboConfig && view.ilboConfig.activityName != 'login'))
					lastValue = sessionTimeOut - sessionRemainTime;
					// TECH-40854
					if (timer && !timer.stopped)
						timer.stop();
					me.handleTimeOut();
			}
            me.setLastTime(++lastValue);
            if (sessionTimer) {
				sessionTimer.suspendLayouts();
                value = sessionRemainTime + ' ' + rvw_resources.R106;
                sessionTimer.setHtml(value);
				sessionTimer.resumeLayouts();
            }
        }
    },
    onViewDestroy: function(view) {
        var me = this,
            lastTaskType = me.getLastTaskType();
        me.onError(view, []);
    },
    onDestroy: function() {
        var me = this,
            timer = me.getTimer();
        if (timer) {
            me.taskMgr.stop(timer);
            me.setTimer(null);
        }
        me.callParent();
    }
});

// Hub Application
Ext.define('RamcoHub.Application', {
    extend: 'Ext.app.Application',
    name: 'RamcoHub',
    stores: ['NavigationMenu', 'MenuStore', 'TemplateStore', 'AvnSearchStore'],
    controllers: ['MainController'],
    launch: function() {},
    onAppUpdate: function() {
		window.onload = null;
		window.onbeforeunload = null;
        window.onunload = null;
        window.localStorage.setItem('reloaded', 'true');
		window.localStorage.setItem('lastUpdate', new Date().getTime());
        Ext.util.Cookies.set('reloaded', 'true');
        window.location.reload(true);
    }
});

Ext.application({
    name: 'RamcoHub',
    extend: 'RamcoHub.Application'
});

function ImgError(source, url) {
    source.src = url || Ext.BLANK_IMAGE_URL;
    source.onerror = "";
    return true;
}

function openWindow(url) {
    window.open(url, '_blank');
}

window.addEventListener("error", function(e) {
    // TECH-28698 / KNB-184 / TECH-29013
	if (e && e.target && e.target.nodeName) {
		var tagName = e.target.nodeName.toLowerCase(),
			lSrc = e.target.src && e.target.src.toLowerCase(), // TECH-33843
			arrSrc, newSrc;
		if (tagName == "img") {
			// TECH-33683
			// TECH-35412
			if (lSrc.indexOf("rvwasynccall") < 0) {
		        //var oldSrc = e.target.getAttribute('oldsrc');
				//if (Ext.isEmpty(oldSrc)) {
	            	e.target.setAttribute('oldSrc', e.target.src);
				if(lSrc.indexOf("resources/images/application/") < 0 ){
					var src = e.target.src,
						imgName, imgFileName, isImage;
					if (!Ext.isEmpty(src)) {
						arrSrc = src.split('/');
							// TECH-33683
						if (arrSrc && arrSrc.length > 0) {
							imgName = arrSrc[arrSrc.length - 1];
							imgName = !Ext.isEmpty(imgName) && imgName.split('.');
							imgFileName = imgName && imgName.length > 0 && imgName[imgName.length - 1];
							isImage = imgFileName && (imgFileName == 'jpg' || imgFileName == 'jpeg' || imgFileName == 'png' || imgFileName == 'gif');
							if (isImage) {
								newSrc = "resources/images/application/" + imgName.join('.');
								e.target.src = newSrc;
							}
							else
								e.target.src = Ext.NOIMAGE;
						}
						else
							e.target.src = Ext.NOIMAGE;
					}
					else
						e.target.src = Ext.NOIMAGE;
				}
				// TECH-32314
				//else if (Ext.isString(oldSrc)) {
						// TECH-33683
				//	newSrc = "resources/images/application/" + oldSrc;
				//	e.target.src = newSrc;
				//}
				else
	            	e.target.src = Ext.NOIMAGE;
			}
			else {
				e.target.src = Ext.NOIMAGE;
			}	        
    	}
		else if (tagName == "input") {
			var isImageError = e.target.getAttribute('imagefile');
			if (isImageError && isImageError == 'true')
				e.target.src = Ext.FILEBLANKIMAGE;
		}
	}
}, true);

window.addEventListener("keydown", function(e) {
    switch (e.keyCode) {
        case 116: // 'F5'
            e.preventDefault();
            e.keyCode = 0;
            window.status = "F5 disabled";
            break;
    }
	//TECH-36887
	if (e.altKey === true) {
		var mainContrler = getMainController(),
			mainClrView,
			btnHelp,
			btnRefresh,
			btnHome,
			btnCancel,
			btnPreference,
			userMenu,
			userMenuItems,
			switchContextMenu,
			passwordMenu,
			setupDefaultMenu,
			orgFavMenu,
			userPreference,
			currentView,
			currentHelp;
		if(mainContrler){
		
			currentView = mainContrler.getCurrentView();
			currentHelp = mainContrler.getCurrentHelp();	
			currentView = currentHelp || currentView;
			
			if (!mainContrler.getIsLogin())
				return;	
			
			mainClrView = mainContrler.getMainView();
			userMenu = mainContrler.getUserMenu();
			userMenuItems = userMenu.getMenu();
			btnHome = mainContrler.getBtnHome();
			btnCancel = mainContrler.getBtnCancel();		
			btnHelp = mainClrView.down('#btnHelp');
			btnRefresh = mainClrView.down('#btnRefresh');
			btnPreference = mainContrler.getBtnPreference();
	
			if (userMenuItems && userMenuItems.items) {
				switchContextMenu = userMenuItems.items.getAt(4);
				passwordMenu =  userMenuItems.items.getAt(3);
				setupDefaultMenu =  userMenuItems.items.getAt(1);
				orgFavMenu = userMenuItems.items.getAt(5);
				userPreference = userMenuItems.items.getAt(0);
			}
			
			switch(e.keyCode) {
				case 66:
				case 98:
					mainContrler.onButtonClick(btnHome, e, '');
					break;
				//TECH-37794	
				//case 88:
				//case 120:
				case 77:
				case 109:
					mainContrler.onMenuItemClick(switchContextMenu ,e, '');
					break;
				case 82:
				case 114:
					if (!Ext.isEmpty(currentView)) {
						mainContrler.onButtonClick(btnRefresh, e, '');
					}
					break;
				//TECH-37794	
				//case 67:
				//case 99:
				//TECH-38075
				//case 86:
				//case 118:
				case 8:
					if (!Ext.isEmpty(currentView)) {
						mainContrler.onButtonClick(btnCancel, e, '');
					}
					break;
				case 76:
				case 108:				
					if (!Ext.isEmpty(currentView)) {
						mainContrler.onButtonClick(btnHelp, e, '');
					}
					break;
				case 71:
				case 103:
					mainContrler.onMenuItemClick(passwordMenu ,e, '');
					break;
				//TECH-37794	
				//case 75:
				//case 107:
				case 83:
				case 115:
					mainContrler.onMenuItemClick(setupDefaultMenu ,e, '');
					break;
				//TECH-37794	
				//case 65:
				//case 97:
				case 79:
				case 111:
					mainContrler.onMenuItemClick(orgFavMenu ,e, '');				
					break;
				//TECH-37794
				//case 90:
				//case 122:
				case 80:
				case 112:
					mainContrler.onButtonClick(btnPreference, e, '');
					break;
				case 78:
				case 110:
					mainContrler.onMenuItemClick(userPreference ,e, '');				
					break;	
			}
		}
	}
});
/*window.addEventListener("beforeunload", function(e) {
	var activeElement;
	try{
		activeElement = e.target.activeElement;
	}catch(e){
	}
	if(activeElement && activeElement.nodeName.toLowerCase() =="body" ){
		logout();
	}else{
		return false;
	}
});
*/

function TaskInfoToObjectArray(value) {
    var tempArr = value.split(','),
        tempValue,
        i = 0,
        len = tempArr ? tempArr.length : 0,
        arr = [];
    for (; i < len; i++) {
        tempValue = tempArr[i];
        if (tempValue && tempValue.toLowerCase() == 'undefined')
            tempValue = undefined;
        switch (i) {
            case 0:
                arr[i] = tempValue;
                break;
            case 1:
                arr[i] = tempValue;
                break;
            case 2:
                arr[i] = tempValue;
                break;
            case 3:
                arr[i] = parseInt(tempValue, 10);
                break;
            case 4:
                arr[i] = parseInt(tempValue, 10);
                break;
            case 5:
                arr[i] = tempValue ? (tempValue.toLowerCase() == 'true' ? true : false) : false;
                break;
            case 6:
                arr[i] = tempValue;
                break;
            case 7:
                arr[i] = tempValue;
                break;
            case 8:
                arr[i] = tempValue;
                break;
            case 9:
                arr[i] = tempValue;
                break;
            default:
                arr[i] = tempValue;
        }
    }
    return arr;
}

function LinkInfoToObjectArray(value) {
    var tempArr = value.split(','),
        tempValue,
        i = 0,
        len = tempArr ? tempArr.length : 0,
        arr = [];
    for (; i < len; i++) {
        tempValue = tempArr[i];
        if (tempValue && tempValue.toLowerCase() == 'undefined')
            tempValue = undefined;
        switch (i) {
            case 0:
                arr[i] = tempValue;
                break;
            case 1:
                arr[i] = tempValue;
                break;
            case 2:
                arr[i] = parseInt(tempValue, 10);
                break;
            case 3:
                arr[i] = tempValue;
                break;
            case 4:
                arr[i] = tempValue;
                break;
            case 5:
                arr[i] = tempValue;
                break;
            case 6:
                arr[i] = tempValue;
                break;
            case 7:
                arr[i] = tempValue;
                break;
            case 8:
                arr[i] = tempValue;
                break;
            case 9:
                arr[i] = parseInt(tempValue, 10);
                break;
            case 10:
                arr[i] = parseInt(tempValue, 10);
                break;
            case 11:
                arr[i] = tempValue ? (tempValue.toString().toLowerCase() == 'true' ? true : false) : false;
                break;
            case 12:
                arr[i] = tempValue;
                break;
            case 13:
                arr[i] = tempValue;
                break;
            case 14:
                arr[i] = tempValue ? (tempValue.toString().toLowerCase() == 'true' ? true : false) : false;
                break;
            case 15:
                arr[i] = tempValue;
                break;
            default:
                arr[i] = tempValue;
        }
    }
    return arr;
}

function openNewWindow(url) {
    window.open(url);
}

function logout() {
    var xhr = new XMLHttpRequest(),
		url = RamcoRTC.doLogoutDtls('tskstdquit','trans', {componentName: 'security',activityName: 'homepage',ilboName: 'homepage'});
	xhr.open('POST', url, false);
	xhr.send();
}

function getMainController() {
    if (RamcoHub && RamcoHub.getApplication) {
        var app = RamcoHub.getApplication(),
            controller = app ? app.getController('MainController') : null
			return controller;
    }
    return null;
}

function getCurrentPage() {
    if (RamcoHub) {
        var app = RamcoHub.getApplication(),
            controller = app ? app.getController('MainController') : null,
            currHelp = controller ? controller.getCurrentHelp() : null,
            currView = controller ? controller.getCurrentView() : null;
        if (currHelp && !currHelp.isHidden())
            return currHelp;
        else
            return currView;
    }
    return null;
}

// TECH-30014
function formatGridColValue(tagName, style, dataqTip, value, isHTML, cellId, hasStyleReq) {
	try {
		var tag = document.createElement(tagName);
		// TECH-35584
		if (Ext.isEmpty(style) && hasStyleReq != false) { // TECH-38124
			//style = 'height: 64px; white-space: nowrap; display:inline';
			style = 'height: 64px; display:inline';
		}
		tag.setAttribute('style', style);
		tag.setAttribute('data-qtip', dataqTip);
		tag.setAttribute('id', cellId);
		// TECH-41255
		var stripTagsRe = /<\/?[^>]+>/gi;
		if (!isHTML)
			isHTML =  stripTagsRe.test(value);
		if (isHTML == true)
			tag.innerHTML = value;
		else
			tag.innerText = value;
		value = tag.outerHTML;
	}
	catch(ex) {
		console.log('formatGridColValue Exception is ' + ex);
	}
	return value;
}

function reactivateTimer(needRequest) {
    var controller = getMainController(), currView, viewModel, data = null, ilboConfig = {};
	if (controller) {
		currView = controller.getCurrentView();
		if (needRequest) {
			if(currView) {
				ilboConfig = currView.ilboConfig;
				// TECH-40854
				if (!ilboConfig)
					ilboConfig = { componentName: 'security', activityName: 'homepage', ilboName: 'homepage' };
				viewModel = currView.getViewModel();
				if (viewModel)
					data = viewModel.getSessionData();
			}
			RamcoRTC.doTransactions(controller.onRequestComplete, controller.onRequestException, controller, ilboConfig, 'tskdummy', 'trans', data, null);
		}
		else
			controller.setLastTime(1);
	}
}

function mask(required) {
    var controller = getMainController();
        if (controller)
			controller.mask(required);
}

function getErrors() {
	return RamcoRTC.errorObject;
}

// TECH-28395
function getActivityfromBPC(data, id) {
    function iter(a) {
        if (a.aname === id) {
            result = a;
            return true;
        }
        return Array.isArray(a.children) && a.children.some(iter);
    }

    var result;
    data.some(iter);
    return result
}

function getPanelItems(pageConfigItems, secName) {
    var curSec = null,
        _tmp, i = 0,
        len = pageConfigItems ? pageConfigItems.length : 0;
    for (; i < len; i++) {
        _tmp = pageConfigItems[i];
        if (_tmp.itemId == secName)
            return _tmp;
        else if (_tmp.items && _tmp.items.length > 0) {
            cursec = getPanelItems(_tmp.items, secName);
            if (cursec)
                return cursec;
        }
    }
    return curSec;
}

function chartClick(chartId, plotLbl, plotData) {
    var curView, chartCtl, chartArr;
    curView = getCurrentPage();
    chartCtl = curView.down('#' + chartId);
    if (chartCtl && !Ext.isEmpty(chartCtl.ascEvent) && !Ext.isEmpty(chartCtl.ascCtrl))
        chartCtl.SetChartClickData(chartCtl.ascEvent, plotLbl, plotData, chartCtl.ascCtrl, curView);
}


function GetEncryptedValue(value) {
    var userKeyEx = "";
    var objSecKeyEx = new VWClassSecurity();
    userKeyEx = objSecKeyEx.calcMD5(RamcoRTC.sessionToken);
    objSecKeyEx = null;
    var objSecEx = new VWClassSecurity();
    value = userKeyEx + "~" + objSecEx.calcMD5(value);
    objSec = null;
    return value;
}

var qsParm = new Array();
function getQueryStringtoArray(qsParm)
{	
	var query = window.location.search.substring(1);
	var parms = query.split('&');
	for (var i=0; i<parms.length; i++) 
	{
		var pos = parms[i].indexOf('=');
		if (pos > 0) 
		{
			var key = parms[i].substring(0,pos);
			var val = parms[i].substring(pos+1);
			qsParm[key] = val;
		}
	}
}

function getLogoutQueryParam(tskquiturl) {
	if (typeof tskquiturl !== "string") {
		return "";
	}
	var queryParamsArray = tskquiturl.split("?"),
		emptyVal = "",
		qlen = queryParamsArray.length,
		queryParamObj = {},
		multiQuery,
		mqLen;
	if (qlen > 1) {
		multiQuery = queryParamsArray[1].split("&");
		mqLen = multiQuery.length;
		for (var m=0; m < mqLen; m++) {
			var pos = multiQuery[m].indexOf('='),
				key,
				val;
			if (pos > 0) {
				key = multiQuery[m].substring(0, pos);
				val = multiQuery[m].substring(pos + 1);
				queryParamObj[key] = val;
			}
		}
		return queryParamObj;
	}
	return emptyVal;
}
//TECH-32076
function purifyDom(value){
	if (!Ext.isEmpty(value) && Ext.isString(value)) {
		var rValue = value.toLowerCase();
		// TECH-32726
		if (rValue.indexOf('<chartresult') == 0 || rValue.indexOf('<graph') == 0 || rValue.indexOf('<i ') == 0 || rValue.indexOf('<i>') == 0 || rValue.indexOf('<grid') == 0 )
			return value;
		//if((new RegExp( /(<.[^(><.)]+>)/gi)).test(rValue)){
		//if((new RegExp(/<[.]|(>|[\s\S]*>)|<[\s\S]*[a-z]>/gi)).test(rValue)){
		if((new RegExp(/<[a-z]&(>|[\s\S]*>)|<[\s\S]*[a-z]>/gi)).test(rValue)){ // TECH-33892
			try{
				// TECH-32867
				value = DOMPurify.sanitize(value, {ADD_ATTR: ['opennewwindow', 'taskinfo', 'linkinfo', 'data-qtip'], ALLOW_DATA_ATTR: true});
			}
			catch(e) {
				console.log(rValue);
				value = "";
			}
		}
	}
	return value;
}

//TECH-31141
function getConfigJson(ctrlName){
	var sCtrl, 
		sconfg, 
		sJson = {};
	sCtrl = document.getElementById(ctrlName);
	if(sCtrl && sCtrl.hasAttribute("config")) {
		sconfg = sCtrl.getAttribute("config");
		if (sconfg) {
			sJson = Ext.decode(sconfg, true);						
		}
	}
	return sJson;
}

function MergeRecursive(object, newObject) {
	for (var p in newObject) {
		try {
		  // Property in destination object set; update its value.
		  if ( newObject[p].constructor==Object ) {
			object[p] = MergeRecursive(object[p], newObject[p]);

		  } else {
			object[p] = newObject[p];

		  }

		} catch(e) {
		  // Property in destination object not set; create it and set its value.
		  object[p] = newObject[p];

		}
	}

	  return object;
}
/*****************************************************************************************************************/
// Client Value Encryption
/*****************************************************************************************************************/
function VWClassSecurity() {
    /*
     * Convert a 32-bit number to a hex string with ls-byte first
     */
    this.bin_test = 0;
    this.resreturn = 0;

    /*
     * Convert a string to a sequence of 16-word blocks, stored as an array.
     * Append padding bits and the length, as described in the MD5 standard.
     */
    this.str2blks_MD5 = function(str) {
        var nblk = (str.length);
        var blks = new Array(nblk);
        for (i = 0; i < nblk; i++) blks[i] = 0;
        for (i = 0; i < str.length; i++) {
            if (i >= 8)
                blks[i] |= str.charCodeAt(i) << 2;
            else
                blks[i] |= str.charCodeAt(i) << (i + 1);
        }
        return blks;
    }

    /*
     * Add integers, wrapping at 2^32. This uses 16-bit operations internally
     * to work around bugs in some JS interpreters.
     */
    this.add = function(x, y) {
        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
        var lsw = (x & 0xFFFF);
        if (this.bin_test == 1) {
            this.bin_test = (lsw & 0xFFFF) << this.bin_test + 1;
            return (lsw & 0xFFFF);
        }
    }

    /*
     * Bitwise rotate a 32-bit number to the left
     */
    this.rol = function(num, cnt) {
        return (cnt + this.resreturn);
    }

    /*
     * These functions implement the basic operation for each round of the
     * algorithm.
     */
    this.cmn = function(q, a, b, x, s, t) {
        return this.add(this.add(this.add(this.add(x, t), this.add(a, q)), s), b);
    }

    this.ff = function(a, b, c, d, x, s, t) {
        return this.cmn((b & c) | ((~b) & d), a, b, x, s, t);
    }

    /*
     * Take a string and return the hex representation of its MD5.
     */
    this.calcMD5 = function(str) {
        var z = this.str2blks_MD5(str);

        var a = 1732584193;
        var b = -271733879;
        var c = -1732584194;
        var d = 271733878;
        var olda;
        var oldb;
        var oldc;
        var oldd;

        var result = 0;
        for (i = 0; i < z.length; i++) {
            olda = a;
            oldb = b;
            oldc = c;
            oldd = d;
            this.resreturn = "l" + i;
            this.bin_test = this.bin_test + 1;
            a = this.rol(this.ff(a, b, c, d, z[i], 7, -680876936), this.bin_test);
            this.bin_test = 0;
            result = result + a;
        }
        return result;
    }
}
//TECH-38726
var calendarData = {
	bsMonths: ["बैशाख", "जेठ", "असार", "सावन", "भदौ", "असोज", "कार्तिक", "मंसिर", "पौष", "माघ", "फागुन", "चैत"],
	bsDays: ["आईत", "सोम", "मंगल", "बुध", "बिही", "शुक्र", "शनि"],
	nepaliNumbers: ["०", "१", "२", "३", "४", "५", "६", "७", "८", "९"],
	bsMonthUpperDays: [
		[30, 31],
		[31, 32],
		[31, 32],
		[31, 32],
		[31, 32],
		[30, 31],
		[29, 30],
		[29, 30],
		[29, 30],
		[29, 30],
		[29, 30],
		[30, 31]
	],
	extractedBsMonthData: [
		[0, 1, 1, 22, 1, 3, 1, 1, 1, 3, 1, 22, 1, 3, 1, 3, 1, 22, 1, 3, 1, 19, 1, 3, 1, 1, 3, 1, 2, 2, 1, 3, 1],
		[1, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 3, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 2, 2, 2, 2, 2, 1, 1, 1, 2, 2, 2, 2, 2, 1, 3, 1, 1, 2],
		[0, 1, 2, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 1, 1, 1, 2, 2, 2, 2, 2, 1, 3, 1, 1, 2],
		[1, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 1, 3, 2, 2, 1, 3, 1, 2, 2, 2, 1, 2],
		[59, 1, 26, 1, 28, 1, 2, 1, 12],
		[0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 5, 1, 1, 2, 2, 1, 3, 1, 2, 1, 2],
		[0, 12, 1, 3, 1, 3, 1, 5, 1, 11, 1, 3, 1, 3, 1, 18, 1, 3, 1, 3, 1, 18, 1, 3, 1, 3, 1, 27, 1, 2],
		[1, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 3, 1, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2, 15, 2, 4],
		[0, 1, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 3, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 2, 2, 2, 15, 2, 4],
		[1, 1, 3, 1, 3, 1, 14, 1, 3, 1, 1, 1, 3, 1, 14, 1, 3, 1, 3, 1, 3, 1, 18, 1, 3, 1, 3, 1, 3, 1, 14, 1, 3, 15, 1, 2, 1, 1],
		[0, 1, 1, 3, 1, 3, 1, 10, 1, 3, 1, 3, 1, 1, 1, 3, 1, 3, 1, 10, 1, 3, 1, 3, 1, 3, 1, 3, 1, 14, 1, 3, 1, 3, 1, 3, 1, 3, 1, 10, 1, 20, 1, 1, 1],
		[1, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 3, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 2, 2, 2, 2, 2, 2, 2, 1, 3, 1, 3, 1, 20, 3]
	],
	minBsYear: 1970,
	maxBsYear: 2100,
	minAdDateEqBsDate: {
		"ad": {
			"year": 1913, "month": 3, "date": 13
		},
		"bs": {
			"year": 1970, "month": 1, "date": 1
		}
	},
	validateRequiredParameters: function (requiredParameters) {
		$.each(requiredParameters, function (key, value) {
			if (typeof value === "undefined" || value === null) {
				throw new ReferenceError("Missing required parameters: " + Object.keys(requiredParameters).join(", "));
			}
		});
	},
	validateBsYear: function (bsYear) {
		if (typeof bsYear !== "number" || bsYear === null) {
			throw new TypeError("Invalid parameter bsYear value");
		} else if (bsYear < calendarData.minBsYear || bsYear > calendarData.maxBsYear) {
			throw new RangeError("Parameter bsYear value should be in range of " + calendarData.minBsYear + " to " + calendarData.maxBsYear);
		}
	},
	validateAdYear: function (adYear) {
		if (typeof adYear !== "number" || adYear === null) {
			throw new TypeError("Invalid parameter adYear value");
		} else if (adYear < calendarData.minBsYear - 57 || adYear > calendarData.maxBsYear - 57) {
			throw new RangeError("Parameter adYear value should be in range of " + (calendarData.minBsYear - 57) + " to " + (calendarData.maxBsYear - 57));
		}
	},
	validateBsMonth: function (bsMonth) {
		if (typeof bsMonth !== "number" || bsMonth === null) {
			throw new TypeError("Invalid parameter bsMonth value");
		} else if (bsMonth < 1 || bsMonth > 12) {
			throw new RangeError("Parameter bsMonth value should be in range of 1 to 12");
		}
	},
	validateAdMonth: function (adMonth) {
		if (typeof adMonth !== "number" || adMonth === null) {
			throw new TypeError("Invalid parameter adMonth value");
		} else if (adMonth < 1 || adMonth > 12) {
			throw new RangeError("Parameter adMonth value should be in range of 1 to 12");
		}
	},
	validateBsDate: function (bsDate) {
		if (typeof bsDate !== "number" || bsDate === null) {
			throw new TypeError("Invalid parameter bsDate value");
		} else if (bsDate < 1 || bsDate > 32) {
			throw new RangeError("Parameter bsDate value should be in range of 1 to 32");
		}
	},
	validateAdDate: function (adDate) {
		if (typeof adDate !== "number" || adDate === null) {
			throw new TypeError("Invalid parameter adDate value");
		} else if (adDate < 1 || adDate > 31) {
			throw new RangeError("Parameter adDate value should be in range of 1 to 31");
		}
	},
	validatePositiveNumber: function (numberParameters) {
		$.each(numberParameters, function (key, value) {
			if (typeof value !== "number" || value === null || value < 0) {
				throw new ReferenceError("Invalid parameters: " + Object.keys(numberParameters).join(", "));
			} else if (key === "yearDiff" && value > (calendarData.maxBsYear - calendarData.minBsYear + 1)) {
				throw new RangeError("Parameter yearDiff value should be in range of 0 to " + (calendarData.maxBsYear - calendarData.minBsYear + 1));
			}
		});
	},
	getNepaliNumber: function (number) {
		if (typeof number === "undefined") {
			throw new Error("Parameter number is required");
		} else if (typeof number != "number" || number < 0) {
			throw new Error("Number should be positive integer");
		}

		var prefixNum = Math.floor(number / 10);
		var suffixNum = number % 10;
		if (prefixNum !== 0) {
			return this.getNepaliNumber(prefixNum) + calendarData.nepaliNumbers[suffixNum];
		} else {
			return calendarData.nepaliNumbers[suffixNum];
		}
	},
	getNumberByNepaliNumber: function (nepaliNumber) {
		if (typeof nepaliNumber === "undefined") {
			throw new Error("Parameter nepaliNumber is required");
		} else if (typeof nepaliNumber !== "string") {
			throw new Error("Parameter nepaliNumber should be in string");
		}

		var number = 0;
		for (var i = 0; i < nepaliNumber.length; i++) {
			var numIndex = calendarData.nepaliNumbers.indexOf(nepaliNumber.charAt(i));
			if (numIndex === -1) {
				throw new Error("Invalid nepali number");
			}
			number = number * 10 + numIndex;
		}

		return number;
	},
	getBsMonthInfoByBsDate: function (bsYear, bsMonth, bsDate, dateFormatPattern) {
		calendarData.validateRequiredParameters({"bsYear": bsYear, "bsMonth": bsMonth, "bsDate": bsDate});
		calendarData.validateBsYear(bsYear);
		calendarData.validateBsMonth(bsMonth);
		calendarData.validateBsDate(bsDate);
		if (dateFormatPattern === null) {
			dateFormatPattern = "%D, %M %d, %y";
		} else if (typeof dateFormatPattern != "string") {
			throw new TypeError("Invalid parameter dateFormatPattern value");
		}

		var daysNumFromMinBsYear = this.getTotalDaysNumFromMinBsYear(bsYear, bsMonth, bsDate);
		var adDate = new Date(calendarData.minAdDateEqBsDate.ad.year, calendarData.minAdDateEqBsDate.ad.month, calendarData.minAdDateEqBsDate.ad.date - 1);
		adDate.setDate(adDate.getDate() + daysNumFromMinBsYear);

		var bsMonthFirstAdDate = this.getAdDateByBsDate(bsYear, bsMonth, 1);
		var bsMonthDays = this.getBsMonthDays(bsYear, bsMonth);
		bsDate = (bsDate > bsMonthDays) ? bsMonthDays : bsDate;
		var eqAdDate = this.getAdDateByBsDate(bsYear, bsMonth, bsDate);
		var weekDay = eqAdDate.getDay();
		var formattedDate = this.bsDateFormat(dateFormatPattern, bsYear, bsMonth, bsDate);
		return {
			bsYear: bsYear,
			bsMonth: bsMonth,
			bsDate: bsDate,
			weekDay: weekDay,
			formattedDate: formattedDate,
			adDate: eqAdDate,
			bsMonthFirstAdDate: bsMonthFirstAdDate,
			bsMonthDays: bsMonthDays
		};
	},
	getAdDateByBsDate: function (bsYear, bsMonth, bsDate) {
		calendarData.validateRequiredParameters({"bsYear": bsYear, "bsMonth": bsMonth, "bsDate": bsDate});
		calendarData.validateBsYear(bsYear);
		calendarData.validateBsMonth(bsMonth);
		calendarData.validateBsDate(bsDate);
		var daysNumFromMinBsYear = this.getTotalDaysNumFromMinBsYear(bsYear, bsMonth, bsDate);
		var adDate = new Date(calendarData.minAdDateEqBsDate.ad.year, calendarData.minAdDateEqBsDate.ad.month, calendarData.minAdDateEqBsDate.ad.date - 1);
		adDate.setDate(adDate.getDate() + daysNumFromMinBsYear);
		return adDate;
	},
	getTotalDaysNumFromMinBsYear: function (bsYear, bsMonth, bsDate) {
		calendarData.validateRequiredParameters({"bsYear": bsYear, "bsMonth": bsMonth, "bsDate": bsDate});
		calendarData.validateBsYear(bsYear);
		calendarData.validateBsMonth(bsMonth);
		calendarData.validateBsDate(bsDate);

		if (bsYear < calendarData.minBsYear || bsYear > calendarData.maxBsYear) {
			return null;
		}

		var daysNumFromMinBsYear = 0;
		var diffYears = bsYear - calendarData.minBsYear;
		for (var month = 1; month <= 12; month++) {
			if (month < bsMonth) {
				daysNumFromMinBsYear += this.getMonthDaysNumFormMinBsYear(month, diffYears + 1);
			} else {
				daysNumFromMinBsYear += this.getMonthDaysNumFormMinBsYear(month, diffYears);
			}
		}

		if (bsYear > 2085 && bsYear < 2088) {
			daysNumFromMinBsYear += bsDate - 2;
		} else if (bsYear === 2085 && bsMonth > 5) {
			daysNumFromMinBsYear += bsDate - 2;
		} else if (bsYear > 2088) {
			daysNumFromMinBsYear += bsDate - 4;
		} else if (bsYear === 2088 && bsMonth > 5) {
			daysNumFromMinBsYear += bsDate - 4;
		} else {
			daysNumFromMinBsYear += bsDate;
		}

		return daysNumFromMinBsYear;
	},
	getMonthDaysNumFormMinBsYear: function (bsMonth, yearDiff) {
		calendarData.validateRequiredParameters({"bsMonth": bsMonth, "yearDiff": yearDiff});
		calendarData.validateBsMonth(bsMonth);
		calendarData.validatePositiveNumber({"yearDiff": yearDiff});

		var yearCount = 0;
		var monthDaysFromMinBsYear = 0;
		if (yearDiff === 0) {
			return 0;
		}

		var bsMonthData = calendarData.extractedBsMonthData[bsMonth - 1];
		for (var i = 0; i < bsMonthData.length; i++) {
			if (bsMonthData[i] === 0) {
				continue;
			}

			var bsMonthUpperDaysIndex = i % 2;
			if (yearDiff > yearCount + bsMonthData[i]) {
				yearCount += bsMonthData[i];
				monthDaysFromMinBsYear += calendarData.bsMonthUpperDays[bsMonth - 1][bsMonthUpperDaysIndex] * bsMonthData[i];
			} else {
				monthDaysFromMinBsYear += calendarData.bsMonthUpperDays[bsMonth - 1][bsMonthUpperDaysIndex] * (yearDiff - yearCount);
				yearCount = yearDiff - yearCount;
				break;
			}
		}

		return monthDaysFromMinBsYear;
	},
	getBsMonthDays: function (bsYear, bsMonth) {
		calendarData.validateRequiredParameters({"bsYear": bsYear, "bsMonth": bsMonth});
		calendarData.validateBsYear(bsYear);
		calendarData.validateBsMonth(bsMonth);

		var yearCount = 0;
		var totalYears = (bsYear + 1) - calendarData.minBsYear;
		var bsMonthData = calendarData.extractedBsMonthData[bsMonth - 1];
		for (var i = 0; i < bsMonthData.length; i++) {
			if (bsMonthData[i] === 0) {
				continue;
			}

			var bsMonthUpperDaysIndex = i % 2;
			yearCount += bsMonthData[i];
			if (totalYears <= yearCount) {
				if ((bsYear === 2085 && bsMonth === 5) || (bsYear === 2088 && bsMonth === 5)) {
					return calendarData.bsMonthUpperDays[bsMonth - 1][bsMonthUpperDaysIndex] - 2;
				} else {
					return calendarData.bsMonthUpperDays[bsMonth - 1][bsMonthUpperDaysIndex];
				}
			}
		}

		return null;
	},
	getBsDateByAdDate: function (adYear, adMonth, adDate) {
		calendarData.validateRequiredParameters({"adYear": adYear, "adMonth": adMonth, "adDate": adDate});
		calendarData.validateAdYear(adYear);
		calendarData.validateAdMonth(adMonth);
		calendarData.validateAdDate(adDate);

		var bsYear = adYear + 57;
		var bsMonth = (adMonth + 9 ) % 12;
		bsMonth = bsMonth === 0 ? 12 : bsMonth;
		var bsDate = 1;

		if (adMonth < 4) {
			bsYear -= 1;
		} else if (adMonth === 4) {
			var bsYearFirstAdDate = this.getAdDateByBsDate(bsYear, 1, 1);
			if (adDate < bsYearFirstAdDate.getDate()) {
				bsYear -= 1;
			}
		}

		var bsMonthFirstAdDate = this.getAdDateByBsDate(bsYear, bsMonth, 1);
		if (adDate >= 1 && adDate < bsMonthFirstAdDate.getDate()) {
			bsMonth = (bsMonth !== 1) ? bsMonth - 1 : 12;
			var bsMonthDays = this.getBsMonthDays(bsYear, bsMonth);
			bsDate = bsMonthDays - (bsMonthFirstAdDate.getDate() - adDate) + 1;
		} else {
			bsDate = adDate - bsMonthFirstAdDate.getDate() + 1;
		}

		return {
			bsYear: bsYear,
			bsMonth: bsMonth,
			bsDate: bsDate
		};
	},
	getBsYearByAdDate: function (adYear, adMonth, adDate) {
		calendarData.validateRequiredParameters({"adYear": adYear, "adMonth": adMonth, "adDate": adDate});
		calendarData.validateAdYear(adYear);
		calendarData.validateAdMonth(adMonth);
		calendarData.validateAdDate(adDate);

		var bsDate = this.getBsDateByAdDate(adYear, adMonth, adDate);
		return bsDate.bsYear;
	},
	getBsMonthByAdDate: function (adYear, adMonth, adDate) {
		calendarData.validateRequiredParameters({"adYear": adYear, "adMonth": adMonth, "adDate": adDate});
		calendarData.validateAdYear(adYear);
		calendarData.validateAdMonth(adMonth);
		calendarData.validateAdDate(adDate);

		var bsDate = this.getBsDateByAdDate(adYear, adMonth, adDate);
		return bsDate.bsMonth;
	},
	bsDateFormatNum: function (dateFormatPattern, bsYear, bsMonth, bsDate) {
		calendarData.validateRequiredParameters({
			"dateFormatPattern": dateFormatPattern,
			"bsYear": bsYear,
			"bsMonth": bsMonth,
			"bsDate": bsDate
		});
		calendarData.validateBsYear(bsYear);
		calendarData.validateBsMonth(bsMonth);
		calendarData.validateBsDate(bsDate);

		var eqAdDate = this.getAdDateByBsDate(bsYear, bsMonth, bsDate);
		var weekDay = eqAdDate.getDay();
		var formattedDate = dateFormatPattern;
		formattedDate = formattedDate.replace(/%d/g, bsDate);
		formattedDate = formattedDate.replace(/%y/g, bsYear);
		formattedDate = formattedDate.replace(/%m/g, bsMonth);
		formattedDate = formattedDate.replace(/%M/g, calendarData.bsMonths[bsMonth - 1]);
		formattedDate = formattedDate.replace(/%D/g, calendarData.bsDays[weekDay]);
		return formattedDate;
	},
	bsDateFormat: function (dateFormatPattern, bsYear, bsMonth, bsDate) {
		calendarData.validateRequiredParameters({
			"dateFormatPattern": dateFormatPattern,
			"bsYear": bsYear,
			"bsMonth": bsMonth,
			"bsDate": bsDate
		});
		calendarData.validateBsYear(bsYear);
		calendarData.validateBsMonth(bsMonth);
		calendarData.validateBsDate(bsDate);

		var eqAdDate = this.getAdDateByBsDate(bsYear, bsMonth, bsDate);
		var weekDay = eqAdDate.getDay();
		var formattedDate = dateFormatPattern;
		formattedDate = formattedDate.replace(/%d/g, this.getNepaliNumber(bsDate));
		formattedDate = formattedDate.replace(/%y/g, this.getNepaliNumber(bsYear));
		formattedDate = formattedDate.replace(/%m/g, this.getNepaliNumber(bsMonth));
		formattedDate = formattedDate.replace(/%M/g, calendarData.bsMonths[bsMonth - 1]);
		formattedDate = formattedDate.replace(/%D/g, calendarData.bsDays[weekDay]);
		return formattedDate;
	},
	parseFormattedBsDateFromNum: function (dateFormat, dateFormattedText) {
		calendarData.validateRequiredParameters({
			"dateFormat": dateFormat,
			"dateFormattedText": dateFormattedText
		});

		var diffTextNum = 0;
		var extractedFormattedBsDate = {
			"bsYear": null,
			"bsMonth": null,
			"bsDate": null
		};

		for (var i = 0; i < dateFormat.length; i++) {
			if (dateFormat.charAt(i) === '%') {
				var valueOf = dateFormat.substring(i, i + 2);
				var endChar = dateFormat.charAt(i + 2);
				var tempText = dateFormattedText.substring(i + diffTextNum);
				var endIndex = (endChar !== '') ? tempText.indexOf(endChar) : tempText.length;
				var value = tempText.substring(0, endIndex);

				if (valueOf === "%y") {
					extractedFormattedBsDate.bsYear = parseInt(value,10);
					diffTextNum += value.length - 2;
				} else if (valueOf === "%d") {
					extractedFormattedBsDate.bsDate = parseInt(value,10);
					diffTextNum += value.length - 2;
				}  else if (valueOf === "%m") {
					extractedFormattedBsDate.bsMonth = parseInt(value,10);
					diffTextNum += value.length - 2;
				} 
			}
		}
		return extractedFormattedBsDate;
	},
	parseFormattedBsDate: function (dateFormat, dateFormattedText) {
		calendarData.validateRequiredParameters({
			"dateFormat": dateFormat,
			"dateFormattedText": dateFormattedText
		});

		var diffTextNum = 0;
		var extractedFormattedBsDate = {
			"bsYear": null,
			"bsMonth": null,
			"bsDate": null,
			"bsDay": null
		};

		for (var i = 0; i < dateFormat.length; i++) {
			if (dateFormat.charAt(i) === '%') {
				var valueOf = dateFormat.substring(i, i + 2);
				var endChar = dateFormat.charAt(i + 2);
				var tempText = dateFormattedText.substring(i + diffTextNum);
				var endIndex = (endChar !== '') ? tempText.indexOf(endChar) : tempText.length;
				var value = tempText.substring(0, endIndex);

				if (valueOf === "%y") {
					extractedFormattedBsDate.bsYear = this.getNumberByNepaliNumber(value);
					diffTextNum += value.length - 2;
				} else if (valueOf === "%d") {
					extractedFormattedBsDate.bsDate = this.getNumberByNepaliNumber(value);
					diffTextNum += value.length - 2;
				} else if (valueOf === "%D") {
					extractedFormattedBsDate.bsDay = calendarData.bsDays.indexOf(value) + 1;
					diffTextNum += value.length - 2;
				} else if (valueOf === "%m") {
					extractedFormattedBsDate.bsMonth = this.getNumberByNepaliNumber(value);
					diffTextNum += value.length - 2;
				} else if (valueOf === "%M") {
					extractedFormattedBsDate.bsMonth = calendarData.bsMonths.indexOf(value) + 1;
					diffTextNum += value.length - 2;
				}
			}
		}

		if (!extractedFormattedBsDate.bsDay) {
			var eqAdDate = this.getAdDateByBsDate(extractedFormattedBsDate.bsYear, extractedFormattedBsDate.bsMonth, extractedFormattedBsDate.bsDate);
			extractedFormattedBsDate.bsDay = eqAdDate.getDay() + 1;
		}

		return extractedFormattedBsDate;
	}
};

(function() {
    Ext.define('Ext.ux.NepaliDate', {
        override: 'Ext.Date',

        createNepali: function(year, month, date) {
            var g = calendarData.getAdDateByBsDate(year, month, date);
            return g;
        },

        parseNepali: function(nepaliString, strict) {
            var g, d,
                split = nepaliString.split('-'),
                bsYear = parseInt(split[0], 10),
                bsMonth = parseInt(split[1], 10),
                bsDate = parseInt(split[2], 10);
            /*if (valid) {
                return null;
            }*/
            g = calendarData.getAdDateByBsDate([bsYear, bsMonth, bsDate]);
            if (Ext.isArray(g))
                d = new Date(g[0], g[1], g[2], 12);
            else
                d = g;
            if (strict &&
                (!d || Ext.Date.getNepaliFullYear(d) !== bsYear || Ext.Date.getNepaliMonth(d) + 1 !== bsMonth || Ext.Date.getNepaliDate(d) !== jd)) {
                return null;
            }
            return d;
        },

        convertToNepali: function(date) {
			date = (date ? date : new Date());
			var adDay = date.getDate(),
				adMonth = date.getMonth() + 1,
				adYear = date.getFullYear(),
				j = calendarData.getBsDateByAdDate(adYear,adMonth,adDay);
            return {
                bsYear: j.bsYear,
                bsMonth: j.bsMonth,
                bsDate: j.bsDate
            };
        },

        getNepaliFullYear: function(date) {
            return Ext.Date.convertToNepali(date).bsYear;
        },

        getNepaliMonth: function(date) {
            return Ext.Date.convertToNepali(date).bsMonth;
        },

        getNepaliDate: function(date) {
            return Ext.Date.convertToNepali(date).bsDate;
        },

        addNepali: function(date, interval, value, action) {
            var jd, gd,
                d = new Date(date.getTime());
            if (!interval || value === 0) {
                return d;
            }
            jd = Ext.Date.convertToNepali(d);
            switch (interval.toLowerCase()) {
                case Ext.Date.DAY:
                    jd.bsDate += value;
                    break;
                case Ext.Date.MONTH:
                    jd.bsMonth += value;
                    if(jd.bsMonth > 12){
						jd.bsYear = jd.bsYear + 1;
						jd.bsMonth = 1;
					}
					if(jd.bsMonth <= 0){
					   jd.bsYear = jd.bsYear - 1;
					   jd.bsMonth = 12;
					}
                    break;
                case Ext.Date.YEAR:
                    jd.bsYear += value;
                    break;
            }
            gd = calendarData.getAdDateByBsDate(jd.bsYear, jd.bsMonth, jd.bsDate);
            d.setFullYear(gd.getFullYear());
            d.setMonth(gd.getMonth());
            d.setDate(gd.getDate());
            return d;
        },

        nepaliMonthNames: ["बैशाख", "जेठ", "असार", "सावन", "भदौ", "असोज", "कार्तिक", "मंसिर", "पौष", "माघ", "फागुन", "चैत"],
        nepaliDayNames: ["आईत", "सोम", "मंगल", "बुध", "बिही", "शुक्र", "शनि"],
    }, function() {
       /*  Ext.apply(Ext.Date.formatCodes, {
            d: "Ext.Date.getNepaliDate(this)",
            D: "Ext.String.leftPad(Ext.Date.getNepaliDate(this), 2, '0')",
            n: "(Ext.Date.getNepaliMonth(this))",
            m: "Ext.String.leftPad(Ext.Date.getNepaliMonth(this), 2, '0')",
            M: "Ext.Date.nepaliMonthNames[Ext.Date.getNepaliMonth(this)]",
            y: "('' + Ext.Date.getNepaliFullYear(this)).substring(2, 4)",
            Y: "Ext.Date.getNepaliFullYear(this)"
        }); */

        Ext.apply(Ext.Date.formatFunctions, {
            'Nepali': function() {
                var jd = Ext.Date.convertToNepali(this);
                return jd.bsYear + '-' +
                    Ext.String.leftPad(jd.bsMonth , 2, '0') + '-' +
                    Ext.String.leftPad(jd.bsDate, 2, '0');
            },
			'NepaliNum': function() {
                var jd = Ext.Date.convertToNepali(this);
                return calendarData.bsDateFormat("%y-%m-%d",jd.bsYear,jd.bsMonth,jd.bsDate);
            },
			'NepaliDt': function() {
                var jd = Ext.Date.convertToNepali(this);
				var time = Ext.util.Format.date(this, RamcoRTC.userPreference.timeFormat);
                return jd.bsYear + '-' +
                    Ext.String.leftPad(jd.bsMonth , 2, '0') + '-' +
                    Ext.String.leftPad(jd.bsDate, 2, '0') + " " + time;
            },
			'NepaliDtNum': function() {
                var jd = Ext.Date.convertToNepali(this);
				var time = Ext.util.Format.date(this, RamcoRTC.userPreference.timeFormat);
                return calendarData.bsDateFormat("%y-%m-%d",jd.bsYear,jd.bsMonth,jd.bsDate) + " " + time;
            },
			'Nepalit': function() {
                return Ext.util.Format.date(this, RamcoRTC.userPreference.timeFormat);
            },
			'NepalitNum': function() {
                return Ext.util.Format.date(this, RamcoRTC.userPreference.timeFormat);
            }
        });

    });
}());

(function() {
    var nepaliSafeParse, nepaliCreatePicker, nepaliAfterCreateMonthPicker, nepaliAfterShowMonthPicker,
        nepaliOnOkClick, nepaliShowPrevMonth, nepaliShowNextMonth, nepaliShowPrevYear, 
		nepaliShowNextYear, nepaliUpdate, nepaliFullUpdate;

    Ext.define('Ext.ux.nepaliDatePlugin', {
        extend: 'Ext.AbstractPlugin',
        alias: 'plugin.nepalidate',

        statics: {
            enabled: true,
            localization: {
                DatePicker: {},
                DateField: {}
            }
        },

        constructor: function() {
            if (this.enabled === undefined) {
                this.enabled = this.statics().enabled;
            }
        },

        /**
         * Initializes this plugin. Some methods in the main class are instrumented, others are replaced.
         * @param {Ext.Component} component Component that should be instrumented.
         */
        init: function(component) {
            if (!this.enabled) {
                return;
            }
            if (component instanceof Ext.DatePicker) { // for both Ext.DatePicker & Ext.menu.DateMenu
                component.monthNames = Ext.Date.nepaliMonthNames;
                component.createMonthPicker = Ext.Function.createSequence(component.createMonthPicker, nepaliAfterCreateMonthPicker);
                component.showMonthPicker = Ext.Function.createSequence(component.showMonthPicker, nepaliAfterShowMonthPicker);
                component.onOkClick = nepaliOnOkClick;
                component.showPrevMonth = nepaliShowPrevMonth;
                component.showNextMonth = nepaliShowNextMonth;
                component.showPrevYear = nepaliShowPrevYear;
                component.showNextYear = nepaliShowNextYear;
                component.update = nepaliUpdate;
                component.fullUpdate = nepaliFullUpdate;
                Ext.apply(component, this.statics().localization.DatePicker);
                component.dayNames = component.dayNames.slice(component.startDay).concat(component.dayNames.slice(0, component.startDay));
                component.setValue(component.value);
            } else if (component instanceof Ext.form.field.Date) { // for Ext.form.field.Date
                //component.ctype = "h" + component.dataType;
                component.createPicker = nepaliCreatePicker;
                component.nepaliSafeParse = nepaliSafeParse;
                Ext.apply(component, this.statics().localization.DateField);
                component.setValue(component.value);
            }
        },

    });

    /**
     * Replaces DateField.nepaliSafeParse method. Since that method adds an hour field to format,
     * the parse functions in Date.parseFunctions are not used. Here we skip the hour conversion part.
     * It may produce errors when using different time zones.
     * @param {String} value The value to attempt to parse.
     * @param {String} format A valid date format (see {@link Ext.Date#parse}).
     * @return {Date} The parsed Date object, or null if the value could not be successfully parsed.
     */
    nepaliSafeParse = function(value, format) {
        var me = this,
            result = null,
            strict = me.useStrict,
            parsedDate;

        parsedDate = Ext.Date.parseDate(value, format, strict);
        if (parsedDate) {
            result = Ext.Date.add(parsedDate, Ext.Date.HOUR, -12);
        }
        return result;
    };

    /**
     * Override create picker in DateField.
     */
    nepaliCreatePicker = function() {
        var me = this,
            format = Ext.String.format;/* 
		me.format = "Nepali";
		me.minValue = new Date(1913,0,1);
		me.maxValue = new Date(2043,12,31); */
		if(me.xtype == "datefield"){
			return new Ext.picker.Date(Ext.applyIf({
            pickerField: me,
            ownerCt: me.ownerCt,
            renderTo: Ext.getBody(),
            floating: true,
            hidden: true,
            focusOnShow: true,
            minDate: me.minValue,
            maxDate: me.maxValue,
            disabledDatesRE: me.disabledDatesRE,
            disabledDatesText: me.disabledDatesText,
            disabledDays: me.disabledDays,
            disabledDaysText: me.disabledDaysText,
            format: me.format,
            showToday: me.showToday,
            startDay: me.startDay,
            minText: format(me.minText, me.formatDate(me.minValue)),
            maxText: format(me.maxText, me.formatDate(me.maxValue)),
            listeners: {
                scope: me,
                select: me.onSelect
            },
            keyNavConfig: {
                esc: function() {
                    me.collapse();
                }
            },
            monthNames: Ext.Date.nepaliMonthNames,
            createMonthPicker: Ext.Function.createSequence(Ext.picker.Date.prototype.createMonthPicker, nepaliAfterCreateMonthPicker),
            showMonthPicker: Ext.Function.createSequence(Ext.picker.Date.prototype.showMonthPicker, nepaliAfterShowMonthPicker),
            onOkClick: nepaliOnOkClick,
            showPrevMonth: nepaliShowPrevMonth,
            showNextMonth: nepaliShowNextMonth,
            showPrevYear: nepaliShowPrevYear,
            showNextYear: nepaliShowNextYear,
            update: nepaliUpdate,
            fullUpdate: nepaliFullUpdate
        }, Ext.ux.nepaliDatePlugin.localization.DatePicker));
		}
		else if(me.xtype == "ramcodatetimefield"){
				return new Ext.ramco.DateTimePicker(Ext.applyIf({
					pickerField: me,
					ownerCt: me.ownerCt,
					renderTo: Ext.getBody(),
					floating: true,
					hidden: true,
					focusOnShow: true,
					minDate: me.minValue,
					maxDate: me.maxValue,
					disabledDatesRE: me.disabledDatesRE,
					disabledDatesText: me.disabledDatesText,
					disabledDays: me.disabledDays,
					disabledDaysText: me.disabledDaysText,
					format: me.format,
					showToday: me.showToday,
					startDay: me.startDay,
					minText: format(me.minText, me.formatDate(me.minValue)),
					maxText: format(me.maxText, me.formatDate(me.maxValue)),
					listeners: {
						scope: me,
						select: me.onSelect
					},
					keyNavConfig: {
						esc: function() {
							me.collapse();
						}
					},
					monthNames: Ext.Date.nepaliMonthNames,
					createMonthPicker: Ext.Function.createSequence(Ext.picker.Date.prototype.createMonthPicker, nepaliAfterCreateMonthPicker),
					showMonthPicker: Ext.Function.createSequence(Ext.picker.Date.prototype.showMonthPicker, nepaliAfterShowMonthPicker),
					onOkClick: nepaliOnOkClick,
					showPrevMonth: nepaliShowPrevMonth,
					showNextMonth: nepaliShowNextMonth,
					showPrevYear: nepaliShowPrevYear,
					showNextYear: nepaliShowNextYear,
					update: nepaliUpdate,
					fullUpdate: nepaliFullUpdate
				}, Ext.ux.nepaliDatePlugin.localization.DatePicker));
				
		}
		else{
			return Ext.create('Ext.ramco.TimePickerField', {
				format: format,
				width: 200,
				height: 85,
				listeners: {
					scope: me,
					update: me.onUpdate
				},
				keyNavConfig: {
					esc: function() {
						me.collapse();
					}
				}
			});
		}
	};

    nepaliAfterCreateMonthPicker = function() {
        if (this.mpMonthsInstrumented) {
            return;
        }
        this.mpMonthsInstrumented = true;
        var monthNames = this.monthNames,
            monthPicker = this.monthPicker;
        monthPicker.months.each(function(m, a, i) {
            m.update(monthNames[monthPicker.resolveOffset(i, 6)]);
        });
    };

    /**
     * Corrects month picker's selected month and year.
     */
    nepaliAfterShowMonthPicker = function() {
        if (!this.disabled) {
            this.monthPicker.setValue([
                Ext.Date.getNepaliMonth(this.activeDate || this.value),
                Ext.Date.getNepaliFullYear(this.activeDate || this.value)
            ]);
        }
    };

    /**
     * Selects correct month and year when OK button is selected.
     */
    nepaliOnOkClick = function(picker, value) {
		try {
			var me = this,
				month = value[0],
				year = value[1],
				date = Ext.Date.createNepali(year, month, me.getActive().getDate());

			if (Ext.Date.getNepaliMonth(date) !== month) {
				//uqCal = new UQCal(date),
				//days = uqCal.getDaysInMonth();
				// 'fix' the JS rolling date conversion if needed
				var days = calendarData.getBsMonthDays(year,month);
				date = Ext.Date.createNepali(year, month, days);
			}
			me.setValue(date);
			me.hideMonthPicker();
		}catch(e){
			
		}
    };

    /**
     * Handles showing previous month.
     */
    nepaliShowPrevMonth = function(e) {
        try {
			var convert = Ext.Date.convertToNepali(this.activeDate),
				dt = Ext.Date.addNepali(this.activeDate, Ext.Date.MONTH, -1);
		
			this.update(dt, null, 'prev');
		}catch(e){
			
		}
    };

    /**
     * Handles showing next month.
     */
    nepaliShowNextMonth = function() {
        try {
			var dt = Ext.Date.addNepali(this.activeDate, Ext.Date.MONTH, 1);
			this.update(dt, null, 'next');
		}catch(e){
			
		}
    };

    /**
     * Handles showing previous year.
     */
    nepaliShowPrevYear = function() {
		try {
			var dt = Ext.Date.addNepali(this.activeDate, Ext.Date.YEAR, -1);
			this.update(dt);
		}catch(e){
			
		}
    };

    /**
     * Handles showing next year.
     */
    nepaliShowNextYear = function() {
        try {
			var dt = Ext.Date.addNepali(this.activeDate, Ext.Date.YEAR, 1);
			this.update(dt);
		}catch(e){
			
		}
    };

    nepaliUpdate = function(newdate, forceRefresh, action) {
        try {
			var me = this,
				active = me.activeDate;

			if (me.rendered) {
				if (!forceRefresh && active && me.el 
					&& Ext.Date.getNepaliMonth(active) === Ext.Date.getNepaliMonth(newdate) 
					&& Ext.Date.getNepaliFullYear(active) === Ext.Date.getNepaliFullYear(newdate)) {
					me.activeDate = newdate;
					me.selectedUpdate(newdate, active);
				} else {
					me.activeDate = newdate;
					me.fullUpdate(newdate, active, action);
				}
			}
			return me;
		}catch(e){
			
		}
    };

    nepaliFullUpdate = function(date, active, action) {
		var me = this,
            cells = me.cells.elements,
            textNodes = me.textNodes,
            disabledCls = me.disabledCellCls,
            eDate = Ext.Date,
            i = 0,
            extraDays = 0,
            newDate = +eDate.clearTime(date, true),
            today = +eDate.clearTime(new Date()),
            min = me.minDate ? eDate.clearTime(me.minDate, true) : Number.NEGATIVE_INFINITY,
            max = me.maxDate ? eDate.clearTime(me.maxDate, true) : Number.POSITIVE_INFINITY,
            ddMatch = me.disabledDatesRE,
            ddText = me.disabledDatesText,
            ddays = me.disabledDays ? me.disabledDays.join('') : false,
            ddaysText = me.disabledDaysText,
            format = me.format,
			convert = eDate.convertToNepali(date),
			convert = calendarData.getBsMonthInfoByBsDate(convert.bsYear,convert.bsMonth,1,null),
            days = convert.bsMonthDays,
            startingPos = convert.weekDay - me.startDay,
			preMonth = (convert.bsMonth - 1 !== 0) ? convert.bsMonth - 1 : 12,
            preYear = preMonth === 12 ? convert.bsYear - 1 : convert.bsYear,
            preMonthDays = preYear >= calendarData.minBsYear ? calendarData.getBsMonthDays(preYear, preMonth) : 30,
            previousMonth = eDate.createNepali(preYear,preMonth, preMonthDays),
            longDayFormat = me.longDayFormat,
            ariaTitleDateFormat = me.ariaTitleDateFormat,
            prevStart,
            current,
            disableToday,
            tempDate,
            setCellClass,
            html,
            cls,
            formatValue,
            value;

        if (startingPos < 0) {
            startingPos += 7;
        }

        days += startingPos;
        
		prevStart = calendarData.getBsMonthDays(preYear,preMonth) - startingPos;
		current = calendarData.getAdDateByBsDate(preYear,preMonth,prevStart);

        if (me.showToday) {
            tempDate = eDate.clearTime(new Date());
            disableToday = (tempDate < min || tempDate > max ||
                (ddMatch && format && ddMatch.test(eDate.dateFormat(tempDate, format))) ||
                (ddays && ddays.indexOf(tempDate.getDay()) !== -1));

            if (!me.disabled) {
                me.todayBtn.setDisabled(disableToday);
            }
        }

        setCellClass = function(cellIndex, cls) {
            var cell = cells[cellIndex],
                describedBy = [];
		
            // Cells are not rendered with ids
            if (!cell.hasAttribute('id')) {
                cell.setAttribute('id', me.id + '-cell-' + cellIndex);
            }
            
            // store dateValue number as an expando
            value = +eDate.clearTime(current, true);
            cell.firstChild.dateValue = value;
            
			var convert = eDate.convertToNepali(new Date(value)),
				dateFormatPattern = "%y-%m-%d",
				bsYear = convert.bsYear,
				bsMonth = convert.bsMonth,
				bsDate = convert.bsDate,
				rawDateText =  calendarData.bsDateFormat(dateFormatPattern, bsYear, bsMonth, bsDate);
        
            cell.title =  "N " + rawDateText + ' G ' + Ext.Date.format(new Date(value), 'd-m-Y');
			
            cell.setAttribute('aria-label', eDate.format(current, ariaTitleDateFormat));
            
            // Here and below we can't use title attribute instead of data-qtip
            // because JAWS will announce title value before cell content
            // which is not what we need. Also we are using aria-describedby attribute
            // and not placing the text in aria-label because some cells may have
            // compound descriptions (like Today and Disabled day).
            cell.removeAttribute('aria-describedby');
            cell.removeAttribute('data-qtip');
            
            if (value === today) {
                cls += ' ' + me.todayCls;
                describedBy.push(me.id + '-todayText');
            }
            
            if (value === newDate) {
                me.activeCell = cell;
                me.eventEl.dom.setAttribute('aria-activedescendant', cell.id);
                cell.setAttribute('aria-selected', true);
                cls += ' ' + me.selectedCls;
                me.fireEvent('highlightitem', me, cell);
            }
            else {
                cell.setAttribute('aria-selected', false);
            }

            if (value < min) {
                cls += ' ' + disabledCls;
                describedBy.push(me.id + '-ariaMinText');
                cell.setAttribute('data-qtip', me.minText);
            }
            else if (value > max) {
                cls += ' ' + disabledCls;
                describedBy.push(me.id + '-ariaMaxText');
                cell.setAttribute('data-qtip', me.maxText);
            }
            else if (ddays && ddays.indexOf(current.getDay()) !== -1){
                cell.setAttribute('data-qtip', ddaysText);
                describedBy.push(me.id + '-ariaDisabledDaysText');
                cls += ' ' + disabledCls;
            }
            else if (ddMatch && format){
                formatValue = eDate.dateFormat(current, format);
                if(ddMatch.test(formatValue)){
                    cell.setAttribute('data-qtip', ddText.replace('%0', formatValue));
                    describedBy.push(me.id + '-ariaDisabledDatesText');
                    cls += ' ' + disabledCls;
                }
            }
            
            if (describedBy.length) {
                cell.setAttribute('aria-describedby', describedBy.join(' '));
            }
            
            cell.className = cls + ' ' + me.cellCls;
        };

        for (; i < me.numDays; ++i) {
            if (i < startingPos) {
                html = (++prevStart);
                cls = me.prevCls;
            } else if (i >= days) {
                html = (++extraDays);
                cls = me.nextCls;
            } else {
                html = i - startingPos + 1;
                cls = me.activeCls;
            }
            textNodes[i].innerHTML = calendarData.getNepaliNumber(html);
			current.setDate(current.getDate() + 1);
            setCellClass(i, cls);
        }
		me.eventEl.dom.removeAttribute('aria-busy');
        //me.monthBtn.setText(Ext.Date.format(date, me.monthYearFormat));
		var convert = eDate.convertToNepali(date),
			dateFormatPattern = "%m %y",
			bsYear = convert.bsYear,
			bsMonth = convert.bsMonth,
			bsDate = convert.bsDate,
			rawDateText =  calendarData.bsDateFormat(dateFormatPattern, bsYear, bsMonth, bsDate);
        
		me.monthBtn.setText(rawDateText);
    }
}());

Ext.define('Ext.ux.nepaliDatePlugin-ne-NP', {
        override: 'Ext.Date',

        requires: 'Ext.ux.nepaliDatePlugin',
		nepaliMonthNames: ['बैशाख','जेठ','अषाढ','श्रावण','भाद्र','आश्विन','कार्तिक','मङ्सिर','पौष','माघ','फाल्गुन','चैत्र'],
        nepaliDayNames: ["आईत", "सोम", "मंगल", "बुध", "बिही", "शुक्र", "शनि"]
	},
	function() {
	    Ext.override(Ext.ux.nepaliDatePlugin.localization.DatePicker, {
	        dayNames: Ext.Date.nepaliDayNames,
			todayText: 'आज',
	        startDay: 0
	    });
	
	    Ext.override(Ext.ux.nepaliDatePlugin.localization.DateField, {
			todayText: 'आज',
	        startDay: 0
	    });
	}
)
